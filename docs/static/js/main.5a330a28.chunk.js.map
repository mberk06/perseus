{"version":3,"sources":["lib/raphael.js","lib/jquery.mobile.vmouse.js","lib/i18n.js","perseus-globals.js","multi-items/shapes.js","multi-items/prop-type-builders.js","util/svg-image-utils.js","lib/kas.js","util/math.js","util/answer-types.js","util.js","multi-items/trees.js","interactive2/objective_.js","gorgon/proptypes.js","gorgon/selector.js","gorgon/rule.js","gorgon/rules/image-widget.js","gorgon/rules/image-spaces-around-urls.js","gorgon/rules/unbalanced-code-delimiters.js","gorgon/rules/math-without-dollars.js","gorgon/rules/profanity.js","gorgon/rules/widget-in-table.js","gorgon/rules/unescaped-dollar.js","gorgon/rules/table-missing-cells.js","gorgon/rules/nested-lists.js","gorgon/rules/math-text-empty.js","gorgon/rules/math-starts-with-space.js","gorgon/rules/math-nested.js","gorgon/rules/math-frac.js","gorgon/rules/math-font-size.js","gorgon/rules/math-empty.js","gorgon/rules/math-align-linebreaks.js","gorgon/rules/math-align-extra-break.js","gorgon/rules/math-adjacent.js","gorgon/rules/long-paragraph.js","gorgon/rules/link-click-here.js","gorgon/rules/image-in-table.js","gorgon/rules/image-alt-text.js","gorgon/rules/heading-title-case.js","gorgon/rules/heading-sentence-case.js","gorgon/rules/heading-level-skip.js","gorgon/rules/heading-level-1.js","gorgon/rules/extra-content-spacing.js","gorgon/rules/double-spacing-after-terminal.js","gorgon/rules/blockquoted-widget.js","gorgon/rules/blockquoted-math.js","gorgon/rules/lint-utils.js","gorgon/rules/absolute-url.js","gorgon/rules/all-rules.js","components/inline-icon.jsx","styles/constants.js","components/lint.jsx","perseus-markdown.jsx","gorgon/tree-transformer.js","gorgon/gorgon.js","util/katex-preprocess.js","deferred.js","components/zoomable.jsx","components/text-list-editor.jsx","components/stub-tag-editor.jsx","perseus-api.jsx","mixins/api-options-props.js","widgets.js","util/sizing-utils.js","widget-container.jsx","zoom.js","jipt-hack.jsx","components/image-loader.jsx","interactive2/movable-helper-methods.js","interactive2/interactive-util.js","util/colors.js","interactive2/wrapped-defaults.js","interactive2/wrapped-path.js","interactive2/wrapped-line.js","interactive2/wrapped-ellipse.js","util/tex.js","util/graphie.js","util/interactive.js","util/graph-utils.js","interactive2/movable-polygon-options.js","interactive2/movable-polygon.js","interactive2/movable-line-options.js","interactive2/movable-line.js","icon-paths.js","interactive2/movable-point-options.js","interactive2/movable-point.jsx","interactive2/movable.js","interactive2.js","components/graphie-classes.jsx","components/graphie-movables.jsx","components/graphie.jsx","components/fixed-to-responsive.jsx","components/svg-image.jsx","question-paragraph.jsx","jipt-paragraphs.jsx","not-gorgon.js","renderer.jsx","styles/media-queries.js","styles/shared.js","hint-renderer.jsx","hints-renderer.jsx","multi-items/items.js","hubble/util.js","hubble/arr.js","hubble/obj.js","hubble/str.js","hubble/index.js","multi-items/multi-renderer.jsx","multi-items.js","mixins/provide-keypad.jsx","server-item-renderer.jsx","item-renderer.jsx","question-renderer.jsx","article-renderer.jsx","mixins/widget-prop-blacklist.jsx","mixins/editor-jsonify.jsx","mixins/changeable.jsx","widgets/simple-markdown-tester-editor.jsx","widgets/simple-markdown-tester.jsx","widgets/example-widget-editor.jsx","widgets/example-widget.jsx","mixins/widget-jsonify-deprecated.jsx","widgets/example-graphie-widget.jsx","widgets/example-graphie-widget-editor.jsx","components/info-tip.jsx","widgets/video-editor.jsx","widgets/video.jsx","sigfigs.jsx","components/number-input.jsx","widgets/unit-editor.jsx","tex-wrangler.js","components/math-output.jsx","widgets/unit.jsx","components/simple-keypad-input.jsx","components/graph.jsx","widgets/transformer.jsx","components/prop-check-box.jsx","components/range-input.jsx","components/graph-settings.jsx","widgets/transformer-editor.jsx","widgets/table.jsx","draft-utils.js","perseus-editor.jsx","katex-error-view.jsx","editor.jsx","widgets/table-editor.jsx","widgets/sorter-editor.jsx","components/sortable.jsx","widgets/sorter.jsx","widgets/simulator-editor.jsx","widgets/simulator.jsx","widgets/sequence-editor.jsx","widgets/sequence.jsx","components/text-input.jsx","widgets/reaction-diagram-editor.jsx","widgets/molecule/smiles-parser.jsx","widgets/molecule/molecule-layout.jsx","widgets/molecule/molecule-drawing.jsx","widgets/molecule.jsx","widgets/reaction-diagram.jsx","widgets/plotter.jsx","widgets/plotter-editor.jsx","widgets/passage-ref-target-editor.jsx","widgets/passage-ref-target.jsx","widgets/passage-ref-editor.jsx","widgets/passage-ref.jsx","widgets/passage-editor.jsx","widgets/passage/passage-markdown.jsx","components/highlighting/ranges.js","components/highlighting/highlights.js","components/highlighting/word-indexer.jsx","components/highlighting/ui/selection-tracker.jsx","components/highlighting/ui/util.js","components/highlighting/ui/highlight-tooltip.jsx","components/highlighting/ui/highlight-renderer.jsx","components/highlighting/ui/highlight-set-renderer.jsx","components/highlighting/ui/highlighting-ui.jsx","components/highlighting/highlightable-content.jsx","widgets/passage.jsx","widgets/orderer-editor.jsx","widgets/orderer.jsx","widgets/number-line-editor.jsx","widgets/number-line.jsx","widgets/molecule-editor.jsx","widgets/measurer-editor.jsx","widgets/measurer.jsx","widgets/matcher-editor.jsx","widgets/matcher.jsx","widgets/matrix.jsx","widgets/matrix-editor.jsx","widgets/lights-puzzle-editor.jsx","widgets/lights-puzzle.jsx","widgets/interactive-graph.jsx","widgets/interactive-graph-editor.jsx","components/tex-buttons.jsx","components/math-input.jsx","widgets/interaction/element-container.jsx","widgets/interaction/dash-picker.jsx","widgets/interaction/constraint-editor.jsx","widgets/interaction/color-picker.jsx","widgets/interaction/arrow-picker.jsx","widgets/interaction-editor.jsx","widgets/interaction.jsx","widgets/image-editor.jsx","widgets/image.jsx","widgets/iframe-editor.jsx","widgets/iframe.jsx","widgets/group-editor.jsx","widgets/group.jsx","widgets/graded-group-editor.jsx","widgets/graded-group-set-editor.jsx","widgets/graded-group-answer-bar.jsx","widgets/graded-group.jsx","widgets/graded-group-set.jsx","widgets/grapher/util.jsx","widgets/grapher.jsx","widgets/grapher-editor.jsx","widgets/definition-editor.jsx","widgets/definition.jsx","widgets/explanation-editor.jsx","widgets/explanation.jsx","widgets/dropdown-editor.jsx","widgets/dropdown.jsx","widgets/cs-program-editor.jsx","widgets/cs-program.jsx","widgets/categorizer.jsx","widgets/categorizer-editor.jsx","widgets/likert-scale.jsx","widgets/likert-scale/likert-face-1.svg","widgets/likert-scale/likert-face-2.svg","widgets/likert-scale/likert-face-3.svg","widgets/likert-scale/likert-face-4.svg","widgets/likert-scale/likert-face-5.svg","widgets/likert-scale-editor.jsx","extra-widgets.js","init.js","components/input-with-examples.jsx","widgets/expression.jsx","widgets/expression-editor.jsx","widgets/numeric-input-editor.jsx","components/possible-answers.jsx","widgets/numeric-input.jsx","widgets/input-number-editor.jsx","widgets/input-number.jsx","widgets/radio/option-status.jsx","widgets/radio/focus-ring.jsx","widgets/radio/choice-icon.jsx","widgets/radio/toggleable-radio-button.jsx","widgets/radio/choice.jsx","widgets/radio/base-radio.jsx","widgets/radio/editor.jsx","widgets/radio/widget.jsx","widgets/radio.jsx","basic-widgets.js","all-widgets.js","perseus.js","diffs/widget-diff-performer.jsx","diffs/widget-diff.jsx","lib/jsdiff.js","diffs/string-array-diff.jsx","diffs/split-diff.jsx","diffs/text-diff.jsx","diffs/renderer-diff.jsx","diffs/article-diff.jsx","article-diff-demo.jsx","diffs/item-diff.jsx","item-diff-demo.jsx","simple-button.jsx","json-editor.jsx","iframe-content-renderer.jsx","components/constants.js","components/device-framer.jsx","hint-editor.jsx","multirenderer-editor.jsx","multirenderer-demo.jsx","components/hud.jsx","article-editor.jsx","stateful-article-editor.jsx","article-demo.jsx","renderer-demo.jsx","traversal.jsx","renderability.jsx","components/viewport-resizer.jsx","item-extras-editor.jsx","item-editor.jsx","util/fix-passage-refs.jsx","editor-page.jsx","stateful-editor-page.jsx","editor-demo.jsx","i18n.jsx","a11y.js","item-version.js","editor-perseus.js","perseus-env.js","demo-perseus.js"],"names":["setAttr","R","is","arguments","array","a","cnv","create","apply","splice","nu","res","set","i","ii","length","j","elements","has","type","push","attr","trim","node","att","value","setAttribute","String","version","paperproto","separator","circle","rect","path","ellipse","text","image","formatrg","proto","doc","document","win","window","oldRaphael","was","Object","call","Raphael","Paper","this","customAttributes","supportsTouch","E","S","Str","events","touchMap","mousedown","mousemove","mouseup","lowerCase","toLowerCase","math","Math","mmax","max","mmin","min","abs","pow","PI","string","fillString","objectToString","ISURL","colourRegExp","isnan","bezierrg","round","toFloat","parseFloat","toInt","parseInt","ms","upperCase","toUpperCase","availableAttrs","blur","cursor","cx","cy","fill","font","gradient","height","href","opacity","r","rotation","rx","ry","scale","src","stroke","target","title","translation","width","x","y","availableAnimAttrs","along","rp","animKeyFrames","commaSpaces","hsrg","hs","rg","p2s","pathCommand","pathValues","radial_gradient","sortByKey","b","key","SVGAngle","implementation","hasFeature","d","createElement","innerHTML","firstChild","style","behavior","adj","createUUID","s","random","svg","vml","_id","_oid","fn","o","Array","isArray","slice","angle","x1","y1","x2","y2","x3","y3","atan","rad","deg","snapTo","values","tolerance","rem","setWindow","newwin","toHex","color","bod","docum","ActiveXObject","write","close","body","e","createPopup","range","createTextRange","cacher","queryCommandValue","display","defaultView","getComputedStyle","getPropertyValue","hsbtoString","h","hsltoString","l","rgbtoString","hex","f","scope","postprocessor","newf","arg","args","cache","count","shift","hsb2rgb","hsl2rgb","t2","t1","t3","rgb","channels","g","toString","rgb2hsb","red","green","blue","clr","getRGB","hue","delta","rgb2hsl","hsl","_path2string","join","colour","indexOf","error","substring","charAt","t","match","getColor","start","reset","parsePathString","pathString","paramCounts","c","m","q","v","z","data","pathClone","params","name","findDotsAtSegment","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","mx","my","nx","ny","ax","ay","alpha","n","end","pathDimensions","p","X","Y","path2curve","dim","curveDim","xmin","ymin","pathArray","jj","pathToRelative","pa","toFixed","k","kk","len","pathToAbsolute","l2c","q2c","_13","_23","a2c","large_arc_flag","sweep_flag","recursive","xy","_120","rotate","cos","sin","f1","f2","sqrt","rx2","ry2","asin","df","f2old","x2old","y2old","c1","s1","c2","s2","tan","hx","hy","m1","m2","m3","m4","newres","findDotAtSegment","dot","path2","p2","attrs","bx","by","qx","qy","attrs2","processPath","T","Q","fixArc","pp","pi","fixM","path1","a1","a2","seg","seg2","seglen","seg2len","parseDots","dots","par","offset","getContainer","w","container","getElementById","tagName","pixelWidth","offsetWidth","pixelHeight","offsetHeight","plugins","con","add","that","prop","tear","el","paper","top","prev","bottom","next","tofront","toback","insertafter","el2","insertbefore","removed","methodname","Error","svgns","xlink","num","$","createElementNS","webkitTapHighlightColor","thePath","SVG","canvas","Element","setFillAndStroke","addGradientFill","fx","fy","all","_fx","_fy","dir","isNaN","vector","id","getAttribute","defs","removeChild","stop","fillOpacity","updatePosition","bbox","getBBox","pattern","patternTransform","format","dasharray","rot","addDashes","butt","square","dashes","rotxy","pn","parentNode","hl","insertBefore","setAttributeNS","clip","rc","strokeWidth","translate","isURL","ig","patternUnits","img","cssText","onload","safari","stops","getElementsByTagName","cssrule","tuneText","fontSize","texts","tspan","dy","createTextNode","bb","dif","raphael","transformations","_","tx","ty","rt","sx","sy","elproto","transform","hide","show","remove","Infinity","getNumberOfChars","getExtentOfChar","subkey","toFront","toBack","insertAfter","element","nextSibling","size","fltr","stdDeviation","appendChild","_blur","filter","removeAttribute","theCircle","theRect","theEllipse","theImage","preserveAspectRatio","theText","setSize","cnvs","xmlns","clear","desc","createNode","map","M","L","C","Z","bites","blurregexp","val","coordsize","zoom","pathlike","rectPath","coordorigin","ol","Path","newpath","W","H","total","command","vals","isMove","path2vml","setBox","div","clipRect","dstyle","group","position","left","filterOpacity","filterMatrix","fontFamily","fontWeight","fontStyle","shape","newfill","on","newstroke","strokeColor","weight","joinstyle","miterlimit","endcap","dashstyle","span","bbx","fxfy","method","color2","clrs","colors","focus","focussize","focusposition","Group","gs","os","textpath","constructor","Set","runtimeStyle","replace","margin","textpathok","cs","createStyleSheet","addRule","namespaces","rvml","navigator","userAgent","vendor","platform","setTimeout","preventDefault","returnValue","preventTouch","originalEvent","stopPropagation","cancelBubble","stopTouch","addEvent","addEventListener","obj","realName","targetTouches","olde","removeEventListener","attachEvent","event","detachEvent","drag","dragMove","dragi","clientX","clientY","scrollY","documentElement","scrollTop","scrollX","scrollLeft","touch","touches","identifier","_drag","move","move_scope","dragUp","unmousemove","unmouseup","end_scope","start_scope","eventName","unbind","x_y","hover","f_in","f_out","scope_in","scope_out","mouseover","mouseout","unhover","unmouseover","unmouseout","onmove","onstart","onend","undrag","itemsArray","resetScale","dx","rcx","rcy","kx","ky","posx","posy","dirx","diry","dkx","dky","ncx","ncy","fr","neww","newh","skip","P0","dim2","clone","curveslengths","getPointAtSegmentLength","totalLength","fract","old","precision","timer","clearTimeout","getLengthFactory","istotal","subpath","onlystart","point","sp","subpaths","getTotalLength","getPointAtLength","getSubpathsAtLength","getSubpath","from","to","easing_formulas","linear","backIn","backOut","elastic","bounce","animationElements","animation","Now","Date","now","time","easing","diff","pos","back","upto255","from2","concat","_run","keyframesRun","prevcallback","timeouts","animate","isBack","callback","CubicBezierAtTime","duration","sampleCurveX","epsilon","t0","d2","solveCurveX","solve","animateWith","animateAlong","animateAlongBack","onAnimation","animateable","toColour","pathes","toPath","easyeasy","curve","_ac","lastcall","test","sort","unshift","ae","items","item","pop","collector","box","registerFont","face","fonts","fontcopy","glyphs","family","glyph","getFont","stretch","normal","bold","lighter","bolder","thefont","RegExp","fontName","print","origin","letter_spacing","out","letters","split","descent","curr","token","str","ninja","st","undefined","dataPropertyName","touchTargetPropertyName","virtualEventNames","touchEventProps","mouseHookProps","mouseHooks","props","mouseEventProps","activeDocHandlers","resetTimerID","startX","startY","didScroll","clickBlockList","blockMouseTriggers","blockTouchTriggers","eventCaptureSupported","$document","nextTouchID","lastTouchID","getNativeEvent","getVirtualBindingFlags","flags","hasVirtualBinding","disableTouchBindings","disableMouseBindings","startResetTimer","clearResetTimer","vmouse","resetTimerDuration","triggerVirtualEvent","eventType","ve","getClosestElementWithVirtualBinding","oe","ne","ct","Event","search","which","changedTouches","createVirtualEvent","trigger","mouseEventCallback","touchID","isDefaultPrevented","isPropagationStopped","isImmediatePropagationStopped","stopImmediatePropagation","handleTouchStart","pageX","pageY","handleScroll","handleTouchMove","didCancel","moveThreshold","moveDistanceThreshold","handleTouchEnd","hasVirtualBindings","ele","bindings","dummyMouseHandler","getSpecialEventObject","realType","substr","setup","namespace","bind","teardown","$this","removeData","clickDistanceThreshold","special","cnt","threshold","jQuery","likeEnglish","allPluralForms","interpolationMarker","interpolateStringToFragment","options","result","replaceWith","React","Fragment","keys","messages","ngetpos","lang","i18nDoNotTranslate","i18n","ngettext","singular","plural","idx","$_","$i18nDoNotTranslate","createReactClass","PropTypes","ReactDOMtags","input","katex","MathQuill","classnames","PureRenderMixin","_reactAddonsPureRenderMixin","ReactDOM","classNames","icu","getDecimalFormatSymbols","decimal_separator","grouping_separator","minus","KhanUtil","debugLog","localeToFixed","Exercises","localMode","useKatex","khanExercisesUrlBase","getCurrentFramework","PerseusBridge","cleanupProblem","Khan","Util","query","debug","imageBase","_module_","exports","hintShape","buildArrayShape","elementShape","hintsShape","content","hint","hints","tags","arrayOf","buildTreePropTypeForShape","__type","oneOf","isRequired","images","objectOf","any","widgets","bool","elementPropType","valueShapes","propTypeShape","forEach","svgLabelsRegex","isLabeledSVG","url","getBaseUrl","protocol","location","getSvgUrl","getDataUrl","splitHashRegex","getRealImageUrl","KAS","parser","$V0","$V1","$V2","$V3","$V4","$V5","$V6","$V7","$V8","$V9","$Va","$Vb","$Vc","$Vd","$Ve","$Vf","$Vg","$Vh","$Vi","$Vj","$Vk","$Vl","$Vm","$Vn","$Vo","trace","yy","symbols_","terminals_","productions_","performAction","yytext","yyleng","yylineno","yystate","$$","_$","$0","Eq","Add","createOrAppend","Mul","handleNegative","fold","handleDivide","Log","natural","common","Trig","Pow","Var","Const","Int","Number","Float","completeParse","addHint","nthroot","Abs","Func","table","defaultActions","parseError","hash","recoverable","parse","self","stack","vstack","lstack","recovering","TERROR","EOF","lexer","sharedState","prototype","hasOwnProperty","setInput","yylloc","yyloc","ranges","lex","getPrototypeOf","symbol","preErrorSymbol","state","action","newState","expected","yyval","errStr","showPosition","line","loc","first_line","last_line","first_column","last_column","_input","_more","_backtrack","done","matched","conditionStack","ch","unput","lines","oldLines","more","reject","backtrack_lexer","less","pastInput","past","upcomingInput","pre","test_match","indexed_rule","backup","matches","tempMatch","index","rules","_currentRules","flex","begin","condition","popState","conditions","topState","pushState","stateStackSize","yy_","$avoiding_name_collisions","YY_START","symbolLexer","console","log","Parser","magnitude","unit","denom","unitParser","abstract","message","object","randomFloat","extent","Expr","Seq","terms","toArray","base","exp","power","right","Symbol","subscript","Num","Rational","numerator","denominator","number","extend","func","construct","instance","recurse","passed","isString","eval","codegen","compile","code","Function","tex","asTex","defaults","dynamic","times","repr","strip","normalize","expand","factor","collect","equals","other","simplify","once","step1","step2","step3","step4","simplified","isSimplified","exprArgs","getVars","excludeFunc","uniq","flatten","invoke","getConsts","getUnits","raiseToThe","isSubtract","isDivide","isRoot","needsExplicitMul","sameVars","vars1","vars2","same","array1","array2","difference","lower","equal","equalIgnoringCase","compare","varList","union","equalNumbers","num1","num2","getDelta","Unit","expr1","expr2","unitList1","unitList2","isEqual","vars","floor","useFloats","each","result1","partialEval","result2","sameForm","findGCD","One","getDenominator","asMul","isPositive","isNegative","asPositiveFactor","expr","parens","asExpr","negate","Neg","sortBy","term","partition","groupBy","numbers","others","identity","grouped","flattened","pluck","reduce","oldTerm","newTerm","newTerms","memo","pairs","muls","pair","collected","compact","zip","keepNegative","factors","rest","remainder","tmUnits","chain","cdot","inverses","inverse","negatives","withThisRemoved","hasDenom","shouldPushDown","fraction","Div","subtract","entered","isAdd","isInverse","mul","hasAdd","hasInverseAdd","normals","adds","expanded","temp","factored","rational","partitioned","Zero","summed","trigs","isBasic","trig","logs","exprs","byArg","funcs","cot","byBase","factorIn","negativeOne","factorOut","list","divide","isNum","find","negated","first","isInt","reversed","reverse","divided","last","initial","trigLog","open","newTrigLog","neg","some","every","firstNeg","firstNum","evaledBase","evaledExp","simplifiedExp","decimals","asDivide","isSimple","positive","signed","indices","without","pick","isSimilarLog","preciseFloats","asRational","decimalsInBase","getDecimalPlaces","newBase","isDiv","root","isSquaredTrig","expA","expB","Sqrt","radicand","degree","isNatural","Ten","functions","csc","sec","arcsin","arccos","acos","arctan","arccsc","arcsec","arccot","sinh","argStr","cosh","tanh","csch","sech","coth","isEven","contains","positives","signs","eq","unfactored","isZero","isInequality","isEquality","divideThrough","dividedResult","eq1","eq2","solveLinearEquationForVariable","variable","newVars","parsedFunc","parsed","sub","prettyPrint","gcd","toDecimalPlaces","parts","places","Sub","mod","constants","unprefixify","baseUnits","derivedUnits","prefix","siPrefixes","testPrefix","prefixes","hasPrefixes","unitParse","parseResult","unitArray","unitSpec","coefficient","conversion","A","K","mol","cd","u","da","G","P","hella","hasntPrefixes","makeAlias","splits","coefficientStr","unitsStr","numdenomStr","numdenom","Da","form","_underscore","knumber","_kmath","KhanMath","cleanMath","bound","factorial","getGCD","getLCM","primes","isPrime","grep","getPrimeFactorization","maxf","merge","roundToNearest","increment","roundTo","toFixedApprox","fixedStr","roundToApprox","fixed","toFraction","decimal","nd","loN","loD","hiN","hiD","midN","midD","getNumericFormat","toNumericString","isInteger","includes","sign","modulus","integer","_jquery","_mathJs","MAXERROR_EPSILON","KhanAnswerTypes","predicate","defaultForms","createValidatorFunctional","acceptableForms","ratio","forms","inexact","maxError","fractionTransformer","parsedInt","exact","rounded","proper","improper","possibilities","integ","approximatesPi","piMult","roundedNumber","possibility","piApprox","multiplier","ix","percent","hasPercentSign","transformed","mixed","badLeadingZero","commas","guess","fallback","score","empty","correct","interpretedGuess","convertToPredicate","correctFloat","expression","parseSolution","solutionString","solution","answer","answerX","resultX","_utilAnswerTypesJs","nestedMap","children","context","child","inputPathsEqual","rWidgetParts","rWidgetRule","rTypeFromWidgetId","snowman","noScore","earned","seededRNG","seed","randomSeed","shuffle","ensurePermuted","shuffled","isFunction","newEnd","output","lastIndex","exec","combineScores","scoreA","scoreB","keScoreFromPerseusScore","firstNumericalParse","ans","stringArrayOfSize","gridDimensionConfig","absTickStep","dimensionConstraint","gridStep","scaleFromExtent","tickStep","unityLabel","getGridStep","step","boxSize","gridStepFromTickStep","snapStepFromGridStep","tickStepFromExtent","desiredNumTicks","tickStepFromNumTicks","tickWidth","LN10","leadingDigit","numTicks","err","constrainedTickStepsFromTickSteps","tickSteps","steps","DeprecationMixin","componentWillMount","newProps","deprecatedProps","isEmpty","onChange","isNumber","deepEq","isObject","parseQueryString","urlParams","decodeURIComponent","updateQueryString","uri","encodeURIComponent","re","strongEncodeURIComponent","escape","widgetShouldHighlight","widget","scoreIsEmpty","touchHandlers","pointerDown","currentTouchIdentifier","resetTouchHandlers","extractPointerLocation","touchOrEvent","isEndish","captureScratchpadTouchStart","getImageSize","Image","defer","clientWidth","clientHeight","textarea","getWordBeforeCursor","endPos","selectionStart","startPos","lastIndexOf","moveCursor","selectionEnd","getTime","TreeMapperJustForLeaves","setContentMapper","newContentMapper","setHintMapper","newHintMapper","setTagsMapper","newTagsMapper","setArrayMapper","newArrayMapper","TreeMapperForLeavesAndCollections","mapTree","tree","buildMapper","mappers","mappedElements","inner","JSON","stringify","newObject","mapObject","lambda","mapObjectFromArray","arr","elem","subKey","_react","contentType","highlightLint","paths","linterContextDefault","Selector","selectorText","tokens","TOKENS","tokenIndex","nextToken","consume","isIdentifier","skipSpace","ts","parseTreeSelector","treeSelectors","ParseError","SelectorList","ns","parseNodeSelector","AncestorCombinator","ParentCombinator","PreviousCombinator","SiblingCombinator","AnyNode","TypeSelector","super","selectors","currentNode","SelectorCombinator","rightResult","hasParent","goToParent","leftResult","hasPreviousSibling","goToPreviousSibling","Rule","severity","selector","lint","applies","Severity","BULK_WARNING","DEFAULT_SELECTOR","_defaultLintFunction","makePattern","check","traversalState","selectorMatch","patternMatch","FakePatternMatch","rule","lastSlash","ERROR","WARNING","GUIDELINE","makeRule","nodes","widgetType","alt","caption","headerLength","header","rowLengths","cells","littleWords","and","nor","but","the","for","locale","words","word","isCapitalized","currentHeading","previousHeading","level","HOSTNAME","getHostname","hostname","endsWith","_absoluteUrlJs","_blockquotedMathJs","_blockquotedWidgetJs","_doubleSpacingAfterTerminalJs","_extraContentSpacingJs","_headingLevel1Js","_headingLevelSkipJs","_headingSentenceCaseJs","_headingTitleCaseJs","_imageAltTextJs","_imageInTableJs","_linkClickHereJs","_longParagraphJs","_mathAdjacentJs","_mathAlignExtraBreakJs","_mathAlignLinebreaksJs","_mathEmptyJs","_mathFontSizeJs","_mathFracJs","_mathNestedJs","_mathStartsWithSpaceJs","_mathTextEmptyJs","_nestedListsJs","_tableMissingCellsJs","_unescapedDollarJs","_widgetInTableJs","_profanityJs","_mathWithoutDollarsJs","_unbalancedCodeDelimitersJs","_imageSpacesAroundUrlsJs","_imageWidgetJs","role","verticalAlign","viewBox","baseFontFamily","boldFontFamily","kaGreen","white","gray95","gray85","gray76","gray68","gray17","warning1","tableBackgroundAccent","satBlue","satCorrectColor","satCorrectBorderColor","satIncorrectColor","satIncorrectBorderColor","phoneMargin","negativePhoneMargin","baseUnitPx","interactiveSizes","warningColor","warningColorHover","checkedColor","_reactDom","InlineIcon","_inlineIconJsx","exclamationIcon","Lint","getInitialState","tooltipAbove","componentDidMount","_positionTimeout","getPosition","componentWillUnmount","findDOMNode","getBoundingClientRect","setState","renderLink","severityStyle","warningText","warningTextStyle","styles","indicatorError","publishBlockingError","indicatorWarning","warning","indicatorGuideline","ruleName","className","css","indicator","tooltip","tooltipParagraph","tail","tailAbove","render","insideTable","inline","lintContainer","inlineHoverTarget","hoverTarget","StyleSheet","backgroundColor","outline","float","marginRight","alignItems","borderRadius","justifyContent","zIndex","lineHeight","borderLeft","borderRight","borderBottom","borderTop","SimpleMarkdown","_simpleMarkdown","TeX","_reactComponentsTexJsx","_utilJs","_componentsLintJsx","mathMatcher","source","isBlock","startIndex","braceLevel","character","endIndex","TITLED_TABLE_REGEX","defaultRules","nptable","regex","crowdinJiptMatcher","blockRegex","columns","order","capture","col1","col2","react","crowdinId","prevCapture","isJipt","titledTable","parseInline","tableCapture","contents","tableOutput","cloneElement","link","inlineRegex","blockMath","codeBlock","unescapedDollar","fence","KA","isZeroRated","baseElements","Link","isInline","inlineNodeTypes","strong","em","del","builtParser","parserFor","traverseContent","ast","cb","getContent","nestedContent","characterCount","reactFor","ruleOutput","basicOutput","sanitizeUrl","TreeTransformer","isNode","traverse","_traverse","TraversalState","_containers","_ancestors","_indexes","_currentNode","Stack","parent","ancestors","siblings","previousSibling","removeNextSibling","parentIsArray","property","replacements","allLintRules","_rulesAllRulesJs","runLinter","highlight","warnings","tt","isTextNode","tableWarnings","nodeWarnings","applicableRules","nodeContext","suffix","PerseusMarkdown","pushContextStack","texCode","promise","Promise","resolve","then","Deferred","_deferredJs","Zoomable","getDefaultProps","deferred","animateHeight","readyToMeasureDeferred","computeChildBounds","firstElementChild","visible","marginBottomPx","zoomed","_node","isMounted","scaleChildToFit","MutationObserver","_observer","mutations","mutation","observe","childList","subtree","attributes","disconnect","_originalWidth","compactHeight","expandedHeight","stopPropagationIfZoomed","parentBounds","childBounds","childWidth","childHeight","ceil","handleClickIfZoomed","handleClick","translateOffset","WebkitTransform","msTransform","transformOrigin","WebkitTransformOrigin","msTransformOrigin","WebkitTapHighlightColor","transitionProperty","WebkitTransitionProperty","msTransitionProperty","transitionDuration","WebkitTransitionDuration","msTransitionDuration","transitionTimingFunction","WebkitTransitionTimingfunction","msTransitionTmingFunction","onClick","onClickCapture","onTouchCancelCapture","onTouchEndCapture","onTouchStartCapture","textWidthCache","getTextWidth","$test","appendTo","TextListEditor","layout","componentWillReceiveProps","nextProps","inputs","ref","onKeyDown","nativeEvent","keyCode","focusIndex","refs","_textListEditorJsx","EMPTY_ARRAY","StubTagEditor","showTitle","Options","propTypes","isArticle","satStyling","onInputError","onFocusChange","staticRender","GroupMetadataEditor","showAlignmentOptions","readOnly","answerableCallback","getAnotherHint","interactionCallback","groupAnnotator","imagePlaceholder","widgetPlaceholder","imagePreloader","trackInteraction","customKeypad","isMobile","setDrawingAreaAvailable","useDraftEditor","styling","radioStyleVersion","hintProgressColor","ClassNames","RENDERER","TWO_COLUMN_RENDERER","RESPONSIVE_RENDERER","INPUT","FOCUSED","RADIO","OPTION","SELECTED","OPTION_CONTENT","INTERACTIVE","CORRECT","INCORRECT","UNANSWERED","MOBILE","ApiOptions","_perseusApiJsx","ApiOptionsProps","apiOptions","getApiOptions","DEFAULT_ALIGNMENT","DEFAULT_SUPPORTED_ALIGNMENTS","editors","Widgets","register","editor","registerMany","validateAlignments","getWidget","getEditor","getTransform","getVersion","major","minor","getVersionVector","getPublicWidgets","hidden","isAccessible","widgetInfo","accessible","getAllWidgetTypes","upgradeWidgetInfoToLatestVersion","oldWidgetInfo","widgetExports","initialVersion","latestVersion","newEditorProps","upgradePropsMap","propUpgrades","nextVersion","warn","defaultProps","alignment","getSupportedAlignments","widgetStatic","static","graded","getRendererPropsForWidgetInfo","problemNum","getStaticTransform","traverseChildWidgets","traverseRenderer","supportedAlignments","getDefaultAlignment","defaultAlignment","validAlignments","displayName","unknownAlignments","supportsStaticMode","staticTransform","getTracking","tracking","isLintable","containerSizeClass","SMALL","MEDIUM","LARGE","XLARGE","getInteractiveBoxFromSizeClass","sizeClass","_classnames","_widgetsJs","WidgetContainer","linterContext","widgetProps","initialProps","containerWidth","shouldHighlight","WidgetType","isStatic","staticOverlayStyles","overflow","shouldComponentUpdate","nextState","replaceWidgetProps","newWidgetProps","changeViewportTag","contentString","viewport","querySelector","append","scrollTo","_ZoomService","Zoom","enableMobilePinch","_fullHeight","_fullWidth","_overlay","_targetImage","_enableMobilePinch","_$body","emulateTransitionEnd","called","$el","one","support","transition","transEndEventNames","WebkitTransition","MozTransition","OTransition","transitionEnd","bsTransitionEnd","bindType","delegateType","handle","handleObj","handler","_initialize","_$document","_activeZoom","_initialScrollPosition","_initialTouchPosition","_touchMoveListener","_$window","_boundClick","proxy","_clickHandler","handleZoomClick","hasClass","metaKey","ctrlKey","innerWidth","getOffset","_activeZoomClose","_zoom","_scrollHandler","_keyHandler","_touchStart","zoomImage","forceDispose","dispose","_disposeActiveZoom","off","deltaY","_touchMove","_OFFSET","_MAX_WIDTH","_MAX_HEIGHT","zoomToFitOnMobile","$zoomedImage","imageOffset","_imageOffset","_left","_top","_zoomOriginal","addClass","_backdrop","_calculateZoom","_triggerAnimation","originalFullImageWidth","originalFullImageHeight","viewportHeight","innerHeight","viewportWidth","maxScaleFactor","imageAspectRatio","viewportAspectRatio","_imgScaleFactor","viewportY","viewportX","scaleFactor","imageCenterY","imageCenterX","_translateY","_translateX","_zoomedInTransformString","_onZoomInFinish","marginLeft","marginTop","removeClass","ZoomService","MAYBE_LATEX_REGEX","LATEX_MACROS","macro","ESCAPE_SEQUENCES","getLatexLevel","backslashCount","maybeMacro","tryUnescape","shouldUnescape","levelSumOriginal","levelSumUnescaped","anyInvalidLatexInOriginal","anyInvalidLatexInUnescaped","original","unescaped","originalLevel","unescapedLevel","maybeUnescape","maybeUnescapeAccordingToSource","Status","ImageLoader","status","createLoader","componentDidUpdate","prevProps","prevState","onUpdate","destroyLoader","handleLoad","onerror","handleError","onLoad","onError","renderImg","imgProps","preloader","kpoint","getKey","MovableHelperMethods","_fireEvent","listeners","currentValue","previousValue","_applyConstraints","current","previous","extraOptions","skipRemaining","constraints","constraint","onSkipRemaining","draw","currState","cloneState","listen","_listenerMap","unlisten","getEventName","_movableHelperMethodsJs","prefixedTransform","canUse3dTransform","InteractiveUtil","assert","isTrue","createGettersFor","Class","addMovableHelperMethodsTo","methodFunc","methodName","arrayify","funcOrArray","normalizeOptions","arrayOptionNames","funcArray","getPrefixedTransform","correctPrefix","computePrefixedTransform","getCanUse3dTransform","computeCanUse3dTransform","KhanColors","BLUE","ORANGE","PINK","GREEN","PURPLE","RED","GRAY","BLACK","LIGHT_BLUE","LIGHT_ORANGE","LIGHT_PINK","LIGHT_GREEN","LIGHT_PURPLE","LIGHT_RED","LIGHT_GRAY","LIGHT_BLACK","GRAY10","GRAY20","GRAY30","GRAY40","GRAY50","GRAY60","GRAY70","GRAY80","GRAY90","BLUE_A","BLUE_B","BLUE_C","BLUE_D","BLUE_E","TEAL_A","TEAL_B","TEAL_C","TEAL_D","TEAL_E","GREEN_A","GREEN_B","GREEN_C","GREEN_D","GREEN_E","GOLD_A","GOLD_B","GOLD_C","GOLD_D","GOLD_E","RED_A","RED_B","RED_C","RED_D","RED_E","MAROON_A","MAROON_B","MAROON_C","MAROON_D","MAROON_E","PURPLE_A","PURPLE_B","PURPLE_C","PURPLE_D","PURPLE_E","MINT_A","MINT_B","MINT_C","GRAY_A","GRAY_B","GRAY_C","GRAY_D","GRAY_E","GRAY_F","GRAY_G","GRAY_H","GRAY_I","KA_BLUE","KA_GREEN","_BACKGROUND","INTERACTING","DYNAMIC","_interactiveUtilJs","objective_","_objective_Js","kvector","WrappedDefaults","transformation","wrapper","visibleShape","getMouseTarget","moveTo","graphie","scalePoint","initialPoint","do3dTransform","attribute","_wrappedDefaultsJs","DEFAULT_OPTIONS","center","createPath","mouselayer","WrappedPath","points","fixedPath","head","touchAction","addToMouseLayerWrapper","addToVisibleLayerWrapper","_kmath2","_utilMathJs","thickness","WrappedLine","initialStart","initialEnd","fixedLine","normalStyle","initialLength","distanceToPoint","scaledStart","scaledEnd","polarDiff","polarDegFromCart","lineLength","maxScale","shadow","disableMouseEventsOnWrapper","WrappedEllipse","radii","fixedEllipse","padding","webkitFilter","pointerEvents","findChildOrAdd","$child","doCallback","tries","scrollHeight","processMath","force","$elem","$katexHolder","$mathjaxHolder","script","textContent","jax","MathJax","Hub","getJaxFor","SourceElement","Remove","__proto__","Queue","Callback","processAllMath","cleanupMath","retrieveMathFormula","_texJs","_colors","polar","th","GraphUtils","unscaledSvgPath","getDistance","point1","point2","coordDiff","startCoord","endCoord","snapCoord","coord","snap","findAngle","vertex","atan2","graphs","Graphie","cartToPolar","angleInRadians","theta","labelDirections","above","below","SVG_SPECIFIC_STYLE_MASK","createGraphie","xRange","yRange","xScale","yScale","currentStyle","scaleVector","unscalePoint","unscaleVector","setLabelMargins","$span","direction","multipliers","svgPath","alreadyScaled","scaled","svgParabolaPath","computeParabola","xVertex","xPoint","control","svgSinusoidPath","quarterPeriod","computeSine","computeDerivative","coordsForOffset","x0","xCoords","yCoords","numQuarterPeriods","distToEdge","coords","processAttributes","transformers","processed","transformer","dasherized","addArrowheads","arrows","arrowheadsDrawn","almostTheEnd","drawingTools","radius","corner","dims","shapeRendering","scaledPoint","scaledRadii","arc","startAngle","endAngle","sector","cent","startVector","endVector","startPoint","endPoint","largeAngle","graphiePath","pathLeft","pathRight","pathTop","pathBottom","extraOffset","scaledPath","parabola","localRaphael","sinusoid","grid","xr","yr","label","latex","pad","setPosition","scrollWidth","processText","html","plotParametric","shade","fn2","clipper","clippedFn","clippedFn2","strokeLinejoin","strokeLinecap","lastDiff","lastFlip","plotPolar","plot","swapAxes","plotPiecewise","fnArray","rangeArray","fnPaths","fnPath","plotEndpointCircles","endpointArray","circles","plotAsymptotes","asymptotes","lastVal","funcVal","init","dimensions","xpixels","ypixels","oldStyle","graphInit","gridRange","gridOpacity","axes","axisArrows","axisOpacity","axisCenter","axisLabels","ticks","tickLen","tickOpacity","labels","labelStep","labelOpacity","unityLabels","labelFormat","xLabelFormat","yLabelFormat","smartLabelPositioning","realRange","minusIgnorer","lf","halfWidthTicks","xAxisPosition","yAxisPosition","xShowZero","yShowZero","axisOffCenter","showUnityX","showUnityY","_graphieJs","kline","_kmath3","_interactive2WrappedEllipseJs","_interactive2WrappedLineJs","_interactive2WrappedPathJs","_colorsJs","sum","addPoints","zipped","reverseVector","scaledDistanceFromAngle","scaledPolarRad","radians","scaledPolarDeg","degrees","dragging","InteractiveUtils","bogusShape","Protractor","graph","pro","imgPos","passive","arrowHelper","pixelsFromEdge","scaledRadius","scaledCenter","arrow","centerPoint","addMovablePoint","rotateHandle","bounded","onMove","fixedDistance","dist","mouseTarget","isDragging","isHovering","isHighlight","$mouseTarget","setNodes","makeTranslatable","startx","starty","mouseX","mouseY","setCoord","absolute","rotateTo","Ruler","pixelsPerUnit","ticksPerUnit","units","light","leftBottom","graphieUnitsPerUnit","graphieUnitsHeight","rightTop","tickHeightMap","tickHeight","sizes","tickFrequencies","px","getTickHeight","mm","cm","km","in","ft","yd","mi","leftBottomHandle","rightBottomHandle","highlightStyle","pointSize","oldCenter","scaledOldCenter","MovableAngle","labelStyle","angleStyle","allowReflex","reflex","_getClockwiseAngle","rays","addMovableLineSegment","pointA","pointZ","extendRay","labeledAngle","addMoveHandlers","addHighlightHandlers","update","addMouseLayer","allowScratchpad","onMouseDown","onMouseMove","onMouseOver","onMouseOut","canvasClickTarget","isClickingCanvas","getMouseCoord","_mouselayerWrapper","_visiblelayerWrapper","getMousePx","labelAngle","point3","numArcs","showRightAngleMarker","pushOut","clockwise","sVertex","p1","p3","halfAngle","sRadius","v1","v2","SQRT2","v3","sPosition","labelSide","numArrows","midpoint","sMidpoint","parallelAngle","perpendicularAngle","sCumulativeOffset","sSpacing","sHeight","sOffsetVector","sHeightVector","sPath","sStart","sEnd","distance","labelVertex","movablePoint","snapX","snapY","constrainX","constrainY","fixedAngle","lineStarts","lineEnds","polygonVertices","vertexLabel","normalColor","coordX","coordY","applySnapAndConstraints","constrainToBounds","snapPoints","mouse","snapRadians","centerCoord","centerX","centerY","mouseXrel","mouseYrel","applyConstraint","extraConstraints","override","newCoord","distPoint","constrainedAngle","omit","labeledVertex","drawLabel","grab","doMove","updateLineEnds","onMoveEnd","onUnhighlight","onHighlight","startMouseCoord","touchOffset","updateLines","animateTo","coordA","coordZ","setCoordConstrained","lineSegment","tick","extendLine","sideLabel","vertexLabels","movePointsWithLine","arrowStyle","tickoffset","visibleLine","syncToPoints","getClipPoint","angleVec","cartFromPolarDeg","distVec","farCoord","scaledAngle","constrainToBoundsOnAngle","scaledA","scaledZ","getScaledAngle","createArrow","pv","pvScaled","unscaledPoints","arrowHead","toCoordAtAngle","clipPoint","_arrows","coordForArrow","angleForArrow","isClockwise","labeledSide","labeledVertices","mouseOffsetA","mouseOffsetZ","offsetLeft","offsetRight","offsetTop","offsetBottom","dX","dY","addMovablePolygon","polygon","constrainToGraph","pointHighlightStyle","angleLabels","showRightAngleMarkers","sideLabels","updateOnPointMove","closed","isPoint","coordOrPoint","scaledCoords","segments","segment","labeledAngles","labeledSides","numLabels","lastX","lastY","polygonCoords","currentX","currentY","onMoveResult","upper","addMovableAngle","addCircleGraph","snapRadius","minRadius","centerConstraints","centerNormalStyle","centerHighlightStyle","circleNormalStyle","circleHighlightStyle","circ","perim","setCenter","setRadius","cursorAxes","cursorName","startRadius","oldRadius","doResize","onResize","onResizeResult","onResizeEnd","addRotateHandle","rotatePoint","lengthAngle","hideArrow","uniqueId","addVector","angleDeg","drawnRotateHandle","rotatePointPrevCoord","rotateHandlePrevCoord","rotateHandleStartCoord","isRotating","redrawRotateHandle","handleCoord","handleVec","halfWidth","interacting","getRotateHandlePoint","distanceFromArrowMidline","distFromRotationCenter","vec","pixels","innerR","outerR","drawRotateHandle","hoverWidth","oldPolar","newPolar","oldAngle","newAngle","oldRemove","addReflectButton","button","currentlyDrawnButton","isFlipped","baseStyle","getStyle","isRight","redraw","lineCoords","buttonCoord","distanceFromCenter","leftStyle","rightStyle","lineDirection","lineVec","centerVec","leftCenterVec","rotateDeg","rightCenterVec","negLineVec","leftVec","rightVec","leftCenter","addVectors","rightCenter","leftCoord1","leftCoord2","rightCoord1","rightCoord2","leftButton","rightButton","drawButton","pointScale","oldButtonRemove","protractor","ruler","snapDegrees","snapOffsetDeg","angleLabel","tooClose","oldVertex","newVertex","valid","newPoints","newPoint","snapOffset","ray","isReflex","getClockwiseCoords","shouldChangeReflexivity","prevCoords","prevAngle","prevClockwiseReflexive","clockwiseReflexive","areas","constrain","pointsToFront","standard","modify","basic","_labelCache","_labeledAngles","_labeledSides","_labeledVertices","labelType","paddingPx","prevCoord","absoluteLower","absoluteUpper","ceilTo","floorTo","deltaBounds","boundedDelta","updatePoints","actualDelta","onMoveStart","MovablePolygonOptions","_movablePolygonOptionsJs","_utilColorsJs","_utilGraphUtilsJs","FUNCTION_ARRAY_OPTIONS","DEFAULT_PROPS","DEFAULT_STATE","added","hasMoved","MovablePolygon","movable","_createDefaultState","_initialRefCoord","_prevRefCoord","_totalDelta","mouseCoord","prevMouseCoord","refCoord","prevRefCoord","_wrappedLineJs","_wrappedPathJs","MovableLineOptions","_movableLineOptionsJs","MovableLine","iconCheck","iconChevronDown","iconChevronRight","iconCircle","iconCircleArrowDown","iconCircleArrowUp","iconCircleThin","iconDesktop","iconDropdownArrow","iconExclamationSign","iconGear","iconMobilePhone","iconOk","iconPlus","iconRemove","iconStar","iconTryAgain","iconTablet","iconTrash","iconUndo","iconMinus","_wrappedEllipseJs","onOutOfBounds","MovablePointOptions","_movablePointOptionsJs","_utilTexJs","_componentsInlineIconJsx","outOfBounds","tooltipResetFunctions","MovablePoint","_showTooltip","_tooltip","_hideTooltip","showTrashTooltip","isMouse","svgElem","showHairlines","xOnlyTooltip","getElementsByClassName","transformedCoord","hideHairlines","onRemove","isMouseOver","Movable","moveHandler","upHandler","_interactive2MovableJs","_interactive2MovablePointJsx","_interactive2MovableLineJs","_interactive2MovablePolygonJs","Interactive2","addMovableLine","addMaybeMobileMovablePoint","extraProps","commonStyle","assign","showTooltips","GraphieMovable","descriptor","abstractMethod","movableProps","createClass","spec","GraphieClass","childrenArray","rewriteProps","createSimpleClass","addFunction","_elements","_prevProps","GraphieClasses","_graphieClassesJsx","_interactive2Js","_getProps","mobileStyleOverride","addedProps","Label","unscaled","Line","Parabola","Sinusoid","Plot","PlotParametric","Point","Arc","Circle","Rect","Movables","_graphieMovablesJsx","_utilJs2","_interactive2InteractiveUtilJs","responsive","_setupGraphie","_updateMovables","getGraphie","_graphie","_range","dimRange","_box","pixelDim","_scale","_removeMovables","graphieDiv","onMouseUp","snapStep","_movables","_renderMovables","oldMovables","newMovables","renderChildren","areMovablesOutOfOrder","childDescriptor","nextKey","keyProp","prevMovable","movables","oldMovable","FixedToResponsive","constrainHeight","allowFullBleed","_cacheViewportSize","aspectRatio","spacer","paddingBottom","maxHeight","maxWidth","_componentsFixedToResponsiveJsx","_componentsGraphieJsx","_componentsImageLoaderJsx","_zoomJs","labelDataCache","hashRegex","isImageProbablyPhotograph","imageUrl","shouldUseLocalizedData","language","shouldRenderJipt","jiptLabels","defaultPreloader","background","backgroundPosition","minWidth","jipt_dom_insert_checks","useMath","mathRegex","mathText","SvgImage","statics","zoomToFullSizeOnMobile","imageLoaded","imageDimensions","dataLoaded","labelDataIsLocalized","loadResources","isLoadedInState","getUrlHash","loaded","localized","onDataLoaded","dataCallbacks","cacheData","retrieveData","errorCallback","callbackName","success","noop","cleanup","doJSONP","getLocalizedDataUrl","sizeProvided","onImageLoad","setupGraphie","labelData","coordinates","typesetAsMath","labelTop","_tryGetPixels","labelLeft","labelPosition","svgHeight","svgWidth","styleValue","styleName","_handleZoomClick","imageSrc","imageProps","extraGraphie","preloaderBaseFunc","wrapperClasses","zoomable","QuestionParagraph","translationIndex","paragraphIndex","arrayRules","paragraph","builtArrayParser","parseToArray","paragraphedSource","joinFromArray","paragraphs","NotGorgon","previousContent","debounce","perseusStr","onLintErrorsGenerated","fetch","headers","msgid","msgstr","filename","response","json","rejection","applyLintErrors","parsedMarkdown","notGorgonLintErrors","errorText","destroy","JiptParagraphs","_jiptParagraphsJsx","_perseusMarkdownJsx","_questionParagraphJsx","_componentsSvgImageJsx","_widgetContainerJsx","_mixinsApiOptionsPropsJs","ApiClassNames","_componentsZoomableJsx","preprocessTex","_utilKatexPreprocessJs","Gorgon","_gorgonGorgonJs","keypadElementPropType","_mathInput","rContainsNonWhitespace","rImageURL","noopOnRender","PerseusTranslationComponents","$node","component","replaceJiptContent","SHOULD_CLEAR_WIDGETS_PROP_LIST","InteractionTracker","trackApi","widgetID","setting","_tracked","track","_track","_noop","extraData","Renderer","ignoreMissingWidgets","highlightedWidgets","questionCompleted","onRender","onInteractWithWidget","findExternalWidgets","alwaysUpdate","reviewMode","serializedState","onSerializedStateUpdated","jiptContent","notGorgon","_getInitialWidgetState","handleRender","_currentFocus","_rootNode","_isMounted","restoreSerializedState","handleNotGorgonLintErrors","stateChanged","componentWillUpdate","oldJipt","shouldRenderJiptPlaceholder","newJipt","oldContent","newContent","oldHighlightedWidgets","newHighlightedWidgets","reuseMarkdown","widgetIds","getWidgetProps","getSerializedState","allWidgetInfo","_getAllWidgetsInfo","_getAllWidgetsStartProps","widgetId","newValues","editorProps","_getDefaultWidgetInfo","widgetIdParts","_getWidgetInfo","renderWidget","impliedType","foundFullWidth","reviewModeRubric","_interactionTrackers","interactionTracker","keypadElement","onFocus","partial","_onWidgetFocus","onBlur","_onWidgetBlur","findWidgets","silent","_setWidgetProps","getWidgetInstance","serializedWidgetIds","widgetPropIds","intersection","numCallbacks","fireCallback","restoreResult","showRationalesForCurrentlySelectedChoices","deselectIncorrectSelectedChoices","findInternalWidgets","filterCriterion","filterFunc","focusPath","_setCurrentFocus","blurPath","blurringFocusPath","fullPath","allContent","outputMarkdown","oldKey","lastWasString","nodeOut","_foundTextNodes","outputNested","outputNode","nestedOutput","mathjax","onResourceLoaded","innerStyle","overflowX","overflowY","paddingTop","marginBottom","outerStyle","horizontalPadding","paddingLeft","paddingRight","computeMathBounds","textElement","textBounds","whiteSpace","extraAttrs","inTable","_isTwoColumn","wrappedOutput","oldOnRender","$images","prefixArray","wholeArray","prevFocus","focusResult","widgetFocusResult","getDOMNodeForPath","interWidgetPath","getNode","getGrammarTypeForPath","getInputPaths","inputPaths","widgetInputPaths","inputPath","relativeInputPath","focusWidget","focusInputPath","blurWidget","blurInputPath","serialize","info","emptyWidgets","simpleValidate","cbResult","setInputValue","newValue","getUserInput","getWidgetIds","getAllWidgetIds","groupPrefix","getRenderer","getUserInputForWidgets","scoreWidgets","gradedWidgetIds","widgetScores","guessAndScore","examples","example","lintErrors","lastRenderedMarkdown","legacyPerseusLint","markdownContents","xs","sm","md","lg","xl","smOrSmaller","mdOrSmaller","lgOrSmaller","smOrLarger","mdOrLarger","lgOrLarger","mediaQueries","_mediaQueriesJs","perseusInteractive","aboveScratchpad","blankBackground","perseusSrOnly","border","responsiveLabel","responsiveInput","WebkitAppearance","appearance","boxShadow","boxSizing","flexShrink","circleSize","responsiveRadioInput","responsiveRadioInputActive","disableTextSelection","userSelect","_rendererJsx","_stylesMediaQueriesJs","HintRenderer","renderer","lastHint","lastRendered","totalHints","newHint","lastRenderedNewHint","rendererApiOptions","tabIndex","borderLeftColor","borderLeftStyle","borderLeftWidth","_hintRendererJsx","sharedStyles","_stylesSharedJs","HintsRenderer","_cacheHintImages","hintsVisible","_hintsVisible","_cacheImagesInHint","hintState","hintRenderer","showGetAnotherHint","hintRatioCopy","mobileHintStylesHintsRenderer","mobileHintStylesHintTitle","rel","linkButton","getAnotherHintButton","mobileHintStylesGetAnotherHintButton","evt","plusText","mobileHintStylesPlusText","getAnotherHintText","rendererMargins","borderWidth","shapes","_shapesJs","buildEmptyItemTreeForShape","buildEmptyItemForShape","treeToItem","findContentNodesInItem","itemTree","itemToTree","findHintNodesInItem","inferItemShape","inferItemTreeShape","_multi","get","monocle","newArr","newObj","dispatch","lens","ops","_wrapped","thaw","freeze","lensArr","_zoomStack","wrapped","deZoom","frame","shortLens","oldProps","_hubbleIndexJs","_hintsRendererJsx","MultiRenderer","Component","_handleSerializedStateUpdated","oldState","_getSerializedState","rendererDataTreeMapper","_makeContentRendererData","_makeHintRendererData","getRenderersMapper","makeRenderer","_annotateRendererArray","_tryMakeRendererState","rendererDataTree","_makeRendererDataTree","renderError","_getRendererProps","otherProps","refFunc","criterion","_findWidgets","handleSerializedState","callingData","results","_mapRenderers","leafMapper","_scoreFromRef","getScores","scores","combinedScore","lastSerializedState","countCallback","renderers","rendererDatas","hintRendererDatas","firstN","_getRenderers","_multiItemsShapesJs","buildPropTypeForShape","oneOfType","Keypad","components","ProvideKeypad","keypadStyle","_keypadContainer","onElementMounted","onDismiss","unmountComponentAtNode","_mixinsProvideKeypadJsx","ItemRenderer","questionHighlightedWidgets","isAnswerable","questionRenderer","_handleFocusChange","newFocus","oldFocus","_onRendererBlur","didFocusInput","activate","dismiss","_handleAPICall","functionName","functionArgs","caller","handleInteractWithWidget","withRemoved","getNumHints","scoreInput","maxCompatGuess","keScore","emptyQuestionAreaWidgets","qScore","qGuess","question","hintsRenderer","hintsContainer","controlPeripherals","hintsAreaSelector","initialHintsVisible","workAreaSelector","answerArea","calculator","periodicTable","zTable","tTable","chi2Table","savedState","toggle","onShowCalculator","onShowPeriodicTable","onShowZTable","onShowTTable","onShowChi2Table","showHint","checkAnswerButton","gridTemplateColumns","gridTemplateRows","checkAnswerText","gridArea","QuestionRenderer","onAnswer","onHint","answerState","isCorrect","checkAnswer","isOutOfHints","onSubmit","disabled","visibility","_perseusApiJsx2","ArticleRenderer","useNewStyles","newFocusPath","oldFocusPath","prevFocusPath","sectionRef","_sections","classes","sections","section","refForSection","key_","WIDGET_PROP_BLACKLIST","_widgetPropBlacklistJsx","EditorJsonify","USAGE","_changeMultiple","currProps","_changeSingle","propName","change","newPropsOrSinglePropName","propValue","Changeable","_mixinsChangeableJsx","_mixinsEditorJsonifyJsx","TextArea","changeValue","SimpleMarkdownTesterEditor","mdParse","mdOutput","SimpleMarkdownTester","toJSON","rubric","validate","ExampleWidgetEditor","handleAnswerChange","TextInput","ExampleWidget","WidgetJsonifyDeprecated","_mixinsWidgetJsonifyDeprecatedJsx","ExampleGraphieWidget","backgroundImage","markings","showProtractor","movePoint","_getGridConfig","gridConfig","_exampleGraphieWidgetJsx","ExampleGraphieWidgetEditor","handleChange","ReactComponentsInfoTip","_reactComponentsInfoTipJsx","InfoTip","didMount","_componentsInfoTipJsx","BlurInput","_reactComponentsBlurInputJsx","KA_VIDEO_URL","getSlugFromUrl","VideoEditor","_handleUrlChange","KA_EMBED","IS_URL","IS_KA_SITE","Video","currentHostname","embedHostname","sandbox","allowFullScreen","SignificantFigures","parseOrder","mantissa","parseMantissa","parseSign","sigFigs","sigDecs","displaySigFigs","scientific","decAdd","sigAdd","zeroScientific","returnVal","trailingZeros","wholePart","fractPart","needDot","zeros","beginning","seenDot","seenSomething","raised","leadZeros","decPlaces","totalDecs","digits","nextToLast","lastChar","roundUp","nextChar","NumberInput","placeholder","onFormatChange","checkValidity","useArrowKeys","_checkValidity","mini","small","_handleChange","_handleFocus","_handleBlur","onKeyPress","_onKeyDown","onTouchStart","defaultValue","getValue","_setValue","parseInputValue","getStringValue","isFinite","setSelectionRange","getSelectionStart","getSelectionEnd","_componentsNumberInputJsx","ALL","SOME","primUnits","UnitExample","icon","solvedExample","sigfigs","equality","sigfigPrint","UnitInputEditor","accepting","acceptingUnits","acceptingElem","unitsArr","handleAcceptingUnitsChange","handleSigfigChange","_checkSigfigValidity","groupId","_setAccepting","checked","_doOriginal","tryParse","getSaveWarnings","parseNextExpression","currentIndex","nextExpIndex","endpoint","bracketDepth","findEndpoint","walkTex","getNextFracIndex","nextFrac","nextDFrac","parsedString","firstParsedExpression","secondParsedExpression","parseTex","exp1","exp2","modifyTex","isNestedFraction","ModifyTex","_texWranglerJs","MathOutput","focused","selectorNamespace","_getInputClassName","_getDisplayValue","displayText","labelText","textAlign","_bindBlurHandler","_unbindBlurHandler","closest","_componentsMathOutputJsx","countSigfigs","OldUnitInput","createFactory","handleFocus","handleBlur","_errorTimeout","_showError","$error","_hideError","numericallyCorrect","kasCorrect","sigfigsCorrect","toPrecision","guessUnit","answerUnit","thisAnswerUnit","KeypadInput","KeypadTypes","_mathInput2","consts","_mathInput3","SimpleKeypadInput","configure","keypadType","FRACTION","defaultBackgroundImage","defaultInstructionsStyle","instructionsTextStyle","Graph","showRuler","rulerLabel","rulerTicks","instructions","onGraphieUpdated","imageData","_hasSetupGraphieThisUpdate","_shouldSetupGraphie","pointsFromNormalized","coordsList","noSnap","nSteps","numSteps","initialMount","$instructionsWrapper","$instructions","_updateProtractor","_updateRuler","_componentsGraphJsx","_componentsSimpleKeypadInputJsx","_utilJs3","kray","_kmath4","_kmath5","defaultTransformerProps","gradeEmpty","graphMode","listMode","tools","enabled","required","reflection","dilation","drawSolutionShape","starting","colorForTool","tool","stringFromDecimal","texFromPoint","orderInsensitiveCoordsEqual","coords1","coords2","coord1","coord2","inputComponentForApiOptions","TransformOps","Transformations","isValid","transformList","newTransform","_appendAndCollapseLastTwo","_collapseFinalNoOps","transforms","isNoOp","collapsed","collapse","transform1","transform2","_collapseValidMonotypedTransforms","toTeX","ListItem","mode","TransformClass","Input","_getComponentAtPath","verbName","nounName","lowerNounName","InputComponent","val0","val1","reflectOverLine","isNull","changePoint","dilationCenter","dilatePointFromCenter","scaleString","frac","DEFAULT_TOLERANCE","stringFromFraction","ShapeTypes","getPointCountForType","splitType","addMovableShape","editable","translatable","currentPoint","isMoving","previousCoord","normalPointStyle","highlightPointStyle","showPoints","moveVector","oldCoord","removeShapeWithoutPoints","addShape","types","_typesOf","typeOptions","defaultOptions","_mapTypes","shapeOptions","_addType","updateFuncs","removeFuncs","getOptions","pt","shape1","shape2","types1","types2","shapes1","_combine","shapes2","partialShape1","partialShape2","_forType","typeDefaultOptions","baseType","pointCount","currentPoints","perimeter","redrawPerim","coord0","points1","points2","line1_0","line1_2","line2_0","line2_2","equalUnflipped","equalFlipped","radius1","radius2","TransformationListItem","TransformationList","transformationList","_transformationRefs","changed","focusLast","transformationRefs","ToolButton","toggled","ToolsBar","selected","changeSelected","onUndoClick","removeTool","addTool","AddTransformBar","Transformer","setProps","defaultGraphProps","interactiveToolsMode","ToolsBarClass","toolsBar","handleUndoClick","setTransformationProps","shouldSetupGraphie","setTransformations","currentTool","addTransformerShape","resetCoords","applyTransform","addTransform","toolId","addTranslationTool","addRotationTool","addReflectionTool","addDilationTool","doTransform","normalizeReflectionCoords","messyCoords","origDirectionPolar","directionPolar","directionCoefficient","scaleToCurrentRange","reflectLine","updateReflectionTool","changeTool","reflectPoints","reflectButton","reflectRotateHandle","initRotateHandleAngle","rotateHandleApprox","rotateVector","flipped","spreadX","spreadY","scaleToRange","pointColor","getRotationTransformFromAngle","dilationCircle","newRadius","origOnMoveEnd","angleChanged","transformFunc","applyCoordTransformation","pointTransform","startCoords","newTransfomationList","changes","newTools","getCoords","getEditorJSON","_getTransformationForID","transformationID","refPath","innerPaths","fullPaths","innerPath","_passToInner","PropCheckBox","labelAlignment","localPropName","_labelAlignLeft","truth","RangeInput","newVal","ButtonGroup","_reactComponentsButtonGroupJsx","_componentsPropCheckBoxJsx","_componentsRangeInputJsx","GraphSettings","editableSettings","stateFromProps","changeGraph","labelsTextbox","gridStepTextbox","snapStepTextbox","stepTextbox","rangeTextbox","changeRulerLabel","changeRulerTicks","changeBackgroundUrl","setUrl","renderLabelChoices","choices","nameAndValue","validRange","validateStepValue","settings","minTicks","maxTicks","validSnapStep","validGridStep","validStep","validBackgroundImageSize","validateGraphSettings","msg","goodRange","goodStep","goodGridStep","goodSnapStep","goodImageSize","changeLabel","changeRange","changeStep","changeSnapStep","changeGridStep","validationResult","allowEmpty","buttons","_componentsGraphSettingsJsx","_transformerJsx","ToolSettings","allowFixed","changeConstraints","newConstraints","TransformationExplorerSettings","getMode","changeMode","changeHandlerFor","modes","toolName","TransformationsShapeEditor","getTypeString","changeType","updateCoords","TransformerEditor","changeStarting","changeTransformer","graphChanges","newGraph","startingChanges","newStarting","explorer","getInputPath","row","column","getRowFromPath","getColumnFromPath","getRefForPath","Table","blankAnswers","editableHeaders","rows","answers","_getRows","_getColumns","inputStyle","Editor","widgetEnabled","onHeaderChange","onValueChange","eventOrValue","inputID","inputComponent","filterNonEmpty","supplied","cell","createValidator","rowSolution","rowSupplied","cellSupplied","cellSolution","validator","_fillData","draftData","editorState","contentState","selection","newData","getCurrentContent","getSelection","getSelectionAfter","_createEmptySelection","block","SelectionState","createEmpty","_getBlocksForSelection","blocks","startKey","getStartKey","endKey","getEndKey","pastEndKey","getKeyAfter","blockKey","getBlockForKey","NEWLINE_REGEX","_canEditOffset","getLength","leftKey","getEntityAt","rightKey","Entity","mutability","_getSkippedOffset","contentBlock","startOffset","currOffset","regexStrategy","selectionFromMatch","getText","matchArr","findPattern","regExp","getBlockMap","anchorOffset","focusOffset","replaceSelection","entity","Modifier","replaceText","EditorState","deleteSelection","removeRange","getEntities","blockMap","BlockMapBuilder","createFromArray","getStartOffset","getEndOffset","entities","findEntityRanges","char","getEntity","findEntity","getBlocksAsArray","isBackward","insertText","rawText","sanitizer","textLines","charData","CharacterMetadata","contentBlocks","textLine","characterList","sanitizedObj","ContentBlock","genKey","List","fragment","replaceWithFragment","selectEnd","getCharacterList","snapSelectionOutsideEntities","prevSelection","anchorBlock","getAnchorKey","focusBlock","getFocusKey","getAnchorOffset","getFocusOffset","getIsBackward","focusDiff","isCollapsed","forceSelection","toggleDecoration","decoration","allSurrounded","decorated","undecorated","leftOffset","rightOffset","selectedStr","startsWith","area","_clearSurrounding","_surroundWithText","newEndOffset","newSelection","focusOFfset","DraftUtils","_draftUtilsJs","widgetRegExp","widgetPartsRegExp","widgetRegexForId","partialWidgetRegex","boldRegExp","italicsRegExp","boldItalicsRegExp","underlineRegExp","headerRegExp","entityStrategy","styledBlock","highlightedBlock","entityColorDecorator","strategy","boldDecorator","italicsDecorator","underlineDecorator","textDecoration","boldItalicsDecorator","headerDecorator","headerSize","decoratedText","decorator","CompositeDecorator","keyBindings","isCommandPressed","KeyBindingUtil","hasCommandModifier","getDefaultKeyBinding","PerseusEditor","initialWidgets","ContentState","createFromText","createWithContent","_insertWidgetsAsEntities","fontSizePercentage","lastContentUpdate","applyEntity","currentContent","_getDraftData","_getNextWidgetId","currWidgets","maxId","currId","_createInitialWidget","addWidget","_insertNewWidget","draftDataParams","newWidgets","_insertWidgetText","updateWidget","removeWidget","newDraftData","addTemplate","templateType","_addTemplate","currBlock","splitBlock","allTypes","template","_handleCopy","copiedWidgets","getData","localStorage","perseusLastCopiedWidgets","_createSafeWidgetMapping","currentWidgets","maxIds","idMap","safeMap","_handlePaste","pastedText","sourceWidgetsJSON","sourceWidgets","safeWidgetMapping","sanitized","syntax","fullText","newId","newText","entityChar","entityChars","_handleDrop","dataTransfer","endBlock","endSelection","getLink","_handleDroppedFiles","files","file","endOfBlockSelection","imageUploader","currEditor","currContent","placeholderLocation","_handleTab","partialName","matchingWidgets","replacementArea","_getDecorationForStyle","_handleKeyCommand","_updateParent","visibleWidgets","getPlainText","pastContentState","lastIdleCallback","onCopy","onCut","onDragStart","spellCheck","stripPastedStyles","handlePastedText","handleDroppedFiles","handleDrop","keyBindingFn","handleKeyCommand","onTab","KatexErrorView","showErrors","handleToggleKatexErrors","errorList","disclosureClass","errorContainer","errorExplanation","ReactCreateFragment","_reactAddonsCreateFragment","DragTarget","_reactComponentsDragTargetJsx","_katexErrorViewJsx","_perseusEditorJsx","_mixinsWidgetPropBlacklistJsx","rWidgetSplit","shortcutRegexp","ENDS_WITH_A_PARAGRAPH","TRAILING_NEWLINES","LEADING_NEWLINES","commafyInteger","WidgetSelect","orderedWidgetNames","WidgetEditor","showWidget","_upgradeWidgetInfo","filteredProps","_toggleWidget","_handleWidgetChange","newWidgetInfo","_toggleStatic","_handleAlignmentChange","newAlignment","Ed","isUngradedEnabled","gradedPropBox","issuesFunc","IMAGE_REGEX","immutableWidgets","showWordCount","warnNoPrompt","warnNoWidgets","showKatexErrors","getWidgetEditor","_handleWidgetEditorChange","_handleWidgetEditorRemove","_sizeImages","imageUrls","allMatches","newImageUrls","_maybeCopyWidgets","_maybePasteWidgets","sentinel","tap","fileAndSentinel","_handleKeyDown","_addWidgetToContent","selectedText","widgetNames","widgetData","perseusLastCopiedText","widgetJSON","lastCopiedText","textToBePasted","clipboardData","_safeWidgetNameMapping","safeWidgetData","entries","safeText","completeWidget","expectedCursorPosition","widgetTypes","existingWidgets","safeWidgetNums","existingWidget","widgetName","cursorRange","allWidgetIds","widgetNum","currentNum","otherId","otherType","otherNum","widgetContent","prelude","postlude","newlines","makeEndWithAParagraphIfNecessary","makeStartWithAParagraphAlways","_addWidget","focusAndMoveToEnd","issues","issue","pieces","underlayPieces","widgetsDropDown","templatesDropDown","widgetsAndTemplates","wordCountDisplay","katexErrorList","numChars","numWords","renderToString","duplicate","textareaWrapper","completeTextarea","onDrop","noPrompt","noWidgets","warningStyle","keepDeletedWidgets","_editorJsx","_tableJsx","TableEditor","numberOfColumns","tableProps","onSizeInput","numRawRows","numRawColumns","oldColumns","oldRows","fixColumnSizing","_componentsTextListEditorJsx","HORIZONTAL","SorterEditor","onLayoutChange","VERTICAL","STATIC","DRAGGING","ANIMATING","DISABLED","Placeholder","card","horizontalCard","Draggable","includePadding","startPosition","startMouse","isMouseMoveUpBound","unbindMouseMoveUp","getCurrentPosition","draggable","verticalCard","animating","unpaddedCard","onTouchMove","onTouchEnd","onTouchCancel","endPosition","complete","onAnimationEnd","finish","bindMouseMoveUp","Sortable","onMeasure","itemsFromProps","clearItemMeasurements","measureItems","option","$items","widths","heights","syncWidth","syncHeight","remeasureItems","cards","sortable","isLast","$draggable","$sortable","findWhere","newIndex","midWidth","cardWidth","sumWidth","midHeight","cardHeight","sumHeight","minHeight","listStyleType","_componentsSortableJsx","Sorter","marginPx","SimulatorEditor","xAxisLabel","yAxisLabel","numTrials","proportionLabel","proportionOrPercentage","handleTargetValueChange","Histogram","_getInitialThreshold","oldRange","nextRange","_renderThresholdLine","handleMouseInteraction","_renderCircle","numBelow","proportionBelow","formattedThreshold","plotBelowCircle","plotAboveCircle","plotLabel","_renderData","isBelow","bottomRight","xWidth","yWidth","ySkip","xSkip","topLeft","xMid","xOffset","yMid","yOffset","_getRangeForData","firstIndex","xMin","Simulator","invalidInput","userProportion","sampleSize","generateNumber","WebkitBoxShadow","MozBoxShadow","unhighlightStyle","proportionInput","calculateDisplayProportion","checkProportionValidity","handleUserProportionChange","sampleSizeInput","handleSampleSizeChange","numTrialsDisplay","startButton","handleRunSimulation","histogramStyle","histogram","generateTable","generateData","proportion","sampleDistribution","normalizedCount","getSampleDistribution","StepControlButton","SequenceEditor","_handleMoveStepLater","_handleMoveStepEarlier","confirm","_handleRemoveStep","_handleAddStepAfter","_handleEditorChange","newStep","Sequence","_handleInteraction","groupWidgetId","oldJson","rendererOptions","_componentsTextInputJsx","ReactionDiagramWidgetEditor","smiles","rotationAngle","separators","topText","bottomText","updateMolecule","newSmiles","updateRotation","newRot","updateSeparators","newSep","sep","smilesRe","atomRe","_mset","keylist","k0","sliceFromMatchingCloseParen","parenStack","firstChar","parseParenthesizedExpression","ctx","newCtx","acc","elt","_inc","inBranchIdx","parenExpr","parseAtom","symbolInfo","_ctx","sym","closingIdx","readAtomSymbol","atom","restOfMolecule","atomObj","bonds","bond","bondType","bondModifiers","isModifierChar","parseBondModifier","atomLayout","atoms","textValue","baseAngle","prevPositionedAtom","connections","myIndex","baseAngleIncrement","angleIncrement","idxPath","lastAtomIdx","polarAdd","bondLayout","startAndEndPos","fromAtom","toAtom","fromPos","toPos","maybeShrinkLines","idxString","convertTree","treeIdx","toIdx","atomLayoutHelper","outputs","atomProcessingQueue","queuedAtomIdx","bondLayoutHelper","converted","_atomLayout","_bondLayout","_bondLength","_convertTree","drawLine","Path2D","lineWidth","strokeStyle","fgColor","lineTo","drawingFuncs","fillStyle","fillText","fontSizePx","bgColor","ordering","compareElements","item0","item1","drawItem","_moleculeMoleculeDrawingJsx","SmilesParser","_moleculeSmilesParserJsx","Molecule","parsedSmiles","stateFromSmiles","canvasRender","setCanvasBounds","xmax","ymax","getContext","clearRect","save","restore","MoleculeWidget","molecule","_moleculeJsx","Separator","drawArrow","arrowLength","lineCap","ReactionDiagramWidget","BAR","LINE","PIC","HISTOGRAM","DOTPLOT","Plotter","categories","scaleY","maxY","snapsPerLine","picSize","picBoxHeight","picUrl","plotDimensions","labelInterval","DOT_PLOT_POINT_SIZE","DOT_PLOT_POINT_PADDING","DOT_TICK_POINT_SIZE","pics","dotTicks","isBar","isLine","isPic","isHistogram","isDotplot","isTiledPlot","config","bars","dividers","dimX","barPad","barWidth","picBoxWidthPx","picPadAllWidth","picPad","picFullWidth","picBoxWidth","dimY","padX","padY","dragPrompt","setupCategories","dotPrompt","drawPicHeights","horizHairline","hairlineRange","labelCategory","category","isTeX","mathyCategory","setupBar","startHeight","setupLine","setupPic","setupDotplot","tickStart","tickEnd","_clampValue","_maybeShowDragPrompt","_maybeHideDragPrompt","barHalfWidth","scaleBar","leftDivider","rightDivider","divHeight","changeAndTrack","setupTiledPlot","bottomMargin","createImage","midY","leftX","topY","mouseRect","whichPicClicked","setPicHeight","yCoord","adjustedCoord","newTopY","prevValues","shouldDisplay","ps","pic","wasShown","_plotterJsx","padArray","copy","editorDefaults","formatNumber","PlotterEditor","editing","loadedUrl","minX","maxX","fetchPic","setFromScale","canChangeSnaps","axis","handleChangeTickStep","handleChangeRange","setCategoriesFromScale","changeLabelInterval","changePicUrl","changeCategories","changeScale","changeMax","changeSnaps","changeEditing","handlePlotterChange","oldScale","newScale","PassageRefTargetEditor","handleContentChange","PassageRefTarget","PassageRefEditor","passageNumber","referenceNumber","summaryText","PassageRef","lineRange","lineRangeOutput","summaryOutput","lineNumber","summaryTree","_deferredUpdateRange","_throttledUpdateRange","throttle","_updateRange","passage","refInfo","getReference","startLine","endLine","PassageEditor","passageTitle","passageText","footnotes","showLineNumbers","passageEditor","footnotesEditor","START_REF_PREFIX","END_REF_PREFIX","REF_STYLE","LABEL_OUTER_STYLE","SQUARE_LABEL_STYLE","WebkitUserSelect","CIRCLE_LABEL_STYLE","RefStart","getRefContent","refContent","RefEnd","newline","passageFootnote","lastFootnote","footnote","refStart","closeIndex","refNestingLevel","refText","useRefs","lastRef","currentRef","INITIAL_PARSE_STATE","refEnd","squareLabel","firstQuestionRef","space","circleLabel","squareBracketRef","firstSentenceRef","reviewHighlight","_rulesForTesting","compareRangeBoundaryPoints","whichA","whichB","Range","START_TO_START","END_TO_START","START_TO_END","END_TO_END","compareBoundaryPoints","spanRanges","cloneRange","setEnd","endContainer","endOffset","rangesOverlap","rangeIncludes","intersectRanges","unionRanges","findBoundaryWordIndex","selectionRange","wordRanges","goal","initialLowerBound","initialUpperBound","bestValidWordIndex","lowerBound","upperBound","iterationCount","mid","findFirstAndLastWordIndexes","firstWordIndex","lastWordIndex","addHighlight","existingHighlights","newHighlight","newHighlights","mergedDomRange","domRange","mergedFirstWordIndex","mergedLastWordIndex","newMergedDomRange","newMergedHighlight","newKey","existingKeys","createNewUniqueKey","buildHighlight","newHighlightRange","indexes","deserializeHighlight","serializedHighlight","firstWord","lastWord","serializeHighlight","WordIndexer","PureComponent","_sendWordsUpdate","onWordsUpdate","_getWordRanges","_container","treeWalker","ownerDocument","createTreeWalker","NodeFilter","SHOW_TEXT","SHOW_ELEMENT","FILTER_ACCEPT","trailingWordRange","nextNode","nodeType","Node","ELEMENT_NODE","TEXT_NODE","nodeValue","wordPattern","wordMatch","newTrailingWordRange","createRange","setStart","SelectionTracker","mouseState","trackedSelection","_handleSelectionChange","_updateTrackedSelection","_handleMouseDown","_handleMouseUp","_updateListeners","wasListening","willListen","_computeFocusAndRange","rangeCount","getRangeAt","focusNode","_computeTrackedSelection","focusAndRange","proposedHighlight","userIsMouseSelecting","getRelativePosition","getRelativeRect","getClientRectsForTextInRange","mutableRects","addClientRectsForTextInNodeAndRange","commonAncestorContainer","nodeContentsRange","selectNodeContents","intersectedRange","textNode","textRange","parentElement","computedStyle","parsedLineHeight","boundingRects","getClientRects","boundingRect","heightIncrease","addClientRectsForText","childNodes","HighlightTooltip","_getPosition","offsetParent","focusRange","focusRect","onMouseEnter","onMouseLeave","HighlightRenderer","cachedHighlightRects","_computeRects","tooltipIsHovered","clientRects","offsetParentRect","_rectIsHovered","mouseOffsetPosition","positionWithinRect","isHovered","mouseClientPosition","rects","highlightRect","zIndexes","belowContent","_highlightRendererJsx","_highlightTooltipJsx","HighlightSetRenderer","hoveringTooltipFor","_highlightRenderers","_handleMouseMove","_updateEditListeners","highlights","_getHoveredHighlightKey","highlightRenderer","_renderTooltip","hoveredHighlightKey","hoveredHighlight","aboveContent","onRemoveHighlight","highlightKey","_highlightSetRendererJsx","_selectionTrackerJsx","HighlightingUI","_handleAddHighlight","highlightToAdd","onAddHighlight","collapseToEnd","_selectionIsValid","contentNode","contentRange","_uiHighlightingUiJsx","_wordIndexerJsx","HighlightableContent","newDomHighlights","_getDOMHighlights","newSerializedHighlights","onSerializedHighlightsUpdate","_handleRemoveHighlight","keyToRemove","serializedHighlights","_handleWordsUpdate","_buildHighlight","highlightRange","domHighlights","_content","_componentsHighlightingHighlightableContentJsx","PassageMarkdown","_passagePassageMarkdownJsx","LineHeightMeasurer","measureLineHeight","_cachedLineHeight","forceMeasureLineHeight","$body","$end","measurer","Passage","nLines","startLineNumbersAfter","stylesAreApplied","_handleSerializedHighlightsUpdate","_updateState","_onResize","_lineHeightMeasurer","_measureLines","_getInitialLineNumber","contentsHeight","_getLineHeight","isPassageBeforeThisPassage","passageWidget","getLineCount","_getStartRefLineNumber","refRef","$ref","$refText","vPos","_convertPosToLineNumber","_getEndRefLineNumber","absoluteVPos","relativeVPos","_getRefContent","refStartLine","refEndLine","_renderInstructions","parseState","firstQuestionNumber","questionSymbol","questionNumber","sentenceSymbol","parsedInstructions","_renderContent","_hasFootnotes","rawContent","_renderFootnotes","lineNumbers","lineN","parsedContent","hasTitle","NORMAL","OrdererEditor","correctOptions","otherOptions","onOptionsChange","onHeightChange","whichOptions","PlaceholderCard","DragHintCard","Card","floating","rendererProps","fakeRef","mouseMoveUpBound","Orderer","placeholderIndex","dragContent","offsetPos","grabPos","mousePos","dragWidth","onRelease","dragKey","sortableCards","opt","dragHeight","anySortableCards","bank","inCardBank","isCardInBank","newCard","finalOffset","findCorrectIndex","isHorizontal","$dragList","dragList","leftEdge","topEdge","outerWidth","outerHeight","$bank","draggableOffset","bankOffset","draggableHeight","bankHeight","bankWidth","draggableWidth","NumberLineEditor","labelRange","labelTicks","divisionRange","numDivisions","snapDivisions","correctRel","correctX","initialX","onRangeChange","onLabelRangeChange","onDivisionRangeChange","gt","lt","onNumChange","opts","onNumDivisionsChange","divRange","onTickStepChange","onChangeRelation","onLabelStyleChange","isTickCtrl","reverseRel","ge","le","toggleStrictRel","formatImproper","formatMixed","_label","formatNonReduced","TickMarks","leftLabel","rightLabel","fractions","denoms","NumberLine","numLinePosition","numDivisionsEmpty","newNumLinePosition","snapNumLinePosition","_handleTickCtrlFocus","_handleTickCtrlBlur","_renderGraphie","numberLinePoint","_renderInequality","_renderNumberLinePoint","isOpen","mobileDotStyle","handleReverse","newRel","handleToggleStrict","_getInequalityEndpoint","isGreater","buffer","widthInPixels","tickCtrl","divRangeString","invalidNumDivisions","inequalityControls","startRel","correctPos","outsideAllowedRange","isTickCrtl","MoleculeWidgetEditor","defaultImage","MeasurerEditor","rulerPixels","rulerLength","_changeUrl","_changeTop","_changeLeft","_changeImage","newTop","newLeft","subProp","Measurer","protractorX","protractorY","v0props","imageTop","imageLeft","MatcherEditor","orderMatters","onLabelChange","Matcher","leftHeight","rightHeight","rng","showLabels","cellMarginPx","columnLabel","columnRight","onMeasureLeft","onMeasureRight","STATIC_INPUT_DIMENSIONS","INPUT_MARGIN","INPUT_HEIGHT","INPUT_WIDTH","NORMAL_DIMENSIONS","KEYPAD_INPUT_DIMENSIONS","getDefaultPath","getMatrixSize","matrix","matrixSize","matrixRow","rowWidth","matrixCol","col","Matrix","matrixBoardSize","cursorPosition","enterTheMatrix","maxRows","maxCols","cursorRow","cursorCol","highlightedRow","highlightedCol","bracketHeight","bracketOffset","rowVals","outside","inputProps","handleKeyDown","MatrixInput","scrollable","numericInput","maxRow","maxCol","curInput","curValueString","cursorStartPosition","cursorEndPosition","nextPath","valueLength","solutionSize","suppliedSize","incorrectSize","hasEmptyCell","incorrect","_matrixJsx","MatrixEditor","matrixProps","onMatrixBoardSizeChange","TABLE_STYLE","tableLayout","ROW_STYLE","CELL_STYLE","BASE_TILE_STYLE","PATTERNS","plus","iter","clampToInt","Tile","_flip","TileGrid","LightsPuzzleEditor","startCells","flipPattern","gradeIncompleteAsWrong","_height","_width","_changeWidth","_changeHeight","_handlePatternChange","_switchTile","newWidth","_truncateCells","newHeight","newCells","tileY","tileX","oldCells","MOVE_COUNT_STYLE","RESET_BUTTON_STYLE","flipTilesPattern","flipTilesPredicate","offsetY","offsetX","LightsPuzzle","moveCount","pxWidth","_flipTile","_reset","_initNextPatterns","_currPattern","_nextPattern","_patternIndex","_shiftPatterns","UNLIMITED","ccw","collinear","defaultVal","actual","pointInRect","intersects","ab","triplets","orientations","triplet","sideLengths","angleMeasures","offsets","raw","similar","angles1","angles2","sides1","sides2","angles","sides","sidePairs","congruentEnough","leq","canonicalSineCoefficients","coeffs","amplitude","angularFrequency","phase","verticalOffset","period","capitalize","letter","getLineEquation","second","InteractiveGraph","shouldShowInstructions","_getShouldShowInstructions","showGraph","isClickToAddPoints","oldType","newType","allowReflexAngles","angleOffsetDeg","numPoints","numSides","numSegments","showAngles","showSides","shouldResetGraphie","resetGraphie","typeSelect","flexibleType","toggleShowAngles","toggleShowSides","handleAddPointsMouseDown","setGraphie","newGraphie","isCoordInTrash","createPointForPointsType","updateCoordsFromPoints","createPointForPolygonType","updatePolygon","setTrashCanVisibility","vertHairline","trashCan","_lineStroke","addLine","getLineCoords","lineConfig","removeLine","addLinearControls","removeLinearControls","addQuadraticControls","pointB","pointC","defaultQuadraticCoords","onMoveHandler","updateQuadratic","getCurrentQuadraticCoefficients","removeQuadraticControls","addSinusoidControls","defaultSinusoidCoords","updateSinusoid","getCurrentSinusoidCoefficients","removeSinusoidControls","addCircleControls","minSnap","removeCircleControls","addLinearSystemControls","getLinearSystemCoords","segmentColors","segmentCoords","segmentIndex","segmentPoints","removeLinearSystemControls","screenPoint","removePoint","snapToGrid","clearCoords","getAngle","innerAngles","knownSide","onLeft","side","outerAngle","innerAngle","pointToRemove","isInitialMove","addPointControls","getPointCoords","removePointControls","addSegmentControls","getSegmentCoords","createPoint","updateCoordProps","removeSegmentControls","addRayControls","removeRayControls","addPolygonControls","getPolygonCoords","removePolygonControls","addAngleControls","getAngleCoords","removeAngleControls","getQuadraticCoefficients","getSinusoidCoefficients","normalizeCoords","ys","getEquationString","funcName","getLinearEquationString","getQuadraticEquationString","getSinusoidEquationString","getCircleEquationString","getLinearSystemEquationString","firstPoints","secondPoints","x4","y4","determinant","getLineIntersection","getPointEquationString","getSegmentEquationString","getRayEquationString","getPolygonEquationString","getAngleEquationString","hasValue","guessCoeffs","correctCoeffs","canonicalGuessCoeffs","canonicalCorrectCoeffs","POSITIVE_INFINITY","_interactiveGraphJsx","InteractiveGraphEditor","equationString","graphProps","changeMatchType","prettyBig","slightlyBig","symbStyle","convertDotToTimes","typedText","cmd","buttonSets","prealgebra","keystroke","logarithms","buttonSetsType","TexButtons","buttonPopup","sets","setName","symbGen","onInsert","_texButtonsJsx","MathInput","_shouldShowButtons","insert","handleMouseDown","mouseDown","handleMouseUp","buttonsVisible","mathField","getInterface","MathField","mathinput","initialized","autoCommands","charsThatBreakOutOfSupSub","supSubsRequireOperand","spaceBehavesLikeTab","handlers","edited","__controller","ctrlSeq","backspace","enter","submit","upOutOf","ElementContainer","initiallyVisible","onUp","onDown","onDelete","DashPicker","_componentsMathInputJsx","ConstraintEditor","constraintFn","constraintXMin","constraintXMax","constraintYMin","constraintYMax","COLORS","LIGHT_COLORS","ColorPicker","lightColors","ArrowPicker","_interactionArrowPickerJsx","_interactionColorPickerJsx","_interactionConstraintEditorJsx","_interactionDashPickerJsx","_interactionElementContainerJsx","defaultInteractionProps","PointEditor","LineEditor","endX","endY","strokeDasharray","MovablePointEditor","varSubscript","MovableLineEditor","startSubscript","endSubscript","FunctionEditor","rangeMin","rangeMax","ParametricEditor","LabelEditor","RectangleEditor","InteractionEditor","usedVarSubscripts","_getAllVarSubscripts","usedFunctionNames","_getAllFunctionNames","where","_updateGraphProps","_addNewElement","elementType","nextSubscript","newElement","nextLetter","fromCharCode","charCodeAt","_deleteElement","_moveElementUp","newElements","_moveElementDown","KAShashFunc","decimal_separatpr","functionsLength","_parseCache","KASparse","cached","_compileCache","KAScompile","Interaction","variables","_getInitialVariables","_getInitialFunctions","startXExpr","startYExpr","endXExpr","endYExpr","_updatePointLocation","_updateLineLocation","xDiff","_eval","yDiff","compiledVars","_extractVars","foo_x","foo_y","foo_z","varValues","foo_fn","foo_varvalues","plotPoints","foo_fnx","foo_fny","defaultRange","INTERNALLY_HOSTED_URL_RE","captionAlignments","ImageEditor","onUrlChange","backgroundImageError","imageSettings","backgroundImageErrorText","_renderRowForLabel","onCoordinateChange","onContentChange","onAlignmentChange","removeLabel","labelIndex","newCoordinates","_leadingUrl","newRange","ImageWidget","titleAndCaption","bgImage","PairEditor","PairsEditor","handlePairChange","pairIndex","lastPair","IframeEditor","allowTopNavigation","handleSettingsChange","Iframe","handleMessageEvent","isUndefined","testsPassed","sandboxProperties","GroupEditor","metadata","_renderMetadataEditor","forceUpdate","problemNumComponent","isInvalid","getAcceptableFormatsForInputPath","GradedGroupEditor","handleAddHint","handleRemoveHint","hintsTitle","_gradedGroupEditorJsx","GradedGroupSetEditor","gradedGroups","_editors","renderGroups","setArrayItem","addGroup","groups","ANSWER_BAR_STATES","HIDDEN","ACTIVE","INACTIVE","GradedGroupAnswerBar","answerBarState","onCheckAnswer","onNextQuestion","answerBarStyle","answerBar","buttonStyle","textStyle","tryAgainIcon","buttonLabel","flexDirection","_gradedGroupAnswerBarJsx","GRADING_STATUSES","getNextState","currentState","answerable","INVALID_MESSAGE_PREFIX","GradedGroup","hasHint","_onInteractWithWidget","_checkAnswer","mobileClass","inGradedGroupSet","gradedGroupInSet","gradedGroup","explanationTitle","showHintLink","textTransform","letterSpacing","_gradedGroupJsx","Indicators","numGroups","currentGroup","selectedIndicator","onChangeCurrentGroup","indicatorContainer","GradedGroupSet","_childGroup","handleNextQuestion","comp","DEFAULT_BACKGROUND_IMAGE","canonicalTangentCoefficients","PlotDefaults","areEqual","coeffs1","coeffs2","getPropsForCoeffs","getFunctionForCoeffs","Linear","defaultCoords","getCoefficients","Quadratic","Tangent","Exponential","defaultAsymptote","extraCoordConstraint","asymptote","extraAsymptoteConstraint","oldY","bottomMost","topMost","allowReflectOverAsymptote","Logarithm","oldX","flip","inverseCoeffs","AbsoluteValue","horizontalOffset","functionTypeMapping","quadratic","tangent","exponential","logarithm","absolute_value","functionForType","GrapherUtil","grader","unsnappedPoint","currRange","currStep","maybePointsFromNormalized","defaultPlotProps","model","chooseType","getGridAndSnapSteps","DEFAULT_GRAPHER_PROPS","typeToButton","capitalized","availableTypes","typeSelectorStyle","FunctionGrapher","_coords","defaultModelCoords","_asymptote","otherCoord","extraConstraint","proposedCoords","CCW","imageDescription","renderPlot","renderAsymptote","functionProps","dashed","newAsymptote","proposedAsymptote","Grapher","typeSelector","handleActiveTypeChange","grapherProps","handlePlotChanges","newPlot","_calculateMobileTickStep","hairlineStyle","propTransform","MultiButtonGroup","_reactComponentsMultiButtonGroupJsx","_grapherJsx","GrapherEditor","handleAvailableTypesChange","newAvailableTypes","DefinitionEditor","togglePrompt","definition","Definition","belowScreen","contentOffsetLeft","contentOffsetLeftMobile","contentWidth","contentWidthMobile","contentMarginTop","arrowHeight","shouldClose","_definitionBelowScreen","windowBottom","_checkDefinitionPosition","_positionContentHorizontally","_positionContentVertically","_onClick","definitionWidgets","_onMouseOver","_onMouseOut","documentWidth","marginWidth","linkAnchor","mobileDefinitionLink","definitionLink","expandedStyle","contentExpandedMobile","contentExpanded","arrowTransform","linkContainer","disclosureArrow","dropShadowXOffset","dropShadowYOffset","dropShadowRadius","slope","dropShadowOpacity","arrowWidth","contentMobile","styleConstants","defaultExplanationProps","showPrompt","hidePrompt","explanation","ExplanationEditor","Explanation","mobileExplanationLink","explanationLink","DropdownEditor","dropdownGroupName","onPlaceholderChange","choice","checkedClass","onCorrectChange","removeChoice","addChoice","choiceIndex","Dropdown","selectClasses","_handleChangeEvent","dropdown","KA_PROGRAM_URL","CSProgramEditor","programID","showEditor","showButtons","_handleProgramIDChange","_handleSettingsChange","programUrl","isolateProgramID","getJSON","programInfo","fail","jqxhr","textStatus","KA_EMBED_URL","CSProgram","getUrlFromProgramID","sandboxOptions","Categorizer","indexedItems","randomizeItems","indexedItem","itemNum","catNum","responsiveCell","responsiveSpan","radioSpan","checkedRadioSpan","staticCheckedRadioSpan","extraClassNames","inlineStyles","fullBleedContainer","completed","allCorrect","_categorizerJsx","CategorizerEditor","cat","LikertFaces","borderColor","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","selectedChoice","LikertChoice","isSelected","_handleSelect","onSelect","LikertScale","_handleChoice","LikertScaleInfo","LikertScaleEditor","_changeLabel","newLabel","labelInput","allWidgets","_widgetsCategorizerJsx","_widgetsCategorizerEditorJsx","_widgetsCsProgramJsx","_widgetsCsProgramEditorJsx","_widgetsDropdownJsx","_widgetsDropdownEditorJsx","_widgetsExplanationJsx","_widgetsExplanationEditorJsx","_widgetsDefinitionJsx","_widgetsDefinitionEditorJsx","_widgetsGrapherJsx","_widgetsGrapherEditorJsx","_widgetsGradedGroupJsx","_widgetsGradedGroupEditorJsx","_widgetsGradedGroupSetJsx","_widgetsGradedGroupSetEditorJsx","_widgetsGroupJsx","_widgetsGroupEditorJsx","_widgetsIframeJsx","_widgetsIframeEditorJsx","_widgetsImageJsx","_widgetsImageEditorJsx","_widgetsInteractionJsx","_widgetsInteractionEditorJsx","_widgetsInteractiveGraphJsx","_widgetsInteractiveGraphEditorJsx","_widgetsLightsPuzzleJsx","_widgetsLightsPuzzleEditorJsx","_widgetsMatrixJsx","_widgetsMatrixEditorJsx","_widgetsMatcherJsx","_widgetsMatcherEditorJsx","_widgetsMeasurerJsx","_widgetsMeasurerEditorJsx","_widgetsMoleculeJsx","_widgetsMoleculeEditorJsx","_widgetsNumberLineJsx","_widgetsNumberLineEditorJsx","_widgetsOrdererJsx","_widgetsOrdererEditorJsx","_widgetsPassageJsx","_widgetsPassageEditorJsx","_widgetsPassageRefJsx","_widgetsPassageRefEditorJsx","_widgetsPassageRefTargetJsx","_widgetsPassageRefTargetEditorJsx","_widgetsPlotterJsx","_widgetsPlotterEditorJsx","_widgetsReactionDiagramJsx","_widgetsReactionDiagramEditorJsx","_widgetsSequenceJsx","_widgetsSequenceEditorJsx","_widgetsSimulatorJsx","_widgetsSimulatorEditorJsx","_widgetsSorterJsx","_widgetsSorterEditorJsx","_widgetsTableJsx","_widgetsTableEditorJsx","_widgetsTransformerJsx","_widgetsTransformerEditorJsx","_widgetsUnitJsx","_widgetsUnitEditorJsx","_widgetsVideoJsx","_widgetsVideoEditorJsx","skipMathJax","widgetsDeferred","mathJaxDeferred","Config","messageStyle","skipStartupTypeset","availableFonts","imageFont","showMathMenu","Configured","Tooltip","_reactComponentsTooltipJsx","_mathInputJsx","_textInputJsx","MATH","TEXT","TEX","InputWithExamples","shouldShowExamples","showExamples","_getUniqueId","btoa","_getPropsForInputType","buttonSet","autoCapitalize","autoComplete","autoCorrect","_getComponentForInputType","_renderInput","examplesContent","horizontalPosition","horizontalAlign","verticalPosition","arrowSize","_perseusApiJsx3","_componentsInputWithExamplesJsx","keypadConfigurationPropType","ERROR_MESSAGE","insertBraces","Expression","showErrorTooltip","showErrorText","keypadConfiguration","errorTooltip","errorTimeout","matchingAnswer","allEmpty","foundMatch","answerForms","considered","keypadConfigurationForProps","EXPRESSION","uniqueExtraVariables","uniqueExtraConstants","answerForm","maybeExpr","isGreek","toKey","constant","extraVariables","extraConstants","extraKeys","SortableArea","_reactComponentsSortableJsx","_componentsTexButtonsJsx","_expressionJsx","CONSIDERED","_makeNewKey","usedKeys","ExpressionEditor","isTex","answerOptions","expressionProps","updateForm","handleRemoveForm","AnswerOption","onReorder","handleReorder","buttonSetChoices","isFirst","handleButtonSet","handleToggleDiv","handleFunctions","handleTexInsert","newAnswer","formSerializables","serializables","_newEmptyAnswerForm","changingName","keep","deleteFocused","handleDeleteBlur","removeButton","handleImSure","handleDelete","toggleConsidered","findNextIn","answerFormButtons","initAnswer","strict","NumericInputEditor","multipleNumberInput","lastStatus","showOptions","unsimplifiedAnswers","updateAnswer","suggestedAnswerTypes","inputSize","coefficientCheck","addAnswerButton","addAnswer","onSpace","wrong","ungraded","multInputOption","onMultipleInputChange","onStatusChange","onTrashAnswer","onToggleOptions","generateInputAnswerEditors","statuses","newStatus","lastAnswer","PossibleAnswers","answerComponents","ParseTex","_componentsPossibleAnswersJsx","formExamples","NumericInput","currentMultipleValues","numSolutions","previousValues","getAnswerBlurb","answerBlurb","correctAnswers","answerStrings","answerString","getClasses","handleNumSolutionsChange","addInput","addInputButton","_addInput","numberInputContainer","removeInputButton","_removeInput","handleMultipleInputChange","numberInput","_getInputType","multiple","multInput","noFormsAccepted","allFormsAccepted","allAnswerForms","sortedInputs","localValue","otherAnswers","unionAnswerForms","answerFormsList","iteratee","allForms","uniqueForms","uniqueList","answerTypes","InputNumberEditor","answerType","answerTypeOptions","InputNumber","OptionStatus","FocusRing","ring","borderStyle","_focusRingJsx","SATChoiceIcon","constructStyles","a11yText","satCircle","LibraryChoiceIcon","getChoiceInner","showCorrectness","getDynamicStyles","pressed","primaryProductColor","bg","libraryCircle","libraryCircleCorrect","libraryCircleIncorrect","libraryCircleIncorrectSelected","ChoiceIcon","getLetter","product","ToggleableRadioButton","onChecked","handleKeyUp","inputRef","onKeyUp","_toggleableRadioButtonJsx","_choiceIconJsx","_optionStatusJsx","focusedStyleMixin","intermediateCheckboxPadding","intermediateCheckboxPaddingPhone","Choice","description","satDescription","satDescriptionInputFocused","satDescriptionInputActive","satDescriptionCorrect","satDescriptionCorrectChecked","satDescriptionIncorrectChecked","satReviewInput","satRadioOptionContent","satReviewRadioOptionContent","satCheckboxOptionContent","choiceIconWrapper","optionStatusContainer","rationale","nonSatRationale","satReviewRationale","satLabel","intermediateResponsiveCheckbox","intermediateResponsiveCheckboxReview","crossOutLink","alignSelf","classSet","editMode","showRationale","isInputFocused","isInputActive","onInputFocus","onInputBlur","onInputMouseDown","justFinishedTouch","onInputMouseUp","onInputMouseOut","renderOptionStatus","renderChoiceIcon","_toggleCrossOut","crossedOut","_sendChange","sat","finalStyles","commonInputProps","groupName","willBeChecked","isLastChoice","satCorrectChoice","satIncorrectChecked","descriptionClassName","satDescriptionLastChoice","checkboxContentClassName","checkboxAndOptionClassName","rationaleClassName","LabelOrDiv","showCrossOut","showDimmed","htmlFor","_choiceJsx","ChoiceNoneAbove","showContent","choiceProps","BaseRadio","instructionsMobile","radio","responsiveRadioContainer","radioContainerFirstHighlighted","radioContainerLastHighlighted","satRadio","satRadioOption","satRadioOptionCorrect","borderBottomColor","borderTopColor","satRadioOptionIncorrect","satRadioOptionNextCorrect","satRadioOptionNextIncorrect","satReviewRadioOption","inlineItem","responsiveItem","selectedItem","aboveBackdrop","aboveBackdropMobile","nextHighlighted","responsiveContainer","responsiveFieldset","radioGroupName","updateChoice","newCheckedList","multipleSelect","newCrossedOutList","getInstructionsText","countChoices","numCorrect","deselectEnabled","inputType","firstChoiceHighlighted","highlighted","lastChoiceHighlighted","instructionsClassName","responsiveClassName","fieldset","elementProps","hasRationale","isNoneOfTheAbove","revealNoneOfTheAbove","nextChoice","nextChoiceHighlighted","aphroditeClassName","satShowCorrectness","satShowCorrectnessNext","listElem","clickHandler","labelWrap","_baseRadioJsx","ChoiceEditor","clueEditor","clue","onClueChange","deleteLink","showDelete","RadioEditor","displayCount","randomize","hasNoneOfTheAbove","onMultipleSelectChange","onCountChoicesChange","allowMultiple","newClue","deleted","noneOfTheAbove","newChoice","addIndex","setDisplayCount","_passageRefJsx","Radio","_renderRenderer","nextPassageRefId","modContent","passageNum","refNum","baseRadio","updateChoices","newValueLists","choiceStates","newChoiceStates","rationaleShown","correctnessShown","choiceState","noneOfTheAboveIndex","noneOfTheAboveSelected","choicesSelected","originalIndex","enforceOrdering","widgetCorrect","newStates","reviewChoice","numSelected","_radioWidgetJsx","Boolean","newChoices","_addNoneOfAbove","_choiceTransform","correctAnswer","selectedChoices","noneChoice","_widgetsRadioEditorJsx","_widgetsInputNumberJsx","_widgetsInputNumberEditorJsx","_widgetsNumericInputJsx","_widgetsNumericInputEditorJsx","_widgetsExpressionJsx","_widgetsExpressionEditorJsx","basicWidgets","_basicWidgetsJs","extraWidgets","_extraWidgetsJs","_versionJson","apiVersion","itemDataVersion","_initJs","_articleRendererJsx","_questionRendererJsx","_itemRendererJsx","ServerItemRenderer","_serverItemRendererJsx","MultiItems","_multiItemsJs","UNCHANGED","CHANGED","ADDED","REMOVED","performDiff","before","after","beforeKeys","afterKeys","objectEntry","valueEntry","_widgetDiffPerformerJsx","indentationFromDepth","depth","BEFORE","AFTER","DiffSide","showKey","propKey","CollapsedRow","DiffEntry","entry","propertyDeleted","propertyAdded","propertyChanged","hasChildren","leftClass","rightClass","shownChildren","select","ImageWidgetDiff","beforeSrc","afterSrc","WidgetDiff","JsDiff","clonePath","newPos","removeEmpty","ret","escapeHTML","Diff","ignoreWhitespace","oldString","newString","tokenize","newLen","oldLen","maxEditLength","bestPath","oldPos","extractCommon","editLength","diagonalPath","basePath","addPath","removePath","canAdd","canRemove","pushComponent","reWhitespace","CharDiff","WordDiff","WordWithSpaceDiff","CssDiff","LineDiff","retLines","lastLine","diffChars","oldStr","newStr","diffWords","diffWordsWithSpace","diffLines","diffCss","createPatch","fileName","oldHeader","newHeader","contextLines","eofNL","curRange","isLastOfType","oldRangeStart","newRangeStart","oldLine","newLine","contextSize","applyPatch","uniDiff","diffstr","remEOFNL","addEOFNL","meh","oldlength","oldlines","newlength","convertChangesToXML","convertChangesToDMP","jsdiff","_libJsdiff","statusFor","chunk","splitUpChunk","ArrayDiff","flattenChunks","chunks","mapcat","lst","diffResult","diffEntries","currentLine","newEntry","splitDiff","_splitDiffJsx","stringArrayDiff","_stringArrayDiffJsx","imagesInString","classFor","ifAdded","ifRemoved","ImageDiffSide","TextDiff","handleExpand","diffed","beforeImages","afterImages","renderedLines","lineNum","lineClass","_textDiffJsx","_widgetDiffJsx","filterWidgetInfo","filteredWidgetInfo","RendererDiff","showSeparator","textDiff","widgetsDiff","beforeWidgets","afterWidgets","_rendererDiffJsx","ArticleDiff","_stateFromProps","sectionCount","_diffsArticleDiffJsx","ArticleDiffDemo","swapped","swap","errorBounds","minError","ItemDiff","hintCount","extras","_diffsItemDiffJsx","ItemDiffDemo","SimpleButton","baseButton","backgroundRepeat","orange","bakgroundColor","JsonEditor","cursorPos","textBefore","textAfter","nextString","ex","nextIframeID","requestIframeData","updateIframeHeight","iframeDataStore","lintWarnings","IframeContentRenderer","iframeID","_prepareFrame","sendNewData","_lastData","_lastHeight","seamless","datasetValue","_frame","datasetKey","dataset","lintGutter","contentWindow","postMessage","devices","PHONE","TABLET","DESKTOP","lintGutterWidth","perseusFrameBorderWidth","_constantsJs","SCREEN_SIZES","phone","framedWidth","tablet","desktop","DeviceFramer","deviceType","nochrome","screenStyle","HintEditor","showMoveButtons","showRemoveButton","CombinedHintEditor","updatePreview","CombinedHintsEditor","hintElems","handleHintChange","handleHintRemove","handleHintMove","frameSource","serializeHint","_jsonEditorJsx","_simpleButtonJsx","ModeDropdown","_handleSelectMode","currentMode","camelCaseToHuman","pluralToSingular","multiPath","Header","HeaderTag","NodeContainer","actions","givenName","controls","Container","ArrayContainer","ObjectContainer","LeafContainer","NodeContent","previewHeading","containerHeader","containerTitle","rowHeading","columnLeft","addArrayElement","headingEditor","headingPreview","previewCollectionHeader","hasBothHeadings","contentIndent","ItemNodeContent","HintNodeContent","TagsNodeContent","ArrayNodeContent","ObjectNodeContent","withStickiness","sticky","updateStickiness","stickynessTimer","setInterval","clearInterval","withChromeHack","_detached","_reattachTimer","getTextAreas","querySelectorAll","detach","activeElement","setProperty","reattach","removeProperty","chromeVersion","getChromeVersion","requiresHack","isSticky","mergeValueAtPath","preview","hintEditor","tagsEditor","setValueAtPath","elementName","elementIsLeaf","subdata","moveArrayElementUp","verticalFlip","moveArrayElementDown","removeArrayElement","arrayElement","arrayElementAndNotLeaf","objectElement","MultiRendererEditor","_renderLayout","Layout","_renderJson","editorMode","multiLine","_renderPreview","currentLength","newElementPath","nextElementIndex","nextElementPath","nextElement","previousElementPath","_renderEdit","itemShape","treePreview","flexGrow","_multirendererEditorJsx","DemoLayout","sharedContext","questions","numHints","multirenderer","clearHints","demoStyles","MultiRendererDemo","getEditorProps","newPath","oldPath","trackData","_getContentHash","handlePermalink","handleScore","handleSerializeState","_state","handleRestoreState","previewVisible","HUD","renderVisibleIcon","fillRule","mask","renderHiddenIcon","hud","_componentsDeviceFramerJsx","_iframeContentRendererJsx","_componentsHudJsx","SectionControlButton","ArticleEditor","contentPaths","screen","sectionImageUploadGenerator","_updatePreviewFrames","_apiOptionsForSection","sectionIndex","_renderEditor","_handleAddSectionAfter","_handleMoveSectionLater","_handleMoveSectionEarlier","_handleRemoveSection","_renderIframePreview","_renderAddSection","_renderLinterHUD","_renderPreviewMode","_handleJsonChange","newJson","newSection","_articleEditorJsx","StatefulArticleEditor","scorePreview","controlBar","controlSelected","_statefulArticleEditorJsx","defaultArticle","ArticleDemo","_handleResize","permalink","componentClass","defaultQuestion","RendererDemo","scratchpadEnabled","itemRenderer","onScore","takeHint","rendererComponent","showSmiley","answerButton","smiley","hideSmiley","problemAndAnswer","answerAreaWrap","infoBox","answerButtons","_interactive2Objective_Js","contentCallback","deepWidgetCallback","optionsCallback","modifiedContent","newOptions","userOptions","traverseRendererDeep","widgetCallback","deepCallback","upgradedWidgetInfo","userWidgetInfo","deepCallbackFor","Traversal","_traversalJsx","isRendererContentRenderableBy","rendererContentVersion","isRenderable","widgetRendererVersion","widgetVersion","isUpgradedWidgetInfoRenderableBy","isRawWidgetInfoRenderableBy","isItemRenderableByVersion","itemData","ViewportResizer","onViewportSizeChanged","phoneButtonContents","tabletButtonContents","desktopButtonContents","ItemExtrasEditor","_itemExtrasEditorJsx","ITEM_DATA_VERSION","ItemEditor","updateProps","handleEditorChange","handleItemExtrasChange","triggerPreviewUpdate","questionEditor","itemExtrasEditor","findPassageRefR","fixWholeOptions","passageRefText","widgetMarkdown","findRadioRefsR","replaceRadioRefs","reference","fixRadioWidget","fixRendererPassageRefs","newQuestion","newHints","_hintEditorJsx","FixPassageRefs","_utilFixPassageRefsJsx","_itemEditorJsx","_componentsViewportResizerJsx","EditorPage","developerMode","jsonMode","gradeMessage","wasAnswered","handleCheckAnswer","toggleJsonMode","rendererMountNode","updateRenderer","hasEditor","previewDevice","deviceBasedApiOptions","itemEditor","device","toChange","changeJSON","_fixPassageRefs","newItemData","onPreviewDeviceChange","rendererOnly","issues1","issues2","hintsEditor","_editorPageJsx","StatefulEditorPage","_statefulEditorPageJsx","Renderability","_renderabilityJsx","EditorDemo","editorPage","viewRendered","pathname","click","inputVersion","sequence","saveWarnings","traversal","findImagesInContent","handleBackgroundImage","findImagesInRenderers","findImagesInArticles","perseusContent","findImagesInItemData","violatingWidgets","_allWidgetsJs","Version","ItemVersion","Perseus","_perseusJs","itemVersion","_itemVersion","renderability","accessibility","_a11yJs","_i18nJsx","JiptHack","_jiptHackJsx","_editorDemoJsx","_rendererDemoJsx","_articleDemoJsx","MultirendererDemo","_multirendererDemoJsx","_itemDiffDemoJsx","_articleDiffDemoJsx","routes","article","loadExtraWidgets"],"mappings":"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,GAAGppD,aAC1CtW,KAAK0/D,aAAa9mD,SAClB5Y,KAAK0/D,aAAe,KAEpB1/D,KAAKq8D,SAAS/lD,WAAWjB,YAAYrV,KAAKq8D,UAC1Cr8D,KAAKigE,UAAU3pD,WAAWjB,YAAYrV,KAAKigE,WAE3CjgE,KAAKw8D,OAAOgF,YAAY,+BAE5BvtD,EAAEjU,KAAKs8D,cAAc5U,IAAI,aAAc,YAG3C/0B,GAAQ8uC,YAAc,IAAIzF,GACDrpC,GAAQ8uC,YAClB/uC,UC3gBXA,GAAW,CACXC,QAAS,IAGCD,GAASC,QA6CvB,MAAM+uC,GAAoB,yCA4TpBC,GAlToB,CACtB,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,QACA,QACA,SACA,SACA,SACA,SACA,QACA,MACA,WACA,QACA,OACA,KACA,MACA,MACA,OACA,OACA,OACA,OACA,OACA,OACA,UACA,kBACA,gBACA,QACA,eACA,OACA,QACA,QACA,QACA,QACA,QACA,aACA,MACA,SACA,QACA,SACA,SACA,MACA,OACA,QACA,YACA,MACA,OACA,cACA,WACA,QACA,QACA,OACA,MACA,MACA,MACA,MACA,kBACA,SACA,SACA,QACA,QACA,QACA,MACA,QACA,UACA,cACA,eACA,MACA,MACA,OACA,YACA,YACA,MACA,MACA,UACA,UACA,QACA,MACA,OACA,OACA,eACA,OACA,QACA,QACA,QACA,MACA,KACA,MACA,KACA,QACA,QACA,QACA,QACA,OACA,QACA,QACA,QACA,QACA,SACA,SACA,SACA,SACA,KACA,MACA,OACA,YACA,QACA,WACA,OACA,OACA,MACA,QACA,OACA,UACA,KACA,QACA,MACA,WACA,KACA,SACA,QACA,OACA,SACA,SACA,QACA,QACA,QACA,MACA,QACA,KACA,OACA,YACA,iBACA,iBACA,oBACA,WACA,MACA,SACA,KACA,MACA,SACA,OACA,KACA,MACA,iBACA,iBACA,UACA,KACA,QACA,UACA,UACA,UACA,UACA,SACA,SACA,UACA,SACA,SACA,SACA,MACA,OACA,MACA,KACA,KACA,QACA,KACA,UACA,MACA,OACA,OACA,OACA,QACA,aACA,MACA,KACA,KACA,OACA,OACA,QACA,QACA,eACA,QACA,SACA,SACA,SACA,YACA,gBACA,qBACA,WACA,iBACA,UACA,WACA,UACA,OACA,UACA,MACA,MACA,KACA,OACA,KACA,QACA,SACA,MACA,MACA,SACA,UACA,UACA,UACA,UACA,QACA,OACA,QACA,SACA,MACA,OACA,OACA,OACA,OACA,OACA,SACA,MACA,QACA,aACA,aACA,oBACA,QACA,aACA,cACA,UACA,MACA,WACA,QACA,QACA,QACA,MACA,QACA,MACA,QACA,QACA,OACA,SACA,WACA,OACA,WACA,MACA,UACA,MACA,MACA,MACA,QACA,QACA,QACA,QACA,QACA,OACA,SACA,SACA,SACA,QACA,YACA,QACA,QACA,QACA,QACA,OACA,KACA,WACA,eACA,gBACA,aACA,YACA,WACA,UACA,SACA,SACA,QACA,MACA,SACA,OACA,WACA,UACA,KACA,cAIA,QACA,MACA,OACA,QACA,SAGmCv8B,QAAO,SAASzV,EAAQiyC,GAE3D,OADAjyC,EAAOiyC,GAAS,KACTjyC,IACR,IAOGkyC,GAAmB,CACrB/0D,EAAG,KACH9J,EAAG,KACH6H,EAAG,KACH,KAAM,MAMJi3D,GAAgB,SAAS5iE,GAC3B,IAAI6iE,EAAiB,EACrB,KAAOA,EAAiB7iE,EAAKpB,QAAmC,OAAzBoB,EAAK6iE,IACxCA,IAEJ,GAAuB,IAAnBA,EACA,OAAO,EACJ,GAAIA,EAAiB,IAAM,EAC9B,OAAO,EACJ,CAGH,MAAMC,EAAa9iE,EAAKyL,UAAUo3D,GAClC,MAAmB,MAAfC,EAG0B,IAAnBD,EAAuB,EAAI,EAE3BJ,GAAajoC,eAAesoC,GAAc,EAAI,IAKpDC,GAAc,SAAS/iE,GAChC,IAAItB,EAAI,EACJ+xB,EAAS,GACb,KAAO/xB,EAAIsB,EAAKpB,QAAQ,CACpB,MAAMuN,EAAInM,EAAKtB,GACf,GAAU,OAANyN,EAAY,CAE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","file":"static/js/main.5a330a28.chunk.js","sourcesContent":["/*!\n * Raphael 1.5.2 - JavaScript Vector Library\n *\n * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com)\n * Licensed under the MIT (http://raphaeljs.com/license.html) license.\n */\n(function () {\n    var setAttr;\n    if (\"\".trim) {\n        setAttr = function(node, att, value) {\n            node.setAttribute(att, String(value).trim());\n        };\n    } else {\n        setAttr = function(node, att, value) {\n            node.setAttribute(att, String(value));\n        };\n    }\n    function R() {\n        if (R.is(arguments[0], array)) {\n            var a = arguments[0],\n                cnv = create[apply](R, a.splice(0, 3 + R.is(a[0], nu))),\n                res = cnv.set();\n            for (var i = 0, ii = a[length]; i < ii; i++) {\n                var j = a[i] || {};\n                elements[has](j.type) && res[push](cnv[j.type]().attr(j));\n            }\n            return res;\n        }\n        return create[apply](R, arguments);\n    }\n    R.version = \"1.5.2\";\n    var separator = /[, ]+/,\n        elements = {circle: 1, rect: 1, path: 1, ellipse: 1, text: 1, image: 1},\n        formatrg = /\\{(\\d+)\\}/g,\n        proto = \"prototype\",\n        has = \"hasOwnProperty\",\n        doc = document,\n        win = window,\n        oldRaphael = {\n            was: Object[proto][has].call(win, \"Raphael\"),\n            is: win.Raphael\n        },\n        Paper = function () {\n            this.customAttributes = {};\n        },\n        paperproto,\n        appendChild = \"appendChild\",\n        apply = \"apply\",\n        concat = \"concat\",\n        supportsTouch = \"createTouch\" in doc,\n        E = \"\",\n        S = \" \",\n        Str = String,\n        split = \"split\",\n        events = \"click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend\"[split](S),\n        touchMap = {\n            mousedown: \"touchstart\",\n            mousemove: \"touchmove\",\n            mouseup: \"touchend\"\n        },\n        join = \"join\",\n        length = \"length\",\n        lowerCase = Str[proto].toLowerCase,\n        math = Math,\n        mmax = math.max,\n        mmin = math.min,\n        abs = math.abs,\n        pow = math.pow,\n        PI = math.PI,\n        nu = \"number\",\n        string = \"string\",\n        array = \"array\",\n        toString = \"toString\",\n        fillString = \"fill\",\n        objectToString = Object[proto][toString],\n        paper = {},\n        push = \"push\",\n        ISURL = /^url\\(['\"]?([^\\)]+?)['\"]?\\)$/i,\n        colourRegExp = /^\\s*((#[a-f\\d]{6})|(#[a-f\\d]{3})|rgba?\\(\\s*([\\d\\.]+%?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\)|hsba?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\)|hsla?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\))\\s*$/i,\n        isnan = {\"NaN\": 1, \"Infinity\": 1, \"-Infinity\": 1},\n        bezierrg = /^(?:cubic-)?bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)/,\n        round = math.round,\n        toFloat = parseFloat,\n        toInt = parseInt,\n        ms = \" progid:DXImageTransform.Microsoft\",\n        upperCase = Str[proto].toUpperCase,\n        availableAttrs = {blur: 0, \"clip-rect\": \"0 0 1e9 1e9\", cursor: \"default\", cx: 0, cy: 0, fill: \"#fff\", \"fill-opacity\": 1, font: '10px \"Arial\"', \"font-family\": '\"Arial\"', \"font-size\": \"10\", \"font-style\": \"normal\", \"font-weight\": 400, gradient: 0, height: 0, href: \"http://raphaeljs.com/\", opacity: 1, path: \"M0,0\", r: 0, rotation: 0, rx: 0, ry: 0, scale: \"1 1\", src: \"\", stroke: \"#000\", \"stroke-dasharray\": \"\", \"stroke-linecap\": \"butt\", \"stroke-linejoin\": \"butt\", \"stroke-miterlimit\": 0, \"stroke-opacity\": 1, \"stroke-width\": 1, target: \"_blank\", \"text-anchor\": \"middle\", title: \"Raphael\", translation: \"0 0\", width: 0, x: 0, y: 0},\n        availableAnimAttrs = {along: \"along\", blur: nu, \"clip-rect\": \"csv\", cx: nu, cy: nu, fill: \"colour\", \"fill-opacity\": nu, \"font-size\": nu, height: nu, opacity: nu, path: \"path\", r: nu, rotation: \"csv\", rx: nu, ry: nu, scale: \"csv\", stroke: \"colour\", \"stroke-opacity\": nu, \"stroke-width\": nu, translation: \"csv\", width: nu, x: nu, y: nu},\n        rp = \"replace\",\n        animKeyFrames= /^(from|to|\\d+%?)$/,\n        commaSpaces = /\\s*,\\s*/,\n        hsrg = {hs: 1, rg: 1},\n        p2s = /,?([achlmqrstvxz]),?/gi,\n        pathCommand = /([achlmqstvz])[\\s,]*((-?\\d*\\.?\\d*(?:e[-+]?\\d+)?\\s*,?\\s*)+)/ig,\n        pathValues = /(-?\\d*\\.?\\d*(?:e[-+]?\\d+)?)\\s*,?\\s*/ig,\n        radial_gradient = /^r(?:\\(([^,]+?)\\s*,\\s*([^\\)]+?)\\))?/,\n        sortByKey = function (a, b) {\n            return a.key - b.key;\n        };\n\n    R.type = (win.SVGAngle || doc.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\") ? \"SVG\" : \"VML\");\n    if (R.type == \"VML\") {\n        var d = doc.createElement(\"div\"),\n            b;\n        d.innerHTML = '<v:shape adj=\"1\"/>';\n        b = d.firstChild;\n        b.style.behavior = \"url(#default#VML)\";\n        if (!(b && typeof b.adj == \"object\")) {\n            return R.type = null;\n        }\n        d = null;\n    }\n    R.svg = !(R.vml = R.type == \"VML\");\n    Paper[proto] = R[proto];\n    paperproto = Paper[proto];\n    R._id = 0;\n    R._oid = 0;\n    R.fn = {};\n    R.is = function (o, type) {\n        type = lowerCase.call(type);\n        if (type == \"finite\") {\n            return !isnan[has](+o);\n        }\n        return  (type == \"null\" && o === null) ||\n                (type == typeof o) ||\n                (type == \"object\" && o === Object(o)) ||\n                (type == \"array\" && Array.isArray && Array.isArray(o)) ||\n                objectToString.call(o).slice(8, -1).toLowerCase() == type;\n    };\n    R.angle = function (x1, y1, x2, y2, x3, y3) {\n        if (x3 == null) {\n            var x = x1 - x2,\n                y = y1 - y2;\n            if (!x && !y) {\n                return 0;\n            }\n            return ((x < 0) * 180 + math.atan(-y / -x) * 180 / PI + 360) % 360;\n        } else {\n            return R.angle(x1, y1, x3, y3) - R.angle(x2, y2, x3, y3);\n        }\n    };\n    R.rad = function (deg) {\n        return deg % 360 * PI / 180;\n    };\n    R.deg = function (rad) {\n        return rad * 180 / PI % 360;\n    };\n    R.snapTo = function (values, value, tolerance) {\n        tolerance = R.is(tolerance, \"finite\") ? tolerance : 10;\n        if (R.is(values, array)) {\n            var i = values.length;\n            while (i--) if (abs(values[i] - value) <= tolerance) {\n                return values[i];\n            }\n        } else {\n            values = +values;\n            var rem = value % values;\n            if (rem < tolerance) {\n                return value - rem;\n            }\n            if (rem > values - tolerance) {\n                return value - rem + values;\n            }\n        }\n        return value;\n    };\n    function createUUID() {\n        // http://www.ietf.org/rfc/rfc4122.txt\n        var s = [],\n            i = 0;\n        for (; i < 32; i++) {\n            s[i] = (~~(math.random() * 16))[toString](16);\n        }\n        s[12] = 4;  // bits 12-15 of the time_hi_and_version field to 0010\n        s[16] = ((s[16] & 3) | 8)[toString](16);  // bits 6-7 of the clock_seq_hi_and_reserved to 01\n        return \"r-\" + s[join](\"\");\n    }\n\n    R.setWindow = function (newwin) {\n        win = newwin;\n        doc = win.document;\n    };\n    // colour utilities\n    var toHex = function (color) {\n        if (R.vml) {\n            // http://dean.edwards.name/weblog/2009/10/convert-any-colour-value-to-hex-in-msie/\n            var trim = /^\\s+|\\s+$/g;\n            var bod;\n            try {\n                var docum = new ActiveXObject(\"htmlfile\");\n                docum.write(\"<body>\");\n                docum.close();\n                bod = docum.body;\n            } catch(e) {\n                bod = createPopup().document.body;\n            }\n            var range = bod.createTextRange();\n            toHex = cacher(function (color) {\n                try {\n                    bod.style.color = Str(color)[rp](trim, E);\n                    var value = range.queryCommandValue(\"ForeColor\");\n                    value = ((value & 255) << 16) | (value & 65280) | ((value & 16711680) >>> 16);\n                    return \"#\" + (\"000000\" + value[toString](16)).slice(-6);\n                } catch(e) {\n                    return \"none\";\n                }\n            });\n        } else {\n            var i = doc.createElement(\"i\");\n            i.title = \"Rapha\\xebl Colour Picker\";\n            i.style.display = \"none\";\n            doc.body[appendChild](i);\n            toHex = cacher(function (color) {\n                i.style.color = color;\n                return doc.defaultView.getComputedStyle(i, E).getPropertyValue(\"color\");\n            });\n        }\n        return toHex(color);\n    },\n    hsbtoString = function () {\n        return \"hsb(\" + [this.h, this.s, this.b] + \")\";\n    },\n    hsltoString = function () {\n        return \"hsl(\" + [this.h, this.s, this.l] + \")\";\n    },\n    rgbtoString = function () {\n        return this.hex;\n    };\n    R.hsb2rgb = function (h, s, b, o) {\n        if (R.is(h, \"object\") && \"h\" in h && \"s\" in h && \"b\" in h) {\n            b = h.b;\n            s = h.s;\n            h = h.h;\n            o = h.o;\n        }\n        return R.hsl2rgb(h, s, b / 2, o);\n    };\n    R.hsl2rgb = function (h, s, l, o) {\n        if (R.is(h, \"object\") && \"h\" in h && \"s\" in h && \"l\" in h) {\n            l = h.l;\n            s = h.s;\n            h = h.h;\n        }\n        if (h > 1 || s > 1 || l > 1) {\n            h /= 360;\n            s /= 100;\n            l /= 100;\n        }\n        var rgb = {},\n            channels = [\"r\", \"g\", \"b\"],\n            t2, t1, t3, r, g, b;\n        if (!s) {\n            rgb = {\n                r: l,\n                g: l,\n                b: l\n            };\n        } else {\n            if (l < .5) {\n                t2 = l * (1 + s);\n            } else {\n                t2 = l + s - l * s;\n            }\n            t1 = 2 * l - t2;\n            for (var i = 0; i < 3; i++) {\n                t3 = h + 1 / 3 * -(i - 1);\n                t3 < 0 && t3++;\n                t3 > 1 && t3--;\n                if (t3 * 6 < 1) {\n                    rgb[channels[i]] = t1 + (t2 - t1) * 6 * t3;\n                } else if (t3 * 2 < 1) {\n                    rgb[channels[i]] = t2;\n                } else if (t3 * 3 < 2) {\n                    rgb[channels[i]] = t1 + (t2 - t1) * (2 / 3 - t3) * 6;\n                } else {\n                    rgb[channels[i]] = t1;\n                }\n            }\n        }\n        rgb.r *= 255;\n        rgb.g *= 255;\n        rgb.b *= 255;\n        rgb.hex = \"#\" + (16777216 | rgb.b | (rgb.g << 8) | (rgb.r << 16)).toString(16).slice(1);\n        R.is(o, \"finite\") && (rgb.opacity = o);\n        rgb.toString = rgbtoString;\n        return rgb;\n    };\n    R.rgb2hsb = function (red, green, blue) {\n        if (green == null && R.is(red, \"object\") && \"r\" in red && \"g\" in red && \"b\" in red) {\n            blue = red.b;\n            green = red.g;\n            red = red.r;\n        }\n        if (green == null && R.is(red, string)) {\n            var clr = R.getRGB(red);\n            red = clr.r;\n            green = clr.g;\n            blue = clr.b;\n        }\n        if (red > 1 || green > 1 || blue > 1) {\n            red /= 255;\n            green /= 255;\n            blue /= 255;\n        }\n        var max = mmax(red, green, blue),\n            min = mmin(red, green, blue),\n            hue,\n            saturation,\n            brightness = max;\n        if (min == max) {\n            return {h: 0, s: 0, b: max, toString: hsbtoString};\n        } else {\n            var delta = (max - min);\n            saturation = delta / max;\n            if (red == max) {\n                hue = (green - blue) / delta;\n            } else if (green == max) {\n                hue = 2 + ((blue - red) / delta);\n            } else {\n                hue = 4 + ((red - green) / delta);\n            }\n            hue /= 6;\n            hue < 0 && hue++;\n            hue > 1 && hue--;\n        }\n        return {h: hue, s: saturation, b: brightness, toString: hsbtoString};\n    };\n    R.rgb2hsl = function (red, green, blue) {\n        if (green == null && R.is(red, \"object\") && \"r\" in red && \"g\" in red && \"b\" in red) {\n            blue = red.b;\n            green = red.g;\n            red = red.r;\n        }\n        if (green == null && R.is(red, string)) {\n            var clr = R.getRGB(red);\n            red = clr.r;\n            green = clr.g;\n            blue = clr.b;\n        }\n        if (red > 1 || green > 1 || blue > 1) {\n            red /= 255;\n            green /= 255;\n            blue /= 255;\n        }\n        var max = mmax(red, green, blue),\n            min = mmin(red, green, blue),\n            h,\n            s,\n            l = (max + min) / 2,\n            hsl;\n        if (min == max) {\n            hsl =  {h: 0, s: 0, l: l};\n        } else {\n            var delta = max - min;\n            s = l < .5 ? delta / (max + min) : delta / (2 - max - min);\n            if (red == max) {\n                h = (green - blue) / delta;\n            } else if (green == max) {\n                h = 2 + (blue - red) / delta;\n            } else {\n                h = 4 + (red - green) / delta;\n            }\n            h /= 6;\n            h < 0 && h++;\n            h > 1 && h--;\n            hsl = {h: h, s: s, l: l};\n        }\n        hsl.toString = hsltoString;\n        return hsl;\n    };\n    R._path2string = function () {\n        return this.join(\",\")[rp](p2s, \"$1\");\n    };\n    function cacher(f, scope, postprocessor) {\n        function newf() {\n            var arg = Array[proto].slice.call(arguments, 0),\n                args = arg[join](\"\\u25ba\"),\n                cache = newf.cache = newf.cache || {},\n                count = newf.count = newf.count || [];\n            if (cache[has](args)) {\n                return postprocessor ? postprocessor(cache[args]) : cache[args];\n            }\n            count[length] >= 1e3 && delete cache[count.shift()];\n            count[push](args);\n            cache[args] = f[apply](scope, arg);\n            return postprocessor ? postprocessor(cache[args]) : cache[args];\n        }\n        return newf;\n    }\n\n    R.getRGB = cacher(function (colour) {\n        if (!colour || !!((colour = Str(colour)).indexOf(\"-\") + 1)) {\n            return {r: -1, g: -1, b: -1, hex: \"none\", error: 1};\n        }\n        if (colour == \"none\") {\n            return {r: -1, g: -1, b: -1, hex: \"none\"};\n        }\n        !(hsrg[has](colour.toLowerCase().substring(0, 2)) || colour.charAt() == \"#\") && (colour = toHex(colour));\n        var res,\n            red,\n            green,\n            blue,\n            opacity,\n            t,\n            values,\n            rgb = colour.match(colourRegExp);\n        if (rgb) {\n            if (rgb[2]) {\n                blue = toInt(rgb[2].substring(5), 16);\n                green = toInt(rgb[2].substring(3, 5), 16);\n                red = toInt(rgb[2].substring(1, 3), 16);\n            }\n            if (rgb[3]) {\n                blue = toInt((t = rgb[3].charAt(3)) + t, 16);\n                green = toInt((t = rgb[3].charAt(2)) + t, 16);\n                red = toInt((t = rgb[3].charAt(1)) + t, 16);\n            }\n            if (rgb[4]) {\n                values = rgb[4][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == \"%\" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == \"%\" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == \"%\" && (blue *= 2.55);\n                rgb[1].toLowerCase().slice(0, 4) == \"rgba\" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == \"%\" && (opacity /= 100);\n            }\n            if (rgb[5]) {\n                values = rgb[5][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == \"%\" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == \"%\" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == \"%\" && (blue *= 2.55);\n                (values[0].slice(-3) == \"deg\" || values[0].slice(-1) == \"\\xb0\") && (red /= 360);\n                rgb[1].toLowerCase().slice(0, 4) == \"hsba\" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == \"%\" && (opacity /= 100);\n                return R.hsb2rgb(red, green, blue, opacity);\n            }\n            if (rgb[6]) {\n                values = rgb[6][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == \"%\" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == \"%\" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == \"%\" && (blue *= 2.55);\n                (values[0].slice(-3) == \"deg\" || values[0].slice(-1) == \"\\xb0\") && (red /= 360);\n                rgb[1].toLowerCase().slice(0, 4) == \"hsla\" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == \"%\" && (opacity /= 100);\n                return R.hsl2rgb(red, green, blue, opacity);\n            }\n            rgb = {r: red, g: green, b: blue};\n            rgb.hex = \"#\" + (16777216 | blue | (green << 8) | (red << 16)).toString(16).slice(1);\n            R.is(opacity, \"finite\") && (rgb.opacity = opacity);\n            return rgb;\n        }\n        return {r: -1, g: -1, b: -1, hex: \"none\", error: 1};\n    }, R);\n    R.getColor = function (value) {\n        var start = this.getColor.start = this.getColor.start || {h: 0, s: 1, b: value || .75},\n            rgb = this.hsb2rgb(start.h, start.s, start.b);\n        start.h += .075;\n        if (start.h > 1) {\n            start.h = 0;\n            start.s -= .2;\n            start.s <= 0 && (this.getColor.start = {h: 0, s: 1, b: start.b});\n        }\n        return rgb.hex;\n    };\n    R.getColor.reset = function () {\n        delete this.start;\n    };\n    // path utilities\n    R.parsePathString = cacher(function (pathString) {\n        if (!pathString) {\n            return null;\n        }\n        var paramCounts = {a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0},\n            data = [];\n        if (R.is(pathString, array) && R.is(pathString[0], array)) { // rough assumption\n            data = pathClone(pathString);\n        }\n        if (!data[length]) {\n            Str(pathString)[rp](pathCommand, function (a, b, c) {\n                var params = [],\n                    name = lowerCase.call(b);\n                c[rp](pathValues, function (a, b) {\n                    b && params[push](+b);\n                });\n                if (name == \"m\" && params[length] > 2) {\n                    data[push]([b][concat](params.splice(0, 2)));\n                    name = \"l\";\n                    b = b == \"m\" ? \"l\" : \"L\";\n                }\n                while (params[length] >= paramCounts[name]) {\n                    data[push]([b][concat](params.splice(0, paramCounts[name])));\n                    if (!paramCounts[name]) {\n                        break;\n                    }\n                }\n            });\n        }\n        data[toString] = R._path2string;\n        return data;\n    });\n    R.findDotsAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n        var t1 = 1 - t,\n            x = pow(t1, 3) * p1x + pow(t1, 2) * 3 * t * c1x + t1 * 3 * t * t * c2x + pow(t, 3) * p2x,\n            y = pow(t1, 3) * p1y + pow(t1, 2) * 3 * t * c1y + t1 * 3 * t * t * c2y + pow(t, 3) * p2y,\n            mx = p1x + 2 * t * (c1x - p1x) + t * t * (c2x - 2 * c1x + p1x),\n            my = p1y + 2 * t * (c1y - p1y) + t * t * (c2y - 2 * c1y + p1y),\n            nx = c1x + 2 * t * (c2x - c1x) + t * t * (p2x - 2 * c2x + c1x),\n            ny = c1y + 2 * t * (c2y - c1y) + t * t * (p2y - 2 * c2y + c1y),\n            ax = (1 - t) * p1x + t * c1x,\n            ay = (1 - t) * p1y + t * c1y,\n            cx = (1 - t) * c2x + t * p2x,\n            cy = (1 - t) * c2y + t * p2y,\n            alpha = (90 - math.atan((mx - nx) / (my - ny)) * 180 / PI);\n        (mx > nx || my < ny) && (alpha += 180);\n        return {x: x, y: y, m: {x: mx, y: my}, n: {x: nx, y: ny}, start: {x: ax, y: ay}, end: {x: cx, y: cy}, alpha: alpha};\n    };\n    var pathDimensions = cacher(function (path) {\n        if (!path) {\n            return {x: 0, y: 0, width: 0, height: 0};\n        }\n        path = path2curve(path);\n        var x = 0,\n            y = 0,\n            X = [],\n            Y = [],\n            p;\n        for (var i = 0, ii = path[length]; i < ii; i++) {\n            p = path[i];\n            if (p[0] == \"M\") {\n                x = p[1];\n                y = p[2];\n                X[push](x);\n                Y[push](y);\n            } else {\n                var dim = curveDim(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\n                X = X[concat](dim.min.x, dim.max.x);\n                Y = Y[concat](dim.min.y, dim.max.y);\n                x = p[5];\n                y = p[6];\n            }\n        }\n        var xmin = mmin[apply](0, X),\n            ymin = mmin[apply](0, Y);\n        return {\n            x: xmin,\n            y: ymin,\n            width: mmax[apply](0, X) - xmin,\n            height: mmax[apply](0, Y) - ymin\n        };\n    }),\n        pathClone = function (pathArray) {\n            var res = [];\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\n                pathArray = R.parsePathString(pathArray);\n            }\n            for (var i = 0, ii = pathArray[length]; i < ii; i++) {\n                res[i] = [];\n                for (var j = 0, jj = pathArray[i][length]; j < jj; j++) {\n                    res[i][j] = pathArray[i][j];\n                }\n            }\n            res[toString] = R._path2string;\n            return res;\n        },\n        pathToRelative = cacher(function (pathArray) {\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\n                pathArray = R.parsePathString(pathArray);\n            }\n            var res = [],\n                x = 0,\n                y = 0,\n                mx = 0,\n                my = 0,\n                start = 0;\n            if (pathArray[0][0] == \"M\") {\n                x = pathArray[0][1];\n                y = pathArray[0][2];\n                mx = x;\n                my = y;\n                start++;\n                res[push]([\"M\", x, y]);\n            }\n            for (var i = start, ii = pathArray[length]; i < ii; i++) {\n                var r = res[i] = [],\n                    pa = pathArray[i];\n                if (pa[0] != lowerCase.call(pa[0])) {\n                    r[0] = lowerCase.call(pa[0]);\n                    switch (r[0]) {\n                        case \"a\":\n                            r[1] = pa[1];\n                            r[2] = pa[2];\n                            r[3] = pa[3];\n                            r[4] = pa[4];\n                            r[5] = pa[5];\n                            r[6] = +(pa[6] - x).toFixed(3);\n                            r[7] = +(pa[7] - y).toFixed(3);\n                            break;\n                        case \"v\":\n                            r[1] = +(pa[1] - y).toFixed(3);\n                            break;\n                        case \"m\":\n                            mx = pa[1];\n                            my = pa[2];\n                        default:\n                            for (var j = 1, jj = pa[length]; j < jj; j++) {\n                                r[j] = +(pa[j] - ((j % 2) ? x : y)).toFixed(3);\n                            }\n                    }\n                } else {\n                    r = res[i] = [];\n                    if (pa[0] == \"m\") {\n                        mx = pa[1] + x;\n                        my = pa[2] + y;\n                    }\n                    for (var k = 0, kk = pa[length]; k < kk; k++) {\n                        res[i][k] = pa[k];\n                    }\n                }\n                var len = res[i][length];\n                switch (res[i][0]) {\n                    case \"z\":\n                        x = mx;\n                        y = my;\n                        break;\n                    case \"h\":\n                        x += +res[i][len - 1];\n                        break;\n                    case \"v\":\n                        y += +res[i][len - 1];\n                        break;\n                    default:\n                        x += +res[i][len - 2];\n                        y += +res[i][len - 1];\n                }\n            }\n            res[toString] = R._path2string;\n            return res;\n        }, 0, pathClone),\n        pathToAbsolute = cacher(function (pathArray) {\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\n                pathArray = R.parsePathString(pathArray);\n            }\n            var res = [],\n                x = 0,\n                y = 0,\n                mx = 0,\n                my = 0,\n                start = 0;\n            if (pathArray[0][0] == \"M\") {\n                x = +pathArray[0][1];\n                y = +pathArray[0][2];\n                mx = x;\n                my = y;\n                start++;\n                res[0] = [\"M\", x, y];\n            }\n            for (var i = start, ii = pathArray[length]; i < ii; i++) {\n                var r = res[i] = [],\n                    pa = pathArray[i];\n                if (pa[0] != upperCase.call(pa[0])) {\n                    r[0] = upperCase.call(pa[0]);\n                    switch (r[0]) {\n                        case \"A\":\n                            r[1] = pa[1];\n                            r[2] = pa[2];\n                            r[3] = pa[3];\n                            r[4] = pa[4];\n                            r[5] = pa[5];\n                            r[6] = +(pa[6] + x);\n                            r[7] = +(pa[7] + y);\n                            break;\n                        case \"V\":\n                            r[1] = +pa[1] + y;\n                            break;\n                        case \"H\":\n                            r[1] = +pa[1] + x;\n                            break;\n                        case \"M\":\n                            mx = +pa[1] + x;\n                            my = +pa[2] + y;\n                        default:\n                            for (var j = 1, jj = pa[length]; j < jj; j++) {\n                                r[j] = +pa[j] + ((j % 2) ? x : y);\n                            }\n                    }\n                } else {\n                    for (var k = 0, kk = pa[length]; k < kk; k++) {\n                        res[i][k] = pa[k];\n                    }\n                }\n                switch (r[0]) {\n                    case \"Z\":\n                        x = mx;\n                        y = my;\n                        break;\n                    case \"H\":\n                        x = r[1];\n                        break;\n                    case \"V\":\n                        y = r[1];\n                        break;\n                    case \"M\":\n                        mx = res[i][res[i][length] - 2];\n                        my = res[i][res[i][length] - 1];\n                    default:\n                        x = res[i][res[i][length] - 2];\n                        y = res[i][res[i][length] - 1];\n                }\n            }\n            res[toString] = R._path2string;\n            return res;\n        }, null, pathClone),\n        l2c = function (x1, y1, x2, y2) {\n            return [x1, y1, x2, y2, x2, y2];\n        },\n        q2c = function (x1, y1, ax, ay, x2, y2) {\n            var _13 = 1 / 3,\n                _23 = 2 / 3;\n            return [\n                    _13 * x1 + _23 * ax,\n                    _13 * y1 + _23 * ay,\n                    _13 * x2 + _23 * ax,\n                    _13 * y2 + _23 * ay,\n                    x2,\n                    y2\n                ];\n        },\n        a2c = function (x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n            // for more information of where this math came from visit:\n            // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n            var _120 = PI * 120 / 180,\n                rad = PI / 180 * (+angle || 0),\n                res = [],\n                xy,\n                rotate = cacher(function (x, y, rad) {\n                    var X = x * math.cos(rad) - y * math.sin(rad),\n                        Y = x * math.sin(rad) + y * math.cos(rad);\n                    return {x: X, y: Y};\n                });\n            if (!recursive) {\n                xy = rotate(x1, y1, -rad);\n                x1 = xy.x;\n                y1 = xy.y;\n                xy = rotate(x2, y2, -rad);\n                x2 = xy.x;\n                y2 = xy.y;\n                var cos = math.cos(PI / 180 * angle),\n                    sin = math.sin(PI / 180 * angle),\n                    x = (x1 - x2) / 2,\n                    y = (y1 - y2) / 2;\n                var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\n                if (h > 1) {\n                    h = math.sqrt(h);\n                    rx = h * rx;\n                    ry = h * ry;\n                }\n                var rx2 = rx * rx,\n                    ry2 = ry * ry,\n                    k = (large_arc_flag == sweep_flag ? -1 : 1) *\n                        math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\n                    cx = k * rx * y / ry + (x1 + x2) / 2,\n                    cy = k * -ry * x / rx + (y1 + y2) / 2,\n                    f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\n                    f2 = math.asin(((y2 - cy) / ry).toFixed(9));\n\n                f1 = x1 < cx ? PI - f1 : f1;\n                f2 = x2 < cx ? PI - f2 : f2;\n                f1 < 0 && (f1 = PI * 2 + f1);\n                f2 < 0 && (f2 = PI * 2 + f2);\n                if (sweep_flag && f1 > f2) {\n                    f1 = f1 - PI * 2;\n                }\n                if (!sweep_flag && f2 > f1) {\n                    f2 = f2 - PI * 2;\n                }\n            } else {\n                f1 = recursive[0];\n                f2 = recursive[1];\n                cx = recursive[2];\n                cy = recursive[3];\n            }\n            var df = f2 - f1;\n            if (abs(df) > _120) {\n                var f2old = f2,\n                    x2old = x2,\n                    y2old = y2;\n                f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n                x2 = cx + rx * math.cos(f2);\n                y2 = cy + ry * math.sin(f2);\n                res = a2c(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\n            }\n            df = f2 - f1;\n            var c1 = math.cos(f1),\n                s1 = math.sin(f1),\n                c2 = math.cos(f2),\n                s2 = math.sin(f2),\n                t = math.tan(df / 4),\n                hx = 4 / 3 * rx * t,\n                hy = 4 / 3 * ry * t,\n                m1 = [x1, y1],\n                m2 = [x1 + hx * s1, y1 - hy * c1],\n                m3 = [x2 + hx * s2, y2 - hy * c2],\n                m4 = [x2, y2];\n            m2[0] = 2 * m1[0] - m2[0];\n            m2[1] = 2 * m1[1] - m2[1];\n            if (recursive) {\n                return [m2, m3, m4][concat](res);\n            } else {\n                res = [m2, m3, m4][concat](res)[join]()[split](\",\");\n                var newres = [];\n                for (var i = 0, ii = res[length]; i < ii; i++) {\n                    newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n                }\n                return newres;\n            }\n        },\n        findDotAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n            var t1 = 1 - t;\n            return {\n                x: pow(t1, 3) * p1x + pow(t1, 2) * 3 * t * c1x + t1 * 3 * t * t * c2x + pow(t, 3) * p2x,\n                y: pow(t1, 3) * p1y + pow(t1, 2) * 3 * t * c1y + t1 * 3 * t * t * c2y + pow(t, 3) * p2y\n            };\n        },\n        curveDim = cacher(function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\n            var a = (c2x - 2 * c1x + p1x) - (p2x - 2 * c2x + c1x),\n                b = 2 * (c1x - p1x) - 2 * (c2x - c1x),\n                c = p1x - c1x,\n                t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a,\n                t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a,\n                y = [p1y, p2y],\n                x = [p1x, p2x],\n                dot;\n            abs(t1) > \"1e12\" && (t1 = .5);\n            abs(t2) > \"1e12\" && (t2 = .5);\n            if (t1 > 0 && t1 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\n                x[push](dot.x);\n                y[push](dot.y);\n            }\n            if (t2 > 0 && t2 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\n                x[push](dot.x);\n                y[push](dot.y);\n            }\n            a = (c2y - 2 * c1y + p1y) - (p2y - 2 * c2y + c1y);\n            b = 2 * (c1y - p1y) - 2 * (c2y - c1y);\n            c = p1y - c1y;\n            t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a;\n            t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a;\n            abs(t1) > \"1e12\" && (t1 = .5);\n            abs(t2) > \"1e12\" && (t2 = .5);\n            if (t1 > 0 && t1 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\n                x[push](dot.x);\n                y[push](dot.y);\n            }\n            if (t2 > 0 && t2 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\n                x[push](dot.x);\n                y[push](dot.y);\n            }\n            return {\n                min: {x: mmin[apply](0, x), y: mmin[apply](0, y)},\n                max: {x: mmax[apply](0, x), y: mmax[apply](0, y)}\n            };\n        }),\n        path2curve = cacher(function (path, path2) {\n            var p = pathToAbsolute(path),\n                p2 = path2 && pathToAbsolute(path2),\n                attrs = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\n                attrs2 = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\n                processPath = function (path, d) {\n                    var nx, ny;\n                    if (!path) {\n                        return [\"C\", d.x, d.y, d.x, d.y, d.x, d.y];\n                    }\n                    !(path[0] in {T:1, Q:1}) && (d.qx = d.qy = null);\n                    switch (path[0]) {\n                        case \"M\":\n                            d.X = path[1];\n                            d.Y = path[2];\n                            break;\n                        case \"A\":\n                            path = [\"C\"][concat](a2c[apply](0, [d.x, d.y][concat](path.slice(1))));\n                            break;\n                        case \"S\":\n                            nx = d.x + (d.x - (d.bx || d.x));\n                            ny = d.y + (d.y - (d.by || d.y));\n                            path = [\"C\", nx, ny][concat](path.slice(1));\n                            break;\n                        case \"T\":\n                            d.qx = d.x + (d.x - (d.qx || d.x));\n                            d.qy = d.y + (d.y - (d.qy || d.y));\n                            path = [\"C\"][concat](q2c(d.x, d.y, d.qx, d.qy, path[1], path[2]));\n                            break;\n                        case \"Q\":\n                            d.qx = path[1];\n                            d.qy = path[2];\n                            path = [\"C\"][concat](q2c(d.x, d.y, path[1], path[2], path[3], path[4]));\n                            break;\n                        case \"L\":\n                            path = [\"C\"][concat](l2c(d.x, d.y, path[1], path[2]));\n                            break;\n                        case \"H\":\n                            path = [\"C\"][concat](l2c(d.x, d.y, path[1], d.y));\n                            break;\n                        case \"V\":\n                            path = [\"C\"][concat](l2c(d.x, d.y, d.x, path[1]));\n                            break;\n                        case \"Z\":\n                            path = [\"C\"][concat](l2c(d.x, d.y, d.X, d.Y));\n                            break;\n                    }\n                    return path;\n                },\n                fixArc = function (pp, i) {\n                    if (pp[i][length] > 7) {\n                        pp[i].shift();\n                        var pi = pp[i];\n                        while (pi[length]) {\n                            pp.splice(i++, 0, [\"C\"][concat](pi.splice(0, 6)));\n                        }\n                        pp.splice(i, 1);\n                        ii = mmax(p[length], p2 && p2[length] || 0);\n                    }\n                },\n                fixM = function (path1, path2, a1, a2, i) {\n                    if (path1 && path2 && path1[i][0] == \"M\" && path2[i][0] != \"M\") {\n                        path2.splice(i, 0, [\"M\", a2.x, a2.y]);\n                        a1.bx = 0;\n                        a1.by = 0;\n                        a1.x = path1[i][1];\n                        a1.y = path1[i][2];\n                        ii = mmax(p[length], p2 && p2[length] || 0);\n                    }\n                };\n            for (var i = 0, ii = mmax(p[length], p2 && p2[length] || 0); i < ii; i++) {\n                p[i] = processPath(p[i], attrs);\n                fixArc(p, i);\n                p2 && (p2[i] = processPath(p2[i], attrs2));\n                p2 && fixArc(p2, i);\n                fixM(p, p2, attrs, attrs2, i);\n                fixM(p2, p, attrs2, attrs, i);\n                var seg = p[i],\n                    seg2 = p2 && p2[i],\n                    seglen = seg[length],\n                    seg2len = p2 && seg2[length];\n                attrs.x = seg[seglen - 2];\n                attrs.y = seg[seglen - 1];\n                attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\n                attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\n                attrs2.bx = p2 && (toFloat(seg2[seg2len - 4]) || attrs2.x);\n                attrs2.by = p2 && (toFloat(seg2[seg2len - 3]) || attrs2.y);\n                attrs2.x = p2 && seg2[seg2len - 2];\n                attrs2.y = p2 && seg2[seg2len - 1];\n            }\n            return p2 ? [p, p2] : p;\n        }, null, pathClone),\n        parseDots = cacher(function (gradient) {\n            var dots = [];\n            for (var i = 0, ii = gradient[length]; i < ii; i++) {\n                var dot = {},\n                    par = gradient[i].match(/^([^:]*):?([\\d\\.]*)/);\n                dot.color = R.getRGB(par[1]);\n                if (dot.color.error) {\n                    return null;\n                }\n                dot.color = dot.color.hex;\n                par[2] && (dot.offset = par[2] + \"%\");\n                dots[push](dot);\n            }\n            for (i = 1, ii = dots[length] - 1; i < ii; i++) {\n                if (!dots[i].offset) {\n                    var start = toFloat(dots[i - 1].offset || 0),\n                        end = 0;\n                    for (var j = i + 1; j < ii; j++) {\n                        if (dots[j].offset) {\n                            end = dots[j].offset;\n                            break;\n                        }\n                    }\n                    if (!end) {\n                        end = 100;\n                        j = ii;\n                    }\n                    end = toFloat(end);\n                    var d = (end - start) / (j - i + 1);\n                    for (; i < j; i++) {\n                        start += d;\n                        dots[i].offset = start + \"%\";\n                    }\n                }\n            }\n            return dots;\n        }),\n        getContainer = function (x, y, w, h) {\n            var container;\n            if (R.is(x, string) || R.is(x, \"object\")) {\n                container = R.is(x, string) ? doc.getElementById(x) : x;\n                if (container.tagName) {\n                    if (y == null) {\n                        return {\n                            container: container,\n                            width: container.style.pixelWidth || container.offsetWidth,\n                            height: container.style.pixelHeight || container.offsetHeight\n                        };\n                    } else {\n                        return {container: container, width: y, height: w};\n                    }\n                }\n            } else {\n                return {container: 1, x: x, y: y, width: w, height: h};\n            }\n        },\n        plugins = function (con, add) {\n            var that = this;\n            for (var prop in add) {\n                if (add[has](prop) && !(prop in con)) {\n                    switch (typeof add[prop]) {\n                        case \"function\":\n                            (function (f) {\n                                con[prop] = con === that ? f : function () { return f[apply](that, arguments); };\n                            })(add[prop]);\n                        break;\n                        case \"object\":\n                            con[prop] = con[prop] || {};\n                            plugins.call(this, con[prop], add[prop]);\n                        break;\n                        default:\n                            con[prop] = add[prop];\n                        break;\n                    }\n                }\n            }\n        },\n        tear = function (el, paper) {\n            el == paper.top && (paper.top = el.prev);\n            el == paper.bottom && (paper.bottom = el.next);\n            el.next && (el.next.prev = el.prev);\n            el.prev && (el.prev.next = el.next);\n        },\n        tofront = function (el, paper) {\n            if (paper.top === el) {\n                return;\n            }\n            tear(el, paper);\n            el.next = null;\n            el.prev = paper.top;\n            paper.top.next = el;\n            paper.top = el;\n        },\n        toback = function (el, paper) {\n            if (paper.bottom === el) {\n                return;\n            }\n            tear(el, paper);\n            el.next = paper.bottom;\n            el.prev = null;\n            paper.bottom.prev = el;\n            paper.bottom = el;\n        },\n        insertafter = function (el, el2, paper) {\n            tear(el, paper);\n            el2 == paper.top && (paper.top = el);\n            el2.next && (el2.next.prev = el);\n            el.next = el2.next;\n            el.prev = el2;\n            el2.next = el;\n        },\n        insertbefore = function (el, el2, paper) {\n            tear(el, paper);\n            el2 == paper.bottom && (paper.bottom = el);\n            el2.prev && (el2.prev.next = el);\n            el.prev = el2.prev;\n            el2.prev = el;\n            el.next = el2;\n        },\n        removed = function (methodname) {\n            return function () {\n                throw new Error(\"Rapha\\xebl: you are calling to method \\u201c\" + methodname + \"\\u201d of removed object\");\n            };\n        };\n    R.pathToRelative = pathToRelative;\n    // SVG\n    if (R.svg) {\n        paperproto.svgns = \"http://www.w3.org/2000/svg\";\n        paperproto.xlink = \"http://www.w3.org/1999/xlink\";\n        round = function (num) {\n            return +num + (~~num === num) * .5;\n        };\n        var $ = function (el, attr) {\n            if (attr) {\n                for (var key in attr) {\n                    if (attr[has](key)) {\n                        setAttr(el, key, Str(attr[key]));\n                    }\n                }\n            } else {\n                el = doc.createElementNS(paperproto.svgns, el);\n                el.style.webkitTapHighlightColor = \"rgba(0,0,0,0)\";\n                return el;\n            }\n        };\n        R[toString] = function () {\n            return  \"Your browser supports SVG.\\nYou are running Rapha\\xebl \" + this.version;\n        };\n        var thePath = function (pathString, SVG) {\n            var el = $(\"path\");\n            SVG.canvas && SVG.canvas[appendChild](el);\n            var p = new Element(el, SVG);\n            p.type = \"path\";\n            setFillAndStroke(p, {fill: \"none\", stroke: \"#000\", path: pathString});\n            return p;\n        };\n        var addGradientFill = function (o, gradient, SVG) {\n            var type = \"linear\",\n                fx = .5, fy = .5,\n                s = o.style;\n            gradient = Str(gradient)[rp](radial_gradient, function (all, _fx, _fy) {\n                type = \"radial\";\n                if (_fx && _fy) {\n                    fx = toFloat(_fx);\n                    fy = toFloat(_fy);\n                    var dir = ((fy > .5) * 2 - 1);\n                    pow(fx - .5, 2) + pow(fy - .5, 2) > .25 &&\n                        (fy = math.sqrt(.25 - pow(fx - .5, 2)) * dir + .5) &&\n                        fy != .5 &&\n                        (fy = fy.toFixed(5) - 1e-5 * dir);\n                }\n                return E;\n            });\n            gradient = gradient[split](/\\s*\\-\\s*/);\n            if (type == \"linear\") {\n                var angle = gradient.shift();\n                angle = -toFloat(angle);\n                if (isNaN(angle)) {\n                    return null;\n                }\n                var vector = [0, 0, math.cos(angle * PI / 180), math.sin(angle * PI / 180)],\n                    max = 1 / (mmax(abs(vector[2]), abs(vector[3])) || 1);\n                vector[2] *= max;\n                vector[3] *= max;\n                if (vector[2] < 0) {\n                    vector[0] = -vector[2];\n                    vector[2] = 0;\n                }\n                if (vector[3] < 0) {\n                    vector[1] = -vector[3];\n                    vector[3] = 0;\n                }\n            }\n            var dots = parseDots(gradient);\n            if (!dots) {\n                return null;\n            }\n            var id = o.getAttribute(fillString);\n            id = id.match(/^url\\(#(.*)\\)$/);\n            id && SVG.defs.removeChild(doc.getElementById(id[1]));\n\n            var el = $(type + \"Gradient\");\n            el.id = createUUID();\n            $(el, type == \"radial\" ? {fx: fx, fy: fy} : {x1: vector[0], y1: vector[1], x2: vector[2], y2: vector[3]});\n            SVG.defs[appendChild](el);\n            for (var i = 0, ii = dots[length]; i < ii; i++) {\n                var stop = $(\"stop\");\n                $(stop, {\n                    offset: dots[i].offset ? dots[i].offset : !i ? \"0%\" : \"100%\",\n                    \"stop-color\": dots[i].color || \"#fff\"\n                });\n                el[appendChild](stop);\n            }\n            $(o, {\n                fill: \"url(#\" + el.id + \")\",\n                opacity: 1,\n                \"fill-opacity\": 1\n            });\n            s.fill = E;\n            s.opacity = 1;\n            s.fillOpacity = 1;\n            return 1;\n        };\n        var updatePosition = function (o) {\n            var bbox = o.getBBox();\n            $(o.pattern, {patternTransform: R.format(\"translate({0},{1})\", bbox.x, bbox.y)});\n        };\n        var setFillAndStroke = function (o, params) {\n            var dasharray = {\n                    \"\": [0],\n                    \"none\": [0],\n                    \"-\": [3, 1],\n                    \".\": [1, 1],\n                    \"-.\": [3, 1, 1, 1],\n                    \"-..\": [3, 1, 1, 1, 1, 1],\n                    \". \": [1, 3],\n                    \"- \": [4, 3],\n                    \"--\": [8, 3],\n                    \"- .\": [4, 3, 1, 3],\n                    \"--.\": [8, 3, 1, 3],\n                    \"--..\": [8, 3, 1, 3, 1, 3]\n                },\n                node = o.node,\n                attrs = o.attrs,\n                rot = o.rotate(),\n                addDashes = function (o, value) {\n                    value = dasharray[lowerCase.call(value)];\n                    if (value) {\n                        var width = o.attrs[\"stroke-width\"] || \"1\",\n                            butt = {round: width, square: width, butt: 0}[o.attrs[\"stroke-linecap\"] || params[\"stroke-linecap\"]] || 0,\n                            dashes = [];\n                        var i = value[length];\n                        while (i--) {\n                            dashes[i] = value[i] * width + ((i % 2) ? 1 : -1) * butt;\n                        }\n                        $(node, {\"stroke-dasharray\": dashes[join](\",\")});\n                    }\n                };\n            params[has](\"rotation\") && (rot = params.rotation);\n            var rotxy = Str(rot)[split](separator);\n            if (!(rotxy.length - 1)) {\n                rotxy = null;\n            } else {\n                rotxy[1] = +rotxy[1];\n                rotxy[2] = +rotxy[2];\n            }\n            toFloat(rot) && o.rotate(0, true);\n            for (var att in params) {\n                if (params[has](att)) {\n                    if (!availableAttrs[has](att)) {\n                        continue;\n                    }\n                    var value = params[att];\n                    attrs[att] = value;\n                    switch (att) {\n                        case \"blur\":\n                            o.blur(value);\n                            break;\n                        case \"rotation\":\n                            o.rotate(value, true);\n                            break;\n                        case \"href\":\n                        case \"title\":\n                        case \"target\":\n                            var pn = node.parentNode;\n                            if (lowerCase.call(pn.tagName) != \"a\") {\n                                var hl = $(\"a\");\n                                pn.insertBefore(hl, node);\n                                hl[appendChild](node);\n                                pn = hl;\n                            }\n                            if (att == \"target\" && value == \"blank\") {\n                                pn.setAttributeNS(o.paper.xlink, \"show\", \"new\");\n                            } else {\n                                pn.setAttributeNS(o.paper.xlink, att, value);\n                            }\n                            break;\n                        case \"cursor\":\n                            node.style.cursor = value;\n                            break;\n                        case \"clip-rect\":\n                            var rect = Str(value)[split](separator);\n                            if (rect[length] == 4) {\n                                o.clip && o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);\n                                var el = $(\"clipPath\"),\n                                    rc = $(\"rect\");\n                                el.id = createUUID();\n                                $(rc, {\n                                    x: rect[0],\n                                    y: rect[1],\n                                    width: rect[2],\n                                    height: rect[3]\n                                });\n                                el[appendChild](rc);\n                                o.paper.defs[appendChild](el);\n                                $(node, {\"clip-path\": \"url(#\" + el.id + \")\"});\n                                o.clip = rc;\n                            }\n                            if (!value) {\n                                var clip = doc.getElementById(node.getAttribute(\"clip-path\")[rp](/(^url\\(#|\\)$)/g, E));\n                                clip && clip.parentNode.removeChild(clip);\n                                $(node, {\"clip-path\": E});\n                                delete o.clip;\n                            }\n                        break;\n                        case \"path\":\n                            if (o.type == \"path\") {\n                                $(node, {d: value ? attrs.path = pathToAbsolute(value) : \"M0,0\"});\n                            }\n                            break;\n                        case \"width\":\n                            setAttr(node, att, value);\n                            if (attrs.fx) {\n                                att = \"x\";\n                                value = attrs.x;\n                            } else {\n                                break;\n                            }\n                        case \"x\":\n                            if (attrs.fx) {\n                                value = -attrs.x - (attrs.width || 0);\n                            }\n                        case \"rx\":\n                            if (att == \"rx\" && o.type == \"rect\") {\n                                break;\n                            }\n                        case \"cx\":\n                            rotxy && (att == \"x\" || att == \"cx\") && (rotxy[1] += value - attrs[att]);\n                            setAttr(node, att, value);\n                            o.pattern && updatePosition(o);\n                            break;\n                        case \"height\":\n                            setAttr(node, att, value);\n                            if (attrs.fy) {\n                                att = \"y\";\n                                value = attrs.y;\n                            } else {\n                                break;\n                            }\n                        case \"y\":\n                            if (attrs.fy) {\n                                value = -attrs.y - (attrs.height || 0);\n                            }\n                        case \"ry\":\n                            if (att == \"ry\" && o.type == \"rect\") {\n                                break;\n                            }\n                        case \"cy\":\n                            rotxy && (att == \"y\" || att == \"cy\") && (rotxy[2] += value - attrs[att]);\n                            setAttr(node, att, value);\n                            o.pattern && updatePosition(o);\n                            break;\n                        case \"r\":\n                            if (o.type == \"rect\") {\n                                $(node, {rx: value, ry: value});\n                            } else {\n                                setAttr(node, att, value);\n                            }\n                            break;\n                        case \"src\":\n                            if (o.type == \"image\") {\n                                node.setAttributeNS(o.paper.xlink, \"href\", value);\n                            }\n                            break;\n                        case \"stroke-width\":\n                            node.style.strokeWidth = value;\n                            // Need following line for Firefox\n                            setAttr(node, att, value);\n                            if (attrs[\"stroke-dasharray\"]) {\n                                addDashes(o, attrs[\"stroke-dasharray\"]);\n                            }\n                            break;\n                        case \"stroke-dasharray\":\n                            addDashes(o, value);\n                            break;\n                        case \"translation\":\n                            var xy = Str(value)[split](separator);\n                            xy[0] = +xy[0] || 0;\n                            xy[1] = +xy[1] || 0;\n                            if (rotxy) {\n                                rotxy[1] += xy[0];\n                                rotxy[2] += xy[1];\n                            }\n                            translate.call(o, xy[0], xy[1]);\n                            break;\n                        case \"scale\":\n                            xy = Str(value)[split](separator);\n                            o.scale(+xy[0] || 1, +xy[1] || +xy[0] || 1, isNaN(toFloat(xy[2])) ? null : +xy[2], isNaN(toFloat(xy[3])) ? null : +xy[3]);\n                            break;\n                        case fillString:\n                            var isURL = Str(value).match(ISURL);\n                            if (isURL) {\n                                el = $(\"pattern\");\n                                var ig = $(\"image\");\n                                el.id = createUUID();\n                                $(el, {x: 0, y: 0, patternUnits: \"userSpaceOnUse\", height: 1, width: 1});\n                                $(ig, {x: 0, y: 0});\n                                ig.setAttributeNS(o.paper.xlink, \"href\", isURL[1]);\n                                el[appendChild](ig);\n\n                                var img = doc.createElement(\"img\");\n                                img.style.cssText = \"position:absolute;left:-9999em;top-9999em\";\n                                img.onload = function () {\n                                    $(el, {width: this.offsetWidth, height: this.offsetHeight});\n                                    $(ig, {width: this.offsetWidth, height: this.offsetHeight});\n                                    doc.body.removeChild(this);\n                                    o.paper.safari();\n                                };\n                                doc.body[appendChild](img);\n                                img.src = isURL[1];\n                                o.paper.defs[appendChild](el);\n                                node.style.fill = \"url(#\" + el.id + \")\";\n                                $(node, {fill: \"url(#\" + el.id + \")\"});\n                                o.pattern = el;\n                                o.pattern && updatePosition(o);\n                                break;\n                            }\n                            var clr = R.getRGB(value);\n                            if (!clr.error) {\n                                delete params.gradient;\n                                delete attrs.gradient;\n                                !R.is(attrs.opacity, \"undefined\") &&\n                                    R.is(params.opacity, \"undefined\") &&\n                                    $(node, {opacity: attrs.opacity});\n                                !R.is(attrs[\"fill-opacity\"], \"undefined\") &&\n                                    R.is(params[\"fill-opacity\"], \"undefined\") &&\n                                    $(node, {\"fill-opacity\": attrs[\"fill-opacity\"]});\n                            } else if ((({circle: 1, ellipse: 1})[has](o.type) || Str(value).charAt() != \"r\") && addGradientFill(node, value, o.paper)) {\n                                attrs.gradient = value;\n                                attrs.fill = \"none\";\n                                break;\n                            }\n                            clr[has](\"opacity\") && $(node, {\"fill-opacity\": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\n                        case \"stroke\":\n                            clr = R.getRGB(value);\n                            setAttr(node, att, clr.hex);\n                            att == \"stroke\" && clr[has](\"opacity\") && $(node, {\"stroke-opacity\": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\n                            break;\n                        case \"gradient\":\n                            (({circle: 1, ellipse: 1})[has](o.type) || Str(value).charAt() != \"r\") && addGradientFill(node, value, o.paper);\n                            break;\n                        case \"opacity\":\n                            if (attrs.gradient && !attrs[has](\"stroke-opacity\")) {\n                                $(node, {\"stroke-opacity\": value > 1 ? value / 100 : value});\n                            }\n                            // fall\n                        case \"fill-opacity\":\n                            if (attrs.gradient) {\n                                var gradient = doc.getElementById(node.getAttribute(fillString)[rp](/^url\\(#|\\)$/g, E));\n                                if (gradient) {\n                                    var stops = gradient.getElementsByTagName(\"stop\");\n                                    setAttr(stops[stops[length] - 1], \"stop-opacity\", value);\n                                }\n                                break;\n                            }\n                        default:\n                            att == \"font-size\" && (value = toInt(value, 10) + \"px\");\n                            var cssrule = att[rp](/(\\-.)/g, function (w) {\n                                return upperCase.call(w.substring(1));\n                            });\n                            node.style[cssrule] = value;\n                            // Need following line for Firefox\n                            setAttr(node, att, value);\n                            break;\n                    }\n                }\n            }\n\n            tuneText(o, params);\n            if (rotxy) {\n                o.rotate(rotxy.join(S));\n            } else {\n                toFloat(rot) && o.rotate(rot, true);\n            }\n        };\n        var leading = 1.2,\n        tuneText = function (el, params) {\n            if (el.type != \"text\" || !(params[has](\"text\") || params[has](\"font\") || params[has](\"font-size\") || params[has](\"x\") || params[has](\"y\"))) {\n                return;\n            }\n            var a = el.attrs,\n                node = el.node,\n                fontSize = node.firstChild ? toInt(doc.defaultView.getComputedStyle(node.firstChild, E).getPropertyValue(\"font-size\"), 10) : 10;\n\n            if (params[has](\"text\")) {\n                a.text = params.text;\n                while (node.firstChild) {\n                    node.removeChild(node.firstChild);\n                }\n                var texts = Str(params.text)[split](\"\\n\");\n                for (var i = 0, ii = texts[length]; i < ii; i++) if (texts[i]) {\n                    var tspan = $(\"tspan\");\n                    i && $(tspan, {dy: fontSize * leading, x: a.x});\n                    tspan[appendChild](doc.createTextNode(texts[i]));\n                    node[appendChild](tspan);\n                }\n            } else {\n                texts = node.getElementsByTagName(\"tspan\");\n                for (i = 0, ii = texts[length]; i < ii; i++) {\n                    i && $(texts[i], {dy: fontSize * leading, x: a.x});\n                }\n            }\n            $(node, {y: a.y});\n            var bb = el.getBBox(),\n                dif = a.y - (bb.y + bb.height / 2);\n            dif && R.is(dif, \"finite\") && $(node, {y: a.y + dif});\n        },\n        Element = function (node, svg) {\n            var X = 0,\n                Y = 0;\n            this[0] = node;\n            this.id = R._oid++;\n            this.node = node;\n            node.raphael = this;\n            this.paper = svg;\n            this.attrs = this.attrs || {};\n            this.transformations = []; // rotate, translate, scale\n            this._ = {\n                tx: 0,\n                ty: 0,\n                rt: {deg: 0, cx: 0, cy: 0},\n                sx: 1,\n                sy: 1\n            };\n            !svg.bottom && (svg.bottom = this);\n            this.prev = svg.top;\n            svg.top && (svg.top.next = this);\n            svg.top = this;\n            this.next = null;\n        };\n        var elproto = Element[proto];\n        Element[proto].rotate = function (deg, cx, cy) {\n            if (this.removed) {\n                return this;\n            }\n            if (deg == null) {\n                if (this._.rt.cx) {\n                    return [this._.rt.deg, this._.rt.cx, this._.rt.cy][join](S);\n                }\n                return this._.rt.deg;\n            }\n            var bbox = this.getBBox();\n            deg = Str(deg)[split](separator);\n            if (deg[length] - 1) {\n                cx = toFloat(deg[1]);\n                cy = toFloat(deg[2]);\n            }\n            deg = toFloat(deg[0]);\n            if (cx != null && cx !== false) {\n                this._.rt.deg = deg;\n            } else {\n                this._.rt.deg += deg;\n            }\n            (cy == null) && (cx = null);\n            this._.rt.cx = cx;\n            this._.rt.cy = cy;\n            cx = cx == null ? bbox.x + bbox.width / 2 : cx;\n            cy = cy == null ? bbox.y + bbox.height / 2 : cy;\n            if (this._.rt.deg) {\n                this.transformations[0] = R.format(\"rotate({0} {1} {2})\", this._.rt.deg, cx, cy);\n                this.clip && $(this.clip, {transform: R.format(\"rotate({0} {1} {2})\", -this._.rt.deg, cx, cy)});\n            } else {\n                this.transformations[0] = E;\n                this.clip && $(this.clip, {transform: E});\n            }\n            $(this.node, {transform: this.transformations[join](S)});\n            return this;\n        };\n        Element[proto].hide = function () {\n            !this.removed && (this.node.style.display = \"none\");\n            return this;\n        };\n        Element[proto].show = function () {\n            !this.removed && (this.node.style.display = \"\");\n            return this;\n        };\n        Element[proto].remove = function () {\n            if (this.removed) {\n                return;\n            }\n            tear(this, this.paper);\n            this.node.parentNode.removeChild(this.node);\n            for (var i in this) {\n                delete this[i];\n            }\n            this.removed = true;\n        };\n        Element[proto].getBBox = function () {\n            if (this.removed) {\n                return this;\n            }\n            if (this.type == \"path\") {\n                return pathDimensions(this.attrs.path);\n            }\n            if (this.node.style.display == \"none\") {\n                this.show();\n                var hide = true;\n            }\n            var bbox = {};\n            try {\n                bbox = this.node.getBBox();\n            } catch(e) {\n                // Firefox 3.0.x plays badly here\n            } finally {\n                bbox = bbox || {};\n            }\n            if (this.type == \"text\") {\n                bbox = {x: bbox.x, y: Infinity, width: 0, height: 0};\n                for (var i = 0, ii = this.node.getNumberOfChars(); i < ii; i++) {\n                    var bb = this.node.getExtentOfChar(i);\n                    (bb.y < bbox.y) && (bbox.y = bb.y);\n                    (bb.y + bb.height - bbox.y > bbox.height) && (bbox.height = bb.y + bb.height - bbox.y);\n                    (bb.x + bb.width - bbox.x > bbox.width) && (bbox.width = bb.x + bb.width - bbox.x);\n                }\n            }\n            hide && this.hide();\n            return bbox;\n        };\n        Element[proto].attr = function (name, value) {\n            if (this.removed) {\n                return this;\n            }\n            if (name == null) {\n                var res = {};\n                for (var i in this.attrs) if (this.attrs[has](i)) {\n                    res[i] = this.attrs[i];\n                }\n                this._.rt.deg && (res.rotation = this.rotate());\n                (this._.sx != 1 || this._.sy != 1) && (res.scale = this.scale());\n                res.gradient && res.fill == \"none\" && (res.fill = res.gradient) && delete res.gradient;\n                return res;\n            }\n            if (value == null && R.is(name, string)) {\n                if (name == \"translation\") {\n                    return translate.call(this);\n                }\n                if (name == \"rotation\") {\n                    return this.rotate();\n                }\n                if (name == \"scale\") {\n                    return this.scale();\n                }\n                if (name == fillString && this.attrs.fill == \"none\" && this.attrs.gradient) {\n                    return this.attrs.gradient;\n                }\n                return this.attrs[name];\n            }\n            if (value == null && R.is(name, array)) {\n                var values = {};\n                for (var j = 0, jj = name.length; j < jj; j++) {\n                    values[name[j]] = this.attr(name[j]);\n                }\n                return values;\n            }\n            if (value != null) {\n                var params = {};\n                params[name] = value;\n            } else if (name != null && R.is(name, \"object\")) {\n                params = name;\n            }\n            for (var key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], \"function\")) {\n                var par = this.paper.customAttributes[key].apply(this, [][concat](params[key]));\n                this.attrs[key] = params[key];\n                for (var subkey in par) if (par[has](subkey)) {\n                    params[subkey] = par[subkey];\n                }\n            }\n            setFillAndStroke(this, params);\n            return this;\n        };\n        Element[proto].toFront = function () {\n            if (this.removed) {\n                return this;\n            }\n            this.node.parentNode[appendChild](this.node);\n            var svg = this.paper;\n            svg.top != this && tofront(this, svg);\n            return this;\n        };\n        Element[proto].toBack = function () {\n            if (this.removed) {\n                return this;\n            }\n            if (this.node.parentNode.firstChild != this.node) {\n                this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild);\n                toback(this, this.paper);\n                var svg = this.paper;\n            }\n            return this;\n        };\n        Element[proto].insertAfter = function (element) {\n            if (this.removed) {\n                return this;\n            }\n            var node = element.node || element[element.length - 1].node;\n            if (node.nextSibling) {\n                node.parentNode.insertBefore(this.node, node.nextSibling);\n            } else {\n                node.parentNode[appendChild](this.node);\n            }\n            insertafter(this, element, this.paper);\n            return this;\n        };\n        Element[proto].insertBefore = function (element) {\n            if (this.removed) {\n                return this;\n            }\n            var node = element.node || element[0].node;\n            node.parentNode.insertBefore(this.node, node);\n            insertbefore(this, element, this.paper);\n            return this;\n        };\n        Element[proto].blur = function (size) {\n            // Experimental. No Safari support. Use it on your own risk.\n            var t = this;\n            if (+size !== 0) {\n                var fltr = $(\"filter\"),\n                    blur = $(\"feGaussianBlur\");\n                t.attrs.blur = size;\n                fltr.id = createUUID();\n                $(blur, {stdDeviation: +size || 1.5});\n                fltr.appendChild(blur);\n                t.paper.defs.appendChild(fltr);\n                t._blur = fltr;\n                $(t.node, {filter: \"url(#\" + fltr.id + \")\"});\n            } else {\n                if (t._blur) {\n                    t._blur.parentNode.removeChild(t._blur);\n                    delete t._blur;\n                    delete t.attrs.blur;\n                }\n                t.node.removeAttribute(\"filter\");\n            }\n        };\n        var theCircle = function (svg, x, y, r) {\n            var el = $(\"circle\");\n            svg.canvas && svg.canvas[appendChild](el);\n            var res = new Element(el, svg);\n            res.attrs = {cx: x, cy: y, r: r, fill: \"none\", stroke: \"#000\"};\n            res.type = \"circle\";\n            $(el, res.attrs);\n            return res;\n        },\n        theRect = function (svg, x, y, w, h, r) {\n            var el = $(\"rect\");\n            svg.canvas && svg.canvas[appendChild](el);\n            var res = new Element(el, svg);\n            res.attrs = {x: x, y: y, width: w, height: h, r: r || 0, rx: r || 0, ry: r || 0, fill: \"none\", stroke: \"#000\"};\n            res.type = \"rect\";\n            $(el, res.attrs);\n            return res;\n        },\n        theEllipse = function (svg, x, y, rx, ry) {\n            var el = $(\"ellipse\");\n            svg.canvas && svg.canvas[appendChild](el);\n            var res = new Element(el, svg);\n            res.attrs = {cx: x, cy: y, rx: rx, ry: ry, fill: \"none\", stroke: \"#000\"};\n            res.type = \"ellipse\";\n            $(el, res.attrs);\n            return res;\n        },\n        theImage = function (svg, src, x, y, w, h) {\n            var el = $(\"image\");\n            $(el, {x: x, y: y, width: w, height: h, preserveAspectRatio: \"none\"});\n            el.setAttributeNS(svg.xlink, \"href\", src);\n            svg.canvas && svg.canvas[appendChild](el);\n            var res = new Element(el, svg);\n            res.attrs = {x: x, y: y, width: w, height: h, src: src};\n            res.type = \"image\";\n            return res;\n        },\n        theText = function (svg, x, y, text) {\n            var el = $(\"text\");\n            $(el, {x: x, y: y, \"text-anchor\": \"middle\"});\n            svg.canvas && svg.canvas[appendChild](el);\n            var res = new Element(el, svg);\n            res.attrs = {x: x, y: y, \"text-anchor\": \"middle\", text: text, font: availableAttrs.font, stroke: \"none\", fill: \"#000\"};\n            res.type = \"text\";\n            setFillAndStroke(res, res.attrs);\n            return res;\n        },\n        setSize = function (width, height) {\n            this.width = width || this.width;\n            this.height = height || this.height;\n            setAttr(this.canvas, \"width\", this.width);\n            setAttr(this.canvas, \"height\", this.height);\n            return this;\n        },\n        create = function () {\n            var con = getContainer[apply](0, arguments),\n                container = con && con.container,\n                x = con.x,\n                y = con.y,\n                width = con.width,\n                height = con.height;\n            if (!container) {\n                throw new Error(\"SVG container not found.\");\n            }\n            var cnvs = $(\"svg\");\n            x = x || 0;\n            y = y || 0;\n            width = width || 512;\n            height = height || 342;\n            $(cnvs, {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                version: 1.1,\n                width: width,\n                height: height\n            });\n            if (container == 1) {\n                cnvs.style.cssText = \"position:absolute;left:\" + x + \"px;top:\" + y + \"px\";\n                doc.body[appendChild](cnvs);\n            } else {\n                if (container.firstChild) {\n                    container.insertBefore(cnvs, container.firstChild);\n                } else {\n                    container[appendChild](cnvs);\n                }\n            }\n            container = new Paper;\n            container.width = width;\n            container.height = height;\n            container.canvas = cnvs;\n            plugins.call(container, container, R.fn);\n            container.clear();\n            return container;\n        };\n        paperproto.clear = function () {\n            var c = this.canvas;\n            while (c.firstChild) {\n                c.removeChild(c.firstChild);\n            }\n            this.bottom = this.top = null;\n            (this.desc = $(\"desc\"))[appendChild](doc.createTextNode(\"Created with Rapha\\xebl\"));\n            c[appendChild](this.desc);\n            c[appendChild](this.defs = $(\"defs\"));\n        };\n        paperproto.remove = function () {\n            this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);\n            for (var i in this) {\n                this[i] = removed(i);\n            }\n        };\n    }\n\n    // VML\n    if (R.vml) {\n        var map = {M: \"m\", L: \"l\", C: \"c\", Z: \"x\", m: \"t\", l: \"r\", c: \"v\", z: \"x\"},\n            bites = /([clmz]),?([^clmz]*)/gi,\n            blurregexp = / progid:\\S+Blur\\([^\\)]+\\)/g,\n            val = /-?[^,\\s-]+/g,\n            coordsize = 1e3 + S + 1e3,\n            zoom = 10,\n            pathlike = {path: 1, rect: 1},\n            path2vml = function (path) {\n                var total =  /[ahqstv]/ig,\n                    command = pathToAbsolute;\n                Str(path).match(total) && (command = path2curve);\n                total = /[clmz]/g;\n                if (command == pathToAbsolute && !Str(path).match(total)) {\n                    var res = Str(path)[rp](bites, function (all, command, args) {\n                        var vals = [],\n                            isMove = lowerCase.call(command) == \"m\",\n                            res = map[command];\n                        args[rp](val, function (value) {\n                            if (isMove && vals[length] == 2) {\n                                res += vals + map[command == \"m\" ? \"l\" : \"L\"];\n                                vals = [];\n                            }\n                            vals[push](round(value * zoom));\n                        });\n                        return res + vals;\n                    });\n                    return res;\n                }\n                var pa = command(path), p, r;\n                res = [];\n                for (var i = 0, ii = pa[length]; i < ii; i++) {\n                    p = pa[i];\n                    r = lowerCase.call(pa[i][0]);\n                    r == \"z\" && (r = \"x\");\n                    for (var j = 1, jj = p[length]; j < jj; j++) {\n                        r += round(p[j] * zoom) + (j != jj - 1 ? \",\" : E);\n                    }\n                    res[push](r);\n                }\n                return res[join](S);\n            };\n\n        R[toString] = function () {\n            return  \"Your browser doesn\\u2019t support SVG. Falling down to VML.\\nYou are running Rapha\\xebl \" + this.version;\n        };\n        thePath = function (pathString, vml) {\n            var g = createNode(\"group\");\n            g.style.cssText = \"position:absolute;left:0;top:0;width:\" + vml.width + \"px;height:\" + vml.height + \"px\";\n            g.coordsize = vml.coordsize;\n            g.coordorigin = vml.coordorigin;\n            var el = createNode(\"shape\"), ol = el.style;\n            ol.width = vml.width + \"px\";\n            ol.height = vml.height + \"px\";\n            el.coordsize = coordsize;\n            el.coordorigin = vml.coordorigin;\n            g[appendChild](el);\n            var p = new Element(el, g, vml),\n                attr = {fill: \"none\", stroke: \"#000\"};\n            pathString && (attr.path = pathString);\n            p.type = \"path\";\n            p.path = [];\n            p.Path = E;\n            setFillAndStroke(p, attr);\n            vml.canvas[appendChild](g);\n            return p;\n        };\n        setFillAndStroke = function (o, params) {\n            o.attrs = o.attrs || {};\n            var node = o.node,\n                a = o.attrs,\n                s = node.style,\n                xy,\n                newpath = (params.x != a.x || params.y != a.y || params.width != a.width || params.height != a.height || params.r != a.r) && o.type == \"rect\",\n                res = o;\n\n            for (var par in params) if (params[has](par)) {\n                a[par] = params[par];\n            }\n            if (newpath) {\n                a.path = rectPath(a.x, a.y, a.width, a.height, a.r);\n                o.X = a.x;\n                o.Y = a.y;\n                o.W = a.width;\n                o.H = a.height;\n            }\n            params.href && (node.href = params.href);\n            params.title && (node.title = params.title);\n            params.target && (node.target = params.target);\n            params.cursor && (s.cursor = params.cursor);\n            \"blur\" in params && o.blur(params.blur);\n            if (params.path && o.type == \"path\" || newpath) {\n                node.path = path2vml(a.path);\n            }\n            if (params.rotation != null) {\n                o.rotate(params.rotation, true);\n            }\n            if (params.translation) {\n                xy = Str(params.translation)[split](separator);\n                translate.call(o, xy[0], xy[1]);\n                if (o._.rt.cx != null) {\n                    o._.rt.cx +=+ xy[0];\n                    o._.rt.cy +=+ xy[1];\n                    o.setBox(o.attrs, xy[0], xy[1]);\n                }\n            }\n            if (params.scale) {\n                xy = Str(params.scale)[split](separator);\n                o.scale(+xy[0] || 1, +xy[1] || +xy[0] || 1, +xy[2] || null, +xy[3] || null);\n            }\n            if (\"clip-rect\" in params) {\n                var rect = Str(params[\"clip-rect\"])[split](separator);\n                if (rect[length] == 4) {\n                    rect[2] = +rect[2] + (+rect[0]);\n                    rect[3] = +rect[3] + (+rect[1]);\n                    var div = node.clipRect || doc.createElement(\"div\"),\n                        dstyle = div.style,\n                        group = node.parentNode;\n                    dstyle.clip = R.format(\"rect({1}px {2}px {3}px {0}px)\", rect);\n                    if (!node.clipRect) {\n                        dstyle.position = \"absolute\";\n                        dstyle.top = 0;\n                        dstyle.left = 0;\n                        dstyle.width = o.paper.width + \"px\";\n                        dstyle.height = o.paper.height + \"px\";\n                        group.parentNode.insertBefore(div, group);\n                        div[appendChild](group);\n                        node.clipRect = div;\n                    }\n                }\n                if (!params[\"clip-rect\"]) {\n                    node.clipRect && (node.clipRect.style.clip = E);\n                }\n            }\n            if (o.type == \"image\" && params.src) {\n                node.src = params.src;\n            }\n            if (o.type == \"image\" && params.opacity) {\n                node.filterOpacity = ms + \".Alpha(opacity=\" + (params.opacity * 100) + \")\";\n                s.filter = (node.filterMatrix || E) + (node.filterOpacity || E);\n            }\n            params.font && (s.font = params.font);\n            params[\"font-family\"] && (s.fontFamily = '\"' + params[\"font-family\"][split](\",\")[0][rp](/^['\"]+|['\"]+$/g, E) + '\"');\n            params[\"font-size\"] && (s.fontSize = params[\"font-size\"]);\n            params[\"font-weight\"] && (s.fontWeight = params[\"font-weight\"]);\n            params[\"font-style\"] && (s.fontStyle = params[\"font-style\"]);\n            if (params.opacity != null ||\n                params[\"stroke-width\"] != null ||\n                params.fill != null ||\n                params.stroke != null ||\n                params[\"stroke-width\"] != null ||\n                params[\"stroke-opacity\"] != null ||\n                params[\"fill-opacity\"] != null ||\n                params[\"stroke-dasharray\"] != null ||\n                params[\"stroke-miterlimit\"] != null ||\n                params[\"stroke-linejoin\"] != null ||\n                params[\"stroke-linecap\"] != null) {\n                node = o.shape || node;\n                var fill = (node.getElementsByTagName(fillString) && node.getElementsByTagName(fillString)[0]),\n                    newfill = false;\n                !fill && (newfill = fill = createNode(fillString));\n                if (\"fill-opacity\" in params || \"opacity\" in params) {\n                    var opacity = ((+a[\"fill-opacity\"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+R.getRGB(params.fill).o + 1 || 2) - 1);\n                    opacity = mmin(mmax(opacity, 0), 1);\n                    fill.opacity = opacity;\n                }\n                params.fill && (fill.on = true);\n                if (fill.on == null || params.fill == \"none\") {\n                    fill.on = false;\n                }\n                if (fill.on && params.fill) {\n                    var isURL = params.fill.match(ISURL);\n                    if (isURL) {\n                        fill.src = isURL[1];\n                        fill.type = \"tile\";\n                    } else {\n                        fill.color = R.getRGB(params.fill).hex;\n                        fill.src = E;\n                        fill.type = \"solid\";\n                        if (R.getRGB(params.fill).error && (res.type in {circle: 1, ellipse: 1} || Str(params.fill).charAt() != \"r\") && addGradientFill(res, params.fill)) {\n                            a.fill = \"none\";\n                            a.gradient = params.fill;\n                        }\n                    }\n                }\n                newfill && node[appendChild](fill);\n                var stroke = (node.getElementsByTagName(\"stroke\") && node.getElementsByTagName(\"stroke\")[0]),\n                newstroke = false;\n                !stroke && (newstroke = stroke = createNode(\"stroke\"));\n                if ((params.stroke && params.stroke != \"none\") ||\n                    params[\"stroke-width\"] ||\n                    params[\"stroke-opacity\"] != null ||\n                    params[\"stroke-dasharray\"] ||\n                    params[\"stroke-miterlimit\"] ||\n                    params[\"stroke-linejoin\"] ||\n                    params[\"stroke-linecap\"]) {\n                    stroke.on = true;\n                }\n                (params.stroke == \"none\" || stroke.on == null || params.stroke == 0 || params[\"stroke-width\"] == 0) && (stroke.on = false);\n                var strokeColor = R.getRGB(params.stroke);\n                stroke.on && params.stroke && (stroke.color = strokeColor.hex);\n                opacity = ((+a[\"stroke-opacity\"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+strokeColor.o + 1 || 2) - 1);\n                var width = (toFloat(params[\"stroke-width\"]) || 1) * .75;\n                opacity = mmin(mmax(opacity, 0), 1);\n                params[\"stroke-width\"] == null && (width = a[\"stroke-width\"]);\n                params[\"stroke-width\"] && (stroke.weight = width);\n                width && width < 1 && (opacity *= width) && (stroke.weight = 1);\n                stroke.opacity = opacity;\n\n                params[\"stroke-linejoin\"] && (stroke.joinstyle = params[\"stroke-linejoin\"] || \"miter\");\n                stroke.miterlimit = params[\"stroke-miterlimit\"] || 8;\n                params[\"stroke-linecap\"] && (stroke.endcap = params[\"stroke-linecap\"] == \"butt\" ? \"flat\" : params[\"stroke-linecap\"] == \"square\" ? \"square\" : \"round\");\n                if (params[\"stroke-dasharray\"]) {\n                    var dasharray = {\n                        \"-\": \"shortdash\",\n                        \".\": \"shortdot\",\n                        \"-.\": \"shortdashdot\",\n                        \"-..\": \"shortdashdotdot\",\n                        \". \": \"dot\",\n                        \"- \": \"dash\",\n                        \"--\": \"longdash\",\n                        \"- .\": \"dashdot\",\n                        \"--.\": \"longdashdot\",\n                        \"--..\": \"longdashdotdot\"\n                    };\n                    stroke.dashstyle = dasharray[has](params[\"stroke-dasharray\"]) ? dasharray[params[\"stroke-dasharray\"]] : E;\n                }\n                newstroke && node[appendChild](stroke);\n            }\n            if (res.type == \"text\") {\n                s = res.paper.span.style;\n                a.font && (s.font = a.font);\n                a[\"font-family\"] && (s.fontFamily = a[\"font-family\"]);\n                a[\"font-size\"] && (s.fontSize = a[\"font-size\"]);\n                a[\"font-weight\"] && (s.fontWeight = a[\"font-weight\"]);\n                a[\"font-style\"] && (s.fontStyle = a[\"font-style\"]);\n                res.node.string && (res.paper.span.innerHTML = Str(res.node.string)[rp](/</g, \"&#60;\")[rp](/&/g, \"&#38;\")[rp](/\\n/g, \"<br>\"));\n                res.W = a.w = res.paper.span.offsetWidth;\n                res.H = a.h = res.paper.span.offsetHeight;\n                res.X = a.x;\n                res.Y = a.y + round(res.H / 2);\n\n                // text-anchor emulationm\n                switch (a[\"text-anchor\"]) {\n                    case \"start\":\n                        res.node.style[\"v-text-align\"] = \"left\";\n                        res.bbx = round(res.W / 2);\n                    break;\n                    case \"end\":\n                        res.node.style[\"v-text-align\"] = \"right\";\n                        res.bbx = -round(res.W / 2);\n                    break;\n                    default:\n                        res.node.style[\"v-text-align\"] = \"center\";\n                    break;\n                }\n            }\n        };\n        addGradientFill = function (o, gradient) {\n            o.attrs = o.attrs || {};\n            var attrs = o.attrs,\n                fill,\n                type = \"linear\",\n                fxfy = \".5 .5\";\n            o.attrs.gradient = gradient;\n            gradient = Str(gradient)[rp](radial_gradient, function (all, fx, fy) {\n                type = \"radial\";\n                if (fx && fy) {\n                    fx = toFloat(fx);\n                    fy = toFloat(fy);\n                    pow(fx - .5, 2) + pow(fy - .5, 2) > .25 && (fy = math.sqrt(.25 - pow(fx - .5, 2)) * ((fy > .5) * 2 - 1) + .5);\n                    fxfy = fx + S + fy;\n                }\n                return E;\n            });\n            gradient = gradient[split](/\\s*\\-\\s*/);\n            if (type == \"linear\") {\n                var angle = gradient.shift();\n                angle = -toFloat(angle);\n                if (isNaN(angle)) {\n                    return null;\n                }\n            }\n            var dots = parseDots(gradient);\n            if (!dots) {\n                return null;\n            }\n            o = o.shape || o.node;\n            fill = o.getElementsByTagName(fillString)[0] || createNode(fillString);\n            !fill.parentNode && o.appendChild(fill);\n            if (dots[length]) {\n                fill.on = true;\n                fill.method = \"none\";\n                fill.color = dots[0].color;\n                fill.color2 = dots[dots[length] - 1].color;\n                var clrs = [];\n                for (var i = 0, ii = dots[length]; i < ii; i++) {\n                    dots[i].offset && clrs[push](dots[i].offset + S + dots[i].color);\n                }\n                fill.colors && (fill.colors.value = clrs[length] ? clrs[join]() : \"0% \" + fill.color);\n                if (type == \"radial\") {\n                    fill.type = \"gradientradial\";\n                    fill.focus = \"100%\";\n                    fill.focussize = fxfy;\n                    fill.focusposition = fxfy;\n                } else {\n                    fill.type = \"gradient\";\n                    fill.angle = (270 - angle) % 360;\n                }\n            }\n            return 1;\n        };\n        Element = function (node, group, vml) {\n            var Rotation = 0,\n                RotX = 0,\n                RotY = 0,\n                Scale = 1;\n            this[0] = node;\n            this.id = R._oid++;\n            this.node = node;\n            node.raphael = this;\n            this.X = 0;\n            this.Y = 0;\n            this.attrs = {};\n            this.Group = group;\n            this.paper = vml;\n            this._ = {\n                tx: 0,\n                ty: 0,\n                rt: {deg:0},\n                sx: 1,\n                sy: 1\n            };\n            !vml.bottom && (vml.bottom = this);\n            this.prev = vml.top;\n            vml.top && (vml.top.next = this);\n            vml.top = this;\n            this.next = null;\n        };\n        elproto = Element[proto];\n        elproto.rotate = function (deg, cx, cy) {\n            if (this.removed) {\n                return this;\n            }\n            if (deg == null) {\n                if (this._.rt.cx) {\n                    return [this._.rt.deg, this._.rt.cx, this._.rt.cy][join](S);\n                }\n                return this._.rt.deg;\n            }\n            deg = Str(deg)[split](separator);\n            if (deg[length] - 1) {\n                cx = toFloat(deg[1]);\n                cy = toFloat(deg[2]);\n            }\n            deg = toFloat(deg[0]);\n            if (cx != null) {\n                this._.rt.deg = deg;\n            } else {\n                this._.rt.deg += deg;\n            }\n            cy == null && (cx = null);\n            this._.rt.cx = cx;\n            this._.rt.cy = cy;\n            this.setBox(this.attrs, cx, cy);\n            this.Group.style.rotation = this._.rt.deg;\n            // gradient fix for rotation. TODO\n            // var fill = (this.shape || this.node).getElementsByTagName(fillString);\n            // fill = fill[0] || {};\n            // var b = ((360 - this._.rt.deg) - 270) % 360;\n            // !R.is(fill.angle, \"undefined\") && (fill.angle = b);\n            return this;\n        };\n        elproto.setBox = function (params, cx, cy) {\n            if (this.removed) {\n                return this;\n            }\n            var gs = this.Group.style,\n                os = (this.shape && this.shape.style) || this.node.style;\n            params = params || {};\n            for (var i in params) if (params[has](i)) {\n                this.attrs[i] = params[i];\n            }\n            cx = cx || this._.rt.cx;\n            cy = cy || this._.rt.cy;\n            var attr = this.attrs,\n                x,\n                y,\n                w,\n                h;\n            switch (this.type) {\n                case \"circle\":\n                    x = attr.cx - attr.r;\n                    y = attr.cy - attr.r;\n                    w = h = attr.r * 2;\n                    break;\n                case \"ellipse\":\n                    x = attr.cx - attr.rx;\n                    y = attr.cy - attr.ry;\n                    w = attr.rx * 2;\n                    h = attr.ry * 2;\n                    break;\n                case \"image\":\n                    x = +attr.x;\n                    y = +attr.y;\n                    w = attr.width || 0;\n                    h = attr.height || 0;\n                    break;\n                case \"text\":\n                    this.textpath.v = [\"m\", round(attr.x), \", \", round(attr.y - 2), \"l\", round(attr.x) + 1, \", \", round(attr.y - 2)][join](E);\n                    x = attr.x - round(this.W / 2);\n                    y = attr.y - this.H / 2;\n                    w = this.W;\n                    h = this.H;\n                    break;\n                case \"rect\":\n                case \"path\":\n                    if (!this.attrs.path) {\n                        x = 0;\n                        y = 0;\n                        w = this.paper.width;\n                        h = this.paper.height;\n                    } else {\n                        var dim = pathDimensions(this.attrs.path);\n                        x = dim.x;\n                        y = dim.y;\n                        w = dim.width;\n                        h = dim.height;\n                    }\n                    break;\n                default:\n                    x = 0;\n                    y = 0;\n                    w = this.paper.width;\n                    h = this.paper.height;\n                    break;\n            }\n            cx = (cx == null) ? x + w / 2 : cx;\n            cy = (cy == null) ? y + h / 2 : cy;\n            var left = cx - this.paper.width / 2,\n                top = cy - this.paper.height / 2, t;\n            gs.left != (t = left + \"px\") && (gs.left = t);\n            gs.top != (t = top + \"px\") && (gs.top = t);\n            this.X = pathlike[has](this.type) ? -left : x;\n            this.Y = pathlike[has](this.type) ? -top : y;\n            this.W = w;\n            this.H = h;\n            if (pathlike[has](this.type)) {\n                os.left != (t = -left * zoom + \"px\") && (os.left = t);\n                os.top != (t = -top * zoom + \"px\") && (os.top = t);\n            } else if (this.type == \"text\") {\n                os.left != (t = -left + \"px\") && (os.left = t);\n                os.top != (t = -top + \"px\") && (os.top = t);\n            } else {\n                gs.width != (t = this.paper.width + \"px\") && (gs.width = t);\n                gs.height != (t = this.paper.height + \"px\") && (gs.height = t);\n                os.left != (t = x - left + \"px\") && (os.left = t);\n                os.top != (t = y - top + \"px\") && (os.top = t);\n                os.width != (t = w + \"px\") && (os.width = t);\n                os.height != (t = h + \"px\") && (os.height = t);\n            }\n        };\n        elproto.hide = function () {\n            !this.removed && (this.Group.style.display = \"none\");\n            return this;\n        };\n        elproto.show = function () {\n            !this.removed && (this.Group.style.display = \"block\");\n            return this;\n        };\n        elproto.getBBox = function () {\n            if (this.removed) {\n                return this;\n            }\n            if (pathlike[has](this.type)) {\n                return pathDimensions(this.attrs.path);\n            }\n            return {\n                x: this.X + (this.bbx || 0),\n                y: this.Y,\n                width: this.W,\n                height: this.H\n            };\n        };\n        elproto.remove = function () {\n            if (this.removed) {\n                return;\n            }\n            tear(this, this.paper);\n            this.node.parentNode.removeChild(this.node);\n            this.Group.parentNode.removeChild(this.Group);\n            this.shape && this.shape.parentNode.removeChild(this.shape);\n            for (var i in this) {\n                delete this[i];\n            }\n            this.removed = true;\n        };\n        elproto.attr = function (name, value) {\n            if (this.removed) {\n                return this;\n            }\n            if (name == null) {\n                var res = {};\n                for (var i in this.attrs) if (this.attrs[has](i)) {\n                    res[i] = this.attrs[i];\n                }\n                this._.rt.deg && (res.rotation = this.rotate());\n                (this._.sx != 1 || this._.sy != 1) && (res.scale = this.scale());\n                res.gradient && res.fill == \"none\" && (res.fill = res.gradient) && delete res.gradient;\n                return res;\n            }\n            if (value == null && R.is(name, \"string\")) {\n                if (name == \"translation\") {\n                    return translate.call(this);\n                }\n                if (name == \"rotation\") {\n                    return this.rotate();\n                }\n                if (name == \"scale\") {\n                    return this.scale();\n                }\n                if (name == fillString && this.attrs.fill == \"none\" && this.attrs.gradient) {\n                    return this.attrs.gradient;\n                }\n                return this.attrs[name];\n            }\n            if (this.attrs && value == null && R.is(name, array)) {\n                var ii, values = {};\n                for (i = 0, ii = name[length]; i < ii; i++) {\n                    values[name[i]] = this.attr(name[i]);\n                }\n                return values;\n            }\n            var params;\n            if (value != null) {\n                params = {};\n                params[name] = value;\n            }\n            value == null && R.is(name, \"object\") && (params = name);\n            if (params) {\n                for (var key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], \"function\")) {\n                    var par = this.paper.customAttributes[key].apply(this, [][concat](params[key]));\n                    this.attrs[key] = params[key];\n                    for (var subkey in par) if (par[has](subkey)) {\n                        params[subkey] = par[subkey];\n                    }\n                }\n                if (params.text && this.type == \"text\") {\n                    this.node.string = params.text;\n                }\n                setFillAndStroke(this, params);\n                if (params.gradient && (({circle: 1, ellipse: 1})[has](this.type) || Str(params.gradient).charAt() != \"r\")) {\n                    addGradientFill(this, params.gradient);\n                }\n                (!pathlike[has](this.type) || this._.rt.deg) && this.setBox(this.attrs);\n            }\n            return this;\n        };\n        elproto.toFront = function () {\n            !this.removed && this.Group.parentNode[appendChild](this.Group);\n            this.paper.top != this && tofront(this, this.paper);\n            return this;\n        };\n        elproto.toBack = function () {\n            if (this.removed) {\n                return this;\n            }\n            if (this.Group.parentNode.firstChild != this.Group) {\n                this.Group.parentNode.insertBefore(this.Group, this.Group.parentNode.firstChild);\n                toback(this, this.paper);\n            }\n            return this;\n        };\n        elproto.insertAfter = function (element) {\n            if (this.removed) {\n                return this;\n            }\n            if (element.constructor == Set) {\n                element = element[element.length - 1];\n            }\n            if (element.Group.nextSibling) {\n                element.Group.parentNode.insertBefore(this.Group, element.Group.nextSibling);\n            } else {\n                element.Group.parentNode[appendChild](this.Group);\n            }\n            insertafter(this, element, this.paper);\n            return this;\n        };\n        elproto.insertBefore = function (element) {\n            if (this.removed) {\n                return this;\n            }\n            if (element.constructor == Set) {\n                element = element[0];\n            }\n            element.Group.parentNode.insertBefore(this.Group, element.Group);\n            insertbefore(this, element, this.paper);\n            return this;\n        };\n        elproto.blur = function (size) {\n            var s = this.node.runtimeStyle,\n                f = s.filter;\n            f = f.replace(blurregexp, E);\n            if (+size !== 0) {\n                this.attrs.blur = size;\n                s.filter = f + S + ms + \".Blur(pixelradius=\" + (+size || 1.5) + \")\";\n                s.margin = R.format(\"-{0}px 0 0 -{0}px\", round(+size || 1.5));\n            } else {\n                s.filter = f;\n                s.margin = 0;\n                delete this.attrs.blur;\n            }\n        };\n\n        theCircle = function (vml, x, y, r) {\n            var g = createNode(\"group\"),\n                o = createNode(\"oval\"),\n                ol = o.style;\n            g.style.cssText = \"position:absolute;left:0;top:0;width:\" + vml.width + \"px;height:\" + vml.height + \"px\";\n            g.coordsize = coordsize;\n            g.coordorigin = vml.coordorigin;\n            g[appendChild](o);\n            var res = new Element(o, g, vml);\n            res.type = \"circle\";\n            setFillAndStroke(res, {stroke: \"#000\", fill: \"none\"});\n            res.attrs.cx = x;\n            res.attrs.cy = y;\n            res.attrs.r = r;\n            res.setBox({x: x - r, y: y - r, width: r * 2, height: r * 2});\n            vml.canvas[appendChild](g);\n            return res;\n        };\n        function rectPath(x, y, w, h, r) {\n            if (r) {\n                return R.format(\"M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z\", x + r, y, w - r * 2, r, -r, h - r * 2, r * 2 - w, r * 2 - h);\n            } else {\n                return R.format(\"M{0},{1}l{2},0,0,{3},{4},0z\", x, y, w, h, -w);\n            }\n        }\n        theRect = function (vml, x, y, w, h, r) {\n            var path = rectPath(x, y, w, h, r),\n                res = vml.path(path),\n                a = res.attrs;\n            res.X = a.x = x;\n            res.Y = a.y = y;\n            res.W = a.width = w;\n            res.H = a.height = h;\n            a.r = r;\n            a.path = path;\n            res.type = \"rect\";\n            return res;\n        };\n        theEllipse = function (vml, x, y, rx, ry) {\n            var g = createNode(\"group\"),\n                o = createNode(\"oval\"),\n                ol = o.style;\n            g.style.cssText = \"position:absolute;left:0;top:0;width:\" + vml.width + \"px;height:\" + vml.height + \"px\";\n            g.coordsize = coordsize;\n            g.coordorigin = vml.coordorigin;\n            g[appendChild](o);\n            var res = new Element(o, g, vml);\n            res.type = \"ellipse\";\n            setFillAndStroke(res, {stroke: \"#000\"});\n            res.attrs.cx = x;\n            res.attrs.cy = y;\n            res.attrs.rx = rx;\n            res.attrs.ry = ry;\n            res.setBox({x: x - rx, y: y - ry, width: rx * 2, height: ry * 2});\n            vml.canvas[appendChild](g);\n            return res;\n        };\n        theImage = function (vml, src, x, y, w, h) {\n            var g = createNode(\"group\"),\n                o = createNode(\"image\");\n            g.style.cssText = \"position:absolute;left:0;top:0;width:\" + vml.width + \"px;height:\" + vml.height + \"px\";\n            g.coordsize = coordsize;\n            g.coordorigin = vml.coordorigin;\n            o.src = src;\n            g[appendChild](o);\n            var res = new Element(o, g, vml);\n            res.type = \"image\";\n            res.attrs.src = src;\n            res.attrs.x = x;\n            res.attrs.y = y;\n            res.attrs.w = w;\n            res.attrs.h = h;\n            res.setBox({x: x, y: y, width: w, height: h});\n            vml.canvas[appendChild](g);\n            return res;\n        };\n        theText = function (vml, x, y, text) {\n            var g = createNode(\"group\"),\n                el = createNode(\"shape\"),\n                ol = el.style,\n                path = createNode(\"path\"),\n                ps = path.style,\n                o = createNode(\"textpath\");\n            g.style.cssText = \"position:absolute;left:0;top:0;width:\" + vml.width + \"px;height:\" + vml.height + \"px\";\n            g.coordsize = coordsize;\n            g.coordorigin = vml.coordorigin;\n            path.v = R.format(\"m{0},{1}l{2},{1}\", round(x * 10), round(y * 10), round(x * 10) + 1);\n            path.textpathok = true;\n            ol.width = vml.width;\n            ol.height = vml.height;\n            o.string = Str(text);\n            o.on = true;\n            el[appendChild](o);\n            el[appendChild](path);\n            g[appendChild](el);\n            var res = new Element(o, g, vml);\n            res.shape = el;\n            res.textpath = path;\n            res.type = \"text\";\n            res.attrs.text = text;\n            res.attrs.x = x;\n            res.attrs.y = y;\n            res.attrs.w = 1;\n            res.attrs.h = 1;\n            setFillAndStroke(res, {font: availableAttrs.font, stroke: \"none\", fill: \"#000\"});\n            res.setBox();\n            vml.canvas[appendChild](g);\n            return res;\n        };\n        setSize = function (width, height) {\n            var cs = this.canvas.style;\n            width == +width && (width += \"px\");\n            height == +height && (height += \"px\");\n            cs.width = width;\n            cs.height = height;\n            cs.clip = \"rect(0 \" + width + \" \" + height + \" 0)\";\n            return this;\n        };\n        var createNode;\n        doc.createStyleSheet().addRule(\".rvml\", \"behavior:url(#default#VML)\");\n        try {\n            !doc.namespaces.rvml && doc.namespaces.add(\"rvml\", \"urn:schemas-microsoft-com:vml\");\n            createNode = function (tagName) {\n                return doc.createElement('<rvml:' + tagName + ' class=\"rvml\">');\n            };\n        } catch (e) {\n            createNode = function (tagName) {\n                return doc.createElement('<' + tagName + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"rvml\">');\n            };\n        }\n        create = function () {\n            var con = getContainer[apply](0, arguments),\n                container = con.container,\n                height = con.height,\n                s,\n                width = con.width,\n                x = con.x,\n                y = con.y;\n            if (!container) {\n                throw new Error(\"VML container not found.\");\n            }\n            var res = new Paper,\n                c = res.canvas = doc.createElement(\"div\"),\n                cs = c.style;\n            x = x || 0;\n            y = y || 0;\n            width = width || 512;\n            height = height || 342;\n            width == +width && (width += \"px\");\n            height == +height && (height += \"px\");\n            res.width = 1e3;\n            res.height = 1e3;\n            res.coordsize = zoom * 1e3 + S + zoom * 1e3;\n            res.coordorigin = \"0 0\";\n            res.span = doc.createElement(\"span\");\n            res.span.style.cssText = \"position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;\";\n            c[appendChild](res.span);\n            cs.cssText = R.format(\"top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden\", width, height);\n            if (container == 1) {\n                doc.body[appendChild](c);\n                cs.left = x + \"px\";\n                cs.top = y + \"px\";\n                cs.position = \"absolute\";\n            } else {\n                if (container.firstChild) {\n                    container.insertBefore(c, container.firstChild);\n                } else {\n                    container[appendChild](c);\n                }\n            }\n            plugins.call(res, res, R.fn);\n            return res;\n        };\n        paperproto.clear = function () {\n            this.canvas.innerHTML = E;\n            this.span = doc.createElement(\"span\");\n            this.span.style.cssText = \"position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;\";\n            this.canvas[appendChild](this.span);\n            this.bottom = this.top = null;\n        };\n        paperproto.remove = function () {\n            this.canvas.parentNode.removeChild(this.canvas);\n            for (var i in this) {\n                this[i] = removed(i);\n            }\n            return true;\n        };\n    }\n\n    // rest\n    // WebKit rendering bug workaround method\n    var version = navigator.userAgent.match(/Version\\/(.*?)\\s/);\n    if ((navigator.vendor == \"Apple Computer, Inc.\") && (version && version[1] < 4 || navigator.platform.slice(0, 2) == \"iP\")) {\n        paperproto.safari = function () {\n            var rect = this.rect(-99, -99, this.width + 99, this.height + 99).attr({stroke: \"none\"});\n            win.setTimeout(function () {rect.remove();});\n        };\n    } else {\n        paperproto.safari = function () {};\n    }\n\n    // Events\n    var preventDefault = function () {\n        this.returnValue = false;\n    },\n    preventTouch = function () {\n        return this.originalEvent.preventDefault();\n    },\n    stopPropagation = function () {\n        this.cancelBubble = true;\n    },\n    stopTouch = function () {\n        return this.originalEvent.stopPropagation();\n    },\n    addEvent = (function () {\n        if (doc.addEventListener) {\n            return function (obj, type, fn, element) {\n                var realName = supportsTouch && touchMap[type] ? touchMap[type] : type;\n                var f = function (e) {\n                    if (supportsTouch && touchMap[has](type)) {\n                        for (var i = 0, ii = e.targetTouches && e.targetTouches.length; i < ii; i++) {\n                            if (e.targetTouches[i].target == obj) {\n                                var olde = e;\n                                e = e.targetTouches[i];\n                                e.originalEvent = olde;\n                                e.preventDefault = preventTouch;\n                                e.stopPropagation = stopTouch;\n                                break;\n                            }\n                        }\n                    }\n                    return fn.call(element, e);\n                };\n                obj.addEventListener(realName, f, false);\n                return function () {\n                    obj.removeEventListener(realName, f, false);\n                    return true;\n                };\n            };\n        } else if (doc.attachEvent) {\n            return function (obj, type, fn, element) {\n                var f = function (e) {\n                    e = e || win.event;\n                    e.preventDefault = e.preventDefault || preventDefault;\n                    e.stopPropagation = e.stopPropagation || stopPropagation;\n                    return fn.call(element, e);\n                };\n                obj.attachEvent(\"on\" + type, f);\n                var detacher = function () {\n                    obj.detachEvent(\"on\" + type, f);\n                    return true;\n                };\n                return detacher;\n            };\n        }\n    })(),\n    drag = [],\n    dragMove = function (e) {\n        var x = e.clientX,\n            y = e.clientY,\n            scrollY = doc.documentElement.scrollTop || doc.body.scrollTop,\n            scrollX = doc.documentElement.scrollLeft || doc.body.scrollLeft,\n            dragi,\n            j = drag.length;\n        while (j--) {\n            dragi = drag[j];\n            if (supportsTouch) {\n                var i = e.touches.length,\n                    touch;\n                while (i--) {\n                    touch = e.touches[i];\n                    if (touch.identifier == dragi.el._drag.id) {\n                        x = touch.clientX;\n                        y = touch.clientY;\n                        (e.originalEvent ? e.originalEvent : e).preventDefault();\n                        break;\n                    }\n                }\n            } else {\n                e.preventDefault();\n            }\n            x += scrollX;\n            y += scrollY;\n            dragi.move && dragi.move.call(dragi.move_scope || dragi.el, x - dragi.el._drag.x, y - dragi.el._drag.y, x, y, e);\n        }\n    },\n    dragUp = function (e) {\n        R.unmousemove(dragMove).unmouseup(dragUp);\n        var i = drag.length,\n            dragi;\n        while (i--) {\n            dragi = drag[i];\n            dragi.el._drag = {};\n            dragi.end && dragi.end.call(dragi.end_scope || dragi.start_scope || dragi.move_scope || dragi.el, e);\n        }\n        drag = [];\n    };\n    for (var i = events[length]; i--;) {\n        (function (eventName) {\n            R[eventName] = Element[proto][eventName] = function (fn, scope) {\n                if (R.is(fn, \"function\")) {\n                    this.events = this.events || [];\n                    this.events.push({name: eventName, f: fn, unbind: addEvent(this.shape || this.node || doc, eventName, fn, scope || this)});\n                }\n                return this;\n            };\n            R[\"un\" + eventName] = Element[proto][\"un\" + eventName] = function (fn) {\n                var events = this.events,\n                    l = events[length];\n                while (l--) if (events[l].name == eventName && events[l].f == fn) {\n                    events[l].unbind();\n                    events.splice(l, 1);\n                    !events.length && delete this.events;\n                    return this;\n                }\n                return this;\n            };\n        })(events[i]);\n    }\n    elproto.hover = function (f_in, f_out, scope_in, scope_out) {\n        return this.mouseover(f_in, scope_in).mouseout(f_out, scope_out || scope_in);\n    };\n    elproto.unhover = function (f_in, f_out) {\n        return this.unmouseover(f_in).unmouseout(f_out);\n    };\n    elproto.drag = function (onmove, onstart, onend, move_scope, start_scope, end_scope) {\n        this._drag = {};\n        this.mousedown(function (e) {\n            (e.originalEvent || e).preventDefault();\n            var scrollY = doc.documentElement.scrollTop || doc.body.scrollTop,\n                scrollX = doc.documentElement.scrollLeft || doc.body.scrollLeft;\n            this._drag.x = e.clientX + scrollX;\n            this._drag.y = e.clientY + scrollY;\n            this._drag.id = e.identifier;\n            onstart && onstart.call(start_scope || move_scope || this, e.clientX + scrollX, e.clientY + scrollY, e);\n            !drag.length && R.mousemove(dragMove).mouseup(dragUp);\n            drag.push({el: this, move: onmove, end: onend, move_scope: move_scope, start_scope: start_scope, end_scope: end_scope});\n        });\n        return this;\n    };\n    elproto.undrag = function (onmove, onstart, onend) {\n        var i = drag.length;\n        while (i--) {\n            drag[i].el == this && (drag[i].move == onmove && drag[i].end == onend) && drag.splice(i++, 1);\n        }\n        !drag.length && R.unmousemove(dragMove).unmouseup(dragUp);\n    };\n    paperproto.circle = function (x, y, r) {\n        return theCircle(this, x || 0, y || 0, r || 0);\n    };\n    paperproto.rect = function (x, y, w, h, r) {\n        return theRect(this, x || 0, y || 0, w || 0, h || 0, r || 0);\n    };\n    paperproto.ellipse = function (x, y, rx, ry) {\n        return theEllipse(this, x || 0, y || 0, rx || 0, ry || 0);\n    };\n    paperproto.path = function (pathString) {\n        pathString && !R.is(pathString, string) && !R.is(pathString[0], array) && (pathString += E);\n        return thePath(R.format[apply](R, arguments), this);\n    };\n    paperproto.image = function (src, x, y, w, h) {\n        return theImage(this, src || \"about:blank\", x || 0, y || 0, w || 0, h || 0);\n    };\n    paperproto.text = function (x, y, text) {\n        return theText(this, x || 0, y || 0, Str(text));\n    };\n    paperproto.set = function (itemsArray) {\n        arguments[length] > 1 && (itemsArray = Array[proto].splice.call(arguments, 0, arguments[length]));\n        return new Set(itemsArray);\n    };\n    paperproto.setSize = setSize;\n    paperproto.top = paperproto.bottom = null;\n    paperproto.raphael = R;\n    function x_y() {\n        return this.x + S + this.y;\n    }\n    elproto.resetScale = function () {\n        if (this.removed) {\n            return this;\n        }\n        this._.sx = 1;\n        this._.sy = 1;\n        this.attrs.scale = \"1 1\";\n    };\n    elproto.scale = function (x, y, cx, cy) {\n        if (this.removed) {\n            return this;\n        }\n        if (x == null && y == null) {\n            return {\n                x: this._.sx,\n                y: this._.sy,\n                toString: x_y\n            };\n        }\n        y = y || x;\n        !+y && (y = x);\n        var dx,\n            dy,\n            dcx,\n            dcy,\n            a = this.attrs;\n        if (x != 0) {\n            var bb = this.getBBox(),\n                rcx = bb.x + bb.width / 2,\n                rcy = bb.y + bb.height / 2,\n                kx = abs(x / this._.sx),\n                ky = abs(y / this._.sy);\n            cx = (+cx || cx == 0) ? cx : rcx;\n            cy = (+cy || cy == 0) ? cy : rcy;\n            var posx = this._.sx > 0,\n                posy = this._.sy > 0,\n                dirx = ~~(x / abs(x)),\n                diry = ~~(y / abs(y)),\n                dkx = kx * dirx,\n                dky = ky * diry,\n                s = this.node.style,\n                ncx = cx + abs(rcx - cx) * dkx * (rcx > cx == posx ? 1 : -1),\n                ncy = cy + abs(rcy - cy) * dky * (rcy > cy == posy ? 1 : -1),\n                fr = (x * dirx > y * diry ? ky : kx);\n            switch (this.type) {\n                case \"rect\":\n                case \"image\":\n                    var neww = a.width * kx,\n                        newh = a.height * ky;\n                    this.attr({\n                        height: newh,\n                        r: a.r * fr,\n                        width: neww,\n                        x: ncx - neww / 2,\n                        y: ncy - newh / 2\n                    });\n                    break;\n                case \"circle\":\n                case \"ellipse\":\n                    this.attr({\n                        rx: a.rx * kx,\n                        ry: a.ry * ky,\n                        r: a.r * fr,\n                        cx: ncx,\n                        cy: ncy\n                    });\n                    break;\n                case \"text\":\n                    this.attr({\n                        x: ncx,\n                        y: ncy\n                    });\n                    break;\n                case \"path\":\n                    var path = pathToRelative(a.path),\n                        skip = true,\n                        fx = posx ? dkx : kx,\n                        fy = posy ? dky : ky;\n                    for (var i = 0, ii = path[length]; i < ii; i++) {\n                        var p = path[i],\n                            P0 = upperCase.call(p[0]);\n                        if (P0 == \"M\" && skip) {\n                            continue;\n                        } else {\n                            skip = false;\n                        }\n                        if (P0 == \"A\") {\n                            p[path[i][length] - 2] *= fx;\n                            p[path[i][length] - 1] *= fy;\n                            p[1] *= kx;\n                            p[2] *= ky;\n                            p[5] = +(dirx + diry ? !!+p[5] : !+p[5]);\n                        } else if (P0 == \"H\") {\n                            for (var j = 1, jj = p[length]; j < jj; j++) {\n                                p[j] *= fx;\n                            }\n                        } else if (P0 == \"V\") {\n                            for (j = 1, jj = p[length]; j < jj; j++) {\n                                p[j] *= fy;\n                            }\n                         } else {\n                            for (j = 1, jj = p[length]; j < jj; j++) {\n                                p[j] *= (j % 2) ? fx : fy;\n                            }\n                        }\n                    }\n                    var dim2 = pathDimensions(path);\n                    dx = ncx - dim2.x - dim2.width / 2;\n                    dy = ncy - dim2.y - dim2.height / 2;\n                    path[0][1] += dx;\n                    path[0][2] += dy;\n                    this.attr({path: path});\n                break;\n            }\n            if (this.type in {text: 1, image:1} && (dirx != 1 || diry != 1)) {\n                if (this.transformations) {\n                    this.transformations[2] = \"scale(\"[concat](dirx, \",\", diry, \")\");\n                    setAttr(this.node, \"transform\", this.transformations[join](S));\n                    dx = (dirx == -1) ? -a.x - (neww || 0) : a.x;\n                    dy = (diry == -1) ? -a.y - (newh || 0) : a.y;\n                    this.attr({x: dx, y: dy});\n                    a.fx = dirx - 1;\n                    a.fy = diry - 1;\n                } else {\n                    this.node.filterMatrix = ms + \".Matrix(M11=\"[concat](dirx,\n                        \", M12=0, M21=0, M22=\", diry,\n                        \", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')\");\n                    s.filter = (this.node.filterMatrix || E) + (this.node.filterOpacity || E);\n                }\n            } else {\n                if (this.transformations) {\n                    this.transformations[2] = E;\n                    setAttr(this.node, \"transform\", this.transformations[join](S));\n                    a.fx = 0;\n                    a.fy = 0;\n                } else {\n                    this.node.filterMatrix = E;\n                    s.filter = (this.node.filterMatrix || E) + (this.node.filterOpacity || E);\n                }\n            }\n            a.scale = [x, y, cx, cy][join](S);\n            this._.sx = x;\n            this._.sy = y;\n        }\n        return this;\n    };\n    elproto.clone = function () {\n        if (this.removed) {\n            return null;\n        }\n        var attr = this.attr();\n        delete attr.scale;\n        delete attr.translation;\n        return this.paper[this.type]().attr(attr);\n    };\n    var curveslengths = {},\n    getPointAtSegmentLength = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length) {\n        // Is this a straight line?\n        // Added for huge speed improvements\n        if ( p1x === c1x && p1y === c1y && c2x === p2x && c2y == p2y ) {\n            var dx = p2x - p1x, dy = p2y - p1y;\n            var totalLength = Math.sqrt( dx * dx + dy * dy );\n\n            if ( length == null ) {\n                return totalLength;\n            } else {\n                var fract = length / totalLength;\n                return {\n                    start: { x: p1x, y: p1y },\n                    m: { x: p1x, y: p1y },\n                    n: { x: p2x, y: p2y },\n                    end: { x: p2x, y: p2y },\n                    x: p1x + fract * dx,\n                    y: p1y + fract * dy,\n                    alpha: (90 - math.atan(dx / dy) * 180 / PI)\n                };\n            }\n        }\n\n        var len = 0,\n            precision = 100,\n            name = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y].join(),\n            cache = curveslengths[name],\n            old, dot;\n        !cache && (curveslengths[name] = cache = {data: []});\n        cache.timer && clearTimeout(cache.timer);\n        cache.timer = setTimeout(function () {delete curveslengths[name];}, 2000);\n        if (length != null) {\n            var total = getPointAtSegmentLength(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y);\n            precision = ~~total * 10;\n        }\n        for (var i = 0; i < precision + 1; i++) {\n            if (cache.data[length] > i) {\n                dot = cache.data[i * precision];\n            } else {\n                dot = R.findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, i / precision);\n                cache.data[i] = dot;\n            }\n            i && (len += pow(pow(old.x - dot.x, 2) + pow(old.y - dot.y, 2), .5));\n            if (length != null && len >= length) {\n                return dot;\n            }\n            old = dot;\n        }\n        if (length == null) {\n            return len;\n        }\n    },\n    getLengthFactory = function (istotal, subpath) {\n        return function (path, length, onlystart) {\n            path = path2curve(path);\n            var x, y, p, l, sp = \"\", subpaths = {}, point,\n                len = 0;\n            for (var i = 0, ii = path.length; i < ii; i++) {\n                p = path[i];\n                if (p[0] == \"M\") {\n                    x = +p[1];\n                    y = +p[2];\n                } else {\n                    l = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\n                    if (len + l > length) {\n                        if (subpath && !subpaths.start) {\n                            point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\n                            sp += [\"C\", point.start.x, point.start.y, point.m.x, point.m.y, point.x, point.y];\n                            if (onlystart) {return sp;}\n                            subpaths.start = sp;\n                            sp = [\"M\", point.x, point.y + \"C\", point.n.x, point.n.y, point.end.x, point.end.y, p[5], p[6]][join]();\n                            len += l;\n                            x = +p[5];\n                            y = +p[6];\n                            continue;\n                        }\n                        if (!istotal && !subpath) {\n                            point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\n                            return {x: point.x, y: point.y, alpha: point.alpha};\n                        }\n                    }\n                    len += l;\n                    x = +p[5];\n                    y = +p[6];\n                }\n                sp += p;\n            }\n            subpaths.end = sp;\n            point = istotal ? len : subpath ? subpaths : R.findDotsAtSegment(x, y, p[1], p[2], p[3], p[4], p[5], p[6], 1);\n            point.alpha && (point = {x: point.x, y: point.y, alpha: point.alpha});\n            return point;\n        };\n    };\n    var getTotalLength = getLengthFactory(1),\n        getPointAtLength = getLengthFactory(),\n        getSubpathsAtLength = getLengthFactory(0, 1);\n    elproto.getTotalLength = function () {\n        if (this.type != \"path\") {return;}\n        if (this.node.getTotalLength) {\n            return this.node.getTotalLength();\n        }\n        return getTotalLength(this.attrs.path);\n    };\n    elproto.getPointAtLength = function (length) {\n        if (this.type != \"path\") {return;}\n        return getPointAtLength(this.attrs.path, length);\n    };\n    elproto.getSubpath = function (from, to) {\n        if (this.type != \"path\") {return;}\n        if (abs(this.getTotalLength() - to) < \"1e-6\") {\n            return getSubpathsAtLength(this.attrs.path, from).end;\n        }\n        var a = getSubpathsAtLength(this.attrs.path, to, 1);\n        return from ? getSubpathsAtLength(a, from).end : a;\n    };\n\n    // animation easing formulas\n    R.easing_formulas = {\n        linear: function (n) {\n            return n;\n        },\n        \"<\": function (n) {\n            return pow(n, 3);\n        },\n        \">\": function (n) {\n            return pow(n - 1, 3) + 1;\n        },\n        \"<>\": function (n) {\n            n = n * 2;\n            if (n < 1) {\n                return pow(n, 3) / 2;\n            }\n            n -= 2;\n            return (pow(n, 3) + 2) / 2;\n        },\n        backIn: function (n) {\n            var s = 1.70158;\n            return n * n * ((s + 1) * n - s);\n        },\n        backOut: function (n) {\n            n = n - 1;\n            var s = 1.70158;\n            return n * n * ((s + 1) * n + s) + 1;\n        },\n        elastic: function (n) {\n            if (n == 0 || n == 1) {\n                return n;\n            }\n            var p = .3,\n                s = p / 4;\n            return pow(2, -10 * n) * math.sin((n - s) * (2 * PI) / p) + 1;\n        },\n        bounce: function (n) {\n            var s = 7.5625,\n                p = 2.75,\n                l;\n            if (n < (1 / p)) {\n                l = s * n * n;\n            } else {\n                if (n < (2 / p)) {\n                    n -= (1.5 / p);\n                    l = s * n * n + .75;\n                } else {\n                    if (n < (2.5 / p)) {\n                        n -= (2.25 / p);\n                        l = s * n * n + .9375;\n                    } else {\n                        n -= (2.625 / p);\n                        l = s * n * n + .984375;\n                    }\n                }\n            }\n            return l;\n        }\n    };\n\n    var animationElements = [],\n        animation = function () {\n            var Now = +new Date;\n            for (var l = 0; l < animationElements[length]; l++) {\n                var e = animationElements[l];\n                if (e.stop || e.el.removed) {\n                    continue;\n                }\n                var time = Now - e.start,\n                    ms = e.ms,\n                    easing = e.easing,\n                    from = e.from,\n                    diff = e.diff,\n                    to = e.to,\n                    t = e.t,\n                    that = e.el,\n                    set = {},\n                    now;\n                if (time < ms) {\n                    var pos = easing(time / ms);\n                    for (var attr in from) if (from[has](attr)) {\n                        switch (availableAnimAttrs[attr]) {\n                            case \"along\":\n                                now = pos * ms * diff[attr];\n                                to.back && (now = to.len - now);\n                                var point = getPointAtLength(to[attr], now);\n                                that.translate(diff.sx - diff.x || 0, diff.sy - diff.y || 0);\n                                diff.x = point.x;\n                                diff.y = point.y;\n                                that.translate(point.x - diff.sx, point.y - diff.sy);\n                                to.rot && that.rotate(diff.r + point.alpha, point.x, point.y);\n                                break;\n                            case nu:\n                                now = +from[attr] + pos * ms * diff[attr];\n                                break;\n                            case \"colour\":\n                                now = \"rgb(\" + [\n                                    upto255(round(from[attr].r + pos * ms * diff[attr].r)),\n                                    upto255(round(from[attr].g + pos * ms * diff[attr].g)),\n                                    upto255(round(from[attr].b + pos * ms * diff[attr].b))\n                                ][join](\",\") + \")\";\n                                break;\n                            case \"path\":\n                                now = [];\n                                for (var i = 0, ii = from[attr][length]; i < ii; i++) {\n                                    now[i] = [from[attr][i][0]];\n                                    for (var j = 1, jj = from[attr][i][length]; j < jj; j++) {\n                                        now[i][j] = +from[attr][i][j] + pos * ms * diff[attr][i][j];\n                                    }\n                                    now[i] = now[i][join](S);\n                                }\n                                now = now[join](S);\n                                break;\n                            case \"csv\":\n                                switch (attr) {\n                                    case \"translation\":\n                                        var x = pos * ms * diff[attr][0] - t.x,\n                                            y = pos * ms * diff[attr][1] - t.y;\n                                        t.x += x;\n                                        t.y += y;\n                                        now = x + S + y;\n                                    break;\n                                    case \"rotation\":\n                                        now = +from[attr][0] + pos * ms * diff[attr][0];\n                                        from[attr][1] && (now += \",\" + from[attr][1] + \",\" + from[attr][2]);\n                                    break;\n                                    case \"scale\":\n                                        now = [+from[attr][0] + pos * ms * diff[attr][0], +from[attr][1] + pos * ms * diff[attr][1], (2 in to[attr] ? to[attr][2] : E), (3 in to[attr] ? to[attr][3] : E)][join](S);\n                                    break;\n                                    case \"clip-rect\":\n                                        now = [];\n                                        i = 4;\n                                        while (i--) {\n                                            now[i] = +from[attr][i] + pos * ms * diff[attr][i];\n                                        }\n                                    break;\n                                }\n                                break;\n                            default:\n                              var from2 = [].concat(from[attr]);\n                                now = [];\n                                i = that.paper.customAttributes[attr].length;\n                                while (i--) {\n                                    now[i] = +from2[i] + pos * ms * diff[attr][i];\n                                }\n                                break;\n                        }\n                        set[attr] = now;\n                    }\n                    that.attr(set);\n                    that._run && that._run.call(that);\n                } else {\n                    if (to.along) {\n                        point = getPointAtLength(to.along, to.len * !to.back);\n                        that.translate(diff.sx - (diff.x || 0) + point.x - diff.sx, diff.sy - (diff.y || 0) + point.y - diff.sy);\n                        to.rot && that.rotate(diff.r + point.alpha, point.x, point.y);\n                    }\n                    (t.x || t.y) && that.translate(-t.x, -t.y);\n                    to.scale && (to.scale += E);\n                    that.attr(to);\n                    animationElements.splice(l--, 1);\n                }\n            }\n            R.svg && that && that.paper && that.paper.safari();\n            animationElements[length] && setTimeout(animation);\n        },\n        keyframesRun = function (attr, element, time, prev, prevcallback) {\n            var dif = time - prev;\n            element.timeouts.push(setTimeout(function () {\n                R.is(prevcallback, \"function\") && prevcallback.call(element);\n                element.animate(attr, dif, attr.easing);\n            }, prev));\n        },\n        upto255 = function (color) {\n            return mmax(mmin(color, 255), 0);\n        },\n        translate = function (x, y) {\n            if (x == null) {\n                return {x: this._.tx, y: this._.ty, toString: x_y};\n            }\n            this._.tx += +x;\n            this._.ty += +y;\n            switch (this.type) {\n                case \"circle\":\n                case \"ellipse\":\n                    this.attr({cx: +x + this.attrs.cx, cy: +y + this.attrs.cy});\n                    break;\n                case \"rect\":\n                case \"image\":\n                case \"text\":\n                    this.attr({x: +x + this.attrs.x, y: +y + this.attrs.y});\n                    break;\n                case \"path\":\n                    var path = pathToRelative(this.attrs.path);\n                    path[0][1] += +x;\n                    path[0][2] += +y;\n                    this.attr({path: path});\n                break;\n            }\n            return this;\n        };\n    elproto.animateWith = function (element, params, ms, easing, callback) {\n        for (var i = 0, ii = animationElements.length; i < ii; i++) {\n            if (animationElements[i].el.id == element.id) {\n                params.start = animationElements[i].start;\n            }\n        }\n        return this.animate(params, ms, easing, callback);\n    };\n    elproto.animateAlong = along();\n    elproto.animateAlongBack = along(1);\n    function along(isBack) {\n        return function (path, ms, rotate, callback) {\n            var params = {back: isBack};\n            R.is(rotate, \"function\") ? (callback = rotate) : (params.rot = rotate);\n            path && path.constructor == Element && (path = path.attrs.path);\n            path && (params.along = path);\n            return this.animate(params, ms, callback);\n        };\n    }\n    function CubicBezierAtTime(t, p1x, p1y, p2x, p2y, duration) {\n        var cx = 3 * p1x,\n            bx = 3 * (p2x - p1x) - cx,\n            ax = 1 - cx - bx,\n            cy = 3 * p1y,\n            by = 3 * (p2y - p1y) - cy,\n            ay = 1 - cy - by;\n        function sampleCurveX(t) {\n            return ((ax * t + bx) * t + cx) * t;\n        }\n        function solve(x, epsilon) {\n            var t = solveCurveX(x, epsilon);\n            return ((ay * t + by) * t + cy) * t;\n        }\n        function solveCurveX(x, epsilon) {\n            var t0, t1, t2, x2, d2, i;\n            for(t2 = x, i = 0; i < 8; i++) {\n                x2 = sampleCurveX(t2) - x;\n                if (abs(x2) < epsilon) {\n                    return t2;\n                }\n                d2 = (3 * ax * t2 + 2 * bx) * t2 + cx;\n                if (abs(d2) < 1e-6) {\n                    break;\n                }\n                t2 = t2 - x2 / d2;\n            }\n            t0 = 0;\n            t1 = 1;\n            t2 = x;\n            if (t2 < t0) {\n                return t0;\n            }\n            if (t2 > t1) {\n                return t1;\n            }\n            while (t0 < t1) {\n                x2 = sampleCurveX(t2);\n                if (abs(x2 - x) < epsilon) {\n                    return t2;\n                }\n                if (x > x2) {\n                    t0 = t2;\n                } else {\n                    t1 = t2;\n                }\n                t2 = (t1 - t0) / 2 + t0;\n            }\n            return t2;\n        }\n        return solve(t, 1 / (200 * duration));\n    }\n    elproto.onAnimation = function (f) {\n        this._run = f || 0;\n        return this;\n    };\n    elproto.animate = function (params, ms, easing, callback) {\n        var element = this;\n        element.timeouts = element.timeouts || [];\n        if (R.is(easing, \"function\") || !easing) {\n            callback = easing || null;\n        }\n        if (element.removed) {\n            callback && callback.call(element);\n            return element;\n        }\n        var from = {},\n            to = {},\n            animateable = false,\n            diff = {};\n        for (var attr in params) if (params[has](attr)) {\n            if (availableAnimAttrs[has](attr) || element.paper.customAttributes[has](attr)) {\n                animateable = true;\n                from[attr] = element.attr(attr);\n                (from[attr] == null) && (from[attr] = availableAttrs[attr]);\n                to[attr] = params[attr];\n                switch (availableAnimAttrs[attr]) {\n                    case \"along\":\n                        var len = getTotalLength(params[attr]);\n                        var point = getPointAtLength(params[attr], len * !!params.back);\n                        var bb = element.getBBox();\n                        diff[attr] = len / ms;\n                        diff.tx = bb.x;\n                        diff.ty = bb.y;\n                        diff.sx = point.x;\n                        diff.sy = point.y;\n                        to.rot = params.rot;\n                        to.back = params.back;\n                        to.len = len;\n                        params.rot && (diff.r = toFloat(element.rotate()) || 0);\n                        break;\n                    case nu:\n                        diff[attr] = (to[attr] - from[attr]) / ms;\n                        break;\n                    case \"colour\":\n                        from[attr] = R.getRGB(from[attr]);\n                        var toColour = R.getRGB(to[attr]);\n                        diff[attr] = {\n                            r: (toColour.r - from[attr].r) / ms,\n                            g: (toColour.g - from[attr].g) / ms,\n                            b: (toColour.b - from[attr].b) / ms\n                        };\n                        break;\n                    case \"path\":\n                        var pathes = path2curve(from[attr], to[attr]);\n                        from[attr] = pathes[0];\n                        var toPath = pathes[1];\n                        diff[attr] = [];\n                        for (var i = 0, ii = from[attr][length]; i < ii; i++) {\n                            diff[attr][i] = [0];\n                            for (var j = 1, jj = from[attr][i][length]; j < jj; j++) {\n                                diff[attr][i][j] = (toPath[i][j] - from[attr][i][j]) / ms;\n                            }\n                        }\n                        break;\n                    case \"csv\":\n                        var values = Str(params[attr])[split](separator),\n                            from2 = Str(from[attr])[split](separator);\n                        switch (attr) {\n                            case \"translation\":\n                                from[attr] = [0, 0];\n                                diff[attr] = [values[0] / ms, values[1] / ms];\n                            break;\n                            case \"rotation\":\n                                from[attr] = (from2[1] == values[1] && from2[2] == values[2]) ? from2 : [0, values[1], values[2]];\n                                diff[attr] = [(values[0] - from[attr][0]) / ms, 0, 0];\n                            break;\n                            case \"scale\":\n                                params[attr] = values;\n                                from[attr] = Str(from[attr])[split](separator);\n                                diff[attr] = [(values[0] - from[attr][0]) / ms, (values[1] - from[attr][1]) / ms, 0, 0];\n                            break;\n                            case \"clip-rect\":\n                                from[attr] = Str(from[attr])[split](separator);\n                                diff[attr] = [];\n                                i = 4;\n                                while (i--) {\n                                    diff[attr][i] = (values[i] - from[attr][i]) / ms;\n                                }\n                            break;\n                        }\n                        to[attr] = values;\n                        break;\n                    default:\n                        values = [].concat(params[attr]);\n                        from2 = [].concat(from[attr]);\n                        diff[attr] = [];\n                        i = element.paper.customAttributes[attr][length];\n                        while (i--) {\n                            diff[attr][i] = ((values[i] || 0) - (from2[i] || 0)) / ms;\n                        }\n                        break;\n                }\n            }\n        }\n        if (!animateable) {\n            var attrs = [],\n                lastcall;\n            for (var key in params) if (params[has](key) && animKeyFrames.test(key)) {\n                attr = {value: params[key]};\n                key == \"from\" && (key = 0);\n                key == \"to\" && (key = 100);\n                attr.key = toInt(key, 10);\n                attrs.push(attr);\n            }\n            attrs.sort(sortByKey);\n            if (attrs[0].key) {\n                attrs.unshift({key: 0, value: element.attrs});\n            }\n            for (i = 0, ii = attrs[length]; i < ii; i++) {\n                keyframesRun(attrs[i].value, element, ms / 100 * attrs[i].key, ms / 100 * (attrs[i - 1] && attrs[i - 1].key || 0), attrs[i - 1] && attrs[i - 1].value.callback);\n            }\n            lastcall = attrs[attrs[length] - 1].value.callback;\n            if (lastcall) {\n                element.timeouts.push(setTimeout(function () {lastcall.call(element);}, ms));\n            }\n        } else {\n            var easyeasy = R.easing_formulas[easing];\n            if (!easyeasy) {\n                easyeasy = Str(easing).match(bezierrg);\n                if (easyeasy && easyeasy[length] == 5) {\n                    var curve = easyeasy;\n                    easyeasy = function (t) {\n                        return CubicBezierAtTime(t, +curve[1], +curve[2], +curve[3], +curve[4], ms);\n                    };\n                } else {\n                    easyeasy = function (t) {\n                        return t;\n                    };\n                }\n            }\n            animationElements.push({\n                start: params.start || +new Date,\n                ms: ms,\n                easing: easyeasy,\n                from: from,\n                diff: diff,\n                to: to,\n                el: element,\n                t: {x: 0, y: 0}\n            });\n            R.is(callback, \"function\") && (element._ac = setTimeout(function () {\n                callback.call(element);\n            }, ms));\n            animationElements[length] == 1 && setTimeout(animation);\n        }\n        return this;\n    };\n    elproto.stop = function () {\n        for (var i = 0; i < animationElements.length; i++) {\n            animationElements[i].el.id == this.id && animationElements.splice(i--, 1);\n        }\n        for (i = 0, ii = this.timeouts && this.timeouts.length; i < ii; i++) {\n            clearTimeout(this.timeouts[i]);\n        }\n        this.timeouts = [];\n        clearTimeout(this._ac);\n        delete this._ac;\n        return this;\n    };\n    elproto.translate = function (x, y) {\n        return this.attr({translation: x + \" \" + y});\n    };\n    elproto[toString] = function () {\n        return \"Rapha\\xebl\\u2019s object\";\n    };\n    R.ae = animationElements;\n\n    // Set\n    var Set = function (items) {\n        this.items = [];\n        this[length] = 0;\n        this.type = \"set\";\n        if (items) {\n            for (var i = 0, ii = items[length]; i < ii; i++) {\n                if (items[i] && (items[i].constructor == Element || items[i].constructor == Set)) {\n                    this[this.items[length]] = this.items[this.items[length]] = items[i];\n                    this[length]++;\n                }\n            }\n        }\n    };\n    Set[proto][push] = function () {\n        var item,\n            len;\n        for (var i = 0, ii = arguments[length]; i < ii; i++) {\n            item = arguments[i];\n            if (item && (item.constructor == Element || item.constructor == Set)) {\n                len = this.items[length];\n                this[len] = this.items[len] = item;\n                this[length]++;\n            }\n        }\n        return this;\n    };\n    Set[proto].pop = function () {\n        delete this[this[length]--];\n        return this.items.pop();\n    };\n    for (var method in elproto) if (elproto[has](method)) {\n        Set[proto][method] = (function (methodname) {\n            return function () {\n                for (var i = 0, ii = this.items[length]; i < ii; i++) {\n                    this.items[i][methodname][apply](this.items[i], arguments);\n                }\n                return this;\n            };\n        })(method);\n    }\n    Set[proto].attr = function (name, value) {\n        if (name && R.is(name, array) && R.is(name[0], \"object\")) {\n            for (var j = 0, jj = name[length]; j < jj; j++) {\n                this.items[j].attr(name[j]);\n            }\n        } else {\n            for (var i = 0, ii = this.items[length]; i < ii; i++) {\n                this.items[i].attr(name, value);\n            }\n        }\n        return this;\n    };\n    Set[proto].animate = function (params, ms, easing, callback) {\n        (R.is(easing, \"function\") || !easing) && (callback = easing || null);\n        var len = this.items[length],\n            i = len,\n            item,\n            set = this,\n            collector;\n        callback && (collector = function () {\n            !--len && callback.call(set);\n        });\n        easing = R.is(easing, string) ? easing : collector;\n        item = this.items[--i].animate(params, ms, easing, collector);\n        while (i--) {\n            this.items[i] && !this.items[i].removed && this.items[i].animateWith(item, params, ms, easing, collector);\n        }\n        return this;\n    };\n    Set[proto].insertAfter = function (el) {\n        var i = this.items[length];\n        while (i--) {\n            this.items[i].insertAfter(el);\n        }\n        return this;\n    };\n    Set[proto].getBBox = function () {\n        var x = [],\n            y = [],\n            w = [],\n            h = [];\n        for (var i = this.items[length]; i--;) {\n            var box = this.items[i].getBBox();\n            x[push](box.x);\n            y[push](box.y);\n            w[push](box.x + box.width);\n            h[push](box.y + box.height);\n        }\n        x = mmin[apply](0, x);\n        y = mmin[apply](0, y);\n        return {\n            x: x,\n            y: y,\n            width: mmax[apply](0, w) - x,\n            height: mmax[apply](0, h) - y\n        };\n    };\n    Set[proto].clone = function (s) {\n        s = new Set;\n        for (var i = 0, ii = this.items[length]; i < ii; i++) {\n            s[push](this.items[i].clone());\n        }\n        return s;\n    };\n\n    R.registerFont = function (font) {\n        if (!font.face) {\n            return font;\n        }\n        this.fonts = this.fonts || {};\n        var fontcopy = {\n                w: font.w,\n                face: {},\n                glyphs: {}\n            },\n            family = font.face[\"font-family\"];\n        for (var prop in font.face) if (font.face[has](prop)) {\n            fontcopy.face[prop] = font.face[prop];\n        }\n        if (this.fonts[family]) {\n            this.fonts[family][push](fontcopy);\n        } else {\n            this.fonts[family] = [fontcopy];\n        }\n        if (!font.svg) {\n            fontcopy.face[\"units-per-em\"] = toInt(font.face[\"units-per-em\"], 10);\n            for (var glyph in font.glyphs) if (font.glyphs[has](glyph)) {\n                var path = font.glyphs[glyph];\n                fontcopy.glyphs[glyph] = {\n                    w: path.w,\n                    k: {},\n                    d: path.d && \"M\" + path.d[rp](/[mlcxtrv]/g, function (command) {\n                            return {l: \"L\", c: \"C\", x: \"z\", t: \"m\", r: \"l\", v: \"c\"}[command] || \"M\";\n                        }) + \"z\"\n                };\n                if (path.k) {\n                    for (var k in path.k) if (path[has](k)) {\n                        fontcopy.glyphs[glyph].k[k] = path.k[k];\n                    }\n                }\n            }\n        }\n        return font;\n    };\n    paperproto.getFont = function (family, weight, style, stretch) {\n        stretch = stretch || \"normal\";\n        style = style || \"normal\";\n        weight = +weight || {normal: 400, bold: 700, lighter: 300, bolder: 800}[weight] || 400;\n        if (!R.fonts) {\n            return;\n        }\n        var font = R.fonts[family];\n        if (!font) {\n            var name = new RegExp(\"(^|\\\\s)\" + family[rp](/[^\\w\\d\\s+!~.:_-]/g, E) + \"(\\\\s|$)\", \"i\");\n            for (var fontName in R.fonts) if (R.fonts[has](fontName)) {\n                if (name.test(fontName)) {\n                    font = R.fonts[fontName];\n                    break;\n                }\n            }\n        }\n        var thefont;\n        if (font) {\n            for (var i = 0, ii = font[length]; i < ii; i++) {\n                thefont = font[i];\n                if (thefont.face[\"font-weight\"] == weight && (thefont.face[\"font-style\"] == style || !thefont.face[\"font-style\"]) && thefont.face[\"font-stretch\"] == stretch) {\n                    break;\n                }\n            }\n        }\n        return thefont;\n    };\n    paperproto.print = function (x, y, string, font, size, origin, letter_spacing) {\n        origin = origin || \"middle\"; // baseline|middle\n        letter_spacing = mmax(mmin(letter_spacing || 0, 1), -1);\n        var out = this.set(),\n            letters = Str(string)[split](E),\n            shift = 0,\n            path = E,\n            scale;\n        R.is(font, string) && (font = this.getFont(font));\n        if (font) {\n            scale = (size || 16) / font.face[\"units-per-em\"];\n            var bb = font.face.bbox.split(separator),\n                top = +bb[0],\n                height = +bb[1] + (origin == \"baseline\" ? bb[3] - bb[1] + (+font.face.descent) : (bb[3] - bb[1]) / 2);\n            for (var i = 0, ii = letters[length]; i < ii; i++) {\n                var prev = i && font.glyphs[letters[i - 1]] || {},\n                    curr = font.glyphs[letters[i]];\n                shift += i ? (prev.w || font.w) + (prev.k && prev.k[letters[i]] || 0) + (font.w * letter_spacing) : 0;\n                curr && curr.d && out[push](this.path(curr.d).attr({fill: \"#000\", stroke: \"none\", translation: [shift, 0]}));\n            }\n            out.scale(scale, scale, top, height).translate(x - top, y - height);\n        }\n        return out;\n    };\n\n    R.format = function (token, params) {\n        var args = R.is(params, array) ? [0][concat](params) : arguments;\n        token && R.is(token, string) && args[length] - 1 && (token = token[rp](formatrg, function (str, i) {\n            return args[++i] == null ? E : args[i];\n        }));\n        return token || E;\n    };\n    R.ninja = function () {\n        oldRaphael.was ? (win.Raphael = oldRaphael.is) : delete win.Raphael;\n        return R;\n    };\n    R.el = elproto;\n    R.st = Set[proto];\n\n    oldRaphael.was ? (win.Raphael = R) : (Raphael = R);\n})();\n","/*\n* jQuery Mobile Framework : \"mouse\" plugin\n* Copyright (c) jQuery Project\n* Dual licensed under the MIT or GPL Version 2 licenses.\n* http://jquery.org/license\n*/\n\n// This plugin is an experiment for abstracting away the touch and mouse\n// events so that developers don't have to worry about which method of input\n// the device their document is loaded on supports.\n//\n// The idea here is to allow the developer to register listeners for the\n// basic mouse events, such as mousedown, mousemove, mouseup, and click,\n// and the plugin will take care of registering the correct listeners\n// behind the scenes to invoke the listener at the fastest possible time\n// for that device, while still retaining the order of event firing in\n// the traditional mouse environment, should multiple handlers be registered\n// on the same element for different events.\n//\n// The current version exposes the following virtual events to jQuery bind methods:\n// \"vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel\"\n\n(function( $, window, document, undefined ) {\n\nvar dataPropertyName = \"virtualMouseBindings\",\n\ttouchTargetPropertyName = \"virtualTouchID\",\n\tvirtualEventNames = \"vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel\".split( \" \" ),\n\ttouchEventProps = \"clientX clientY pageX pageY screenX screenY\".split( \" \" ),\n\tmouseHookProps = $.event.mouseHooks ? $.event.mouseHooks.props : [],\n\tmouseEventProps = $.event.props.concat( mouseHookProps ),\n\tactiveDocHandlers = {},\n\tresetTimerID = 0,\n\tstartX = 0,\n\tstartY = 0,\n\tdidScroll = false,\n\tclickBlockList = [],\n\tblockMouseTriggers = false,\n\tblockTouchTriggers = false,\n\teventCaptureSupported = \"addEventListener\" in document,\n\t$document = $( document ),\n\tnextTouchID = 1,\n\tlastTouchID = 0;\n\n$.vmouse = {\n\tmoveDistanceThreshold: 10,\n\tclickDistanceThreshold: 10,\n\tresetTimerDuration: 1500\n};\n\nfunction getNativeEvent( event ) {\n\n\twhile ( event && typeof event.originalEvent !== \"undefined\" ) {\n\t\tevent = event.originalEvent;\n\t}\n\treturn event;\n}\n\nfunction createVirtualEvent( event, eventType ) {\n\n\tvar t = event.type,\n\t\toe, props, ne, prop, ct, touch, i, j;\n\n\tevent = $.Event(event);\n\tevent.type = eventType;\n\n\toe = event.originalEvent;\n\tprops = $.event.props;\n\n\t// addresses separation of $.event.props in to $.event.mouseHook.props and Issue 3280\n\t// https://github.com/jquery/jquery-mobile/issues/3280\n\tif ( t.search(/mouse/) >-1 ) {\n\t\tprops = mouseEventProps;\n\t}\n\n\t// copy original event properties over to the new event\n\t// this would happen if we could call $.event.fix instead of $.Event\n\t// but we don't have a way to force an event to be fixed multiple times\n\tif ( oe ) {\n\t\tfor ( i = props.length, prop; i; ) {\n\t\t\tprop = props[ --i ];\n\t\t\tevent[ prop ] = oe[ prop ];\n\t\t}\n\t}\n\n\t// make sure that if the mouse and click virtual events are generated\n\t// without a .which one is defined\n\tif ( t.search(/mouse(down|up)|click/) > -1 && !event.which ){\n\t\tevent.which = 1;\n\t}\n\n\tif ( t.search(/^touch/) !== -1 ) {\n\t\tne = getNativeEvent( oe );\n\t\tt = ne.touches;\n\t\tct = ne.changedTouches;\n\t\ttouch = ( t && t.length ) ? t[0] : ( (ct && ct.length) ? ct[ 0 ] : undefined );\n\n\t\tif ( touch ) {\n\t\t\tfor ( j = 0, len = touchEventProps.length; j < len; j++){\n\t\t\t\tprop = touchEventProps[ j ];\n\t\t\t\tevent[ prop ] = touch[ prop ];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn event;\n}\n\nfunction getVirtualBindingFlags( element ) {\n\n\tvar flags = {},\n\t\tb, k;\n\n\twhile ( element ) {\n\n\t\tb = $.data( element, dataPropertyName );\n\n\t\tfor (  k in b ) {\n\t\t\tif ( b[ k ] ) {\n\t\t\t\tflags[ k ] = flags.hasVirtualBinding = true;\n\t\t\t}\n\t\t}\n\t\telement = element.parentNode;\n\t}\n\treturn flags;\n}\n\nfunction getClosestElementWithVirtualBinding( element, eventType ) {\n\tvar b;\n\twhile ( element ) {\n\n\t\tb = $.data( element, dataPropertyName );\n\n\t\tif ( b && ( !eventType || b[ eventType ] ) ) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentNode;\n\t}\n\treturn null;\n}\n\nfunction enableTouchBindings() {\n\tblockTouchTriggers = false;\n}\n\nfunction disableTouchBindings() {\n\tblockTouchTriggers = true;\n}\n\nfunction enableMouseBindings() {\n\tlastTouchID = 0;\n\tclickBlockList.length = 0;\n\tblockMouseTriggers = false;\n\n\t// When mouse bindings are enabled, our\n\t// touch bindings are disabled.\n\tdisableTouchBindings();\n}\n\nfunction disableMouseBindings() {\n\t// When mouse bindings are disabled, our\n\t// touch bindings are enabled.\n\tenableTouchBindings();\n}\n\nfunction startResetTimer() {\n\tclearResetTimer();\n\tresetTimerID = setTimeout(function(){\n\t\tresetTimerID = 0;\n\t\tenableMouseBindings();\n\t}, $.vmouse.resetTimerDuration );\n}\n\nfunction clearResetTimer() {\n\tif ( resetTimerID ){\n\t\tclearTimeout( resetTimerID );\n\t\tresetTimerID = 0;\n\t}\n}\n\nfunction triggerVirtualEvent( eventType, event, flags ) {\n\tvar ve;\n\n\tif ( ( flags && flags[ eventType ] ) ||\n\t\t\t\t( !flags && getClosestElementWithVirtualBinding( event.target, eventType ) ) ) {\n\n\t\tve = createVirtualEvent( event, eventType );\n\n\t\t$( event.target).trigger( ve );\n\t}\n\n\treturn ve;\n}\n\nfunction mouseEventCallback( event ) {\n\tvar touchID = $.data(event.target, touchTargetPropertyName);\n\n\tif ( !blockMouseTriggers && ( !lastTouchID || lastTouchID !== touchID ) ){\n\t\tvar ve = triggerVirtualEvent( \"v\" + event.type, event );\n\t\tif ( ve ) {\n\t\t\tif ( ve.isDefaultPrevented() ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tif ( ve.isPropagationStopped() ) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t\tif ( ve.isImmediatePropagationStopped() ) {\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction handleTouchStart( event ) {\n\n\tvar touches = getNativeEvent( event ).touches,\n\t\ttarget, flags;\n\n\tif ( touches && touches.length === 1 ) {\n\n\t\ttarget = event.target;\n\t\tflags = getVirtualBindingFlags( target );\n\n\t\tif ( flags.hasVirtualBinding ) {\n\n\t\t\tlastTouchID = nextTouchID++;\n\t\t\t$.data( target, touchTargetPropertyName, lastTouchID );\n\n\t\t\tclearResetTimer();\n\n\t\t\tdisableMouseBindings();\n\t\t\tdidScroll = false;\n\n\t\t\tvar t = getNativeEvent( event ).touches[ 0 ];\n\t\t\tstartX = t.pageX;\n\t\t\tstartY = t.pageY;\n\n\t\t\ttriggerVirtualEvent( \"vmouseover\", event, flags );\n\t\t\ttriggerVirtualEvent( \"vmousedown\", event, flags );\n\t\t}\n\t}\n}\n\nfunction handleScroll( event ) {\n\tif ( blockTouchTriggers ) {\n\t\treturn;\n\t}\n\n\tif ( !didScroll ) {\n\t\ttriggerVirtualEvent( \"vmousecancel\", event, getVirtualBindingFlags( event.target ) );\n\t}\n\n\tdidScroll = true;\n\tstartResetTimer();\n}\n\nfunction handleTouchMove( event ) {\n\tif ( blockTouchTriggers ) {\n\t\treturn;\n\t}\n\n\tvar t = getNativeEvent( event ).touches[ 0 ],\n\t\tdidCancel = didScroll,\n\t\tmoveThreshold = $.vmouse.moveDistanceThreshold;\n\t\tdidScroll = didScroll ||\n\t\t\t( Math.abs(t.pageX - startX) > moveThreshold ||\n\t\t\t\tMath.abs(t.pageY - startY) > moveThreshold ),\n\t\tflags = getVirtualBindingFlags( event.target );\n\n\tif ( didScroll && !didCancel ) {\n\t\ttriggerVirtualEvent( \"vmousecancel\", event, flags );\n\t}\n\n\ttriggerVirtualEvent( \"vmousemove\", event, flags );\n\tstartResetTimer();\n}\n\nfunction handleTouchEnd( event ) {\n\tif ( blockTouchTriggers ) {\n\t\treturn;\n\t}\n\n\tdisableTouchBindings();\n\n\tvar flags = getVirtualBindingFlags( event.target ),\n\t\tt;\n\ttriggerVirtualEvent( \"vmouseup\", event, flags );\n\n\tif ( !didScroll ) {\n\t\tvar ve = triggerVirtualEvent( \"vclick\", event, flags );\n\t\tif ( ve && ve.isDefaultPrevented() ) {\n\t\t\t// The target of the mouse events that follow the touchend\n\t\t\t// event don't necessarily match the target used during the\n\t\t\t// touch. This means we need to rely on coordinates for blocking\n\t\t\t// any click that is generated.\n\t\t\tt = getNativeEvent( event ).changedTouches[ 0 ];\n\t\t\tclickBlockList.push({\n\t\t\t\ttouchID: lastTouchID,\n\t\t\t\tx: t.clientX,\n\t\t\t\ty: t.clientY\n\t\t\t});\n\n\t\t\t// Prevent any mouse events that follow from triggering\n\t\t\t// virtual event notifications.\n\t\t\tblockMouseTriggers = true;\n\t\t}\n\t}\n\ttriggerVirtualEvent( \"vmouseout\", event, flags);\n\tdidScroll = false;\n\n\tstartResetTimer();\n}\n\nfunction hasVirtualBindings( ele ) {\n\tvar bindings = $.data( ele, dataPropertyName ),\n\t\tk;\n\n\tif ( bindings ) {\n\t\tfor ( k in bindings ) {\n\t\t\tif ( bindings[ k ] ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction dummyMouseHandler(){}\n\nfunction getSpecialEventObject( eventType ) {\n\tvar realType = eventType.substr( 1 );\n\n\treturn {\n\t\tsetup: function( data, namespace ) {\n\t\t\t// If this is the first virtual mouse binding for this element,\n\t\t\t// add a bindings object to its data.\n\n\t\t\tif ( !hasVirtualBindings( this ) ) {\n\t\t\t\t$.data( this, dataPropertyName, {});\n\t\t\t}\n\n\t\t\t// If setup is called, we know it is the first binding for this\n\t\t\t// eventType, so initialize the count for the eventType to zero.\n\t\t\tvar bindings = $.data( this, dataPropertyName );\n\t\t\tbindings[ eventType ] = true;\n\n\t\t\t// If this is the first virtual mouse event for this type,\n\t\t\t// register a global handler on the document.\n\n\t\t\tactiveDocHandlers[ eventType ] = ( activeDocHandlers[ eventType ] || 0 ) + 1;\n\n\t\t\tif ( activeDocHandlers[ eventType ] === 1 ) {\n\t\t\t\t$document.bind( realType, mouseEventCallback );\n\t\t\t}\n\n\t\t\t// Some browsers, like Opera Mini, won't dispatch mouse/click events\n\t\t\t// for elements unless they actually have handlers registered on them.\n\t\t\t// To get around this, we register dummy handlers on the elements.\n\n\t\t\t$( this ).bind( realType, dummyMouseHandler );\n\n\t\t\t// For now, if event capture is not supported, we rely on mouse handlers.\n\t\t\tif ( eventCaptureSupported ) {\n\t\t\t\t// If this is the first virtual mouse binding for the document,\n\t\t\t\t// register our touchstart handler on the document.\n\n\t\t\t\tactiveDocHandlers[ \"touchstart\" ] = ( activeDocHandlers[ \"touchstart\" ] || 0) + 1;\n\n\t\t\t\tif (activeDocHandlers[ \"touchstart\" ] === 1) {\n\t\t\t\t\t$document.bind( \"touchstart\", handleTouchStart )\n\t\t\t\t\t\t.bind( \"touchend\", handleTouchEnd )\n\n\t\t\t\t\t\t// On touch platforms, touching the screen and then dragging your finger\n\t\t\t\t\t\t// causes the window content to scroll after some distance threshold is\n\t\t\t\t\t\t// exceeded. On these platforms, a scroll prevents a click event from being\n\t\t\t\t\t\t// dispatched, and on some platforms, even the touchend is suppressed. To\n\t\t\t\t\t\t// mimic the suppression of the click event, we need to watch for a scroll\n\t\t\t\t\t\t// event. Unfortunately, some platforms like iOS don't dispatch scroll\n\t\t\t\t\t\t// events until *AFTER* the user lifts their finger (touchend). This means\n\t\t\t\t\t\t// we need to watch both scroll and touchmove events to figure out whether\n\t\t\t\t\t\t// or not a scroll happenens before the touchend event is fired.\n\n\t\t\t\t\t\t.bind( \"touchmove\", handleTouchMove )\n\t\t\t\t\t\t.bind( \"scroll\", handleScroll );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tteardown: function( data, namespace ) {\n\t\t\t// If this is the last virtual binding for this eventType,\n\t\t\t// remove its global handler from the document.\n\n\t\t\t--activeDocHandlers[ eventType ];\n\n\t\t\tif ( !activeDocHandlers[ eventType ] ) {\n\t\t\t\t$document.unbind( realType, mouseEventCallback );\n\t\t\t}\n\n\t\t\tif ( eventCaptureSupported ) {\n\t\t\t\t// If this is the last virtual mouse binding in existence,\n\t\t\t\t// remove our document touchstart listener.\n\n\t\t\t\t--activeDocHandlers[ \"touchstart\" ];\n\n\t\t\t\tif ( !activeDocHandlers[ \"touchstart\" ] ) {\n\t\t\t\t\t$document.unbind( \"touchstart\", handleTouchStart )\n\t\t\t\t\t\t.unbind( \"touchmove\", handleTouchMove )\n\t\t\t\t\t\t.unbind( \"touchend\", handleTouchEnd )\n\t\t\t\t\t\t.unbind( \"scroll\", handleScroll );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar $this = $( this ),\n\t\t\t\tbindings = $.data( this, dataPropertyName );\n\n\t\t\t// teardown may be called when an element was\n\t\t\t// removed from the DOM. If this is the case,\n\t\t\t// jQuery core may have already stripped the element\n\t\t\t// of any data bindings so we need to check it before\n\t\t\t// using it.\n\t\t\tif ( bindings ) {\n\t\t\t\tbindings[ eventType ] = false;\n\t\t\t}\n\n\t\t\t// Unregister the dummy event handler.\n\n\t\t\t$this.unbind( realType, dummyMouseHandler );\n\n\t\t\t// If this is the last virtual mouse binding on the\n\t\t\t// element, remove the binding data from the element.\n\n\t\t\tif ( !hasVirtualBindings( this ) ) {\n\t\t\t\t$this.removeData( dataPropertyName );\n\t\t\t}\n\t\t}\n\t};\n}\n\n// Expose our custom events to the jQuery bind/unbind mechanism.\n\nfor ( var i = 0; i < virtualEventNames.length; i++ ){\n\t$.event.special[ virtualEventNames[ i ] ] = getSpecialEventObject( virtualEventNames[ i ] );\n}\n\n// Add a capture click handler to block clicks.\n// Note that we require event capture support for this so if the device\n// doesn't support it, we punt for now and rely solely on mouse events.\nif ( eventCaptureSupported ) {\n\tdocument.addEventListener( \"click\", function( e ){\n\t\tvar cnt = clickBlockList.length,\n\t\t\ttarget = e.target,\n\t\t\tx, y, ele, i, o, touchID;\n\n\t\tif ( cnt ) {\n\t\t\tx = e.clientX;\n\t\t\ty = e.clientY;\n\t\t\tthreshold = $.vmouse.clickDistanceThreshold;\n\n\t\t\t// The idea here is to run through the clickBlockList to see if\n\t\t\t// the current click event is in the proximity of one of our\n\t\t\t// vclick events that had preventDefault() called on it. If we find\n\t\t\t// one, then we block the click.\n\t\t\t//\n\t\t\t// Why do we have to rely on proximity?\n\t\t\t//\n\t\t\t// Because the target of the touch event that triggered the vclick\n\t\t\t// can be different from the target of the click event synthesized\n\t\t\t// by the browser. The target of a mouse/click event that is syntehsized\n\t\t\t// from a touch event seems to be implementation specific. For example,\n\t\t\t// some browsers will fire mouse/click events for a link that is near\n\t\t\t// a touch event, even though the target of the touchstart/touchend event\n\t\t\t// says the user touched outside the link. Also, it seems that with most\n\t\t\t// browsers, the target of the mouse/click event is not calculated until the\n\t\t\t// time it is dispatched, so if you replace an element that you touched\n\t\t\t// with another element, the target of the mouse/click will be the new\n\t\t\t// element underneath that point.\n\t\t\t//\n\t\t\t// Aside from proximity, we also check to see if the target and any\n\t\t\t// of its ancestors were the ones that blocked a click. This is necessary\n\t\t\t// because of the strange mouse/click target calculation done in the\n\t\t\t// Android 2.1 browser, where if you click on an element, and there is a\n\t\t\t// mouse/click handler on one of its ancestors, the target will be the\n\t\t\t// innermost child of the touched element, even if that child is no where\n\t\t\t// near the point of touch.\n\n\t\t\tele = target;\n\n\t\t\twhile ( ele ) {\n\t\t\t\tfor ( i = 0; i < cnt; i++ ) {\n\t\t\t\t\to = clickBlockList[ i ];\n\t\t\t\t\ttouchID = 0;\n\n\t\t\t\t\tif ( ( ele === target && Math.abs( o.x - x ) < threshold && Math.abs( o.y - y ) < threshold ) ||\n\t\t\t\t\t\t\t\t$.data( ele, touchTargetPropertyName ) === o.touchID ) {\n\t\t\t\t\t\t// XXX: We may want to consider removing matches from the block list\n\t\t\t\t\t\t//      instead of waiting for the reset timer to fire.\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tele = ele.parentNode;\n\t\t\t}\n\t\t}\n\t}, true);\n}\n})( jQuery, window, document );\n","// Perseus running in local mode depends on $_, which is defined here\n\nvar createFragment = function(obj) {\n  return React.createElement(React.Fragment, null, Object.keys(obj).map(\n    (key) => React.createElement(React.Fragment, { key: key }, obj[key])\n  ))\n};\n\n// The plural language strings for all the languages we have\n// listed in crowdin.  The values here need to match what crowdin\n// uses (sometimes different platforms use different plural forms,\n// for ambiguous languages like Turkish).  I got it by running\n//    deploy/download_i18n.py -s\n// and looking a the .po files in all.zip.  Each .po file has a\n// header line that say something like:\n//    \"Plural-Forms: nplurals=2; plural=(n != 1);\\n\"\n// which I copied in here with the following changes:\n//    1) I only take the 'plural=' section, which I wrapped in a function\n//    2) Changed 'or' to '||'\n// These functions return either true or false or a number.  We map\n// true to 1 and false to 0 below, to always get a number out of this.\n\n/* eslint-disable space-infix-ops, eqeqeq, max-len */\nvar likeEnglish = function (n) {return n != 1;};\n\n// TODO(csilvers): auto-generate this list from the foo.po files (in dropbox)\nvar allPluralForms = {\n    \"accents\": likeEnglish, // a 'fake' langauge\n    \"af\": likeEnglish,\n    \"ar\": function (n) {return n == 0 ? 0 : n == 1 ? 1 : n == 2 ? 2 : n % 100 >= 3 && n % 100 <= 10 ? 3 : n % 100 >= 11 && n % 100 <= 99 ? 4 : 5;},\n    \"az\": likeEnglish,\n    \"bg\": likeEnglish,\n    \"bn\": likeEnglish,\n    \"boxes\": likeEnglish, // a 'fake' langauge\n    \"ca\": likeEnglish,\n    \"cs\": function (n) {return n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2;},\n    \"da\": likeEnglish,\n    \"de\": likeEnglish,\n    \"el\": likeEnglish,\n    \"empty\": likeEnglish, // a 'fake' langauge\n    \"en\": likeEnglish,\n    \"en-pt\": likeEnglish, // a 'fake' language, used by crowdin for JIPT\n    \"es\": likeEnglish,\n    \"fa\": function (n) {return 0;},\n    \"fa-af\": function (n) {return 0;},\n    \"fi\": likeEnglish,\n    \"fr\": function (n) {return n > 1;},\n    \"he\": likeEnglish,\n    \"hi\": likeEnglish,\n    \"hu\": likeEnglish,\n    \"hy\": likeEnglish,\n    \"id\": function (n) {return 0;},\n    \"it\": likeEnglish,\n    \"ja\": function (n) {return 0;},\n    \"ko\": function (n) {return 0;},\n    \"lol\": likeEnglish, // a 'fake' langauge\n    \"mn\": likeEnglish,\n    \"ms\": function (n) {return 0;},\n    \"nb\": likeEnglish,\n    \"nl\": likeEnglish,\n    \"pl\": function (n) {return n == 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;},\n    \"pt\": likeEnglish,\n    \"pt-pt\": likeEnglish,\n    \"ro\": function (n) {return n == 1 ? 0 : n == 0 || n % 100 > 0 && n % 100 < 20 ? 1 : 2;},\n    \"ru\": function (n) {return n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;},\n    \"si-LK\": likeEnglish,\n    \"sk\": function (n) {return n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2;},\n    \"sr\": function (n) {return n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;},\n    \"sv-SE\": likeEnglish,\n    \"sw\": likeEnglish,\n    \"te\": likeEnglish,\n    \"th\": function (n) {return 0;},\n    \"tr\": function (n) {return 0;},\n    \"uk\": function (n) {return n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;},\n    \"ur\": likeEnglish,\n    \"vi\": function (n) {return 0;},\n    \"xh\": likeEnglish,\n    \"zh-hans\": function (n) {return 0;},\n    \"zh-hant\": function (n) {return 0;},\n    \"zu\": likeEnglish };\n\n/* eslint-enable */\n\nvar interpolationMarker = /%\\(([\\w_]+)\\)s/g;\n/**\n * Performs sprintf-like %(name)s replacement on str, and returns a React\n * fragment of the string interleaved with those replacements. The replacements\n * can be any valid React node including strings and numbers.\n *\n * For example:\n *  interpolateStringToFragment(\"test\", {}) ->\n *      test\n *  interpolateStringToFragment(\"test %(num)s\", {num: 5}) ->\n *      test 5\n *  interpolateStringToFragment(\"test %(num)s\", {num: <Count />}) ->\n *      test <Count />\n */\nvar interpolateStringToFragment = function (str, options) {\n    options = options || {};\n\n    // Split the string into its language fragments and substitutions\n    var split = str.split(interpolationMarker);\n\n    var result = { \"text_0\": split[0] };\n\n    // Replace the substitutions with the appropriate option\n    for (var i = 1; i < split.length; i += 2) {\n        var key = split[i];\n        var replaceWith = options[key];\n        if (replaceWith === undefined) {\n            replaceWith = \"%(\" + key + \")s\";}\n\n\n        // We prefix each substitution key with a number that increments each\n        // time it's used, so \"test %(num)s %(fruit)s and %(num)s again\" turns\n        // into an object with keys:\n        // [text_0, 0_num, text_2, 0_fruit, text_4, 1_num, text_6]\n        // This is better than just using the array index in the case that we\n        // switch between two translated strings with the same variables.\n        // Admittedly, an edge case.\n        var j = 0;\n        while (\"\" + j + \"_\" + key in result) {\n            j++;}\n\n        result[\"\" + j + \"_\" + key] = replaceWith;\n        // Because the regex has one capturing group, the `split` array always\n        // has an odd number of elements, so this always stays in bounds.\n        result[\"text_\" + (i + 1)] = split[i + 1];}\n\n\n    return createFragment(result);};\n\n\n/**\n    * Simple i18n method with sprintf-like %(name)s replacement\n    * To be used like so:\n    *   i18n._(\"Some string\")\n    *   i18n._(\"Hello %(name)s\", {name: \"John\"})\n    */\nvar _ = function (str, options) {\n    // Sometimes we're given an argument that's meant for ngettext().  This\n    // happens if the same string is used in both i18n._() and i18n.ngettext()\n    // (.g. a = i18n._(foo); b = i18n.ngettext(\"foo\", \"bar\", count);\n    // In such cases, only the plural form ends up in the .po file, and\n    // then it gets sent to us for the i18n._() case too.  No problem, though:\n    // we'll just take the singular arg.\n    if (typeof str === \"object\" && str.messages) {\n        str = str.messages[0];}\n\n\n    options = options || {};\n\n    return str.replace(interpolationMarker, function (match, key) {\n        var replaceWith = options[key];\n        return replaceWith === undefined ? match : replaceWith;});};\n\n\n\n/**\n    * A simple i18n react component-like function to allow for string\n    * interpolation destined for the output of a react render() function\n    *\n    * This function understands react components, or other things\n    * renderable by react, passed in as props.\n    *\n    * Examples:\n    *   <$_ first=\"Motoko\" last=\"Kusanagi\">\n    *       Hello, %(first)s %(last)s!\n    *   </$_>\n    *\n    * which react/jsx compiles to:\n    *   $_({first: \"Motoko\", last: \"Kusanagi\"}, \"Hello, %(first)s %(last)s!\")\n    *\n    *\n    *   <$_ textbox={<input type=\"text\" />}>\n    *       Please enter a number: %(textbox)s\n    *   </$_>\n    *\n    * which react/jsx compiles to:\n    *   $_({textbox: ReactDOMtags.input({type: \"text\"}),\n    *       \"Please enter a number: %(textbox)s\")\n    *\n    * Note: this is not a full react component to avoid complex handling of\n    * other things added to props, such as this.props.ref and\n    * this.props.children\n    */\nexport const $_ = function (options, str) {\n    if (arguments.length !== 2 || typeof str !== \"string\") {\n        return \"<$_> must have exactly one child, which must be a string\";}\n\n    return interpolateStringToFragment(str, options);};\n\n\n/**\n    * A simple i18n react component-like function to allow for marking a\n    * string as not needing to be translated.\n    *\n    * Example:\n    *\n    *    <$i18nDoNotTranslate>English only text.</$i18nDoNotTranslate>\n    *\n    * which react/jsx compiles to:\n    *    $i18nDoNotTranslate(null, \"English only text.\")\n    */\nexport const $i18nDoNotTranslate = function (options, str) {\n    return str;};\n\n\n/**\n    * Simple ngettext method with sprintf-like %(name)s replacement\n    * To be used like so:\n    *   i18n.ngettext(\"Singular\", \"Plural\", 3)\n    *   i18n.ngettext(\"1 Cat\", \"%(num)s Cats\", 3)\n    *   i18n.ngettext(\"1 %(type)s\", \"%(num)s %(type)s\", 3, {type: \"Cat\"})\n    * This method is also meant to be used when injecting for other\n    * non-English languages, like so (taking an array of plural messages,\n    * which varies based upon the language):\n    *   i18n.ngettext({\n    *     lang: \"ja\",\n    *     messages: [\"%(num)s  %(username)s\"]\n    *   }, 3, {username: \"John\"});\n    */\nvar ngettext = function (singular, plural, num, options) {\n    // Fall back to the default lang\n    var lang;\n    var messages;\n\n    // If the first argument is an object then we're receiving a plural\n    // configuration object\n    if (typeof singular === \"object\") {\n        lang = singular.lang;\n        messages = singular.messages;\n        // We only have a messages object no plural string\n        // thus we need to shift all the arguments over by one.\n        options = num;\n        num = plural;} else\n    {\n        lang = \"en\"; // We're using text written into the source code\n        messages = [singular, plural];}\n\n\n    // Get the translated string\n    var idx = ngetpos(num, lang);\n    var translation = \"\";\n    if (idx < messages.length) {// the common (non-error) case\n        translation = messages[idx];}\n\n\n    // Get the options to substitute into the string.\n    // We automatically add in the 'magic' option-variable 'num'.\n    options = options || {};\n    options.num = options.num || num;\n\n    // Then pass into i18n._ for the actual substitution\n    return _(translation, options);};\n\n\n/*\n    * Return the ngettext position that matches the given number and locale.\n    *\n    * Arguments:\n    *  - num: The number upon which to toggle the plural forms.\n    *  - lang: The language to use as the basis for the pluralization.\n    */\nvar ngetpos = function (num, lang) {\n    var pluralForm = allPluralForms[lang] || allPluralForms[\"en\"];\n    var pos = pluralForm(num);\n    // Map true to 1 and false to 0, keep any numeric return value the same.\n    return pos === true ? 1 : pos ? pos : 0;};\n\n\n/*\n    * A dummy identity function.  It's used as a signal to automatic\n    * translation-identification tools that they shouldn't mark this\n    * text up to be translated, even though it looks like\n    * natural-language text.  (And likewise, a signal to linters that\n    * they shouldn't complain that this text isn't translated.)\n    * Use it like so: 'tag.author = i18n.i18nDoNotTranslate(\"Jim\");'\n    */\nvar i18nDoNotTranslate = _;\n\n/**\n    * Dummy Handlebars _ function. Is a noop.\n    * Should be used as: {{#_}}...{{/_}}\n    * The text is extracted, at compile-time, by server-side scripts.\n    * This is just used for marking up those fragments that need translation.\n    * The translated text is injected at deploy-time.\n    */\nvar handlebarsUnderscore = function (options) {\n    return options.fn(this);};\n\n\n/**\n    *  Mark text as not needing translation.\n    *\n    * This function is used to let i18nize_templates.py know that\n    * everything within it does not need to be translate.\n    * Should be used as: {{#i18nDoNotTranslate}}...{{/i18nDoNotTranslate}}\n    * It does not need to actually do anything and hence returns the contents\n    * as is.\n    */\nvar handlebarsDoNotTranslate = function (options) {\n    return options.fn(this);};\n\n\n/**\n    * Handlebars ngettext function.\n    * Doesn't do any translation, is used for showing the correct string\n    * based upon the specified number and language.\n    * All strings are extracted (at compile-time) and injected (at\n    * deploy-time). By default this should be used as:\n    *   {{#ngettext NUM}}singular{{else}}plural{{/ngettext}}\n    * After injecting the translated strings into the page it'll read as:\n    *   {{#ngettext NUM \"lang\" 0}}singular{{else}}plural{{/ngettext}}\n    * (May depend upon the language used and how many different plural\n    * forms the language has.)\n    *\n    * Arguments:\n    *  - num: The number upon which to toggle the plural forms.\n    *  - lang: The language to use as the basis for the pluralization.\n    *  - pos: The expected plural form (depends upon the language)\n    */\nvar handlebarsNgettext = function (num, lang, pos, options) {\n    // This method has two signatures:\n    // (num) (the default for when the code is run in dev mode)\n    // (num, lang, pos) (for when the code is run in prod mode)\n    if (typeof lang !== \"string\") {\n        options = lang;\n        lang = \"en\";\n        pos = 0;}\n\n\n    // Add in 'num' as a magic variable.\n    this.num = this.num || num;\n\n    // If the result of the plural form function given the specified\n    // number matches the expected position then we give the first\n    // result, otherwise we give the inverse result.\n    return ngetpos(num) === pos ?\n    options.fn(this) :\n    options.inverse(this);};\n\n\n/**\n * Rounds num to X places, and uses the proper decimal seperator.\n * But does *not* insert thousands separators.\n */\nvar localeToFixed = function (num, places) {\n    var decimalSeperator = icu.getDecimalFormatSymbols().decimal_separator;\n    var localeFixed = num.toFixed(places).replace(\".\", decimalSeperator);\n    if (localeFixed === \"-0\") {\n        localeFixed = \"0\";}\n\n    return localeFixed;};\n\n\n// This is necessary for khan-exercises, perseus, and\n// bootstrap-daterangepicker (live-editor also uses the global i18n\n// var, but defines its own version of it.)  We export the symbols\n// that they need.\nexport const i18n = window.i18n = {\n    _: _,\n    ngettext: ngettext,\n    i18nDoNotTranslate: i18nDoNotTranslate,\n    // khan-exercises is the only client of ngetpos (which is emitted\n    // into khan-exercises by kake/translate-exercises.py).\n    ngetpos: ngetpos };\n\n\n// TODO(csilvers): is it still necessary to make these globals?\nwindow.$_ = $_;\nwindow.$i18nDoNotTranslate = $i18nDoNotTranslate;\n","import _reactAddonsPureRenderMixin from \"react-addons-pure-render-mixin\";\nimport $ from \"jquery\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport createReactClass from \"create-react-class\";\nimport PropTypes from \"prop-types\";\nimport katex from \"katex\";\nimport classnames from \"classnames\";\nimport _ from \"underscore\";\nimport \"./lib/i18n.js\"; // side effects\nimport MathQuill from \"mathquill\";\n\n// NOTE: We don't import the CSS here. Instead, applications can do it separately:\n//       import \"perseus-configured/lib/khan-exercises.css\";\n//       import \"perseus-configured/lib/perseus.css\";\n// TODO: Consider a build step to make it one CSS file, and include Mathquill too?\n\n// Add some backfills to make React 17 behave like old-style React.\n// TODO: Update Perseus to use these libraries directly, instead. They're not perfect\n//       backfills and I'm not sure how reliable this is!\nwindow.createReactClass = createReactClass;\nwindow.PropTypes = PropTypes;\nwindow.ReactDOMtags = {\n  span: props => React.createElement(\"span\", props),\n  input: props => React.createElement(\"input\", props),\n};\n\nwindow.jQuery = window.$ = $;\nwindow.katex = katex;\nwindow.MathQuill = MathQuill;\nwindow.classnames = classnames;\nwindow._ = _;\n\n// Perseus bundles its own copy of Raphael but throws if Raphael isn't already\n// defined, because Raphael does a global `Raphael = ...` assignment but we\n// load it in strict mode\nwindow.Raphael = undefined;\n\nconst PureRenderMixin = _reactAddonsPureRenderMixin;\n\nwindow.React = React;\nwindow.ReactDOM = ReactDOM;\n\nwindow[\"underscore\"] = window._;\nwindow[\"react\"] = window.React;\nwindow[\"react-dom\"] = window.ReactDOM;\nwindow[\"classnames\"] = window.classNames;\nwindow[\"jquery\"] = window.jQuery;\nwindow[\"react-addons-pure-render-mixin\"] = PureRenderMixin;\n\n/**\n * Sets up the basic environment for running Perseus in.\n */\n\nwindow.icu = {\n  getDecimalFormatSymbols: function() {\n    return {\n      decimal_separator: \".\",\n      grouping_separator: \",\",\n      minus: \"-\",\n    };\n  },\n};\n\nwindow.KhanUtil = {\n  debugLog: function() {},\n  localeToFixed: function(num, precision) {\n    return num.toFixed(precision);\n  },\n};\n\nwindow.Exercises = {\n  localMode: true,\n\n  useKatex: true,\n  khanExercisesUrlBase: \"../\",\n\n  getCurrentFramework: function() {\n    return \"khan-exercises\";\n  },\n  PerseusBridge: {\n    cleanupProblem: function() {\n      return false;\n    },\n  },\n};\n\nwindow.Khan = {\n  Util: window.KhanUtil,\n  error: function() {},\n  query: { debug: \"\" },\n  imageBase: \"/images/\",\n};\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * These tools allow you to construct arbirtary shapes, by combining simple\n * leaf shapes like `content` and `hint` into composite shapes like\n * `arrayOf(shape({question: content, hints: arrayOf(hint)}))`.\n */\nconst contentShape = {\n    type: \"content\",\n};\nconst hintShape = {\n    type: \"hint\",\n};\nconst tagsShape = {\n    type: \"tags\",\n};\nconst buildArrayShape = elementShape => ({\n    type: \"array\",\n    elementShape\n});\nconst buildObjectShape = shape => ({\n    type: \"object\",\n    shape\n});\nconst hintsShape = buildArrayShape(hintShape);\n\n\n_module_.exports = {\n    content: contentShape,\n    hint: hintShape,\n    hints: hintsShape,\n    tags: tagsShape,\n    arrayOf: buildArrayShape,\n    shape: buildObjectShape,\n};\nexport default _module_.exports;\n","import React from \"react\";\n\n/**\n * Utility functions to build PropTypes for multi-items and shapes.\n *\n * If you're writing new components, though, consider using the Item and Shape\n * Flow types instead.\n */\n\n/**\n * A recursive PropType that accepts Shape objects, and rejects other objects.\n *\n * Usage: `propTypes: {shape: shapePropType}`.\n */\nexport function shapePropType(...args) {\n    const itemShape = PropTypes.oneOfType([\n        PropTypes.shape({\n            type: PropTypes.oneOf([\"content\"]).isRequired,\n        }).isRequired,\n        PropTypes.shape({\n            type: PropTypes.oneOf([\"hint\"]).isRequired,\n        }).isRequired,\n        PropTypes.shape({\n            type: PropTypes.oneOf([\"tags\"]).isRequired,\n        }).isRequired,\n        PropTypes.shape({\n            type: PropTypes.oneOf([\"object\"]).isRequired,\n            shape: PropTypes.objectOf(shapePropType),\n        }).isRequired,\n        PropTypes.shape({\n            type: PropTypes.oneOf([\"array\"]).isRequired,\n            elementShape: shapePropType,\n        }).isRequired,\n    ]);\n\n    return itemShape(...args);\n}\n\n/**\n * Return a PropType that accepts Items of the given shape, and rejects other\n * objects.\n *\n * Usage: `propTypes: {item: buildPropTypeForShape(myShape)}`\n */\nexport function buildPropTypeForShape(shape) {\n    return PropTypes.oneOfType([\n        PropTypes.shape({\n            _multi: buildTreePropTypeForShape(shape),\n        }),\n        PropTypes.oneOf([null, undefined]),\n    ]);\n}\n\n/**\n * Return a PropType that accepts ItemTrees of the given shape, and rejects\n * other objects.\n */\nfunction buildTreePropTypeForShape(shape) {\n    if (shape.type === \"content\") {\n        return PropTypes.shape({\n            // TODO(mdr): Remove #LegacyContentNode support.\n            __type: PropTypes.oneOf([\"content\", \"item\"]).isRequired,\n            content: PropTypes.string,\n            images: PropTypes.objectOf(PropTypes.any),\n            widgets: PropTypes.objectOf(PropTypes.any),\n        });\n    } else if (shape.type === \"hint\") {\n        return PropTypes.shape({\n            __type: PropTypes.oneOf([\"hint\"]).isRequired,\n            content: PropTypes.string,\n            images: PropTypes.objectOf(PropTypes.any),\n            widgets: PropTypes.objectOf(PropTypes.any),\n            replace: PropTypes.bool,\n        });\n    } else if (shape.type === \"tags\") {\n        return PropTypes.arrayOf(PropTypes.string.isRequired);\n    } else if (shape.type === \"array\") {\n        const elementPropType = buildTreePropTypeForShape(shape.elementShape);\n        return PropTypes.arrayOf(elementPropType.isRequired);\n    } else if (shape.type === \"object\") {\n        const valueShapes = shape.shape;\n        const propTypeShape = {};\n        Object.keys(valueShapes).forEach(key => {\n            propTypeShape[key] =\n                buildTreePropTypeForShape(valueShapes[key]).isRequired;\n        });\n        return PropTypes.shape(propTypeShape);\n    } else {\n        throw new Error(`unexpected shape type ${shape.type}`);\n    }\n}\n","const svgLabelsRegex = /^web\\+graphie\\:/;\n\nexport function isLabeledSVG(url) {\n    return svgLabelsRegex.test(url);\n}\n\n// For each svg+labels, there are two urls we need to download from. This gets\n// the base url without the suffix, and `getSvgUrl` and `getDataUrl` apply\n// appropriate suffixes to get the image and other data\nexport function getBaseUrl(url) {\n    // Force HTTPS connection unless we're on HTTP, so that IE works.\n    const protocol = window.location.protocol === \"http:\" ? \"http:\" : \"https:\";\n\n    return url.replace(svgLabelsRegex, protocol);\n}\n\nexport function getSvgUrl(url) {\n    return getBaseUrl(url) + \".svg\";\n}\n\nexport function getDataUrl(url) {\n    return getBaseUrl(url) + \"-data.json\";\n}\n\n// A regex to split at the last / of a URL, separating the base part from the\n// hash. This is used to create the localized label data URLs.\nconst splitHashRegex = /\\/(?=[^/]+$)/;\n\nexport function getLocalizedDataUrl(url) {\n    if (typeof KA !== \"undefined\") {\n        // Parse out the hash and base so that we can insert the locale\n        // directory in the middle.\n        const [base, hash] = getBaseUrl(url).split(splitHashRegex);\n        return `${base}/${KA.language}/${hash}-data.json`;\n    } else {\n        return getDataUrl(url);\n    }\n}\n\nexport function getRealImageUrl(url) {\n    if (isLabeledSVG(url)) {\n        return getSvgUrl(url);\n    } else {\n        return url;\n    }\n}\n","/*! KAS | https://github.com/Khan/KAS */\n// This is a @generated file\nconst KAS = {};\n(function(KAS) {\n\n/* parser generated by jison 0.4.15 */\n/*\n  Returns a Parser object of the following structure:\n\n  Parser: {\n    yy: {}\n  }\n\n  Parser.prototype: {\n    yy: {},\n    trace: function(),\n    symbols_: {associative list: name ==> number},\n    terminals_: {associative list: number ==> name},\n    productions_: [...],\n    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$),\n    table: [...],\n    defaultActions: {...},\n    parseError: function(str, hash),\n    parse: function(input),\n\n    lexer: {\n        EOF: 1,\n        parseError: function(str, hash),\n        setInput: function(input),\n        input: function(),\n        unput: function(str),\n        more: function(),\n        less: function(n),\n        pastInput: function(),\n        upcomingInput: function(),\n        showPosition: function(),\n        test_match: function(regex_match_array, rule_index),\n        next: function(),\n        lex: function(),\n        begin: function(condition),\n        popState: function(),\n        _currentRules: function(),\n        topState: function(),\n        pushState: function(condition),\n\n        options: {\n            ranges: boolean           (optional: true ==> token location info will include a .range[] member)\n            flex: boolean             (optional: true ==> flex-like lexing behaviour where the rules are tested exhaustively to find the longest match)\n            backtrack_lexer: boolean  (optional: true ==> lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code)\n        },\n\n        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START),\n        rules: [...],\n        conditions: {associative list: name ==> set},\n    }\n  }\n\n\n  token location info (@$, _$, etc.): {\n    first_line: n,\n    last_line: n,\n    first_column: n,\n    last_column: n,\n    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based)\n  }\n\n\n  the parseError function receives a 'hash' object with these members for lexer and parser errors: {\n    text:        (matched text)\n    token:       (the produced terminal token, if any)\n    line:        (yylineno)\n  }\n  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: {\n    loc:         (yylloc)\n    expected:    (string describing the set of expected tokens)\n    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error)\n  }\n*/\nvar parser = (function(){\nvar o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,7],$V1=[1,17],$V2=[1,13],$V3=[1,14],$V4=[1,15],$V5=[1,32],$V6=[1,22],$V7=[1,23],$V8=[1,24],$V9=[1,25],$Va=[1,26],$Vb=[1,33],$Vc=[1,27],$Vd=[1,28],$Ve=[1,29],$Vf=[1,30],$Vg=[1,20],$Vh=[1,36],$Vi=[1,37],$Vj=[5,6,8,10,33,35,41,43,45],$Vk=[1,39],$Vl=[1,40],$Vm=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],$Vn=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],$Vo=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46];\nvar parser = {trace: function trace() { },\nyy: {},\nsymbols_: {\"error\":2,\"equation\":3,\"expression\":4,\"SIGN\":5,\"EOF\":6,\"additive\":7,\"+\":8,\"multiplicative\":9,\"-\":10,\"triglog\":11,\"*\":12,\"negative\":13,\"/\":14,\"trig\":15,\"TRIG\":16,\"trigfunc\":17,\"^\":18,\"TRIGINV\":19,\"logbase\":20,\"ln\":21,\"log\":22,\"_\":23,\"subscriptable\":24,\"power\":25,\"primitive\":26,\"variable\":27,\"VAR\":28,\"CONST\":29,\"INT\":30,\"FLOAT\":31,\"{\":32,\"}\":33,\"(\":34,\")\":35,\"function\":36,\"FUNC\":37,\"invocation\":38,\"sqrt\":39,\"[\":40,\"]\":41,\"abs\":42,\"|\":43,\"LEFT|\":44,\"RIGHT|\":45,\"FRAC\":46,\"$accept\":0,\"$end\":1},\nterminals_: {2:\"error\",5:\"SIGN\",6:\"EOF\",8:\"+\",10:\"-\",12:\"*\",14:\"/\",16:\"TRIG\",18:\"^\",19:\"TRIGINV\",21:\"ln\",22:\"log\",23:\"_\",28:\"VAR\",29:\"CONST\",30:\"INT\",31:\"FLOAT\",32:\"{\",33:\"}\",34:\"(\",35:\")\",37:\"FUNC\",39:\"sqrt\",40:\"[\",41:\"]\",42:\"abs\",43:\"|\",44:\"LEFT|\",45:\"RIGHT|\",46:\"FRAC\"},\nproductions_: [0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],\nperformAction: function anonymous(yytext, yyleng, yylineno, yy, yystate /* action[1] */, $$ /* vstack */, _$ /* lstack */) {\n/* this == yyval */\n\nvar $0 = $$.length - 1;\nswitch (yystate) {\ncase 1:\nreturn new yy.Eq($$[$0-3], $$[$0-2], $$[$0-1]);\nbreak;\ncase 2:\nreturn $$[$0-1];\nbreak;\ncase 3:\nreturn new yy.Add([]);\nbreak;\ncase 4: case 7: case 11: case 13: case 15: case 20: case 23: case 25: case 42: case 43:\nthis.$ = $$[$0];\nbreak;\ncase 5:\nthis.$ = yy.Add.createOrAppend($$[$0-2], $$[$0]);\nbreak;\ncase 6:\nthis.$ = yy.Add.createOrAppend($$[$0-2], yy.Mul.handleNegative($$[$0], \"subtract\"));\nbreak;\ncase 8:\nthis.$ = yy.Mul.fold(yy.Mul.createOrAppend($$[$0-1], $$[$0]));\nbreak;\ncase 9:\nthis.$ = yy.Mul.fold(yy.Mul.createOrAppend($$[$0-2], $$[$0]));\nbreak;\ncase 10:\nthis.$ = yy.Mul.fold(yy.Mul.handleDivide($$[$0-2], $$[$0]));\nbreak;\ncase 12:\nthis.$ = yy.Mul.handleNegative($$[$0]);\nbreak;\ncase 14: case 17:\nthis.$ = [yytext];\nbreak;\ncase 16:\nthis.$ = $$[$0-2].concat($$[$0]);\nbreak;\ncase 18:\nthis.$ = yy.Log.natural();\nbreak;\ncase 19:\nthis.$ = yy.Log.common();\nbreak;\ncase 21:\nthis.$ = yy.Trig.create($$[$0-1], $$[$0]);\nbreak;\ncase 22:\nthis.$ = yy.Log.create($$[$0-1], $$[$0]);\nbreak;\ncase 24:\nthis.$ = new yy.Pow($$[$0-2], $$[$0]);\nbreak;\ncase 26: case 34:\nthis.$ = yytext;\nbreak;\ncase 27:\nthis.$ = new yy.Var($$[$0-2], $$[$0]);\nbreak;\ncase 28:\nthis.$ = new yy.Var($$[$0]);\nbreak;\ncase 29:\nthis.$ = new yy.Const(yytext.toLowerCase());\nbreak;\ncase 30:\nthis.$ = yy.Int.create(Number(yytext));\nbreak;\ncase 31:\nthis.$ = yy.Float.create(Number(yytext));\nbreak;\ncase 32:\nthis.$ = $$[$0-1].completeParse();\nbreak;\ncase 33:\nthis.$ = $$[$0-1].completeParse().addHint('parens');\nbreak;\ncase 35: case 36:\nthis.$ = yy.Pow.sqrt($$[$0-1]);\nbreak;\ncase 37:\nthis.$ = new yy.Pow.nthroot($$[$0-1], $$[$0-4]);\nbreak;\ncase 38: case 39: case 40:\nthis.$ = new yy.Abs($$[$0-1]);\nbreak;\ncase 41:\nthis.$ = new yy.Func($$[$0-3], $$[$0-1]);\nbreak;\ncase 44:\nthis.$ = yy.Mul.handleDivide($$[$0-4], $$[$0-1]);\nbreak;\n}\n},\ntable: [{3:1,4:2,6:[1,3],7:4,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},o([5,6],[2,4],{8:$Vh,10:$Vi}),o($Vj,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:$Vk,14:$Vl,16:$V1,19:$V2,21:$V3,22:$V4,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,37:$Vb,39:$Vc,42:$Vd,44:$Vf,46:$Vg}),o($Vm,[2,11]),{10:$V0,11:8,13:41,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},o($Vm,[2,13]),{10:$V0,11:8,13:42,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{10:$V0,11:8,13:43,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},o($Vm,[2,23]),o($Vn,[2,15],{18:[1,44]}),o($Vn,[2,17]),o($Vn,[2,18]),o($Vn,[2,19],{23:[1,45]}),o($Vm,[2,25],{18:[1,46]}),o([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),o($Vo,[2,42]),o($Vo,[2,43]),{32:[1,47]},o($Vo,[2,28],{23:[1,48]}),o($Vo,[2,29]),o($Vo,[2,30]),o($Vo,[2,31]),{7:49,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:50,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:56,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{34:[1,57]},o([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{1:[2,2]},{9:59,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{9:60,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},o($Vm,[2,8]),{10:$V0,11:8,13:61,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{10:$V0,11:8,13:62,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},o($Vm,[2,12]),o($Vm,[2,21]),o($Vm,[2,22]),{10:$V0,11:8,13:63,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{24:64,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va},{10:$V0,11:8,13:65,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:66,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{24:67,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va},{8:$Vh,10:$Vi,33:[1,68]},{8:$Vh,10:$Vi,35:[1,69]},{7:70,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:71,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:72,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:73,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{8:$Vh,10:$Vi,43:[1,74]},{8:$Vh,10:$Vi,45:[1,75]},{7:76,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{6:[1,77]},o($Vj,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:$Vk,14:$Vl,16:$V1,19:$V2,21:$V3,22:$V4,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,37:$Vb,39:$Vc,42:$Vd,44:$Vf,46:$Vg}),o($Vj,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:$Vk,14:$Vl,16:$V1,19:$V2,21:$V3,22:$V4,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,37:$Vb,39:$Vc,42:$Vd,44:$Vf,46:$Vg}),o($Vm,[2,9]),o($Vm,[2,10]),o($Vn,[2,16]),o($Vn,[2,20]),o($Vm,[2,24]),{8:$Vh,10:$Vi,33:[1,78]},o($Vo,[2,27]),o($Vo,[2,32]),o($Vo,[2,33]),{8:$Vh,10:$Vi,35:[1,79]},{8:$Vh,10:$Vi,33:[1,80]},{8:$Vh,10:$Vi,41:[1,81]},{8:$Vh,10:$Vi,35:[1,82]},o($Vo,[2,39]),o($Vo,[2,40]),{8:$Vh,10:$Vi,35:[1,83]},{1:[2,1]},{32:[1,84]},o($Vo,[2,35]),o($Vo,[2,36]),{32:[1,85]},o($Vo,[2,38]),o($Vo,[2,41]),{7:86,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{7:87,9:5,10:$V0,11:8,13:6,15:12,16:$V1,17:9,19:$V2,20:10,21:$V3,22:$V4,24:18,25:11,26:16,27:21,28:$V5,29:$V6,30:$V7,31:$V8,32:$V9,34:$Va,36:31,37:$Vb,38:19,39:$Vc,42:$Vd,43:$Ve,44:$Vf,46:$Vg},{8:$Vh,10:$Vi,33:[1,88]},{8:$Vh,10:$Vi,33:[1,89]},o($Vo,[2,44]),o($Vo,[2,37])],\ndefaultActions: {3:[2,3],33:[2,34],35:[2,2],77:[2,1]},\nparseError: function parseError(str, hash) {\n    if (hash.recoverable) {\n        this.trace(str);\n    } else {\n        throw new Error(str);\n    }\n},\nparse: function parse(input) {\n    var self = this, stack = [0], tstack = [], vstack = [null], lstack = [], table = this.table, yytext = '', yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;\n    var args = lstack.slice.call(arguments, 1);\n    var lexer = Object.create(this.lexer);\n    var sharedState = { yy: {} };\n    for (var k in this.yy) {\n        if (Object.prototype.hasOwnProperty.call(this.yy, k)) {\n            sharedState.yy[k] = this.yy[k];\n        }\n    }\n    lexer.setInput(input, sharedState.yy);\n    sharedState.yy.lexer = lexer;\n    sharedState.yy.parser = this;\n    if (typeof lexer.yylloc == 'undefined') {\n        lexer.yylloc = {};\n    }\n    var yyloc = lexer.yylloc;\n    lstack.push(yyloc);\n    var ranges = lexer.options && lexer.options.ranges;\n    if (typeof sharedState.yy.parseError === 'function') {\n        this.parseError = sharedState.yy.parseError;\n    } else {\n        this.parseError = Object.getPrototypeOf(this).parseError;\n    }\n    function popStack(n) {\n        stack.length = stack.length - 2 * n;\n        vstack.length = vstack.length - n;\n        lstack.length = lstack.length - n;\n    }\n        function lex() {\n            var token;\n            token = lexer.lex() || EOF;\n            if (typeof token !== 'number') {\n                token = self.symbols_[token] || token;\n            }\n            return token;\n        }\n    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;\n    while (true) {\n        state = stack[stack.length - 1];\n        if (this.defaultActions[state]) {\n            action = this.defaultActions[state];\n        } else {\n            if (symbol === null || typeof symbol == 'undefined') {\n                symbol = lex();\n            }\n            action = table[state] && table[state][symbol];\n        }\n                    if (typeof action === 'undefined' || !action.length || !action[0]) {\n                var errStr = '';\n                expected = [];\n                for (p in table[state]) {\n                    if (this.terminals_[p] && p > TERROR) {\n                        expected.push('\\'' + this.terminals_[p] + '\\'');\n                    }\n                }\n                if (lexer.showPosition) {\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ':\\n' + lexer.showPosition() + '\\nExpecting ' + expected.join(', ') + ', got \\'' + (this.terminals_[symbol] || symbol) + '\\'';\n                } else {\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ': Unexpected ' + (symbol == EOF ? 'end of input' : '\\'' + (this.terminals_[symbol] || symbol) + '\\'');\n                }\n                this.parseError(errStr, {\n                    text: lexer.match,\n                    token: this.terminals_[symbol] || symbol,\n                    line: lexer.yylineno,\n                    loc: yyloc,\n                    expected: expected\n                });\n            }\n        if (action[0] instanceof Array && action.length > 1) {\n            throw new Error('Parse Error: multiple actions possible at state: ' + state + ', token: ' + symbol);\n        }\n        switch (action[0]) {\n        case 1:\n            stack.push(symbol);\n            vstack.push(lexer.yytext);\n            lstack.push(lexer.yylloc);\n            stack.push(action[1]);\n            symbol = null;\n            if (!preErrorSymbol) {\n                yyleng = lexer.yyleng;\n                yytext = lexer.yytext;\n                yylineno = lexer.yylineno;\n                yyloc = lexer.yylloc;\n                if (recovering > 0) {\n                    recovering--;\n                }\n            } else {\n                symbol = preErrorSymbol;\n                preErrorSymbol = null;\n            }\n            break;\n        case 2:\n            len = this.productions_[action[1]][1];\n            yyval.$ = vstack[vstack.length - len];\n            yyval._$ = {\n                first_line: lstack[lstack.length - (len || 1)].first_line,\n                last_line: lstack[lstack.length - 1].last_line,\n                first_column: lstack[lstack.length - (len || 1)].first_column,\n                last_column: lstack[lstack.length - 1].last_column\n            };\n            if (ranges) {\n                yyval._$.range = [\n                    lstack[lstack.length - (len || 1)].range[0],\n                    lstack[lstack.length - 1].range[1]\n                ];\n            }\n            r = this.performAction.apply(yyval, [\n                yytext,\n                yyleng,\n                yylineno,\n                sharedState.yy,\n                action[1],\n                vstack,\n                lstack\n            ].concat(args));\n            if (typeof r !== 'undefined') {\n                return r;\n            }\n            if (len) {\n                stack = stack.slice(0, -1 * len * 2);\n                vstack = vstack.slice(0, -1 * len);\n                lstack = lstack.slice(0, -1 * len);\n            }\n            stack.push(this.productions_[action[1]][0]);\n            vstack.push(yyval.$);\n            lstack.push(yyval._$);\n            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];\n            stack.push(newState);\n            break;\n        case 3:\n            return true;\n        }\n    }\n    return true;\n}};\n/* generated by jison-lex 0.3.4 */\nvar lexer = (function(){\nvar lexer = ({\n\nEOF:1,\n\nparseError:function parseError(str, hash) {\n        if (this.yy.parser) {\n            this.yy.parser.parseError(str, hash);\n        } else {\n            throw new Error(str);\n        }\n    },\n\n// resets the lexer, sets new input\nsetInput:function (input, yy) {\n        this.yy = yy || this.yy || {};\n        this._input = input;\n        this._more = this._backtrack = this.done = false;\n        this.yylineno = this.yyleng = 0;\n        this.yytext = this.matched = this.match = '';\n        this.conditionStack = ['INITIAL'];\n        this.yylloc = {\n            first_line: 1,\n            first_column: 0,\n            last_line: 1,\n            last_column: 0\n        };\n        if (this.options.ranges) {\n            this.yylloc.range = [0,0];\n        }\n        this.offset = 0;\n        return this;\n    },\n\n// consumes and returns one char from the input\ninput:function () {\n        var ch = this._input[0];\n        this.yytext += ch;\n        this.yyleng++;\n        this.offset++;\n        this.match += ch;\n        this.matched += ch;\n        var lines = ch.match(/(?:\\r\\n?|\\n).*/g);\n        if (lines) {\n            this.yylineno++;\n            this.yylloc.last_line++;\n        } else {\n            this.yylloc.last_column++;\n        }\n        if (this.options.ranges) {\n            this.yylloc.range[1]++;\n        }\n\n        this._input = this._input.slice(1);\n        return ch;\n    },\n\n// unshifts one char (or a string) into the input\nunput:function (ch) {\n        var len = ch.length;\n        var lines = ch.split(/(?:\\r\\n?|\\n)/g);\n\n        this._input = ch + this._input;\n        this.yytext = this.yytext.substr(0, this.yytext.length - len);\n        //this.yyleng -= len;\n        this.offset -= len;\n        var oldLines = this.match.split(/(?:\\r\\n?|\\n)/g);\n        this.match = this.match.substr(0, this.match.length - 1);\n        this.matched = this.matched.substr(0, this.matched.length - 1);\n\n        if (lines.length - 1) {\n            this.yylineno -= lines.length - 1;\n        }\n        var r = this.yylloc.range;\n\n        this.yylloc = {\n            first_line: this.yylloc.first_line,\n            last_line: this.yylineno + 1,\n            first_column: this.yylloc.first_column,\n            last_column: lines ?\n                (lines.length === oldLines.length ? this.yylloc.first_column : 0)\n                 + oldLines[oldLines.length - lines.length].length - lines[0].length :\n              this.yylloc.first_column - len\n        };\n\n        if (this.options.ranges) {\n            this.yylloc.range = [r[0], r[0] + this.yyleng - len];\n        }\n        this.yyleng = this.yytext.length;\n        return this;\n    },\n\n// When called from action, caches matched text and appends it on next action\nmore:function () {\n        this._more = true;\n        return this;\n    },\n\n// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.\nreject:function () {\n        if (this.options.backtrack_lexer) {\n            this._backtrack = true;\n        } else {\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\n' + this.showPosition(), {\n                text: \"\",\n                token: null,\n                line: this.yylineno\n            });\n\n        }\n        return this;\n    },\n\n// retain first n characters of the match\nless:function (n) {\n        this.unput(this.match.slice(n));\n    },\n\n// displays already matched input, i.e. for error messages\npastInput:function () {\n        var past = this.matched.substr(0, this.matched.length - this.match.length);\n        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\\n/g, \"\");\n    },\n\n// displays upcoming input, i.e. for error messages\nupcomingInput:function () {\n        var next = this.match;\n        if (next.length < 20) {\n            next += this._input.substr(0, 20-next.length);\n        }\n        return (next.substr(0,20) + (next.length > 20 ? '...' : '')).replace(/\\n/g, \"\");\n    },\n\n// displays the character position where the lexing error occurred, i.e. for error messages\nshowPosition:function () {\n        var pre = this.pastInput();\n        var c = new Array(pre.length + 1).join(\"-\");\n        return pre + this.upcomingInput() + \"\\n\" + c + \"^\";\n    },\n\n// test the lexed token: return FALSE when not a match, otherwise return token\ntest_match:function (match, indexed_rule) {\n        var token,\n            lines,\n            backup;\n\n        if (this.options.backtrack_lexer) {\n            // save context\n            backup = {\n                yylineno: this.yylineno,\n                yylloc: {\n                    first_line: this.yylloc.first_line,\n                    last_line: this.last_line,\n                    first_column: this.yylloc.first_column,\n                    last_column: this.yylloc.last_column\n                },\n                yytext: this.yytext,\n                match: this.match,\n                matches: this.matches,\n                matched: this.matched,\n                yyleng: this.yyleng,\n                offset: this.offset,\n                _more: this._more,\n                _input: this._input,\n                yy: this.yy,\n                conditionStack: this.conditionStack.slice(0),\n                done: this.done\n            };\n            if (this.options.ranges) {\n                backup.yylloc.range = this.yylloc.range.slice(0);\n            }\n        }\n\n        lines = match[0].match(/(?:\\r\\n?|\\n).*/g);\n        if (lines) {\n            this.yylineno += lines.length;\n        }\n        this.yylloc = {\n            first_line: this.yylloc.last_line,\n            last_line: this.yylineno + 1,\n            first_column: this.yylloc.last_column,\n            last_column: lines ?\n                         lines[lines.length - 1].length - lines[lines.length - 1].match(/\\r?\\n?/)[0].length :\n                         this.yylloc.last_column + match[0].length\n        };\n        this.yytext += match[0];\n        this.match += match[0];\n        this.matches = match;\n        this.yyleng = this.yytext.length;\n        if (this.options.ranges) {\n            this.yylloc.range = [this.offset, this.offset += this.yyleng];\n        }\n        this._more = false;\n        this._backtrack = false;\n        this._input = this._input.slice(match[0].length);\n        this.matched += match[0];\n        token = this.performAction.call(this, this.yy, this, indexed_rule, this.conditionStack[this.conditionStack.length - 1]);\n        if (this.done && this._input) {\n            this.done = false;\n        }\n        if (token) {\n            return token;\n        } else if (this._backtrack) {\n            // recover context\n            for (var k in backup) {\n                this[k] = backup[k];\n            }\n            return false; // rule action called reject() implying the next rule should be tested instead.\n        }\n        return false;\n    },\n\n// return next match in input\nnext:function () {\n        if (this.done) {\n            return this.EOF;\n        }\n        if (!this._input) {\n            this.done = true;\n        }\n\n        var token,\n            match,\n            tempMatch,\n            index;\n        if (!this._more) {\n            this.yytext = '';\n            this.match = '';\n        }\n        var rules = this._currentRules();\n        for (var i = 0; i < rules.length; i++) {\n            tempMatch = this._input.match(this.rules[rules[i]]);\n            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {\n                match = tempMatch;\n                index = i;\n                if (this.options.backtrack_lexer) {\n                    token = this.test_match(tempMatch, rules[i]);\n                    if (token !== false) {\n                        return token;\n                    } else if (this._backtrack) {\n                        match = false;\n                        continue; // rule action called reject() implying a rule MISmatch.\n                    } else {\n                        // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\n                        return false;\n                    }\n                } else if (!this.options.flex) {\n                    break;\n                }\n            }\n        }\n        if (match) {\n            token = this.test_match(match, rules[index]);\n            if (token !== false) {\n                return token;\n            }\n            // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\n            return false;\n        }\n        if (this._input === \"\") {\n            return this.EOF;\n        } else {\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\\n' + this.showPosition(), {\n                text: \"\",\n                token: null,\n                line: this.yylineno\n            });\n        }\n    },\n\n// return next match that has a token\nlex:function lex() {\n        var r = this.next();\n        if (r) {\n            return r;\n        } else {\n            return this.lex();\n        }\n    },\n\n// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)\nbegin:function begin(condition) {\n        this.conditionStack.push(condition);\n    },\n\n// pop the previously active lexer condition state off the condition stack\npopState:function popState() {\n        var n = this.conditionStack.length - 1;\n        if (n > 0) {\n            return this.conditionStack.pop();\n        } else {\n            return this.conditionStack[0];\n        }\n    },\n\n// produce the lexer rule set which is active for the currently active lexer condition state\n_currentRules:function _currentRules() {\n        if (this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1]) {\n            return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;\n        } else {\n            return this.conditions[\"INITIAL\"].rules;\n        }\n    },\n\n// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available\ntopState:function topState(n) {\n        n = this.conditionStack.length - 1 - Math.abs(n || 0);\n        if (n >= 0) {\n            return this.conditionStack[n];\n        } else {\n            return \"INITIAL\";\n        }\n    },\n\n// alias for begin(condition)\npushState:function pushState(condition) {\n        this.begin(condition);\n    },\n\n// return the number of states currently on the stack\nstateStackSize:function stateStackSize() {\n        return this.conditionStack.length;\n    },\noptions: {\"flex\":true},\nperformAction: function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {\nvar YYSTATE=YY_START;\nswitch($avoiding_name_collisions) {\ncase 0:/* skip whitespace */\nbreak;\ncase 1:/* skip \\space */\nbreak;\ncase 2:/* skip '\\ ' */\nbreak;\ncase 3:return \"INT\"\nbreak;\ncase 4:return \"FLOAT\"\nbreak;\ncase 5:return \"^\"\nbreak;\ncase 6:return \"*\"\nbreak;\ncase 7:return \"*\"\nbreak;\ncase 8:return \"*\"\nbreak;\ncase 9:return \"*\"\nbreak;\ncase 10:return \"/\"\nbreak;\ncase 11:return \"/\"\nbreak;\ncase 12:return \"-\"\nbreak;\ncase 13:return \"-\"\nbreak;\ncase 14:return \"+\"\nbreak;\ncase 15:return \"^\"\nbreak;\ncase 16:return \"(\"\nbreak;\ncase 17:return \")\"\nbreak;\ncase 18:return \"(\"\nbreak;\ncase 19:return \")\"\nbreak;\ncase 20:return \"[\"\nbreak;\ncase 21:return \"]\"\nbreak;\ncase 22:return \"{\"\nbreak;\ncase 23:return \"}\"\nbreak;\ncase 24:return \"{\"\nbreak;\ncase 25:return \"}\"\nbreak;\ncase 26:return \"_\"\nbreak;\ncase 27:return \"|\"\nbreak;\ncase 28:return \"LEFT|\"\nbreak;\ncase 29:return \"RIGHT|\"\nbreak;\ncase 30:return \"!\"\nbreak;\ncase 31:return \"SIGN\"\nbreak;\ncase 32:yy_.yytext = \"<=\"; return \"SIGN\"\nbreak;\ncase 33:yy_.yytext = \">=\"; return \"SIGN\"\nbreak;\ncase 34:yy_.yytext = \"<=\"; return \"SIGN\"\nbreak;\ncase 35:yy_.yytext = \">=\"; return \"SIGN\"\nbreak;\ncase 36:yy_.yytext = \"<>\"; return \"SIGN\"\nbreak;\ncase 37:yy_.yytext = \"<>\"; return \"SIGN\"\nbreak;\ncase 38:yy_.yytext = \"<>\"; return \"SIGN\"\nbreak;\ncase 39:yy_.yytext = \"<>\"; return \"SIGN\"\nbreak;\ncase 40:yy_.yytext = \"<=\"; return \"SIGN\"\nbreak;\ncase 41:yy_.yytext = \">=\"; return \"SIGN\"\nbreak;\ncase 42:return \"FRAC\"\nbreak;\ncase 43:return \"FRAC\"\nbreak;\ncase 44:return \"sqrt\"\nbreak;\ncase 45:return \"abs\"\nbreak;\ncase 46:return \"ln\"\nbreak;\ncase 47:return \"log\"\nbreak;\ncase 48:return \"TRIG\"\nbreak;\ncase 49:return \"TRIG\"\nbreak;\ncase 50:return \"TRIG\"\nbreak;\ncase 51:return \"TRIG\"\nbreak;\ncase 52:yy_.yytext = \"sin\"; return \"TRIG\"\nbreak;\ncase 53:yy_.yytext = \"cos\"; return \"TRIG\"\nbreak;\ncase 54:yy_.yytext = \"tan\"; return \"TRIG\"\nbreak;\ncase 55:yy_.yytext = \"csc\"; return \"TRIG\"\nbreak;\ncase 56:yy_.yytext = \"sec\"; return \"TRIG\"\nbreak;\ncase 57:yy_.yytext = \"cot\"; return \"TRIG\"\nbreak;\ncase 58:yy_.yytext = \"arcsin\"; return \"TRIG\"\nbreak;\ncase 59:yy_.yytext = \"arccos\"; return \"TRIG\"\nbreak;\ncase 60:yy_.yytext = \"arctan\"; return \"TRIG\"\nbreak;\ncase 61:yy_.yytext = \"arccsc\"; return \"TRIG\"\nbreak;\ncase 62:yy_.yytext = \"arcsec\"; return \"TRIG\"\nbreak;\ncase 63:yy_.yytext = \"arccot\"; return \"TRIG\"\nbreak;\ncase 64:return \"TRIGINV\"\nbreak;\ncase 65:return \"TRIGINV\"\nbreak;\ncase 66:yy_.yytext = \"sinh\"; return \"TRIG\"\nbreak;\ncase 67:yy_.yytext = \"cosh\"; return \"TRIG\"\nbreak;\ncase 68:yy_.yytext = \"tanh\"; return \"TRIG\"\nbreak;\ncase 69:yy_.yytext = \"csch\"; return \"TRIG\"\nbreak;\ncase 70:yy_.yytext = \"sech\"; return \"TRIG\"\nbreak;\ncase 71:yy_.yytext = \"tanh\"; return \"TRIG\"\nbreak;\ncase 72:return \"CONST\"\nbreak;\ncase 73:yy_.yytext = \"pi\"; return \"CONST\"\nbreak;\ncase 74:yy_.yytext = \"pi\"; return \"CONST\"\nbreak;\ncase 75:return \"VAR\"\nbreak;\ncase 76:yy_.yytext = \"theta\"; return \"VAR\"\nbreak;\ncase 77:yy_.yytext = \"theta\"; return \"VAR\"\nbreak;\ncase 78:return \"VAR\"\nbreak;\ncase 79:yy_.yytext = \"phi\"; return \"VAR\"\nbreak;\ncase 80:yy_.yytext = \"phi\"; return \"VAR\"\nbreak;\ncase 81:return yy.symbolLexer(yy_.yytext)\nbreak;\ncase 82:return \"EOF\"\nbreak;\ncase 83:return \"INVALID\"\nbreak;\ncase 84:console.log(yy_.yytext);\nbreak;\n}\n},\nrules: [/^(?:\\s+)/,/^(?:\\\\space)/,/^(?:\\\\ )/,/^(?:[0-9]+\\.?)/,/^(?:([0-9]+)?\\.[0-9]+)/,/^(?:\\*\\*)/,/^(?:\\*)/,/^(?:\\\\cdot|)/,/^(?:\\\\times|)/,/^(?:\\\\ast)/,/^(?:\\/)/,/^(?:\\\\div|)/,/^(?:-)/,/^(?:)/,/^(?:\\+)/,/^(?:\\^)/,/^(?:\\()/,/^(?:\\))/,/^(?:\\\\left\\()/,/^(?:\\\\right\\))/,/^(?:\\[)/,/^(?:\\])/,/^(?:\\{)/,/^(?:\\})/,/^(?:\\\\left\\{)/,/^(?:\\\\right\\})/,/^(?:_)/,/^(?:\\|)/,/^(?:\\\\left\\|)/,/^(?:\\\\right\\|)/,/^(?:\\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\\\le)/,/^(?:\\\\ge)/,/^(?:\\\\leq)/,/^(?:\\\\geq)/,/^(?:=\\/=)/,/^(?:\\\\ne)/,/^(?:\\\\neq)/,/^(?:)/,/^(?:)/,/^(?:)/,/^(?:\\\\frac)/,/^(?:\\\\dfrac)/,/^(?:sqrt|\\\\sqrt)/,/^(?:abs|\\\\abs)/,/^(?:ln|\\\\ln)/,/^(?:log|\\\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\\\sin)/,/^(?:\\\\cos)/,/^(?:\\\\tan)/,/^(?:\\\\csc)/,/^(?:\\\\sec)/,/^(?:\\\\cot)/,/^(?:\\\\arcsin)/,/^(?:\\\\arccos)/,/^(?:\\\\arctan)/,/^(?:\\\\arccsc)/,/^(?:\\\\arcsec)/,/^(?:\\\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\\\sinh)/,/^(?:\\\\cosh)/,/^(?:\\\\tanh)/,/^(?:\\\\csch)/,/^(?:\\\\sech)/,/^(?:\\\\coth)/,/^(?:pi)/,/^(?:)/,/^(?:\\\\pi)/,/^(?:theta)/,/^(?:)/,/^(?:\\\\theta)/,/^(?:phi)/,/^(?:)/,/^(?:\\\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],\nconditions: {\"INITIAL\":{\"rules\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],\"inclusive\":true}}\n});\nreturn lexer;\n})();\nparser.lexer = lexer;\nfunction Parser () {\n  this.yy = {};\n}\nParser.prototype = parser;parser.Parser = Parser;\nreturn new Parser;\n})();\n\nKAS.parser = parser;\n})(KAS);\n// this is a @generated file\n(function(KAS) {\n\n/* parser generated by jison 0.4.15 */\n/*\n  Returns a Parser object of the following structure:\n\n  Parser: {\n    yy: {}\n  }\n\n  Parser.prototype: {\n    yy: {},\n    trace: function(),\n    symbols_: {associative list: name ==> number},\n    terminals_: {associative list: number ==> name},\n    productions_: [...],\n    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$),\n    table: [...],\n    defaultActions: {...},\n    parseError: function(str, hash),\n    parse: function(input),\n\n    lexer: {\n        EOF: 1,\n        parseError: function(str, hash),\n        setInput: function(input),\n        input: function(),\n        unput: function(str),\n        more: function(),\n        less: function(n),\n        pastInput: function(),\n        upcomingInput: function(),\n        showPosition: function(),\n        test_match: function(regex_match_array, rule_index),\n        next: function(),\n        lex: function(),\n        begin: function(condition),\n        popState: function(),\n        _currentRules: function(),\n        topState: function(),\n        pushState: function(condition),\n\n        options: {\n            ranges: boolean           (optional: true ==> token location info will include a .range[] member)\n            flex: boolean             (optional: true ==> flex-like lexing behaviour where the rules are tested exhaustively to find the longest match)\n            backtrack_lexer: boolean  (optional: true ==> lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code)\n        },\n\n        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START),\n        rules: [...],\n        conditions: {associative list: name ==> set},\n    }\n  }\n\n\n  token location info (@$, _$, etc.): {\n    first_line: n,\n    last_line: n,\n    first_column: n,\n    last_column: n,\n    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based)\n  }\n\n\n  the parseError function receives a 'hash' object with these members for lexer and parser errors: {\n    text:        (matched text)\n    token:       (the produced terminal token, if any)\n    line:        (yylineno)\n  }\n  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: {\n    loc:         (yylloc)\n    expected:    (string describing the set of expected tokens)\n    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error)\n  }\n*/\nvar parser = (function(){\nvar o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,11],$V1=[1,9],$V2=[8,17],$V3=[6,11],$V4=[6,11,13,17];\nvar parser = {trace: function trace() { },\nyy: {},\nsymbols_: {\"error\":2,\"unitvalue\":3,\"magnitude\":4,\"unit\":5,\"EOF\":6,\"float\":7,\"POW\":8,\"int\":9,\"multatoms\":10,\"DIV\":11,\"expatom\":12,\"MUL\":13,\"atom\":14,\"^\":15,\"nat\":16,\"ATOM\":17,\"FLOAT\":18,\"NAT\":19,\"NEG\":20,\"$accept\":0,\"$end\":1},\nterminals_: {2:\"error\",6:\"EOF\",8:\"POW\",11:\"DIV\",13:\"MUL\",15:\"^\",17:\"ATOM\",18:\"FLOAT\",19:\"NAT\",20:\"NEG\"},\nproductions_: [0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],\nperformAction: function anonymous(yytext, yyleng, yylineno, yy, yystate /* action[1] */, $$ /* vstack */, _$ /* lstack */) {\n/* this == yyval */\n\nvar $0 = $$.length - 1;\nswitch (yystate) {\ncase 1:\n\n            return {\n                type: \"unitMagnitude\",\n                magnitude: $$[$0-2],\n                unit: $$[$0-1],\n            };\n        \nbreak;\ncase 2:\n\n            return {\n                type: \"unitStandalone\",\n                unit: $$[$0-1],\n            }\n        \nbreak;\ncase 3:\n\n            this.$ = $$[$0-2] + \"e\" + $$[$0];\n        \nbreak;\ncase 4: case 13: case 14: case 15: case 17:\n this.$ = $$[$0]; \nbreak;\ncase 5:\n\n            this.$ = {\n                num: $$[$0-2],\n                denom: $$[$0],\n            };\n        \nbreak;\ncase 6:\n\n            this.$ = {\n                num: $$[$0],\n                denom: null,\n            };\n        \nbreak;\ncase 7:\n this.$ = [$$[$0-2]].concat($$[$0]); \nbreak;\ncase 8:\n this.$ = [$$[$0-1]].concat($$[$0]); \nbreak;\ncase 9:\n this.$ = [$$[$0]]; \nbreak;\ncase 10:\n\n            this.$ = {\n                name: $$[$0-2],\n                pow: $$[$0],\n            };\n        \nbreak;\ncase 11:\n\n            this.$ = {\n                name: $$[$0],\n                pow: 1,\n            };\n        \nbreak;\ncase 12:\n this.$ = yytext; \nbreak;\ncase 16:\n this.$ = \"-\" + $$[$0]; \nbreak;\n}\n},\ntable: [{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:$V0,18:[1,6],19:$V1},{1:[3]},{5:12,10:5,12:8,14:10,17:$V0},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},o($V2,[2,13]),o($V2,[2,14]),o($V3,[2,9],{12:8,14:10,10:17,13:[1,16],17:$V0}),o([6,8,11,13,17],[2,15]),o($V4,[2,11],{15:[1,18]}),o([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:$V0},{10:24,12:8,14:10,17:$V0},o($V3,[2,8]),{16:25,19:$V1},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},o($V3,[2,7]),o($V4,[2,10]),{17:[2,16]}],\ndefaultActions: {13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},\nparseError: function parseError(str, hash) {\n    if (hash.recoverable) {\n        this.trace(str);\n    } else {\n        throw new Error(str);\n    }\n},\nparse: function parse(input) {\n    var self = this, stack = [0], tstack = [], vstack = [null], lstack = [], table = this.table, yytext = '', yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;\n    var args = lstack.slice.call(arguments, 1);\n    var lexer = Object.create(this.lexer);\n    var sharedState = { yy: {} };\n    for (var k in this.yy) {\n        if (Object.prototype.hasOwnProperty.call(this.yy, k)) {\n            sharedState.yy[k] = this.yy[k];\n        }\n    }\n    lexer.setInput(input, sharedState.yy);\n    sharedState.yy.lexer = lexer;\n    sharedState.yy.parser = this;\n    if (typeof lexer.yylloc == 'undefined') {\n        lexer.yylloc = {};\n    }\n    var yyloc = lexer.yylloc;\n    lstack.push(yyloc);\n    var ranges = lexer.options && lexer.options.ranges;\n    if (typeof sharedState.yy.parseError === 'function') {\n        this.parseError = sharedState.yy.parseError;\n    } else {\n        this.parseError = Object.getPrototypeOf(this).parseError;\n    }\n    function popStack(n) {\n        stack.length = stack.length - 2 * n;\n        vstack.length = vstack.length - n;\n        lstack.length = lstack.length - n;\n    }\n        function lex() {\n            var token;\n            token = lexer.lex() || EOF;\n            if (typeof token !== 'number') {\n                token = self.symbols_[token] || token;\n            }\n            return token;\n        }\n    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;\n    while (true) {\n        state = stack[stack.length - 1];\n        if (this.defaultActions[state]) {\n            action = this.defaultActions[state];\n        } else {\n            if (symbol === null || typeof symbol == 'undefined') {\n                symbol = lex();\n            }\n            action = table[state] && table[state][symbol];\n        }\n                    if (typeof action === 'undefined' || !action.length || !action[0]) {\n                var errStr = '';\n                expected = [];\n                for (p in table[state]) {\n                    if (this.terminals_[p] && p > TERROR) {\n                        expected.push('\\'' + this.terminals_[p] + '\\'');\n                    }\n                }\n                if (lexer.showPosition) {\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ':\\n' + lexer.showPosition() + '\\nExpecting ' + expected.join(', ') + ', got \\'' + (this.terminals_[symbol] || symbol) + '\\'';\n                } else {\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ': Unexpected ' + (symbol == EOF ? 'end of input' : '\\'' + (this.terminals_[symbol] || symbol) + '\\'');\n                }\n                this.parseError(errStr, {\n                    text: lexer.match,\n                    token: this.terminals_[symbol] || symbol,\n                    line: lexer.yylineno,\n                    loc: yyloc,\n                    expected: expected\n                });\n            }\n        if (action[0] instanceof Array && action.length > 1) {\n            throw new Error('Parse Error: multiple actions possible at state: ' + state + ', token: ' + symbol);\n        }\n        switch (action[0]) {\n        case 1:\n            stack.push(symbol);\n            vstack.push(lexer.yytext);\n            lstack.push(lexer.yylloc);\n            stack.push(action[1]);\n            symbol = null;\n            if (!preErrorSymbol) {\n                yyleng = lexer.yyleng;\n                yytext = lexer.yytext;\n                yylineno = lexer.yylineno;\n                yyloc = lexer.yylloc;\n                if (recovering > 0) {\n                    recovering--;\n                }\n            } else {\n                symbol = preErrorSymbol;\n                preErrorSymbol = null;\n            }\n            break;\n        case 2:\n            len = this.productions_[action[1]][1];\n            yyval.$ = vstack[vstack.length - len];\n            yyval._$ = {\n                first_line: lstack[lstack.length - (len || 1)].first_line,\n                last_line: lstack[lstack.length - 1].last_line,\n                first_column: lstack[lstack.length - (len || 1)].first_column,\n                last_column: lstack[lstack.length - 1].last_column\n            };\n            if (ranges) {\n                yyval._$.range = [\n                    lstack[lstack.length - (len || 1)].range[0],\n                    lstack[lstack.length - 1].range[1]\n                ];\n            }\n            r = this.performAction.apply(yyval, [\n                yytext,\n                yyleng,\n                yylineno,\n                sharedState.yy,\n                action[1],\n                vstack,\n                lstack\n            ].concat(args));\n            if (typeof r !== 'undefined') {\n                return r;\n            }\n            if (len) {\n                stack = stack.slice(0, -1 * len * 2);\n                vstack = vstack.slice(0, -1 * len);\n                lstack = lstack.slice(0, -1 * len);\n            }\n            stack.push(this.productions_[action[1]][0]);\n            vstack.push(yyval.$);\n            lstack.push(yyval._$);\n            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];\n            stack.push(newState);\n            break;\n        case 3:\n            return true;\n        }\n    }\n    return true;\n}};\n/* generated by jison-lex 0.3.4 */\nvar lexer = (function(){\nvar lexer = ({\n\nEOF:1,\n\nparseError:function parseError(str, hash) {\n        if (this.yy.parser) {\n            this.yy.parser.parseError(str, hash);\n        } else {\n            throw new Error(str);\n        }\n    },\n\n// resets the lexer, sets new input\nsetInput:function (input, yy) {\n        this.yy = yy || this.yy || {};\n        this._input = input;\n        this._more = this._backtrack = this.done = false;\n        this.yylineno = this.yyleng = 0;\n        this.yytext = this.matched = this.match = '';\n        this.conditionStack = ['INITIAL'];\n        this.yylloc = {\n            first_line: 1,\n            first_column: 0,\n            last_line: 1,\n            last_column: 0\n        };\n        if (this.options.ranges) {\n            this.yylloc.range = [0,0];\n        }\n        this.offset = 0;\n        return this;\n    },\n\n// consumes and returns one char from the input\ninput:function () {\n        var ch = this._input[0];\n        this.yytext += ch;\n        this.yyleng++;\n        this.offset++;\n        this.match += ch;\n        this.matched += ch;\n        var lines = ch.match(/(?:\\r\\n?|\\n).*/g);\n        if (lines) {\n            this.yylineno++;\n            this.yylloc.last_line++;\n        } else {\n            this.yylloc.last_column++;\n        }\n        if (this.options.ranges) {\n            this.yylloc.range[1]++;\n        }\n\n        this._input = this._input.slice(1);\n        return ch;\n    },\n\n// unshifts one char (or a string) into the input\nunput:function (ch) {\n        var len = ch.length;\n        var lines = ch.split(/(?:\\r\\n?|\\n)/g);\n\n        this._input = ch + this._input;\n        this.yytext = this.yytext.substr(0, this.yytext.length - len);\n        //this.yyleng -= len;\n        this.offset -= len;\n        var oldLines = this.match.split(/(?:\\r\\n?|\\n)/g);\n        this.match = this.match.substr(0, this.match.length - 1);\n        this.matched = this.matched.substr(0, this.matched.length - 1);\n\n        if (lines.length - 1) {\n            this.yylineno -= lines.length - 1;\n        }\n        var r = this.yylloc.range;\n\n        this.yylloc = {\n            first_line: this.yylloc.first_line,\n            last_line: this.yylineno + 1,\n            first_column: this.yylloc.first_column,\n            last_column: lines ?\n                (lines.length === oldLines.length ? this.yylloc.first_column : 0)\n                 + oldLines[oldLines.length - lines.length].length - lines[0].length :\n              this.yylloc.first_column - len\n        };\n\n        if (this.options.ranges) {\n            this.yylloc.range = [r[0], r[0] + this.yyleng - len];\n        }\n        this.yyleng = this.yytext.length;\n        return this;\n    },\n\n// When called from action, caches matched text and appends it on next action\nmore:function () {\n        this._more = true;\n        return this;\n    },\n\n// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.\nreject:function () {\n        if (this.options.backtrack_lexer) {\n            this._backtrack = true;\n        } else {\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\n' + this.showPosition(), {\n                text: \"\",\n                token: null,\n                line: this.yylineno\n            });\n\n        }\n        return this;\n    },\n\n// retain first n characters of the match\nless:function (n) {\n        this.unput(this.match.slice(n));\n    },\n\n// displays already matched input, i.e. for error messages\npastInput:function () {\n        var past = this.matched.substr(0, this.matched.length - this.match.length);\n        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\\n/g, \"\");\n    },\n\n// displays upcoming input, i.e. for error messages\nupcomingInput:function () {\n        var next = this.match;\n        if (next.length < 20) {\n            next += this._input.substr(0, 20-next.length);\n        }\n        return (next.substr(0,20) + (next.length > 20 ? '...' : '')).replace(/\\n/g, \"\");\n    },\n\n// displays the character position where the lexing error occurred, i.e. for error messages\nshowPosition:function () {\n        var pre = this.pastInput();\n        var c = new Array(pre.length + 1).join(\"-\");\n        return pre + this.upcomingInput() + \"\\n\" + c + \"^\";\n    },\n\n// test the lexed token: return FALSE when not a match, otherwise return token\ntest_match:function (match, indexed_rule) {\n        var token,\n            lines,\n            backup;\n\n        if (this.options.backtrack_lexer) {\n            // save context\n            backup = {\n                yylineno: this.yylineno,\n                yylloc: {\n                    first_line: this.yylloc.first_line,\n                    last_line: this.last_line,\n                    first_column: this.yylloc.first_column,\n                    last_column: this.yylloc.last_column\n                },\n                yytext: this.yytext,\n                match: this.match,\n                matches: this.matches,\n                matched: this.matched,\n                yyleng: this.yyleng,\n                offset: this.offset,\n                _more: this._more,\n                _input: this._input,\n                yy: this.yy,\n                conditionStack: this.conditionStack.slice(0),\n                done: this.done\n            };\n            if (this.options.ranges) {\n                backup.yylloc.range = this.yylloc.range.slice(0);\n            }\n        }\n\n        lines = match[0].match(/(?:\\r\\n?|\\n).*/g);\n        if (lines) {\n            this.yylineno += lines.length;\n        }\n        this.yylloc = {\n            first_line: this.yylloc.last_line,\n            last_line: this.yylineno + 1,\n            first_column: this.yylloc.last_column,\n            last_column: lines ?\n                         lines[lines.length - 1].length - lines[lines.length - 1].match(/\\r?\\n?/)[0].length :\n                         this.yylloc.last_column + match[0].length\n        };\n        this.yytext += match[0];\n        this.match += match[0];\n        this.matches = match;\n        this.yyleng = this.yytext.length;\n        if (this.options.ranges) {\n            this.yylloc.range = [this.offset, this.offset += this.yyleng];\n        }\n        this._more = false;\n        this._backtrack = false;\n        this._input = this._input.slice(match[0].length);\n        this.matched += match[0];\n        token = this.performAction.call(this, this.yy, this, indexed_rule, this.conditionStack[this.conditionStack.length - 1]);\n        if (this.done && this._input) {\n            this.done = false;\n        }\n        if (token) {\n            return token;\n        } else if (this._backtrack) {\n            // recover context\n            for (var k in backup) {\n                this[k] = backup[k];\n            }\n            return false; // rule action called reject() implying the next rule should be tested instead.\n        }\n        return false;\n    },\n\n// return next match in input\nnext:function () {\n        if (this.done) {\n            return this.EOF;\n        }\n        if (!this._input) {\n            this.done = true;\n        }\n\n        var token,\n            match,\n            tempMatch,\n            index;\n        if (!this._more) {\n            this.yytext = '';\n            this.match = '';\n        }\n        var rules = this._currentRules();\n        for (var i = 0; i < rules.length; i++) {\n            tempMatch = this._input.match(this.rules[rules[i]]);\n            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {\n                match = tempMatch;\n                index = i;\n                if (this.options.backtrack_lexer) {\n                    token = this.test_match(tempMatch, rules[i]);\n                    if (token !== false) {\n                        return token;\n                    } else if (this._backtrack) {\n                        match = false;\n                        continue; // rule action called reject() implying a rule MISmatch.\n                    } else {\n                        // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\n                        return false;\n                    }\n                } else if (!this.options.flex) {\n                    break;\n                }\n            }\n        }\n        if (match) {\n            token = this.test_match(match, rules[index]);\n            if (token !== false) {\n                return token;\n            }\n            // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\n            return false;\n        }\n        if (this._input === \"\") {\n            return this.EOF;\n        } else {\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\\n' + this.showPosition(), {\n                text: \"\",\n                token: null,\n                line: this.yylineno\n            });\n        }\n    },\n\n// return next match that has a token\nlex:function lex() {\n        var r = this.next();\n        if (r) {\n            return r;\n        } else {\n            return this.lex();\n        }\n    },\n\n// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)\nbegin:function begin(condition) {\n        this.conditionStack.push(condition);\n    },\n\n// pop the previously active lexer condition state off the condition stack\npopState:function popState() {\n        var n = this.conditionStack.length - 1;\n        if (n > 0) {\n            return this.conditionStack.pop();\n        } else {\n            return this.conditionStack[0];\n        }\n    },\n\n// produce the lexer rule set which is active for the currently active lexer condition state\n_currentRules:function _currentRules() {\n        if (this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1]) {\n            return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;\n        } else {\n            return this.conditions[\"INITIAL\"].rules;\n        }\n    },\n\n// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available\ntopState:function topState(n) {\n        n = this.conditionStack.length - 1 - Math.abs(n || 0);\n        if (n >= 0) {\n            return this.conditionStack[n];\n        } else {\n            return \"INITIAL\";\n        }\n    },\n\n// alias for begin(condition)\npushState:function pushState(condition) {\n        this.begin(condition);\n    },\n\n// return the number of states currently on the stack\nstateStackSize:function stateStackSize() {\n        return this.conditionStack.length;\n    },\noptions: {},\nperformAction: function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {\nvar YYSTATE=YY_START;\nswitch($avoiding_name_collisions) {\ncase 0:return 11;\nbreak;\ncase 1:return '(';\nbreak;\ncase 2:return ')';\nbreak;\ncase 3:return 8;\nbreak;\ncase 4:return 15;\nbreak;\ncase 5:return 13;\nbreak;\ncase 6:return 18;\nbreak;\ncase 7:return 19;\nbreak;\ncase 8:return 20;\nbreak;\ncase 9:return 17;\nbreak;\ncase 10:return 17;\nbreak;\ncase 11:return 17;\nbreak;\ncase 12:/* skip whitespace */\nbreak;\ncase 13:return 6;\nbreak;\n}\n},\nrules: [/^(?:\\/)/,/^(?:\\()/,/^(?:\\))/,/^(?:(\\*|x|\\u00d7|\\u2219|\\u22c5|\\u00b7)\\s*10\\s*\\^)/,/^(?:\\^)/,/^(?:\\*)/,/^(?:[0-9]+\\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\\u00b0( ?)[cCfF])/,/^(?:fl\\.? oz\\.?)/,/^(?:[\\u00b5]?([A-Za-z-]+|[\\u2103\\u2109\\u212b]))/,/^(?:\\s+)/,/^(?:$)/],\nconditions: {\"INITIAL\":{\"rules\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13],\"inclusive\":true}}\n});\nreturn lexer;\n})();\nparser.lexer = lexer;\nfunction Parser () {\n  this.yy = {};\n}\nParser.prototype = parser;parser.Parser = Parser;\nreturn new Parser;\n})();\n\nKAS.unitParser = parser;\n})(KAS);\n/* TODO(charlie): fix these lint errors (http://eslint.org/docs/rules): */\n/* eslint-disable indent, no-undef, no-var, one-var, no-dupe-keys, no-new-func, no-redeclare, no-unused-vars, comma-dangle, max-len, prefer-spread, space-infix-ops, space-unary-ops */\n\n(function(KAS) {\n\n/*  The node hierarcy is as follows:\n\n    (Expr)\n        (Seq)           2+ children\n            Add\n            Mul\n        Pow             2 children\n        Log             2 children\n        Eq              2 children\n        Trig            1 child\n        Abs             1 child\n        (Symbol)\n            Func        1 child     e.g. f(x)\n            Var         leaf node   e.g. x, x_n\n            Const       leaf node   e.g. pi, e, <i>\n            Unit        leaf node   e.g. kg\n        (Num)           leaf node\n            Rational                e.g. 2/3\n                Int\n            Float\n\n    (abstract, not meant to be instantiated)\n\n    == Key design concepts ==\n    Functional: All methods return new nodes - nodes are never mutated.\n    Ignore commutativity: Commutative inputs should be parsed equivalently.\n    Exploit commutativity: Output should take advantage of ordering.\n*/\n\n/* non user-facing functions */\n\n// assert that all abstract methods have been overridden\nvar abstract = function() {\n    // Try to give people a bit of information when this happens\n    throw new Error(\"Abstract method - must override for expr: \" +\n            this.print());\n};\n\n// throw an error that is meant to be caught by the test suite (not user facing)\nvar error = function(message) { throw new Error(message); };\n\n// reliably detect NaN\nvar isNaN = function(object) { return object !== object; };\n\n// return a random float between min (inclusive) and max (exclusive),\n// not that inclusivity means much, probabilistically, on floats\nvar randomFloat = function(min, max) {\n    var extent = max - min;\n    return Math.random() * extent + min;\n};\n\n/* constants */\nvar ITERATIONS = 12;\nvar TOLERANCE = 9; // decimal places\n\n\n/* abstract base expression node */\nfunction Expr() {}\n\n_.extend(Expr.prototype, {\n\n    // this node's immediate constructor\n    func: abstract,\n\n    // an array of the arguments to this node's immediate constructor\n    args: abstract,\n\n    // make a new node with the given arguments\n    construct: function(args) {\n        var instance = new this.func();\n        this.func.apply(instance, args);\n        return instance;\n    },\n\n    // an abstraction for chainable, bottom-up recursion\n    recurse: function(method) {\n        var passed = Array.prototype.slice.call(arguments, 1);\n        var args = _.map(this.args(), function(arg) {\n            return _.isString(arg) ? arg : arg[method].apply(arg, passed);\n        });\n        return this.construct(args);\n    },\n\n    // evaluate numerically with given variable mapping\n    eval: abstract,\n\n    codegen: abstract,\n\n    compile: function() {\n        var code = this.codegen();\n        try {\n            return new Function(\"vars\", \"return \" + code + \";\");\n        } catch (e) {\n            throw new Error(\"Function did not compile: \" + code);\n        }\n    },\n\n    // returns a string unambiguously representing the expression\n    // should be valid as input\n    // e.g. this.equals(parse(this.print())) === true\n    print: abstract,\n\n    // returns a TeX string representing the expression\n    tex: abstract,\n\n    // returns a TeX string, modified by the given options\n    asTex: function(options) {\n\n        options = options || {};\n        _.defaults(options, {\n            display: true,\n            dynamic: true,\n            times: false\n        });\n\n        var tex = this.tex();\n\n        if (options.display) {\n            tex = \"\\\\displaystyle \" + tex;\n        }\n        if (options.dynamic) {\n            tex = tex.replace(/\\(/g, \"\\\\left(\");\n            tex = tex.replace(/\\)/g, \"\\\\right)\");\n        }\n        if (options.times) {\n            tex = tex.replace(/\\\\cdot/g, \"\\\\times\");\n        }\n\n        return tex;\n    },\n\n    // returns the name of this expression's constructor as a string\n    // only used for testing and debugging (the ugly regex is for IE8)\n    name: function() {\n        if (this.func.name) {\n            return this.func.name;\n        } else {\n            return this.func.toString().match(/^function\\s*([^\\s(]+)/)[1];\n        }\n    },\n\n    // returns a string representing current node structure\n    repr: function() {\n        return this.name() + \"(\" + _.map(this.args(), function(arg) {\n            return _.isString(arg) ? arg : arg.repr();\n        }).join(\",\") + \")\";\n    },\n\n    // removes all negative signs\n    strip: function() { return this.recurse(\"strip\"); },\n\n    // canonically reorders all commutative elements\n    normalize: function() { return this.recurse(\"normalize\"); },\n\n    // expands the expression\n    expand: function() { return this.recurse(\"expand\"); },\n\n    // naively factors out like terms\n    factor: function(options) { return this.recurse(\"factor\", options); },\n\n    // collect all like terms\n    collect: function(options) { return this.recurse(\"collect\", options); },\n\n    // strict syntactic equality check\n    equals: function(other) {\n        return this.normalize().print() === other.normalize().print();\n    },\n\n    // expand and collect until the expression no longer changes\n    simplify: function(options) {\n        options = _.extend({\n            once: false\n        }, options);\n\n        // Attempt to factor and collect\n        var step1 = this.factor(options);\n        var step2 = step1.collect(options);\n\n        // Rollback if collect didn't do anything\n        if (step1.equals(step2)) {\n            step2 = this.collect(options);\n        }\n\n        // Attempt to expand and collect\n        var step3 = step2.expand(options);\n        var step4 = step3.collect(options);\n\n        // Rollback if collect didn't do anything\n        if (step3.equals(step4)) {\n            step4 = step2.collect(options);\n        }\n\n        // One round of simplification complete\n        var simplified = step4;\n\n        if (options.once || this.equals(simplified)) {\n            return simplified;\n        } else {\n            return simplified.simplify(options);\n        }\n    },\n\n    // check whether this expression is simplified\n    isSimplified: function() {\n        return this.equals(this.simplify());\n    },\n\n    // return the child nodes of this node\n    exprArgs: function() {\n        return _.filter(this.args(), function(arg) {\n            return arg instanceof Expr;\n        });\n    },\n\n    // return the variables (function and non) within the expression\n    getVars: function(excludeFunc) {\n        return _.uniq(_.flatten(_.invoke(this.exprArgs(), \"getVars\", excludeFunc))).sort();\n    },\n\n    getConsts: function() {\n        return _.uniq(_.flatten(_.invoke(this.exprArgs(), \"getConsts\"))).sort();\n    },\n\n    getUnits: function() {\n        return _.flatten(_.invoke(this.exprArgs(), \"getUnits\"));\n    },\n\n    // check whether this expression node is of a particular type\n    is: function(func) {\n        return this instanceof func;\n    },\n\n    // check whether this expression has a particular node type\n    has: function(func) {\n        if (this instanceof func) {\n            return true;\n        }\n        return _.any(this.exprArgs(), function(arg) { return arg.has(func); });\n    },\n\n    // raise this expression to a given exponent\n    // most useful for eventually implementing i^3 = -i, etc.\n    raiseToThe: function(exp) {\n        return new Pow(this, exp);\n    },\n\n    // does this expression have a specific rendering hint?\n    // rendering hints are picked up while parsing, but are lost during transformations\n    isSubtract: function() { return false; },\n    isDivide:  function() { return false; },\n    isRoot:  function() { return false; },\n\n    // whether this node needs an explicit multiplication sign if following a Num\n    needsExplicitMul: function() {\n        return this.args()[0].needsExplicitMul();\n    },\n\n    // check that the variables in both expressions are the same\n    sameVars: function(other) {\n        var vars1 = this.getVars();\n        var vars2 = other.getVars();\n\n        // the other Expr can have more variables than this one\n        // this lets you multiply equations by other variables\n        var same = function(array1, array2) {\n            return !_.difference(array1, array2).length;\n        };\n\n        var lower = function(array) {\n            return _.uniq(_.invoke(array, \"toLowerCase\")).sort();\n        };\n\n        var equal = same(vars1, vars2);\n        var equalIgnoringCase = same(lower(vars1), lower(vars2));\n\n        return {equal: equal, equalIgnoringCase: equalIgnoringCase};\n    },\n\n    // semantic equality check, call after sameVars() to avoid potential false positives\n    // plug in random numbers for the variables in both expressions\n    // if they both consistently evaluate the same, then they're the same\n    compare: function(other) {\n        // equation comparisons are handled by Eq.compare()\n        if (other instanceof Eq) {\n            return false;\n        }\n\n        var varList = _.union(\n            this.getVars(/* excludeFunc */ true),\n            other.getVars(/* excludeFunc */ true));\n\n        // If the numbers are large we would like to do a relative comparison\n        // rather than an absolute one, but if they're small enough then an\n        // absolute comparison makes more sense\n        var getDelta = function(num1, num2) {\n            if (Math.abs(num1) < 1 || Math.abs(num2) < 1) {\n                return Math.abs(num1 - num2);\n            } else {\n                return Math.abs(1 - num1 / num2);\n            }\n        };\n\n        var equalNumbers = function(num1, num2) {\n            var delta = getDelta(num1, num2);\n            return ((num1 === num2) || /* needed if either is +/- Infinity */\n                    (isNaN(num1) && isNaN(num2)) ||\n                    (delta < Math.pow(10, -TOLERANCE)));\n        };\n\n        // if no variables, only need to evaluate once\n        if (!varList.length && !this.has(Unit) && !other.has(Unit)) {\n            return equalNumbers(this.eval(), other.eval());\n        }\n\n        // collect here to avoid sometimes dividing by zero, and sometimes not\n        // it is better to be deterministic, e.g. x/x -> 1\n        // TODO(alex): may want to keep track of assumptions as they're made\n        var expr1 = this.collect();\n        var expr2 = other.collect();\n\n        var unitList1 = this.getUnits();\n        var unitList2 = other.getUnits();\n        if (!_.isEqual(unitList1, unitList2)) {\n            return false;\n        }\n\n        // Compare at a set number (currently 12) of points to determine\n        // equality.\n        //\n        // `range` (and `vars`) is the only variable that varies through the\n        // iterations. For each of range = 10, 100, and 1000, each random\n        // variable is picked from (-range, range).\n        //\n        // Note that because there are 12 iterations and three ranges, each\n        // range is checked four times.\n        for (var i = 0; i < ITERATIONS; i++) {\n\n            var vars = {};\n\n            // One third total iterations each with range 10, 100, and 1000\n            var range = Math.pow(10, 1 + Math.floor(3 * i / ITERATIONS));\n\n            // Half of the iterations should only use integer values.\n            // This is because expressions like (-2)^x are common but result\n            // in NaN when evaluated in JS with non-integer values of x.\n            // Without this, (-2)^x and (-2)^(x+1) both end up always being NaN\n            // and thus equivalent. With this, the most common failure case is\n            // avoided. However, less common cases such as (-2)^(x+0.1) and\n            // (-2)^(x+1.1) will still both evaluate to NaN and result in a\n            // false positive.\n            //\n            // Note that the above is only true in vanilla JS Number-land,\n            // which has no concept of complex numbers. The solution is simple:\n            // Integrate a library for handling complex numbers.\n            //\n            // TODO(alex): Add support for complex numbers, then remove this.\n            var useFloats = i % 2 === 0;\n\n            _.each(varList, function(v) {\n                vars[v] = useFloats ? randomFloat(-range, range)\n                                    : _.random(-range, range);\n            });\n\n            var equal;\n            if (expr1.has(Func) || expr2.has(Func) ||\n                    expr1.has(Unit) || expr2.has(Unit)) {\n\n                var result1 = expr1.partialEval(vars);\n                var result2 = expr2.partialEval(vars);\n\n                equal = result1.simplify().equals(result2.simplify());\n            } else {\n                var result1 = expr1.eval(vars);\n                var result2 = expr2.eval(vars);\n\n                equal = equalNumbers(result1, result2);\n            }\n\n            if (!equal) {\n                return false;\n            }\n        }\n\n        return true;\n    },\n\n    // evaluate as much of the expression as possible\n    partialEval: function(vars) {\n        if (this instanceof Unit) {\n            return this;\n        } else if (!this.has(Func)) {\n            return new Float(this.eval(vars).toFixed(TOLERANCE)).collect();\n        } else if (this instanceof Func) {\n            return new Func(this.symbol, this.arg.partialEval(vars));\n        } else {\n            return this.recurse(\"partialEval\", vars);\n        }\n    },\n\n    // check that the structure of both expressions is the same\n    // all negative signs are stripped and the expressions are converted to\n    // a canonical commutative form\n    // should only be done after compare() returns true to avoid false positives\n    sameForm: function(other) {\n        return this.strip().equals(other.strip());\n    },\n\n    // returns the GCD of this expression and the given factor\n    findGCD: function(factor) {\n        return this.equals(factor) ? factor : Num.One;\n    },\n\n    // return this expression's denominator\n    getDenominator: function() {\n        return Num.One;\n    },\n\n    // return this expression as a Mul\n    asMul: function() {\n        return new Mul(Num.One, this);\n    },\n\n    // TODO(alex): rename to isDefinitePositive or similar?\n    // return whether this expression is 100% positive\n    isPositive: abstract,\n\n    // TODO(alex): rename to hasNegativeSign or similar?\n    // return whether this expression has a negative sign\n    isNegative: function() { return false; },\n\n    // return a factor of this expression that is 100% positive\n    asPositiveFactor: function() {\n        return this.isPositive() ? this : Num.One;\n    },\n\n    // return a copy of the expression with a new hint set (preserves hints)\n    addHint: function(hint) {\n        if (!hint) {\n            return this;\n        }\n\n        var expr = this.construct(this.args());\n        expr.hints = _.clone(this.hints);\n        expr.hints[hint] = true;\n        return expr;\n    },\n\n    hints: {\n        parens: false\n    },\n\n    // currently unused!\n    asExpr: function() { return this; },\n\n    // complete parse by performing a few necessary transformations\n    completeParse: function() { return this.recurse(\"completeParse\"); },\n\n    abs: abstract,\n\n    negate: function() {\n        return new Mul(Num.Neg, this);\n    }\n});\n\n\n/* abstract sequence node */\nfunction Seq() {}\nSeq.prototype = new Expr();\n\n_.extend(Seq.prototype, {\n    args: function() { return this.terms; },\n\n    normalize: function() {\n        var terms = _.sortBy(_.invoke(this.terms, \"normalize\"), function(term) {\n            return term.print();\n        });\n\n        return new this.func(terms);\n    },\n\n    expand: function() {\n        return this.recurse(\"expand\").flatten();\n    },\n\n    // partition the sequence into its numeric and non-numeric parts\n    // makes no guarantees about the validity of either part!\n    partition: function() {\n        var terms = _.groupBy(this.terms, function(term) {\n            return term instanceof Num;\n        });\n\n        // XXX using a boolean as a key just converts it to a string. I don't\n        // think this code was written with that in mind. Probably doesn't\n        // matter except for readability.\n        var numbers = terms[true] || [];\n        var others = terms[false] || [];\n\n        return [new this.func(numbers), new this.func(others)];\n    },\n\n    // ensure that sequences have 2+ terms and no nested sequences of the same type\n    // this is a shallow flattening and will return a non-Seq if terms.length <= 1\n    flatten: function() {\n        var type = this;\n        var terms = _.reject(this.terms, function(term) {\n            return term.equals(type.identity);\n        });\n\n        if (terms.length === 0) {\n            return type.identity;\n        }\n        if (terms.length === 1) {\n            return terms[0];\n        }\n\n        var grouped = _.groupBy(terms, function(term) {\n            return term instanceof type.func;\n        });\n\n        // same contains the children which are Seqs of the same type as this Seq\n        var same = grouped[true] || [];\n        var others = grouped[false] || [];\n\n        var flattened = others.concat(_.flatten(_.pluck(same, \"terms\"), /* shallow: */ true));\n        return new type.func(flattened);\n    },\n\n    // the identity associated with the sequence\n    identity: undefined,\n\n    // reduce a numeric sequence to a Num\n    reduce: abstract,\n\n    isPositive: function() {\n        var terms = _.invoke(this.terms, \"collect\");\n        return _.all(_.invoke(terms, \"isPositive\"));\n    },\n\n    // return a new Seq with a given term replaced by a different term\n    // (or array of terms). given term can be passed directly, or by index\n    // if no new term is provided, the old one is simply removed\n    replace: function(oldTerm, newTerm) {\n        var index;\n\n        if (oldTerm instanceof Expr) {\n            index = _.indexOf(this.terms, oldTerm);\n        } else {\n            index = oldTerm;\n        }\n\n        var newTerms = [];\n        if (_.isArray(newTerm)) {\n            newTerms = newTerm;\n        } else if (newTerm) {\n            newTerms = [newTerm];\n        }\n\n        var terms = this.terms.slice(0, index)\n                    .concat(newTerms)\n                    .concat(this.terms.slice(index + 1));\n\n        return new this.func(terms);\n    },\n\n    // syntactic sugar for replace()\n    remove: function(term) {\n        return this.replace(term);\n    },\n\n    getDenominator: function() {\n        // TODO(alex): find and return LCM\n        return new Mul(_.invoke(this.terms, \"getDenominator\")).flatten();\n    }\n});\n\n\n/* sequence of additive terms */\nfunction Add() {\n    if (arguments.length === 1) {\n        this.terms = arguments[0];\n    } else {\n        this.terms = _.toArray(arguments);\n    }\n}\nAdd.prototype = new Seq();\n\n_.extend(Add.prototype, {\n    func: Add,\n\n    eval: function(vars, options) {\n        return _.reduce(this.terms, function(memo, term) { return memo + term.eval(vars, options); }, 0);\n    },\n\n    codegen: function() {\n        return _.map(this.terms, function(term) {\n            return \"(\" + term.codegen() + \")\";\n        }).join(\" + \") || \"0\";\n    },\n\n    print: function() {\n        return _.invoke(this.terms, \"print\").join(\"+\");\n    },\n\n    tex: function() {\n        var tex = \"\";\n\n        _.each(this.terms, function(term) {\n            if (!tex || term.isSubtract()) {\n                tex += term.tex();\n            } else {\n                tex += \"+\" + term.tex();\n            }\n        });\n\n        return tex;\n    },\n\n    collect: function(options) {\n        var terms = _.invoke(this.terms, \"collect\", options);\n\n        // [Expr expr, Num coefficient]\n        var pairs = [];\n\n        _.each(terms, function(term) {\n            if (term instanceof Mul) {\n                var muls = term.partition();\n                pairs.push([muls[1].flatten(), muls[0].reduce(options)]);\n            } else if (term instanceof Num) {\n                pairs.push([Num.One, term]);\n            } else {\n                pairs.push([term, Num.One]);\n            }\n        });\n\n        // { (Expr expr).print(): [[Expr expr, Num coefficient]] }\n        var grouped = _.groupBy(pairs, function(pair) {\n            return pair[0].normalize().print();\n        });\n\n        var collected = _.compact(_.map(grouped, function(pairs) {\n            var expr = pairs[0][0];\n            var sum = new Add(_.zip.apply(_, pairs)[1]);\n            var coefficient = sum.reduce(options);\n            return new Mul(coefficient, expr).collect(options);\n        }));\n\n        // TODO(alex): use the Pythagorean identity here\n        // e.g. x*sin^2(y) + x*cos^2(y) -> x\n\n        return new Add(collected).flatten();\n    },\n\n    // naively factor out anything that is common to all terms\n    // if options.keepNegative is specified, won't factor out a common -1\n    factor: function(options) {\n        options = _.extend({\n            keepNegative: false\n        }, options);\n\n        var terms = _.invoke(this.terms, \"collect\");\n        var factors;\n\n        if (terms[0] instanceof Mul) {\n            factors = terms[0].terms;\n        } else {\n            factors = [terms[0]];\n        }\n\n        _.each(_.rest(this.terms), function(term) {\n            factors = _.map(factors, function(factor) {\n                return term.findGCD(factor);\n            });\n        });\n\n        if (!options.keepNegative && this.isNegative()) {\n            factors.push(Num.Neg);\n        }\n\n        factors = new Mul(factors).flatten().collect();\n\n        var remainder = _.map(terms, function(term) {\n            return Mul.handleDivide(term, factors).simplify();\n        });\n        remainder = new Add(remainder).flatten();\n\n        return Mul.createOrAppend(factors, remainder).flatten();\n    },\n\n    reduce: function(options) {\n        return _.reduce(this.terms, function(memo, term) {\n            return memo.add(term, options);\n        }, this.identity);\n    },\n\n    needsExplicitMul: function() { return false; },\n\n    isNegative: function() {\n        var terms = _.invoke(this.terms, \"collect\");\n        return _.all(_.invoke(terms, \"isNegative\"));\n    },\n\n    negate: function() {\n        return new Add(_.invoke(this.terms, \"negate\"));\n    }\n});\n\n\n/* sequence of multiplicative terms */\nfunction Mul() {\n    if (arguments.length === 1) {\n        this.terms = arguments[0];\n    } else {\n        this.terms = _.toArray(arguments);\n    }\n}\nMul.prototype = new Seq();\n\n_.extend(Mul.prototype, {\n    func: Mul,\n\n    eval: function(vars, options) {\n        return _.reduce(this.terms, function(memo, term) { return memo * term.eval(vars, options); }, 1);\n    },\n\n    codegen: function() {\n        return _.map(this.terms, function(term) {\n            return \"(\" + term.codegen() + \")\";\n        }).join(\" * \") || \"0\";\n    },\n\n    print: function() {\n        return _.map(this.terms, function(term) {\n            return (term instanceof Add) ? \"(\" + term.print() + \")\" : term.print();\n        }).join(\"*\");\n    },\n\n    getUnits: function() {\n        var tmUnits = _.chain(this.terms)\n            .map(function(term) {\n                return term.getUnits();\n            })\n            .flatten()\n            .value();\n\n        tmUnits.sort(function(a, b) {\n            return a.unit < b.unit;\n        });\n\n        return tmUnits;\n    },\n\n    // since we don't care about commutativity, we can render a Mul any way we choose\n    // so we follow convention: first any negatives, then any numbers, then everything else\n    tex: function() {\n        var cdot = \" \\\\cdot \";\n\n        var terms = _.groupBy(this.terms, function(term) {\n            if (term.isDivide()) {\n                return \"inverse\";\n            } else if (term instanceof Num) {\n                return \"number\";\n            } else {\n                return \"other\";\n            }\n        });\n\n        var inverses = terms.inverse || [];\n        var numbers = terms.number || [];\n        var others = terms.other || [];\n\n        var negatives = \"\";\n        var numerator;\n\n        // check all the numbers to see if there is a rational we can extract,\n        // since we would like 1/2x/y to come out as \\frac{1}{2}\\frac{x}{y},\n        // and not \\frac{1x}{2y}.\n        for (var i = 0; i < numbers.length; i++) {\n            var isRational = numbers[i] instanceof Rational &&\n                                !(numbers[i] instanceof Int);\n            if (isRational && others.length > 0 && inverses.length > 0) {\n                var withThisRemoved = numbers.slice();\n                withThisRemoved.splice(i, 1);\n                var newTerms = withThisRemoved.concat(inverses).concat(others);\n                return numbers[i].tex() + new Mul(newTerms).tex();\n            }\n        }\n\n        numbers = _.compact(_.map(numbers, function(term) {\n            var hasDenom = (term instanceof Rational) && !(term instanceof Int);\n            var shouldPushDown = !term.hints.fraction || inverses.length > 0;\n            if (hasDenom && shouldPushDown) {\n                // e.g. 3x/4 -> 3/4*x (internally) -> 3x/4 (rendered)\n                inverses.push(new Pow(new Int(term.d), Num.Div));\n                var number = new Int(term.n);\n                number.hints = term.hints;\n                return _.any(term.hints) ? number : null;\n            } else {\n                return term;\n            }\n        }));\n\n        if (numbers.length === 0 && others.length === 1) {\n            // e.g. (x+y)/z -> \\frac{x+y}{z}\n            numerator = others[0].tex();\n        } else {\n            var tex = \"\";\n\n            _.each(numbers, function(term) {\n                if (term.hints.subtract && term.hints.entered) {\n                    negatives += \"-\";\n                    tex += (tex ? cdot : \"\") + term.abs().tex();\n                } else if ((term instanceof Int) && (term.n === -1) &&\n                    (term.hints.negate || term.hints.subtract)) {\n                    // e.g. -1*-1 -> --1\n                    // e.g. -1*x -> -x\n                    negatives += \"-\";\n                } else {\n                    // e.g. 2*3 -> 2(dot)3\n                    tex += (tex ? cdot : \"\") + term.tex();\n                }\n            });\n\n            _.each(others, function(term) {\n                if (term.needsExplicitMul()) {\n                    // e.g. 2*2^3 -> 2(dot)2^3\n                    tex += (tex ? cdot : \"\") + term.tex();\n                } else if (term instanceof Add) {\n                    // e.g. (a+b)*c -> (a+b)c\n                    tex += \"(\" + term.tex() + \")\";\n                } else {\n                    // e.g. a*b*c -> abc\n                    tex += term.tex();\n                }\n            });\n\n            numerator = tex ? tex : \"1\";\n        }\n\n        if (!inverses.length) {\n            return negatives + numerator;\n        } else {\n            var denominator = new Mul(_.invoke(inverses, \"asDivide\")).flatten().tex();\n            return negatives + \"\\\\frac{\" + numerator + \"}{\" + denominator + \"}\";\n        }\n    },\n\n    strip: function() {\n        var terms = _.map(this.terms, function(term) {\n            return term instanceof Num ? term.abs() : term.strip();\n        });\n        return new Mul(terms).flatten();\n    },\n\n    // expand numerator and denominator separately\n    expand: function() {\n\n        var isAdd = function(term) {\n            return term instanceof Add;\n        };\n\n        var isInverse = function(term) {\n            return term instanceof Pow && term.exp.isNegative();\n        };\n\n        var isInverseAdd = function(term) {\n            return isInverse(term) && isAdd(term.base);\n        };\n\n        var mul = this.recurse(\"expand\").flatten();\n\n        var hasAdd = _.any(mul.terms, isAdd);\n        var hasInverseAdd = _.any(mul.terms, isInverseAdd);\n\n        if (!(hasAdd || hasInverseAdd)) {\n            return mul;\n        }\n\n        var terms = _.groupBy(mul.terms, isInverse);\n        var normals = terms[false] || [];\n        var inverses = terms[true] || [];\n\n        if (hasAdd) {\n            var grouped = _.groupBy(normals, isAdd);\n            var adds = grouped[true] || [];\n            var others = grouped[false] || [];\n\n            // loop over each additive sequence\n            var expanded = _.reduce(adds, function(expanded, add) {\n                // loop over each expanded array of terms\n                return _.reduce(expanded, function(temp, array) {\n                    // loop over each additive sequence's terms\n                    return temp.concat(_.map(add.terms, function(term) {\n                        return array.concat(term);\n                    }));\n                }, []);\n            }, [[]]);\n\n            // join each fully expanded array of factors with remaining multiplicative factors\n            var muls = _.map(expanded, function(array) {\n                return new Mul(others.concat(array)).flatten();\n            });\n\n            normals = [new Add(muls)];\n        }\n\n        if (hasInverseAdd) {\n            var denominator = new Mul(_.invoke(inverses, \"getDenominator\")).flatten();\n            inverses = [new Pow(denominator.expand(), Num.Div)];\n        }\n\n        return new Mul(normals.concat(inverses)).flatten();\n    },\n\n    factor: function(options) {\n        var factored = this.recurse(\"factor\", options).flatten();\n        if (! (factored instanceof Mul)) {\n            return factored;\n        }\n\n        // Combine any factored out Rationals into one, but don't collect\n        var grouped = _.groupBy(factored.terms, function(term) {\n            return term instanceof Rational;\n        });\n\n        // Could also accomplish this by passing a new option\n        // e.g. return  memo.mul(term, {autocollect: false});\n        // TODO(alex): Decide whether this is a good use of options or not\n        var rational = _.reduce(grouped[true], function(memo, term) {\n            return {n: memo.n * term.n, d: memo.d * term.d};\n        }, {n: 1, d: 1});\n\n        if (rational.d === 1) {\n            rational = new Int(rational.n);\n        } else {\n            rational = new Rational(rational.n, rational.d);\n        }\n\n        return new Mul((grouped[false] || []).concat(rational)).flatten();\n    },\n\n    collect: function(options) {\n        var partitioned = this.recurse(\"collect\", options).partition();\n        var number = partitioned[0].reduce(options);\n\n        // e.g. 0*x -> 0\n        if (number.eval() === 0) {\n            return Num.Zero;\n        }\n\n        var others = partitioned[1].flatten();\n\n        // e.g. 2*2 -> 4\n        // e.g. 2*2*x -> 4*x\n        if (!(others instanceof Mul)) {\n            return new Mul(number, others).flatten();\n        }\n\n        others = others.terms;\n\n        // [Expr base, Expr exp]\n        var pairs = [];\n\n        _.each(others, function(term) {\n            if (term instanceof Pow) {\n                pairs.push([term.base, term.exp]);\n            } else {\n                pairs.push([term, Num.One]);\n            }\n        });\n\n        // {(Expr base).print(): [[Expr base, Expr exp]]}\n        var grouped = _.groupBy(pairs, function(pair) {\n            return pair[0].normalize().print();\n        });\n\n        // [[Expr base, Expr exp]]\n        var summed = _.compact(_.map(grouped, function(pairs) {\n            var base = pairs[0][0];\n            var sum = new Add(_.zip.apply(_, pairs)[1]);\n            var exp = sum.collect(options);\n\n            if (exp instanceof Num && exp.eval() === 0) {\n                return null;\n            } else {\n                return [base, exp];\n            }\n        }));\n\n        // XXX `pairs` is shadowed four or five times in this function\n        var pairs = _.groupBy(summed, function(pair) {\n            if (pair[0] instanceof Trig && pair[0].isBasic()) {\n                return \"trig\";\n            } else if (pair[0] instanceof Log) {\n                return \"log\";\n            } else {\n                return \"expr\";\n            }\n        });\n        var trigs = pairs.trig || [];\n        var logs = pairs.log || [];\n        var exprs = pairs.expr || [];\n\n        if (trigs.length > 1) {\n            // combine sines and cosines into other trig functions\n\n            // {Trig.arg.print(): [[Trig base, Expr exp]]}\n            var byArg = _.groupBy(trigs, function(pair) {\n                return pair[0].arg.normalize().print();\n            });\n\n            trigs = [];\n            _.each(byArg, function(pairs) {\n                var arg = pairs[0][0].arg;\n\n                // {Trig.type: Expr exp}\n                var funcs = {sin: Num.Zero, cos: Num.Zero};\n                _.each(pairs, function(pair) {\n                    funcs[pair[0].type] = pair[1];\n                });\n\n                if (Mul.handleNegative(funcs.sin).collect(options).equals(funcs.cos)) {\n                    // e.g. sin^x(y)/cos^x(y) -> tan^x(y)\n                    if (funcs.cos.isNegative()) {\n                        funcs = {tan: funcs.sin};\n                    } else {\n                        funcs = {cot: funcs.cos};\n                    }\n                }\n\n                // TODO(alex): combine even if exponents not a perfect match\n                // TODO(alex): transform 1/sin and 1/cos into csc and sec\n\n                _.each(funcs, function(exp, type) {\n                    trigs.push([new Trig(type, arg), exp]);\n                });\n            });\n        }\n\n        if (logs.length > 1) {\n            // combine logs with the same base\n\n            // {Log.base.print(): [[Log base, Expr exp]]}\n            var byBase = _.groupBy(logs, function(pair) {\n                return pair[0].base.normalize().print();\n            });\n\n            logs = [];\n\n            _.each(byBase, function(pairs) {\n                // only combine two logs of the same base, otherwise commutative\n                // differences result in different equally valid output\n                // e.g. ln(x)/ln(z)*ln(y) -> log_z(x)*ln(y)\n                // e.g. ln(x)*ln(y)/ln(z) -> ln(x)*log_z(y)\n                if (pairs.length === 2 &&\n                    Mul.handleNegative(pairs[0][1]).collect(options).equals(pairs[1][1])) {\n                    // e.g. ln(x)^y/ln(b)^y -> log_b(x)^y\n                    if (pairs[0][1].isNegative()) {\n                        logs.push([new Log(pairs[0][0].power, pairs[1][0].power), pairs[1][1]]);\n                    } else {\n                        logs.push([new Log(pairs[1][0].power, pairs[0][0].power), pairs[0][1]]);\n                    }\n                } else {\n                    logs = logs.concat(pairs);\n                }\n            });\n\n            // TODO(alex): combine if all inverses are the same e.g. ln(y)*ln(z)/ln(x)/ln(x)\n        }\n\n        pairs = trigs.concat(logs).concat(exprs);\n\n        var collected = _.map(pairs, function(pair) {\n            return new Pow(pair[0], pair[1]).collect(options);\n        });\n\n        return new Mul([number].concat(collected)).flatten();\n    },\n\n    isSubtract: function() {\n        return _.any(this.terms, function(term) {\n            return term instanceof Num && term.hints.subtract;\n        });\n    },\n\n    // factor a single -1 in to the Mul\n    // combine with a Num if all Nums are positive, else add as a term\n    factorIn: function(hint) {\n        var partitioned = this.partition();\n        var numbers = partitioned[0].terms;\n        var fold = numbers.length && _.all(numbers, function(num) {\n            return num.n > 0;\n        });\n\n        if (fold) {\n            // e.g. - x*2*3 -> x*-2*3\n            var num = numbers[0].negate();\n            num.hints = numbers[0].hints;\n            return this.replace(numbers[0], num.addHint(hint));\n        } else {\n            // e.g. - x*y -> -1*x*y\n            // e.g. - x*-2 -> -1*x*-2\n            return new Mul([Num.negativeOne(hint)].concat(this.terms));\n        }\n    },\n\n    // factor out a single hinted -1 (assume it is the division hint)\n    // TODO(alex): make more general or rename to be more specific\n    factorOut: function() {\n        var factored = false;\n        var terms = _.compact(_.map(this.terms, function(term, i, list) {\n            if (!factored && term instanceof Num && term.hints.divide) {\n                factored = true;\n                return term.n !== -1 ? term.negate() : null;\n            } else {\n                return term;\n            }\n        }));\n\n        if (terms.length === 1) {\n            return terms[0];\n        } else {\n            return new Mul(terms);\n        }\n    },\n\n    reduce: function(options) {\n        return _.reduce(this.terms, function(memo, term) {\n            return memo.mul(term, options);\n        }, this.identity);\n    },\n\n    findGCD: function(factor) {\n        return new Mul(_.invoke(this.terms, \"findGCD\", factor)).flatten();\n    },\n\n    asMul: function() {\n        return this;\n    },\n\n    asPositiveFactor: function() {\n        if (this.isPositive()) {\n            return this;\n        } else {\n            var terms = _.invoke(this.collect().terms, \"asPositiveFactor\");\n            return new Mul(terms).flatten();\n        }\n    },\n\n    isNegative: function() {\n        return _.any(_.invoke(this.collect().terms, \"isNegative\"));\n    },\n\n    fold: function() {\n        return Mul.fold(this);\n    },\n\n    negate: function() {\n        var isNum = function(expr) { return expr instanceof Num; };\n        if (_.any(this.terms, isNum)) {\n            var num = _.find(this.terms, isNum);\n            return this.replace(num, num.negate());\n        } else {\n            return new Mul([Num.Neg].concat(this.terms));\n        }\n    }\n});\n\n// static methods for the sequence types\n_.each([Add, Mul], function(type) {\n    _.extend(type, {\n        // create a new sequence unless left is already one (returns a copy)\n        createOrAppend: function(left, right) {\n            if (left instanceof type) {\n                return new type(left.terms.concat(right));\n            } else {\n                return new type(left, right);\n            }\n        }\n    });\n});\n\n_.extend(Mul, {\n    // negative signs should be folded into numbers whenever possible\n    // never fold into a Num that's already negative or a Mul that has a negative Num\n    // an optional hint is kept track of to properly render user input\n    // an empty hint means negation\n    handleNegative: function(expr, hint) {\n        if (expr instanceof Num && expr.n > 0) {\n            // e.g. - 2 -> -2\n            var negated = expr.negate();\n            // TODO(alex): rework hint system so that this isn't necessary\n            negated.hints = expr.hints;\n            return negated.addHint(hint);\n        } else if (expr instanceof Mul) {\n            // e.g. - x*2*3 -> x*-2*3\n            // e.g. - x*y -> -1*x*y\n            // e.g. - x*-2 -> -1*x*-2\n            return expr.factorIn(hint);\n        } else {\n            // e.g. - x -> -1*x\n            return new Mul(Num.negativeOne(hint), expr);\n        }\n    },\n\n    // division can create either a Rational or a Mul\n    handleDivide: function(left, right) {\n\n        // dividing by a Mul is the same as repeated division by its terms\n        if (right instanceof Mul) {\n            var first = Mul.handleDivide(left, right.terms[0]);\n            var rest = new Mul(_.rest(right.terms)).flatten();\n            return Mul.handleDivide(first, rest);\n        }\n\n        var isInt = function(expr) { return expr instanceof Int; };\n        var isRational = function(expr) { return expr instanceof Rational; };\n\n        // for simplification purposes, fold Ints into Rationals if possible\n        // e.g. 3x / 4 -> 3/4 * x (will still render as 3x/4)\n        if (isInt(right) && left instanceof Mul && _.any(left.terms, isInt)) {\n\n            // search from the right\n            var reversed = left.terms.slice().reverse();\n            var num = _.find(reversed, isRational);\n\n            if (!isInt(num)) {\n                return new Mul(left.terms.concat([new Rational(1, right.n).addHint(\"fraction\")]));\n            }\n\n            var rational = new Rational(num.n, right.n);\n            rational.hints = num.hints;\n\n            // in the case of something like 1/3 * 6/8, we want the\n            // 6/8 to be considered a fraction, not just a division\n            if (num === reversed[0]) {\n                rational = rational.addHint(\"fraction\");\n            }\n\n            var result;\n            if (num.n < 0 && right.n < 0) {\n                rational.d = -rational.d;\n                return left.replace(num, [Num.Neg, rational]);\n            } else {\n                return left.replace(num, rational);\n            }\n        }\n\n        var divide = function(a, b) {\n            if (b instanceof Int) {\n                if (a instanceof Int) {\n                    if (a.n < 0 && b.n < 0) {\n                        // e.g. -2 / -3 -> -1*-2/3\n                        return [Num.Neg, new Rational(a.n, -b.n).addHint(\"fraction\")];\n                    } else {\n                        // e.g. 2 / 3 -> 2/3\n                        // e.g. -2 / 3 -> -2/3\n                        // e.g. 2 / -3 -> -2/3\n                        return [new Rational(a.n, b.n).addHint(\"fraction\")];\n                    }\n                } else {\n                    // e.g. x / 3 -> x*1/3\n                    // e.g. x / -3 -> x*-1/3\n                    var inverse = new Rational(1, b.eval());\n                    if (b.eval() < 0) {\n                        return [a, inverse.addHint(\"negate\")];\n                    } else {\n                        return [a, inverse];\n                    }\n                }\n            } else {\n                var pow;\n\n                if (b instanceof Trig && b.exp) {\n                    // e.g. sin^2(x) -> sin(x)^2\n                    var exp = b.exp;\n                    b.exp = undefined;\n                    b = new Pow(b, exp);\n                }\n\n                if (b instanceof Pow) {\n                    // e.g. (x^2) ^ -1 -> x^-2\n                    // e.g. (x^y) ^ -1 -> x^(-1*y)\n                    // e.g. (x^(yz)) ^ -1 -> x^(-1*y*z)\n                    pow = new Pow(b.base, Mul.handleNegative(b.exp, \"divide\"));\n                } else {\n                    // e.g. x ^ -1 -> x^-1\n                    pow = new Pow(b, Num.Div);\n                }\n\n                if (a instanceof Int && a.n === 1) {\n                    // e.g. 1 / x -> x^-1\n                    return [pow];\n                } else {\n                    // e.g. 2 / x -> 2*x^-1\n                    return [a, pow];\n                }\n            }\n        };\n\n        if (left instanceof Mul) {\n            var divided = divide(_.last(left.terms), right);\n            return new Mul(_.initial(left.terms).concat(divided));\n        } else {\n            var divided = divide(left, right);\n            return new Mul(divided).flatten();\n        }\n    },\n\n    // fold negative signs into numbers if possible\n    // negative signs are not the same as multiplying by negative one!\n    // e.g. -x      ->  -1*x    simplified\n    // e.g. -2*x    ->  -2*x    simplified\n    // e.g. -x*2    ->  -1*x*2  not simplified -> x*-2 simplified\n    // e.g. -1*x*2  ->  -1*x*2  not simplified\n\n    // also fold multiplicative terms into open Trig and Log nodes\n    // e.g. (sin x)*x -> sin(x)*x\n    // e.g. sin(x)*x -> sin(x)*x\n    // e.g. sin(x)*(x) -> sin(x)*x\n    // e.g. sin(x)*sin(y) -> sin(x)*sin(y)\n    fold: function(expr) {\n        if (expr instanceof Mul) {\n            // assuming that this will be second to last\n            var trigLog = _.find(_.initial(expr.terms), function(term) {\n                return (term instanceof Trig || term instanceof Log) && term.hints.open;\n            });\n            var index = _.indexOf(expr.terms, trigLog);\n\n            if (trigLog) {\n                var last = _.last(expr.terms);\n                if (trigLog.hints.parens || last.hints.parens ||\n                          last.has(Trig) || last.has(Log)) {\n                    trigLog.hints.open = false;\n                } else {\n                    var newTrigLog;\n                    if (trigLog instanceof Trig) {\n                        newTrigLog = Trig.create([trigLog.type, trigLog.exp], Mul.createOrAppend(trigLog.arg, last).fold());\n                    } else {\n                        newTrigLog = Log.create(trigLog.base, Mul.createOrAppend(trigLog.power, last).fold());\n                    }\n\n                    if (index === 0) {\n                        return newTrigLog;\n                    } else {\n                        return new Mul(expr.terms.slice(0, index).concat(newTrigLog)).fold();\n                    }\n                }\n            }\n\n            var partitioned = expr.partition();\n            var numbers = partitioned[0].terms;\n\n            var pos = function(num) { return num.n > 0; };\n            var neg = function(num) { return num.n === -1 && num.hints.negate; };\n            var posOrNeg = function(num) { return pos(num) || neg(num); };\n\n            if (numbers.length > 1 &&\n                _.some(numbers, neg) &&\n                _.some(numbers, pos) &&\n                _.every(numbers, posOrNeg)) {\n\n                var firstNeg = _.indexOf(expr.terms, _.find(expr.terms, neg));\n                var firstNum = _.indexOf(expr.terms, _.find(expr.terms, pos));\n\n                // e.g. -x*2 -> x*-2\n                if (firstNeg < firstNum) {\n                    return expr.replace(firstNum,\n                                        expr.terms[firstNum].negate())\n                               .remove(firstNeg);\n                }\n            }\n        }\n\n        // in all other cases, make no change\n        return expr;\n    }\n});\n\n\n/* exponentiation */\nfunction Pow(base, exp) { this.base = base; this.exp = exp; }\nPow.prototype = new Expr();\n\n_.extend(Pow.prototype, {\n    func: Pow,\n    args: function() { return [this.base, this.exp]; },\n\n    eval: function(vars, options) {\n        var evaledBase = this.base.eval(vars, options);\n        var evaledExp = this.exp.eval(vars, options);\n\n        // Math.pow unequivocally returns NaN when provided with both a\n        // negative base and a fractional exponent. However, in some cases, we\n        // know that our exponent is actually valid for use with negative\n        // bases (e.g., (-5)^(1/3)).\n        //\n        // Here, we explicitly check for such cases. We really only handle a\n        // limited subset (by requiring that the exponent is rational with an\n        // odd denominator), but it's still useful.\n        //   See: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/pow\n        if (evaledBase < 0) {\n            var simplifiedExp = this.exp.simplify();\n\n            // If Float, convert to a Rational to enable the logic below\n            if (simplifiedExp instanceof Float) {\n                var num = simplifiedExp.n;\n                var decimals = (num - num.toFixed()).toString().length - 2;\n                var denominator = Math.pow(10, decimals);\n                var rationalExp = new Rational(num * denominator, denominator);\n                simplifiedExp = rationalExp.simplify();\n            }\n            if (simplifiedExp instanceof Rational) {\n                var oddDenominator = Math.abs(simplifiedExp.d) % 2 === 1;\n                if (oddDenominator) {\n                    var oddNumerator = Math.abs(simplifiedExp.n) % 2 === 1;\n                    var sign = (oddNumerator) ? -1 : 1;\n                    return sign * Math.pow(-1 * evaledBase, evaledExp);\n                }\n            }\n        }\n        return Math.pow(evaledBase, evaledExp);\n    },\n\n    getUnits: function() {\n        return this.base.getUnits().map(function(unit) {\n            return {\n                unit: unit.unit,\n                pow: unit.pow * this.exp.n\n            };\n        }.bind(this));\n    },\n\n    codegen: function() {\n        return \"Math.pow(\" + this.base.codegen() +\n            \", \" + this.exp.codegen() + \")\";\n    },\n\n    print: function() {\n        var base = this.base.print();\n        if (this.base instanceof Seq || this.base instanceof Pow) {\n            base = \"(\" + base + \")\";\n        }\n        return base + \"^(\" + this.exp.print() + \")\";\n    },\n\n    tex: function() {\n        if (this.isDivide()) {\n\n            // e.g. x ^ -1 w/hint -> 1/x\n            return \"\\\\frac{1}{\" + this.asDivide().tex() + \"}\";\n\n        } else if (this.isRoot()) {\n\n            if (this.exp.n !== 1) {\n                error(\"Node marked with hint 'root' does not have exponent \" +\n                      \"of form 1/x.\");\n            }\n\n            if (this.exp.d === 2) {\n                // e.g. x ^ 1/2 w/hint -> sqrt{x}\n                return \"\\\\sqrt{\" + this.base.tex() + \"}\";\n            } else {\n                // e.g. x ^ 1/y w/hint -> sqrt[y]{x}\n                return \"\\\\sqrt[\" + this.exp.d + \"]{\" + this.base.tex() + \"}\";\n            }\n\n        } else if (this.base instanceof Trig && !this.base.isInverse() &&\n            this.exp instanceof Num && this.exp.isSimple() &&\n            this.exp.eval() >= 0) {\n\n            // e.g sin(x) ^ 2 -> sin^2(x)\n            var split = this.base.tex({split: true});\n            return split[0] + \"^{\" + this.exp.tex() + \"}\" + split[1];\n\n        } else {\n\n            // e.g. x ^ y -> x^y\n            var base = this.base.tex();\n            if (this.base instanceof Seq || this.base instanceof Pow ||\n                (this.base instanceof Num && !this.base.isSimple())) {\n                // e.g. a+b ^ c -> (a+b)^c\n                base = \"(\" + base + \")\";\n            } else if (this.base instanceof Trig || this.base instanceof Log) {\n                // e.g. ln(x) ^ 2 -> [ln(x)]^2\n                base = \"[\" + base + \"]\";\n            }\n            return base + \"^{\" + this.exp.tex() + \"}\";\n        }\n    },\n\n    needsExplicitMul: function() {\n        return this.isRoot() ? false : this.base.needsExplicitMul();\n    },\n\n    expand: function() {\n        var pow = this.recurse(\"expand\");\n\n        if (pow.base instanceof Mul) {\n            // e.g. (ab)^c -> a^c*b^c\n\n            var terms = _.map(pow.base.terms, function(term) {\n                return new Pow(term, pow.exp);\n            });\n\n            return new Mul(terms).expand();\n\n        } else if (pow.base instanceof Add && pow.exp instanceof Int && pow.exp.abs().eval() > 1) {\n            // e.g. (a+b)^2 -> a*a+a*b+a*b+b*b\n            // e.g. (a+b)^-2 -> (a*a+a*b+a*b+b*b)^-1\n\n            var positive = pow.exp.eval() > 0;\n            var n = pow.exp.abs().eval();\n\n            var signed = function(mul) {\n                return positive ? mul : new Pow(mul, Num.Div);\n            };\n\n            // compute and cache powers of 2 up to n\n            var cache = { 1: pow.base };\n            for (var i = 2; i <= n; i *= 2) {\n                var mul = new Mul(cache[i / 2], cache[i / 2]);\n                cache[i] = mul.expand().collect();\n            }\n\n            // if n is a power of 2, you're done!\n            if (_.has(cache, n)) {\n                return signed(cache[n]);\n            }\n\n            // otherwise decompose n into powers of 2 ...\n            var indices = _.map(n.toString(2).split(\"\"), function(str, i, list) {\n                return Number(str) * Math.pow(2, list.length - i - 1);\n            });\n            indices = _.without(indices, 0);\n\n            // ... then combine\n            var mul = new Mul(_.pick(cache, indices)).expand().collect();\n            return signed(mul);\n\n        } else if (pow.exp instanceof Add) { // DEFINITELY want behind super-simplify() flag\n            // e.g. x^(a+b) -> x^a*x^b\n\n            var terms = _.map(pow.exp.terms, function(term) {\n                return new Pow(pow.base, term).expand();\n            });\n\n            return new Mul(terms).expand();\n        } else {\n            return pow;\n        }\n    },\n\n    factor: function() {\n        var pow = this.recurse(\"factor\");\n        if (pow.base instanceof Mul) {\n            var terms = _.map(pow.base.terms, function(term) {\n                if (term instanceof Int && pow.exp.equals(Num.Div)) {\n                    // Anything that can be a Rational should be a Rational\n                    // e.g. 2^(-1) -> 1/2\n                    return new Rational(1, term.n);\n                } else {\n                    return new Pow(term, pow.exp);\n                }\n            });\n            return new Mul(terms);\n        } else {\n            return pow;\n        }\n    },\n\n    collect: function(options) {\n\n        if (this.base instanceof Pow) {\n            // collect this first to avoid having to deal with float precision\n            // e.g. sqrt(2)^2 -> 2, not 2.0000000000000004\n            // e.g. (x^y)^z -> x^(yz)\n            var base = this.base.base;\n            var exp = Mul.createOrAppend(this.base.exp, this.exp);\n            return new Pow(base, exp).collect(options);\n        }\n\n        var pow = this.recurse(\"collect\", options);\n\n        var isSimilarLog = function(term) {\n            return term instanceof Log && term.base.equals(pow.base);\n        };\n\n        if (pow.exp instanceof Num &&\n            pow.exp.eval() === 0) {\n\n            // e.g. x^0 -> 1\n            return Num.One;\n\n        } else if (pow.exp instanceof Num &&\n            pow.exp.eval() === 1) {\n\n            // e.g. x^1 -> x\n            return pow.base;\n\n        } else if (isSimilarLog(pow.exp)) {\n\n            // e.g. b^(log_b(x)) -> x\n            return pow.exp.power;\n\n        } else if (pow.exp instanceof Mul &&\n            _.any(pow.exp.terms, isSimilarLog)) {\n\n            // e.g. b^(2*y*log_b(x)) -> x^(2*y)\n            var log = _.find(pow.exp.terms, isSimilarLog);\n            var base = log.power;\n            var exp = pow.exp.remove(log).flatten();\n            return new Pow(base, exp).collect(options);\n\n        } else if (pow.base instanceof Num &&\n            pow.exp instanceof Num) {\n\n            // TODO(alex): Consider encapsualting this logic (and similar logic\n            // elsewhere) into a separate Decimal class for user-entered floats\n            if (options && options.preciseFloats) {\n                // Avoid creating an imprecise float\n                // e.g. 23^1.5 -> 12167^0.5, not ~110.304\n\n                // If you take the root as specified by the denominator and\n                // end up with more digits after the decimal point,\n                // the result is imprecise. This works for rationals as well\n                // as floats, but ideally rationals should be pre-processed\n                // e.g. (1/27)^(1/3) -> 1/3 to avoid most cases.\n                // TODO(alex): Catch such cases and avoid converting to floats.\n                var exp = pow.exp.asRational();\n                var decimalsInBase = pow.base.getDecimalPlaces();\n                var root = new Pow(pow.base, new Rational(1, exp.d));\n                var decimalsInRoot = root.collect().getDecimalPlaces();\n\n                if (decimalsInRoot > decimalsInBase) {\n                    // Collecting over this denominator would result in an\n                    // imprecise float, so avoid doing so.\n                    var newBase = new Pow(pow.base, new Int(exp.n)).collect();\n                    return new Pow(newBase, new Rational(1, exp.d));\n                }\n            }\n\n            // e.g. 4^1.5 -> 8\n            return pow.base.raiseToThe(pow.exp, options);\n        } else {\n            return pow;\n        }\n    },\n\n    // checks whether this Pow represents user-entered division\n    isDivide: function() {\n        var isDiv = function(arg) { return arg instanceof Num && arg.hints.divide; };\n        return isDiv(this.exp) || (this.exp instanceof Mul && _.any(this.exp.terms, isDiv));\n    },\n\n    // assuming this Pow represents user-entered division, returns the denominator\n    asDivide: function() {\n        if (this.exp instanceof Num) {\n            if (this.exp.eval() === -1) {\n                return this.base;\n            } else {\n                var negated = this.exp.negate();\n                negated.hints = _.clone(this.exp.hints);\n                negated.hints.divide = false;\n                return new Pow(this.base, negated);\n            }\n        } else if (this.exp instanceof Mul) {\n            return new Pow(this.base, this.exp.factorOut());\n        } else {\n            error(\"called asDivide() on an Expr that wasn't a Num or Mul\");\n        }\n    },\n\n    isRoot: function() {\n        return this.exp instanceof Rational && this.exp.hints.root;\n    },\n\n    isSquaredTrig: function() {\n        return this.base instanceof Trig && !this.base.isInverse() &&\n            this.exp instanceof Num && this.exp.eval() === 2;\n    },\n\n    // extract whatever denominator makes sense, ignoring hints\n    // if negative exponent, will recursively include the base's denominator as well\n    getDenominator: function() {\n        if (this.exp instanceof Num && this.exp.eval() === -1) {\n            return Mul.createOrAppend(this.base, this.base.getDenominator()).flatten();\n        } else if (this.exp.isNegative()) {\n            var pow = new Pow(this.base, Mul.handleNegative(this.exp).collect());\n            return Mul.createOrAppend(pow, pow.collect().getDenominator()).flatten();\n        } else if (this.base instanceof Num) {\n            return new Pow(this.base.getDenominator(), this.exp).collect();\n        } else {\n            return Num.One;\n        }\n    },\n\n    findGCD: function(factor) {\n        var base, exp;\n        if (factor instanceof Pow) {\n            base = factor.base;\n            exp = factor.exp;\n        } else {\n            base = factor;\n            exp = Num.One;\n        }\n\n        // GCD is only relevant if same base\n        if (this.base.equals(base)) {\n            if (this.exp.equals(exp)) {\n                // exact match\n                // e.g. GCD(x^y^z, x^y^z) -> x^y^z\n                return this;\n            } else if (this.exp instanceof Num && exp instanceof Num) {\n                // two numerical exponents\n                // e.g. GCD(x^3, x^2) -> x^2\n                return new Pow(this.base, Num.min(this.exp, exp)).collect();\n            } else if (this.exp instanceof Num || exp instanceof Num) {\n                // one numerical exponent\n                // e.g. GCD(x^2, x^y) -> 1\n                return Num.One;\n            }\n\n            var expA = this.exp.asMul().partition();\n            var expB = exp.asMul().partition();\n\n            if (expA[1].equals(expB[1])) {\n                // exponents match except for coefficient\n                // e.g. GCD(x^3y, x^y) -> x^y\n                var coefficient = Num.min(expA[0].reduce(), expB[0].reduce());\n                var mul = new Mul(coefficient, expA[1].flatten()).flatten();\n                return new Pow(base, mul).collect();\n            }\n        }\n\n        return Num.One;\n    },\n\n    isPositive: function() {\n        if (this.base.isPositive()) {\n            return true;\n        }\n\n        var exp = this.exp.simplify();\n        return exp instanceof Int && exp.eval() % 2 === 0;\n    },\n\n    asPositiveFactor: function() {\n        if (this.isPositive()) {\n            return this;\n        } else {\n            var exp = this.exp.simplify();\n            if (exp instanceof Int) {\n                var n = exp.eval();\n                if (n > 2) {\n                    // e.g. x^3 -> x^2\n                    return new Pow(this.base, new Int(n-1));\n                } else if (n < -2) {\n                    // e.g. x^-3 -> x^-2\n                    return new Pow(this.base, new Int(n+1));\n                }\n            }\n            return Num.One;\n        }\n    }\n});\n\n_.extend(Pow, {\n    sqrt: function(arg) {\n        return new Pow(arg, Num.Sqrt);\n    },\n\n    nthroot: function(radicand, degree) {\n        var exp = Mul.fold(Mul.handleDivide(new Int(1), degree));\n\n        // FIXME(johnsullivan): If oneOverDegree ends up being a pow object,\n        //     this \"root\" hint is lost between here and when tex() is called.\n        return new Pow(radicand, exp.addHint(\"root\"));\n    },\n});\n\n\n/* logarithm */\nfunction Log(base, power) { this.base = base; this.power = power; }\nLog.prototype = new Expr();\n\n_.extend(Log.prototype, {\n    func: Log,\n    args: function() { return [this.base, this.power]; },\n\n    eval: function(vars, options) {\n        return Math.log(this.power.eval(vars, options)) / Math.log(this.base.eval(vars, options));\n    },\n\n    codegen: function() {\n        return \"(Math.log(\" + this.power.codegen() +\n            \") / Math.log(\" + this.base.codegen() + \"))\";\n    },\n\n    print: function() {\n        var power = \"(\" + this.power.print() + \")\";\n        if (this.isNatural()) {\n            return \"ln\" + power;\n        } else {\n            return \"log_(\" + this.base.print() + \") \" + power;\n        }\n    },\n\n    tex: function() {\n        var power = \"(\" + this.power.tex() + \")\";\n        if (this.isNatural()) {\n            return \"\\\\ln\" + power;\n        } else {\n            return \"\\\\log_{\" + this.base.tex() + \"}\" + power;\n        }\n    },\n\n    collect: function(options) {\n        var log = this.recurse(\"collect\", options);\n\n        if (log.power instanceof Num && log.power.eval() === 1) {\n\n            // e.g. ln(1) -> 0\n            return Num.Zero;\n\n        } else if (log.base.equals(log.power)) {\n\n            // e.g. log_b(b) -> 1\n            return Num.One;\n\n        } else if (log.power instanceof Pow &&\n            log.power.base.equals(log.base)) {\n\n            // e.g. log_b(b^x) -> x\n            return log.power.exp;\n        } else {\n            return log;\n        }\n    },\n\n    expand: function() {\n        var log = this.recurse(\"expand\");\n\n        if (log.power instanceof Mul) {  // might want behind super-simplify() flag\n            // e.g. ln(xy) -> ln(x) + ln(y)\n\n            var terms = _.map(log.power.terms, function(term) {\n                // need to expand again in case new log powers are Pows\n                return new Log(log.base, term).expand();\n            });\n\n            return new Add(terms);\n\n        } else if (log.power instanceof Pow) {\n            // e.g. ln(x^y) -> y*ln(x)\n\n            return new Mul(log.power.exp, new Log(log.base, log.power.base).expand()).flatten();\n        } else if (!log.isNatural()) {\n            // e.g. log_b(x) -> ln(x)/ln(b)\n\n            return Mul.handleDivide(new Log(Const.e, log.power), new Log(Const.e, log.base));\n        } else {\n            return log;\n        }\n    },\n\n    hints: _.extend(Log.prototype.hints, {\n        open: false\n    }),\n\n    isPositive: function() {\n        var log = this.collect();\n\n        if (log.base instanceof Num &&\n            log.power instanceof Num) {\n            return this.eval() > 0;\n        } else {\n            return false;\n        }\n    },\n\n    needsExplicitMul: function() { return false; },\n\n    isNatural: function() { return this.base.equals(Const.e); }\n});\n\n_.extend(Log, {\n    natural: function() { return Const.e; },\n    common: function() { return Num.Ten; },\n\n    create: function(base, power) {\n        var log = new Log(base, power);\n        if (!power.hints.parens) {\n            log = log.addHint(\"open\");\n        }\n        return log;\n    }\n});\n\n\n/* trigonometric functions */\nfunction Trig(type, arg) { this.type = type; this.arg = arg; }\nTrig.prototype = new Expr();\n\n_.extend(Trig.prototype, {\n    func: Trig,\n    args: function() { return [this.type, this.arg]; },\n\n    functions: {\n        sin: {\n            eval: Math.sin,\n            codegen: \"Math.sin((\",\n            tex: \"\\\\sin\",\n            expand: function() { return this; }\n        },\n        cos: {\n            eval: Math.cos,\n            codegen: \"Math.cos((\",\n            tex: \"\\\\cos\",\n            expand: function() { return this; }\n        },\n        tan: {\n            eval: Math.tan,\n            codegen: \"Math.tan((\",\n            tex: \"\\\\tan\",\n            expand: function() {\n                return Mul.handleDivide(Trig.sin(this.arg), Trig.cos(this.arg));\n            }\n        },\n        csc: {\n            eval: function(arg) { return 1 / Math.sin(arg); },\n            codegen: \"(1/Math.sin(\",\n            tex: \"\\\\csc\",\n            expand: function() {\n                return Mul.handleDivide(Num.One, Trig.sin(this.arg));\n            }\n        },\n        sec: {\n            eval: function(arg) { return 1 / Math.cos(arg); },\n            codegen: \"(1/Math.cos(\",\n            tex: \"\\\\sec\",\n            expand: function() {\n                return Mul.handleDivide(Num.One, Trig.cos(this.arg));\n            }\n        },\n        cot: {\n            eval: function(arg) { return 1 / Math.tan(arg); },\n            codegen: \"(1/Math.tan(\",\n            tex: \"\\\\cot\",\n            expand: function() {\n                return Mul.handleDivide(Trig.cos(this.arg), Trig.sin(this.arg));\n            }\n        },\n        arcsin: {\n            eval: Math.asin,\n            codegen: \"Math.asin((\",\n            tex: \"\\\\arcsin\"\n        },\n        arccos: {\n            eval: Math.acos,\n            codegen: \"Math.acos((\",\n            tex: \"\\\\arccos\"\n        },\n        arctan: {\n            eval: Math.atan,\n            codegen: \"Math.atan((\",\n            tex: \"\\\\arctan\"\n        },\n        arccsc: {\n            eval: function(arg) { return Math.asin(1 / arg); },\n            codegen: \"Math.asin(1/(\",\n            tex: \"\\\\operatorname{arccsc}\"\n        },\n        arcsec: {\n            eval: function(arg) { return Math.acos(1 / arg); },\n            codegen: \"Math.acos(1/(\",\n            tex: \"\\\\operatorname{arcsec}\"\n        },\n        arccot: {\n            eval: function(arg) { return Math.atan(1 / arg); },\n            codegen: \"Math.atan(1/(\",\n            tex: \"\\\\operatorname{arccot}\"\n        },\n        sinh: {\n            eval: function(arg) {\n                return (Math.exp(arg) - Math.exp(-arg)) / 2;\n            },\n            codegen: function(argStr) {\n                return \"((Math.exp(\" + argStr + \") - Math.exp(-(\" + argStr + \"))) / 2)\";\n            },\n            tex: \"\\\\sinh\",\n            expand: function() { return this; }\n        },\n        cosh: {\n            eval: function(arg) {\n                return (Math.exp(arg) + Math.exp(-arg)) / 2;\n            },\n            codegen: function(argStr) {\n                return \"((Math.exp(\" + argStr + \") + Math.exp(-(\" + argStr + \"))) / 2)\";\n            },\n            tex: \"\\\\cosh\",\n            expand: function() { return this; }\n        },\n        tanh: {\n            eval: function(arg) {\n                return (Math.exp(arg) - Math.exp(-arg)) / (Math.exp(arg) + Math.exp(-arg));\n            },\n            codegen: function(argStr) {\n                return \"(\" +\n                    \"(Math.exp(\" + argStr + \") - Math.exp(-(\" + argStr + \")))\" +\n                    \" / \" +\n                    \"(Math.exp(\" + argStr + \") + Math.exp(-(\" + argStr + \")))\" +\n                    \")\";\n            },\n            tex: \"\\\\tanh\",\n            expand: function() {\n                return Mul.handleDivide(Trig.sinh(this.arg), Trig.cosh(this.arg));\n            }\n        },\n        csch: {\n            eval: function(arg) { return 2 / (Math.exp(arg) - Math.exp(-arg)); },\n            codegen: function(argStr) {\n                return \"(2 / (Math.exp(\" + argStr + \") - Math.exp(-(\" + argStr + \"))))\";\n            },\n            tex: \"\\\\csch\",\n            expand: function() {\n                return Mul.handleDivide(Num.One, Trig.sinh(this.arg));\n            }\n        },\n        sech: {\n            eval: function(arg) { return 2 / (Math.exp(arg) + Math.exp(-arg)); },\n            codegen: function(argStr) {\n                return \"(2 / (Math.exp(\" + argStr + \") + Math.exp(-(\" + argStr + \"))))\";\n            },\n            tex: \"\\\\sech\",\n            expand: function() {\n                return Mul.handleDivide(Num.One, Trig.cosh(this.arg));\n            }\n        },\n        coth: {\n            eval: function(arg) {\n                return (Math.exp(arg) + Math.exp(-arg)) / (Math.exp(arg) - Math.exp(-arg));\n            },\n            codegen: function(argStr) {\n                return \"(\" +\n                    \"(Math.exp(\" + argStr + \") + Math.exp(-(\" + argStr + \")))\" +\n                    \" / \" +\n                    \"(Math.exp(\" + argStr + \") - Math.exp(-(\" + argStr + \")))\" +\n                    \")\";\n            },\n            tex: \"\\\\coth\",\n            expand: function() {\n                return Mul.handleDivide(Trig.cosh(this.arg), Trig.sinh(this.arg));\n            }\n        },\n    },\n\n    isEven: function() {\n        return _.contains([\"cos\", \"sec\"], this.type);\n    },\n\n    isInverse: function() {\n        return this.type.indexOf(\"arc\") === 0;\n    },\n\n    isBasic: function() {\n        return _.contains([\"sin\", \"cos\"], this.type);\n    },\n\n    eval: function(vars, options) {\n        var func = this.functions[this.type].eval;\n        var arg = this.arg.eval(vars, options);\n        return func(arg);\n    },\n\n    codegen: function() {\n        var func = this.functions[this.type].codegen;\n        if (typeof func === \"function\") {\n            return func(this.arg.codegen());\n        } else if (typeof func === \"string\") {\n            return func + this.arg.codegen() + \"))\";\n        } else {\n            throw new Error(\"codegen not implemented for \" + this.type);\n        }\n    },\n\n    print: function() {\n        return this.type + \"(\" + this.arg.print() + \")\";\n    },\n\n    tex: function(options) {\n        var func = this.functions[this.type].tex;\n        var arg = \"(\" + this.arg.tex() + \")\";\n        return (options && options.split) ? [func, arg] : func + arg;\n    },\n\n    hints: _.extend(Trig.prototype.hints, {\n        open: false\n    }),\n\n    isPositive: function() {\n        var trig = this.collect();\n\n        if (trig.arg instanceof Num) {\n            return this.eval() > 0;\n        } else {\n            return false;\n        }\n    },\n\n    completeParse: function() {\n        if (this.exp) {\n            var pow = new Pow(this, this.exp);\n            this.exp = undefined;\n            return pow;\n        } else {\n            return this;\n        }\n    },\n\n    // TODO(alex): does every new node type need to redefine these?\n    needsExplicitMul: function() { return false; },\n\n    expand: function() {\n        var trig = this.recurse(\"expand\");\n        if (!trig.isInverse()) {\n            // e.g. tan(x) -> sin(x)/cos(x)\n            var expand = trig.functions[trig.type].expand;\n            return _.bind(expand, trig)();\n        } else {\n            return trig;\n        }\n    },\n\n    collect: function(options) {\n        var trig = this.recurse(\"collect\", options);\n        if (!trig.isInverse() && trig.arg.isNegative()) {\n            var arg;\n            if (trig.arg instanceof Num) {\n                arg = trig.arg.abs();\n            } else {\n                arg = Mul.handleDivide(trig.arg, Num.Neg).collect(options);\n            }\n\n            if (trig.isEven()) {\n                // e.g. cos(-x) -> cos(x)\n                return new Trig(trig.type, arg);\n\n            } else {\n                // e.g. sin(-x) -> -sin(x)\n                return new Mul(Num.Neg, new Trig(trig.type, arg));\n            }\n        } else {\n            return trig;\n        }\n    }\n});\n\n_.extend(Trig, {\n    create: function(pair, arg) {\n        var type = pair[0];\n        var exp = pair[1];\n\n        if (exp && exp.equals(Num.Neg)) {\n            // e.g. sin^-1(x) -> arcsin(x)\n            type = \"arc\" + type;\n            exp = undefined;\n        }\n\n        var trig = new Trig(type, arg);\n        if (!arg.hints.parens) {\n            trig = trig.addHint(\"open\");\n        }\n\n        if (exp) {\n            trig.exp = exp;\n        }\n\n        return trig;\n    },\n\n    sin: function(arg) {\n        return new Trig(\"sin\", arg);\n    },\n\n    cos: function(arg) {\n        return new Trig(\"cos\", arg);\n    },\n\n    sinh: function(arg) {\n        return new Trig(\"sinh\", arg);\n    },\n\n    cosh: function(arg) {\n        return new Trig(\"cosh\", arg);\n    }\n});\n\n\nfunction Abs(arg) { this.arg = arg; }\nAbs.prototype = new Expr();\n\n_.extend(Abs.prototype, {\n    func: Abs,\n    args: function() { return [this.arg]; },\n    eval: function(vars, options) { return Math.abs(this.arg.eval(vars, options)); },\n    codegen: function() { return \"Math.abs(\" + this.arg.codegen() + \")\"; },\n    print: function() { return \"abs(\" + this.arg.print() + \")\"; },\n\n    tex: function() {\n        return \"\\\\left|\" + this.arg.tex() + \"\\\\right|\";\n    },\n\n    collect: function(options) {\n        var abs = this.recurse(\"collect\", options);\n\n        if (abs.arg.isPositive()) {\n            // e.g. |2^x| -> 2^x\n            return abs.arg;\n        } else if (abs.arg instanceof Num) {\n            // e.g. |-2| -> 2\n            return abs.arg.abs();\n        } else if (abs.arg instanceof Mul) {\n            // e.g. |-2*pi*x| -> 2*pi*|x|\n            var terms = _.groupBy(abs.arg.terms, function(term) {\n                if (term.isPositive()) {\n                    return \"positive\";\n                } else if (term instanceof Num) {\n                    return \"number\";\n                } else {\n                    return \"other\";\n                }\n            });\n\n            var positives = terms.positive.concat(_.invoke(terms.number, \"abs\"));\n\n            if (terms.other.length) {\n                positives.push(new Abs(new Mul(terms.other).flatten()));\n            }\n\n            return new Mul(positives).flatten();\n        } else {\n            return abs;\n        }\n    },\n\n    // this should definitely be behind a super-simplify flag\n    expand: function() {\n        var abs = this.recurse(\"expand\");\n\n        if (abs.arg instanceof Mul) {\n            // e.g. |xyz| -> |x|*|y|*|z|\n            var terms = _.map(abs.arg.terms, function(term) {\n                return new Abs(term);\n            });\n            return new Mul(terms);\n        } else {\n            return abs;\n        }\n    },\n\n    isPositive: function() { return true; }\n});\n\n\n/* equation */\nfunction Eq(left, type, right) {\n    this.left = left;\n    this.type = type;\n    this.right = right;\n}\nEq.prototype = new Expr();\n\n_.extend(Eq.prototype, {\n    func: Eq,\n    args: function() { return [this.left, this.type, this.right]; },\n\n    needsExplicitMul: function() { return false; },\n\n    print: function() {\n        return this.left.print() + this.type + this.right.print();\n    },\n\n    signs: {\n        \"=\": \" = \",\n        \"<\": \" < \",\n        \">\": \" > \",\n        \"<>\": \" \\\\ne \",\n        \"<=\": \" \\\\le \",\n        \">=\": \" \\\\ge \"\n    },\n\n    tex: function() {\n        return this.left.tex() + this.signs[this.type] + this.right.tex();\n    },\n\n    normalize: function() {\n        var eq = this.recurse(\"normalize\");\n\n        if (_.contains([\">\", \">=\"], eq.type)) {\n            // inequalities should have the smaller side on the left\n            return new Eq(eq.right, eq.type.replace(\">\", \"<\"), eq.left);\n        } else {\n            return eq;\n        }\n    },\n\n    // convert this equation to an expression set to zero\n    // the expression is normalized to a canonical form\n    // e.g. y/2=x/4 -> y/2-x/4(=0) -> 2y-x(=0)\n    // unless unfactored is specified, will then divide through\n    asExpr: function(unfactored) {\n        var isZero = function(expr) {\n            return expr instanceof Num && expr.isSimple() && expr.eval() === 0;\n        };\n\n        // first convert to a sequence of additive terms\n        var terms = [];\n\n        if (this.left instanceof Add) {\n            terms = _.clone(this.left.terms);\n        } else if (!isZero(this.left)) {\n            terms = [this.left];\n        }\n\n        if (this.right instanceof Add) {\n            terms = terms.concat(this.right.negate().terms);\n        } else if (!isZero(this.right)) {\n            terms.push(this.right.negate());\n        }\n\n        var isInequality = !this.isEquality();\n\n        // Collect over each term individually to transform simple expressions\n        // into numbers that might have denominators, taking into account\n        // float precision. We have to be very careful to not introduce any\n        // irrational floats before asExpr() returns, because by definition\n        // they do not have exact denominators...\n        terms = _.invoke(terms, \"collect\", {preciseFloats: true});\n\n        // ...and we multiply through by every denominator.\n        for (var i = 0; i < terms.length; i++) {\n            var denominator = terms[i].getDenominator();\n\n            // Can't multiply inequalities by non 100% positive factors\n            if (isInequality && !denominator.isPositive()) {\n                denominator = denominator.asPositiveFactor();\n            }\n\n            if (!denominator.equals(Num.One)) {\n                terms = _.map(terms, function(term) {\n                    return Mul.createOrAppend(term, denominator).simplify({\n                        once: true,\n                        preciseFloats: true\n                    });\n                });\n            }\n        }\n\n        var add = new Add(terms).flatten();\n        return unfactored ? add : this.divideThrough(add);\n    },\n\n    // divide through by every common factor in the expression\n    // e.g. 2y-4x(=0) -> y-2x(=0)\n    // TODO(alex): Make it an option to only divide by variables/expressions\n    // guaranteed to be nonzero\n    divideThrough: function(expr) {\n        var isInequality = !this.isEquality();\n\n        var simplified = expr.simplify({once: true});\n        var factored = simplified.factor({keepNegative: isInequality});\n\n        if (!(factored instanceof Mul)) {\n            return expr;\n        }\n\n        var terms = factored.terms;\n\n        var isAdd = function(term) { return term instanceof Add; };\n        var hasVar = function(term) { return !!term.getVars().length; };\n        var isOne = function(term) { return term.equals(Num.One); };\n\n        var grouped = _.groupBy(terms, isAdd);\n        var adds = grouped[true] || [];\n        var others = grouped[false] || [];\n\n        if (adds.length && this.isEquality()) {\n            // keep only Adds\n            // e.g. 2xy(z+1)(=0) -> z+1(=0)\n            return new Mul(adds).flatten();\n        }\n\n        var denominator = others;\n\n        if (!adds.length) {\n            // if no Adds, keep all variable terms to preserve meaning\n            // e.g. 42xyz(=0) -> xyz(=0)\n            denominator = _.reject(denominator, hasVar);\n        }\n\n        if (isInequality) {\n            // can't divide inequalities by non 100% positive factors\n            // e.g. 42x^2y(z+1)(=0) -> y(z+1)(=0)\n            denominator = _.invoke(denominator, \"asPositiveFactor\");\n        }\n\n        // don't need to divide by one\n        denominator = _.reject(denominator, isOne);\n\n        denominator = _.map(denominator, function(term) {\n            return new Pow(term, Num.Div);\n        });\n\n        var dividedResult = new Mul(terms.concat(denominator)).collect();\n\n        // If the end result is the same as the original factoring,\n        // rollback the factoring and discard all intermediate steps.\n        if (dividedResult.equals(factored)) {\n            return simplified;\n        } else {\n            return dividedResult;\n        }\n    },\n\n    isEquality: function() {\n        return _.contains([\"=\", \"<>\"], this.type);\n    },\n\n    compare: function(other) {\n        // expression comparisons are handled by Expr.compare()\n        if (!(other instanceof Eq)) {\n            return false;\n        }\n\n        var eq1 = this.normalize();\n        var eq2 = other.normalize();\n\n        if (eq1.type !== eq2.type) {\n            return false;\n        }\n\n        // need to collect to properly factor out common factors\n        // e.g x+2x=6 -> 3x=6 -> 3x-6(=0) -> x-2(=0)\n        var expr1 = eq1.divideThrough(eq1.asExpr(/* unfactored */ true).collect());\n        var expr2 = eq2.divideThrough(eq2.asExpr(/* unfactored */ true).collect());\n\n        if (eq1.isEquality()) {\n            // equals and not-equals can be subtracted either way\n            return expr1.compare(expr2) ||\n                   expr1.compare(Mul.handleNegative(expr2));\n        } else {\n            return expr1.compare(expr2);\n        }\n    },\n\n    // should only be done after compare() returns true to avoid false positives\n    sameForm: function(other) {\n        var eq1 = this.normalize();\n        var eq2 = other.normalize();\n\n        var same = eq1.left.sameForm(eq2.left) && eq1.right.sameForm(eq2.right);\n\n        if (eq1.isEquality()) {\n            // equals and not-equals can be commutative with respect to the sign\n            return same || (eq1.left.sameForm(eq2.right) && eq1.right.sameForm(eq2.left));\n        } else {\n            return same;\n        }\n    },\n\n    // we don't want to override collect because it would turn y=x into y-x(=0)\n    // instead, we ask if the equation was in that form, would it be simplified?\n    isSimplified: function() {\n        var expr = this.asExpr(/* unfactored */ true);\n        var simplified = this.divideThrough(expr).simplify();\n        return expr.equals(simplified) &&\n               this.left.isSimplified() &&\n               this.right.isSimplified();\n    }\n});\n\n_.extend(Eq.prototype, {\n    // Assumptions: Expression is of the form a+bx, and we solve for x\n    solveLinearEquationForVariable: function(variable) {\n        var expr = this.asExpr();\n        if (!expr.is(Add) || expr.terms.length !== 2) {\n            throw new Error(\"Can only handle linear equations of the form \" +\n                            \"a + bx (= 0)\");\n        }\n\n        var hasVar = function(term) {\n            return term.has(Var) && _.contains(term.getVars(), variable.symbol);\n        };\n\n        var a, b;\n\n        if (hasVar(expr.terms[0])) {\n            a = Mul.handleNegative(expr.terms[1]);\n            b = Mul.handleDivide(expr.terms[0], variable);\n        } else {\n            a = Mul.handleNegative(expr.terms[0]);\n            b = Mul.handleDivide(expr.terms[1], variable);\n        }\n\n        return Mul.handleDivide(a, b).simplify();\n    }\n});\n\n\n/* abstract symbol node */\nfunction Symbol() {}\nSymbol.prototype = new Expr();\n\n_.extend(Symbol.prototype, {\n\n    needsExplicitMul: function() { return false; },\n\n    findGCD: function(factor) {\n        if (factor instanceof Symbol || factor instanceof Num) {\n            return this.equals(factor) ? this : Num.One;\n        } else {\n            return factor.findGCD(this);\n        }\n    }\n});\n\n\n/* function variable */\nfunction Func(symbol, arg) {\n    this.symbol = symbol; this.arg = arg;\n}\nFunc.prototype = new Symbol();\n\n_.extend(Func.prototype, {\n    func: Func,\n    args: function() { return [this.symbol, this.arg]; },\n\n    print: function() {\n        return this.symbol + \"(\" + this.arg.print() + \")\";\n    },\n\n    tex: function() {\n        return this.symbol + \"(\" + this.arg.tex() + \")\";\n    },\n\n    eval: function(vars, options) {\n        var arg = this.arg;\n        var func = vars[this.symbol];\n        var newVars = _.extend(_.clone(vars), {\n            x: arg.eval(vars, options)\n        });\n        var parsedFunc = KAS.parse(func, options);\n        if (parsedFunc.parsed) {\n            return parsedFunc.expr.eval(newVars, options);\n        }\n        // If parsedFunc isn't actually parsed, return its error\n        return parsedFunc;\n    },\n\n    codegen: function() {\n        return 'vars[\"' + this.symbol + '\"](' +\n            this.arg.codegen() + ')';\n    },\n\n    getUnits: function() {\n        return this.arg.getUnits();\n    },\n\n    getVars: function(excludeFunc) {\n        if (excludeFunc) {\n            return this.arg.getVars();\n        } else {\n            return _.union(this.arg.getVars(), [this.symbol]).sort();\n        }\n    },\n\n    getConsts: function() {\n        return this.arg.getConsts();\n    },\n});\n\n\n/* variable */\nfunction Var(symbol, subscript) {\n    this.symbol = symbol;\n    this.subscript = subscript;\n}\nVar.prototype = new Symbol();\n\n_.extend(Var.prototype, {\n    func: Var,\n    args: function() { return [this.symbol, this.subscript]; },\n\n    exprArgs: function() { return []; },\n    recurse: function() { return this; },\n\n    print: function() {\n        var sub = \"\";\n        if (this.subscript) {\n            sub = \"_(\" + this.subscript.print() + \")\";\n        }\n        return this.symbol + sub;\n    },\n\n    // Provide a way to easily evalate expressions with the common case,\n    // subscripts that consist of a single number or symbol e.g. x_a or x_42\n    prettyPrint: function() {\n        var sub = this.subscript;\n        if (sub && (sub instanceof Num || sub instanceof Symbol)) {\n            return this.symbol + \"_\" + sub.print();\n        } else {\n            return this.print();\n        }\n    },\n\n    tex: function() {\n        var sub = \"\";\n        if (this.subscript) {\n            sub = \"_{\" + this.subscript.tex() + \"}\";\n        }\n        var prefix = this.symbol.length > 1 ? \"\\\\\" : \"\";\n        return prefix + this.symbol + sub;\n    },\n\n    repr: function() { return \"Var(\" + this.print() + \")\"; },\n\n    eval: function(vars, options) {\n        return vars[this.prettyPrint()];\n    },\n\n    codegen: function() {\n        return 'vars[\"' + this.prettyPrint() + '\"]';\n    },\n\n    getVars: function() { return [this.prettyPrint()]; },\n\n    isPositive: function() { return false; }\n});\n\n\n/* constant */\nfunction Const(symbol) { this.symbol = symbol; }\nConst.prototype = new Symbol();\n\n_.extend(Const.prototype, {\n    func: Const,\n    args: function() { return [this.symbol]; },\n    recurse: function() { return this; },\n\n    eval: function(vars, options) {\n        if (this.symbol === \"pi\") {\n            return Math.PI;\n        } else if (this.symbol === \"e\") {\n            return Math.E;\n        }\n    },\n\n    codegen: function() {\n        if (this.symbol === \"pi\") {\n            return \"Math.PI\";\n        } else if (this.symbol === \"e\") {\n            return \"Math.E\";\n        }\n    },\n\n    print: function() { return this.symbol; },\n\n    tex: function() {\n        if (this.symbol === \"pi\") {\n            return \"\\\\pi \";\n        } else if (this.symbol === \"e\") {\n            return \"e\";\n        }\n    },\n\n    isPositive: function() {\n        return this.eval() > 0;\n    },\n\n    abs: function() {\n        if (this.eval() > 0) {\n            return this;\n        } else {\n            return Mul.handleNegative(this);\n        }\n    },\n\n    getConsts: function() {\n        return [this.print()];\n    },\n});\n\nConst.e = new Const(\"e\");\nConst.pi = new Const(\"pi\");\n\n\n/* abstract number node */\nfunction Num() {}\nNum.prototype = new Expr();\n\n_.extend(Num.prototype, {\n    repr: function() { return this.print(); },\n    strip: function() { return this.abs(); },\n    recurse: function() { return this; },\n    codegen: function() { return this.print(); },\n\n    // takes another Num and returns a new Num\n    add: abstract,\n    mul: abstract,\n\n    // returns this Num's additive inverse\n    negate: abstract,\n\n    isSubtract: function() { return this.hints.subtract; },\n\n    // return the absolute value of the number\n    abs: abstract,\n\n    needsExplicitMul: function() { return true; },\n\n    findGCD: abstract,\n\n    isPositive: function() {\n        return this.eval() > 0;\n    },\n\n    isNegative: function() {\n        return this.eval() < 0;\n    },\n\n    asPositiveFactor: function() {\n        return this.isPositive() ? this : this.abs();\n    },\n\n    // hints for interpreting and rendering user input\n    hints: _.extend(Num.prototype.hints, {\n        negate: false,\n        subtract: false,\n        divide: false,\n        root: false,\n        fraction: false,\n        entered: false\n    }),\n\n    // whether a number is considered simple (one term)\n    // e.g. for reals, ints and floats are simple\n    isSimple: abstract,\n\n    // Based on http://stackoverflow.com/a/10454560/2571482\n    getDecimalPlaces: function() {\n        var match = (\"\" + this.n).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\n        if (match) {\n            return Math.max(\n                0,\n                // Number of digits right of decimal point\n                (match[1] ? match[1].length : 0) -\n                // Adjust for scientific notation\n                (match[2] ? +match[2] : 0)\n            );\n        } else {\n            return 0;\n        }\n    },\n\n    asRational: abstract\n});\n\n\n/* rational number (n: numerator, d: denominator) */\nfunction Rational(numerator, denominator) {\n    var n = numerator; var d = denominator;\n    if (d < 0) {\n        n = -n; d = -d;\n    }\n    this.n = n; this.d = d;\n}\nRational.prototype = new Num();\n\n_.extend(Rational.prototype, {\n    func: Rational,\n    args: function() { return [this.n, this.d]; },\n    eval: function() { return this.n / this.d; },\n\n    print: function() {\n        return this.n.toString() + \"/\" + this.d.toString();\n    },\n\n    tex: function() {\n        var tex = \"\\\\frac{\" + Math.abs(this.n).toString() + \"}{\" + this.d.toString() + \"}\";\n        return this.n < 0 ? \"-\" + tex : tex;\n    },\n\n    add: function(num, options) {\n        if (num instanceof Rational) {\n            return new Rational(this.n * num.d + this.d * num.n, this.d * num.d).collect();\n        } else {\n            return num.add(this, options);\n        }\n    },\n\n    mul: function(num, options) {\n        if (num instanceof Rational) {\n            return new Rational(this.n * num.n, this.d * num.d).collect();\n        } else {\n            return num.mul(this, options);\n        }\n    },\n\n    collect: function() {\n        var gcd = Num.findGCD(this.n, this.d);\n\n        var n = this.n / gcd;\n        var d = this.d / gcd;\n\n        if (d === 1) {\n            return new Int(n);\n        } else {\n            return new Rational(n, d);\n        }\n    },\n\n    negate: function() {\n        return new Rational(-this.n, this.d);\n    },\n\n    abs: function() {\n        return new Rational(Math.abs(this.n), this.d);\n    },\n\n    findGCD: function(factor) {\n        // Attempt to factor out common numerators and denominators to return\n        // a Rational instead of a Float\n        if (factor instanceof Rational) {\n            // For more background, see\n            // http://math.stackexchange.com/questions/151081/gcd-of-rationals\n            var numerator = Num.findGCD(this.n * factor.d, factor.n * this.d);\n            var denominator = this.d * factor.d;\n            // Create the rational, then call .collect() to simplify it\n            return new Rational(numerator, denominator).collect();\n        } else if (factor instanceof Int) {\n            return new Rational(Num.findGCD(this.n, factor.n), this.d);\n        } else {\n            return factor.findGCD(this);\n        }\n    },\n\n    // for now, assuming that exp is a Num\n    raiseToThe: function(exp) {\n        if (exp instanceof Int) {\n            var positive = exp.eval() > 0;\n            var abs = exp.abs().eval();\n            var n = Math.pow(this.n, abs);\n            var d = Math.pow(this.d, abs);\n            if (positive) {\n                return new Rational(n, d).collect();\n            } else {\n                return new Rational(d, n).collect();\n            }\n        } else {\n            return new Float(this.eval()).raiseToThe(exp);\n        }\n    },\n\n    getDenominator: function() {\n        return new Int(this.d);\n    },\n\n    isSimple: function() { return false; },\n\n    asRational: function() { return this; }\n});\n\n\n/* integer (n: numerator/number) */\nfunction Int(number) { this.n = number; }\nInt.prototype = new Rational(0, 1);\n\n_.extend(Int.prototype, {\n    func: Int,\n    args: function() { return [this.n]; },\n    print: function() { return this.n.toString(); },\n    tex: function() { return this.n.toString(); },\n    negate: function() { return new Int(-this.n); },\n    abs: function() { return new Int(Math.abs(this.n)); },\n    isSimple: function() { return true; },\n    findGCD: function(factor) {\n        if (factor instanceof Int) {\n            return new Int(Num.findGCD(this.n, factor.n));\n        } else {\n            return factor.findGCD(this);\n        }\n    }\n});\n\n_.extend(Int, {\n    create: function(n) { return new Int(n).addHint(\"entered\"); }\n});\n\n/* float (n: number) */\nfunction Float(number) { this.n = number; }\nFloat.prototype = new Num();\n\n_.extend(Float.prototype, {\n    func: Float,\n    args: function() { return [this.n]; },\n    eval: function() { return this.n; },\n\n    // TODO(alex): when we internationalize number parsing/display\n    // we should make sure to use the appropriate decimal mark here\n    print: function() { return this.n.toString(); },\n    tex: function() { return this.n.toString(); },\n\n    add: function(num, options) {\n        if (options && options.preciseFloats) {\n            return Float.toDecimalPlaces(\n                this.n + num.eval(),\n                Math.max(this.getDecimalPlaces(), num.getDecimalPlaces())\n            );\n        } else {\n            return new Float(this.n + num.eval()).collect();\n        }\n    },\n\n    mul: function(num, options) {\n        if (options && options.preciseFloats) {\n            return Float.toDecimalPlaces(\n                this.n * num.eval(),\n                this.getDecimalPlaces() + num.getDecimalPlaces()\n            );\n        } else {\n            return new Float(this.n * num.eval()).collect();\n        }\n    },\n\n    collect: function() {\n        // We used to simplify Floats to Ints here whenever possible, but no\n        // longer do so in order to preserve significant figures.\n        return this;\n    },\n\n    negate: function() { return new Float(-this.n); },\n    abs: function() { return new Float(Math.abs(this.n)); },\n\n    findGCD: function(factor) {\n        if (factor instanceof Num) {\n            return new Float(Num.findGCD(this.eval(), factor.eval())).collect();\n        } else {\n            return factor.findGCD(this);\n        }\n    },\n\n    // for now, assuming that exp is a Num\n    raiseToThe: function(exp, options) {\n        if (options && options.preciseFloats &&\n                exp instanceof Int && exp.n > 1) {\n            return Float.toDecimalPlaces(\n                new Pow(this, exp).eval(),\n                this.getDecimalPlaces() * exp.n\n            );\n        } else {\n            return new Float(new Pow(this, exp).eval()).collect();\n        }\n    },\n\n    // only to be used on non-repeating decimals (e.g. user-provided)\n    asRational: function() {\n        var parts = this.n.toString().split(\".\");\n        if (parts.length === 1) {\n            return new Rational(this.n, 1);\n        } else {\n            var numerator = Number(parts.join(\"\"));\n            var denominator = Math.pow(10, parts[1].length);\n            return new Rational(numerator, denominator).collect();\n        }\n    },\n\n    getDenominator: function() {\n        return this.asRational().getDenominator();\n    },\n\n    isSimple: function() { return true; }\n});\n\n_.extend(Float, {\n    create: function(n) { return new Float(n).addHint(\"entered\"); },\n\n    // Account for floating point imprecision by explicitly controlling the\n    // number of decimal places in common operations (e.g. +, *, ^)\n    toDecimalPlaces: function(n, places) {\n        return new Float(+n.toFixed(Math.min(places, 20))).collect();\n    }\n});\n\n// static methods and fields that are best defined on Num\n_.extend(Num, {\n    negativeOne: function(hint) {\n        if (hint === \"subtract\") {\n            return Num.Sub;\n        } else if (hint === \"divide\") {\n            return Num.Div;\n        } else {\n            return Num.Neg;\n        }\n    },\n\n    // find the greatest common denominator\n    findGCD: function(a, b) {\n        var mod;\n\n        a = Math.abs(a);\n        b = Math.abs(b);\n\n        // Euclid's method doesn't handle non-integers very well. For now\n        // we just say we can't pull out a common factor. It might be\n        // reasonable to do better than this in the future.\n        if (a !== Math.floor(a) || b !== Math.floor(b)) {\n            return 1;\n        }\n\n        while (b) {\n            mod = a % b;\n            a = b;\n            b = mod;\n        }\n\n        return a;\n    },\n\n    min: function() {\n        return _.min(_.toArray(arguments), function(num) {\n            return num.eval();\n        });\n    },\n\n    max: function() {\n        return _.max(_.toArray(arguments), function(num) {\n            return num.eval();\n        });\n    }\n});\n\nNum.Neg = new Int(-1).addHint(\"negate\");\nNum.Sub = new Int(-1).addHint(\"subtract\");\nNum.Div = new Int(-1).addHint(\"divide\");\n\nNum.Sqrt = new Rational(1, 2).addHint(\"root\");\n\nNum.Zero = new Int(0);\nNum.One = new Int(1);\nNum.Ten = new Int(10);\n\n\n// set identities here\nAdd.prototype.identity = Num.Zero;\nMul.prototype.identity = Num.One;\n\n\nvar parser = KAS.parser;\n\nvar parseError = function(str, hash) {\n    // return int location of parsing error\n    throw new Error(hash.loc.first_column);\n};\n\n// expose concrete nodes to parser scope\n// see http://zaach.github.io/jison/docs/#sharing-scope\nparser.yy = {\n    Add: Add,\n    Mul: Mul,\n    Pow: Pow,\n    Log: Log,\n    Trig: Trig,\n    Eq: Eq,\n    Abs: Abs,\n    Func: Func,\n    Const: Const,\n    Var: Var,\n    Int: Int,\n    Float: Float,\n    parseError: parseError,\n\n    constants: [\"e\"],\n    symbolLexer: function(symbol) {\n        if (_.contains(parser.yy.constants, symbol)) {\n            return \"CONST\";\n        } else if (_.contains(parser.yy.functions, symbol)) {\n            return \"FUNC\";\n        } else {\n            return \"VAR\";\n        }\n    }\n};\n\nKAS.parse = function(input, options) {\n    try {\n        if (options && options.functions) {\n            // reserve the symbol \"i\" for complex numbers\n            parser.yy.functions = _.without(options.functions, \"i\");\n        } else {\n            parser.yy.functions = [];\n        }\n\n        // If ',' is the decimal dividor in your country, replace any ','s\n        // with '.'s.\n        // This isn't perfect, since the output will all still have '.'s.\n        // TODO(jack): Fix the output to have ','s in this case\n        if (options && options.decimal_separator) {\n            input = input.split(options.decimal_separator).join(\".\");\n        }\n\n        var expr = parser.parse(input).completeParse();\n        return { parsed: true, expr: expr };\n    } catch (e) {\n        return { parsed: false, error: e.message };\n    }\n};\n\n/* unit */\nfunction Unit(symbol) {\n    this.symbol = symbol;\n}\nUnit.prototype = new Symbol();\n\n// If possible, replace unit prefixes with a multiplication.\n//\n// \"g\" -> Unit(\"g\")\n// \"kg\" -> 1000 * Unit(\"g\")\nvar unprefixify = function(symbol) {\n    if (_.has(baseUnits, symbol) || _.has(derivedUnits, symbol)) {\n        return new Unit(symbol);\n    }\n\n    // check for prefix\n    var prefix = Object.keys(siPrefixes).find(function(testPrefix) {\n        return new RegExp(\"^\" + testPrefix).test(symbol);\n    });\n\n    if (prefix) {\n        var base = symbol.replace(new RegExp(\"^\" + prefix), \"\");\n\n        // It's okay to be here if either:\n        // * `base` is a base unit (the seven units listed in baseUnits)\n        // * `base` is a derived unit which allows prefixes\n        //\n        // Otherwise, we're trying to parse a unit label which is not\n        // allowed (mwk, mBTU, etc).\n        if (_.has(baseUnits, base) ||\n            (derivedUnits[base] &&\n             derivedUnits[base].prefixes === hasPrefixes)) {\n\n            return new Mul(siPrefixes[prefix], new Unit(base));\n        } else {\n            throw new Error(base + \" does not allow prefixes\");\n        }\n    } else {\n        return new Unit(symbol);\n    }\n};\n\nKAS.unitParse = function(input) {\n    try {\n        var parseResult = KAS.unitParser.parse(input);\n\n        // parseResult looks like:\n        // {\n        //   magnitude: \"5\",\n        //   unit: {\n        //     num: [\n        //       { name: \"s\", pow: 2 }\n        //     ],\n        //     denom: [\n        //       { name: \"kg\", pow: 1 }\n        //     ]\n        //   }\n        // }\n        //\n        // denom is optionally null\n\n        var unitArray = [];\n\n        parseResult.unit.num.forEach(function(unitSpec) {\n            unitArray.push(\n                new Pow(unprefixify(unitSpec.name), new Int(unitSpec.pow))\n            );\n        });\n\n        parseResult.unit.denom.forEach(function(unitSpec) {\n            unitArray.push(\n                new Pow(unprefixify(unitSpec.name), new Int(-1 * unitSpec.pow))\n            );\n        });\n\n        var unit = new Mul(unitArray).flatten();\n\n        if (parseResult.type === \"unitMagnitude\") {\n            // in the first case we have a magnitude coefficient as well as the\n            // unit itself.\n            var coefArray =\n                [new Float(+parseResult.magnitude)].concat(unitArray);\n            var expr = new Mul(coefArray);\n            return {\n                parsed: true,\n                unit: unit,\n                expr: expr,\n                coefficient: parseResult.magnitude,\n                type: parseResult.type\n            };\n        } else {\n\n            // in the second case it's just the unit with no magnitude.\n            return {\n                parsed: true,\n                unit: unit,\n                type: parseResult.type,\n            };\n        }\n    } catch (e) {\n        return { parsed: false, error: e.message };\n    }\n};\n\n_.extend(Unit.prototype, {\n    func: Unit,\n    args: function() { return [this.symbol]; },\n    recurse: function() { return this; },\n\n    eval: function(vars, options) {\n        // This is called when comparing units. A unit doesn't affect the\n        // numerical value of its coefficient, so this needs to be 1.\n        //\n        // On the other hand, things must not evaluate to the same thing if\n        // they don't have the same type. I believe that's also true - form is\n        // checked before numerical equivalence. I do not know where, though.\n        // However, there are a couple tests checking this.\n        return 1;\n    },\n\n    getUnits: function() { return [{ unit: this.symbol, pow: 1 }]; },\n\n    codegen: function() { return \"1\"; },\n\n    print: function() { return this.symbol; },\n\n    tex: function() { return this.symbol; },\n\n    // Simplify units by replacing prefixes with multiplication\n    collect: function(options) {\n        if (_.has(baseUnits, this.symbol)) {\n            return this;\n        } else if (_.has(derivedUnits, this.symbol)) {\n            return derivedUnits[this.symbol].conversion;\n        } else {\n            throw new Error(\"could not understand unit: \" + this.symbol);\n        }\n    },\n});\n\nvar baseUnits = {\n    m: new Unit(\"m\"),\n    // Note: kg is the SI base unit but we use g for consistency\n    g: new Unit(\"g\"),\n    s: new Unit(\"s\"),\n    A: new Unit(\"A\"),\n    K: new Unit(\"K\"),\n    mol: new Unit(\"mol\"),\n    cd: new Unit(\"cd\"),\n};\n\nvar siPrefixes = {\n    a: new Pow(new Int(10), new Int(-18)),\n    f: new Pow(new Int(10), new Int(-15)),\n    p: new Pow(new Int(10), new Int(-12)),\n    n: new Pow(new Int(10), new Int(-9)),\n    u: new Pow(new Int(10), new Int(-6)),\n    m: new Pow(new Int(10), new Int(-3)),\n    c: new Pow(new Int(10), new Int(-2)),\n    d: new Pow(new Int(10), new Int(-1)),\n    da: new Int(10),\n    h: new Pow(new Int(10), new Int(2)),\n    k: new Pow(new Int(10), new Int(3)),\n    M: new Pow(new Int(10), new Int(6)),\n    G: new Pow(new Int(10), new Int(9)),\n    T: new Pow(new Int(10), new Int(12)),\n    P: new Pow(new Int(10), new Int(15)),\n    E: new Pow(new Int(10), new Int(18)),\n    // http://en.wikipedia.org/wiki/Metric_prefix#.22Hella.22_prefix_proposal\n    hella: new Pow(new Int(10), new Int(27)),\n};\n\n// Use these two values to mark a unit as either SI-prefixable or not.\nvar hasPrefixes = {};\nvar hasntPrefixes = {};\n\nvar makeAlias = function(str, prefixes) {\n    var splits = str.split(\"|\");\n    var coefficientStr = splits[0].trim();\n    var unitsStr = splits[1].trim();\n\n    var coefficient = Num.One;\n    if (coefficientStr !== \"\") {\n        coefficient = KAS.parse(coefficientStr).expr;\n    }\n\n    var numdenomStr = unitsStr.split(\"/\");\n    var numdenom = [coefficient];\n\n    if (numdenomStr[0]) {\n        numdenomStr[0]\n            .split(\" \")\n            .filter(function(x) {\n                return x !== \"\";\n            }).map(function(x) {\n                numdenom.push(new Unit(x));\n            });\n    }\n\n    if (numdenomStr[1]) {\n        numdenomStr[1]\n            .split(\" \")\n            .filter(function(x) {\n                return x !== \"\";\n            }).map(function(x) {\n                numdenom.push(new Pow(new Unit(x), Num.Div));\n            });\n    }\n\n    return {\n        conversion: new Mul(numdenom),\n        prefixes: prefixes,\n    };\n};\n\n// This is a mapping of derived units (or different names for a unit) to their\n// definitions. For example, an inch is defined as 0.0254 m.\n//\n// Definitions don't need to be in terms of base units. For example, tsp is\n// defined in terms of tbsp (which is defined in terms of cup -> gal -> L ->\n// m^3). However, units must get simpler. I.e. there's no loop checking.\n//\n// makeAlias takes two parameters:\n// * a string specifying the simplification to perform\n//   - a required pipe separates the constant factor from the base units\n//   - the constant factor is parsed by KAS\n//   - the base units are in a simple format which disallows exponents and\n//     requires multiplicands to be space-separated (\"m m\" rather than \"m^2)\n//     with an optional \"/\" separating numerator and denominator\n//   - prefixes are not allowed to be used in the converted to units\n//     (note that this restriction, the format of the string, and the choice to\n//     use a string in the first place are made out of laziness to minimize\n//     both typing and parsing)\n// * a boolean specifying whether or not it's acceptable to use SI units\n//\n// Where possible, these units are taken from \"The International System of\n// Units (SI)\" 8th edition (2006).\nvar derivedUnits = {\n    // mass\n    // The atomic mass unit / dalton.\n    Da: makeAlias(\"1.6605388628 x 10^-24 | g\", hasPrefixes),\n    u: makeAlias(\"| Da\", hasntPrefixes),\n\n    // length\n    \"meter\": makeAlias(\"| m\", hasntPrefixes),\n    \"meters\": makeAlias(\"| m\", hasntPrefixes),\n    \"in\": makeAlias(\"254 / 10000 | m\", hasntPrefixes),\n    \"ft\": makeAlias(\"3048  / 10000 | m\", hasntPrefixes),\n    \"yd\": makeAlias(\"9144  / 10000 | m\", hasntPrefixes),\n    \"mi\": makeAlias(\"1609344 / 1000 | m\", hasntPrefixes),\n    \"ly\": makeAlias(\"9.4607 x 10^15 | m\", hasntPrefixes),\n    \"nmi\": makeAlias(\"1852 | m\", hasntPrefixes),\n    \"\": makeAlias(\"10^-10 | m\", hasntPrefixes),\n    \"pc\": makeAlias(\"3.0857 x 10^16 | m\", hasntPrefixes),\n\n    // time\n    \"min\": makeAlias(\"60 | s\", hasntPrefixes),\n    \"hr\": makeAlias(\"3600 | s\", hasntPrefixes),\n    \"sec\": makeAlias(\"| s\", hasntPrefixes),\n    // TODO(joel) make day work\n    \"day\": makeAlias(\"86400 | s\", hasntPrefixes),\n    \"wk\": makeAlias(\"604800 | s\", hasntPrefixes),\n    \"fortnight\": makeAlias(\"14 | day\", hasntPrefixes),\n    \"shake\": makeAlias(\"10^-8 | s\", hasntPrefixes),\n    \"olympiad\": makeAlias(\"126200000 | s\", hasntPrefixes),\n\n    // temperature\n    \"C\": makeAlias(\"1 | K\", hasntPrefixes),\n    \"F\": makeAlias(\"5/9 | K\", hasntPrefixes),\n    \"R\": makeAlias(\"5/9 | K\", hasntPrefixes),\n\n    // electric charge\n    \"e\": makeAlias(\"1.6021765314 x 10^-19 | C\", hasntPrefixes),\n\n    // speed\n    \"c\": makeAlias(\"299792458 | m / s\", hasntPrefixes),\n    \"kn\": makeAlias(\"514/1000 | m / s\", hasntPrefixes),\n    \"kt\": makeAlias(\"| kn\", hasntPrefixes),\n    \"knot\": makeAlias(\"| kn\", hasntPrefixes),\n\n    // energy\n    \"J\": makeAlias(\"| N m\", hasPrefixes),\n    \"BTU\": makeAlias(\"1060 | J\", hasntPrefixes),\n    \"cal\": makeAlias(\"4184 / 1000 | J\", hasPrefixes),\n    \"eV\": makeAlias(\"1.602176514 x 10^-19 | J\", hasPrefixes),\n    \"erg\": makeAlias(\"10^7 | J\", hasPrefixes),\n\n    // power\n    \"W\": makeAlias(\"| J / s\", hasPrefixes),\n    \"H-e\": makeAlias(\"80 | W\", hasntPrefixes),\n\n    // force\n    \"N\": makeAlias(\"1000 | g m / s s\", hasPrefixes),\n    // \"lb\": makeAlias(\"4448 / 1000 | N\", hasntPrefixes),\n    // 4.4482216152605\n    \"lb\": makeAlias(\"4448221615 / 1000000000 | N\", hasntPrefixes),\n    \"dyn\": makeAlias(\"10^-5 | N\", hasntPrefixes),\n\n    // pressure\n    \"Pa\": makeAlias(\"1 | N / m m m\", hasPrefixes),\n    \"bar\": makeAlias(\"10^5 | Pa\", hasPrefixes),\n    \"\": makeAlias(\"1/1000 | bar\", hasntPrefixes),\n    \"\": makeAlias(\"| bar\", hasntPrefixes),\n    \"atm\": makeAlias(\"101325 | Pa\", hasntPrefixes),\n    \"Torr\": makeAlias(\"1/760 | atm\", hasntPrefixes),\n    \"mmHg\": makeAlias(\"| Torr\", hasntPrefixes),\n\n    // area\n    \"ha\": makeAlias(\"10^4 | m m\", hasntPrefixes),\n    \"b\": makeAlias(\"10^28 | m m\", hasPrefixes),\n    \"barn\": makeAlias(\"| b\", hasPrefixes),\n    \"acre\": makeAlias(\"4046.87 | m m\", hasntPrefixes),\n    \"skilodge\": makeAlias(\"10^-31 | m m\", hasntPrefixes),\n    \"outhouse\": makeAlias(\"10^-34 | m m\", hasntPrefixes),\n    \"shed\": makeAlias(\"10^-52 | m m\", hasntPrefixes),\n\n    // volume\n    \"L\": makeAlias(\"1/1000 | m m m\", hasPrefixes),\n    \"gal\": makeAlias(\"3785/1000 | L\", hasPrefixes),\n    \"cup\": makeAlias(\"1/16 | gal\", hasntPrefixes),\n    \"qt\": makeAlias(\"1/4 | gal\", hasntPrefixes),\n    \"quart\": makeAlias(\"| qt\", hasntPrefixes),\n    \"p\": makeAlias(\"1/8 | gal\", hasntPrefixes),\n    \"pt\": makeAlias(\"| p\", hasntPrefixes),\n    \"pint\": makeAlias(\"| p\", hasntPrefixes),\n    \"fl oz\": makeAlias(\"1/8 | cup\", hasntPrefixes),\n    \"fl. oz.\": makeAlias(\"1/8 | cup\", hasntPrefixes),\n    \"tbsp\": makeAlias(\"1/16 | cup\", hasntPrefixes),\n    \"tsp\": makeAlias(\"1/3 | tbsp\", hasntPrefixes),\n\n    // rotational\n    // \"rad\":\n    \"rev\": makeAlias(\"2 pi | rad\", hasntPrefixes),\n    \"deg\": makeAlias(\"180 pi | rad\", hasntPrefixes),\n    \"\": makeAlias(\"| deg\", hasntPrefixes),\n    \"arcminute\": makeAlias(\"1/60 | deg\", hasntPrefixes),\n    \"arcsec\": makeAlias(\"1/3600 | deg\", hasntPrefixes),\n\n    // dimensionless\n    // \"B\": makeAlias(\"10 | dB\", hasntPrefixes), // XXX danger - logarithmic\n    // \"dB\"\n    // \"nP\"\n    \"Hu\": makeAlias(\"1000 | dB\", hasPrefixes),\n    \"dozen\": makeAlias(\"12 |\", hasntPrefixes),\n    // XXX\n    \"mol\": makeAlias(\"6.0221412927 x 10^23 |\", hasPrefixes),\n    \"%\": makeAlias(\"1/100 |\", hasntPrefixes),\n    \"percent\": makeAlias(\"| %\", hasntPrefixes),\n    \"ppm\": makeAlias(\"1/1000000 |\", hasntPrefixes),\n\n    // electric / magnetic\n    \"V\": makeAlias(\"1000 | g m m / s s C\", hasPrefixes),\n    \"C\": makeAlias(\"| A s\", hasPrefixes),\n    \"ampere\": makeAlias(\"| A\", hasntPrefixes),\n    \"\": makeAlias(\"| V / A\", hasPrefixes),\n    \"ohm\": makeAlias(\"| \", hasntPrefixes),\n    \"F\": makeAlias(\"| C / V\", hasPrefixes),\n    \"H\": makeAlias(\"| ohm s\", hasPrefixes),\n    \"T\": makeAlias(\"1000 | g / C s\", hasPrefixes),\n    \"Wb\": makeAlias(\"1000 | g m m / C s\", hasPrefixes),\n\n    // photometry\n    // TODO not sure this is right\n    \"lm\": makeAlias(\"pi x 10^4 | cd / m m\", hasntPrefixes),\n    \"lx\": makeAlias(\"| lm / m m\", hasntPrefixes),\n    \"nit\": makeAlias(\"| cd / m m\", hasntPrefixes),\n    \"sb\": makeAlias(\"10^4 | cd / m m\", hasntPrefixes),\n    \"stilb\": makeAlias(\"1 | sb\", hasntPrefixes),\n    \"apostilb\": makeAlias(\"1 / pi x 10^(-4) | sb\", hasntPrefixes),\n    \"blondel\": makeAlias(\"| apostilb\", hasntPrefixes),\n    \"asb\": makeAlias(\"| apostilb\", hasntPrefixes),\n    \"la\": makeAlias(\"| lm\", hasntPrefixes),\n    \"Lb\": makeAlias(\"| lm\", hasntPrefixes),\n    \"sk\": makeAlias(\"10^-7 | lm\", hasntPrefixes),\n    \"skot\": makeAlias(\"| sk\", hasntPrefixes),\n    \"bril\": makeAlias(\"10^-11 | lm\", hasntPrefixes),\n\n    // other\n    \"Hz\": makeAlias(\"| / s\", hasPrefixes),\n};\n\nKAS.Add = Add;\nKAS.Mul = Mul;\nKAS.Pow = Pow;\nKAS.Log = Log;\nKAS.Eq = Eq;\nKAS.Trig = Trig;\nKAS.Abs = Abs;\nKAS.Func = Func;\nKAS.Var = Var;\nKAS.Const = Const;\nKAS.Unit = Unit;\nKAS.Rational = Rational;\nKAS.Int = Int;\nKAS.Float = Float;\nKAS.Zero = Num.Zero;\nKAS.One = Num.One;\n\n})(KAS);\n\n/* TODO(charlie): fix these lint errors (http://eslint.org/docs/rules): */\n/* eslint-disable no-var, no-undef, comma-dangle, indent, max-len */\n\n(function(KAS) {\n\n// assumes that both expressions have already been parsed\n// TODO(alex): be able to pass a random() function to compare()\nKAS.compare = function(expr1, expr2, options) {\n    var defaults = {\n        form: false,        // check that the two expressions have the same form\n        simplify: false     // check that the second expression is simplified\n    };\n\n    /* more possible options:\n        allow ratios e.g. 3/1 and 3 should both be accepted for something like slope\n        allow student to choose their own variables names\n    */\n\n    if (options !== undefined) {\n        options = _.extend(defaults, options);\n    } else {\n        options = defaults;\n    }\n\n    // variable check\n    var vars = expr1.sameVars(expr2);\n    if (!vars.equal) {\n        var message = null;\n        if (vars.equalIgnoringCase) {\n            message = \"Some of your variables are in the wrong case (upper vs. lower).\";\n        }\n        return {equal: false, message: message};\n    }\n\n    // semantic check\n    if (!expr1.compare(expr2)) {\n        return {equal: false, message: null};\n    }\n\n    // syntactic check\n    if (options.form && !expr1.sameForm(expr2)) {\n        return {equal: false, message: \"Your answer is not in the correct form.\"};\n    }\n\n    // syntactic check\n    if (options.simplify && !expr1.isSimplified()) {\n        return {equal: false, message: \"Your answer is not fully expanded and simplified.\"};\n    }\n\n    return {equal: true, message: null};\n};\n\n})(KAS);\nexport default KAS;\n","import _kmath from \"kmath\";\nimport _underscore from \"underscore\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst knumber = _kmath.number;\n\nconst KhanMath = {\n    // Simplify formulas before display\n    cleanMath: function(expr) {\n        return typeof expr === \"string\"\n            ? expr\n                  .replace(/\\+\\s*-/g, \"- \")\n                  .replace(/-\\s*-/g, \"+ \")\n                  .replace(/\\^1/g, \"\")\n            : expr;\n    },\n\n    // Bound a number by 1e-6 and 1e20 to avoid exponents after toString\n    bound: function(num) {\n        if (num === 0) {\n            return num;\n        } else if (num < 0) {\n            return -KhanMath.bound(-num);\n        } else {\n            return Math.max(1e-6, Math.min(num, 1e20));\n        }\n    },\n\n    factorial: function(x) {\n        if (x <= 1) {\n            return x;\n        } else {\n            return x * KhanMath.factorial(x - 1);\n        }\n    },\n\n    getGCD: function(a, b) {\n        if (arguments.length > 2) {\n            const rest = [].slice.call(arguments, 1);\n            return KhanMath.getGCD(a, KhanMath.getGCD(...rest));\n        } else {\n            let mod;\n\n            a = Math.abs(a);\n            b = Math.abs(b);\n\n            while (b) {\n                mod = a % b;\n                a = b;\n                b = mod;\n            }\n\n            return a;\n        }\n    },\n\n    getLCM: function(a, b) {\n        if (arguments.length > 2) {\n            const rest = [].slice.call(arguments, 1);\n            return KhanMath.getLCM(a, KhanMath.getLCM(...rest));\n        } else {\n            return Math.abs(a * b) / KhanMath.getGCD(a, b);\n        }\n    },\n\n    primes: [\n        2,\n        3,\n        5,\n        7,\n        11,\n        13,\n        17,\n        19,\n        23,\n        29,\n        31,\n        37,\n        41,\n        43,\n        47,\n        53,\n        59,\n        61,\n        67,\n        71,\n        73,\n        79,\n        83,\n        89,\n        97,\n    ],\n\n    isPrime: function(n) {\n        if (n <= 1) {\n            return false;\n        } else if (n < 101) {\n            return !!$.grep(KhanMath.primes, function(p, i) {\n                return Math.abs(p - n) <= 0.5;\n            }).length;\n        } else {\n            if (n <= 1 || (n > 2 && n % 2 === 0)) {\n                return false;\n            } else {\n                for (let i = 3, sqrt = Math.sqrt(n); i <= sqrt; i += 2) {\n                    if (n % i === 0) {\n                        return false;\n                    }\n                }\n            }\n\n            return true;\n        }\n    },\n\n    getPrimeFactorization: function(number) {\n        if (number === 1) {\n            return [];\n        } else if (KhanMath.isPrime(number)) {\n            return [number];\n        }\n\n        const maxf = Math.sqrt(number);\n        for (let f = 2; f <= maxf; f++) {\n            if (number % f === 0) {\n                return $.merge(\n                    KhanMath.getPrimeFactorization(f),\n                    KhanMath.getPrimeFactorization(number / f)\n                );\n            }\n        }\n    },\n\n    // Round a number to the nearest increment\n    // E.g., if increment = 30 and num = 40, return 30. if increment = 30 and\n    //     num = 45, return 60.\n    roundToNearest: function(increment, num) {\n        return Math.round(num / increment) * increment;\n    },\n\n    // Round a number to a certain number of decimal places\n    roundTo: function(precision, num) {\n        const factor = Math.pow(10, precision).toFixed(5);\n        return Math.round((num * factor).toFixed(5)) / factor;\n    },\n\n    /**\n     * Return a string of num rounded to a fixed precision decimal places,\n     * with an approx symbol if num had to be rounded, and trailing 0s\n     */\n    toFixedApprox: function(num, precision) {\n        // TODO(aria): Make this locale-dependent like KhanUtil.localeToFixed\n        const fixedStr = num.toFixed(precision);\n        if (knumber.equal(+fixedStr, num)) {\n            return fixedStr;\n        } else {\n            return \"\\\\approx \" + fixedStr;\n        }\n    },\n\n    /**\n     * Return a string of num rounded to precision decimal places, with an\n     * approx symbol if num had to be rounded, but no trailing 0s if it was\n     * not rounded.\n     */\n    roundToApprox: function(num, precision) {\n        const fixed = KhanMath.roundTo(precision, num);\n        if (knumber.equal(fixed, num)) {\n            return String(fixed);\n        } else {\n            return KhanMath.toFixedApprox(num, precision);\n        }\n    },\n\n    // toFraction(4/8) => [1, 2]\n    // toFraction(0.666) => [333, 500]\n    // toFraction(0.666, 0.001) => [2, 3]\n    //\n    // tolerance can't be bigger than 1, sorry\n    toFraction: function(decimal, tolerance) {\n        if (tolerance == null) {\n            tolerance = Math.pow(2, -46);\n        }\n\n        if (decimal < 0 || decimal > 1) {\n            let fract = decimal % 1;\n            fract += fract < 0 ? 1 : 0;\n\n            const nd = KhanMath.toFraction(fract, tolerance);\n            nd[0] += Math.round(decimal - fract) * nd[1];\n            return nd;\n        } else if (\n            Math.abs(Math.round(Number(decimal)) - decimal) <= tolerance\n        ) {\n            return [Math.round(decimal), 1];\n        } else {\n            let loN = 0;\n            let loD = 1;\n            let hiN = 1;\n            let hiD = 1;\n            let midN = 1;\n            let midD = 2;\n\n            while (true) { // eslint-disable-line no-constant-condition\n                if (Math.abs(Number(midN / midD) - decimal) <= tolerance) {\n                    return [midN, midD];\n                } else if (midN / midD < decimal) {\n                    loN = midN;\n                    loD = midD;\n                } else {\n                    hiN = midN;\n                    hiD = midD;\n                }\n\n                midN = loN + hiN;\n                midD = loD + hiD;\n            }\n        }\n    },\n\n    // Returns the format (string) of a given numeric string\n    // Note: purposively more inclusive than answer-types' predicate.forms\n    // That is, it is not necessarily true that interpreted input are numeric\n    getNumericFormat: function(text) {\n        text = $.trim(text);\n        text = text.replace(/\\u2212/, \"-\").replace(/([+-])\\s+/g, \"$1\");\n        if (text.match(/^[+-]?\\d+$/)) {\n            return \"integer\";\n        } else if (text.match(/^[+-]?\\d+\\s+\\d+\\s*\\/\\s*\\d+$/)) {\n            return \"mixed\";\n        }\n        const fraction = text.match(/^[+-]?(\\d+)\\s*\\/\\s*(\\d+)$/);\n        if (fraction) {\n            return parseFloat(fraction[1]) > parseFloat(fraction[2])\n                ? \"improper\"\n                : \"proper\";\n        } else if (text.replace(/[,. ]/g, \"\").match(/^\\d+$/)) {\n            return \"decimal\";\n        } else if (text.match(/(pi?|\\u03c0|t(?:au)?|\\u03c4|pau)/)) {\n            return \"pi\";\n        } else {\n            return null;\n        }\n    },\n\n    // Returns a string of the number in a specified format\n    toNumericString: function(number, format) {\n        if (number == null) {\n            return \"\";\n        } else if (number === 0) {\n            return \"0\"; // otherwise it might end up as 0% or 0pi\n        }\n\n        if (format === \"percent\") {\n            return number * 100 + \"%\";\n        }\n\n        if (format === \"pi\") {\n            const fraction = knumber.toFraction(number / Math.PI);\n            const numerator = Math.abs(fraction[0]);\n            const denominator = fraction[1];\n            if (knumber.isInteger(numerator)) {\n                const sign = number < 0 ? \"-\" : \"\";\n                const pi = \"\\u03C0\";\n                return (\n                    sign +\n                    (numerator === 1 ? \"\" : numerator) +\n                    pi +\n                    (denominator === 1 ? \"\" : \"/\" + denominator)\n                );\n            }\n        }\n\n        if ([\"proper\", \"improper\", \"mixed\", \"fraction\"].includes(format)) {\n            const fraction = knumber.toFraction(number);\n            const numerator = Math.abs(fraction[0]);\n            const denominator = fraction[1];\n            const sign = number < 0 ? \"-\" : \"\";\n            if (denominator === 1) {\n                return sign + numerator; // for integers, irrational, d > 1000\n            } else if (format === \"mixed\") {\n                const modulus = numerator % denominator;\n                const integer = (numerator - modulus) / denominator;\n                return (\n                    sign +\n                    (integer ? integer + \" \" : \"\") +\n                    modulus +\n                    \"/\" +\n                    denominator\n                );\n            } // otherwise proper, improper, or fraction\n            return sign + numerator + \"/\" + denominator;\n        }\n\n        // otherwise (decimal, float, long long)\n        return String(number);\n    },\n};\n\n_module_.exports = KhanMath;\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport _mathJs from \"./math.js\";\nimport _underscore from \"underscore\";\nimport _jquery from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* global i18n:false */\n\nconst $ = _jquery;\nconst _ = _underscore;\n\nconst KhanMath = _mathJs;\n\nconst MAXERROR_EPSILON = Math.pow(2, -42);\n\n/*\n * Answer types\n *\n * Utility for creating answerable questions displayed in exercises\n *\n * Different answer types produce different kinds of input displays, and do\n * different kinds of checking on the solutions.\n *\n * Each of the objects contain two functions, setup and createValidator.\n *\n * The setup function takes a solutionarea and solution, and performs setup\n * within the solutionarea, and then returns an object which contains:\n *\n * answer: a function which, when called, will retrieve the current answer from\n *         the solutionarea, which can then be validated using the validator\n *         function\n * validator: a function returned from the createValidator function (defined\n *            below)\n * solution: the correct answer to the problem\n * showGuess: a function which, when given a guess, shows the guess within the\n *            provided solutionarea\n * showGuessCustom: a function which displays parts of a guess that are not\n *                  within the solutionarea; currently only used for custom\n *                  answers\n *\n * The createValidator function only takes a solution, and it returns a\n * function which can be used to validate an answer.\n *\n * The resulting validator function returns:\n * - true: if the answer is fully correct\n * - false: if the answer is incorrect\n * - \"\" (the empty string): if no answer has been provided (e.g. the answer box\n *   is left unfilled)\n * - a string: if there is some slight error\n *\n * In most cases, setup and createValidator don't really need the solution DOM\n * element so we have setupFunctional and createValidatorFunctional for them\n * which take only $solution.text() and $solution.data(). This makes it easier\n * to reuse specific answer types.\n *\n * TODO(alpert): Think of a less-absurd name for createValidatorFunctional.\n *\n */\n\nconst KhanAnswerTypes = {\n    /*\n     * predicate answer type\n     *\n     * performs simple predicate-based checking of a numeric solution, with\n     * different kinds of number formats\n     *\n     * Uses the data-forms option on the solution to choose which number formats\n     * are acceptable. Available data-forms:\n     *\n     * - integer:  3\n     * - proper:   3/5\n     * - improper: 5/3\n     * - pi:       3 pi\n     * - log:      log(5)\n     * - percent:  15%\n     * - mixed:    1 1/3\n     * - decimal:  1.7\n     *\n     * The solution should be a predicate of the form:\n     *\n     * function(guess, maxError) {\n     *     return abs(guess - 3) < maxError;\n     * }\n     *\n     */\n    predicate: {\n        defaultForms: \"integer, proper, improper, mixed, decimal\",\n        createValidatorFunctional: function(predicate, options) {\n            // Extract the options from the given solution object\n            options = _.extend(\n                {\n                    simplify: \"required\",\n                    ratio: false,\n                    forms: KhanAnswerTypes.predicate.defaultForms,\n                },\n                options\n            );\n            let acceptableForms;\n            // this is maintaining backwards compatibility\n            // TODO(merlob) fix all places that depend on this, then delete\n            if (!_.isArray(options.forms)) {\n                acceptableForms = options.forms.split(/\\s*,\\s*/);\n            } else {\n                acceptableForms = options.forms;\n            }\n\n            // TODO(jack): remove options.inexact in favor of options.maxError\n            if (options.inexact === undefined) {\n                // If we aren't allowing inexact, ensure that we don't have a\n                // large maxError as well.\n                options.maxError = 0;\n            }\n            // Allow a small tolerance on maxError, to avoid numerical\n            // representation issues (2.3 should be correct for a solution of\n            // 2.45 with maxError=0.15).\n            options.maxError = +options.maxError + MAXERROR_EPSILON;\n\n            // If percent is an acceptable form, make sure it's the last one\n            // in the list so we don't prematurely complain about not having\n            // a percent sign when the user entered the correct answer in a\n            // different form (such as a decimal or fraction)\n            if (_.contains(acceptableForms, \"percent\")) {\n                acceptableForms = _.without(acceptableForms, \"percent\");\n                acceptableForms.push(\"percent\");\n            }\n\n            // Take text looking like a fraction, and turn it into a number\n            const fractionTransformer = function(text) {\n                text = text\n                    // Replace unicode minus sign with hyphen\n                    .replace(/\\u2212/, \"-\")\n                    // Remove space after +, -\n                    .replace(/([+-])\\s+/g, \"$1\")\n                    // Remove leading/trailing whitespace\n                    .replace(/(^\\s*)|(\\s*$)/gi, \"\");\n\n                // Extract numerator and denominator\n                const match = text.match(/^([+-]?\\d+)\\s*\\/\\s*([+-]?\\d+)$/);\n                const parsedInt = parseInt(text, 10);\n                if (match) {\n                    const num = parseFloat(match[1]);\n                    const denom = parseFloat(match[2]);\n                    const simplified =\n                        denom > 0 &&\n                        (options.ratio || match[2] !== \"1\") &&\n                        KhanMath.getGCD(num, denom) === 1;\n                    return [\n                        {\n                            value: num / denom,\n                            exact: simplified,\n                        },\n                    ];\n                } else if (!isNaN(parsedInt) && \"\" + parsedInt === text) {\n                    return [\n                        {\n                            value: parsedInt,\n                            exact: true,\n                        },\n                    ];\n                }\n\n                return [];\n            };\n\n            /*\n             * Different forms of numbers\n             *\n             * Each function returns a list of objects of the form:\n             *\n             * {\n             *    value: numerical value,\n             *    exact: true/false\n             * }\n             */\n            const forms = {\n                // integer, which is encompassed by decimal\n                integer: function(text) {\n                    // Compare the decimal form to the decimal form rounded to\n                    // an integer. Only accept if the user actually entered an\n                    // integer.\n                    const decimal = forms.decimal(text);\n                    const rounded = forms.decimal(text, 1);\n                    if (\n                        (decimal[0].value != null &&\n                            decimal[0].value === rounded[0].value) ||\n                        (decimal[1].value != null &&\n                            decimal[1].value === rounded[1].value)\n                    ) {\n                        return decimal;\n                    }\n                    return [];\n                },\n\n                // A proper fraction\n                proper: function(text) {\n                    return $.map(fractionTransformer(text), function(o) {\n                        // All fractions that are less than 1\n                        if (Math.abs(o.value) < 1) {\n                            return [o];\n                        } else {\n                            return [];\n                        }\n                    });\n                },\n\n                // an improper fraction\n                improper: function(text) {\n                    return $.map(fractionTransformer(text), function(o) {\n                        // All fractions that are greater than 1\n                        if (Math.abs(o.value) >= 1) {\n                            return [o];\n                        } else {\n                            return [];\n                        }\n                    });\n                },\n\n                // pi-like numbers\n                pi: function(text) {\n                    let match;\n                    let possibilities = [];\n\n                    // Replace unicode minus sign with hyphen\n                    text = text.replace(/\\u2212/, \"-\");\n\n                    // - pi\n                    // (Note: we also support \\pi (for TeX), p, tau (and \\tau,\n                    // and t), pau.)\n                    if (\n                        (match = text.match(\n                            /^([+-]?)\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)$/i\n                        ))\n                    ) {\n                        possibilities = [\n                            {\n                                value: parseFloat(match[1] + \"1\"),\n                                exact: true,\n                            },\n                        ];\n\n                        // 5 / 6 pi\n                    } else if (\n                        (match = text.match(\n                            /^([+-]?\\s*\\d+\\s*(?:\\/\\s*[+-]?\\s*\\d+)?)\\s*\\*?\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)$/i // eslint-disable-line max-len\n                        ))\n                    ) {\n                        possibilities = fractionTransformer(match[1]);\n\n                        // 4 5 / 6 pi\n                    } else if (\n                        (match = text.match(\n                            /^([+-]?)\\s*(\\d+)\\s*([+-]?\\d+)\\s*\\/\\s*([+-]?\\d+)\\s*\\*?\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)$/i // eslint-disable-line max-len\n                        ))\n                    ) {\n                        const sign = parseFloat(match[1] + \"1\");\n                        const integ = parseFloat(match[2]);\n                        const num = parseFloat(match[3]);\n                        const denom = parseFloat(match[4]);\n                        const simplified =\n                            num < denom && KhanMath.getGCD(num, denom) === 1;\n\n                        possibilities = [\n                            {\n                                value: sign * (integ + num / denom),\n                                exact: simplified,\n                            },\n                        ];\n\n                        // 5 pi / 6\n                    } else if (\n                        (match = text.match(\n                            /^([+-]?\\s*\\d+)\\s*\\*?\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)\\s*(?:\\/\\s*([+-]?\\s*\\d+))?$/i // eslint-disable-line max-len\n                        ))\n                    ) {\n                        possibilities = fractionTransformer(\n                            match[1] + \"/\" + match[3]\n                        );\n\n                        // - pi / 4\n                    } else if (\n                        (match = text.match(\n                            /^([+-]?)\\s*\\*?\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)\\s*(?:\\/\\s*([+-]?\\d+))?$/i // eslint-disable-line max-len\n                        ))\n                    ) {\n                        possibilities = fractionTransformer(\n                            match[1] + \"1/\" + match[3]\n                        );\n\n                        // 0\n                    } else if (text === \"0\") {\n                        possibilities = [{value: 0, exact: true}];\n\n                        // 0.5 pi (fallback)\n                    } else if (\n                        (match = text.match(\n                            /^(.+)\\s*\\*?\\s*(\\\\?pi|p|\\u03c0|\\\\?tau|t|\\u03c4|pau)$/i // eslint-disable-line max-len\n                        ))\n                    ) {\n                        possibilities = forms.decimal(match[1]);\n                    } else {\n                        possibilities = _.reduce(\n                            KhanAnswerTypes.predicate.defaultForms.split(\n                                /\\s*,\\s*/\n                            ),\n                            function(memo, form) {\n                                return memo.concat(forms[form](text));\n                            },\n                            []\n                        );\n\n                        // If the answer is a floating point number that's\n                        // near a multiple of pi, mark is as being possibly\n                        // an approximation of pi.  We actually check if\n                        // it's a plausible approximation of pi/12, since\n                        // sometimes the correct answer is like pi/3 or pi/4.\n                        // We also say it's a pi-approximation if it involves\n                        // x/7 (since 22/7 is an approximation of pi.)\n                        // Never mark an integer as being an approximation\n                        // of pi.\n                        let approximatesPi = false;\n                        const number = parseFloat(text);\n                        if (!isNaN(number) && number !== parseInt(text)) {\n                            const piMult = Math.PI / 12;\n                            const roundedNumber =\n                                piMult * Math.round(number / piMult);\n                            if (Math.abs(number - roundedNumber) < 0.01) {\n                                approximatesPi = true;\n                            }\n                        } else if (text.match(/\\/\\s*7/)) {\n                            approximatesPi = true;\n                        }\n                        if (approximatesPi) {\n                            _.each(possibilities, function(possibility) {\n                                possibility.piApprox = true;\n                            });\n                        }\n                        return possibilities;\n                    }\n\n                    let multiplier = Math.PI;\n                    if (text.match(/\\\\?tau|t|\\u03c4/)) {\n                        multiplier = Math.PI * 2;\n                    }\n\n                    // We're taking an early stand along side xkcd in the\n                    // inevitable ti vs. pau debate... http://xkcd.com/1292\n                    if (text.match(/pau/)) {\n                        multiplier = Math.PI * 1.5;\n                    }\n\n                    $.each(possibilities, function(ix, possibility) {\n                        possibility.value *= multiplier;\n                    });\n                    return possibilities;\n                },\n\n                // Converts '' to 1 and '-' to -1 so you can write \"[___] x\"\n                // and accept sane things\n                coefficient: function(text) {\n                    let possibilities = [];\n\n                    // Replace unicode minus sign with hyphen\n                    text = text.replace(/\\u2212/, \"-\");\n\n                    if (text === \"\") {\n                        possibilities = [{value: 1, exact: true}];\n                    } else if (text === \"-\") {\n                        possibilities = [{value: -1, exact: true}];\n                    }\n                    return possibilities;\n                },\n\n                // simple log(c) form\n                log: function(text) {\n                    let match;\n                    let possibilities = [];\n\n                    // Replace unicode minus sign with hyphen\n                    text = text.replace(/\\u2212/, \"-\");\n                    text = text.replace(/[ \\(\\)]/g, \"\");\n\n                    if ((match = text.match(/^log\\s*(\\S+)\\s*$/i))) {\n                        possibilities = forms.decimal(match[1]);\n                    } else if (text === \"0\") {\n                        possibilities = [{value: 0, exact: true}];\n                    }\n                    return possibilities;\n                },\n\n                // Numbers with percent signs\n                percent: function(text) {\n                    text = $.trim(text);\n                    // store whether or not there is a percent sign\n                    let hasPercentSign = false;\n\n                    if (text.indexOf(\"%\") === text.length - 1) {\n                        text = $.trim(text.substring(0, text.length - 1));\n                        hasPercentSign = true;\n                    }\n\n                    const transformed = forms.decimal(text);\n                    $.each(transformed, function(ix, t) {\n                        t.exact = hasPercentSign;\n                        t.value = t.value / 100;\n                    });\n                    return transformed;\n                },\n\n                // Mixed numbers, like 1 3/4\n                mixed: function(text) {\n                    const match = text\n                        // Replace unicode minus sign with hyphen\n                        .replace(/\\u2212/, \"-\")\n                        // Remove space after +, -\n                        .replace(/([+-])\\s+/g, \"$1\")\n                        // Extract integer, numerator and denominator\n                        .match(/^([+-]?)(\\d+)\\s+(\\d+)\\s*\\/\\s*(\\d+)$/);\n\n                    if (match) {\n                        const sign = parseFloat(match[1] + \"1\");\n                        const integ = parseFloat(match[2]);\n                        const num = parseFloat(match[3]);\n                        const denom = parseFloat(match[4]);\n                        const simplified =\n                            num < denom && KhanMath.getGCD(num, denom) === 1;\n\n                        return [\n                            {\n                                value: sign * (integ + num / denom),\n                                exact: simplified,\n                            },\n                        ];\n                    }\n\n                    return [];\n                },\n\n                // Decimal numbers -- compare entered text rounded to\n                // 'precision' Reciprical of the precision against the correct\n                // answer. We round to 1/1e10 by default, which is healthily\n                // less than machine epsilon but should be more than any real\n                // decimal answer would use. (The 'integer' answer type uses\n                // precision == 1.)\n                decimal: function(text, precision) {\n                    if (precision == null) {\n                        precision = 1e10;\n                    }\n\n                    const normal = function(text) {\n                        text = $.trim(text);\n\n                        const match = text\n                            // Replace unicode minus sign with hyphen\n                            .replace(/\\u2212/, \"-\")\n                            // Remove space after +, -\n                            .replace(/([+-])\\s+/g, \"$1\")\n                            // Extract integer, numerator and denominator. If\n                            // commas or spaces are used, they must be in the\n                            // \"correct\" places\n                            .match(\n                                /^([+-]?(?:\\d{1,3}(?:[, ]?\\d{3})*\\.?|\\d{0,3}(?:[, ]?\\d{3})*\\.(?:\\d{3}[, ]?)*\\d{1,3}))$/ // eslint-disable-line max-len\n                            );\n\n                        // You can't start a number with `0,`, to prevent us\n                        // interpeting '0.342' as correct for '342'\n                        const badLeadingZero = text.match(/^0[0,]*,/);\n\n                        if (match && !badLeadingZero) {\n                            let x = parseFloat(match[1].replace(/[, ]/g, \"\"));\n\n                            if (options.inexact === undefined) {\n                                x = Math.round(x * precision) / precision;\n                            }\n\n                            return x;\n                        }\n                    };\n\n                    const commas = function(text) {\n                        text = text.replace(/([\\.,])/g, function(_, c) {\n                            return c === \".\" ? \",\" : \".\";\n                        });\n                        return normal(text);\n                    };\n\n                    return [\n                        {value: normal(text), exact: true},\n                        {value: commas(text), exact: true},\n                    ];\n                },\n            };\n\n            // validator function\n            return function(guess) {\n                // The fallback variable is used in place of the answer, if no\n                // answer is provided (i.e. the field is left blank)\n                const fallback =\n                    options.fallback != null ? \"\" + options.fallback : \"\";\n\n                guess = $.trim(guess) || fallback;\n                const score = {\n                    empty: guess === \"\",\n                    correct: false,\n                    message: null,\n                    guess: guess,\n                };\n\n                // iterate over all the acceptable forms, and if one of the\n                // answers is correct, return true\n                $.each(acceptableForms, function(i, form) {\n                    const transformed = forms[form](guess);\n\n                    for (let j = 0, l = transformed.length; j < l; j++) {\n                        const val = transformed[j].value;\n                        const exact = transformed[j].exact;\n                        const piApprox = transformed[j].piApprox;\n                        // If a string was returned, and it exactly matches,\n                        // return true\n                        if (predicate(val, options.maxError)) {\n                            // If the exact correct number was returned,\n                            // return true\n                            if (exact || options.simplify === \"optional\") {\n                                score.correct = true;\n                                score.message = options.message || null;\n                                // If the answer is correct, don't say it's\n                                // empty. This happens, for example, with the\n                                // coefficient type where guess === \"\" but is\n                                // interpreted as \"1\" which is correct.\n                                score.empty = false;\n                            } else if (form === \"percent\") {\n                                // Otherwise, an error was returned\n                                score.empty = true;\n                                score.message = i18n._(\n                                    \"Your answer is almost correct, \" +\n                                        \"but it is missing a \" +\n                                        \"<code>\\\\%</code> at the end.\"\n                                );\n                            } else {\n                                if (options.simplify !== \"enforced\") {\n                                    score.empty = true;\n                                }\n                                score.message = i18n._(\n                                    \"Your answer is almost correct, \" +\n                                        \"but it needs to be simplified.\"\n                                );\n                            }\n\n                            return false;\n                        } else if (\n                            piApprox &&\n                            predicate(val, Math.abs(val * 0.001))\n                        ) {\n                            score.empty = true;\n                            score.message = i18n._(\n                                \"Your answer is close, but you may \" +\n                                    \"have approximated pi. Enter your \" +\n                                    \"answer as a multiple of pi, like \" +\n                                    \"<code>12\\\\ \\\\text{pi}</code> or \" +\n                                    \"<code>2/3\\\\ \\\\text{pi}</code>\"\n                            );\n                        }\n                    }\n                });\n\n                if (score.correct === false) {\n                    let interpretedGuess = false;\n                    _.each(forms, function(form) {\n                        const anyAreNaN = _.any(form(guess), function(t) {\n                            return t.value != null && !_.isNaN(t.value);\n                        });\n\n                        if (anyAreNaN) {\n                            interpretedGuess = true;\n                        }\n                    });\n                    if (!interpretedGuess) {\n                        score.empty = true;\n                        score.message = i18n._(\n                            \"We could not understand your \" +\n                                \"answer. Please check your answer for extra \" +\n                                \"text or symbols.\"\n                        );\n                        return score;\n                    }\n                }\n\n                return score;\n            };\n        },\n    },\n\n    /*\n     * number answer type\n     *\n     * wraps the predicate answer type to performs simple number-based checking\n     * of a solution\n     */\n    number: {\n        convertToPredicate: function(correct, options) {\n            // TODO(alpert): Don't think this $.trim is necessary\n            const correctFloat = parseFloat($.trim(correct));\n\n            return [\n                function(guess, maxError) {\n                    return Math.abs(guess - correctFloat) < maxError;\n                },\n                $.extend({}, options, {type: \"predicate\"}),\n            ];\n        },\n        createValidatorFunctional: function(correct, options) {\n            return KhanAnswerTypes.predicate.createValidatorFunctional(\n                ...KhanAnswerTypes.number.convertToPredicate(correct, options)\n            );\n        },\n    },\n\n    /*\n     * The expression answer type parses a given expression or equation\n     * and semantically compares it to the solution. In addition, instant\n     * feedback is provided by rendering the last answer that fully parsed.\n     *\n     * Parsing options:\n     * functions (e.g. data-functions=\"f g h\")\n     *     A space or comma separated list of single-letter variables that\n     *     should be interpreted as functions. Case sensitive. \"e\" and \"i\"\n     *     are reserved.\n     *\n     *     no functions specified: f(x+y) == fx + fy\n     *     with \"f\" as a function: f(x+y) != fx + fy\n     *\n     * Comparison options:\n     * same-form (e.g. data-same-form)\n     *     If present, the answer must match the solution's structure in\n     *     addition to evaluating the same. Commutativity and excess negation\n     *     are ignored, but all other changes will trigger a rejection. Useful\n     *     for requiring a particular form of an equation, or if the answer\n     *     must be factored.\n     *\n     *     example question:    Factor x^2 + x - 2\n     *     example solution:    (x-1)(x+2)\n     *     accepted answers:    (x-1)(x+2), (x+2)(x-1), ---(-x-2)(-1+x), etc.\n     *     rejected answers:    x^2+x-2, x*x+x-2, x(x+1)-2, (x-1)(x+2)^1, etc.\n     *     rejection message:   Your answer is not in the correct form\n     *\n     * simplify (e.g. data-simplify)\n     *     If present, the answer must be fully expanded and simplified. Use\n     *     carefully - simplification is hard and there may be bugs, or you\n     *     might not agree on the definition of \"simplified\" used. You will\n     *     get an error if the provided solution is not itself fully expanded\n     *     and simplified.\n     *\n     *     example question:    Simplify ((n*x^5)^5) / (n^(-2)*x^2)^-3\n     *     example solution:    x^31 / n\n     *     accepted answers:    x^31 / n, x^31 / n^1, x^31 * n^(-1), etc.\n     *     rejected answers:    (x^25 * n^5) / (x^(-6) * n^6), etc.\n     *     rejection message:   Your answer is not fully expanded and simplified\n     *\n     * Rendering options:\n     * times (e.g. data-times)\n     *     If present, explicit multiplication (such as between numbers) will\n     *     be rendered with a cross/x symbol (TeX: \\times) instead of the usual\n     *     center dot (TeX: \\cdot).\n     *\n     *     normal rendering:    2 * 3^x -> 2 \\cdot 3^{x}\n     *     but with \"times\":    2 * 3^x -> 2 \\times 3^{x}\n     */\n    expression: {\n        parseSolution: function(solutionString, options) {\n            let solution = KAS.parse(solutionString, options);\n            if (!solution.parsed) {\n                throw new Error(\n                    \"The provided solution (\" +\n                        solutionString +\n                        \") didn't parse.\"\n                );\n            } else if (options.simplified && !solution.expr.isSimplified()) {\n                throw new Error(\n                    \"The provided solution (\" +\n                        solutionString +\n                        \") isn't fully expanded and simplified.\"\n                );\n            } else {\n                solution = solution.expr;\n            }\n            return solution;\n        },\n\n        createValidatorFunctional: function(solution, options) {\n            return function(guess) {\n                const score = {\n                    empty: false,\n                    correct: false,\n                    message: null,\n                    guess: guess,\n                };\n                // Don't bother parsing an empty input\n                if (!guess) {\n                    score.empty = true;\n                    return score;\n                }\n\n                const answer = KAS.parse(guess, options);\n\n                // An unsuccessful parse doesn't count as wrong\n                if (!answer.parsed) {\n                    score.empty = true;\n                    return score;\n                }\n\n                // Solution will need to be parsed again if we're creating\n                // this from a multiple question type\n                if (typeof solution === \"string\") {\n                    solution = KhanAnswerTypes.expression.parseSolution(\n                        solution,\n                        options\n                    );\n                }\n\n                const result = KAS.compare(answer.expr, solution, options);\n\n                if (result.equal) {\n                    // Correct answer\n                    score.correct = true;\n                } else if (result.message) {\n                    // Nearly correct answer\n                    score.message = result.message;\n                } else {\n                    // Replace x with * and see if it would have been correct\n                    const answerX = KAS.parse(\n                        guess.replace(/[xX]/g, \"*\"),\n                        options\n                    );\n                    if (answerX.parsed) {\n                        const resultX = KAS.compare(\n                            answerX.expr,\n                            solution,\n                            options\n                        );\n                        if (resultX.equal) {\n                            score.empty = true;\n                            score.message =\n                                \"I'm a computer. I only \" +\n                                \"understand multiplication if you use an \" +\n                                \"asterisk (*) as the multiplication sign.\";\n                        } else if (resultX.message) {\n                            score.message =\n                                resultX.message +\n                                \" Also, \" +\n                                \"I'm a computer. I only \" +\n                                \"understand multiplication if you use an \" +\n                                \"asterisk (*) as the multiplication sign.\";\n                        }\n                    }\n                }\n                return score;\n            };\n        },\n    },\n};\n\n_module_.exports = KhanAnswerTypes;\nexport default _module_.exports;\n","import { getRealImageUrl } from \"./util/svg-image-utils.js\";\nimport _utilAnswerTypesJs from \"./util/answer-types.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, indent, max-len, no-var, one-var, prefer-spread */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst _ = _underscore;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\n\nconst nestedMap = function(children, func, context) {\n    if (_.isArray(children)) {\n        return _.map(children, function(child) {\n            return nestedMap(child, func);\n        });\n    } else {\n        return func.call(context, children);\n    }\n};\n\nconst Util = {\n    /**\n     * Used to compare equality of two input paths, which are represented as\n     * arrays of strings.\n     */\n    inputPathsEqual(a, b) {\n        if (a == null || b == null) {\n            return a == null === (b == null);\n        }\n\n        return a.length === b.length &&\n        a.every((item, index) => {\n            return b[index] === item;\n        });\n    },\n\n    nestedMap: nestedMap,\n\n    rWidgetParts: /^\\[\\[\\u2603 (([a-z-]+) ([0-9]+))\\]\\]$/,\n    rWidgetRule: /^\\[\\[\\u2603 (([a-z-]+) ([0-9]+))\\]\\]/,\n    rTypeFromWidgetId: /^([a-z-]+) ([0-9]+)$/,\n    snowman: \"\\u2603\",\n\n    noScore: {\n        type: \"points\",\n        earned: 0,\n        total: 0,\n        message: null,\n    },\n\n    seededRNG: function(seed) {\n        var randomSeed = seed;\n\n        return function() {\n            // Robert Jenkins' 32 bit integer hash function.\n            var seed = randomSeed;\n            seed = (seed + 0x7ed55d16 + (seed << 12)) & 0xffffffff;\n            seed = (seed ^ 0xc761c23c ^ (seed >>> 19)) & 0xffffffff;\n            seed = (seed + 0x165667b1 + (seed << 5)) & 0xffffffff;\n            seed = ((seed + 0xd3a2646c) ^ (seed << 9)) & 0xffffffff;\n            seed = (seed + 0xfd7046c5 + (seed << 3)) & 0xffffffff;\n            seed = (seed ^ 0xb55a4f09 ^ (seed >>> 16)) & 0xffffffff;\n            return (randomSeed = seed & 0xfffffff) / 0x10000000;\n        };\n    },\n\n    // Shuffle an array using a given random seed or function.\n    // If `ensurePermuted` is true, the input and ouput are guaranteed to be\n    // distinct permutations.\n    shuffle: function(array, randomSeed, ensurePermuted) {\n        // Always return a copy of the input array\n        var shuffled = _.clone(array);\n\n        // Handle edge cases (input array is empty or uniform)\n        if (\n            !shuffled.length ||\n            _.all(shuffled, function(value) {\n                return _.isEqual(value, shuffled[0]);\n            })\n        ) {\n            return shuffled;\n        }\n\n        var random;\n        if (_.isFunction(randomSeed)) {\n            random = randomSeed;\n        } else {\n            random = Util.seededRNG(randomSeed);\n        }\n\n        do {\n            // Fischer-Yates shuffle\n            for (var top = shuffled.length; top > 0; top--) {\n                var newEnd = Math.floor(random() * top),\n                    temp = shuffled[newEnd];\n\n                shuffled[newEnd] = shuffled[top - 1];\n                shuffled[top - 1] = temp;\n            }\n        } while (ensurePermuted && _.isEqual(array, shuffled));\n\n        return shuffled;\n    },\n\n    // In IE8, split doesn't work right. Implement it ourselves.\n    split: \"x\".split(/(.)/g).length\n        ? function(str, r) {\n              return str.split(r);\n          }\n        : function(str, r) {\n              // Based on Steven Levithan's MIT-licensed split, available at\n              // http://blog.stevenlevithan.com/archives/cross-browser-split\n              var output = [];\n              var lastIndex = (r.lastIndex = 0);\n              var match;\n\n              while ((match = r.exec(str))) {\n                  output.push(str.slice(lastIndex, match.index));\n                  output.push.apply(output, match.slice(1));\n                  lastIndex = match.index + match[0].length;\n              }\n\n              output.push(str.slice(lastIndex));\n              return output;\n          },\n\n    /**\n     * Given two score objects for two different widgets, combine them so that\n     * if one is wrong, the total score is wrong, etc.\n     */\n    combineScores: function(scoreA, scoreB) {\n        var message;\n\n        if (scoreA.type === \"points\" && scoreB.type === \"points\") {\n            if (\n                scoreA.message &&\n                scoreB.message &&\n                scoreA.message !== scoreB.message\n            ) {\n                // TODO(alpert): Figure out how to combine messages usefully\n                message = null;\n            } else {\n                message = scoreA.message || scoreB.message;\n            }\n\n            return {\n                type: \"points\",\n                earned: scoreA.earned + scoreB.earned,\n                total: scoreA.total + scoreB.total,\n                message: message,\n            };\n        } else if (scoreA.type === \"points\" && scoreB.type === \"invalid\") {\n            return scoreB;\n        } else if (scoreA.type === \"invalid\" && scoreB.type === \"points\") {\n            return scoreA;\n        } else if (scoreA.type === \"invalid\" && scoreB.type === \"invalid\") {\n            if (\n                scoreA.message &&\n                scoreB.message &&\n                scoreA.message !== scoreB.message\n            ) {\n                // TODO(alpert): Figure out how to combine messages usefully\n                message = null;\n            } else {\n                message = scoreA.message || scoreB.message;\n            }\n\n            return {\n                type: \"invalid\",\n                message: message,\n            };\n        }\n    },\n\n    keScoreFromPerseusScore: function(score, guess, state) {\n        if (score.type === \"points\") {\n            return {\n                empty: false,\n                correct: score.earned >= score.total,\n                message: score.message,\n                guess: guess,\n                state: state,\n            };\n        } else if (score.type === \"invalid\") {\n            return {\n                empty: true,\n                correct: false,\n                message: score.message,\n                guess: guess,\n                state: state,\n            };\n        } else {\n            throw new Error(\"Invalid score type: \" + score.type);\n        }\n    },\n\n    /**\n     * Return the first valid interpretation of 'text' as a number, in the form\n     * {value: 2.3, exact: true}.\n     */\n    firstNumericalParse: function(text) {\n        // TODO(alpert): This is sort of hacky...\n        var first;\n        var val = KhanAnswerTypes.predicate.createValidatorFunctional(\n            function(ans) {\n                first = ans;\n                return true; /* break */\n            },\n            {\n                simplify: \"optional\",\n                inexact: true,\n                forms: \"integer, proper, improper, pi, log, mixed, decimal\",\n            }\n        );\n\n        val(text);\n        return first;\n    },\n\n    stringArrayOfSize: function(size) {\n        return _.times(size, function() {\n            return \"\";\n        });\n    },\n\n    /**\n     * For a graph's x or y dimension, given the tick step,\n     * the ranges extent (e.g. [-10, 10]), the pixel dimension constraint,\n     * and the grid step, return a bunch of configurations for that dimension.\n     *\n     * Example:\n     *      gridDimensionConfig(10, [-50, 50], 400, 5)\n     *\n     * Returns: {\n     *      scale: 4,\n     *      snap: 2.5,\n     *      tickStep: 2,\n     *      unityLabel: true\n     * };\n     */\n    gridDimensionConfig: function(absTickStep, extent, dimensionConstraint, gridStep) {\n        var scale = Util.scaleFromExtent(extent, dimensionConstraint);\n        var stepPx = absTickStep * scale;\n        var unityLabel = stepPx > 30;\n        return {\n            scale: scale,\n            tickStep: absTickStep / gridStep,\n            unityLabel: unityLabel,\n        };\n    },\n\n    /**\n     * Given the range, step, and boxSize, calculate the reasonable gridStep.\n     * Used for when one was not given explicitly.\n     *\n     * Example:\n     *      getGridStep([[-10, 10], [-10, 10]], [1, 1], 340)\n     *\n     * Returns: [1, 1]\n     */\n    getGridStep: function(range, step, boxSize) {\n        return _.times(2, function(i) {\n            var scale = Util.scaleFromExtent(range[i], boxSize);\n            var gridStep = Util.gridStepFromTickStep(step[i], scale);\n            return gridStep;\n        });\n    },\n\n    snapStepFromGridStep: function(gridStep) {\n        return _.map(gridStep, function(step) {\n            return step / 2;\n        });\n    },\n\n    /**\n     * Given the range and a dimension, come up with the appropriate\n     * scale.\n     * Example:\n     *      scaleFromExtent([-25, 25], 500) // returns 10\n     */\n    scaleFromExtent: function(extent, dimensionConstraint) {\n        var span = extent[1] - extent[0];\n        var scale = dimensionConstraint / span;\n        return scale;\n    },\n\n    /**\n     * Return a reasonable tick step given extent and dimension.\n     * (extent is [begin, end] of the domain.)\n     * Example:\n     *      tickStepFromExtent([-10, 10], 300) // returns 2\n     */\n    tickStepFromExtent: function(extent, dimensionConstraint) {\n        var span = extent[1] - extent[0];\n\n        var tickFactor;\n        // If single number digits\n        if (15 < span && span <= 20) {\n            tickFactor = 23;\n\n            // triple digit or decimal\n        } else if (span > 100 || span < 5) {\n            tickFactor = 10;\n\n            // double digit\n        } else {\n            tickFactor = 16;\n        }\n        var constraintFactor = dimensionConstraint / 500;\n        var desiredNumTicks = tickFactor * constraintFactor;\n        return Util.tickStepFromNumTicks(span, desiredNumTicks);\n    },\n\n    /**\n     * Given the tickStep and the graph's scale, find a\n     * grid step.\n     * Example:\n     *      gridStepFromTickStep(200, 0.2) // returns 100\n     */\n    gridStepFromTickStep: function(tickStep, scale) {\n        var tickWidth = tickStep * scale;\n        var x = tickStep;\n        var y = Math.pow(10, Math.floor(Math.log(x) / Math.LN10));\n        var leadingDigit = Math.floor(x / y);\n        if (tickWidth < 25) {\n            return tickStep;\n        }\n        if (tickWidth < 50) {\n            if (leadingDigit === 5) {\n                return tickStep;\n            } else {\n                return tickStep / 2;\n            }\n        }\n        if (leadingDigit === 1) {\n            return tickStep / 2;\n        }\n        if (leadingDigit === 2) {\n            return tickStep / 4;\n        }\n        if (leadingDigit === 5) {\n            return tickStep / 5;\n        }\n    },\n\n    /**\n     * Find a good tick step for the desired number of ticks in the range\n     * Modified from d3.scale.linear: d3_scale_linearTickRange.\n     * Thanks, mbostock!\n     * Example:\n     *      tickStepFromNumTicks(50, 6) // returns 10\n     */\n    tickStepFromNumTicks: function(span, numTicks) {\n        var step = Math.pow(\n            10,\n            Math.floor(Math.log(span / numTicks) / Math.LN10)\n        );\n        var err = numTicks / span * step;\n\n        // Filter ticks to get closer to the desired count.\n        if (err <= 0.15) {\n            step *= 10;\n        } else if (err <= 0.35) {\n            step *= 5;\n        } else if (err <= 0.75) {\n            step *= 2;\n        }\n\n        // Round start and stop values to step interval.\n        return step;\n    },\n\n    /**\n     * Constrain tick steps intended for desktop size graphs\n     * to something more suitable for mobile size graphs.\n     * Specifically, we aim for 10 or fewer ticks per graph axis.\n     */\n    constrainedTickStepsFromTickSteps: function(tickSteps, ranges) {\n        const steps = [];\n\n        for (let i = 0; i < 2; i++) {\n            const span = ranges[i][1] - ranges[i][0];\n            const numTicks = span / tickSteps[i];\n            if (numTicks <= 10) {\n                // Will displays fine on mobile\n                steps[i] = tickSteps[i];\n            } else if (numTicks <= 20) {\n                // Will be crowded on mobile, so hide every other tick\n                steps[i] = tickSteps[i] * 2;\n            } else {\n                // Fallback in case we somehow have more than 20 ticks\n                // Note: This shouldn't happen due to GraphSettings.validStep\n                steps[i] = Util.tickStepFromNumTicks(span, 10);\n            }\n        }\n\n        return steps;\n    },\n\n    /**\n     * Transparently update deprecated props so that the code to deal\n     * with them only lives in one place: (Widget).deprecatedProps\n     *\n     * For example, if a boolean `foo` was deprecated in favor of a\n     * number 'bar':\n     *      deprecatedProps: {\n     *          foo: function(props) {\n     *              return {bar: props.foo ? 1 : 0};\n     *          }\n     *      }\n     */\n    DeprecationMixin: {\n        // This lifecycle stage is only called before first render\n        componentWillMount: function() {\n            var newProps = {};\n\n            _.each(\n                this.deprecatedProps,\n                function(func, prop) {\n                    if (_.has(this.props, prop)) {\n                        _.extend(newProps, func(this.props));\n                    }\n                },\n                this\n            );\n\n            if (!_.isEmpty(newProps)) {\n                // Set new props directly so that widget renders correctly\n                // when it first mounts, even though these will be overwritten\n                // almost immediately afterwards...\n                _.extend(this.props, newProps);\n\n                // ...when we propagate the new props upwards and they come\n                // back down again.\n                setTimeout(this.props.onChange, 0, newProps);\n            }\n        },\n    },\n\n    /**\n     * Approximate equality on numbers and primitives.\n     */\n    eq: function(x, y) {\n        if (_.isNumber(x) && _.isNumber(y)) {\n            return Math.abs(x - y) < 1e-9;\n        } else {\n            return x === y;\n        }\n    },\n\n    /**\n     * Deep approximate equality on primitives, numbers, arrays, and objects.\n     */\n    deepEq: function(x, y) {\n        if (_.isArray(x) && _.isArray(y)) {\n            if (x.length !== y.length) {\n                return false;\n            }\n            for (var i = 0; i < x.length; i++) {\n                if (!Util.deepEq(x[i], y[i])) {\n                    return false;\n                }\n            }\n            return true;\n        } else if (_.isArray(x) || _.isArray(y)) {\n            return false;\n        } else if (_.isFunction(x) && _.isFunction(y)) {\n            return Util.eq(x, y);\n        } else if (_.isFunction(x) || _.isFunction(y)) {\n            return false;\n        } else if (_.isObject(x) && _.isObject(y)) {\n            return x === y ||\n            (_.all(x, function(v, k) {\n                return Util.deepEq(y[k], v);\n            }) &&\n                _.all(y, function(v, k) {\n                    return Util.deepEq(x[k], v);\n                }));\n        } else if (_.isObject(x) || _.isObject(y)) {\n            return false;\n        } else {\n            return Util.eq(x, y);\n        }\n    },\n\n    /**\n     * Query String Parser\n     *\n     * Original from:\n     * http://stackoverflow.com/questions/901115/get-querystring-values-in-javascript/2880929#2880929\n     */\n    parseQueryString: function(query) {\n        query = query || window.location.search.substring(1);\n        var urlParams = {},\n            e,\n            a = /\\+/g, // Regex for replacing addition symbol with a space\n            r = /([^&=]+)=?([^&]*)/g,\n            d = function(s) {\n                return decodeURIComponent(s.replace(a, \" \"));\n            };\n\n        while ((e = r.exec(query))) {\n            urlParams[d(e[1])] = d(e[2]);\n        }\n\n        return urlParams;\n    },\n\n    /**\n     * Query string adder\n     * Works for URLs without #.\n     * Original from:\n     * http://stackoverflow.com/questions/5999118/add-or-update-query-string-parameter\n     */\n    updateQueryString: function(uri, key, value) {\n        value = encodeURIComponent(value);\n        var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n        var separator = uri.indexOf(\"?\") !== -1 ? \"&\" : \"?\";\n        if (uri.match(re)) {\n            return uri.replace(re, \"$1\" + key + \"=\" + value + \"$2\");\n        } else {\n            return uri + separator + key + \"=\" + value;\n        }\n    },\n\n    /**\n     * A more strict encodeURIComponent that escapes `()'!`s\n     * Especially useful for creating URLs that are embeddable in markdown\n     *\n     * Adapted from\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\n     * This function and the above original available under the\n     * CC-BY-SA 2.5 license.\n     */\n    strongEncodeURIComponent: function(str) {\n        return encodeURIComponent(str)\n            // Note that although RFC3986 reserves \"!\", RFC5987 does not,\n            // so we do not need to escape it\n            .replace(/['()!]/g, window.escape) // i.e., %27 %28 %29\n            .replace(/\\*/g, \"%2A\");\n    },\n\n    // There are certain widgets where we don't want to provide the \"answered\"\n    // highlight indicator.\n    // The issue with just using the `graded` flag on questions is that showing\n    // that a certain widget is ungraded can sometimes reveal the answer to a\n    // question (\"is this transformation possible? if so, do it\")\n    // This is kind of a hack to get around this.\n    widgetShouldHighlight: function(widget) {\n        if (!widget) {\n            return false;\n        }\n        var HIGHLIGHT_BAR_BLACKLIST = [\"measurer\", \"protractor\"];\n        return !_.contains(HIGHLIGHT_BAR_BLACKLIST, widget.type);\n    },\n\n    /**\n     * If a widget says that it is empty once it is graded.\n     * Trying to encapsulate references to the score format.\n     */\n    scoreIsEmpty: function(score) {\n        // HACK(benkomalo): ugh. this isn't great; the Perseus score objects\n        // overload the type \"invalid\" for what should probably be three\n        // distinct cases:\n        //  - truly empty or not fully filled out\n        //  - invalid or malformed inputs\n        //  - \"almost correct\" like inputs where the widget wants to give\n        //  feedback (e.g. a fraction needs to be reduced, or `pi` should\n        //  be used instead of 3.14)\n        //\n        //  Unfortunately the coercion happens all over the place, as these\n        //  Perseus style score objects are created *everywhere* (basically\n        //  in every widget), so it's hard to change now. We assume that\n        //  anything with a \"message\" is not truly empty, and one of the\n        //  latter two cases for now.\n        return (\n            score.type === \"invalid\" &&\n            (!score.message || score.message.length === 0)\n        );\n    },\n\n    /**\n     * Extracts the location of a touch or mouse event, allowing you to pass\n     * in a \"mouseup\", \"mousedown\", or \"mousemove\" event and receive the\n     * correct coordinates. Shouldn't be used with \"vmouse\" events.\n     *\n     * The Util.touchHandlers are used to track the current state of the touch\n     * event, such as whether or not the user is currently pressed down (either\n     * through touch or mouse) on the screen.\n     */\n\n    touchHandlers: {\n        pointerDown: false,\n        currentTouchIdentifier: null,\n    },\n\n    resetTouchHandlers: function() {\n        _.extend(Util.touchHandlers, {\n            pointerDown: false,\n            currentTouchIdentifier: null,\n        });\n    },\n\n    extractPointerLocation: function(event) {\n        var touchOrEvent;\n\n        if (Util.touchHandlers.pointerDown) {\n            // Look for the touch matching the one we're tracking; ignore others\n            if (Util.touchHandlers.currentTouchIdentifier != null) {\n                var len = event.changedTouches\n                    ? event.changedTouches.length\n                    : 0;\n                for (var i = 0; i < len; i++) {\n                    if (\n                        event.changedTouches[i].identifier ===\n                        Util.touchHandlers.currentTouchIdentifier\n                    ) {\n                        touchOrEvent = event.changedTouches[i];\n                    }\n                }\n            } else {\n                touchOrEvent = event;\n            }\n\n            var isEndish =\n                event.type === \"touchend\" || event.type === \"touchcancel\";\n            if (touchOrEvent && isEndish) {\n                Util.touchHandlers.pointerDown = false;\n                Util.touchHandlers.currentTouchIdentifier = null;\n            }\n        } else {\n            // touchstart or mousedown\n            Util.touchHandlers.pointerDown = true;\n            if (event.changedTouches) {\n                touchOrEvent = event.changedTouches[0];\n                Util.touchHandlers.currentTouchIdentifier =\n                    touchOrEvent.identifier;\n            } else {\n                touchOrEvent = event;\n            }\n        }\n\n        if (touchOrEvent) {\n            return {\n                left: touchOrEvent.pageX,\n                top: touchOrEvent.pageY,\n            };\n        }\n    },\n\n    /**\n     * Pass this function as the touchstart for an element to\n     * avoid sending the touch to the mobile scratchpad\n     */\n    captureScratchpadTouchStart: function(e) {\n        e.stopPropagation();\n    },\n\n    getImageSize: function(url, callback) {\n        var img = new Image();\n        img.onload = function() {\n            // IE 11 seems to have problems calculating the heights of svgs\n            // if they're not in the DOM. To solve this, we add the element to\n            // the dom, wait for a rerender, and use `.clientWidth` and\n            // `.clientHeight`. I think we could also solve the problem by\n            // adding the image to the document before setting the src, but then\n            // the experience would be worse for other browsers.\n            if (img.width === 0 && img.height === 0) {\n                document.body.appendChild(img);\n                _.defer(function() {\n                    callback(img.clientWidth, img.clientHeight);\n                    document.body.removeChild(img);\n                });\n            } else {\n                callback(img.width, img.height);\n            }\n        };\n\n        img.src = getRealImageUrl(url);\n    },\n\n    textarea: {\n        /**\n         * Gets the word right before where the textarea cursor is\n         *\n         * @param {Element} textarea - The textarea DOM element\n         * @return {JSON} - An object with the word and its starting and ending positions in the textarea\n         */\n        getWordBeforeCursor: function(textarea) {\n            var text = textarea.value;\n\n            var endPos = textarea.selectionStart - 1;\n            var startPos =\n                Math.max(\n                    text.lastIndexOf(\"\\n\", endPos),\n                    text.lastIndexOf(\" \", endPos)\n                ) + 1;\n\n            return {\n                string: text.substring(startPos, endPos + 1),\n                pos: {\n                    start: startPos,\n                    end: endPos,\n                },\n            };\n        },\n\n        /**\n         * Moves the textarea cursor at the specified position\n         *\n         * @param {Element} textarea - The textarea DOM element\n         * @param {int} pos - The position where the cursor will be moved\n         */\n        moveCursor: function(textarea, pos) {\n            textarea.selectionStart = pos;\n            textarea.selectionEnd = pos;\n        },\n    },\n};\n\nUtil.random = Util.seededRNG(new Date().getTime() & 0xffffffff);\n\nexport default Util;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * This is a TreeMapper that only has mappers specified for its leaf nodes; its\n * array mapper is the identity function.\n *\n * This is the TreeMapper initially returned by `buildMapper`. It allows you to\n * change the types of your ContentMapper and HintMapper, which is safe because\n * none of the other mappers that depend on those types (aka ArrayMapper) have\n * been specified yet. (Or, more specifically, the ArrayMapper is currently\n * `identity`, which can trivially vary with the ContentMapper and HintMapper's\n * types.)\n *\n * Once you call `setArrayMapper`, however, we move to the other class:\n * TreeMapperForLeavesAndCollections.\n */\nclass TreeMapperJustForLeaves {\n    constructor(content, hint, tags) {\n        this.content = content;\n        this.hint = hint;\n        this.tags = tags;\n        this.array = identity;\n    }\n\n    setContentMapper(newContentMapper) {\n        return new TreeMapperJustForLeaves(\n            newContentMapper, this.hint, this.tags);\n    }\n\n    setHintMapper(newHintMapper) {\n        return new TreeMapperJustForLeaves(\n            this.content, newHintMapper, this.tags);\n    }\n\n    setTagsMapper(newTagsMapper) {\n        return new TreeMapperJustForLeaves(\n            this.content, this.hint, newTagsMapper);\n    }\n\n    setArrayMapper(newArrayMapper) {\n        return new TreeMapperForLeavesAndCollections(\n            this.content, this.hint, this.tags, newArrayMapper);\n    }\n\n    mapTree(tree, shape) {\n        return mapTree(tree, shape, [], this);\n    }\n}\n\n/**\n * This is a TreeMapper that already has an ArrayMapper specified, so its\n * ContentMapper and HintMapper are now locked in.\n */\nclass TreeMapperForLeavesAndCollections {\n    constructor(content, hint, tags, array) {\n        this.content = content;\n        this.hint = hint;\n        this.tags = tags;\n        this.array = array;\n    }\n\n    setArrayMapper(newArrayMapper) {\n        return new TreeMapperForLeavesAndCollections(\n            this.content, this.hint, this.tags, newArrayMapper);\n    }\n\n    mapTree(tree, shape) {\n        return mapTree(tree, shape, [], this);\n    }\n}\n\nfunction identity(x) {\n    return x;\n}\n\n/**\n * Return a new TreeMapper that will perform a no-op transformation on an input\n * tree. To make it useful, chain any combination of `setContentMapper`,\n * `setHintMapper`, `setTagMapper`, and `setArrayMapper` to specify\n * transformations for the individual node types.\n */\nexport function buildMapper() {\n    return new TreeMapperJustForLeaves(identity, identity, identity);\n}\n\n/**\n * Copy the given tree, apply the corresponding transformation specified in the\n * TreeMapper to each node, and return the resulting tree.\n */\nfunction mapTree(tree, shape, path, mappers) {\n    // We trust the shape of the multi-item to match the shape provided at\n    // runtime. Therefore, in each shape branch, we cast the node to `any` and\n    // reinterpret it as the expected node type.\n    if (shape.type === \"content\") {\n        const content = (tree);\n        return mappers.content(content, shape, path);\n    } else if (shape.type === \"hint\") {\n        const hint = (tree);\n        return mappers.hint(hint, shape, path);\n    } else if (shape.type === \"tags\") {\n        const tags = (tree);\n        return mappers.tags(tags, shape, path);\n    } else if (shape.type === \"array\") {\n        const array = (tree);\n\n        if (!Array.isArray(array)) {\n            throw new Error(\n                `Invalid object of type \"${typeof array}\" found at path ` +\n                `${[\"<root>\"].concat(path).join(\".\")}. Expected array.`);\n        }\n\n        const elementShape = shape.elementShape;\n        const mappedElements =\n            array.map((inner, i) => mapTree(inner, elementShape, path.concat(i), mappers));\n        return mappers.array(mappedElements, array, shape, path);\n    } else if (shape.type === \"object\") {\n        const object = (tree);\n\n        if (object && typeof object !== \"object\") {\n            throw new Error(\n                `Invalid object of type \"${typeof object}\" found at ` +\n                `path ${[\"<root>\"].concat(path).join(\".\")}. Expected ` +\n                `\"object\" type.`);\n        }\n\n        const valueShapes = shape.shape;\n        if (!valueShapes) {\n            throw new Error(\n                `Unexpected shape ${JSON.stringify(shape)} at path ` +\n                `${[\"<root>\"].concat(path).join(\".\")}.`);\n        }\n        const newObject = {};\n        Object.keys(valueShapes).forEach(key => {\n            if (!(key in object)) {\n                throw new Error(\n                    `Key \"${key}\" is missing from shape at path ` +\n                    `${[\"<root>\"].concat(path).join(\".\")}.`);\n            }\n\n            newObject[key] = mapTree(\n                object[key], valueShapes[key], path.concat(key), mappers);\n        });\n        return newObject;\n    } else {\n        throw new Error(`unexpected shape type ${shape.type}`);\n    }\n}\n","import _underscore from \"underscore\";\n\n/**\n * A work-in-progress of _ methods for objects.\n * That is, they take an object as a parameter,\n * and return an object instead of an array.\n *\n * TODO(aria): Move this out of interactive2\n */\n\nconst _ = _underscore;\n\n/**\n * Does a pluck on keys inside objects in an object\n *\n * Ex:\n * tools = {\n *     translation: {\n *         enabled: true\n *     },\n *     rotation: {\n *         enabled: false\n *     }\n * };\n * pluckObject(tools, \"enabled\") returns {\n *     translation: true\n *     rotation: false\n * }\n */\nexport const pluck = function(table, subKey) {\n    return _.object(_.map(table, function(value, key) {\n        return [key, value[subKey]];\n    }));\n};\n\n/**\n * Maps an object to an object\n *\n * > mapObject({a: '1', b: '2'}, (value, key) => {\n *       return value + 1;\n *   });\n * {a: 2, b: 3}\n */\nexport const mapObject = function(obj, lambda) {\n    const result = {};\n    _.each(_.keys(obj), function(key) {\n        result[key] = lambda(obj[key], key);\n    });\n    return result;\n};\n\n/**\n * Maps an array to an object\n *\n * > mapObjectFromArray(['a', 'b'], function(elem) {\n *       return elem + elem;\n *   });\n * {a: 'aa', b: 'bb'}\n */\nexport const mapObjectFromArray = function(arr, lambda) {\n    const result = {};\n    _.each(arr, function(elem) {\n        result[elem] = lambda(elem);\n    });\n    return result;\n};\n\nexport default {\n    pluck: pluck,\n    mapObject: mapObject,\n    mapObjectFromArray: mapObjectFromArray,\n};\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n// Define the shape of the linter context object that is passed through the\n// tree with additional information about what we are checking.\n\nconst React = _react;\n\nexport const linterContextProps = PropTypes.shape({\n    contentType: PropTypes.string,\n    highlightLint: PropTypes.bool,\n    paths: PropTypes.arrayOf(PropTypes.string),\n    stack: PropTypes.arrayOf(PropTypes.string),\n});\n\nexport const linterContextDefault = {\n    contentType: '',\n    highlightLint: false,\n    paths: [],\n    stack: [],\n};\nexport default _module_.exports;\n","/**\n * This is the base class for all Selector types. The key method that all\n * selector subclasses must implement is match(). It takes a TraversalState\n * object (from a TreeTransformer traversal) and tests whether the selector\n * matches at the current node. See the comment at the start of this file for\n * more details on the match() method.\n */\nexport default class Selector {\n    static parse(selectorText) {\n        return new Parser(selectorText).parse();\n    }\n\n    /**\n     * Return an array of the nodes that matched or null if no match.\n     * This is the base class so we just throw an exception. All Selector\n     * subclasses must provide an implementation of this method.\n     */\n    match(state) {\n        throw new Error(\"Selector subclasses must implement match()\");\n    }\n\n    /**\n     * Selector subclasses all define a toString() method primarily\n     * because it makes it easy to write parser tests.\n     */\n    toString() {\n        return \"Unknown selector class\";\n    }\n}\n\n/**\n * This class implements a parser for the selector grammar. Pass the source\n * text to the Parser() constructor, and then call the parse() method to\n * obtain a corresponding Selector object. parse() throws an exception\n * if there are syntax errors in the selector.\n *\n * This class is not exported, and you don't need to use it directly.\n * Instead call the static Selector.parse() method.\n */\nclass Parser {\n    constructor(s) {\n        // Normalize whitespace:\n        // - remove leading and trailing whitespace\n        // - replace runs of whitespace with single space characters\n        s = s.trim().replace(/\\s+/g, \" \");\n        // Convert the string to an array of tokens. Note that the TOKENS\n        // pattern ignores spaces that do not appear before identifiers\n        // or the * wildcard.\n        this.tokens = s.match(Parser.TOKENS) || [];\n        this.tokenIndex = 0;\n    }\n\n    // Return the next token or the empty string if there are no more\n    nextToken() {\n        return this.tokens[this.tokenIndex] || \"\";\n    }\n\n    // Increment the token index to \"consume\" the token we were looking at\n    // and move on to the next one.\n    consume() {\n        this.tokenIndex++;\n    }\n\n    // Return true if the current token is an identifier or false otherwise\n    isIdentifier() {\n        // The Parser.TOKENS regexp ensures that we only have to check\n        // the first character of a token to know what kind of token it is.\n        const c = this.tokens[this.tokenIndex][0];\n        return (c >= \"a\" && c <= \"z\") || (c >= \"A\" && c <= \"Z\");\n    }\n\n    // Consume space tokens until the next token is not a space.\n    skipSpace() {\n        while (this.nextToken() === \" \") {\n            this.consume();\n        }\n    }\n\n    // Parse a comma-separated sequence of tree selectors. This is the\n    // entry point for the Parser class and the only method that clients\n    // ever need to call.\n    parse() {\n        // We expect at least one tree selector\n        const ts = this.parseTreeSelector();\n\n        // Now see what's next\n        let token = this.nextToken();\n\n        // If there is no next token then we're done parsing and can return\n        // the tree selector object we got above\n        if (!token) {\n            return ts;\n        }\n\n        // Otherwise, there is more go come and we're going to need a\n        // list of tree selectors\n        const treeSelectors = [ts];\n        while (token) {\n            // The only character we allow after a tree selector is a comma\n            if (token === \",\") {\n                this.consume();\n            } else {\n                throw new ParseError(\"Expected comma\");\n            }\n\n            // And if we saw a comma, then it must be followed by another\n            // tree selector\n            treeSelectors.push(this.parseTreeSelector());\n            token = this.nextToken();\n        }\n\n        // If we parsed more than one tree selector, return them in a\n        // SelectorList object.\n        return new SelectorList(treeSelectors);\n    }\n\n    // Parse a sequence of node selectors linked together with\n    // hierarchy combinators: space, >, + and ~.\n    parseTreeSelector() {\n        this.skipSpace(); // Ignore space after a comma, for example\n\n        // A tree selector must begin with a node selector\n        let ns = this.parseNodeSelector();\n\n        for (;;) {\n            // Now check the next token. If there is none, or if it is a\n            // comma, then we're done with the treeSelector. Otherwise\n            // we expect a combinator followed by another node selector.\n            // If we don't see a combinator, we throw an error. If we\n            // do see a combinator and another node selector then we\n            // combine the current node selector with the new node selector\n            // using a Selector subclass that depends on the combinator.\n            const token = this.nextToken();\n\n            if (!token || token === \",\") {\n                break;\n            } else if (token === \" \") {\n                this.consume();\n                ns = new AncestorCombinator(ns, this.parseNodeSelector());\n            } else if (token === \">\") {\n                this.consume();\n                ns = new ParentCombinator(ns, this.parseNodeSelector());\n            } else if (token === \"+\") {\n                this.consume();\n                ns = new PreviousCombinator(ns, this.parseNodeSelector());\n            } else if (token === \"~\") {\n                this.consume();\n                ns = new SiblingCombinator(ns, this.parseNodeSelector());\n            } else {\n                throw new ParseError(\"Unexpected token: \" + token);\n            }\n        }\n\n        return ns;\n    }\n\n    // Parse a single node selector.\n    // For now, this is just a node type or a wildcard.\n    //\n    // TODO(davidflanagan): we may need to extend this with attribute\n    // selectors like 'heading[level=3]', or with pseudo-classes like\n    // paragraph:first-child\n    parseNodeSelector() {\n        // First, skip any whitespace\n        this.skipSpace();\n\n        const t = this.nextToken();\n        if (t === \"*\") {\n            this.consume();\n            return new AnyNode();\n        } else if (this.isIdentifier()) {\n            this.consume();\n            return new TypeSelector(t);\n        }\n\n        throw new ParseError(\"Expected node type\");\n    }\n}\n\n// We break the input string into tokens with this regexp. Token types\n// are identifiers, integers, punctuation and spaces. Note that spaces\n// tokens are only returned when they appear before an identifier or\n// wildcard token and are otherwise omitted.\nParser.TOKENS = /([a-zA-Z][\\w-]*)|(\\d+)|[^\\s]|(\\s(?=[a-zA-Z\\*]))/g;\n\n/**\n * This is a trivial Error subclass that the Parser uses to signal parse errors\n */\nclass ParseError extends Error {\n    constructor(message) {\n        super(message);\n    }\n}\n\n/**\n * This Selector subclass is a list of selectors. It matches a node if any of\n * the selectors on the list matches the node. It considers the selectors in\n * order, and returns the array of nodes returned by whichever one matches\n * first.\n */\nclass SelectorList extends Selector {\n    constructor(selectors) {\n        super();\n        this.selectors = selectors;\n    }\n\n    match(state) {\n        for (let i = 0; i < this.selectors.length; i++) {\n            const s = this.selectors[i];\n            const result = s.match(state);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    }\n\n    toString() {\n        let result = \"\";\n        for (let i = 0; i < this.selectors.length; i++) {\n            result += i > 0 ? \", \" : \"\";\n            result += this.selectors[i].toString();\n        }\n        return result;\n    }\n}\n\n/**\n * This trivial Selector subclass implements the '*' wildcard and\n * matches any node.\n */\nclass AnyNode extends Selector {\n    match(state) {\n        return [state.currentNode()];\n    }\n\n    toString() {\n        return \"*\";\n    }\n}\n\n/**\n * This selector subclass implements the <IDENTIFIER> part of the grammar.\n * it matches any node whose `type` property is a specified string\n */\nclass TypeSelector extends Selector {\n    constructor(type) {\n        super();\n        this.type = type;\n    }\n\n    match(state) {\n        const node = state.currentNode();\n        if (node.type === this.type) {\n            return [node];\n        } else {\n            return null;\n        }\n    }\n\n    toString() {\n        return this.type;\n    }\n}\n\n/**\n * This selector subclass is the superclass of the classes that implement\n * matching for the four combinators. It defines left and right properties for\n * the two selectors that are to be combined, but does not define a match\n * method.\n */\nclass SelectorCombinator extends Selector {\n    constructor(left, right) {\n        super();\n        this.left = left;\n        this.right = right;\n    }\n}\n\n/**\n * This Selector subclass implements the space combinator. It matches if the\n * right selector matches the current node and the left selector matches some\n * ancestor of the current node.\n */\nclass AncestorCombinator extends SelectorCombinator {\n    constructor(left, right) {\n        super(left, right);\n    }\n\n    match(state) {\n        const rightResult = this.right.match(state);\n        if (rightResult) {\n            state = state.clone();\n            while (state.hasParent()) {\n                state.goToParent();\n                const leftResult = this.left.match(state);\n                if (leftResult) {\n                    return leftResult.concat(rightResult);\n                }\n            }\n        }\n        return null;\n    }\n\n    toString() {\n        return this.left.toString() + \" \" + this.right.toString();\n    }\n}\n\n/**\n * This Selector subclass implements the > combinator. It matches if the\n * right selector matches the current node and the left selector matches\n * the parent of the current node.\n */\nclass ParentCombinator extends SelectorCombinator {\n    constructor(left, right) {\n        super(left, right);\n    }\n\n    match(state) {\n        const rightResult = this.right.match(state);\n        if (rightResult) {\n            if (state.hasParent()) {\n                state = state.clone();\n                state.goToParent();\n                const leftResult = this.left.match(state);\n                if (leftResult) {\n                    return leftResult.concat(rightResult);\n                }\n            }\n        }\n        return null;\n    }\n\n    toString() {\n        return this.left.toString() + \" > \" + this.right.toString();\n    }\n}\n\n/**\n * This Selector subclass implements the + combinator. It matches if the\n * right selector matches the current node and the left selector matches\n * the immediate previous sibling of the current node.\n */\nclass PreviousCombinator extends SelectorCombinator {\n    constructor(left, right) {\n        super(left, right);\n    }\n\n    match(state) {\n        const rightResult = this.right.match(state);\n        if (rightResult) {\n            if (state.hasPreviousSibling()) {\n                state = state.clone();\n                state.goToPreviousSibling();\n                const leftResult = this.left.match(state);\n                if (leftResult) {\n                    return leftResult.concat(rightResult);\n                }\n            }\n        }\n        return null;\n    }\n\n    toString() {\n        return this.left.toString() + \" + \" + this.right.toString();\n    }\n}\n\n/**\n * This Selector subclass implements the ~ combinator. It matches if the\n * right selector matches the current node and the left selector matches\n * any previous sibling of the current node.\n */\nclass SiblingCombinator extends SelectorCombinator {\n    constructor(left, right) {\n        super(left, right);\n    }\n\n    match(state) {\n        const rightResult = this.right.match(state);\n        if (rightResult) {\n            state = state.clone();\n            while (state.hasPreviousSibling()) {\n                state.goToPreviousSibling();\n                const leftResult = this.left.match(state);\n                if (leftResult) {\n                    return leftResult.concat(rightResult);\n                }\n            }\n        }\n        return null;\n    }\n\n    toString() {\n        return this.left.toString() + \" ~ \" + this.right.toString();\n    }\n}\n","/**\n * The Rule class represents a Gorgon lint rule. A Rule instance has a check()\n * method that takes the same (node, state, content) arguments that a\n * TreeTransformer traversal callback function does. Call the check() method\n * during a tree traversal to determine whether the current node of the tree\n * violates the rule. If there is no violation, then check() returns\n * null. Otherwise, it returns an object that includes the name of the rule,\n * an error message, and the start and end positions within the node's content\n * string of the lint.\n *\n * A Gorgon lint rule consists of a name, a severity, a selector, a pattern\n * (RegExp) and two functions. The check() method uses the selector, pattern,\n * and functions as follows:\n *\n * - First, when determining which rules to apply to a particular piece of\n *   content, each rule can specify an optional function provided in the fifth\n *   parameter to evaluate whether or not we should be applying this rule.\n *   If the function returns false, we don't use the rule on this content.\n *\n * - Next, check() tests whether the node currently being traversed matches\n *   the selector. If it does not, then the rule does not apply at this node\n *   and there is no lint and check() returns null.\n *\n * - If the selector matched, then check() tests the text content of the node\n *   (and its children) against the pattern. If the pattern does not match,\n *   then there is no lint, and check() returns null.\n *\n * - If both the selector and pattern match, then check() calls the function\n *   passing the TraversalState object, the content string for the node, the\n *   array of nodes returned by the selector match, and the array of strings\n *   returned by the pattern match. This function can use these arguments to\n *   implement any kind of lint detection logic it wants. If it determines\n *   that there is no lint, then it should return null. Otherwise, it should\n *   return an error message as a string, or an object with `message`, `start`\n *   and `end` properties. The start and end properties are numbers that mark\n *   the beginning and end of the problematic content. Note that these numbers\n *   are relative to the content string passed to the traversal callback, not\n *   to the entire string that was used to generate the parse tree in the\n *   first place. TODO(davidflanagan): modify the simple-markdown library to\n *   have an option to add the text offset of each node to the parse\n *   tree. This will allows us to pinpoint lint errors within a long string\n *   of markdown text.\n *\n * - If the function returns null, then check() returns null. Otherwise,\n *   check() returns an object with `rule`, `message`, `start` and `end`\n *   properties. The value of the `rule` property is the name of the rule,\n *   which is useful for error reporting purposes.\n *\n * The name, severity, selector, pattern and function arguments to the Rule()\n * constructor are optional, but you may not omit both the selector and the\n * pattern. If you do not specify a selector, a default selector that matches\n * any node of type \"text\" will be used. If you do not specify a pattern, then\n * any node that matches the selector will be assumed to match the pattern as\n * well. If you don't pass a function as the fourth argument to the Rule()\n * constructor, then you must pass an error message string instead. If you do\n * this, you'll get a default function that unconditionally returns an object\n * that includes the error message and the start and end indexes of the\n * portion of the content string that matched the pattern. If you don't pass a\n * function in the fifth parameter, the rule will be applied in any context.\n *\n * One of the design goals of this Rule class is to allow simple lint rules to\n * be described in JSON files without any JavaScript code. So in addition to\n * the Rule() constructor, the class also defines a Rule.makeRule() factory\n * method. This method takes a single object as its argument and expects the\n * object to have four string properties. The `name` property is passed as the\n * first argument to the Rule() construtctor.  The optional `selector`\n * property, if specified, is passed to Selector.parse() and the resulting\n * Selector object is used as the second argument to Rule().  The optional\n * `pattern` property is converted to a RegExp before being passed as the\n * third argument to Rule(). (See Rule.makePattern() for details on the string\n * to RegExp conversion). Finally, the `message` property specifies an error\n * message that is passed as the final argument to Rule(). You can also use a\n * real RegExp as the value of the `pattern` property or define a custom lint\n * function on the `lint` property instead of setting the `message`\n * property. Doing either of these things means that your rule description can\n * no longer be saved in a JSON file, however.\n *\n * For example, here are two lint rules defined with Rule.makeRule():\n *\n *    let nestedLists = Rule.makeRule({\n *        name: \"nested-lists\",\n *        selector: \"list list\",\n *        message: `Nested lists:\n *    nested lists are hard to read on mobile devices;\n *    do not use additional indentation.`,\n *    });\n *\n *    let longParagraph = Rule.makeRule({\n *        name: \"long-paragraph\",\n *        selector: \"paragraph\",\n *        pattern: /^.{501,}/,\n *        lint: function(state, content, nodes, match) {\n *            return `Paragraph too long:\n *    This paragraph is ${content.length} characters long.\n *    Shorten it to 500 characters or fewer.`;\n *        },\n *    });\n *\n * Certain advanced lint rules need additional information about the content\n * being linted in order to detect lint. For example, a rule to check for\n * whitespace at the start and end of the URL for an image can't use the\n * information in the node or content arguments because the markdown parser\n * strips leading and trailing whitespace when parsing. (Nevertheless, these\n * spaces have been a practical problem for our content translation process so\n * in order to check for them, a lint rule needs access to the original\n * unparsed source text. Similarly, there are various lint rules that check\n * widget usage. For example, it is easy to write a lint rule to ensure that\n * images have alt text for images encoded in markdown. But when images are\n * added to our content via an image widget we also want to be able to check\n * for alt text. In order to do this, the lint rule needs to be able to look\n * widgets up by name in the widgets object associated with the parse tree.\n *\n * In order to support advanced linting rules like these, the check() method\n * takes a context object as its optional fourth argument, and passes this\n * object on to the lint function of each rule. Rules that require extra\n * context should not assume that they will always get it, and should verify\n * that the necessary context has been supplied before using it. Currently the\n * \"content\" property of the context object is the unparsed source text if\n * available, and the \"widgets\" property of the context object is the widget\n * object associated with that content string in the JSON object that defines\n * the Perseus article or exercise that is being linted.\n */\n\n\nimport Selector from \"./selector.js\";\n\n/**\n * A Rule object describes a Gorgon lint rule. See the comment at the top of\n * this file for detailed description.\n */\nexport default class Rule {\n    // The comment at the top of this file has detailed docs for\n    // this constructor and its arguments\n    constructor(name, severity, selector, pattern, lint, applies) {\n        if (!selector && !pattern) {\n            throw new Error(\"Lint rules must have a selector or pattern\");\n        }\n\n        this.name = name || \"unnamed rule\";\n        this.severity = severity || Rule.Severity.BULK_WARNING;\n        this.selector = selector || Rule.DEFAULT_SELECTOR;\n        this.pattern = pattern || null;\n\n        // If we're called with an error message instead of a function then\n        // use a default function that will return the message.\n        if (typeof lint === \"function\") {\n            this.lint = lint;\n            this.message = null;\n        } else {\n            this.lint = this._defaultLintFunction;\n            this.message = lint;\n        }\n\n        this.applies = applies || function() {\n            return true;\n        };\n    }\n\n    // A factory method for use with rules described in JSON files\n    // See the documentation at the start of this file for details.\n    static makeRule(options) {\n        return new Rule(\n            options.name,\n            options.severity,\n            options.selector ? Selector.parse(options.selector) : null,\n            Rule.makePattern(options.pattern),\n            options.lint || options.message,\n            options.applies\n        );\n    }\n\n    // Check the node n to see if it violates this lint rule.  A return value\n    // of false means there is no lint.  A returned object indicates a lint\n    // error. See the documentation at the top of this file for details.\n    check(node, traversalState, content, context) {\n        // First, see if we match the selector.\n        // If no selector was passed to the constructor, we use a\n        // default selector that matches text nodes.\n        const selectorMatch = this.selector.match(traversalState);\n\n        // If the selector did not match, then we're done\n        if (!selectorMatch) {\n            return null;\n        }\n\n        // If the selector matched, then see if the pattern matches\n        let patternMatch;\n        if (this.pattern) {\n            patternMatch = content.match(this.pattern);\n        } else {\n            // If there is no pattern, then just match all of the content.\n            // Use a fake RegExp match object to represent this default match.\n            patternMatch = Rule.FakePatternMatch(content, content, 0);\n        }\n\n        // If there was a pattern and it didn't match, then we're done\n        if (!patternMatch) {\n            return null;\n        }\n\n        try {\n            // If we get here, then the selector and pattern have matched\n            // so now we call the lint function to see if there is lint.\n            const error = this.lint(\n                traversalState,\n                content,\n                selectorMatch,\n                patternMatch,\n                context\n            );\n\n            if (!error) {\n                return null; // No lint; we're done\n            } else if (typeof error === \"string\") {\n                // If the lint function returned a string we assume it\n                // applies to the entire content of the node and return it.\n                return {\n                    rule: this.name,\n                    severity: this.severity,\n                    message: error,\n                    start: 0,\n                    end: content.length,\n                };\n            } else {\n                // If the lint function returned an object, then we just\n                // add the rule name to the message, start and end.\n                return {\n                    rule: this.name,\n                    severity: this.severity,\n                    message: error.message,\n                    start: error.start,\n                    end: error.end,\n                };\n            }\n        } catch (e) {\n            // If the lint function threw an exception we handle that as\n            // a special type of lint. We want the user to see the lint\n            // warning in this case (even though it is out of their control)\n            // so that the bug gets reported. Otherwise we'd never know that\n            // a rule was failing.\n            return {\n                rule: \"lint-rule-failure\",\n                message: `Exception in rule ${this.name}: ${e.message}\nStack trace:\n${e.stack}`,\n                start: 0,\n                end: content.length,\n            };\n        }\n    }\n\n    // This internal method is the default lint function that we use when a\n    // rule is defined without a function. This is useful for rules where the\n    // selector and/or pattern match are enough to indicate lint. This\n    // function unconditionally returns the error message that was passed in\n    // place of a function, but also adds start and end properties that\n    // specify which particular portion of the node content matched the\n    // pattern.\n    _defaultLintFunction(state, content, selectorMatch, patternMatch) {\n        return {\n            message: this.message || \"\",\n            start: patternMatch.index,\n            end: patternMatch.index + patternMatch[0].length,\n        };\n    }\n\n    // The makeRule() factory function uses this static method to turn its\n    // argument into a RegExp. If the argument is already a RegExp, we just\n    // return it. Otherwise, we compile it into a RegExp and return that.\n    // The reason this is necessary is that Rule.makeRule() is designed for\n    // use with data from JSON files and JSON files can't include RegExp\n    // literals. Strings passed to this function do not need to be delimited\n    // with / characters unless you want to include flags for the RegExp.\n    //\n    // Examples:\n    //\n    //   input \"\"        ==> output null\n    //   input /foo/     ==> output /foo/\n    //   input \"foo\"     ==> output /foo/\n    //   input \"/foo/i\"  ==> output /foo/i\n    //\n    static makePattern(pattern) {\n        if (!pattern) {\n            return null;\n        } else if (pattern instanceof RegExp) {\n            return pattern;\n        } else if (pattern[0] === \"/\") {\n            const lastSlash = pattern.lastIndexOf(\"/\");\n            const expression = pattern.substring(1, lastSlash);\n            const flags = pattern.substring(lastSlash + 1);\n            return new RegExp(expression, (flags));\n        } else {\n            return new RegExp(pattern);\n        }\n    }\n\n    // This static method returns an string array with index and input\n    // properties added, in order to simulate the return value of the\n    // String.match() method. We use it when a Rule has no pattern and we\n    // want to simulate a match on the entire content string.\n    static FakePatternMatch(input, match, index) {\n        const result = [match];\n        result.index = index;\n        result.input = input;\n        return result;\n    }\n\n    static Severity = {\n        ERROR: 1,\n        WARNING: 2,\n        GUIDELINE: 3,\n        BULK_WARNING: 4,\n    }\n}\n\nRule.DEFAULT_SELECTOR = Selector.parse(\"text\");\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n// Normally we have one rule per file. But since our selector class\n// can't match specific widget types directly, this rule implements\n// a number of image widget related rules in one place. This should\n// slightly increase efficiency, but it means that if there is more\n// than one problem with an image widget, the user will only see one\n// problem at a time.\n_module_.exports = Rule.makeRule({\n    name: \"image-widget\",\n    severity: Rule.Severity.BULK_WARNING,\n    selector: \"widget\",\n    lint: function(state, content, nodes, match, context) {\n        // This rule only looks at image widgets\n        if (state.currentNode().widgetType !== \"image\") {\n            return;\n        }\n\n        // If it can't find a definition for the widget it does nothing\n        const widget =\n            context &&\n            context.widgets &&\n            context.widgets[state.currentNode().id];\n        if (!widget) {\n            return;\n        }\n\n        // Make sure there is alt text\n        const alt = widget.options.alt;\n        if (!alt) {\n            return `Images should have alt text:\nfor accessibility, all images should have a text description.\nAdd a description in the \"Alt Text\" box of the image widget.`;\n        }\n\n        // Make sure the alt text it is not trivial\n        if (alt.trim().length < 8) {\n            return `Images should have alt text:\nfor accessibility, all images should have descriptive alt text.\nThis image's alt text is only ${alt.trim().length} characters long.`;\n        }\n\n        // Make sure there is no math in the caption\n        if (widget.options.caption && widget.options.caption.match(/[^\\\\]\\$/)) {\n            return `No math in image captions:\nDon't include math expressions in image captions.`;\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"image-spaces-around-urls\",\n    severity: Rule.Severity.ERROR,\n    selector: \"image\",\n    lint: function(state, content, nodes, match, context) {\n        const image = nodes[0];\n        const url = image.target;\n\n        // The markdown parser strips leading and trailing spaces for us,\n        // but they're still a problem for our translation process, so\n        // we need to go check for them in the unparsed source string\n        // if we have it.\n        if (context && context.content) {\n            // Find the url in the original content and make sure that the\n            // character before is '(' and the character after is ')'\n            const index = context.content.indexOf(url);\n            if (index === -1) {\n                // It is not an error if we didn't find it.\n                return;\n            }\n\n            if (\n                context.content[index - 1] !== \"(\" ||\n                context.content[index + url.length] !== \")\"\n            ) {\n                return `Whitespace before or after image url:\nFor images, don't include any space or newlines after '(' or before ')'.\nWhitespace in image URLs causes translation difficulties.`;\n            }\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n// Because no selector is specified, this rule only applies to text nodes.\n// Math and code hold their content directly and do not have text nodes\n// beneath them (unlike the HTML DOM) so this rule automatically does not\n// apply inside $$ or ``.\n_module_.exports = Rule.makeRule({\n    name: \"unbalanced-code-delimiters\",\n    severity: Rule.Severity.ERROR,\n    pattern: /[`~]+/,\n    message: `Unbalanced code delimiters:\ncode blocks should begin and end with the same type and number of delimiters`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n// Because no selector is specified, this rule only applies to text nodes.\n// Math and code hold their content directly and do not have text nodes\n// beneath them (unlike the HTML DOM) so this rule automatically does not\n// apply inside $$ or ``.\n_module_.exports = Rule.makeRule({\n    name: \"math-without-dollars\",\n    severity: Rule.Severity.GUIDELINE,\n    pattern: /\\\\\\w+{[^}]*}|{|}/,\n    message: `This looks like LaTeX:\ndid you mean to put it inside dollar signs?`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"profanity\",\n    // This list could obviously be expanded a lot, but I figured we\n    // could start with https://en.wikipedia.org/wiki/Seven_dirty_words\n    pattern: /\\b(shit|piss|fuck|cunt|cocksucker|motherfucker|tits)\\b/i,\n    message: \"Avoid profanity\",\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"widget-in-table\",\n    severity: Rule.Severity.BULK_WARNING,\n    selector: \"table widget\",\n    message: `Widget in table:\ndo not put widgets inside of tables.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"unescaped-dollar\",\n    severity: Rule.Severity.ERROR,\n    selector: \"unescapedDollar\",\n    message: `Unescaped dollar sign:\nDollar signs must appear in pairs or be escaped as \\\\$`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"table-missing-cells\",\n    severity: Rule.Severity.WARNING,\n    selector: \"table\",\n    lint: function(state, content, nodes, match) {\n        const table = nodes[0];\n        const headerLength = table.header.length;\n        const rowLengths = table.cells.map(r => r.length);\n        for (let r = 0; r < rowLengths.length; r++) {\n            if (rowLengths[r] !== headerLength) {\n                return `Table rows don't match header:\nThe table header has ${headerLength} cells, but\nRow ${r + 1} has ${rowLengths[r]} cells.`;\n            }\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"nested-lists\",\n    severity: Rule.Severity.WARNING,\n    selector: \"list list\",\n    message: `Nested lists:\nnested lists are hard to read on mobile devices;\ndo not use additional indentation.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-text-empty\",\n    severity: Rule.Severity.WARNING,\n    selector: \"math, blockMath\",\n    pattern: /\\\\text{\\s*}/,\n    message: \"Empty \\\\text{} block in math expression\",\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-starts-with-space\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"math, blockMath\",\n    pattern: /^\\s*(~|\\\\qquad|\\\\quad|\\\\,|\\\\;|\\\\:|\\\\ |\\\\!|\\\\enspace|\\\\phantom)/,\n    message: `Math starts with space:\nmath should not be indented. Do not begin math expressions with\nLaTeX space commands like ~, \\\\;, \\\\quad, or \\\\phantom`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-nested\",\n    severity: Rule.Severity.ERROR,\n    selector: \"math, blockMath\",\n    pattern: /\\\\text{[^$}]*\\$[^$}]*\\$[^}]*}/,\n    message: `Nested math:\nDon't nest math expressions inside \\\\text{} blocks`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-frac\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"math, blockMath\",\n    pattern: /\\\\frac[ {]/,\n    message: \"Use \\\\dfrac instead of \\\\frac in your math expressions.\",\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-font-size\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"math, blockMath\",\n    // eslint-disable-next-line max-len\n    pattern: /\\\\(tiny|Tiny|small|large|Large|LARGE|huge|Huge|scriptsize|normalsize)\\s*{/,\n    message: `Math font size:\nDon't change the default font size with \\\\Large{} or similar commands`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-empty\",\n    severity: Rule.Severity.WARNING,\n    selector: \"math, blockMath\",\n    pattern: /^$/,\n    message: \"Empty math: don't use $$ in your markdown.\",\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-align-linebreaks\",\n    severity: Rule.Severity.WARNING,\n    selector: \"blockMath\",\n    pattern: /\\\\begin{align}.*[^\\\\](\\\\{2,3}[^\\\\]|\\\\{5,}).*\\\\end{align}/,\n    message: \"Use four backslashes between lines of an align block\",\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-align-extra-break\",\n    severity: Rule.Severity.WARNING,\n    selector: \"blockMath\",\n    pattern: /(\\\\{2,})\\s*\\\\end{align}/,\n    message: `Extra space at end of block:\nDon't end an align block with backslashes`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"math-adjacent\",\n    severity: Rule.Severity.WARNING,\n    selector: \"blockMath+blockMath\",\n    message: `Adjacent math blocks:\ncombine the blocks between \\\\begin{align} and \\\\end{align}`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"long-paragraph\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"paragraph\",\n    pattern: /^.{501,}/,\n    lint: function(state, content, nodes, match) {\n        return `Paragraph too long:\nThis paragraph is ${content.length} characters long.\nShorten it to 500 characters or fewer.`;\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"link-click-here\",\n    severity: Rule.Severity.WARNING,\n    selector: \"link\",\n    pattern: /click here/i,\n    message: `Inappropriate link text:\nDo not use the words \"click here\" in links.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"image-in-table\",\n    severity: Rule.Severity.BULK_WARNING,\n    selector: \"table image\",\n    message: `Image in table:\ndo not put images inside of tables.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"image-alt-text\",\n    severity: Rule.Severity.BULK_WARNING,\n    selector: \"image\",\n    lint: function(state, content, nodes, match) {\n        const image = nodes[0];\n        if (!image.alt || !image.alt.trim()) {\n            return `Images should have alt text:\nfor accessibility, all images should have alt text.\nSpecify alt text inside square brackets after the !.`;\n        } else if (image.alt.length < 8) {\n            return `Images should have alt text:\nfor accessibility, all images should have descriptive alt text.\nThis image's alt text is only ${image.alt.length} characters long.`;\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n// These are 3-letter and longer words that we would not expect to be\n// capitalized even in a title-case heading.  See\n// http://blog.apastyle.org/apastyle/2012/03/title-case-and-sentence-case-capitalization-in-apa-style.html\nconst littleWords = {and: true, nor: true, but: true, the: true, for: true};\n\nfunction isCapitalized(word) {\n    const c = word[0];\n    return c === c.toUpperCase();\n}\n\n_module_.exports = Rule.makeRule({\n    name: \"heading-title-case\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"heading\",\n    pattern: /[^\\s:]\\s+[A-Z]+[a-z]/,\n    locale: \"en\",\n    lint: function(state, content, nodes, match) {\n        // We want to assert that heading text is in sentence case, not\n        // title case. The pattern above requires a capital letter at the\n        // start of the heading and allows them after a colon, or in\n        // acronyms that are all capitalized.\n        //\n        // But we can't warn just because the pattern matched because\n        // proper nouns are also allowed bo be capitalized. We're not\n        // going to do dictionary lookup to check for proper nouns, so\n        // we try a heuristic: if the title is more than 3 words long\n        // and if all the words are capitalized or are on the list of\n        // words that don't get capitalized, then we'll assume that\n        // the heading is incorrectly in title case and will warn.\n        // But if there is at least one non-capitalized long word then\n        // we're not in title case and we should not warn.\n        //\n        // TODO(davidflanagan): if this rule causes a lot of false\n        // positives, we should tweak it or remove it. Note that it will\n        // fail for headings like \"World War II in Russia\"\n        //\n        // TODO(davidflanagan): This rule is specific to English.\n        // It is marked with a locale property above, but that is NYI\n        //\n        // for APA style rules for title case\n\n        const heading = content.trim();\n        let words = heading.split(/\\s+/);\n\n        // Remove the first word and the little words\n        words.shift();\n        words = words.filter(\n            w => w.length > 2 && !littleWords.hasOwnProperty(w)\n        );\n\n        // If there are at least 3 remaining words and all\n        // are capitalized, then the heading is in title case.\n        if (words.length >= 3 && words.every(w => isCapitalized(w))) {\n            return `Title-case heading:\nThis heading appears to be in title-case, but should be sentence-case.\nOnly capitalize the first letter and proper nouns.`;\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"heading-sentence-case\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"heading\",\n    pattern: /^\\W*[a-z]/, // first letter is lowercase\n    message: `First letter is lowercase:\nthe first letter of a heading should be capitalized.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"heading-level-skip\",\n    severity: Rule.Severity.WARNING,\n    selector: \"heading ~ heading\",\n    lint: function(state, content, nodes, match) {\n        const currentHeading = nodes[1];\n        const previousHeading = nodes[0];\n        // A heading can have a level less than, the same as\n        // or one more than the previous heading. But going up\n        // by 2 or more levels is not right\n        if (currentHeading.level > previousHeading.level + 1) {\n            return `Skipped heading level:\nthis heading is level ${currentHeading.level} but\nthe previous heading was level ${previousHeading.level}`;\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"heading-level-1\",\n    severity: Rule.Severity.WARNING,\n    selector: \"heading\",\n    lint: function(state, content, nodes, match) {\n        if (nodes[0].level === 1) {\n            return `Don't use level-1 headings:\nBegin headings with two or more # characters.`;\n        }\n    },\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"extra-content-spacing\",\n    selector: \"paragraph\",\n    pattern: /\\s+$/,\n    applies: function(context) {\n        return context.contentType === 'article';\n    },\n    message: `No extra whitespace at the end of content blocks.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"double-spacing-after-terminal\",\n    severity: Rule.Severity.BULK_WARNING,\n    selector: \"paragraph\",\n    pattern: /[.!\\?] {2}/i,\n    message: `Use a single space after a sentence-ending period, or\nany other kind of terminal punctuation.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"blockquoted-widget\",\n    severity: Rule.Severity.WARNING,\n    selector: \"blockQuote widget\",\n    message: `Blockquoted widget:\nwidgets should not be indented.`,\n});\nexport default _module_.exports;\n","import Rule from \"../rule.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"blockquoted-math\",\n    severity: Rule.Severity.WARNING,\n    selector: \"blockQuote math, blockQuote blockMath\",\n    message: `Blockquoted math:\nmath should not be indented.`,\n});\nexport default _module_.exports;\n","// Return the portion of a URL between // and /. This is the authority\n// portion which is usually just the hostname, but may also include\n// a username, password or port. We don't strip those things out because\n// we typically want to reject any URL that includes them\nconst HOSTNAME = /\\/\\/([^\\/]+)/;\n\n// Return the hostname of the URL, with any \"www.\" prefix removed.\n// If this is a relative URL with no hostname, return an empty string.\nexport function getHostname(url) {\n    if (!url) {\n        return \"\";\n    }\n    const match = url.match(HOSTNAME);\n    return match ? match[1] : \"\";\n}\n\n// This list of domains that count as internal domains is from\n// webapp/content/models.py and webapp/url_util.py\nconst internalDomains = {\n    \"khanacademy.org\": true,\n    \"www.khanacademy.org\": true,\n    \"kasandbox.org\": true,\n    \"fastly.kastatic.org\": true,\n    \"cdn.kastatic.org\": true,\n    \"KA-youtube-converted.s3.amazonaws.com\": true,\n    \"KA-share.s3.amazonaws.com\": true,\n    \"ka-article-iframes.s3.amazonaws.com\": true,\n    \"ka-cs-algorithms.s3.amazonaws.com\": true,\n    \"ka-cs-challenge-images.s3.amazonaws.com\": true,\n    \"ka-cs-scratchpad-audio.s3.amazonaws.com\": true,\n    \"ka-exercise-screenshots.s3.amazonaws.com\": true,\n    \"ka-exercise-screenshots-2.s3.amazonaws.com\": true,\n    \"ka-exercise-screenshots-3.s3.amazonaws.com\": true,\n    \"ka-learnstorm.s3.amazonaws.com\": true,\n    \"ka-mobile.s3.amazonaws.com\": true,\n    \"ka-perseus-graphie.s3.amazonaws.com\": true,\n    \"ka-perseus-images.s3.amazonaws.com\": true,\n};\n\n// Returns true if this URL is relative, or if it is an absolute\n// URL with one of the domains listed above as its hostname.\nexport function isInternalURL(url) {\n    const hostname = getHostname(url);\n    return hostname === \"\" || internalDomains.hasOwnProperty(hostname);\n}\n","import Rule from \"../rule.js\";\nimport {getHostname} from \"./lint-utils.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = Rule.makeRule({\n    name: \"absolute-url\",\n    severity: Rule.Severity.GUIDELINE,\n    selector: \"link, image\",\n    lint: function(state, content, nodes, match) {\n        const url = nodes[0].target;\n        const hostname = getHostname(url);\n\n        if (\n            hostname === \"khanacademy.org\" ||\n            hostname.endsWith(\".khanacademy.org\")\n        ) {\n            return `Don't use absolute URLs:\nWhen linking to KA content or images, omit the\nhttps://www.khanacademy.org URL prefix.\nUse a relative URL beginning with / instead.`;\n        }\n    },\n});\nexport default _module_.exports;\n","import _imageWidgetJs from \"./image-widget.js\";\nimport _imageSpacesAroundUrlsJs from \"./image-spaces-around-urls.js\";\nimport _unbalancedCodeDelimitersJs from \"./unbalanced-code-delimiters.js\";\nimport _mathWithoutDollarsJs from \"./math-without-dollars.js\";\nimport _profanityJs from \"./profanity.js\";\nimport _widgetInTableJs from \"./widget-in-table.js\";\nimport _unescapedDollarJs from \"./unescaped-dollar.js\";\nimport _tableMissingCellsJs from \"./table-missing-cells.js\";\nimport _nestedListsJs from \"./nested-lists.js\";\nimport _mathTextEmptyJs from \"./math-text-empty.js\";\nimport _mathStartsWithSpaceJs from \"./math-starts-with-space.js\";\nimport _mathNestedJs from \"./math-nested.js\";\nimport _mathFracJs from \"./math-frac.js\";\nimport _mathFontSizeJs from \"./math-font-size.js\";\nimport _mathEmptyJs from \"./math-empty.js\";\nimport _mathAlignLinebreaksJs from \"./math-align-linebreaks.js\";\nimport _mathAlignExtraBreakJs from \"./math-align-extra-break.js\";\nimport _mathAdjacentJs from \"./math-adjacent.js\";\nimport _longParagraphJs from \"./long-paragraph.js\";\nimport _linkClickHereJs from \"./link-click-here.js\";\nimport _imageInTableJs from \"./image-in-table.js\";\nimport _imageAltTextJs from \"./image-alt-text.js\";\nimport _headingTitleCaseJs from \"./heading-title-case.js\";\nimport _headingSentenceCaseJs from \"./heading-sentence-case.js\";\nimport _headingLevelSkipJs from \"./heading-level-skip.js\";\nimport _headingLevel1Js from \"./heading-level-1.js\";\nimport _extraContentSpacingJs from \"./extra-content-spacing.js\";\nimport _doubleSpacingAfterTerminalJs from \"./double-spacing-after-terminal.js\";\nimport _blockquotedWidgetJs from \"./blockquoted-widget.js\";\nimport _blockquotedMathJs from \"./blockquoted-math.js\";\nimport _absoluteUrlJs from \"./absolute-url.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n// TODO(davidflanagan):\n// This should probably be converted to use import and to export\n// and object that maps rule names to rules. Also, maybe this should\n// be an auto-generated file with a script that updates it any time\n// we add a new rule?\n_module_.exports = [\n    _absoluteUrlJs,\n    _blockquotedMathJs,\n    _blockquotedWidgetJs,\n    _doubleSpacingAfterTerminalJs,\n    _extraContentSpacingJs,\n    _headingLevel1Js,\n    _headingLevelSkipJs,\n    _headingSentenceCaseJs,\n    _headingTitleCaseJs,\n    _imageAltTextJs,\n    _imageInTableJs,\n    _linkClickHereJs,\n    _longParagraphJs,\n    _mathAdjacentJs,\n    _mathAlignExtraBreakJs,\n    _mathAlignLinebreaksJs,\n    _mathEmptyJs,\n    _mathFontSizeJs,\n    _mathFracJs,\n    _mathNestedJs,\n    _mathStartsWithSpaceJs,\n    _mathTextEmptyJs,\n    _nestedListsJs,\n    _tableMissingCellsJs,\n    _unescapedDollarJs,\n    _widgetInTableJs,\n    _profanityJs,\n    _mathWithoutDollarsJs,\n    _unbalancedCodeDelimitersJs,\n    _imageSpacesAroundUrlsJs,\n    _imageWidgetJs,\n];\nexport default _module_.exports;\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types */\n\n/**\n * A stripped version of Icon.jsx from webapp. Takes an SVG icon and renders it\n * inline like Font Awesome did.\n *\n * If you are looking for an icon that we've used before you should look in\n * webapp's `icon-paths.js` which is a reference file for all the SVG paths\n * that we've used. You'll need to copy the object from that file into\n * whichever file you're using the icon and explicitly pass it in to the\n * <InlineIcon/> React component.\n *\n * We assume that the viewBox is cropped and aligned to (0, 0), but icons can\n * be defined differently. At some point we might want to add these attributes\n * to `icon-paths.js`, but for now this is a fairly safe assumption.\n *\n * Sample usage:\n *\n *   const editIcon = {\n *      path: \"M41.209 53.753l5.39 0l0 5.39l3.136 0l6.468-6.517-8.477-8.526-6.517 6.517l0 3.136zm33.173-34.937q-.882-.882-1.862.049l-19.6 19.6q-.931.98-.049 1.862t1.862-.049l19.6-19.6q.931-.98.049-1.862zm-38.563 45.668l0-16.121l37.632-37.632 16.17 16.121-37.632 37.632l-16.17 0zm43.022-12.397l0 10.633q-.049 6.713-4.753 11.417t-11.368 4.704l-46.599 0q-6.713 0-11.417-4.753t-4.704-11.368l0-46.599q0-6.664 4.753-11.417t11.368-4.704l46.599 0q3.528 0 6.566 1.372.833.392.98 1.323t-.49 1.617l-2.744 2.744q-.784.784-1.96.441t-2.352-.343l-46.599 0q-3.675 0-6.321 2.646t-2.646 6.321l0 46.599q0 3.675 2.646 6.321t6.321 2.646l46.599 0q3.675 0 6.321-2.646t2.646-6.321l0-7.056q0-.735.49-1.225l3.577-3.577q.833-.833 1.96-.392t1.127 1.617zm7.203-51.646q2.254 0 3.773 1.568l8.526 8.526q1.568 1.568 1.568 3.822t-1.568 3.773l-5.145 5.145-16.121-16.121 5.145-5.145q1.568-1.568 3.822-1.568z\", // @Nolint\n *      width: 100,\n *      height: 78.912,\n *   };\n *   <InlineIcon {...editIcon} />\n *\n */\nconst React = _react;\n\nconst InlineIcon = (\n    {\n        path,\n        width,\n        height,\n        style = {},\n        title\n    }\n) => <svg\n    role=\"img\"\n    aria-hidden={!title}\n    style={{verticalAlign: \"middle\", ...style}}\n    width={`${width / height}em`}\n    height=\"1em\"\n    viewBox={`0 0 ${width} ${height}`}\n>\n    {!!title && <title>{title}</title>}\n    <path d={path} fill=\"currentColor\" />\n</svg>;\n\nInlineIcon.propTypes = {\n    // An SVG path to render.\n    path: PropTypes.string.isRequired,\n\n    // The path's viewBox dimensions.\n    // We set the viewport height to 1em and scale the width accordingly.\n    height: PropTypes.number.isRequired,\n    width: PropTypes.number.isRequired,\n\n    style: PropTypes.object,\n\n    // A11y description for this icon. If absent, icon is marked\n    // aria-hidden=true\n    title: PropTypes.string,\n};\n\n_module_.exports = InlineIcon;\nexport default _module_.exports;\n","// Generated by running:\n// `node less-to-js.js 'stylesheets/exercise-content-package/variables.less'`\n    // @baseFontFamily =        \"Proxima Nova\"; sans-serif;\nexport const baseFontFamily = \"'Proxima Nova',sans-serif\";\n    // @boldFontFamily =        \"Proxima Nova Semibold\"; sans-serif;\nexport const boldFontFamily = \"'Proxima Nova Semibold',sans-serif\";\n    // @green:                 #76a005;\nexport const green = \"#76A005\";\n    // @kaGreen:               #71b307;\nexport const kaGreen = \"#71B307\";\n    // @blue:                  #1c758a;\nexport const blue = \"#1C758A\";\n    // @gray:                  #aaa;\nexport const gray = \"#AAAAAA\";\n    // @red:                   #ffbaba;\nexport const red = \"#FFBABA\";\n    // @questionWidth:         480px;\nexport const questionWidth = \"480px\";\n    // @grayLight:             #aaa;\nexport const grayLight = \"#AAAAAA\";\n    // @grayLighter:           #ddd;\nexport const grayLighter = \"#DDDDDD\";\n    // @learnstormBlue:        #4898fc;\nexport const learnstormBlue = \"#4898FC\";\n\nexport const white = '#FFFFFF';\nexport const gray98 = '#FAFAFA';\nexport const gray97 = '#F6F7F7';\nexport const gray95 = '#F0F1F2';\nexport const gray90 = '#E3E5E6';\nexport const gray85 = '#D6D8DA';\nexport const gray76 = '#BABEC2';\nexport const gray68 = '#888D93';\nexport const gray41 = '#626569';\nexport const gray25 = '#3B3e40';\nexport const gray17 = '#21242c';\nexport const black = '#000000';\n\nexport const warning1 = '#F86700';\nexport const warning3 = '#C75300';\n\n    // @pure-sm-min: 568px;\nexport const pureSmMin = \"568px\";\n    // @pure-md-min: 768px;\nexport const pureMdMin = \"768px\";\n    // @pure-lg-min: 1024px;\nexport const pureLgMin = \"1024px\";\n    // @pure-xl-min: 1280px;\nexport const pureXlMin = \"1280px\";\n    // @pure-xs-max: (@pure-sm-min - 1);\nexport const pureXsMax = \"567px\";\n    // @pure-sm-max: (@pure-md-min - 1);\nexport const pureSmMax = \"767px\";\n    // @pure-md-max: (@pure-lg-min - 1);\nexport const pureMdMax = \"1023px\";\n    // @pure-lg-max: (@pure-xl-min - 1);\nexport const pureLgMax = \"1279px\";\n    // @tableBackgroundAccent: #f9f9f9; // for striping\nexport const tableBackgroundAccent = \"#F9F9F9\";\nexport const gtpBlue = \"#4c00ff\";\nexport const gtpIncorrectColor = \"#babec2\";\nexport const gtpCorrectColor = \"#ffbe26\";\n    // @satBlue:               #0084ce;\nexport const satBlue = \"#0084CE\";\n    // @satSelectedBackgroundColor: #e4f3f9;\nexport const satSelectedBackgroundColor = \"#E4F3F9\";\n    // @satActiveBackgroundColor: #d0edf4;\nexport const satActiveBackgroundColor = \"#D0EDF4\";\n    // @satCorrectColor:       #009900;\nexport const satCorrectColor = \"#009900\";\n    // @satCorrectBorderColor: #00cc00;\nexport const satCorrectBorderColor = \"#00CC00\";\n    // @satCorrectBackgroundColor: #e4f7e4;\nexport const satCorrectBackgroundColor = \"#E4F7E4\";\n    // @satIncorrectColor:     #990000;\nexport const satIncorrectColor = \"#990000\";\n    // @satIncorrectBorderColor: #cc5252;\nexport const satIncorrectBorderColor = \"#CC5252\";\n    // @satIncorrectBackgroundColor: #f2ebeb;\nexport const satIncorrectBackgroundColor = \"#F2EBEB\";\n    // @zIndexScratchPad: 1;\nexport const zIndexScratchPad = \"1\";\n    // @zIndexAboveScratchpad: @zIndexScratchPad + 1;\nexport const zIndexAboveScratchpad = \"2\";\n    // @zIndexInteractiveComponent: @zIndexAboveScratchpad + 1;\nexport const zIndexInteractiveComponent = \"3\";\n    // @zIndexCurrentlyDragging: @zIndexInteractiveComponent + 1;\nexport const zIndexCurrentlyDragging = \"4\";\n    // @zIndexCalculator: @zIndexCurrentlyDragging + 1;\nexport const zIndexCalculator = \"5\";\n    // @phoneMargin: 16px;\nexport const phoneMargin = 16;\n\nexport const negativePhoneMargin = -16;\nexport const hintBorderWidth = 4;\n\n    // The 'base unit' -- our new typography and layout styles are defined in\n    // terms of multiples of the 'base unit'.\nexport const baseUnitPx = 16;\n\nexport const interactiveSizes = {\n  defaultBoxSize: 400,\n  defaultBoxSizeSmall: 288,\n};\n\nexport const circleSize = 24;\nexport const radioMarginWidth = 2;\n\nexport const warningColor = \"#f86700\";\nexport const warningColorHover = \"#df5c00\";\nexport const warningColorActive = \"#c75300\";\n\nexport const publishBlockingErrorColor = \"#be2612\";\n\nexport const radioBorderColor = gray76;\nexport const checkedColor = kaGreen;\n","import _inlineIconJsx from \"./inline-icon.jsx\";\nimport * as constants from \"../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\n/**\n * This component renders \"lint\" nodes in a markdown parse tree. Lint nodes\n * are inserted into the tree by the Gorgon linter (see src/gorgon/gorgon.js).\n *\n * This component serves multiple purposes\n *\n * 1) It renders a small circle in the right margin to indicate that there\n * is lint on (or near) that line.\n *\n * 2) The area around the circle is hoverable: when the mouse moves over it\n * the linty content is highlighted and a tooltip is displayed that explains\n * what the problem is.\n *\n * 3) The hoverable area is also an HTML <a> tag. Clicking on it opens\n * a new tab and links to additional details about the specific lint rule.\n *\n * The CSS required to position the circles in the right margin is tricky\n * and it does not always work perfectly. When lint occurs on a block element\n * that has a right margin (like anything blockquoted) the circle will appear\n * to the left of where it belongs.  And if there is more\n **/\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst InlineIcon = _inlineIconJsx;\n\nconst exclamationIcon = {\n    path: \"M6 11a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm0-9a1 1 0 0 1 1 1v4a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1z\", // eslint-disable-line max-len\n    height: 12,\n    width: 12,\n};\n\nconst Lint = createReactClass({\n    propTypes: {\n        // The children are the linty content we're highlighting\n        children: PropTypes.node,\n        // Inline lint is highlighted differently than block lint.\n        inline: PropTypes.bool,\n        // This is the text that appears in the tooltip\n        message: PropTypes.string.isRequired,\n        // This is used as the fragment id (hash) in the URL of the link\n        ruleName: PropTypes.string.isRequired,\n        // Lint warnings inside tables are handled specially\n        insideTable: PropTypes.bool.isRequired,\n        // How important this lint message is for the editor. Severity goes\n        // from 1 (indicating an error) to 4 (offline reporting only)\n        severity: PropTypes.number,\n    },\n\n    getInitialState: function() {\n        return {\n            tooltipAbove: true,\n        };\n    },\n\n    componentDidMount: function() {\n        this._positionTimeout = window.setTimeout(this.getPosition);\n    },\n\n    componentWillUnmount: function() {\n        window.clearTimeout(this._positionTimeout);\n    },\n\n    // We can't call setState in componentDidMount without risking a render\n    // thrash, and we can't call getBoundingClientRect in render, so we\n    // borrow a timeout approach from learnstorm-dashboard.jsx and set our\n    // state once the component has mounted and we can get what we need.\n    getPosition: function() {\n        const rect = ReactDOM.findDOMNode(this).getBoundingClientRect();\n        // TODO(scottgrant): This is a magic number! We don't know the size\n        // of the tooltip at this point, so we're arbitrarily choosing a\n        // point at which to flip the tooltip's position.\n        this.setState({tooltipAbove: rect.top > 100});\n    },\n\n    // Render the <a> element that holds the indicator icon and the tooltip\n    // We pass different styles for the inline and block cases\n    renderLink: function(style) {\n        const tooltipAbove = this.state.tooltipAbove;\n\n        let severityStyle;\n        let warningText;\n        let warningTextStyle;\n        if (this.props.severity === 1) {\n            severityStyle = styles.indicatorError;\n            warningText = \"Error\";\n            warningTextStyle = styles.publishBlockingError;\n        } else if (this.props.severity ===  2) {\n            severityStyle = styles.indicatorWarning;\n            warningText = \"Warning\";\n            warningTextStyle = styles.warning;\n        } else {\n            severityStyle = styles.indicatorGuideline;\n            warningText = \"Recommendation\";\n            warningTextStyle = styles.warning;\n        }\n\n        return (\n            <a\n                href={\n                    \"https://khanacademy.org/r/linter-rules#\" +\n                    this.props.ruleName\n                }\n                target=\"lint-help-window\"\n                className={css(style)}\n            >\n                <span className={css(styles.indicator, severityStyle)}>\n                    {this.props.severity === 1 &&\n                        <InlineIcon {...exclamationIcon} />}\n                </span>\n                <div\n                    className={css(\n                        styles.tooltip, tooltipAbove && styles.tooltipAbove\n                    )}\n                >\n                    {this.props.message.split(\"\\n\\n\").map((m, i) => <p key={i} className={css(styles.tooltipParagraph)}>\n                        <span className={css(warningTextStyle)}>\n                            {warningText}:{\" \"}\n                        </span>\n                        {m}\n                    </p>\n                    )}\n                    <div\n                        className={css(\n                            styles.tail, tooltipAbove && styles.tailAbove\n                        )}\n                    />\n                </div>\n            </a>\n        );\n    },\n\n    // The main render method surrounds linty content with a block or\n    // inline container and the link element that displays the indicator\n    // and holds the tooltip.\n    render: function() {\n        if (this.props.insideTable) {\n            // If we're inside a table, then linty nodes just get\n            // a simple wrapper that allows them to be highlighted\n            if (this.props.inline) {\n                return (\n                    <span data-lint-inside-table=\"true\">\n                        {this.props.children}\n                    </span>\n                );\n            } else {\n                return (\n                    <div data-lint-inside-table=\"true\">\n                        {this.props.children}\n                    </div>\n                );\n            }\n        } else {\n            if (this.props.inline) {\n                return (\n                    <span className={css(styles.lintContainer)}>\n                        {this.renderLink(styles.inlineHoverTarget)}\n                        <span>\n                            {this.props.children}\n                        </span>\n                    </span>\n                );\n            } else {\n                return (\n                    <div className={css(styles.lintContainer)}>\n                        {this.renderLink(styles.hoverTarget)}\n                        <div>\n                            {this.props.children}\n                        </div>\n                    </div>\n                );\n            }\n        }\n    },\n});\n\nconst styles = StyleSheet.create({\n    // This is the class of the outermost element.\n    // We use relative positioning so that the lint indicator can be\n    // positioned absolutely relative to the position of the linty container.\n    lintContainer: {\n        position: \"relative\",\n    },\n\n    // This is the main class for block lint. It is applied to the link element\n    // that is also the hover target.\n    hoverTarget: {\n        // Absolute positioning relative to the lintContainer element\n        position: \"absolute\",\n        // Top of the hover target is aligned with the top of the linty block\n        top: 0,\n\n        // We want the hover target in the right margin. It is 24px wide, but\n        // we have to offset it another 16px because of margins in the\n        // Perseus content. I'm not sure where the 16px margin is set\n        // so if that changes, this number will also have to be changed.\n        // This is the part of the CSS that doesn't work right when\n        // applied to things like blockquotes that have different right\n        // margins.\n        right: -40,\n\n        // The hover target is a 24x24 block element.\n        display: \"block\",\n        width: 24,\n        height: 24,\n\n        // The indicator is in a span inside the hover target.\n        // This style changes its color on hover\n        \":hover > span\": {\n            backgroundColor: constants.warningColorHover,\n        },\n\n        // The tooltip is in a div element inside the hover target.\n        // This style displays it on hover\n        \":hover div\": {\n            display: \"block\",\n        },\n\n        // The linty content is in a <div> sibling that follows the\n        // hover target. This style highlights it on hover. We do an outline\n        // rather than a border so we don't affect the layout. We could also\n        // set the background color, but we don't because we can't reliably\n        // set the text color of this block element. We could use\n        // filter: invert(100%) if we want more visual change on hover here.\n        \":hover ~ div\": {\n            outline: \"1px solid \" + constants.warningColor,\n        },\n\n        // If the div sibling is a table, then we may be displaying\n        // lint warnings about errors inside that table. In that case\n        // we want to highlight any linty descendants of the table\n        \":hover ~ div div[data-lint-inside-table]\": {\n            outline: \"1px solid \" + constants.warningColor,\n        },\n\n        \":hover ~ div span[data-lint-inside-table]\": {\n            backgroundColor: constants.warningColor,\n            color: constants.white,\n        },\n    },\n\n    // This is how we position the hover target for inline lint.\n    inlineHoverTarget: {\n        // For inline lint we position the hover target with a float:right\n        // We can't use absolute positioning as we do in the block case\n        // because the horizontal position is not predictable in the\n        // inline case.\n        float: \"right\",\n\n        // We still have to make the hover target relative so that the\n        // tooltip can be positioned relative to it.\n        position: \"relative\",\n\n        // See the comment above about the extra 16px of offset needed here.\n        marginRight: -40,\n\n        // The hover target is a 24x24 block. Same as the block case\n        display: \"block\",\n        width: 24,\n        height: 24,\n\n        // The indicator is in a span inside the hover target.\n        // This style changes its color on hover.\n        // This is the same as the block case.\n        \":hover > span\": {\n            backgroundColor: constants.warningColorHover,\n        },\n\n        // The tooltip is in a div element inside the hover target.\n        // This style displays it on hover. This is the same as the block case.\n        \":hover div\": {\n            display: \"block\",\n        },\n\n        // The linty content is in a <span> sibling that follows the\n        // hover target. This style highlights it on hover. In this case\n        // we can just set the foreground and background color to really\n        // draw attention to the linty content.\n        \":hover ~ span\": {\n            backgroundColor: constants.warningColor,\n            color: constants.white,\n        },\n    },\n\n    // This is the class for the lint indicator in the margin.\n    indicator: {\n        alignItems: 'center',\n        borderRadius: 4,\n        color: 'white',\n        display: 'flex',\n        fontSize: 12,\n        height: 8,\n        justifyContent: 'center',\n        margin: 8,\n        width: 8,\n    },\n    indicatorError: {\n        backgroundColor: '#be2612',\n        borderRadius: 8,\n        height: 16,\n        width: 16,\n    },\n    indicatorWarning: {\n        backgroundColor: '#f86700',\n    },\n    indicatorGuideline: {\n        backgroundColor: '#ffbe26',\n    },\n\n    // These are the styles for the tooltip\n    tooltip: {\n        // Absolute positioning relative to the lint indicator circle.\n        position: \"absolute\",\n        right: -12,\n\n        // The tooltip is hidden by default; only displayed on hover\n        display: \"none\",\n\n        // When it is displayed, it goes on top!\n        zIndex: \"1000\",\n\n        // These styles control what the tooltip looks like\n        color: constants.white,\n        backgroundColor: constants.gray17,\n        opacity: \"0.9\",\n        fontFamily: constants.baseFontFamily,\n        fontSize: \"12px\",\n        lineHeight: \"15px\",\n        width: \"320px\",\n        borderRadius: \"4px\",\n    },\n    // If we're going to render the tooltip above the warning circle, we use\n    // the previous rules in tooltip, but change the position slightly.\n    tooltipAbove: {\n        bottom: 32,\n    },\n\n    // We give the tooltip a little triangular \"tail\" that points down at\n    // the lint indicator circle. This is inside the tooltip and positioned\n    // relative to it. It also shares the opacity of the tooltip. We're using\n    // the standard CSS trick for drawing triangles with a thick border.\n    tail: {\n        position: \"absolute\",\n        top: -12,\n        right: 16,\n        width: 0,\n        height: 0,\n\n        // This is the CSS triangle trick\n        borderLeft: \"8px solid transparent\",\n        borderRight: \"8px solid transparent\",\n        borderBottom: \"12px solid \" + constants.gray17,\n    },\n    tailAbove: {\n        bottom: -12,\n        borderBottom: \"none\",\n        borderTop: \"12px solid \" + constants.gray17,\n        top: \"auto\",\n    },\n\n    // Each warning in the tooltip is its own <p>. They are 12 pixels from\n    // the edges of the tooltip and 12 pixels from each other.\n    tooltipParagraph: {\n        margin: 12,\n    },\n\n    // The text \"Warning\" inside the tooltip is highlighted like this\n    warning: {\n        color: constants.warningColor,\n        fontFamily: constants.boldFontFamily,\n    },\n\n    // The text \"Publish-blocking error\" instide the tooltip is highlighted\n    // like this\n    publishBlockingError: {\n        color: constants.publishBlockingErrorColor,\n    },\n\n});\n\nexport default Lint;\n","import _componentsLintJsx from \"./components/lint.jsx\";\nimport _utilJs from \"./util.js\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _simpleMarkdown from \"simple-markdown\";\nimport _underscore from \"underscore\";\nimport React from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals KA */\nvar _ = _underscore;\n\nvar SimpleMarkdown = _simpleMarkdown;\nvar TeX = _reactComponentsTexJsx;\nvar Util = _utilJs;\nconst Lint = _componentsLintJsx;\n\n/**\n * This match function matches math in `$`s, such as:\n *\n * $y = x + 1$\n *\n * It functions roughly like the following regex:\n * /\\$([^\\$]*)\\$/\n *\n * Unfortunately, math may have other `$`s inside it, as\n * long as they are inside `{` braces `}`, mostly for\n * `\\text{ $math$ }`.\n *\n * To parse this, we can't use a regex, since we\n * should support arbitrary nesting (even though\n * MathJax actually only supports two levels of nesting\n * here, which we *could* parse with a regex).\n *\n * Non-regex matchers like this are now a first-class\n * concept in simple-markdown. Yay!\n *\n * This can also match block-math, which is math alone in a paragraph.\n */\nvar mathMatcher = (source, state, isBlock) => {\n    var length = source.length;\n    var index = 0;\n\n    // When looking for blocks, skip over leading spaces\n    if (isBlock) {\n        if (state.inline) {\n            return null;\n        }\n        while (index < length && source[index] === \" \") {\n            index++;\n        }\n    }\n\n    // Our source must start with a \"$\"\n    if (!(index < length && source[index] === \"$\")) {\n        return null;\n    }\n\n    index++;\n    var startIndex = index;\n    var braceLevel = 0;\n\n    // Loop through the source, looking for a closing '$'\n    // closing '$'s only count if they are not escaped with\n    // a `\\`, and we are not in nested `{}` braces.\n    while (index < length) {\n        var character = source[index];\n\n        if (character === \"\\\\\") {\n            // Consume both the `\\` and the escaped char as a single\n            // token.\n            // This is so that the second `$` in `$\\\\$` closes\n            // the math expression, since the first `\\` is escaping\n            // the second `\\`, but the second `\\` is not escaping\n            // the second `$`.\n            // This also handles the case of escaping `$`s or\n            // braces `\\{`\n            index++;\n        } else if (braceLevel <= 0 && character === \"$\") {\n            var endIndex = index + 1;\n            if (isBlock) {\n                // Look for two trailing newlines after the closing `$`\n                var match = /^(?: *\\n){2,}/.exec(source.slice(endIndex));\n                endIndex = match ? endIndex + match[0].length : null;\n            }\n\n            // Return an array that looks like the results of a\n            // regex's .exec function:\n            // capture[0] is the whole string\n            // capture[1] is the first \"paren\" match, which is the\n            //   content of the math here, as if we wrote the regex\n            //   /\\$([^\\$]*)\\$/\n            if (endIndex) {\n                return [\n                    source.substring(0, endIndex),\n                    source.substring(startIndex, index),\n                ];\n            }\n            return null;\n        } else if (character === \"{\") {\n            braceLevel++;\n        } else if (character === \"}\") {\n            braceLevel--;\n        } else if (character === \"\\n\" && source[index - 1] === \"\\n\") {\n            // This is a weird case we supported in the old\n            // math implementation--double newlines break\n            // math. I'm preserving it for now because content\n            // creators might have questions with single '$'s\n            // in paragraphs...\n            return null;\n        }\n\n        index++;\n    }\n\n    // we didn't find a closing `$`\n    return null;\n};\nvar mathMatch = (source, state) => mathMatcher(source, state, false);\nvar blockMathMatch = (source, state) => mathMatcher(source, state, true);\n\nvar TITLED_TABLE_REGEX = new RegExp(\n    \"^\\\\|\\\\| +(.*) +\\\\|\\\\| *\\\\n\" +\n        \"(\" +\n        // The simple-markdown nptable regex, without\n        // the leading `^`\n        SimpleMarkdown.defaultRules.nptable.match.regex.source.substring(1) +\n        \")\"\n);\n\nvar crowdinJiptMatcher = SimpleMarkdown.blockRegex(/^(crwdns.*)\\n\\s*\\n/);\n\nvar rules = _.extend({}, SimpleMarkdown.defaultRules, {\n    // NOTE: basically ignored by JIPT. wraps everything at the outer layer\n    columns: {\n        order: -2,\n        match: SimpleMarkdown.blockRegex(/^([\\s\\S]*\\n\\n)={5,}\\n\\n([\\s\\S]*)/),\n        parse: (capture, parse, state) => {\n            return {\n                col1: parse(capture[1], state),\n                col2: parse(capture[2], state),\n            };\n        },\n        react: (node, output, state) => {\n            return (\n                <div className=\"perseus-two-columns\" key={state.key}>\n                    <div className=\"perseus-column\">\n                        <div className=\"perseus-column-content\">\n                            {output(node.col1, state)}\n                        </div>\n                    </div>\n                    <div className=\"perseus-column\">\n                        {/* HACK(#sat) This is a cheap way to allow a custom\n                      * header to be displayed in two-column items in the SAT\n                      * mission.\n                      * The header will be rendered into this div. Do not write\n                      * code outside of the SAT mission that relies on this\n                      * because this will be cleaned up with other SAT\n                      * technical debt. */}\n                        <div className=\"sat-header-grafting-area\" />\n\n                        <div className=\"perseus-column-content\">\n                            {/* HACK(#sat) This is a cheap way to allow a\n                          * custom review-mode skill box to be displayed in\n                          * SAT.\n                          * Don't write code outside of the SAT mission that\n                          * relies on this div because we are still telling\n                          * ourselves this will be cleaned up along with other\n                          * SAT technical debt. */}\n                            <div className=\"sat-skill-subscore-grafting-area\" />\n                            {output(node.col2, state)}\n                            {/* HACK(#sat) This is a cheap way to allow hints\n                          * to be displayed in two-column items in the SAT\n                          * mission.\n                          * The hint renderer will be rendered into this div.\n                          * Do not write code outside of the SAT mission that\n                          * relies on this because this will be cleaned up with\n                          * other SAT technical debt. */}\n                            <div className=\"sat-grafting-area\" />\n                        </div>\n                    </div>\n                </div>\n            );\n        },\n    },\n    // Match paragraphs consisting solely of crowdin IDs\n    // (they look roughly like crwdns9238932:0), which means that\n    // crowdin is going to take the DOM node that ID is rendered into\n    // and count it as the top-level translation node. They mutate this\n    // node, so we need to make sure it is an outer node, not an inner\n    // span. So here we parse this separately and just output the\n    // raw string, which becomes the body of the <QuestionParagraph>\n    // created by the Renderer.\n    // This currently (2015-09-01) affects only articles, since\n    // for exercises the renderer just renders the crowdin id to the\n    // renderer div.\n    crowdinId: {\n        order: -1,\n        match: (source, state, prevCapture) => {\n            // Only match on the just-in-place translation site\n            if (state.isJipt) {\n                return crowdinJiptMatcher(source, state, prevCapture);\n            } else {\n                return null;\n            }\n        },\n        parse: (capture, parse, state) => ({\n            id: capture[1]\n        }),\n        react: (node, output, state) => node.id,\n    },\n    // This is pretty much horrible, but we have a regex here to capture an\n    // entire table + a title. capture[1] is the title. capture[2] of the\n    // regex is a copy of the simple-markdown nptable regex. Then we turn\n    // our capture[2] into tableCapture[0], and any further captures in\n    // our table regex into tableCapture[1..], and we pass tableCapture to\n    // our nptable regex\n    titledTable: {\n        // process immediately before nptables\n        order: SimpleMarkdown.defaultRules.nptable.order - 0.5,\n        match: SimpleMarkdown.blockRegex(TITLED_TABLE_REGEX),\n        parse: (capture, parse, state) => {\n            var title = SimpleMarkdown.parseInline(parse, capture[1], state);\n\n            // Remove our [0] and [1] captures, and pass the rest to\n            // the nptable parser\n            var tableCapture = _.rest(capture, 2);\n            var table = SimpleMarkdown.defaultRules.nptable.parse(\n                tableCapture,\n                parse,\n                state\n            );\n            return {\n                title: title,\n                table: table,\n            };\n        },\n        react: (node, output, state) => {\n            let contents;\n            if (!node.table) {\n                contents = \"//invalid table//\";\n            } else {\n                const tableOutput = SimpleMarkdown.defaultRules.table.react(\n                    node.table,\n                    output,\n                    state\n                );\n\n                const caption = (\n                    <caption key=\"caption\" className=\"perseus-table-title\">\n                        {output(node.title, state)}\n                    </caption>\n                );\n\n                // Splice the caption into the table's children with the\n                // caption as the first child.\n                contents = React.cloneElement(tableOutput, null, [\n                    caption,\n                    ...tableOutput.props.children,\n                ]);\n            }\n\n            // Note: if the DOM structure changes, edit the Zoomable wrapper\n            // in src/renderer.jsx.\n            return (\n                <div className=\"perseus-titled-table\" key={state.key}>\n                    {contents}\n                </div>\n            );\n        },\n    },\n    widget: {\n        order: SimpleMarkdown.defaultRules.link.order - 0.75,\n        match: SimpleMarkdown.inlineRegex(Util.rWidgetRule),\n        parse: (capture, parse, state) => {\n            return {\n                id: capture[1],\n                widgetType: capture[2],\n            };\n        },\n        react: (node, output, state) => {\n            // The actual output is handled in the renderer, where\n            // we know the current widget props/state. This is\n            // just a stub for testing.\n            return (\n                <em key={state.key}>\n                    [Widget: {node.id}]\n                </em>\n            );\n        },\n    },\n    blockMath: {\n        order: SimpleMarkdown.defaultRules.codeBlock.order + 0.5,\n        match: blockMathMatch,\n        parse: (capture, parse, state) => {\n            return {\n                content: capture[1],\n            };\n        },\n        react: (node, output, state) => {\n            // The actual output is handled in the renderer, because\n            // it needs to pass in an `onRender` callback prop. This\n            // is just a stub for testing.\n            return (\n                <TeX key={state.key}>\n                    {node.content}\n                </TeX>\n            );\n        },\n    },\n    math: {\n        order: SimpleMarkdown.defaultRules.link.order - 0.25,\n        match: mathMatch,\n        parse: (capture, parse, state) => {\n            return {\n                content: capture[1],\n            };\n        },\n        react: (node, output, state) => {\n            // The actual output is handled in the renderer, because\n            // it needs to pass in an `onRender` callback prop. This\n            // is just a stub for testing.\n            return (\n                <TeX key={state.key}>\n                    {node.content}\n                </TeX>\n            );\n        },\n    },\n    unescapedDollar: {\n        order: SimpleMarkdown.defaultRules.link.order - 0.24,\n        match: SimpleMarkdown.inlineRegex(/^(?!\\\\)\\$/),\n        parse: (capture, parse, state) => {\n            return {};\n        },\n        react: (node, output, state) => {\n            // Unescaped dollar signs render correctly, but result in\n            // untranslatable text after the i18n python linter flags it\n            return \"$\";\n        },\n    },\n    fence: _.extend({}, SimpleMarkdown.defaultRules.fence, {\n        parse: (capture, parse, state) => {\n            var node = SimpleMarkdown.defaultRules.fence.parse(\n                capture,\n                parse,\n                state\n            );\n\n            // support screenreader-only text with ```alt\n            if (node.lang === \"alt\") {\n                return {\n                    type: \"codeBlock\",\n                    lang: \"alt\",\n                    // default codeBlock parsing doesn't parse the contents.\n                    // We need to parse the contents for things like table\n                    // support :).\n                    // The \\n\\n is because the inside of the codeblock might\n                    // not end in double newlines for block rules, because\n                    // ordinarily we don't parse this :).\n                    content: parse(node.content + \"\\n\\n\", state),\n                };\n            } else {\n                return node;\n            }\n        },\n    }),\n    // Extend the SimpleMarkdown link parser to make the link\n    // zero-rating-friendly if necessary. No changes will be made for\n    // non-zero-rated requests, but zero-rated requests will be re-pointed at\n    // either the zero-rated version of khanacademy.org or the external link\n    // warning interstitial. We also replace the default <a /> tag with a custom\n    // element, if necessary.\n    link: _.extend({}, SimpleMarkdown.defaultRules.link, {\n        react: function(node, output, state) {\n            const link = SimpleMarkdown.defaultRules.link.react(\n                node,\n                output,\n                state\n            );\n\n            let href = link.props.href;\n\n            // TODO(charlie): Move this logic out of Perseus and into webapp via\n            // the <Link /> component that is now injected as a dependency.\n            if (typeof KA !== \"undefined\" && KA.isZeroRated) {\n                if (href.match(/https?:\\/\\/[^\\/]*khanacademy.org/)) {\n                    href = href.replace(\n                        \"khanacademy.org\",\n                        \"zero.khanacademy.org\"\n                    );\n                } else {\n                    href =\n                        \"/zero/external-link?url=\" + encodeURIComponent(href);\n                }\n            }\n\n            const newProps = {...link.props, href};\n\n            if (state.baseElements && state.baseElements.Link) {\n                return state.baseElements.Link(newProps);\n            } else {\n                return React.cloneElement(link, newProps);\n            }\n        },\n    }),\n    codeBlock: _.extend({}, SimpleMarkdown.defaultRules.codeBlock, {\n        react: (node, output, state) => {\n            // ideally this should be a different rule, with only an\n            // output function, but right now that breaks the parser.\n            if (node.lang === \"alt\") {\n                return (\n                    <div\n                        key={state.key}\n                        className=\"perseus-markdown-alt perseus-sr-only\"\n                    >\n                        {output(node.content, state)}\n                    </div>\n                );\n            } else {\n                return SimpleMarkdown.defaultRules.codeBlock.react(\n                    node,\n                    output,\n                    state\n                );\n            }\n        },\n    }),\n    list: _.extend({}, SimpleMarkdown.defaultRules.list, {\n        match: (source, state, prevCapture) => {\n            // Since lists can contain double newlines and we have special\n            // handling of double newlines while parsing jipt content, just\n            // disable the list parser.\n            if (state.isJipt) {\n                return null;\n            } else {\n                return SimpleMarkdown.defaultRules.list.match(\n                    source,\n                    state,\n                    prevCapture\n                );\n            }\n        },\n    }),\n    // The lint rule never actually matches anything.\n    // We check for lint after parsing, and, if we find any, we\n    // transform the tree to add lint nodes. This rule is here\n    // just for the react() function\n    lint: {\n        order: 1000,\n        match: s => null,\n        parse: (capture, parse, state) => ({}),\n        react: (node, output, state) => {\n            return (\n                <Lint\n                    message={node.message}\n                    ruleName={node.ruleName}\n                    inline={isInline(node.content)}\n                    insideTable={node.insideTable}\n                    severity={node.severity}\n                >\n                    {output(node.content, state)}\n                </Lint>\n            );\n        },\n    },\n});\n\n// Return true if the specified parse tree node represents inline content\n// and false otherwise. We need this so that lint nodes can figure out whether\n// they should behave as an inline wrapper or a block wrapper\nfunction isInline(node) {\n    return !!(node && node.type && inlineNodeTypes.hasOwnProperty(node.type));\n}\nconst inlineNodeTypes = {\n    text: true,\n    math: true,\n    unescapedDollar: true,\n    link: true,\n    img: true,\n    strong: true,\n    u: true,\n    em: true,\n    del: true,\n    code: true,\n};\n\nvar builtParser = SimpleMarkdown.parserFor(rules);\nvar parse = (source, state) => {\n    var paragraphedSource = source + \"\\n\\n\";\n\n    return builtParser(paragraphedSource, _.extend({inline: false}, state));\n};\nvar inlineParser = (source, state) => {\n    return builtParser(source, _.extend({inline: true}, state));\n};\n\n/**\n * Traverse all of the nodes in the Perseus Markdown AST. The callback is\n * called for each node in the AST.\n */\nvar traverseContent = (ast, cb) => {\n    if (_.isArray(ast)) {\n        _.each(ast, node => traverseContent(node, cb));\n    } else if (_.isObject(ast)) {\n        cb(ast);\n        if (ast.type === \"table\") {\n            traverseContent(ast.header, cb);\n            traverseContent(ast.cells, cb);\n        } else if (ast.type === \"list\") {\n            traverseContent(ast.items, cb);\n        } else if (ast.type === \"titledTable\") {\n            traverseContent(ast.table, cb);\n        } else if (ast.type === \"columns\") {\n            traverseContent(ast.col1, cb);\n            traverseContent(ast.col2, cb);\n        } else if (_.isArray(ast.content)) {\n            traverseContent(ast.content, cb);\n        }\n    }\n};\n\n/**\n * Pull out text content from a Perseus Markdown AST.\n * Returns an array of strings.\n */\nvar getContent = ast => {\n    // Simplify logic by dealing with a single AST node at a time\n    if (_.isArray(ast)) {\n        return _.flatten(_.map(ast, getContent));\n    }\n\n    // Base case: This is where we actually extract text content\n    if (ast.content && _.isString(ast.content)) {\n        // Collapse whitespace within content unless it is code\n        if (ast.type.toLowerCase().indexOf(\"code\") !== -1) {\n            // In case this is the sole child of a paragraph,\n            // prevent whitespace from being trimmed later\n            return [\"\", ast.content, \"\"];\n        } else {\n            return [ast.content.replace(/\\s+/g, \" \")];\n        }\n    }\n\n    // Recurse through child AST nodes\n    // Assumptions made:\n    // 1) Child AST nodes are either direct properties or inside\n    //    arbitrarily nested lists that are direct properties.\n    // 2) Only AST nodes have a 'type' property.\n    var children = _.chain(ast)\n        .values()\n        .flatten()\n        .filter(object => object != null && _.has(object, \"type\"))\n        .value();\n\n    if (!children.length) {\n        return [];\n    } else {\n        var nestedContent = getContent(children);\n        if (ast.type === \"paragraph\" && nestedContent.length) {\n            // Trim whitespace before or after a paragraph\n            nestedContent[0] = nestedContent[0].replace(/^\\s+/, \"\");\n            var last = nestedContent.length - 1;\n            nestedContent[last] = nestedContent[last].replace(/\\s+$/, \"\");\n        }\n        return nestedContent;\n    }\n};\n\n/**\n * Count the number of characters in Perseus Markdown source.\n * Markdown markup and widget references are ignored.\n */\nvar characterCount = source => {\n    var ast = parse(source);\n    var content = getContent(ast).join(\"\");\n    return content.length;\n};\n\n_module_.exports = {\n    characterCount: characterCount,\n    traverseContent: traverseContent,\n    parse: parse,\n    parseInline: inlineParser,\n    reactFor: SimpleMarkdown.reactFor,\n    ruleOutput: SimpleMarkdown.ruleOutput(rules, \"react\"),\n    basicOutput: SimpleMarkdown.reactFor(\n        SimpleMarkdown.ruleOutput(rules, \"react\")\n    ),\n    sanitizeUrl: SimpleMarkdown.sanitizeUrl,\n};\nexport default _module_.exports;\n","// This is the TreeTransformer class described in detail at the\n// top of this file.\nexport default class TreeTransformer {\n    // To create a tree transformer, just pass the root node of the tree\n    constructor(root) {\n        this.root = root;\n    }\n\n    // A utility function for determing whether an arbitrary value is a node\n    static isNode(n) {\n        return n && typeof n === \"object\" && typeof n.type === \"string\";\n    }\n\n    // Determines whether a value is a node with type \"text\" and has\n    // a text-valued `content` property.\n    static isTextNode(n) {\n        return (\n            TreeTransformer.isNode(n) &&\n            n.type === \"text\" &&\n            typeof n.content === \"string\"\n        );\n    }\n\n    // This is the main entry point for the traverse() method. See the comment\n    // at the top of this file for a detailed description. Note that this\n    // method just creates a new TraversalState object to use for this\n    // traversal and then invokes the internal _traverse() method to begin the\n    // recursion.\n    traverse(f) {\n        this._traverse(this.root, new TraversalState(this.root), f);\n    }\n\n    // Do a post-order traversal of node and its descendants, invoking the\n    // callback function f() once for each node and returning the concatenated\n    // text content of the node and its descendants. f() is passed three\n    // arguments: the current node, a TraversalState object representing the\n    // current state of the traversal, and a string that holds the\n    // concatenated text of the node and its descendants.\n    //\n    // This private method holds all the traversal logic and implementation\n    // details. Note that this method uses the TraversalState object to store\n    // information about the structure of the tree.\n    _traverse(n, state, f) {\n        let content = \"\";\n        if (TreeTransformer.isNode(n)) {\n            // If we were called on a node object, then we handle it\n            // this way.\n            const node = (n); // safe cast; we just tested\n\n            // Put the node on the stack before recursing on its children\n            state._containers.push(node);\n            state._ancestors.push(node);\n\n            // Record the node's text content if it has any.\n            // Usually this is for nodes with a type property of \"text\",\n            // but other nodes types like \"math\" may also have content.\n            if (typeof node.content === \"string\") {\n                content = node.content;\n            }\n\n            // Recurse on the node. If there was content above, then there\n            // probably won't be any children to recurse on, but we check\n            // anyway.\n            //\n            // If we wanted to make the traversal completely specific to the\n            // actual Perseus parse trees that we'll be dealing with we could\n            // put a switch statement here to dispatch on the node type\n            // property with specific recursion steps for each known type of\n            // node.\n            const keys = Object.keys(node);\n            keys.forEach(key => {\n                // Never recurse on the type property\n                if (key === \"type\") {\n                    return;\n                }\n                // Ignore properties that are null or primitive and only\n                // recurse on objects and arrays. Note that we don't do a\n                // isNode() check here. That is done in the recursive call to\n                // _traverse(). Note that the recursive call on each child\n                // returns the text content of the child and we add that\n                // content to the content for this node. Also note that we\n                // push the name of the property we're recursing over onto a\n                // TraversalState stack.\n                const value = node[key];\n                if (value && typeof value === \"object\") {\n                    state._indexes.push(key);\n                    content += this._traverse(value, state, f);\n                    state._indexes.pop();\n                }\n            });\n\n            // Restore the stacks after recursing on the children\n            state._currentNode = state._ancestors.pop();\n            state._containers.pop();\n\n            // And finally call the traversal callback for this node.  Note\n            // that this is post-order traversal. We call the callback on the\n            // way back up the tree, not on the way down.  That way we already\n            // know all the content contained within the node.\n            f(node, state, content);\n        } else if (Array.isArray(n)) {\n            // If we were called on an array instead of a node, then\n            // this is the code we use to recurse.\n            const nodes = n;\n\n            // Push the array onto the stack. This will allow the\n            // TraversalState object to locate siblings of this node.\n            state._containers.push(nodes);\n\n            // Now loop through this array and recurse on each element in it.\n            // Before recursing on an element, we push its array index on a\n            // TraversalState stack so that the TraversalState sibling methods\n            // can work. Note that TraversalState methods can alter the length\n            // of the array, and change the index of the current node, so we\n            // are careful here to test the array length on each iteration and\n            // to reset the index when we pop the stack. Also note that we\n            // concatentate the text content of the children.\n            let index = 0;\n            while (index < nodes.length) {\n                state._indexes.push(index);\n                content += this._traverse(nodes[index], state, f);\n                // Casting to convince Flow that this is a number\n                index = (state._indexes.pop()) + 1;\n            }\n\n            // Pop the array off the stack. Note, however, that we do not call\n            // the traversal callback on the array. That function is only\n            // called for nodes, not arrays of nodes.\n            state._containers.pop();\n        }\n\n        // The _traverse() method always returns the text content of\n        // this node and its children. This is the one piece of state that\n        // is not tracked in the TraversalState object.\n        return content;\n    }\n}\n\n// An instance of this class is passed to the callback function for\n// each node traversed. The class itself is not exported, but its\n// methods define the API available to the traversal callback.\n\n/**\n * This class represents the state of a tree traversal. An instance is created\n * by the traverse() method of the TreeTransformer class to maintain the state\n * for that traversal, and the instance is passed to the traversal callback\n * function for each node that is traversed. This class is not intended to be\n * instantiated directly, but is exported so that its type can be used for\n * Flow annotaions.\n **/\nexport class TraversalState {\n    // The constructor just stores the root node and creates empty stacks.\n    constructor(root) {\n        this.root = root;\n\n        // When the callback is called, this property will hold the\n        // node that is currently being traversed.\n        this._currentNode = null;\n\n        // This is a stack of the objects and arrays that we've\n        // traversed through before reaching the currentNode.\n        // It is different than the ancestors array.\n        this._containers = new Stack();\n\n        // This stack has the same number of elements as the _containers\n        // stack. The last element of this._indexes[] is the index of\n        // the current node in the object or array that is the last element\n        // of this._containers[]. If the last element of this._containers[] is\n        // an array, then the last element of this stack will be a number.\n        // Otherwise if the last container is an object, then the last index\n        // will be a string property name.\n        this._indexes = new Stack();\n\n        // This is a stack of the ancestor nodes of the current one.\n        // It is different than the containers[] stack because it only\n        // includes nodes, not arrays.\n        this._ancestors = new Stack();\n    }\n\n    /**\n     * Return the current node in the traversal. Any time the traversal\n     * callback is called, this method will return the name value as the\n     * first argument to the callback.\n     */\n    currentNode() {\n        return this._currentNode || this.root;\n    }\n\n    /**\n     * Return the parent of the current node, if there is one, or null.\n     */\n    parent() {\n        return this._ancestors.top();\n    }\n\n    /**\n     * Return an array of ancestor nodes. The first element of this array is\n     * the same as this.parent() and the last element is the root node. If we\n     * are currently at the root node, the the returned array will be empty.\n     * This method makes a copy of the internal state, so modifications to the\n     * returned array have no effect on the traversal.\n     */\n    ancestors() {\n        return this._ancestors.values();\n    }\n\n    /**\n     * Return the next sibling of this node, if it has one, or null otherwise.\n     */\n    nextSibling() {\n        const siblings = this._containers.top();\n\n        // If we're at the root of the tree or if the parent is an\n        // object instead of an array, then there are no siblings.\n        if (!siblings || !Array.isArray(siblings)) {\n            return null;\n        }\n\n        // The top index is a number because the top container is an array\n        const index = (this._indexes.top());\n        if (siblings.length > index + 1) {\n            return siblings[index + 1];\n        } else {\n            return null; // There is no next sibling\n        }\n    }\n\n    /**\n     * Return the previous sibling of this node, if it has one, or null\n     * otherwise.\n     */\n    previousSibling() {\n        const siblings = this._containers.top();\n\n        // If we're at the root of the tree or if the parent is an\n        // object instead of an array, then there are no siblings.\n        if (!siblings || !Array.isArray(siblings)) {\n            return null;\n        }\n\n        // The top index is a number because the top container is an array\n        const index = (this._indexes.top());\n        if (index > 0) {\n            return siblings[index - 1];\n        } else {\n            return null; // There is no previous sibling\n        }\n    }\n\n    /**\n     * Remove the next sibling node (if there is one) from the tree.  Returns\n     * the removed sibling or null. This method makes it easy to traverse a\n     * tree and concatenate adjacent text nodes into a single node.\n     */\n    removeNextSibling() {\n        const siblings = this._containers.top();\n        if (siblings && Array.isArray(siblings)) {\n            // top index is a number because top container is an array\n            const index = (this._indexes.top());\n            if (siblings.length > index + 1) {\n                return siblings.splice(index + 1, 1)[0];\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Replace the current node in the tree with the specified nodes.  If no\n     * nodes are passed, this is a node deletion. If one node (or array) is\n     * passed, this is a 1-for-1 replacement. If more than one node is passed\n     * then this is a combination of deletion and insertion.  The new node or\n     * nodes will not be traversed, so this method can safely be used to\n     * reparent the current node node beneath a new parent.\n     *\n     * This method throws an error if you attempt to replace the root node of\n     * the tree.\n     */\n    replace(...replacements) {\n        const parent = this._containers.top();\n        if (!parent) {\n            throw new Error(\"Can't replace the root of the tree\");\n        }\n\n        // The top of the container stack is either an array or an object\n        // and the top of the indexes stack is a corresponding array index\n        // or object property. This is hard for Flow, so we have to do some\n        // unsafe casting and be careful when we use which cast version\n        const parentIsArray = Array.isArray(parent);\n        const array = (parent);\n        const index = (this._indexes.top());\n        const object = (parent);\n        const property = (this._indexes.top());\n\n        if (parentIsArray) {\n            // For an array parent we just splice the new nodes in\n            array.splice(index, 1, ...replacements);\n            // Adjust the index to account for the changed array length.\n            // We don't want to traverse any of the newly inserted nodes.\n            this._indexes.pop();\n            this._indexes.push(index + replacements.length - 1);\n        } else {\n            // For an object parent we care how many new nodes there are\n            if (replacements.length === 0) {\n                // Deletion\n                delete object[property];\n            } else if (replacements.length === 1) {\n                // Replacement\n                object[property] = replacements[0];\n            } else {\n                // Replace one node with an array of nodes\n                object[property] = replacements;\n            }\n        }\n    }\n\n    /**\n     * Returns true if the current node has a previous sibling and false\n     * otherwise. If this method returns false, then previousSibling() will\n     * return null, and goToPreviousSibling() will throw an error.\n     */\n    hasPreviousSibling() {\n        return Array.isArray(this._containers.top()) &&\n        (this._indexes.top()) > 0;\n    }\n\n    /**\n     * Modify this traversal state object to have the state it would have had\n     * when visiting the previous sibling. Note that you may want to use\n     * clone() to make a copy before modifying the state object like this.\n     * This mutator method is not typically used during ordinary tree\n     * traversals, but is used by the Selector class for matching multi-node\n     * selectors.\n     */\n    goToPreviousSibling() {\n        if (!this.hasPreviousSibling()) {\n            throw new Error(\n                \"goToPreviousSibling(): node has no previous sibling\"\n            );\n        }\n\n        this._currentNode = this.previousSibling();\n        // Since we know that we have a previous sibling, we know that\n        // the value on top of the stack is a number, but we have to do\n        // this unsafe cast because Flow doesn't know that.\n        const index = (this._indexes.pop());\n        this._indexes.push(index - 1);\n    }\n\n    /**\n     * Returns true if the current node has an ancestor and false otherwise.\n     * If this method returns false, then the parent() method will return\n     * null and goToParent() will throw an error\n     */\n    hasParent() {\n        return this._ancestors.size() !== 0;\n    }\n\n    /**\n     * Modify this object to look like it will look when we (later) visit the\n     * parent node of this node. You should not modify the instance passed to\n     * the tree traversal callback. Instead, make a copy with the clone()\n     * method and modify that.  This mutator method is not typically used\n     * during ordinary tree traversals, but is used by the Selector class for\n     * matching multi-node selectors that involve parent and ancestor\n     * selectors.\n     */\n    goToParent() {\n        if (!this.hasParent()) {\n            throw new Error(\"goToParent(): node has no ancestor\");\n        }\n\n        this._currentNode = this._ancestors.pop();\n\n        // We need to pop the containers and indexes stacks at least once\n        // and more as needed until we restore the invariant that\n        // this._containers.top()[this.indexes.top()] === this._currentNode\n        //\n        while (\n            this._containers.size() &&\n            // This is safe, but easier to just disable flow than do casts\n            // $FlowFixMe\n            this._containers.top()[this._indexes.top()] !== this._currentNode\n        ) {\n            this._containers.pop();\n            this._indexes.pop();\n        }\n    }\n\n    /**\n     * Return a new TraversalState object that is a copy of this one.\n     * This method is useful in conjunction with the mutating methods\n     * goToParent() and goToPreviousSibling().\n     */\n    clone() {\n        const clone = new TraversalState(this.root);\n        clone._currentNode = this._currentNode;\n        clone._containers = this._containers.clone();\n        clone._indexes = this._indexes.clone();\n        clone._ancestors = this._ancestors.clone();\n        return clone;\n    }\n\n    /**\n     * Returns true if this TraversalState object is equal to that\n     * TraversalState object, or false otherwise. This method exists\n     * primarily for use by our unit tests.\n     */\n    equals(that) {\n        return (\n            this.root === that.root &&\n            this._currentNode === that._currentNode &&\n            this._containers.equals(that._containers) &&\n            this._indexes.equals(that._indexes) &&\n            this._ancestors.equals(that._ancestors)\n        );\n    }\n}\n\n/**\n * This class is an internal utility that just treats an array as a stack\n * and gives us a top() method so we don't have to write expressions like\n * `ancestors[ancestors.length-1]`. The values() method automatically\n * copies the internal array so we don't have to worry about client code\n * modifying our internal stacks. The use of this Stack abstraction makes\n * the TraversalState class simpler in a number of places.\n */\nclass Stack {\n    constructor(array) {\n        this.stack = array ? array.slice(0) : [];\n    }\n\n    /** Push a value onto the stack. */\n    push(v) {\n        this.stack.push(v);\n    }\n\n    /** Pop a value off of the stack. */\n    pop() {\n        return this.stack.pop();\n    }\n\n    /** Return the top value of the stack without popping it. */\n    top() {\n        return this.stack[this.stack.length - 1];\n    }\n\n    /** Return a copy of the stack as an array */\n    values() {\n        return this.stack.slice(0);\n    }\n\n    /** Return the number of elements in the stack */\n    size() {\n        return this.stack.length;\n    }\n\n    /** Return a string representation of the stack */\n    toString() {\n        return this.stack.toString();\n    }\n\n    /** Return a shallow copy of the stack */\n    clone() {\n        return new Stack(this.stack);\n    }\n\n    /**\n     * Compare this stack to another and return true if the contents of\n     * the two arrays are the same.\n     */\n    equals(that) {\n        if (!that || !that.stack || that.stack.length !== this.stack.length) {\n            return false;\n        }\n        for (let i = 0; i < this.stack.length; i++) {\n            if (this.stack[i] !== that.stack[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\n","import _rulesAllRulesJs from \"./rules/all-rules.js\";\nimport PerseusMarkdown from \"../perseus-markdown.jsx\";\nimport Rule from \"./rule.js\";\nimport TreeTransformer from \"./tree-transformer.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\nconst allLintRules = _rulesAllRulesJs\n    .filter(r => r.severity < Rule.Severity.BULK_WARNING);\n\n//\n// Run the Gorgon linter over the specified markdown parse tree,\n// with the specified context object, and\n// return a (possibly empty) array of lint warning objects.  If the\n// highlight argument is true, this function also modifies the parse\n// tree to add \"lint\" nodes that can be visually rendered,\n// highlighting the problems for the user. The optional rules argument\n// is an array of Rule objects specifying which lint rules should be\n// applied to this parse tree. When omitted, a default set of rules is used.\n//\n// The context object may have additional properties that some lint\n// rules require:\n//\n//   context.content is the source content string that was parsed to create\n//   the parse tree.\n//\n//   context.widgets is the widgets object associated\n//   with the content string\n//\n// TODO: to make this even more general, allow the first argument to be\n// a string and run the parser over it in that case? (but ignore highlight\n// in that case). This would allow the one function to be used for both\n// online linting and batch linting.\n//\nfunction runLinter(tree, context, highlight, rules) {\n    rules = rules || allLintRules;\n    const warnings = [];\n    const tt = new TreeTransformer(tree);\n\n    // The markdown parser often outputs adjacent text nodes. We\n    // coalesce them before linting for efficiency and accuracy.\n    tt.traverse((node, state, content) => {\n        if (TreeTransformer.isTextNode(node)) {\n            let next = state.nextSibling();\n            while (TreeTransformer.isTextNode(next)) {\n                node.content += next.content;\n                state.removeNextSibling();\n                next = state.nextSibling();\n            }\n        }\n    });\n\n    // HTML tables are complicated, and the CSS we use in\n    // ../components/lint.jsx to display lint does not work to\n    // correctly position the lint indicators in the margin when the\n    // lint is inside a table. So as a workaround we keep track of all\n    // the lint that appears within a table and move it up to the\n    // table element itself.\n    //\n    // It is not ideal to have to do this here,\n    // but it is cleaner here than fixing up the lint during rendering\n    // in perseus-markdown.jsx. If our lint display was simpler and\n    // did not require indicators in the margin, this wouldn't be a\n    // problem. Or, if we modified the lint display stuff so that\n    // indicator positioning and tooltip display were both handled\n    // with JavaScript (instead of pure CSS), then we could avoid this\n    // issue too. But using JavaScript has its own downsides: there is\n    // risk that the linter JavaScript would interfere with\n    // widget-related Javascript.\n    let tableWarnings = [];\n    let insideTable = false;\n\n    // Traverse through the nodes of the parse tree. At each node, loop\n    // through the array of lint rules and check whether there is a\n    // lint violation at that node.\n    tt.traverse((node, state, content) => {\n        const nodeWarnings = [];\n\n        // If our rule is only designed to be tested against a particular\n        // content type and we're not in that content type, we don't need to\n        // consider that rule.\n        const applicableRules = rules.filter(r => r.applies(context));\n\n        // Generate a stack so we can identify our position in the tree in\n        // lint rules\n        const stack = [...context.stack];\n        stack.push(node.type);\n\n        const nodeContext = {\n            ...context,\n            stack: stack.join('.'),\n        };\n\n        applicableRules.forEach(rule => {\n            const warning = rule.check(node, state, content, nodeContext);\n            if (warning) {\n                // The start and end locations are relative to this\n                // particular node, and so are not generally very useful.\n                // TODO: When the markdown parser saves the node\n                // locations in the source string then we can add\n                // these numbers to that one and get and absolute\n                // character range that will be useful\n                if (warning.start || warning.end) {\n                    warning.target = content.substring(\n                        warning.start,\n                        warning.end\n                    );\n                }\n\n                // Add the warning to the list of all lint we've found\n                warnings.push(warning);\n\n                // If we're going to be highlighting lint, then we also\n                // need to keep track of warnings specific to this node.\n                if (highlight) {\n                    nodeWarnings.push(warning);\n                }\n            }\n        });\n\n        // If we're not highlighting lint in the tree, then we're done\n        // traversing this node.\n        if (!highlight) {\n            return;\n        }\n\n        // If the node we are currently at is a table, and there was lint\n        // inside the table, then we want to add that lint here\n        if (node.type === \"table\") {\n            if (tableWarnings.length) {\n                nodeWarnings.push(...tableWarnings);\n            }\n\n            // We're not in a table anymore, and don't have to remember\n            // the warnings for the table\n            insideTable = false;\n            tableWarnings = [];\n        } else if (!insideTable) {\n            // Otherwise, if we are not already inside a table, check\n            // to see if we've entered one. Because this is a post-order\n            // traversal we'll see the table contents before the table itself.\n            // Note that once we're inside the table, we don't have to\n            // do this check each time... We can just wait until we ascend\n            // up to the table, then we'll know we're out of it.\n            insideTable = state.ancestors().some(n => n.type === \"table\");\n        }\n\n        // If we are inside a table and there were any warnings on\n        // this node, then we need to save the warnings for display\n        // on the table itself\n        if (insideTable && nodeWarnings.length) {\n            tableWarnings.push(...nodeWarnings);\n        }\n\n        // If there were any warnings on this node, and if we're highlighting\n        // lint, then reparent the node so we can highlight it. Note that\n        // a single node can have multiple warnings. If this happends we\n        // concatenate the warnings and newline separate them. (The lint.jsx\n        // component that displays the warnings may want to convert the\n        // newlines into <br> tags.) We also provide a lint rule name\n        // so that lint.jsx can link to a document that provides more details\n        // on that particular lint rule. If there is more than one warning\n        // we only link to the first rule, however.\n        //\n        // Note that even if we're inside a table, we still reparent the\n        // linty node so that it can be highlighted. We just make a note\n        // of whether this lint is inside a table or not.\n        if (nodeWarnings.length) {\n            nodeWarnings.sort((a, b) => {\n                return a.severity - b.severity;\n            });\n\n            if (node.type !== \"text\" || nodeWarnings.length > 1) {\n                // If the linty node is not a text node, or if there is more\n                // than one warning on a text node, then reparent the entire\n                // node under a new lint node and put the warnings there.\n                state.replace({\n                    type: \"lint\",\n                    content: node,\n                    message: nodeWarnings.map(w => w.message).join(\"\\n\\n\"),\n                    ruleName: nodeWarnings[0].rule,\n                    insideTable: insideTable,\n                    severity: nodeWarnings[0].severity,\n                });\n            } else {\n                //\n                // Otherwise, it is a single warning on a text node, and we\n                // only want to highlight the actual linty part of that string\n                // of text. So we want to replace the text node with (in the\n                // general case) three nodes:\n                //\n                // 1) A new text node that holds the non-linty prefix\n                //\n                // 2) A lint node that is the parent of a new text node\n                // that holds the linty part\n                //\n                // 3) A new text node that holds the non-linty suffix\n                //\n                // If the lint begins and/or ends at the boundaries of the\n                // original text node, then nodes 1 and/or 3 won't exist, of\n                // course.\n                //\n                // Note that we could generalize this to work with multple\n                // warnings on a text node as long as the warnings are\n                // non-overlapping. Hopefully, though, multiple warnings in a\n                // single text node will be rare in practice. Also, we don't\n                // have a good way to display multiple lint indicators on a\n                // single line, so keeping them combined in that case might\n                // be the best thing, anyway.\n                //\n                const content = node.content; // Text nodes have content\n                const warning = nodeWarnings[0]; // There is only one warning.\n                // These are the lint boundaries within the content\n                const start = warning.start || 0;\n                const end = warning.end || content.length;\n                const prefix = content.substring(0, start);\n                const lint = content.substring(start, end);\n                const suffix = content.substring(end);\n                const replacements = []; // What we'll replace the node with\n\n                // The prefix text node, if there is one\n                if (prefix) {\n                    replacements.push({\n                        type: \"text\",\n                        content: prefix,\n                    });\n                }\n\n                // The lint node wrapped around the linty text\n                replacements.push({\n                    type: \"lint\",\n                    content: {\n                        type: \"text\",\n                        content: lint,\n                    },\n                    message: warning.message,\n                    ruleName: warning.rule,\n                    insideTable: insideTable,\n                    severity: warning.severity,\n                });\n\n                // The suffix node, if there is one\n                if (suffix) {\n                    replacements.push({\n                        type: \"text\",\n                        content: suffix,\n                    });\n                }\n\n                // Now replace the lint text node with the one to three\n                // nodes in the replacement array\n                state.replace(...replacements);\n            }\n        }\n    });\n\n    return warnings;\n}\n\nfunction pushContextStack(context, name) {\n    const stack = context.stack || [];\n    return {\n        ...context,\n        stack: stack.concat(name),\n    };\n}\n\n//\n// TODO(davidflanagan):\n// Revisit these exports once we've got gorgon integrated into Perseus.\n// Do we really need to export all of these things, or can we export a\n// smaller set of functionality to enable both bulk linting by tools/gorgon.js\n// and online linting?\n//\n// TODO(davidflanagan): switch from require to import\n//\n_module_.exports = {\n    runLinter,\n    parse: PerseusMarkdown.parse,\n    pushContextStack,\n    rules: allLintRules,\n};\nexport default _module_.exports;\n","var _module_ = {\n exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Preprocess TeX code to convert things that KaTeX doesn't know how to handle\n * to things is does.\n */\n\n_module_.exports = texCode => texCode\n    // Replace uses of \\begin{align}...\\end{align} which KaTeX doesn't\n    // support (yet) with \\begin{aligned}...\\end{aligned} which renders\n    // the same is supported by KaTeX.  It does the same for align*.\n    // TODO(kevinb) update content to use aligned instead of align.\n    .replace(/\\{align[*]?\\}/g, \"{aligned}\")\n    // Replace non-breaking spaces with regular spaces.\n    .replace(/[\\u00a0]/g, \" \");\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Simple version of jQuery's Deferred.\n */\n\nclass Deferred {\n    constructor() {\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n\n    then(callback) {\n        return this.promise.then(callback);\n    }\n}\n\n_module_.exports = Deferred;\nexport default _module_.exports;\n","import _deferredJs from \"../deferred.js\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Zooms child to fit with tap-to-zoom behavior.\n */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\n\nconst Deferred = _deferredJs;\n\nconst Zoomable = createReactClass({\n    propTypes: {\n        animateHeight: PropTypes.bool,\n        children: PropTypes.element.isRequired,\n\n        /**\n         * Optional function that allows customizations in zooming.\n         *\n         * Defaults to just using the bounding client rect of the first DOM\n         * element of this component.\n         *\n         * @return {Object} bounds object with `width` and `height` properties\n         */\n        computeChildBounds: PropTypes.func,\n\n        // If this prop is specified, we wait until the deferred is resolved\n        // before measuring the child element.  This is necessary in cases\n        // where the child size depends on whether or not resources, such as\n        // fonts, have been loaded.\n        readyToMeasureDeferred: PropTypes.shape({\n            then: PropTypes.func.isRequired,\n            reject: PropTypes.func.isRequired,\n        }).isRequired,\n    },\n\n    getDefaultProps() {\n        const deferred = new Deferred();\n        deferred.resolve();\n\n        return {\n            animateHeight: false,\n            readyToMeasureDeferred: deferred,\n            computeChildBounds: parentNode => {\n                const firstChild = parentNode.firstElementChild;\n\n                return {\n                    // The +1 is a fudge factor to make sure any border on the\n                    // content isn't clipped by the the container it's in.\n                    width: firstChild.offsetWidth + 1,\n                    height: firstChild.offsetHeight + 1,\n                };\n            },\n        };\n    },\n\n    getInitialState() {\n        return {\n            visible: false,\n            marginBottomPx: 0,\n            zoomed: true,\n        };\n    },\n\n    componentDidMount() {\n        this._node = ReactDOM.findDOMNode(this);\n        this.props.readyToMeasureDeferred.then(() => {\n            if (this.isMounted()) {\n                this.scaleChildToFit(false);\n\n                if (window.MutationObserver) {\n                    this._observer = new MutationObserver(mutations => {\n                        if (this.isMounted()) {\n                            for (const mutation of mutations) {\n                                if (mutation.target !== this._node) {\n                                    // Only act on mutations of children\n                                    this.scaleChildToFit(this.state.zoomed);\n                                    break;\n                                }\n                            }\n                        }\n                    });\n\n                    this._observer.observe(this._node, {\n                        childList: true,\n                        subtree: true,\n                        attributes: true,\n                    });\n                }\n                window.addEventListener(\"resize\", this.reset);\n            }\n        });\n    },\n\n    componentWillUnmount() {\n        window.removeEventListener(\"resize\", this.reset);\n        if (this._observer) {\n            this._observer.disconnect();\n        }\n    },\n\n    reset() {\n        if (!this.isMounted()) {\n            return;\n        }\n        if (!this.state.visible) {\n            return;\n        }\n        this._originalWidth = null;\n        this.setState(\n            {\n                visible: false,\n                compactHeight: null,\n                expandedHeight: null,\n                zoomed: true,\n            },\n            () => {\n                this.scaleChildToFit(false);\n            }\n        );\n    },\n\n    stopPropagationIfZoomed(e) {\n        if (!this.state.zoomed) {\n            // We only allow touch events (which trigger interactive elements)\n            // to be propagated to children if we are already zoomed.\n            e.stopPropagation();\n        }\n    },\n\n    // TODO(benkomalo): call this on viewport width changes?\n    // https://github.com/Khan/math-input/blob/master/src/components/math-keypad.js#L43\n    scaleChildToFit(zoomed) {\n        const parentBounds = {\n            width: this._node.offsetWidth,\n            height: this._node.offsetHeight,\n        };\n        const childBounds = this.props.computeChildBounds(\n            this._node,\n            parentBounds\n        );\n\n        const childWidth = childBounds.width;\n        const childHeight = childBounds.height;\n\n        if (childWidth > parentBounds.width) {\n            const scale = parentBounds.width / childWidth;\n\n            this.setState({\n                scale: scale,\n                zoomed: zoomed,\n\n                compactHeight: Math.ceil(scale * childHeight),\n                expandedHeight: childHeight,\n            });\n\n            // TODO(charlie): Do this as a callback to `setState`. Something is\n            // going wrong with that approach in initial testing.\n            setTimeout(() => {\n                // Only show it after the next paint, to allow for CSS\n                // transitions to fade it in.\n                if (this.isMounted()) {\n                    this.setState({\n                        visible: true,\n                    });\n                }\n            });\n        } else {\n            this.setState({\n                visible: true,\n            });\n        }\n    },\n\n    handleClickIfZoomed(e) {\n        if (!this.state.zoomed) {\n            e.stopPropagation();\n            this.handleClick();\n        }\n    },\n\n    handleClick() {\n        this.setState({\n            zoomed: !this.state.zoomed,\n        });\n    },\n\n    render() {\n        const {\n            visible,\n            scale,\n            compactHeight,\n            expandedHeight,\n            zoomed,\n        } = this.state;\n        const {animateHeight} = this.props;\n\n        const property = animateHeight\n            ? \"opacity transform height\"\n            : \"opacity transform\";\n\n        // Since we're not using aphrodite, we have to prefix ourselves.\n        /* eslint-disable indent */\n        const transitionStyle = visible\n            ? {\n                  transitionProperty: property,\n                  WebkitTransitionProperty: property,\n                  msTransitionProperty: property,\n                  transitionDuration: \"0.3s\",\n                  WebkitTransitionDuration: \"0.3s\",\n                  msTransitionDuration: \"0.3s\",\n                  transitionTimingFunction: \"ease-out\",\n                  WebkitTransitionTimingfunction: \"ease-out\",\n                  msTransitionTmingFunction: \"ease-out\",\n              }\n            : {};\n        /* eslint-enable indent */\n\n        // Do a fancy little slide as we fade the contents in the first time.\n        const translateOffset = visible ? \"\" : \" translate(0, 8px)\";\n        const transform = zoomed\n            ? `scale(1, 1) ${translateOffset}`\n            : `scale(${scale}, ${scale}) ${translateOffset}`;\n\n        const style = {\n            display: \"block\",\n            width: \"100%\",\n            height: zoomed ? expandedHeight : compactHeight,\n            transform: transform,\n            WebkitTransform: transform,\n            msTransform: transform,\n            transformOrigin: \"0 0\",\n            WebkitTransformOrigin: \"0 0\",\n            msTransformOrigin: \"0 0\",\n            opacity: visible ? 1 : 0,\n            WebkitTapHighlightColor: \"transparent\",\n            ...transitionStyle,\n        };\n\n        return (\n            <span\n                onClick={this.handleClick}\n                onClickCapture={this.handleClickIfZoomed}\n                onTouchCancelCapture={this.stopPropagationIfZoomed}\n                onTouchEndCapture={this.stopPropagationIfZoomed}\n                onTouchStartCapture={this.stopPropagationIfZoomed}\n                style={style}\n            >\n                {this.props.children}\n            </span>\n        );\n    },\n});\n\n_module_.exports = Zoomable;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types, react/sort-comp */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst textWidthCache = {};\nfunction getTextWidth(text) {\n    if (!textWidthCache[text]) {\n        // Hacky way to guess the width of an input box\n        const $test = $(\"<span>\").text(text).appendTo(\"body\");\n        textWidthCache[text] = $test.width() + 5;\n        $test.remove();\n    }\n    return textWidthCache[text];\n}\n\nconst TextListEditor = createReactClass({\n    propTypes: {\n        options: PropTypes.array,\n        layout: PropTypes.string,\n        onChange: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            options: [],\n            layout: \"horizontal\",\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            items: this.props.options.concat(\"\"),\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            items: nextProps.options.concat(\"\"),\n        });\n    },\n\n    render: function() {\n        const className = [\n            \"perseus-text-list-editor\",\n            \"perseus-clearfix\",\n            \"layout-\" + this.props.layout,\n        ].join(\" \");\n\n        const inputs = _.map(\n            this.state.items,\n            function(item, i) {\n                return (\n                    <li key={i}>\n                        <input\n                            ref={\"input_\" + i}\n                            type=\"text\"\n                            value={item}\n                            onChange={this.onChange.bind(this, i)}\n                            onKeyDown={this.onKeyDown.bind(this, i)}\n                            style={{width: getTextWidth(item)}}\n                        />\n                    </li>\n                );\n            },\n            this\n        );\n\n        return (\n            <ul className={className}>\n                {inputs}\n            </ul>\n        );\n    },\n\n    onChange: function(index, event) {\n        let items = _.clone(this.state.items);\n        items[index] = event.target.value;\n\n        if (index === items.length - 1) {\n            items = items.concat(\"\");\n        }\n\n        this.setState({items: items});\n        this.props.onChange(_.compact(items));\n    },\n\n    onKeyDown: function(index, event) {\n        const which = event.nativeEvent.keyCode;\n\n        // Backspace deletes an empty input...\n        if (which === 8 /* backspace */ && this.state.items[index] === \"\") {\n            event.preventDefault();\n\n            const items = _.clone(this.state.items);\n            const focusIndex = index === 0 ? 0 : index - 1;\n\n            if (\n                index === items.length - 1 &&\n                (index === 0 || items[focusIndex] !== \"\")\n            ) {\n                // ...except for the last one, iff it is the only empty\n                // input at the end.\n                ReactDOM.findDOMNode(this.refs[\"input_\" + focusIndex]).focus();\n            } else {\n                items.splice(index, 1);\n                this.setState({items: items}, function() {\n                    ReactDOM.findDOMNode(\n                        this.refs[\"input_\" + focusIndex]\n                    ).focus();\n                });\n            }\n\n            // Deleting the last character in the second-to-last input\n            // removes it\n        } else if (\n            which === 8 /* backspace */ &&\n            this.state.items[index].length === 1 &&\n            index === this.state.items.length - 2\n        ) {\n            event.preventDefault();\n\n            const items = _.clone(this.state.items);\n            items.splice(index, 1);\n            this.setState({items: items});\n            this.props.onChange(_.compact(items));\n\n            // Enter adds an option below the current one...\n        } else if (which === 13 /* enter */) {\n            event.preventDefault();\n\n            const items = _.clone(this.state.items);\n            const focusIndex = index + 1;\n\n            if (index === items.length - 2) {\n                // ...unless the empty input is just below.\n                ReactDOM.findDOMNode(this.refs[\"input_\" + focusIndex]).focus();\n            } else {\n                items.splice(focusIndex, 0, \"\");\n                this.setState({items: items}, function() {\n                    ReactDOM.findDOMNode(\n                        this.refs[\"input_\" + focusIndex]\n                    ).focus();\n                });\n            }\n        }\n    },\n});\n\n_module_.exports = TextListEditor;\nexport default _module_.exports;\n","import _textListEditorJsx from \"./text-list-editor.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Stub Tag Editor.\n *\n * This is stupidly used by Perseus Zero because I didn't implement\n * the <TagEditor> for Perseus Zero (since everyone wants me to\n * delete it anyways).\n *\n * This is a small wrapper for a TextListEditor that allows us to\n * edit raw Tag ID strings in perseus zero (please don't use this).\n *\n * It also gives a nicer interface for the group metadata editor\n * in local demo mode.\n */\nconst React = _react;\n\nconst TextListEditor = _textListEditorJsx;\nconst EMPTY_ARRAY = [];\n\nconst StubTagEditor = createReactClass({\n    propTypes: {\n        value: PropTypes.arrayOf(PropTypes.string),\n        onChange: PropTypes.func.isRequired,\n        showTitle: PropTypes.bool.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: EMPTY_ARRAY,\n            showTitle: true,\n        };\n    },\n\n    render: function() {\n        return (\n            <div>\n                {this.props.showTitle &&\n                    <div style={{fontSize: 14}}>Tags:</div>}\n                {/* this is silly, but we have to `|| []` here because\n                we sometimes have the metadata set to null\n                (legacy saves, I think), which doesn't get defaulted\n                through defaultProps */}\n                <TextListEditor\n                    options={this.props.value || EMPTY_ARRAY}\n                    layout=\"vertical\"\n                    onChange={this.props.onChange}\n                />\n            </div>\n        );\n    },\n});\n\n_module_.exports = StubTagEditor;\nexport default _module_.exports;\n","import StubTagEditor from \"./components/stub-tag-editor.jsx\";\nimport * as React from \"react\";\n\n/* eslint-disable brace-style */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * [Most of] the Perseus client API.\n *\n * If making a change to this file, or otherwise to the perseus\n * API, you should increment:\n *  * the perseus api major version if it is a breaking change\n *  * the perseus api minor version if it is an additive-only change\n *  * nothing if it is purely a bug fix.\n *\n * Callbacks passed to Renderer/ItemRenderer:\n *  * onInputError:\n *    Called when there is an error grading a widget\n *  * onFocusChange: (newFocusPath, oldFocusPath, keypadDOMNode)\n *    Called when the user focus changes. The first two parameters are `path`\n *    arrays uniquely identifying the respect inputs. The third parameter,\n *    `keypadDOMNode`, is the DOM node of the custom keypad, or `null` if the\n *    keypad is disabled, which can be used by clients to accommodate for the\n *    appearance of the keypad on the screen.\n *    When focus changes to or from nothing being selected, `path` will be null.\n *  * interactionCallback: Called when the user interacts with a widget.\n *  * answerableCallback: Called with the current `answerability` of the\n *    problem, e.g. whether all required fields have input.\n *  * getAnotherHint: If provided, a button is rendered at the bottom of the\n *    hints (only when at least one hint has been shown, and not all hints\n *    have been shown) allowing the user to take another hint. This function\n *    is then called when the user clicks the button.\n *\n * Stable CSS ClassNames:\n * These are css class names that will continue to preserve their\n * semantic meaning across the same perseus api major version.\n */\n\nexport const Options = {\n        propTypes: PropTypes.shape({\n            isArticle: PropTypes.bool.isRequired,\n\n            satStyling: PropTypes.bool.isRequired,\n            onInputError: PropTypes.func.isRequired,\n            onFocusChange: PropTypes.func.isRequired,\n            staticRender: PropTypes.bool.isRequired,\n            GroupMetadataEditor: PropTypes.func.isRequired,\n            showAlignmentOptions: PropTypes.bool.isRequired,\n            readOnly: PropTypes.bool.isRequired,\n\n            answerableCallback: PropTypes.func,\n            getAnotherHint: PropTypes.func,\n            interactionCallback: PropTypes.func,\n\n            // A function that takes in the relative problem number (starts at\n            // 0 and is incremented for each group widget), and the ID of the\n            // group widget, then returns a react component that will be added\n            // immediately above the renderer in the group widget. If the\n            // function returns null, no annotation will be added.\n            groupAnnotator: PropTypes.func.isRequired,\n\n            // If imagePlaceholder or widgetPlaceholder are set, perseus will\n            // render the placeholder instead of the image or widget node.\n            imagePlaceholder: PropTypes.node,\n            widgetPlaceholder: PropTypes.node,\n\n            // Base React elements that can be used in place of the standard DOM\n            // DOM elements. For example, when provided, <Link /> will be used\n            // in place of <a />. This allows clients to provide pre-styled\n            // components or components with custom behavior.\n            baseElements: PropTypes.shape({\n                // The <Link /> component provided here must adhere to the same\n                // interface as React's base <a /> component.\n                Link: PropTypes.func,\n            }),\n\n            // Function that takes dimensions and returns a React component\n            // to display while an image is loading\n            imagePreloader: PropTypes.func,\n\n            // Function that takes an object argument. The object should\n            // include type and id, both strings, at least and can optionally\n            // include a boolean \"correct\" value. This is used for keeping\n            // track of widget interactions.\n            trackInteraction: PropTypes.func,\n\n            // A boolean that indicates whether or not a custom keypad is\n            // being used.  For mobile web this will be the ProvidedKeypad\n            // component.  In this situation we use the MathInput component\n            // from the math-input repo instead of the existing perseus math\n            // input components.\n            // TODO(charlie): Make this mutually exclusive with `staticRender`.\n            // Internally, we defer to `customKeypad` over `staticRender`, but\n            // they should really be represented as an enum or some other data\n            // structure that forbids them both being enabled at once.\n            customKeypad: PropTypes.bool,\n\n            // Indicates whether or not to use mobile styling.\n            isMobile: PropTypes.bool,\n\n            // A function, called with a bool indicating whether use of the\n            // drawing area (scratchpad) should be allowed/disallowed.\n            // Previously handled by `Khan.scratchpad.enable/disable`\n            setDrawingAreaAvailable: PropTypes.func,\n\n            // Whether to use the Draft.js editor or the legacy textarea\n            useDraftEditor: PropTypes.bool,\n\n            // Styling options that control the visual behavior of Perseus\n            // items.\n            // TODO(mdr): If we adopt this pattern, we'll need to think about\n            //     how to make individual `styling` options be optional, and\n            //     how to set their default values without overwriting provided\n            //     values. For now, though, you must either specify all fields\n            //     of `styling`, or omit the `styling` option entirely.\n            styling: PropTypes.shape({\n                // Which version of radio widget styles to use in non-SAT\n                // contexts.\n                //\n                // \"legacy\" was the version of the widget display after XOM but\n                // before we started adding MCR styles. It doesn't have support\n                // for rationales. It has since been removed.\n                //\n                // \"intermediate\" is a design which adds several new additions\n                // to the \"legacy\" styles such as:\n                //  1. Using the XOM \"desktop\" styles (with a visible check icon\n                //     and lines in between choices) on mobile devices.\n                //  2. Designs for rationales\n                //  3. Using the single-select styles for multi-select styles\n                //\n                // \"final\" is a design which will build off of the\n                // \"intermediate\" designs and adds some improved designs as well\n                // as:\n                //  1. a/b/c/d/etc. letters inside of the prompt check box\n                //  2. New iconography and styles to indicate choice correctness\n                //\n                // The \"legacy\" and \"intermediate\" designs will be A/B tested\n                // against each other to ensure that its changes don't cause\n                // problems due to the new designs. Once the \"intermediate\"\n                // designs are finished, they will be A/B tested against the\n                // \"final\" designs.\n                //\n                // If no flag is provided, \"legacy\" styles will be shown.\n                //\n                // TODO(emily): Remove this by Aug 1, 2017, at which point all\n                //   callsites should have been switched to using the \"final\"\n                //   designs.\n                radioStyleVersion: PropTypes.oneOf([\n                    \"intermediate\",\n                    \"final\",\n                ]),\n            }),\n\n            // The color used for the hint progress indicator (eg. 1 / 3)\n            hintProgressColor: PropTypes.string,\n        }).isRequired,\n\n        defaults: {\n            isArticle: false,\n            isMobile: false,\n            satStyling: false,\n            onInputError: function() {},\n            onFocusChange: function() {},\n            staticRender: false,\n            GroupMetadataEditor: StubTagEditor,\n            showAlignmentOptions: false,\n            readOnly: false,\n            groupAnnotator: function() {\n                return null;\n            },\n            baseElements: {\n                Link: props => {\n                    return <a {...props} />;\n                },\n            },\n            setDrawingAreaAvailable: function() {},\n            useDraftEditor: false,\n            styling: {\n                radioStyleVersion: \"final\",\n            },\n        },\n    };\n\nexport const ClassNames = {\n        RENDERER: \"perseus-renderer\",\n        TWO_COLUMN_RENDERER: \"perseus-renderer-two-columns\",\n        RESPONSIVE_RENDERER: \"perseus-renderer-responsive\",\n        INPUT: \"perseus-input\",\n        FOCUSED: \"perseus-focused\",\n        RADIO: {\n            OPTION: \"perseus-radio-option\",\n            SELECTED: \"perseus-radio-selected\",\n            OPTION_CONTENT: \"perseus-radio-option-content\",\n        },\n        INTERACTIVE: \"perseus-interactive\",\n        CORRECT: \"perseus-correct\",\n        INCORRECT: \"perseus-incorrect\",\n        UNANSWERED: \"perseus-unanswered\",\n        MOBILE: \"perseus-mobile\",\n    };\n\n\nexport default { Options: Options, ClassNames: ClassNames };\n","import _perseusApiJsx from \"../perseus-api.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A mixin that accepts the `apiOptions` prop, and populates any missing values\n * with defaults.\n */\nconst React = _react;\n\nconst ApiOptions = _perseusApiJsx.Options;\n\nconst ApiOptionsProps = {\n    propTypes: {\n        // TODO(mdr): Should this actually be objectOf(any)?\n        apiOptions: PropTypes.any,\n    },\n\n    getDefaultProps() {\n        return {apiOptions: {}};\n    },\n\n    getApiOptions() {\n        return {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n        };\n    },\n};\n\n_module_.exports = ApiOptionsProps;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-console, no-var, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar _ = _underscore;\n\nvar DEFAULT_ALIGNMENT = \"block\";\nvar DEFAULT_SUPPORTED_ALIGNMENTS = [\"default\"];\nvar DEFAULT_STATIC = false;\nvar DEFAULT_TRACKING = \"\";\nvar DEFAULT_LINTABLE = false;\n\nvar widgets = {};\nvar editors = {};\n\nvar Widgets = {\n    // Widgets must be registered to avoid circular dependencies with the\n    // core Editor and Renderer components.\n    register: function(name, widget, editor) {\n        widgets[name] = widget;\n        editors[name] = editor;\n    },\n\n    registerMany: function(widgets) {\n        widgets.forEach(([widget, editor]) => {\n            widget && this.register(widget.name, widget, editor);\n        });\n\n        this.validateAlignments();\n    },\n\n    getWidget: function(name) {\n        // TODO(alex): Consider referring to these as renderers to avoid\n        // overloading \"widget\"\n        if (!_.has(widgets, name)) {\n            return null;\n        }\n\n        // Allow widgets to specify a widget directly or via a function\n        if (widgets[name].getWidget) {\n            return widgets[name].getWidget();\n        } else {\n            return widgets[name].widget;\n        }\n    },\n\n    getEditor: function(name) {\n        return _.has(editors, name) ? editors[name] : null;\n    },\n\n    getTransform: function(name) {\n        return _.has(widgets, name)\n            ? widgets[name].transform || _.identity\n            : null;\n    },\n\n    getVersion: function(name) {\n        var widgetInfo = widgets[name];\n        if (widgetInfo) {\n            return widgets[name].version || {major: 0, minor: 0};\n        } else {\n            return null;\n        }\n    },\n\n    getVersionVector: function() {\n        var version = {};\n        _.each(_.keys(widgets), function(name) {\n            version[name] = Widgets.getVersion(name);\n        });\n        return version;\n    },\n\n    getPublicWidgets: function() {\n        // TODO(alex): Update underscore.js so that _.pick can take a function.\n        return _.pick(\n            widgets,\n            _.reject(_.keys(widgets), function(name) {\n                return widgets[name].hidden;\n            })\n        );\n    },\n\n    isAccessible: function(widgetInfo) {\n        var accessible = widgets[widgetInfo.type].accessible;\n        if (typeof accessible === \"function\") {\n            return accessible(widgetInfo.options);\n        } else {\n            return !!accessible;\n        }\n    },\n\n    getAllWidgetTypes: function() {\n        return _.keys(widgets);\n    },\n\n    upgradeWidgetInfoToLatestVersion: function(oldWidgetInfo) {\n        var type = oldWidgetInfo.type;\n        if (!_.isString(type)) {\n            throw new Error(\"widget type must be a string, but was: \" + type);\n        }\n        var widgetExports = widgets[type];\n\n        if (widgetExports == null) {\n            // If we have a widget that isn't registered, we can't upgrade it\n            // TODO(aria): Figure out what the best thing to do here would be\n            return oldWidgetInfo;\n        }\n\n        // Unversioned widgets (pre-July 2014) are all implicitly 0.0\n        var initialVersion = oldWidgetInfo.version || {major: 0, minor: 0};\n        var latestVersion = widgetExports.version || {major: 0, minor: 0};\n\n        // If the widget version is later than what we understand (major\n        // version is higher than latest, or major versions are equal and minor\n        // version is higher than latest), don't perform any upgrades.\n        if (\n            initialVersion.major > latestVersion.major ||\n            (initialVersion.major === latestVersion.major &&\n                initialVersion.minor > latestVersion.minor)\n        ) {\n            return oldWidgetInfo;\n        }\n\n        // We do a clone here so that it's safe to mutate the input parameter\n        // in propUpgrades functions (which I will probably accidentally do at\n        // some point, and we would like to not break when that happens).\n        var newEditorProps = _.clone(oldWidgetInfo.options) || {};\n\n        var upgradePropsMap = widgetExports.propUpgrades || {};\n\n        // Empty props usually mean a newly created widget by the editor,\n        // and are always considerered up-to-date.\n        // Mostly, we'd rather not run upgrade functions on props that are\n        // not complete.\n        if (_.keys(newEditorProps).length !== 0) {\n            // We loop through all the versions after the current version of\n            // the loaded widget, up to and including the latest version of the\n            // loaded widget, and run the upgrade function to bring our loaded\n            // widget's props up to that version.\n            // There is a little subtlety here in that we call\n            // upgradePropsMap[1] to upgrade *to* version 1,\n            // (not from version 1).\n            for (\n                var nextVersion = initialVersion.major + 1;\n                nextVersion <= latestVersion.major;\n                nextVersion++\n            ) {\n                if (upgradePropsMap[nextVersion]) {\n                    newEditorProps = upgradePropsMap[nextVersion](\n                        newEditorProps\n                    );\n                } else if (typeof console !== \"undefined\" && console.warn) {\n                    // This is a warning because it is unlikely to be hit in\n                    // local testing, and a warning is slightly less scary in\n                    // prod than a `throw new Error`\n                    console.warn(\n                        \"No upgrade found for widget `\" +\n                            type +\n                            \"` from \" +\n                            \"major version `\" +\n                            (nextVersion - 1) +\n                            \"` to \" +\n                            \"major version `\" +\n                            nextVersion +\n                            \"` found. This \" +\n                            \"is necessary to render this `\" +\n                            type +\n                            \"` correctly.\"\n                    );\n                    // But try to keep going anyways (yolo!)\n                    // (Throwing an error here would just break the page\n                    // silently anyways, so that doesn't seem much better\n                    // than a halfhearted attempt to continue, however\n                    // shallow...)\n                }\n            }\n        }\n\n        // Minor version upgrades (eg. new optional props) don't have\n        // transform functions. Instead, we fill in the new props with their\n        // defaults.\n        var defaultProps = editors[type].defaultProps;\n        newEditorProps = _.extend({}, defaultProps, newEditorProps);\n\n        var alignment = oldWidgetInfo.alignment;\n\n        // Widgets that support multiple alignments will \"lock in\" the\n        // alignment to the alignment that would be listed first in the\n        // select box. If the widget only supports one alignment, the\n        // alignment value will likely just end up as \"default\".\n        if (alignment == null || alignment === \"default\") {\n            alignment = Widgets.getSupportedAlignments(type)[0];\n        }\n\n        var widgetStatic = oldWidgetInfo.static;\n\n        if (widgetStatic == null) {\n            widgetStatic = DEFAULT_STATIC;\n        }\n\n        return _.extend({}, oldWidgetInfo, {\n            // maintain other info, like type\n            // After upgrading we guarantee that the version is up-to-date\n            version: latestVersion,\n            // Default graded to true (so null/undefined becomes true):\n            graded: oldWidgetInfo.graded != null ? oldWidgetInfo.graded : true,\n            alignment: alignment,\n            static: widgetStatic,\n            options: newEditorProps,\n        });\n    },\n\n    getRendererPropsForWidgetInfo: function(widgetInfo, problemNum) {\n        var type = widgetInfo.type;\n        var widgetExports = widgets[type];\n        if (widgetExports == null) {\n            // The widget is not a registered widget\n            // It shouldn't matter what we return here, but for consistency\n            // we return the untransformed options, as if the widget did\n            // not have a transform defined.\n            return widgetInfo.options;\n        }\n        var transform;\n        if (widgetInfo.static) {\n            // There aren't a lot of real places where we'll have to default to\n            // _.identity, but it's theoretically possile if someone changes\n            // the JSON manually / we have to back out static support for a\n            // widget.\n            transform = this.getStaticTransform(type) || _.identity;\n        } else {\n            transform = widgetExports.transform || _.identity;\n        }\n        // widgetInfo.options are the widgetEditor's props:\n        return transform(widgetInfo.options, problemNum);\n    },\n\n    traverseChildWidgets: function(widgetInfo, traverseRenderer) {\n        if (!traverseRenderer) {\n            throw new Error(\"traverseRenderer must be provided, but was not\");\n        }\n\n        if (!widgetInfo || !widgetInfo.type || !widgets[widgetInfo.type]) {\n            return widgetInfo;\n        }\n\n        var widgetExports = widgets[widgetInfo.type];\n        var props = widgetInfo.options;\n\n        if (widgetExports.traverseChildWidgets && props) {\n            var newProps = widgetExports.traverseChildWidgets(\n                props,\n                traverseRenderer\n            );\n            return _.extend({}, widgetInfo, {options: newProps});\n        } else {\n            return widgetInfo;\n        }\n    },\n\n    /**\n     * Handling for the optional alignments for widgets\n     * See widget-container.jsx for details on how alignments are implemented.\n     */\n\n    /**\n     * Returns the list of supported alignments for the given (string) widget\n     * type. This is used primarily at editing time to display the choices\n     * for the user.\n     *\n     * Supported alignments are given as an array of strings in the exports of\n     * a widget's _module_.\n     */\n    getSupportedAlignments: function(type) {\n        var widgetInfo = widgets[type];\n        return (\n            (widgetInfo && widgetInfo.supportedAlignments) ||\n            DEFAULT_SUPPORTED_ALIGNMENTS\n        );\n    },\n\n    /**\n     * For the given (string) widget type, determine the default alignment for\n     * the widget. This is used at rendering time to go from \"default\" alignment\n     * to the actual alignment displayed on the screen.\n     *\n     * The default alignment is given either as a string (called\n     * `defaultAlignment`) or a function (called `getDefaultAlignment`) on\n     * the exports of a widget's _module_.\n     */\n    getDefaultAlignment: function(type) {\n        var widgetInfo = widgets[type];\n        var alignment;\n        if (!widgetInfo) {\n            return DEFAULT_ALIGNMENT;\n        }\n\n        if (widgetInfo.getDefaultAlignment) {\n            alignment = widgetInfo.getDefaultAlignment();\n        } else {\n            alignment = widgetInfo.defaultAlignment;\n        }\n        return alignment || DEFAULT_ALIGNMENT;\n    },\n\n    validAlignments: [\n        \"block\",\n        \"inline-block\",\n        \"inline\",\n        \"float-left\",\n        \"float-right\",\n        \"full-width\",\n    ],\n\n    /**\n     * Used at startup to fail fast if an alignment given by a widget is\n     * invalid.\n     */\n    // TODO(alex): Change this to run as a testcase (vs. being run at runtime)\n    validateAlignments: function() {\n        _.each(widgets, function(widgetInfo) {\n            if (\n                widgetInfo.defaultAlignment &&\n                !_.contains(\n                    Widgets.validAlignments,\n                    widgetInfo.defaultAlignment\n                )\n            ) {\n                throw new Error(\n                    \"Widget '\" +\n                        widgetInfo.displayName +\n                        \"' has an invalid defaultAlignment value: \" +\n                        widgetInfo.defaultAlignment\n                );\n            }\n\n            if (widgetInfo.supportedAlignments) {\n                var unknownAlignments = _.difference(\n                    widgetInfo.supportedAlignments,\n                    Widgets.validAlignments\n                );\n\n                if (unknownAlignments.length) {\n                    throw new Error(\n                        \"Widget '\" +\n                            widgetInfo.displayName +\n                            \"' has an invalid value for supportedAlignments: \" +\n                            unknownAlignments.join(\" \")\n                    );\n                }\n            }\n        });\n    },\n\n    /**\n     * Handling for static mode for widgets that support it.\n     */\n\n    /**\n     * Returns true iff the widget supports static mode.\n     * A widget implicitly supports static mode if it exports a\n     * staticTransform function.\n     */\n    supportsStaticMode: function(type) {\n        var widgetInfo = widgets[type];\n        return widgetInfo && widgetInfo.staticTransform != null;\n    },\n\n    /**\n     * Return the staticTransform function used to convert the editorProps to\n     * the rendered widget state.\n     */\n    getStaticTransform: function(type) {\n        var widgetInfo = widgets[type];\n        return widgetInfo && widgetInfo.staticTransform;\n    },\n\n    /**\n     * Returns the tracking option for the widget. The default is \"\",\n     * which means simply to track interactions once. The other available\n     * option is \"all\" which means to track all interactions.\n     */\n    getTracking: function(type) {\n        var widgetInfo = widgets[type];\n        return (widgetInfo && widgetInfo.tracking) || DEFAULT_TRACKING;\n    },\n\n    /**\n     * Returns true if this widget can include lintable markdown text\n     * and supports a highlightLint prop, or false otherwise.\n     */\n    isLintable: function(type) {\n        var widgetInfo = widgets[type];\n        return (widgetInfo && widgetInfo.isLintable) || DEFAULT_LINTABLE;\n    },\n};\n\n_module_.exports = Widgets;\nexport default _module_.exports;\n","import _react from \"react\";\nimport { interactiveSizes } from \"../styles/constants.js\";\n\n// Note: these size cutoffs represent content-width cutoffs as\n// specified in http://zpl.io/1mVmvU\n// TODO(benkomalo): these values aren't used in JS outside of this file, but\n// are coupled to the values in\n// stylesheets/exercise-content-package/articles.less - DRY it up at some point\nconst React = _react;\n\nconst smMax = 512;\nconst mdMax = 688;\n\nexport const containerSizeClass = {\n    SMALL: \"small\",\n    MEDIUM: \"medium\",\n    LARGE: \"large\",\n    XLARGE: \"xlarge\",\n};\n\nexport const containerSizeClassPropType = PropTypes.oneOf(\n    Object.values(containerSizeClass)\n);\n\nexport const getClassFromWidth = width => {\n    if (!width) {\n        return containerSizeClass.MEDIUM;\n    }\n\n    if (width <= smMax) {\n        return containerSizeClass.SMALL;\n    } else if (width <= mdMax) {\n        return containerSizeClass.MEDIUM;\n    } else {\n        return containerSizeClass.LARGE;\n    }\n};\n\nexport const getInteractiveBoxFromSizeClass = sizeClass => {\n    if (sizeClass === containerSizeClass.SMALL) {\n        return [\n            interactiveSizes.defaultBoxSizeSmall,\n            interactiveSizes.defaultBoxSizeSmall,\n        ];\n    } else {\n        return [\n            interactiveSizes.defaultBoxSize,\n            interactiveSizes.defaultBoxSize,\n        ];\n    }\n};\n","import { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport { containerSizeClass, getClassFromWidth } from \"./util/sizing-utils.js\";\nimport _widgetsJs from \"./widgets.js\";\nimport { zIndexInteractiveComponent } from \"./styles/constants.js\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst classNames = _classnames;\nconst React = _react;\nconst ReactDOM = _reactDom;\n\nconst Widgets = _widgetsJs;\n\nconst WidgetContainer = createReactClass({\n    propTypes: {\n        shouldHighlight: PropTypes.bool.isRequired,\n        type: PropTypes.string,\n        initialProps: PropTypes.object.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps() {\n        return {\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            // TODO(benkomalo): before we're mounted, we don't know how big\n            // we're going to be, so just default to MEDIUM for now. :/ In the\n            // future we can sniff with user-agents or something to get a\n            // better approximation, to avoid flickers\n            sizeClass: containerSizeClass.MEDIUM,\n            widgetProps: this.props.initialProps,\n        };\n    },\n\n    componentDidMount() {\n        // Only relay size class changes for mobile right now.  We may want to\n        // this for desktop as well at some point in the future.\n        if (this.state.widgetProps.apiOptions.isMobile) {\n            const containerWidth = ReactDOM.findDOMNode(this).offsetWidth;\n\n            // NOTE(benkomalo): in the common case, this won't change anything.\n            // Unfortunately, it will cause a flash and re-layout on mobile,\n            // but until we have better SSR or a more drastic way change to our\n            // APIs that hints at the available size, we do have to measure DOM\n            // unfortunately.\n            /* eslint-disable react/no-did-mount-set-state */\n            this.setState({\n                sizeClass: getClassFromWidth(containerWidth),\n            });\n            /* eslint-enable react/no-did-mount-set-state */\n        }\n    },\n\n    render: function() {\n        let className = classNames({\n            \"perseus-widget-container\": true,\n            \"widget-highlight\": this.props.shouldHighlight,\n            \"widget-nohighlight\": !this.props.shouldHighlight,\n        });\n\n        const type = this.props.type;\n        const WidgetType = Widgets.getWidget(type);\n        if (WidgetType == null) {\n            // Just give up on invalid widget types\n            return <div className={className} />;\n        }\n\n        let alignment = this.state.widgetProps.alignment;\n        if (alignment === \"default\") {\n            alignment = Widgets.getDefaultAlignment(type);\n        }\n\n        className += \" widget-\" + alignment;\n\n        const apiOptions = this.state.widgetProps.apiOptions;\n\n        // Hack to prevent interaction with static widgets: we overlay a big\n        // div on top of the widget and overflow: hidden the container.\n        // Ideally widgets themselves should know how to prevent interaction.\n        const isStatic = this.state.widgetProps.static || apiOptions.readOnly;\n        const staticContainerStyles = {\n            position: \"relative\",\n            overflow: \"visible\",\n        };\n        const staticOverlayStyles = {\n            width: \"100%\",\n            height: \"100%\",\n            position: \"absolute\",\n            top: 0,\n            left: 0,\n            zIndex: zIndexInteractiveComponent,\n        };\n\n        // Some widgets may include strings of markdown that we may\n        // want to run the linter on. So if the widget is lintable,\n        // and we've been asked to highlight lint, pass that property\n        // on to the widget, and if the content is not lintable, make sure\n        // to default to false.\n        const linterContext = this.props.linterContext;\n\n        if (!Widgets.isLintable(type)) {\n            linterContext.highlightLint = false;\n        }\n\n        // Note: if you add more props here, please consider whether or not\n        // it should be auto-serialized (e.g. used in scoreInput()). See\n        // widget-jsonify-deprecated.jsx and widget-prop-blacklist.jsx\n\n        // We default to an empty object for style instead of null\n        // because of a strange bug where the static styles aren't applied\n        // after toggling static mode.\n        return (\n            <div\n                className={className}\n                style={isStatic ? staticContainerStyles : {}}\n            >\n                <WidgetType\n                    {...this.state.widgetProps}\n                    linterContext={linterContext}\n                    containerSizeClass={this.state.sizeClass}\n                    ref=\"widget\"\n                />\n                {isStatic && <div style={staticOverlayStyles} />}\n            </div>\n        );\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (this.props.type !== nextProps.type) {\n            throw new Error(\n                \"WidgetContainer can't change widget type; set a different \" +\n                    \"key instead to recreate the container.\"\n            );\n        }\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        return (\n            this.props.shouldHighlight !== nextProps.shouldHighlight ||\n            this.props.type !== nextProps.type ||\n            this.state.widgetProps !== nextState.widgetProps ||\n            this.state.sizeClass !== nextState.sizeClass\n        );\n    },\n\n    getWidget: function() {\n        return this.refs.widget;\n    },\n\n    replaceWidgetProps: function(newWidgetProps) {\n        this.setState({widgetProps: newWidgetProps});\n    },\n});\n\n_module_.exports = WidgetContainer;\nexport default _module_.exports;\n","/* eslint-disable comma-dangle, max-len, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n// Derived from the MIT-licensed:\n// https://github.com/fat/zoom.js/blob/fd4f3e43153da7596da0bade198e99f98b47791e/js/zoom.js\n\n// NOTE(kevindangoor)\n// This version zooms a new, absolutely positioned image element rather than\n// scaling the original image element within a new container. The problem that\n// I ran into was that we had a grandparent node with a z-index\n// which caused the zoomed image to end up behind the overlay. We sidestep all\n// of that by simplifying to just use a new image element.\n\n/*global $*/\n/*jshint browser:true, node:true */\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/* ========================================================================\n * Bootstrap: transition.js v3.3.4\n * http://getbootstrap.com/javascript/#transitions\n * ========================================================================\n * Copyright 2011-2015 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * ======================================================================== */\n\n// CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)\n// ============================================================\n\nfunction transitionEnd() {\n    var el = document.createElement(\"bootstrap\");\n\n    var transEndEventNames = {\n        WebkitTransition: \"webkitTransitionEnd\",\n        MozTransition: \"transitionend\",\n        OTransition: \"oTransitionEnd otransitionend\",\n        transition: \"transitionend\",\n    };\n\n    for (var name in transEndEventNames) {\n        if (el.style[name] !== undefined) {\n            return {\n                end: transEndEventNames[name],\n            };\n        }\n    }\n\n    return false; // explicit for ie8 (  ._.)\n}\n\n// http://blog.alexmaccaw.com/css-transitions\n$.fn.emulateTransitionEnd = function(duration) {\n    var called = false;\n    var $el = this;\n    $(this).one(\"bsTransitionEnd\", function() {\n        called = true;\n    });\n    var callback = function() {\n        if (!called) {\n            $($el).trigger($.support.transition.end);\n        }\n    };\n\n    setTimeout(callback, duration);\n    return this;\n};\n\n$(function() {\n    $.support.transition = transitionEnd();\n\n    if (!$.support.transition) {\n        return;\n    }\n\n    $.event.special.bsTransitionEnd = {\n        bindType: $.support.transition.end,\n        delegateType: $.support.transition.end,\n        handle: function(e) {\n            if ($(e.target).is(this)) {\n                return e.handleObj.handler.apply(this, arguments);\n            }\n        },\n    };\n});\n\n/**\n * Changes the viewport meta tag to the given contentString. Invokes callback\n * after viewport meta tag changes have taken effect.\n *\n * TODO(david): Return a promise instead of invoking a callback.\n */\nfunction changeViewportTag(contentString, callback) {\n    const scrollX = window.scrollX;\n    const scrollY = window.scrollY;\n\n    const viewport = document.querySelector(\"meta[name=viewport]\");\n    if (viewport) {\n        viewport.setAttribute(\"content\", contentString);\n    } else {\n        $(\"head\").append(`<meta name=\"viewport\" content=\"${contentString}\">`);\n    }\n\n    // Hacky way to get the page to take the changes\n    // From http://stackoverflow.com/a/36894653\n    document.body.style.opacity = 0.9999;\n\n    // ... and undo the temporary change.\n    setTimeout(() => {\n        document.body.style.opacity = 1;\n\n        // ... which involves restoring the scroll position, which may have\n        // changed.\n        window.scrollTo(scrollX, scrollY);\n\n        // Invoke callback on the next tick to wait for scroll position to have\n        // finished resetting.\n        callback && setTimeout(callback, 0);\n    }, 0);\n}\n\n/**\n * The zoom service\n */\nfunction _ZoomService() {}\n\n_ZoomService.prototype._initialize = function(enableMobilePinch) {\n    // Check to see if the service is already initialized\n    if (this._$document) {\n        return;\n    }\n    this._activeZoom = this._initialScrollPosition = this._initialTouchPosition = this._touchMoveListener = null;\n\n    this._$document = $(document);\n    this._$window = $(window);\n    this._$body = $(document.body);\n\n    this._boundClick = $.proxy(this._clickHandler, this);\n\n    this._enableMobilePinch = enableMobilePinch;\n};\n\n_ZoomService.prototype.handleZoomClick = function(e, enableMobilePinch) {\n    this._initialize(enableMobilePinch);\n    var target = e.target;\n\n    if (!target || target.tagName !== \"IMG\") {\n        return;\n    }\n\n    if (this._$body.hasClass(\"zoom-overlay-open\")) {\n        return;\n    }\n\n    if (e.metaKey || e.ctrlKey) {\n        return window.open(e.target.src, \"_blank\");\n    }\n\n    if (\n        !enableMobilePinch &&\n        target.width >= window.innerWidth - Zoom.getOffset()\n    ) {\n        return;\n    }\n\n    this._activeZoomClose(true);\n\n    // Enable page zooming in (i.e. make sure there's no maximum-scale). Also,\n    // disable page zoom out on mobile devices, because the container that the\n    // image is placed in becomes bigger than the viewport if the page can be\n    // zoomed out. We explored other fixes like fixing the overlay and page\n    // size to be the viewport, but thought that might be even worse of a hack.\n    // See for more info:\n    // http://dbushell.com/2013/09/10/css-fixed-positioning-and-mobile-zoom/\n    if (enableMobilePinch) {\n        // Disable zoom out by setting minimum scale of 1 on the viewport tag.\n        changeViewportTag(\n            \"width=device-width, initial-scale=1, minimum-scale=1\",\n            () => this._zoom(target)\n        );\n    } else {\n        this._zoom(target);\n    }\n\n    if (!enableMobilePinch) {\n        // todo(fat): probably worth throttling this\n        this._$window.on(\"scroll.zoom\", $.proxy(this._scrollHandler, this));\n\n        this._$document.on(\"keyup.zoom\", $.proxy(this._keyHandler, this));\n        this._$document.on(\"touchstart.zoom\", $.proxy(this._touchStart, this));\n    }\n\n    // we use a capturing phase here to prevent unintended js events\n    // sadly no useCapture in jquery api (http://bugs.jquery.com/ticket/14953)\n    document.addEventListener(\"click\", this._boundClick, true);\n\n    e.stopPropagation();\n};\n\n_ZoomService.prototype._zoom = function(target) {\n    this._activeZoom = new Zoom(target, this._enableMobilePinch);\n    this._activeZoom.zoomImage();\n};\n\n_ZoomService.prototype._activeZoomClose = function(forceDispose) {\n    if (!this._activeZoom) {\n        return;\n    }\n\n    if (forceDispose) {\n        this._activeZoom.dispose();\n        this._disposeActiveZoom();\n    } else {\n        // Reset any underlying page zoom in case the user had pinched to zoom.\n        changeViewportTag(\n            `width=device-width, initial-scale=1, minimum-scale=1,\n            maximum-scale=1`,\n            () => {\n                if (this._activeZoom) {\n                    this._activeZoom.close();\n                    this._disposeActiveZoom();\n                }\n            }\n        );\n    }\n};\n\n_ZoomService.prototype._disposeActiveZoom = function() {\n    this._$window.off(\".zoom\");\n    this._$document.off(\".zoom\");\n\n    document.removeEventListener(\"click\", this._boundClick, true);\n\n    this._activeZoom = null;\n};\n\n_ZoomService.prototype._scrollHandler = function(e) {\n    if (this._initialScrollPosition === null) {\n        this._initialScrollPosition = window.scrollY;\n    }\n    var deltaY = this._initialScrollPosition - window.scrollY;\n    if (Math.abs(deltaY) >= 40) {\n        this._activeZoomClose();\n    }\n};\n\n_ZoomService.prototype._keyHandler = function(e) {\n    if (e.keyCode === 27) {\n        this._activeZoomClose();\n    }\n};\n\n_ZoomService.prototype._clickHandler = function(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this._activeZoomClose();\n};\n\n_ZoomService.prototype._touchStart = function(e) {\n    // Our jQuery doesn't include `touches` in its event\n    // TODO(kevindangoor) Remove `originalEvent` once jQuery is updated\n    this._initialTouchPosition = e.originalEvent.touches[0].pageY;\n    $(e.target).on(\"touchmove.zoom\", $.proxy(this._touchMove, this));\n};\n\n_ZoomService.prototype._touchMove = function(e) {\n    // Our jQuery doesn't include `touches` in its event\n    // TODO(kevindangoor) Remove `originalEvent` once jQuery is updated\n    if (\n        Math.abs(\n            e.originalEvent.touches[0].pageY - this._initialTouchPosition\n        ) > 10\n    ) {\n        this._activeZoomClose();\n        $(e.target).off(\"touchmove.zoom\");\n    }\n};\n\n/**\n * The zoom object\n */\nfunction Zoom(img, enableMobilePinch) {\n    this._fullHeight = this._fullWidth = this._overlay = null;\n\n    this._targetImage = img;\n    this._enableMobilePinch = enableMobilePinch;\n\n    this._$body = $(document.body);\n}\n\n/** Margin around the image when in the \"zoomed\"/lightbox state. */\nZoom._OFFSET = 80;\nZoom._MAX_WIDTH = 2560;\nZoom._MAX_HEIGHT = 4096;\n\nZoom.getOffset = function(zoomToFitOnMobile) {\n    return zoomToFitOnMobile ? 0 : Zoom._OFFSET;\n};\n\nZoom.prototype.getOffset = function() {\n    return Zoom.getOffset(this._enableMobilePinch);\n};\n\nZoom.prototype.zoomImage = function() {\n    var img = document.createElement(\"img\");\n    var $zoomedImage = $(img);\n\n    img.onload = function() {\n        // Load the image without specifying height and width so that we can find\n        // the true height and width.\n        this._fullHeight = Number(img.height);\n        this._fullWidth = Number(img.width);\n\n        // Set up our image to mirror the current image on the document.\n        var imageOffset = (this._imageOffset = $(this._targetImage).offset());\n\n        // Position the image using viewport-fixed coordinates so that it is\n        // exactly over the image on the document.\n        //\n        // Said another way ... get the coordinates of the image relative to\n        // the viewport, and use those to position our new image (which is\n        // absolutely positioned within a full-bleed fixed-position container).\n        var left = (this._left = imageOffset.left - $(window).scrollLeft());\n        var top = (this._top = imageOffset.top - $(window).scrollTop());\n\n        $zoomedImage.css({\n            left: left,\n            top: top,\n            width: this._targetImage.width,\n            height: this._targetImage.height,\n        });\n\n        this._zoomOriginal();\n    }.bind(this);\n\n    img.src = this._targetImage.src;\n\n    this.$zoomedImage = $zoomedImage;\n};\n\nZoom.prototype._zoomOriginal = function() {\n    this.$zoomedImage.addClass(\"zoom-img\").attr(\"data-action\", \"zoom-out\");\n    $(this._targetImage).css(\"visibility\", \"hidden\");\n\n    this._backdrop = document.createElement(\"div\");\n    this._backdrop.className = \"zoom-backdrop\";\n    document.body.appendChild(this._backdrop);\n\n    this._overlay = document.createElement(\"div\");\n    this._overlay.className = \"zoom-overlay\";\n\n    document.body.appendChild(this._overlay);\n    this._overlay.appendChild(this.$zoomedImage[0]);\n\n    this._calculateZoom();\n    this._triggerAnimation();\n};\n\nZoom.prototype._calculateZoom = function() {\n    const originalFullImageWidth = this._fullWidth;\n    const originalFullImageHeight = this._fullHeight;\n    const viewportHeight = window.innerHeight - this.getOffset();\n    const viewportWidth = window.innerWidth - this.getOffset();\n\n    const maxScaleFactor = originalFullImageWidth / this._targetImage.width;\n\n    // Zoom to fit the viewport.\n    const imageAspectRatio = originalFullImageWidth / originalFullImageHeight;\n    const viewportAspectRatio = viewportWidth / viewportHeight;\n\n    if (\n        originalFullImageWidth < viewportWidth &&\n        originalFullImageHeight < viewportHeight\n    ) {\n        this._imgScaleFactor = maxScaleFactor;\n    } else if (imageAspectRatio < viewportAspectRatio) {\n        this._imgScaleFactor =\n            viewportHeight / originalFullImageHeight * maxScaleFactor;\n    } else {\n        this._imgScaleFactor =\n            viewportWidth / originalFullImageWidth * maxScaleFactor;\n    }\n};\n\nZoom.prototype._triggerAnimation = function() {\n    var viewportY = $(window).scrollTop() + window.innerHeight / 2;\n    var viewportX = $(window).scrollLeft() + window.innerWidth / 2;\n\n    var scaleFactor = this._imgScaleFactor;\n\n    var imageCenterY = this._imageOffset.top + this._targetImage.height / 2;\n    var imageCenterX = this._imageOffset.left + this._targetImage.width / 2;\n\n    this._translateY = (viewportY - imageCenterY) / scaleFactor;\n    this._translateX = (viewportX - imageCenterX) / scaleFactor;\n\n    // NOTE: This is re-used below.\n    this._zoomedInTransformString = `\n        scale(${scaleFactor})\n        translate3d(${this._translateX}px, ${this._translateY}px, 0)\n    `;\n\n    this.$zoomedImage\n        .css({\n            transform: this._zoomedInTransformString,\n        })\n        .addClass(\"zoom-transition\")\n        .one($.support.transition.end, $.proxy(this._onZoomInFinish, this))\n        .emulateTransitionEnd(300);\n\n    this._$body.addClass(\"zoom-overlay-open\");\n};\n\nZoom.prototype._onZoomInFinish = function() {\n    // Remove the transform on the image, but make it look exactly the same as\n    // the image with the transform -- full-size and centered in the viewport\n    // -- using margins + left/top + scroll\n    //\n    // We need to remove the transform for scrolling to work -- the browser\n    // would still calculate the element position/sizing by its pre-transform\n    // dimensions.\n\n    const height = this._targetImage.height * this._imgScaleFactor;\n    const width = this._targetImage.width * this._imgScaleFactor;\n    let left = 0;\n    let top = 0;\n    let marginLeft = 0;\n    let marginTop = 0;\n    let scrollLeft = 0;\n    let scrollTop = 0;\n\n    // Horizontally center the image within the viewport, either by positioning\n    // with CSS or scrolling the viewport.\n    if (width < window.innerWidth) {\n        left = \"50%\";\n        marginLeft = -width / 2;\n    } else {\n        scrollLeft = (width - window.innerWidth) / 2;\n    }\n\n    // ... and similarly, vertically center the image within the viewport.\n    if (height < window.innerHeight) {\n        top = \"50%\";\n        marginTop = -height / 2;\n    } else {\n        scrollTop = (height - window.innerHeight) / 2;\n    }\n\n    this.$zoomedImage\n        .css({\n            height: height,\n            left: left,\n            marginLeft: marginLeft,\n            marginTop: marginTop,\n            top: top,\n            transform: \"\",\n            width: width,\n        })\n        .removeClass(\"zoom-transition\");\n\n    $(this._overlay).scrollLeft(scrollLeft).scrollTop(scrollTop);\n};\n\nZoom.prototype.close = function() {\n    this._$body\n        .removeClass(\"zoom-overlay-open\")\n        .addClass(\"zoom-overlay-transitioning\");\n\n    // Upon closing the image, zoom it back out. Do this by first re-applying the\n    // zoomed-in transform and resetting the CSS top/left + margins to what it\n    // was right after zooming in -- basically undoing what we did in\n    // _onZoomInFinish.\n    // TODO(david): Adjust this translation of the transform to take into\n    //     account the current scroll position of the image (if the user\n    //     scrolled the image after it was zoomed).\n    this.$zoomedImage\n        .css({\n            height: this._targetImage.height,\n            left: this._left,\n            marginLeft: 0,\n            marginTop: 0,\n            top: this._top,\n            transform: this._zoomedInTransformString,\n            width: this._targetImage.width,\n        })\n        .removeClass(\"zoom-transition\");\n\n    $(this._overlay).scrollLeft(0).scrollTop(0);\n\n    // ... now that the image and its container have been set up to be in the\n    // same state as right at the end of the zoom-in animation, reset the\n    // transform to scale(1) to achieve the zoom-out-into-image-on-document\n    // animation.\n    setTimeout(() => {\n        this.$zoomedImage\n            .css({\n                transform: \"scale(1)\",\n            })\n            .addClass(\"zoom-transition\")\n            .one($.support.transition.end, $.proxy(this.dispose, this))\n            .emulateTransitionEnd(300);\n    }, 10);\n};\n\nZoom.prototype.dispose = function() {\n    if (this.$zoomedImage && this.$zoomedImage[0].parentNode) {\n        this.$zoomedImage.remove();\n        this.$zoomedImage = null;\n\n        this._overlay.parentNode.removeChild(this._overlay);\n        this._backdrop.parentNode.removeChild(this._backdrop);\n\n        this._$body.removeClass(\"zoom-overlay-transitioning\");\n    }\n    $(this._targetImage).css(\"visibility\", \"visible\");\n};\n\nexports.ZoomService = new _ZoomService();\nexport let ZoomService = exports.ZoomService;\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/*\n    We are currently in a situation where Crowdin adds extra backslashes\n    to some strings, but not all. However, we can trust that an individual\n    string is in its entirety either escaped or not. This will allow us to use\n    a heuristic to determine with a high probability whether a string is\n    escaped or not, and thus whether to unescape it or not in\n    our `before_dom_insert()` JIPT hook.\n\n    TODO(aasmund): Delete this file when we have converted all our strings\n    to the new, unescaped Crowdin format. Calls to `maybeUnescape()` should\n    be deleted (unescaping will never be needed anymore).\n\n    The heuristic is as follows:\n    - For each LaTeX-like token (one or more backslashes followed by a special\n      character or by at least one letter) in the string:\n      - If the token cannot be unescaped (e.g. \\e ), return the original string.\n        Otherwise, we now have two candidate tokens: the original tokens\n        and the escaped tokens.\n      - For both the original and the unescaped token, compute a number that\n        indicates *how* LaTeX-like the token is:\n        - 6 if there's an odd number of backslashes followed by a valid LaTeX\n          macro name (all backslashes but the last form a sequence of LaTeX\n          newlines, and the last one starts the LaTeX macro)\n        - 4 if there's one backslash followed by a dollar sign\n          (this is likely intended to actually display a dollar sign)\n        - 3 if there's an even number of backslashes (this is a sequence of\n          LaTeX newlines, and the letters that follow are LaTeX math variables)\n        - 2 if there are no backslashes (this is valid, but not LaTeX)\n        - 1 if there's an odd number of backslashes (but more than one)\n          followed by a dollar sign (our strings don't currently contain this)\n        - 0 otherwise (if there's an odd number of backslashes followed by\n          something that isn't a valid LaTeX macro name)\n    - If exactly one of the candidate strings contains one or more tokens\n      that scored 0, return the other string. Otherwise, return the string\n      with the highest sum of token scores, choosing the unescaped string\n      if there's a tie.\n\n    This algorithm was implemented in Python and run against all of our current\n    Crowdin strings (about 440,000), both in original form and escaped form.\n    It *always* makes the correct guess for the original strings, and makes\n    the wrong guess only for 30 of the escaped strings.\n */\n\n// This regex captures sequences that might represent LaTeX or escape sequences\nconst MAYBE_LATEX_REGEX = /\\\\+([ !#$%*,.:;\\[\\]\\^_{|}]|[a-zA-Z]*)/g;\n\n// These are the LaTeX macros that are currently in use in our strings.\n// They were collected by applying the above regex to all of our\n// Crowdin strings, and manually removing most invalid macro names. Macro name\n// validity was tested by pasting the macros into the Perseus editor.\n// Invalid macros would typically be the result of the regex finding a sequence\n// of LaTeX newlines followed by regular text, e.g. \"\\\\\\\\xy = z\". However,\n// there are some actual misspellings around, so we've kept those.\n// Note that \\$ is handled separately.\nconst LATEX_MACROS_LIST = [\n    \" \",\n    \"!\",\n    \"#\",\n    \"%\",\n    \"*\",\n    \",\",\n    \".\",\n    \":\",\n    \";\",\n    \"[\",\n    \"]\",\n    \"^\",\n    \"_\",\n    \"{\",\n    \"|\",\n    \"}\",\n    \"alpha\",\n    \"angle\",\n    \"approx\",\n    \"arccos\",\n    \"arcsin\",\n    \"arctan\",\n    \"arrow\",\n    \"bar\",\n    \"barwedge\",\n    \"begin\",\n    \"beta\",\n    \"bf\",\n    \"big\",\n    \"Big\",\n    \"bigg\",\n    \"Bigg\",\n    \"bigl\",\n    \"Bigl\",\n    \"bigr\",\n    \"Bigr\",\n    \"bigstar\",\n    \"bigtriangledown\",\n    \"bigtriangleup\",\n    \"binom\",\n    \"blacklozenge\",\n    \"blue\",\n    \"blueA\",\n    \"blueB\",\n    \"blueC\",\n    \"blueD\",\n    \"blueE\",\n    \"boldsymbol\",\n    \"Box\",\n    \"boxdot\",\n    \"boxed\",\n    \"bullet\",\n    \"cancel\",\n    \"cap\",\n    \"cdot\",\n    \"cdots\",\n    \"checkmark\",\n    \"chi\",\n    \"circ\",\n    \"circledcirc\",\n    \"clubsuit\",\n    \"colon\",\n    \"color\",\n    \"cong\",\n    \"cos\",\n    \"cot\",\n    \"csc\",\n    \"cup\",\n    \"curvearrowright\",\n    \"dagger\",\n    \"dbinom\",\n    \"ddots\",\n    \"delta\",\n    \"Delta\",\n    \"det\",\n    \"dfrac\",\n    \"diamond\",\n    \"diamondsuit\",\n    \"displaystyle\",\n    \"div\",\n    \"dot\",\n    \"dots\",\n    \"downarrow\",\n    \"Downarrow\",\n    \"ell\",\n    \"end\",\n    \"enspace\",\n    \"epsilon\",\n    \"equiv\",\n    \"eta\",\n    \"fbox\",\n    \"flat\",\n    \"footnotesize\",\n    \"frac\",\n    \"frown\",\n    \"gamma\",\n    \"Gamma\",\n    \"gcf\",\n    \"ge\",\n    \"geq\",\n    \"gg\",\n    \"goldB\",\n    \"goldC\",\n    \"goldD\",\n    \"goldE\",\n    \"gray\",\n    \"grayD\",\n    \"grayE\",\n    \"grayF\",\n    \"green\",\n    \"greenB\",\n    \"greenC\",\n    \"greenD\",\n    \"greenE\",\n    \"gt\",\n    \"hat\",\n    \"hbox\",\n    \"heartsuit\",\n    \"hline\",\n    \"hphantom\",\n    \"huge\",\n    \"Huge\",\n    \"iff\",\n    \"iiint\",\n    \"iint\",\n    \"implies\",\n    \"in\",\n    \"infty\",\n    \"int\",\n    \"intercal\",\n    \"it\",\n    \"kaBlue\",\n    \"kappa\",\n    \"kern\",\n    \"lambda\",\n    \"langle\",\n    \"large\",\n    \"Large\",\n    \"LARGE\",\n    \"lcm\",\n    \"ldots\",\n    \"le\",\n    \"left\",\n    \"leftarrow\",\n    \"leftrightarrow\",\n    \"Leftrightarrow\",\n    \"leftrightharpoons\",\n    \"leftroot\",\n    \"leq\",\n    \"lfloor\",\n    \"lg\",\n    \"lim\",\n    \"limits\",\n    \"llap\",\n    \"ln\",\n    \"log\",\n    \"longrightarrow\",\n    \"Longrightarrow\",\n    \"lozenge\",\n    \"lt\",\n    \"lvert\",\n    \"maroonB\",\n    \"maroonC\",\n    \"maroonD\",\n    \"maroonE\",\n    \"mathbb\",\n    \"mathbf\",\n    \"mathcal\",\n    \"mathop\",\n    \"mathrm\",\n    \"mathsf\",\n    \"max\",\n    \"mbox\",\n    \"mid\",\n    \"mp\",\n    \"mu\",\n    \"nabla\",\n    \"ne\",\n    \"nearrow\",\n    \"neq\",\n    \"ngeq\",\n    \"ngtr\",\n    \"nleq\",\n    \"nless\",\n    \"normalsize\",\n    \"not\",\n    \"nu\",\n    \"nx\",\n    \"odot\",\n    \"oint\",\n    \"omega\",\n    \"Omega\",\n    \"operatorname\",\n    \"oplus\",\n    \"orange\",\n    \"oslash\",\n    \"otimes\",\n    \"overbrace\",\n    \"overleftarrow\",\n    \"overleftrightarrow\",\n    \"overline\",\n    \"overrightarrow\",\n    \"overset\",\n    \"parallel\",\n    \"partial\",\n    \"perp\",\n    \"phantom\",\n    \"phi\",\n    \"Phi\",\n    \"pi\",\n    \"pink\",\n    \"pm\",\n    \"prime\",\n    \"propto\",\n    \"psi\",\n    \"Psi\",\n    \"purple\",\n    \"purpleA\",\n    \"purpleC\",\n    \"purpleD\",\n    \"purpleE\",\n    \"qquad\",\n    \"quad\",\n    \"raise\",\n    \"rangle\",\n    \"red\",\n    \"redA\",\n    \"redB\",\n    \"redC\",\n    \"redD\",\n    \"redE\",\n    \"rfloor\",\n    \"rho\",\n    \"right\",\n    \"rightarrow\",\n    \"Rightarrow\",\n    \"rightleftharpoons\",\n    \"rvert\",\n    \"scriptsize\",\n    \"scriptstyle\",\n    \"searrow\",\n    \"sec\",\n    \"setminus\",\n    \"sharp\",\n    \"sigma\",\n    \"Sigma\",\n    \"sim\",\n    \"simeq\",\n    \"sin\",\n    \"small\",\n    \"space\",\n    \"sqrt\",\n    \"square\",\n    \"stackrel\",\n    \"star\",\n    \"substack\",\n    \"sum\",\n    \"swarrow\",\n    \"tan\",\n    \"tan\",\n    \"tau\",\n    \"tealA\",\n    \"tealB\",\n    \"tealC\",\n    \"tealD\",\n    \"tealE\",\n    \"text\",\n    \"textbf\",\n    \"textit\",\n    \"textrm\",\n    \"tfrac\",\n    \"therefore\",\n    \"theta\",\n    \"Theta\",\n    \"tilde\",\n    \"times\",\n    \"tiny\",\n    \"to\",\n    \"triangle\",\n    \"triangleleft\",\n    \"triangleright\",\n    \"underbrace\",\n    \"underline\",\n    \"underset\",\n    \"uparrow\",\n    \"uproot\",\n    \"varphi\",\n    \"vdots\",\n    \"vec\",\n    \"veebar\",\n    \"vert\",\n    \"vphantom\",\n    \"widehat\",\n    \"xi\",\n    \"xrightarrow\",\n\n    // These aren't valid LaTeX macros, but they are misspellings\n    // that also occur in our strings.\n    \"Begin\",\n    \"End\",\n    \"inte\",\n    \"lamba\",\n    \"textb\",\n];\n\nconst LATEX_MACROS = LATEX_MACROS_LIST.reduce(function(result, macro) {\n    result[macro] = null;\n    return result;\n}, {});\n\n// These escape sequences are the only ones that are in use. Note that newline,\n// carriage return, tab, and backslash are the only characters we use that have\n// standard escape sequences (we do not use vertical tab, form feed, etc.).\n// We also expect that Unicode characters are never represented\n// by their \\u escape sequence.\nconst ESCAPE_SEQUENCES = {\n    n: \"\\n\",\n    r: \"\\r\",\n    t: \"\\t\",\n    \"\\\\\": \"\\\\\",\n};\n\n// Returns a number representing how \"LaTeX-like\" a token is.\n// Will only be run on tokens that match `MAYBE_LATEX_REGEX`, or the result of\n// unescaping such a token. See the comment at the top of the file for details.\nconst getLatexLevel = function(text) {\n    let backslashCount = 0;\n    while (backslashCount < text.length && text[backslashCount] === \"\\\\\") {\n        backslashCount++;\n    }\n    if (backslashCount === 0) {\n        return 2; // Valid, but doesn't contain any LaTeX syntax\n    } else if (backslashCount % 2 === 0) {\n        return 3; // Sequence of LaTeX newlines followed by other chars\n    } else {\n        // An odd number of backslashes would be a sequence of LaTeX newlines\n        // followed by a LaTeX macro\n        const maybeMacro = text.substring(backslashCount);\n        if (maybeMacro === \"$\") {\n            // Valid, but all our strings that use escaped dollars only have\n            // one backslash, so this is likely wrong if there are more\n            return backslashCount === 1 ? 4 : 1;\n        } else {\n            return LATEX_MACROS.hasOwnProperty(maybeMacro) ? 6 : 0;\n        }\n    }\n};\n\nexport const tryUnescape = function(text) {\n    let i = 0;\n    let result = \"\";\n    while (i < text.length) {\n        const c = text[i];\n        if (c === \"\\\\\") {\n            i += 1;\n            if (i === text.length) {\n                return null; // Odd number of backslashes - not unescapable\n            }\n            const e = text[i];\n            if (ESCAPE_SEQUENCES.hasOwnProperty(e)) {\n                result += ESCAPE_SEQUENCES[e];\n            } else {\n                return null; // Invalid escape sequence\n            }\n        } else {\n            result += c;\n        }\n        i += 1;\n    }\n    return result;\n};\n\nexport const shouldUnescape = function(text) {\n    // - If there are no backslashes in the text, (un)escaping will have\n    //   no effect, so we can't tell whether this string has been escaped\n    //   by Crowdin. However, in order to help Manticore detect situations\n    //   where the translation is escaped and the source string isn't,\n    //   we will declare such strings not to be escaped.\n    // - For each token that might be LaTeX:\n    //   - Try to unescape it. If that fails, we can say for certain\n    //     that `text` is not escaped.\n    //   - Compute the LaTeX level (see the comment at the top of the file)\n    //     for the original and the unescaped token, and sum these values over\n    //     all the tokens. Also, keep track of whether any of the original\n    //     or escaped tokens contain invalid LaTeX.\n    // - If there existed invalid LaTeX only in the original tokens, we need to\n    //   unescape; if there existed invalid LaTeX only in the escaped tokens,\n    //   we need to keep the original.\n    // - Otherwise, select the version with the highest LaTeX level, preferring\n    //   the unescaped version if there's a tie (because most of our strings\n    //   are currently in the \"old Crowdin style\", meaning that they\n    //   are escaped).\n    if (text.indexOf(\"\\\\\") < 0) {\n        return false;\n    }\n    let levelSumOriginal = 0;\n    let levelSumUnescaped = 0;\n    let anyInvalidLatexInOriginal = false;\n    let anyInvalidLatexInUnescaped = false;\n    let match;\n    MAYBE_LATEX_REGEX.lastIndex = 0;\n    while ((match = MAYBE_LATEX_REGEX.exec(text)) !== null) {\n        const original = match[0];\n        const unescaped = tryUnescape(original);\n        if (unescaped === null) {\n            return false;\n        }\n        const originalLevel = getLatexLevel(original);\n        if (originalLevel === 0) {\n            anyInvalidLatexInOriginal = true;\n        }\n        const unescapedLevel = getLatexLevel(unescaped);\n        if (unescapedLevel === 0) {\n            anyInvalidLatexInUnescaped = true;\n        }\n        levelSumOriginal += originalLevel;\n        levelSumUnescaped += unescapedLevel;\n    }\n    if (anyInvalidLatexInOriginal !== anyInvalidLatexInUnescaped) {\n        return anyInvalidLatexInOriginal;\n    }\n    return levelSumUnescaped >= levelSumOriginal;\n};\n\n// Unescape the given string if it seems to be escaped.\nexport const maybeUnescape = function(text) {\n    if (shouldUnescape(text)) {\n        return tryUnescape(text);\n    } else {\n        return text;\n    }\n};\n\n// Unescape both of the given strings if the first one seems to be escaped.\n// This is necessary because some Crowdin string pairs have a mismatch in\n// their escaping: the source is new-style (not escaped), while the translation\n// is old-style (escaped). Such strings will give an error in the translation\n// download job, so we must ensure that they also give an error in the frontend.\n// We do this by retaining the mismatch in their escaping, instead of giving\n// them individual unescaping treatments.\nexport const maybeUnescapeAccordingToSource = function(source, translation) {\n    if (shouldUnescape(source)) {\n        // Note: We have not yet seen a situation where the source string is\n        // escaped and the translation is unescaped, so we choose not to care\n        // about that here. If it does happen, the second element in the\n        // returned array might be null.\n        return [tryUnescape(source), tryUnescape(translation)];\n    } else {\n        return [source, translation];\n    }\n};\n\n_module_.exports = {\n    maybeUnescape,\n    maybeUnescapeAccordingToSource,\n    shouldUnescape,\n};\nexport default _module_.exports;\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Component to display an image (or other React components) while the desired\n * image is loading.\n *\n * Derived from\n * https://github.com/hzdg/react-imageloader/blob/master/src/index.js\n * to better suit our environment/build tools. Additionally, this one does\n * not introduce a wrapper element, which makes styling easier.\n */\n\nconst React = _react;\n\nconst Status = {\n    PENDING: \"pending\",\n    LOADING: \"loading\",\n    LOADED: \"loaded\",\n    FAILED: \"failed\",\n};\n\nconst ImageLoader = createReactClass({\n    propTypes: {\n        children: PropTypes.oneOfType([\n            PropTypes.arrayOf(PropTypes.node),\n            PropTypes.node,\n        ]),\n        imgProps: PropTypes.any,\n        onError: PropTypes.func,\n        onLoad: PropTypes.func,\n\n        // When the DOM updates to replace the preloader with the image, or\n        // vice-versa, we trigger this callback.\n        onUpdate: PropTypes.func,\n\n        preloader: PropTypes.func,\n        src: PropTypes.string,\n    },\n\n    getInitialState: function(props) {\n        return {status: this.props.src ? Status.LOADING : Status.PENDING};\n    },\n\n    componentDidMount: function() {\n        if (this.state.status === Status.LOADING) {\n            this.createLoader();\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (this.props.src !== nextProps.src) {\n            this.setState({\n                status: nextProps.src ? Status.LOADING : Status.PENDING,\n            });\n        }\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        if (this.state.status === Status.LOADING && !this.img) {\n            this.createLoader();\n        }\n\n        if (prevState.status !== this.state.status) {\n            this.props.onUpdate();\n        }\n    },\n\n    componentWillUnmount: function() {\n        this.destroyLoader();\n    },\n\n    createLoader: function() {\n        this.destroyLoader(); // We can only have one loader at a time.\n\n        this.img = new Image();\n        this.img.onload = this.handleLoad;\n        this.img.onerror = this.handleError;\n        this.img.src = this.props.src;\n    },\n\n    destroyLoader: function() {\n        if (this.img) {\n            this.img.onload = null;\n            this.img.onerror = null;\n            this.img = null;\n        }\n    },\n\n    handleLoad: function(event) {\n        this.destroyLoader();\n        this.setState({status: Status.LOADED});\n\n        if (this.props.onLoad) {\n            this.props.onLoad(event);\n        }\n    },\n\n    handleError: function(error) {\n        this.destroyLoader();\n        this.setState({status: Status.FAILED});\n\n        if (this.props.onError) {\n            this.props.onError(error);\n        }\n    },\n\n    renderImg: function() {\n        const {src, imgProps} = this.props;\n        const props = {src};\n\n        for (const k in imgProps) {\n            if (imgProps.hasOwnProperty(k)) {\n                props[k] = imgProps[k];\n            }\n        }\n\n        return <img {...props} />;\n    },\n\n    render: function() {\n        switch (this.state.status) {\n            case Status.LOADED:\n                return this.renderImg();\n\n            case Status.FAILED:\n                if (this.props.children) {\n                    return this.props.children;\n                }\n                break;\n            default:\n                if (this.props.preloader) {\n                    return this.props.preloader();\n                }\n        }\n        return null;\n    },\n});\n\n_module_.exports = ImageLoader;\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * MovableThing convenience methods\n *\n * Usually added to a Movable* class through\n * InteractiveUtils.addMovableHelperMethodsTo(), but these implementations\n * are simply for convenience.\n */\n\nconst _ = _underscore;\nconst kpoint = _kmath.point;\n\n/* Local helper methods. */\n\nfunction getKey(eventName, id) {\n    return eventName + \":\" + id;\n}\n\nfunction getEventName(key) {\n    return key.split(\":\")[0];\n}\n\nconst MovableHelperMethods = {\n    /**\n     * Fire an onSomething type event to all functions in listeners\n     */\n    _fireEvent: function(listeners, currentValue, previousValue) {\n        _.invoke(listeners, \"call\", this, currentValue, previousValue);\n    },\n\n    /**\n     * Combine the array of constraints functions\n     * Returns either an [x, y] coordinate or false\n     */\n    _applyConstraints: function(current, previous, extraOptions) {\n        let skipRemaining = false;\n\n        return _.reduce(this.state.constraints, (memo, constraint) => {\n            // A move that has been cancelled won't be propagated to later\n            // constraints calls\n            if (memo === false) {\n                return false;\n            }\n\n            if (skipRemaining) {\n                return memo;\n            }\n\n            const result = constraint.call(this, memo, previous, {\n                onSkipRemaining: () => {\n                    skipRemaining = true;\n                },\n                ...extraOptions,\n            });\n\n            if (result === false) {\n                // Returning false cancels the move\n                return false;\n\n            } else if (kpoint.is(result, 2)) {\n                // Returning a coord from constraints overrides the move\n                return result;\n\n            } else if (result === true || result == null) {\n                // Returning true or undefined allow the move to occur\n                return memo;\n            } else {\n                // Anything else is an error\n                throw new Error(\"Constraint returned invalid result: \" +\n                        result);\n            }\n        }, current, this);\n    },\n\n    /**\n     * Call all draw functions, and update our prevState for the next\n     * draw function\n     */\n    draw: function() {\n        const currState = this.cloneState();\n        MovableHelperMethods._fireEvent.call(this,\n            this.state.draw,\n            currState,\n            this.prevState\n        );\n        this.prevState = currState;\n    },\n\n    /**\n     * Add a listener to any event: startMove, constraints, onMove, onMoveEnd,\n     * etc. If a listener is already bound to the given eventName and id, then\n     * it is overwritten by func.\n     *\n     * eventName: the string name of the event to listen to. one of:\n     *   \"onMoveStart\", \"onMove\", \"onMoveEnd\", \"draw\", \"remove\"\n     *\n     * id: a string id that can be used to remove this event at a later time\n     *   note: adding multiple listeners with the same id is undefined behavior\n     *\n     * func: the function to call when the event happens, which is called\n     *   with the event's standard parameters [usually (coord, prevCoord) or\n     *   (state, prevState)]\n     */\n    listen: function(eventName, id, func) {\n        this._listenerMap = this._listenerMap || {};\n\n        // If there's an existing handler, replace it by using its index in\n        // `this.state[eventName]`; otherwise, add this handler to the end\n        const key = getKey(eventName, id);\n        const index = this._listenerMap[key] =\n                this._listenerMap[key] || this.state[eventName].length;\n        this.state[eventName][index] = func;\n    },\n\n    /**\n     * Remove a previously added listener, by the id specified in the\n     * corresponding listen() call\n     *\n     * If the given id has not been registered already, this is a no-op\n     */\n    unlisten: function(eventName, id) {\n        this._listenerMap = this._listenerMap || {};\n\n        const key = getKey(eventName, id);\n        const index = this._listenerMap[key];\n        if (index !== undefined) {\n            // Remove handler from list of event handlers and listenerMap\n            this.state[eventName].splice(index, 1);\n            delete this._listenerMap[key];\n\n            // Re-index existing events: if they occur after `index`, decrement\n            const keys = _.keys(this._listenerMap);\n            _.each(keys, function(key) {\n                if (getEventName(key) === eventName &&\n                        this._listenerMap[key] > index) {\n                    this._listenerMap[key]--;\n                }\n            }, this);\n        }\n    },\n};\n\n_module_.exports = MovableHelperMethods;\nexport default _module_.exports;\n","import _movableHelperMethodsJs from \"./movable-helper-methods.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Utility functions for writing Interactive2 movablethings\n */\n\nconst _ = _underscore;\nconst MovableHelperMethods = _movableHelperMethodsJs;\n\n/**\n * Compute the correct vendor-prefixed `transform`.\n */\nlet prefixedTransform = null;\nfunction computePrefixedTransform() {\n    // Temporary element for testing prefix validity\n    const el = document.createElement(\"div\");\n\n    const prefixes = [\"transform\", \"msTransform\", \"MozTransform\",\n        \"WebkitTransform\", \"OTransform\"];\n    let correctPrefix = null;\n    _.each(prefixes, function(prefix) {\n        if (typeof el.style[prefix] !== 'undefined') {\n            correctPrefix = prefix;\n        }\n    });\n    return correctPrefix;\n}\n\n/**\n * Compute whether the browser can use 3d transforms by trying to use the\n * translateZ transformation.\n */\nlet canUse3dTransform = null;\nfunction computeCanUse3dTransform() {\n    const el = document.createElement(\"div\");\n\n    const prefix = InteractiveUtil.getPrefixedTransform();\n\n    el.style[prefix] = \"translateZ(0px)\";\n    return !!el.style[prefix];\n}\n\nconst InteractiveUtil = {\n    assert: function(isTrue, message) {\n        if (!isTrue) {\n            throw new Error(\"Assertion Error\" +\n                    (message ? \": \" + message : \"\"));\n        }\n    },\n\n    /**\n     * Create getters for this.state, based on the default state, `defaults`\n     */\n    createGettersFor: function(Class, defaults) {\n        _.each(_.keys(defaults), function(key) {\n            if (Class.prototype[key] === undefined) {\n                Class.prototype[key] = function() {\n                    return this.state[key];\n                };\n            }\n        });\n    },\n\n    /**\n     * Add MovableHelperMethods methods to a MovableThing class\n     */\n    addMovableHelperMethodsTo: function(Class) {\n        _.each(MovableHelperMethods, function(methodFunc, methodName) {\n            if (Class.prototype[methodName] === undefined) {\n                Class.prototype[methodName] = methodFunc;\n            }\n        });\n    },\n\n    /**\n     * Turn a function or an array of functions into an array of functions\n     */\n    arrayify: function(funcOrArray) {\n        if (funcOrArray == null) {\n            return [];\n        } else if (_.isArray(funcOrArray)) {\n            return _.filter(_.flatten(funcOrArray), _.identity);\n        } else {\n            return [funcOrArray];\n        }\n    },\n\n    /**\n     * Convert all function-or-array arguments to arrays of functions\n     */\n    normalizeOptions: function(arrayOptionNames, options) {\n        // TODO(jack): Having to clone here is annoying; this\n        // function should really just modify this.state in place\n        // (and maybe be a function on MovableHelperMethods to get access\n        // to this.state), which would also be nicer because we could\n        // normalizeOptions once in this.modify\n        const result = _.clone(options);\n        _.each(arrayOptionNames, function(eventName) {\n            const funcOrArray = options[eventName];\n            // Only propagate values which were set; not present values\n            // shouldn't be added to options because we'd like them to\n            // fall through to defaults\n            if (funcOrArray !== undefined) {\n                const funcArray = InteractiveUtil.arrayify(funcOrArray);\n                result[eventName] = funcArray;\n            }\n        });\n        return result;\n    },\n\n    /**\n     * Get the correct vendor-prefixed `transform`.\n     */\n    getPrefixedTransform: function() {\n        // Cache result to avoid re-computation\n        prefixedTransform = prefixedTransform || computePrefixedTransform();\n        return prefixedTransform;\n    },\n\n    /**\n     * Get whether the browser can use 3d transforms.\n     */\n    getCanUse3dTransform: function() {\n        if (canUse3dTransform == null) {\n            canUse3dTransform = computeCanUse3dTransform();\n        }\n        return canUse3dTransform;\n    },\n};\n\nexport const getCanUse3dTransform = InteractiveUtil.getCanUse3dTransform;\nexport default InteractiveUtil;\n","var _module_ = {\n exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Color constants we use throughout Perseus (originally on KhanUtil).\n *\n * Note that if the color palette changes substantially, it may also need to be\n * updated in khan-exercises and cherry-picked into graphie-to-png's\n * khan-exercises sub_module_, as graphie-to-png still relies on the palette\n * provided on KhanUtil.\n */\nconst KhanColors = {\n    BLUE: \"#6495ED\",\n    ORANGE: \"#FFA500\",\n    PINK: \"#FF00AF\",\n    GREEN: \"#28AE7B\",\n    PURPLE: \"#9D38BD\",\n    RED: \"#DF0030\",\n    GRAY: \"gray\",\n    BLACK: \"black\",\n    LIGHT_BLUE: \"#9AB8ED\",\n    LIGHT_ORANGE: \"#EDD19B\",\n    LIGHT_PINK: \"#ED9BD3\",\n    LIGHT_GREEN: \"#9BEDCE\",\n    LIGHT_PURPLE: \"#DA9BED\",\n    LIGHT_RED: \"#ED9AAC\",\n    LIGHT_GRAY: \"#ED9B9B\",\n    LIGHT_BLACK: \"#ED9B9B\",\n    GRAY10: \"#D6D6D6\",\n    GRAY20: \"#CDCDCD\",\n    GRAY30: \"#B3B3B3\",\n    GRAY40: \"#9A9A9A\",\n    GRAY50: \"#808080\",\n    GRAY60: \"#666666\",\n    GRAY70: \"#4D4D4D\",\n    GRAY80: \"#333333\",\n    GRAY90: \"#1A1A1A\",\n    BLUE_A: \"#CCFAFF\",\n    BLUE_B: \"#80F6FF\",\n    BLUE_C: \"#63D9EA\",\n    BLUE_D: \"#11ACCD\",\n    BLUE_E: \"#0C7F99\",\n    TEAL_A: \"#94FFF5\",\n    TEAL_B: \"#26EDD5\",\n    TEAL_C: \"#01D1C1\",\n    TEAL_D: \"#01A995\",\n    TEAL_E: \"#208170\",\n    GREEN_A: \"#B6FFB0\",\n    GREEN_B: \"#8AF281\",\n    GREEN_C: \"#74CF70\",\n    GREEN_D: \"#1FAB54\",\n    GREEN_E: \"#0D923F\",\n    GOLD_A: \"#FFD0A9\",\n    GOLD_B: \"#FFBB71\",\n    GOLD_C: \"#FF9C39\",\n    GOLD_D: \"#E07D10\",\n    GOLD_E: \"#A75A05\",\n    RED_A: \"#FCA9A9\",\n    RED_B: \"#FF8482\",\n    RED_C: \"#F9685D\",\n    RED_D: \"#E84D39\",\n    RED_E: \"#BC2612\",\n    MAROON_A: \"#FFBDE0\",\n    MAROON_B: \"#FF92C6\",\n    MAROON_C: \"#ED5FA6\",\n    MAROON_D: \"#CA337C\",\n    MAROON_E: \"#9E034E\",\n    PURPLE_A: \"#DDD7FF\",\n    PURPLE_B: \"#C6B9FC\",\n    PURPLE_C: \"#AA87FF\",\n    PURPLE_D: \"#7854AB\",\n    PURPLE_E: \"#543B78\",\n    MINT_A: \"#F5F9E8\",\n    MINT_B: \"#EDF2DF\",\n    MINT_C: \"#E0E5CC\",\n    GRAY_A: \"#F6F7F7\",\n    GRAY_B: \"#F0F1F2\",\n    GRAY_C: \"#E3E5E6\",\n    GRAY_D: \"#D6D8DA\",\n    GRAY_E: \"#BABEC2\",\n    GRAY_F: \"#888D93\",\n    GRAY_G: \"#626569\",\n    GRAY_H: \"#3B3E40\",\n    GRAY_I: \"#21242C\",\n    KA_BLUE: \"#314453\",\n    KA_GREEN: \"#71B307\",\n    // Don't actually use _BACKGROUND! Make things transparent instead. The\n    // background color used in exercises is subject to change at the whim\n    // of any redesigns.\n    _BACKGROUND: \"#FDFDFD\", // TODO(eater): Get rid of this altogether.\n};\n\nKhanColors.INTERACTING = KhanColors.KA_GREEN;\nKhanColors.INTERACTIVE = KhanColors.KA_GREEN;\nKhanColors.DYNAMIC = KhanColors.BLUE;\n\n_module_.exports = KhanColors;\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _objective_Js from \"./objective_.js\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _underscore from \"underscore\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Default methods for a wrapped movable.\n */\n\nconst _ = _underscore;\nconst InteractiveUtil = _interactiveUtilJs;\nconst objective_ = _objective_Js;\nconst kvector = _kmath.vector;\n\n/*\n * These functions, when called on the wrapped object, simply pass the\n * arguments to the underlying Raphael object.\n */\nconst PASS_TO_RAPHAEL = [\n    \"attr\",\n    \"animate\",\n];\n\nconst WrappedDefaults = _.extend({\n    transform: function(transformation) {\n        const prefixedTransform = InteractiveUtil.getPrefixedTransform();\n        this.wrapper.style[prefixedTransform] = transformation;\n    },\n\n    toFront: function() {\n        const parentNode = this.wrapper.parentNode;\n        // TODO(emily): Sometimes, we call `.remove()` but then hold a\n        // reference to this object, and sometimes call `.toFront` on it.\n        // Notably, this happens in the reflection transformation in the\n        // Transformer widget. This is a hacky fix. Make this less bad.\n        if (parentNode) {\n            parentNode.appendChild(this.wrapper);\n        }\n    },\n\n    toBack: function() {\n        const parentNode = this.wrapper.parentNode;\n        if (parentNode.firstChild !== this.wrapper) {\n            parentNode.insertBefore(\n                this.wrapper,\n                parentNode.firstChild\n            );\n        }\n    },\n\n    remove: function() {\n        this.visibleShape.remove();\n        $(this.wrapper).remove();\n    },\n\n    getMouseTarget: function() {\n        return this.visibleShape[0];\n    },\n\n    moveTo: function(point) {\n        const delta = kvector.subtract(\n            this.graphie.scalePoint(point),\n            this.graphie.scalePoint(this.initialPoint)\n        );\n        const do3dTransform = InteractiveUtil.getCanUse3dTransform();\n        const transformation = \"translateX(\" + delta[0] + \"px) \" +\n                             \"translateY(\" + delta[1] + \"px)\" +\n                             (do3dTransform ? \" translateZ(0)\" : \"\");\n        this.transform(transformation);\n    },\n\n    hide: function() {\n        this.visibleShape.hide();\n    },\n\n    show: function() {\n        this.visibleShape.show();\n    },\n}, objective_.mapObjectFromArray(PASS_TO_RAPHAEL, function(attribute) {\n    return function() {\n        this.visibleShape[attribute](...arguments);\n    };\n}));\n\n_module_.exports = WrappedDefaults;\nexport default _module_.exports;\n","import _wrappedDefaultsJs from \"./wrapped-defaults.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst WrappedDefaults = _wrappedDefaultsJs;\n\nconst DEFAULT_OPTIONS = {\n    center: null, // gets ignored in `graphie.fixedPath` if `null`\n    createPath: null, // gets defaulted in `graphie.fixedPath` if `null`\n    mouselayer: false,\n};\n\nconst WrappedPath = function(graphie, points, options) {\n    options = _.extend({}, DEFAULT_OPTIONS, options);\n\n    // Add `wrapper` and `visibleShape`\n    _.extend(this, graphie.fixedPath(points, options.center,\n        options.createPath));\n\n    // Add remaining properties\n    _.extend(this, {\n        graphie: graphie,\n        initialPoint: graphie.scalePoint(_.head(points)),\n    });\n\n    // Add to appropriate graphie layer\n    if (options.mouselayer) {\n        // Disable browser handling of all panning and zooming gestures on the\n        // movable wrapper so that when moved the browser does not scroll page\n        this.wrapper.style.touchAction = \"none\";\n\n        this.graphie.addToMouseLayerWrapper(this.wrapper);\n    } else {\n        this.graphie.addToVisibleLayerWrapper(this.wrapper);\n    }\n};\n\n_.extend(WrappedPath.prototype, WrappedDefaults);\n\n_module_.exports = WrappedPath;\nexport default _module_.exports;\n","import _utilMathJs from \"../util/math.js\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _wrappedDefaultsJs from \"./wrapped-defaults.js\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst InteractiveUtil = _interactiveUtilJs;\nconst WrappedDefaults = _wrappedDefaultsJs;\nconst kpoint = _kmath.point;\nconst kvector = _kmath2.vector;\nconst KhanMath = _utilMathJs;\n\nconst DEFAULT_OPTIONS = {\n    thickness: 2,\n    mouselayer: false,\n};\n\nconst WrappedLine = function(graphie, start, end, options) {\n    options = _.extend({}, DEFAULT_OPTIONS, options);\n\n    // Always make the line as large as possible and horizontal; this\n    // simplifies a lot of the transforms, e.g., we can rotate by exactly the\n    // angle of the argument points in `moveTo`.\n    const initialStart = [graphie.range[0][0], 0];\n    const initialEnd = [graphie.range[0][1], 0];\n\n    // Add `wrapper` and `visibleShape`\n    _.extend(this,\n        graphie.fixedLine(initialStart, initialEnd, options.thickness));\n\n    this.visibleShape.attr(options.normalStyle);\n\n    // Save properties for computing transformations\n    _.extend(this, {\n        graphie: graphie,\n        initialPoint: graphie.scalePoint(initialStart),\n        initialLength: kpoint.distanceToPoint(\n            graphie.scalePoint(initialStart),\n            graphie.scalePoint(initialEnd)\n        ),\n    });\n\n    // Add to appropriate graphie layer\n    if (options.mouselayer) {\n        // Disable browser handling of all panning and zooming gestures on the\n        // movable wrapper so that when moved the browser does not scroll page\n        this.wrapper.style.touchAction = \"none\";\n\n        this.graphie.addToMouseLayerWrapper(this.wrapper);\n    } else {\n        this.graphie.addToVisibleLayerWrapper(this.wrapper);\n    }\n\n    // Move to argument points\n    this.moveTo(start, end);\n};\n\n_.extend(WrappedLine.prototype, WrappedDefaults, {\n    getMouseTarget: function() {\n        return this.wrapper;\n    },\n\n    moveTo: function(start, end) {\n        const scaledStart = this.graphie.scalePoint(start);\n        const scaledEnd = this.graphie.scalePoint(end);\n\n        // Compute transformation parameters\n        const polarDiff = kvector.polarDegFromCart(\n            kvector.subtract(\n                scaledEnd,\n                scaledStart\n            )\n        );\n        const lineLength = polarDiff[0];\n        const angle = KhanMath.bound(polarDiff[1]);\n        const delta = kvector.subtract(scaledStart, this.initialPoint);\n        const scale = KhanMath.bound(lineLength / this.initialLength);\n\n        // Construct and apply transformation string\n        const do3dTransform = InteractiveUtil.getCanUse3dTransform();\n        const transformation = \"translateX(\" + delta[0] + \"px) \" +\n                             \"translateY(\" + delta[1] + \"px) \" +\n                             (do3dTransform ? \" translateZ(0)\" : \"\") +\n                             \"rotate(\" + angle + \"deg) \" +\n                             \"scaleX(\" + scale + \") scaleY(1)\";\n        this.transform(transformation);\n    },\n});\n\n_module_.exports = WrappedLine;\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _wrappedDefaultsJs from \"./wrapped-defaults.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst WrappedDefaults = _wrappedDefaultsJs;\nconst InteractiveUtil = _interactiveUtilJs;\nconst kvector = _kmath.vector;\n\nconst DEFAULT_OPTIONS = {\n    maxScale: 1,\n    mouselayer: false,\n    shadow: false,\n    disableMouseEventsOnWrapper: false,\n};\n\nconst WrappedEllipse = function(graphie, center, radii, options) {\n    options = _.extend({}, DEFAULT_OPTIONS, options);\n\n    // Add `wrapper`, `visibleShape`, and remaining properties.\n    const fixedEllipse = graphie.fixedEllipse(\n        center, radii, options.maxScale, options.padding);\n    _.extend(this, fixedEllipse, {\n        graphie: graphie,\n        initialPoint: center,\n    });\n\n    // Add to appropriate graphie layer\n    if (options.mouselayer) {\n        // Disable browser handling of all panning and zooming gestures on the\n        // movable wrapper so that when moved the browser does not scroll page\n        this.wrapper.style.touchAction = \"none\";\n\n        this.graphie.addToMouseLayerWrapper(this.wrapper);\n    } else {\n        this.graphie.addToVisibleLayerWrapper(this.wrapper);\n    }\n\n    if (options.shadow) {\n        const filter = \"drop-shadow(0px 0px 5px rgba(0, 0, 0, 0.5))\";\n        const wrapper = this.wrapper;\n        wrapper.style.webkitFilter = filter;\n        wrapper.style.filter = filter;\n\n        this.moveTo = function(point) {\n            const delta = kvector.subtract(\n                this.graphie.scalePoint(point),\n                this.graphie.scalePoint(this.initialPoint)\n            );\n            const do3dTransform = InteractiveUtil.getCanUse3dTransform();\n            const transform = \"translateX(\" + Math.round(delta[0]) + \"px) \" +\n                              \"translateY(\" + Math.round(delta[1]) + \"px)\" +\n                              (do3dTransform ? \" translateZ(0)\" : \"\");\n            this.transform(transform);\n        };\n    }\n\n    if (options.disableMouseEventsOnWrapper) {\n        this.wrapper.style.pointerEvents = \"none\";\n        this.visibleShape.node.style.pointerEvents = \"auto\";\n    }\n};\n\n_.extend(WrappedEllipse.prototype,  WrappedDefaults);\n\n_module_.exports = WrappedEllipse;\nexport default _module_.exports;\n","import _mathJs from \"./math.js\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* globals katex:false, MathJax:false, Exercises:false */\n\nconst KhanMath = _mathJs;\n\nfunction findChildOrAdd(elem, className) {\n    const $child = $(elem).find(\".\" + className);\n    if ($child.length === 0) {\n        return $(\"<span>\").addClass(className).appendTo($(elem));\n    } else {\n        return $child;\n    }\n}\n\nfunction doCallback(elem, callback) {\n    let tries = 0;\n    (function check() {\n        const height = elem.scrollHeight;\n        // Heuristic to guess if the font has kicked in\n        // so we have box metrics (magic number ick,\n        // but this seems to work mostly-consistently)\n        if (height > 18 || tries >= 10) {\n            callback();\n        } else {\n            tries++;\n            setTimeout(check, 100);\n        }\n    })();\n}\n\n_module_.exports = {\n    // Process a node and add math inside of it. This attempts to use KaTeX to\n    // format the math, and if that fails it falls back to MathJax.\n    //\n    // elem: The element which the math should be added to.\n    //\n    // text: The text that should be formatted inside of the node. If the node\n    //       has already had math formatted inside of it before, this doesn't\n    //       have to be provided. If this is not provided, and the node hasn't\n    //       been formatted before, the text content of the node is used.\n    //\n    // force: (optional) if the node has been processed before, then it will\n    //        not be formatted again, unless this argument is true\n    //\n    // callback: (optional) a callback to be run after the math has been\n    //           processed (note: this might be called synchronously or\n    //           asynchronously, depending on whether KaTeX or MathJax is used)\n    processMath: function(elem, text, force, callback) {\n        const $elem = $(elem);\n\n        // Only process if it hasn't been done before, or it is forced\n        if ($elem.attr(\"data-math-formula\") == null || force) {\n            const $katexHolder = findChildOrAdd($elem, \"katex-holder\");\n            const $mathjaxHolder = findChildOrAdd($elem, \"mathjax-holder\");\n\n            // Search for MathJax-y script tags inside of the node. These are\n            // used by MathJax to denote the formula to be typeset. Before, we\n            // would update the formula by updating the contents of the script\n            // tag, which shouldn't happen any more, but we manage them just in\n            // case.\n            const script = $mathjaxHolder.find(\"script[type='math/tex']\")[0];\n\n            // If text wasn't provided, we look in two places\n            if (text == null) {\n                if ($elem.attr(\"data-math-formula\")) {\n                    // The old typeset formula\n                    text = $elem.attr(\"data-math-formula\");\n                } else if (script) {\n                    // The contents of the <script> tag\n                    text = script.text || script.textContent;\n                }\n            }\n\n            text = text != null ? text + \"\" : \"\";\n\n            // Attempt to clean up some of the math\n            text = KhanMath.cleanMath(text);\n\n            // Store the formula that we're using\n            $elem.attr(\"data-math-formula\", text);\n\n            if (Exercises.useKatex) {\n                // Try to process the nodes with KaTeX first\n                try {\n                    katex.render(text, $katexHolder[0]);\n                    // If that worked, and we previously formatted with\n                    // mathjax, do some mathjax cleanup\n                    if ($elem.attr(\"data-math-type\") === \"mathjax\") {\n                        // Remove the old mathjax stuff\n                        const jax = MathJax.Hub.getJaxFor(script);\n                        if (jax) {\n                            const e = jax.SourceElement();\n                            if (\n                                e.previousSibling &&\n                                e.previousSibling.className\n                            ) {\n                                jax.Remove();\n                            }\n                        }\n                    }\n                    $elem.attr(\"data-math-type\", \"katex\");\n                    // Call the callback\n                    if (callback) {\n                        doCallback(elem, callback);\n                    }\n                    return;\n                } catch (err) {\n                    // IE doesn't do instanceof correctly, so we resort to\n                    // manual checking\n                    /* jshint -W103 */\n                    if (err.__proto__ !== katex.ParseError.prototype) {\n                        throw err;\n                    }\n                    /* jshint +W103 */\n                }\n            }\n\n            // Otherwise, fallback to MathJax\n\n            // (Note: we don't need to do any katex cleanup here, because\n            // KaTeX is smart and cleans itself up)\n            $elem.attr(\"data-math-type\", \"mathjax\");\n            // Update the script tag, or add one if necessary\n            if (!script) {\n                $mathjaxHolder.append(\n                    \"<script type='math/tex'>\" +\n                        text.replace(/<\\//g, \"< /\") +\n                        \"</script>\"\n                );\n            } else {\n                if (\"text\" in script) {\n                    // IE8, etc\n                    script.text = text;\n                } else {\n                    script.textContent = text;\n                }\n            }\n            if (typeof MathJax !== \"undefined\") {\n                // Put the process, a debug log, and the callback into the\n                // MathJax queue\n                MathJax.Hub.Queue([\n                    \"Reprocess\",\n                    MathJax.Hub,\n                    $mathjaxHolder[0],\n                ]);\n                MathJax.Hub.Queue(function() {\n                    KhanUtil.debugLog(\n                        \"MathJax done typesetting (\" + text + \")\"\n                    );\n                });\n                if (callback) {\n                    MathJax.Hub.Queue(function() {\n                        const cb = MathJax.Callback(function() {});\n                        doCallback(elem, function() {\n                            callback();\n                            cb();\n                        });\n                        return cb;\n                    });\n                }\n            }\n        }\n    },\n\n    processAllMath: function(elem, force) {\n        const $elem = $(elem);\n        $elem.filter(\"code\").add($elem.find(\"code\")).each(function() {\n            const $this = $(this);\n            let text = $this.attr(\"data-math-formula\");\n            if (text == null) {\n                text = $this.text();\n                $this.empty();\n            }\n            KhanUtil.processMath(this, text, force);\n        });\n    },\n\n    // Function to restore a node to a non-math-processed state\n    cleanupMath: function(elem) {\n        const $elem = $(elem);\n\n        // Only mess with it if it's been processed before\n        if ($elem.attr(\"data-math-formula\")) {\n            // Remove MathJax remnants\n            if (typeof MathJax !== \"undefined\") {\n                const jax = MathJax.Hub.getJaxFor($elem.find(\"script\")[0]);\n                if (jax) {\n                    const e = jax.SourceElement();\n                    if (e.previousSibling && e.previousSibling.className) {\n                        jax.Remove();\n                    }\n                }\n            }\n\n            $elem.text($elem.attr(\"data-math-formula\"));\n            $elem.attr(\"data-math-formula\", null);\n            $elem.attr(\"data-math-type\", null);\n        }\n\n        return elem;\n    },\n\n    // Function to retrieve the formula of a typeset math node\n    retrieveMathFormula: function(elem) {\n        return $(elem).attr(\"data-math-formula\");\n    },\n};\nexport default _module_.exports;\n","import _colors from \"./colors\";\nimport _texJs from \"./tex.js\";\nimport _mathJs from \"./math.js\";\nimport \"../lib/raphael.js\"; // global Raphael\nimport _underscore from \"underscore\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, max-lines, object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst kpoint = _kmath.point;\nconst kvector = _kmath2.vector;\nconst _ = _underscore;\n\n// Minify Raphael ourselves because IE8 has a problem with the 1.5.2 minified\n// release\n// http://groups.google.com/group/raphaeljs/browse_thread/thread/c34c75ad8d431544\n/* globals Raphael:false */\n\nconst KhanMath = _mathJs;\nconst processMath = _texJs.processMath;\nconst KhanColors = _colors;\n\n/* Convert cartesian coordinates [x, y] to polar coordinates [r,\n * theta], with theta in degrees, or in radians if angleInRadians is\n * specified.\n */\nfunction cartToPolar(coord, angleInRadians) {\n    const r = Math.sqrt(Math.pow(coord[0], 2) + Math.pow(coord[1], 2));\n    let theta = Math.atan2(coord[1], coord[0]);\n    // convert angle range from [-pi, pi] to [0, 2pi]\n    if (theta < 0) {\n        theta += 2 * Math.PI;\n    }\n    if (!angleInRadians) {\n        theta = theta * 180 / Math.PI;\n    }\n    return [r, theta];\n}\n\nfunction polar(r, th) {\n    if (typeof r === \"number\") {\n        r = [r, r];\n    }\n    th = th * Math.PI / 180;\n    return [r[0] * Math.cos(th), r[1] * Math.sin(th)];\n}\n\nconst GraphUtils = {\n    unscaledSvgPath: function(points) {\n        // If this is an empty closed path, return \"\" instead of \"z\", which\n        // would give an error\n        if (points[0] === true) {\n            return \"\";\n        }\n        return $.map(points, function(point, i) {\n            if (point === true) {\n                return \"z\";\n            }\n            return (i === 0 ? \"M\" : \"L\") + point[0] + \" \" + point[1];\n        }).join(\"\");\n    },\n\n    getDistance: function(point1, point2) {\n        return kpoint.distanceToPoint(point1, point2);\n    },\n\n    /**\n    * Return the difference between two sets of coordinates\n    */\n    coordDiff: function(startCoord, endCoord) {\n        return _.map(endCoord, function(val, i) {\n            return endCoord[i] - startCoord[i];\n        });\n    },\n\n    /**\n    * Round the given coordinates to a given snap value\n    * (e.g., nearest 0.2 increment)\n    */\n    snapCoord: function(coord, snap) {\n        return _.map(coord, function(val, i) {\n            return KhanMath.roundToNearest(snap[i], val);\n        });\n    },\n\n    // Find the angle in degrees between two or three points\n    findAngle: function(point1, point2, vertex) {\n        if (vertex === undefined) {\n            const x = point1[0] - point2[0];\n            const y = point1[1] - point2[1];\n            if (!x && !y) {\n                return 0;\n            }\n            return (180 + Math.atan2(-y, -x) * 180 / Math.PI + 360) % 360;\n        } else {\n            return (\n                GraphUtils.findAngle(point1, vertex) -\n                GraphUtils.findAngle(point2, vertex)\n            );\n        }\n    },\n\n    graphs: {},\n};\n\nconst Graphie = (GraphUtils.Graphie = function() {});\n\n_.extend(Graphie.prototype, {\n    cartToPolar: cartToPolar,\n    polar: polar,\n});\n\nconst labelDirections = {\n    center: [-0.5, -0.5],\n    above: [-0.5, -1.0],\n    \"above right\": [0.0, -1.0],\n    right: [0.0, -0.5],\n    \"below right\": [0.0, 0.0],\n    below: [-0.5, 0.0],\n    \"below left\": [-1.0, 0.0],\n    left: [-1.0, -0.5],\n    \"above left\": [-1.0, -1.0],\n};\n\n/**\n * Safari applies some SVG-specific styles to things that are not SVGs, so we\n * need to exclude those styles from things that are not SVGs.\n *\n * To see this behavior in action, open https://codepen.io/anon/pen/zENEoa in\n * Safari.\n *\n * Usage `$.extend({}, someStyles, SVG_SPECIFIC_STYLE_MASK)`\n */\nconst SVG_SPECIFIC_STYLE_MASK = {\n    \"stroke-width\": null,\n};\n\nGraphUtils.createGraphie = function(el) {\n    let xScale = 40;\n    let yScale = 40;\n    let xRange;\n    let yRange;\n\n    $(el).css(\"position\", \"relative\");\n    const raphael = Raphael(el);\n\n    // For a sometimes-reproducible IE8 bug; doesn't affect SVG browsers at all\n    $(el).children(\"div\").css(\"position\", \"absolute\");\n\n    // Set up some reasonable defaults\n    let currentStyle = {\n        \"stroke-width\": 2,\n        fill: \"none\",\n    };\n\n    const scaleVector = function(point) {\n        if (typeof point === \"number\") {\n            return scaleVector([point, point]);\n        }\n\n        const x = point[0];\n        const y = point[1];\n        return [x * xScale, y * yScale];\n    };\n\n    const scalePoint = function scalePoint(point) {\n        if (typeof point === \"number\") {\n            return scalePoint([point, point]);\n        }\n\n        const x = point[0];\n        const y = point[1];\n        return [(x - xRange[0]) * xScale, (yRange[1] - y) * yScale];\n    };\n\n    const unscalePoint = function(point) {\n        if (typeof point === \"number\") {\n            return unscalePoint([point, point]);\n        }\n\n        const x = point[0];\n        const y = point[1];\n        return [x / xScale + xRange[0], yRange[1] - y / yScale];\n    };\n\n    const unscaleVector = function(point) {\n        if (typeof point === \"number\") {\n            return unscaleVector([point, point]);\n        }\n\n        return [point[0] / xScale, point[1] / yScale];\n    };\n\n    const setLabelMargins = function(span, size) {\n        const $span = $(span);\n        const direction = $span.data(\"labelDirection\");\n        $span.css(\"visibility\", \"\");\n\n        if (typeof direction === \"number\") {\n            const x = Math.cos(direction);\n            const y = Math.sin(direction);\n\n            const scale = Math.min(\n                size[0] / 2 / Math.abs(x),\n                size[1] / 2 / Math.abs(y)\n            );\n\n            $span.css({\n                marginLeft: -size[0] / 2 + x * scale,\n                marginTop: -size[1] / 2 - y * scale,\n            });\n        } else {\n            const multipliers = labelDirections[direction || \"center\"];\n            $span.css({\n                marginLeft: Math.round(size[0] * multipliers[0]),\n                marginTop: Math.round(size[1] * multipliers[1]),\n            });\n        }\n    };\n\n    const svgPath = function(points, alreadyScaled) {\n        return $.map(points, function(point, i) {\n            if (point === true) {\n                return \"z\";\n            } else {\n                const scaled = alreadyScaled ? point : scalePoint(point);\n                return (\n                    (i === 0 ? \"M\" : \"L\") +\n                    KhanMath.bound(scaled[0]) +\n                    \" \" +\n                    KhanMath.bound(scaled[1])\n                );\n            }\n        }).join(\"\");\n    };\n\n    const svgParabolaPath = function(a, b, c) {\n        const computeParabola = function(x) {\n            return (a * x + b) * x + c;\n        };\n\n        // If points are collinear, plot a line instead\n        if (a === 0) {\n            const points = _.map(xRange, function(x) {\n                return [x, computeParabola(x)];\n            });\n            return svgPath(points);\n        }\n\n        // Calculate x coordinates of points on parabola\n        const xVertex = -b / (2 * a);\n        const distToEdge = Math.max(\n            Math.abs(xVertex - xRange[0]),\n            Math.abs(xVertex - xRange[1])\n        );\n\n        // To guarantee that drawn parabola to spans the viewport, use a point\n        // on the edge of the graph furtherest from the vertex\n        const xPoint = xVertex + distToEdge;\n\n        // Compute parabola and other point on the curve\n        const vertex = [xVertex, computeParabola(xVertex)];\n        const point = [xPoint, computeParabola(xPoint)];\n\n        // Calculate SVG 'control' point, defined by spec\n        const control = [vertex[0], vertex[1] - (point[1] - vertex[1])];\n\n        // Calculate mirror points across parabola's axis of symmetry\n        const dx = Math.abs(vertex[0] - point[0]);\n        const left = [vertex[0] - dx, point[1]];\n        const right = [vertex[0] + dx, point[1]];\n\n        // Scale and bound\n        const points = _.map([left, control, right], scalePoint);\n        const values = _.map(_.flatten(points), KhanMath.bound);\n        return (\n            \"M\" +\n            values[0] +\n            \",\" +\n            values[1] +\n            \" Q\" +\n            values[2] +\n            \",\" +\n            values[3] +\n            \" \" +\n            values[4] +\n            \",\" +\n            values[5]\n        );\n    };\n\n    const svgSinusoidPath = function(a, b, c, d) {\n        // Plot a sinusoid of the form: f(x) = a * sin(b * x - c) + d\n        const quarterPeriod = Math.abs(Math.PI / (2 * b));\n\n        const computeSine = function(x) {\n            return a * Math.sin(b * x - c) + d;\n        };\n\n        const computeDerivative = function(x) {\n            return a * b * Math.cos(c - b * x);\n        };\n\n        const coordsForOffset = function(initial, i) {\n            // Return the cubic coordinates (including the two anchor and two\n            // control points) for the ith portion of the sinusoid.\n            const x0 = initial + quarterPeriod * i;\n            const x1 = x0 + quarterPeriod;\n\n            // Interpolate using derivative technique\n            // See: http://stackoverflow.com/questions/13932704/how-to-draw-sine-waves-with-svg-js\n            const xCoords = [\n                x0,\n                x0 * 2 / 3 + x1 * 1 / 3,\n                x0 * 1 / 3 + x1 * 2 / 3,\n                x1,\n            ];\n            const yCoords = [\n                computeSine(x0),\n                computeSine(x0) + computeDerivative(x0) * (x1 - x0) / 3,\n                computeSine(x1) - computeDerivative(x1) * (x1 - x0) / 3,\n                computeSine(x1),\n            ];\n\n            // Zip and scale\n            return _.map(_.zip(xCoords, yCoords), scalePoint);\n        };\n\n        // How many quarter-periods do we need to span the graph?\n        const extent = xRange[1] - xRange[0];\n        const numQuarterPeriods = Math.ceil(extent / quarterPeriod) + 1;\n\n        // Find starting coordinate: first anchor point curve left of xRange[0]\n        let initial = c / b;\n        const distToEdge = initial - xRange[0];\n        initial -= quarterPeriod * Math.ceil(distToEdge / quarterPeriod);\n\n        // First portion of path is special-case, requiring move-to ('M')\n        let coords = coordsForOffset(initial, 0);\n        let path =\n            \"M\" +\n            coords[0][0] +\n            \",\" +\n            coords[0][1] +\n            \" C\" +\n            coords[1][0] +\n            \",\" +\n            coords[1][1] +\n            \" \" +\n            coords[2][0] +\n            \",\" +\n            coords[2][1] +\n            \" \" +\n            coords[3][0] +\n            \",\" +\n            coords[3][1];\n        for (let i = 1; i < numQuarterPeriods; i++) {\n            coords = coordsForOffset(initial, i);\n            path +=\n                \" C\" +\n                coords[1][0] +\n                \",\" +\n                coords[1][1] +\n                \" \" +\n                coords[2][0] +\n                \",\" +\n                coords[2][1] +\n                \" \" +\n                coords[3][0] +\n                \",\" +\n                coords[3][1];\n        }\n\n        return path;\n    };\n\n    // `svgPath` is independent of graphie range, so we export it independently\n    GraphUtils.svgPath = svgPath;\n\n    const processAttributes = function(attrs) {\n        const transformers = {\n            scale: function(scale) {\n                if (typeof scale === \"number\") {\n                    scale = [scale, scale];\n                }\n\n                xScale = scale[0];\n                yScale = scale[1];\n\n                // Update the canvas size\n                raphael.setSize(\n                    (xRange[1] - xRange[0]) * xScale,\n                    (yRange[1] - yRange[0]) * yScale\n                );\n            },\n\n            clipRect: function(pair) {\n                const point = pair[0];\n                const size = pair[1];\n                point[1] += size[1]; // because our coordinates are flipped\n\n                return {\n                    \"clip-rect\": scalePoint(point)\n                        .concat(scaleVector(size))\n                        .join(\" \"),\n                };\n            },\n\n            strokeWidth: function(val) {\n                return {\"stroke-width\": parseFloat(val)};\n            },\n\n            rx: function(val) {\n                return {rx: scaleVector([val, 0])[0]};\n            },\n\n            ry: function(val) {\n                return {ry: scaleVector([0, val])[1]};\n            },\n\n            r: function(val) {\n                const scaled = scaleVector([val, val]);\n                return {rx: scaled[0], ry: scaled[1]};\n            },\n        };\n\n        const processed = {};\n        $.each(attrs || {}, function(key, value) {\n            const transformer = transformers[key];\n\n            if (typeof transformer === \"function\") {\n                $.extend(processed, transformer(value));\n            } else {\n                const dasherized = key\n                    .replace(/([A-Z]+)([A-Z][a-z])/g, \"$1-$2\")\n                    .replace(/([a-z\\d])([A-Z])/g, \"$1-$2\")\n                    .toLowerCase();\n                processed[dasherized] = value;\n            }\n        });\n\n        return processed;\n    };\n\n    const addArrowheads = function arrows(path) {\n        const type = path.constructor.prototype;\n\n        if (type === Raphael.el) {\n            if (\n                path.type === \"path\" &&\n                typeof path.arrowheadsDrawn === \"undefined\"\n            ) {\n                const w = path.attr(\"stroke-width\");\n                const s = 0.6 + 0.4 * w;\n                const l = path.getTotalLength();\n                const set = raphael.set();\n                const head = raphael.path(\n                    graphie.isMobile\n                        ? \"M-4,4 C-4,4 -0.25,0 -0.25,0 C-0.25,0 -4,-4 -4,-4\"\n                        : \"M-3 4 C-2.75 2.5 0 0.25 0.75 0C0 -0.25 -2.75 -2.5 -3 -4\" // eslint-disable-line max-len\n                );\n                const end = path.getPointAtLength(l - 0.4);\n                const almostTheEnd = path.getPointAtLength(l - 0.75 * s);\n                const angle =\n                    Math.atan2(end.y - almostTheEnd.y, end.x - almostTheEnd.x) *\n                    180 /\n                    Math.PI;\n                const attrs = path.attr();\n                delete attrs.path;\n\n                let subpath = path.getSubpath(0, l - 0.75 * s);\n                subpath = raphael.path(subpath).attr(attrs);\n                subpath.arrowheadsDrawn = true;\n                path.remove();\n\n                // For some unknown reason 0 doesn't work for the rotation\n                // origin so we use a tiny number.\n                head\n                    .rotate(angle, graphie.isMobile ? 1e-5 : 0.75, 0)\n                    .scale(s, s, 0.75, 0)\n                    .translate(almostTheEnd.x, almostTheEnd.y)\n                    .attr(attrs)\n                    .attr({\n                        \"stroke-linejoin\": \"round\",\n                        \"stroke-linecap\": \"round\",\n                    });\n\n                head.arrowheadsDrawn = true;\n                set.push(subpath);\n                set.push(head);\n                return set;\n            }\n        } else if (type === Raphael.st) {\n            for (let i = 0, l = path.items.length; i < l; i++) {\n                arrows(path.items[i]);\n            }\n        }\n        return path;\n    };\n\n    const drawingTools = {\n        circle: function(center, radius) {\n            return raphael.ellipse(\n                ...scalePoint(center).concat(scaleVector([radius, radius]))\n            );\n        },\n\n        // (x, y) is coordinate of bottom left corner\n        rect: function(x, y, width, height) {\n            // Raphael needs (x, y) to be coordinate of upper left corner\n            const corner = scalePoint([x, y + height]);\n            const dims = scaleVector([width, height]);\n            const elem = raphael.rect(...corner.concat(dims));\n\n            if (graphie.isMobile) {\n                elem.node.style.shapeRendering = \"crispEdges\";\n            }\n\n            return elem;\n        },\n\n        ellipse: function(center, radii) {\n            return raphael.ellipse(\n                ...scalePoint(center).concat(scaleVector(radii))\n            );\n        },\n\n        fixedEllipse: function(center, radii, maxScale, padding) {\n            // Scale point and radius\n            const scaledPoint = scalePoint(center);\n            const scaledRadii = scaleVector(radii);\n\n            const width = 2 * scaledRadii[0] * maxScale + padding;\n            const height = 2 * scaledRadii[1] * maxScale + padding;\n\n            // Calculate absolute left, top\n            const left = scaledPoint[0] - width / 2;\n            const top = scaledPoint[1] - height / 2;\n\n            // Wrap in <div>\n            const wrapper = document.createElement(\"div\");\n            $(wrapper).css({\n                position: \"absolute\",\n                width: width + \"px\",\n                height: height + \"px\",\n                left: left + \"px\",\n                top: top + \"px\",\n            });\n\n            // Create Raphael canvas\n            const localRaphael = Raphael(wrapper, width, height);\n            const visibleShape = localRaphael.ellipse(\n                width / 2,\n                height / 2,\n                scaledRadii[0],\n                scaledRadii[1]\n            );\n\n            return {\n                wrapper: wrapper,\n                visibleShape: visibleShape,\n            };\n        },\n\n        arc: function(center, radius, startAngle, endAngle, sector) {\n            startAngle = (startAngle % 360 + 360) % 360;\n            endAngle = (endAngle % 360 + 360) % 360;\n\n            const cent = scalePoint(center);\n            const radii = scaleVector(radius);\n            const startVector = polar(radius, startAngle);\n            const endVector = polar(radius, endAngle);\n\n            const startPoint = scalePoint([\n                center[0] + startVector[0],\n                center[1] + startVector[1],\n            ]);\n            const endPoint = scalePoint([\n                center[0] + endVector[0],\n                center[1] + endVector[1],\n            ]);\n\n            const largeAngle =\n                ((endAngle - startAngle) % 360 + 360) % 360 > 180;\n\n            return raphael.path(\n                \"M\" +\n                startPoint.join(\" \") +\n                \"A\" +\n                radii.join(\" \") +\n                \" 0 \" + // ellipse rotation\n                (largeAngle ? 1 : 0) +\n                \" 0 \" + // sweep flag\n                    endPoint.join(\" \") +\n                    (sector ? \"L\" + cent.join(\" \") + \"z\" : \"\")\n            );\n        },\n\n        path: function(points) {\n            const p = raphael.path(svgPath(points));\n            p.graphiePath = points;\n\n            return p;\n        },\n\n        fixedPath: function(points, center, createPath) {\n            points = _.map(points, scalePoint);\n            center = center ? scalePoint(center) : null;\n            createPath = createPath || svgPath;\n\n            const pathLeft = _.min(_.pluck(points, 0));\n            const pathRight = _.max(_.pluck(points, 0));\n            const pathTop = _.min(_.pluck(points, 1));\n            const pathBottom = _.max(_.pluck(points, 1));\n\n            // Apply padding to line\n            const padding = [4, 4];\n\n            // Calculate and apply additional offset\n            const extraOffset = [pathLeft, pathTop];\n\n            // Apply padding and offset to points\n            points = _.map(points, function(point) {\n                return kvector.add(\n                    kvector.subtract(point, extraOffset),\n                    kvector.scale(padding, 0.5)\n                );\n            });\n\n            // Calculate <div> dimensions\n            const width = pathRight - pathLeft + padding[0];\n            const height = pathBottom - pathTop + padding[1];\n            const left = extraOffset[0] - padding[0] / 2;\n            const top = extraOffset[1] - padding[1] / 2;\n\n            // Create <div>\n            const wrapper = document.createElement(\"div\");\n            $(wrapper).css({\n                position: \"absolute\",\n                width: width + \"px\",\n                height: height + \"px\",\n                left: left + \"px\",\n                top: top + \"px\",\n                // If user specified a center, set it\n                transformOrigin: center\n                    ? width / 2 +\n                      center[0] +\n                      \"px \" +\n                      (height / 2 + center[1]) +\n                      \"px\"\n                    : null,\n            });\n\n            // Create Raphael canvas\n            const localRaphael = Raphael(wrapper, width, height);\n\n            // Calculate path\n            const visibleShape = localRaphael.path(createPath(points));\n\n            return {\n                wrapper: wrapper,\n                visibleShape: visibleShape,\n            };\n        },\n\n        scaledPath: function(points) {\n            const p = raphael.path(svgPath(points, /* alreadyScaled */ true));\n            p.graphiePath = points;\n            return p;\n        },\n\n        line: function(start, end) {\n            const l = this.path([start, end]);\n\n            if (graphie.isMobile) {\n                l.node.style.shapeRendering = \"crispEdges\";\n            }\n\n            return l;\n        },\n\n        parabola: function(a, b, c) {\n            // Plot a parabola of the form: f(x) = (a * x + b) * x + c\n            return raphael.path(svgParabolaPath(a, b, c));\n        },\n\n        fixedLine: function(start, end, thickness) {\n            // Apply padding to line\n            const padding = [thickness, thickness];\n\n            // Scale points to get values in pixels\n            start = scalePoint(start);\n            end = scalePoint(end);\n\n            // Calculate and apply additional offset\n            const extraOffset = [\n                Math.min(start[0], end[0]),\n                Math.min(start[1], end[1]),\n            ];\n\n            // Apply padding and offset to start, end points\n            start = kvector.add(\n                kvector.subtract(start, extraOffset),\n                kvector.scale(padding, 0.5)\n            );\n            end = kvector.add(\n                kvector.subtract(end, extraOffset),\n                kvector.scale(padding, 0.5)\n            );\n\n            // Calculate <div> dimensions\n            const left = extraOffset[0] - padding[0] / 2;\n            const top = extraOffset[1] - padding[1] / 2;\n            const width = Math.abs(start[0] - end[0]) + padding[0];\n            const height = Math.abs(start[1] - end[1]) + padding[1];\n\n            // Create <div>\n            const wrapper = document.createElement(\"div\");\n            $(wrapper).css({\n                position: \"absolute\",\n                width: width + \"px\",\n                height: height + \"px\",\n                left: left + \"px\",\n                top: top + \"px\",\n                // Outsiders should feel like the line's 'origin' (i.e., for\n                // rotation) is the starting point\n                transformOrigin: start[0] + \"px \" + start[1] + \"px\",\n            });\n\n            // Create Raphael canvas\n            const localRaphael = Raphael(wrapper, width, height);\n\n            // Calculate path\n            const path =\n                \"M\" +\n                start[0] +\n                \" \" +\n                start[1] +\n                \" \" +\n                \"L\" +\n                end[0] +\n                \" \" +\n                end[1];\n            const visibleShape = localRaphael.path(path);\n            visibleShape.graphiePath = [start, end];\n\n            return {\n                wrapper: wrapper,\n                visibleShape: visibleShape,\n            };\n        },\n\n        sinusoid: function(a, b, c, d) {\n            // Plot a sinusoid of the form: f(x) = a * sin(b * x - c) + d\n            return raphael.path(svgSinusoidPath(a, b, c, d));\n        },\n\n        grid: function(xr, yr) {\n            const step = currentStyle.step || [1, 1];\n            const set = raphael.set();\n\n            let x = step[0] * Math.ceil(xr[0] / step[0]);\n            for (; x <= xr[1]; x += step[0]) {\n                set.push(this.line([x, yr[0]], [x, yr[1]]));\n            }\n\n            let y = step[1] * Math.ceil(yr[0] / step[1]);\n            for (; y <= yr[1]; y += step[1]) {\n                set.push(this.line([xr[0], y], [xr[1], y]));\n            }\n\n            return set;\n        },\n\n        label: function(point, text, direction, latex) {\n            latex = typeof latex === \"undefined\" || latex;\n\n            const $span = $(\"<span>\").addClass(\"graphie-label\");\n\n            const pad = currentStyle[\"label-distance\"];\n\n            $span\n                .css(\n                    $.extend({}, {\n                        position: \"absolute\",\n                        padding: (pad != null ? pad : 7) + \"px\",\n                    })\n                )\n                .data(\"labelDirection\", direction)\n                .appendTo(el);\n\n            $span.setPosition = function(point) {\n                const scaledPoint = scalePoint(point);\n                $span.css({\n                    left: scaledPoint[0],\n                    top: scaledPoint[1],\n                });\n            };\n\n            $span.setPosition(point);\n\n            const span = $span[0];\n\n            $span.processMath = function(math, force) {\n                processMath(span, math, force, function() {\n                    const width = span.scrollWidth;\n                    const height = span.scrollHeight;\n                    setLabelMargins(span, [width, height]);\n                });\n            };\n\n            $span.processText = function(text) {\n                $span.html(text);\n                const width = span.scrollWidth;\n                const height = span.scrollHeight;\n                setLabelMargins(span, [width, height]);\n            };\n\n            if (latex) {\n                $span.processMath(text, /* force */ false);\n            } else {\n                $span.processText(text);\n            }\n\n            return $span;\n        },\n\n        plotParametric: function(fn, range, shade, fn2) {\n            // Note: fn2 should only be set if 'shade' is true, as it denotes\n            // the function between which fn should have its area shaded.\n            // In general, plotParametric shouldn't be used to shade the area\n            // between two arbitrary parametrics functions over an interval,\n            // as the method assumes that fn and fn2 are both of the form\n            // fn(t) = (t, fn'(t)) for some initial fn'.\n            fn2 =\n                fn2 ||\n                function(t) {\n                    return [t, 0];\n                };\n\n            // We truncate to 500,000, since anything bigger causes\n            // overflow in the firefox svg renderer.  This is safe\n            // since 500,000 is outside the viewport anyway.  We\n            // write these functions the way we do to handle undefined.\n            const clipper = xy => {\n                if (Math.abs(xy[1]) > 500000) {\n                    return [xy[0], Math.min(Math.max(xy[1], -500000), 500000)];\n                }\n                return xy;\n            };\n            const clippedFn = x => clipper(fn(x));\n            const clippedFn2 = x => clipper(fn2(x));\n\n            if (!currentStyle.strokeLinejoin) {\n                currentStyle.strokeLinejoin = \"round\";\n            }\n            if (!currentStyle.strokeLinecap) {\n                currentStyle.strokeLinecap = \"round\";\n            }\n\n            const min = range[0];\n            const max = range[1];\n            let step = (max - min) / (currentStyle[\"plot-points\"] || 800);\n            if (step === 0) {\n                step = 1;\n            }\n\n            const paths = raphael.set();\n            let points = [];\n            let lastDiff = GraphUtils.coordDiff(\n                clippedFn(min),\n                clippedFn2(min)\n            );\n\n            let lastFlip = min;\n            for (let t = min; t <= max; t += step) {\n                const top = clippedFn(t);\n                const bottom = clippedFn2(t);\n                const diff = GraphUtils.coordDiff(top, bottom);\n\n                // Find points where it flips\n                // Create path that sketches area between the two functions\n                if (\n                    // if there is an asymptote here, meaning that the graph\n                    // switches signs and has a large difference\n                    (diff[1] < 0 !== lastDiff[1] < 0 &&\n                        Math.abs(diff[1] - lastDiff[1]) > 2 * yScale) ||\n                    // or the function is undefined\n                    isNaN(diff[1])\n                ) {\n                    // split the path at this point, and draw it\n                    if (shade) {\n                        points.push(top);\n\n                        // backtrack to draw paired function\n                        for (let u = t - step; u >= lastFlip; u -= step) {\n                            points.push(clippedFn2(u));\n                        }\n                        lastFlip = t;\n                    }\n                    paths.push(this.path(points));\n                    // restart the path, excluding this point\n                    points = [];\n                    if (shade) {\n                        points.push(top);\n                    }\n                } else {\n                    // otherwise, just add the point to the path\n                    points.push(top);\n                }\n\n                lastDiff = diff;\n            }\n\n            if (shade) {\n                // backtrack to draw paired function\n                for (let u = max - step; u >= lastFlip; u -= step) {\n                    points.push(clippedFn2(u));\n                }\n            }\n            paths.push(this.path(points));\n\n            return paths;\n        },\n\n        plotPolar: function(fn, range) {\n            const min = range[0];\n            const max = range[1];\n\n            // There is probably a better heuristic for this\n            if (!currentStyle[\"plot-points\"]) {\n                currentStyle[\"plot-points\"] = 2 * (max - min) * xScale;\n            }\n\n            return this.plotParametric(function(th) {\n                return polar(fn(th), th * 180 / Math.PI);\n            }, range);\n        },\n\n        plot: function(fn, range, swapAxes, shade, fn2) {\n            const min = range[0];\n            const max = range[1];\n            if (!currentStyle[\"plot-points\"]) {\n                currentStyle[\"plot-points\"] = 2 * (max - min) * xScale;\n            }\n\n            if (swapAxes) {\n                if (fn2) {\n                    // TODO(charlie): support swapped axis area shading\n                    throw new Error(\n                        \"Can't shade area between functions with swapped axes.\"\n                    );\n                }\n                return this.plotParametric(\n                    function(y) {\n                        return [fn(y), y];\n                    },\n                    range,\n                    shade\n                );\n            } else {\n                if (fn2) {\n                    if (shade) {\n                        return this.plotParametric(\n                            function(x) {\n                                return [x, fn(x)];\n                            },\n                            range,\n                            shade,\n                            function(x) {\n                                return [x, fn2(x)];\n                            }\n                        );\n                    } else {\n                        throw new Error(\n                            \"fn2 should only be set when 'shade' is True.\"\n                        );\n                    }\n                }\n                return this.plotParametric(\n                    function(x) {\n                        return [x, fn(x)];\n                    },\n                    range,\n                    shade\n                );\n            }\n        },\n\n        /**\n         * Given a piecewise function, return a Raphael set of paths that\n         * can be used to draw the function, e.g. using style().\n         * Calls plotParametric.\n         *\n         * @param  {[]} fnArray    array of functions which when called\n         *                         with a parameter i return the value of\n         *                         the function at i\n         * @param  {[]} rangeArray array of ranges over which the\n         *                         corresponding functions are defined\n         * @return {Raphael set}\n         */\n        plotPiecewise: function(fnArray, rangeArray) {\n            const paths = raphael.set();\n            const self = this;\n            _.times(fnArray.length, function(i) {\n                const fn = fnArray[i];\n                const range = rangeArray[i];\n                const fnPaths = self.plotParametric(function(x) {\n                    return [x, fn(x)];\n                }, range);\n                _.each(fnPaths, function(fnPath) {\n                    paths.push(fnPath);\n                });\n            });\n\n            return paths;\n        },\n\n        /**\n         * Given an array of coordinates of the form [x, y], create and\n         * return a Raphael set of Raphael circle objects at those\n         * coordinates\n         *\n         * @param  {Array of arrays} endpointArray\n         * @return {Raphael set}\n         */\n        plotEndpointCircles: function(endpointArray) {\n            const circles = raphael.set();\n            const self = this;\n\n            _.each(endpointArray, function(coord, i) {\n                circles.push(self.circle(coord, 0.15));\n            });\n\n            return circles;\n        },\n\n        plotAsymptotes: function(fn, range) {\n            const min = range[0];\n            const max = range[1];\n            const step = (max - min) / (currentStyle[\"plot-points\"] || 800);\n\n            const asymptotes = raphael.set();\n            let lastVal = fn(min);\n\n            for (let t = min; t <= max; t += step) {\n                const funcVal = fn(t);\n\n                if (\n                    funcVal < 0 !== lastVal < 0 &&\n                    Math.abs(funcVal - lastVal) > 2 * yScale\n                ) {\n                    asymptotes.push(this.line([t, yScale], [t, -yScale]));\n                }\n\n                lastVal = funcVal;\n            }\n\n            return asymptotes;\n        },\n    };\n\n    const graphie = new Graphie();\n    _.extend(graphie, {\n        raphael: raphael,\n\n        init: function(options) {\n            let scale = options.scale || [40, 40];\n            scale = typeof scale === \"number\" ? [scale, scale] : scale;\n\n            xScale = scale[0];\n            yScale = scale[1];\n\n            if (options.range == null) {\n                return Khan.error(\"range should be specified in graph init\");\n            }\n\n            xRange = options.range[0];\n            yRange = options.range[1];\n\n            const w = (xRange[1] - xRange[0]) * xScale;\n            const h = (yRange[1] - yRange[0]) * yScale;\n            raphael.setSize(w, h);\n\n            $(el).css({\n                width: w,\n                height: h,\n            });\n\n            this.range = options.range;\n            this.scale = scale;\n            this.dimensions = [w, h];\n            this.xpixels = w;\n            this.ypixels = h;\n\n            this.isMobile = options.isMobile;\n\n            return this;\n        },\n\n        style: function(attrs, fn) {\n            const processed = processAttributes(attrs);\n\n            if (typeof fn === \"function\") {\n                const oldStyle = currentStyle;\n                currentStyle = $.extend({}, currentStyle, processed);\n                const result = fn.call(graphie);\n                currentStyle = oldStyle;\n                return result;\n            } else {\n                $.extend(currentStyle, processed);\n            }\n        },\n\n        scalePoint: scalePoint,\n        scaleVector: scaleVector,\n\n        unscalePoint: unscalePoint,\n        unscaleVector: unscaleVector,\n\n        // Custom SVG path functions that are dependent on graphie range\n        // `svgPath`, while independent of range, is exported for consistency\n        svgPath: svgPath,\n        svgParabolaPath: svgParabolaPath,\n        svgSinusoidPath: svgSinusoidPath,\n    });\n\n    $.each(drawingTools, function(name) {\n        graphie[name] = function() {\n            const last = arguments[arguments.length - 1];\n            const oldStyle = currentStyle;\n            let result;\n\n            // The last argument is probably trying to change the style\n            if (typeof last === \"object\" && !_.isArray(last)) {\n                currentStyle = {\n                    ...currentStyle,\n                    ...processAttributes(last),\n                };\n\n                const rest = [].slice.call(arguments, 0, arguments.length - 1);\n                result = drawingTools[name](...rest);\n            } else {\n                currentStyle = $.extend({}, currentStyle);\n\n                result = drawingTools[name](...arguments);\n            }\n\n            // Bad heuristic for recognizing Raphael elements and sets\n            const type = result.constructor.prototype;\n            if (type === Raphael.el || type === Raphael.st) {\n                result.attr(currentStyle);\n\n                if (currentStyle.arrows) {\n                    result = addArrowheads(result);\n                }\n            } else if (result instanceof $) {\n                // We assume that if it's not a Raphael element/set, it\n                // does not contain SVG.\n                result.css({...currentStyle, ...SVG_SPECIFIC_STYLE_MASK});\n            }\n\n            currentStyle = oldStyle;\n            return result;\n        };\n    });\n\n    // Initializes graphie settings for a graph and draws the basic graph\n    // features (axes, grid, tick marks, and axis labels)\n    // Options expected are:\n    // - range: [[a, b], [c, d]] or [a, b]\n    // - scale: [a, b] or number\n    // - gridOpacity: number (0 - 1)\n    // - gridStep: [a, b] or number (relative to units)\n    // - tickStep: [a, b] or number (relative to grid steps)\n    // - tickLen: [a, b] or number (in pixels)\n    // - labelStep: [a, b] or number (relative to tick steps)\n    // - yLabelFormat: fn to format label string for y-axis\n    // - xLabelFormat: fn to format label string for x-axis\n    // - smartLabelPositioning: true or false to ignore minus sign\n    graphie.graphInit = function(options) {\n        options = options || {};\n\n        $.each(options, function(prop, val) {\n            // allow options to be specified by a single number for shorthand if\n            // the horizontal and vertical components are the same\n            if (\n                !prop.match(/.*Opacity$/) &&\n                prop !== \"range\" &&\n                typeof val === \"number\"\n            ) {\n                options[prop] = [val, val];\n            }\n\n            // allow symmetric ranges to be specified by the absolute values\n            if (prop === \"range\" || prop === \"gridRange\") {\n                if (val.constructor === Array) {\n                    // but don't mandate symmetric ranges\n                    if (val[0].constructor !== Array) {\n                        options[prop] = [[-val[0], val[0]], [-val[1], val[1]]];\n                    }\n                } else if (typeof val === \"number\") {\n                    options[prop] = [[-val, val], [-val, val]];\n                }\n            }\n        });\n\n        const range = options.range || [[-10, 10], [-10, 10]];\n        const gridRange = options.gridRange || options.range;\n        const scale = options.scale || [20, 20];\n        const grid = options.grid != null ? options.grid : true;\n        const gridOpacity = options.gridOpacity || 0.1;\n        const gridStep = options.gridStep || [1, 1];\n        const axes = options.axes != null ? options.axes : true;\n        const axisArrows = options.axisArrows || \"\";\n        const axisOpacity = options.axisOpacity || 1.0;\n        const axisCenter = options.axisCenter || [\n            Math.min(Math.max(range[0][0], 0), range[0][1]),\n            Math.min(Math.max(range[1][0], 0), range[1][1]),\n        ];\n        const axisLabels =\n            options.axisLabels != null ? options.axisLabels : false;\n        const ticks = options.ticks != null ? options.ticks : true;\n        const tickStep = options.tickStep || [2, 2];\n        const tickLen = options.tickLen || [5, 5];\n        const tickOpacity = options.tickOpacity || 1.0;\n        const labels = options.labels || options.labelStep || false;\n        const labelStep = options.labelStep || [1, 1];\n        const labelOpacity = options.labelOpacity || 1.0;\n        let unityLabels = options.unityLabels || false;\n        const labelFormat =\n            options.labelFormat ||\n            function(a) {\n                return a;\n            };\n        let xLabelFormat = options.xLabelFormat || labelFormat;\n        let yLabelFormat = options.yLabelFormat || labelFormat;\n        const smartLabelPositioning =\n            options.smartLabelPositioning != null\n                ? options.smartLabelPositioning\n                : true;\n        const realRange = [\n            [\n                range[0][0] - (range[0][0] > 0 ? 1 : 0),\n                range[0][1] + (range[0][1] < 0 ? 1 : 0),\n            ],\n            [\n                range[1][0] - (range[1][0] > 0 ? 1 : 0),\n                range[1][1] + (range[1][1] < 0 ? 1 : 0),\n            ],\n        ];\n\n        if (!_.isArray(unityLabels)) {\n            unityLabels = [unityLabels, unityLabels];\n        }\n\n        if (smartLabelPositioning) {\n            const minusIgnorer = function(lf) {\n                return function(a) {\n                    return (lf(a) + \"\").replace(/-(\\d)/g, \"\\\\llap{-}$1\");\n                };\n            };\n\n            xLabelFormat = minusIgnorer(xLabelFormat);\n            yLabelFormat = minusIgnorer(yLabelFormat);\n        }\n\n        this.init({\n            range: realRange,\n            scale: scale,\n            isMobile: options.isMobile,\n        });\n\n        // draw grid\n        if (grid) {\n            this.grid(gridRange[0], gridRange[1], {\n                stroke: options.isMobile ? KhanColors.GRAY_C : \"#000000\",\n                opacity: options.isMobile ? 1 : gridOpacity,\n                step: gridStep,\n                strokeWidth: options.isMobile ? 1 : 2,\n            });\n        }\n\n        // draw axes\n        if (axes) {\n            // this is a slight hack until <-> arrowheads work\n            if (axisArrows === \"<->\" || axisArrows === true) {\n                this.style(\n                    {\n                        stroke: options.isMobile\n                            ? KhanColors.GRAY_G\n                            : \"#000000\",\n                        opacity: options.isMobile ? 1 : axisOpacity,\n                        strokeWidth: options.isMobile ? 1 : 2,\n                        arrows: \"->\",\n                    },\n                    function() {\n                        if (range[1][0] < 0 && range[1][1] > 0) {\n                            this.path([\n                                axisCenter,\n                                [gridRange[0][0], axisCenter[1]],\n                            ]);\n                            this.path([\n                                axisCenter,\n                                [gridRange[0][1], axisCenter[1]],\n                            ]);\n                        }\n                        if (range[0][0] < 0 && range[0][1] > 0) {\n                            this.path([\n                                axisCenter,\n                                [axisCenter[0], gridRange[1][0]],\n                            ]);\n                            this.path([\n                                axisCenter,\n                                [axisCenter[0], gridRange[1][1]],\n                            ]);\n                        }\n                    }\n                );\n\n                // also, we don't support \"<-\" arrows yet, but why you\n                // would want that on your graph is beyond me.\n            } else if (axisArrows === \"->\" || axisArrows === \"\") {\n                this.style(\n                    {\n                        stroke: \"#000000\",\n                        opacity: axisOpacity,\n                        strokeWidth: 2,\n                        arrows: axisArrows,\n                    },\n                    function() {\n                        this.path([\n                            [gridRange[0][0], axisCenter[1]],\n                            [gridRange[0][1], axisCenter[1]],\n                        ]);\n                        this.path([\n                            [axisCenter[0], gridRange[1][0]],\n                            [axisCenter[0], gridRange[1][1]],\n                        ]);\n                    }\n                );\n            }\n\n            if (axisLabels && axisLabels.length === 2) {\n                this.label(\n                    [gridRange[0][1], axisCenter[1]],\n                    axisLabels[0],\n                    \"right\"\n                );\n                this.label(\n                    [axisCenter[0], gridRange[1][1]],\n                    axisLabels[1],\n                    \"above\"\n                );\n            }\n        }\n\n        // draw tick marks\n        if (ticks) {\n            const halfWidthTicks = options.isMobile;\n            this.style(\n                {\n                    stroke: options.isMobile ? KhanColors.GRAY_G : \"#000000\",\n                    opacity: options.isMobile ? 1 : tickOpacity,\n                    strokeWidth: 1,\n                },\n                function() {\n                    // horizontal axis\n                    let step = gridStep[0] * tickStep[0];\n                    let len = tickLen[0] / scale[1];\n                    let start = gridRange[0][0];\n                    let stop = gridRange[0][1];\n\n                    if (range[1][0] < 0 && range[1][1] > 0) {\n                        for (\n                            let x = step + axisCenter[0];\n                            x <= stop;\n                            x += step\n                        ) {\n                            if (x < stop || !axisArrows) {\n                                this.line(\n                                    [x, -len + axisCenter[1]],\n                                    [\n                                        x,\n                                        halfWidthTicks\n                                            ? 0\n                                            : len + axisCenter[1],\n                                    ]\n                                );\n                            }\n                        }\n\n                        for (\n                            let x = -step + axisCenter[0];\n                            x >= start;\n                            x -= step\n                        ) {\n                            if (x > start || !axisArrows) {\n                                this.line(\n                                    [x, -len + axisCenter[1]],\n                                    [\n                                        x,\n                                        halfWidthTicks\n                                            ? 0\n                                            : len + axisCenter[1],\n                                    ]\n                                );\n                            }\n                        }\n                    }\n\n                    // vertical axis\n                    step = gridStep[1] * tickStep[1];\n                    len = tickLen[1] / scale[0];\n                    start = gridRange[1][0];\n                    stop = gridRange[1][1];\n\n                    if (range[0][0] < 0 && range[0][1] > 0) {\n                        for (\n                            let y = step + axisCenter[1];\n                            y <= stop;\n                            y += step\n                        ) {\n                            if (y < stop || !axisArrows) {\n                                this.line(\n                                    [-len + axisCenter[0], y],\n                                    [\n                                        halfWidthTicks\n                                            ? 0\n                                            : len + axisCenter[0],\n                                        y,\n                                    ]\n                                );\n                            }\n                        }\n\n                        for (\n                            let y = -step + axisCenter[1];\n                            y >= start;\n                            y -= step\n                        ) {\n                            if (y > start || !axisArrows) {\n                                this.line(\n                                    [-len + axisCenter[0], y],\n                                    [\n                                        halfWidthTicks\n                                            ? 0\n                                            : len + axisCenter[0],\n                                        y,\n                                    ]\n                                );\n                            }\n                        }\n                    }\n                }\n            );\n        }\n\n        // draw axis labels\n        if (labels) {\n            this.style(\n                {\n                    stroke: options.isMobile ? KhanColors.GRAY_G : \"#000000\",\n                    opacity: options.isMobile ? 1 : labelOpacity,\n                },\n                function() {\n                    // horizontal axis\n                    let step = gridStep[0] * tickStep[0] * labelStep[0];\n                    let start = gridRange[0][0];\n                    let stop = gridRange[0][1];\n                    const xAxisPosition = axisCenter[0] < 0 ? \"above\" : \"below\";\n                    const yAxisPosition = axisCenter[0] < 0 ? \"right\" : \"left\";\n                    const xShowZero =\n                        axisCenter[0] === 0 && axisCenter[1] !== 0;\n                    const yShowZero =\n                        axisCenter[0] !== 0 && axisCenter[1] === 0;\n                    const axisOffCenter =\n                        axisCenter[0] !== 0 || axisCenter[1] !== 0;\n                    const showUnityX = unityLabels[0] || axisOffCenter;\n                    const showUnityY = unityLabels[1] || axisOffCenter;\n\n                    // positive x-axis\n                    for (\n                        let x = (xShowZero ? 0 : step) + axisCenter[0];\n                        x <= stop;\n                        x += step\n                    ) {\n                        if (x < stop || !axisArrows) {\n                            this.label(\n                                [x, axisCenter[1]],\n                                xLabelFormat(x),\n                                xAxisPosition\n                            );\n                        }\n                    }\n\n                    // negative x-axis\n                    for (\n                        let x = -step * (showUnityX ? 1 : 2) + axisCenter[0];\n                        x >= start;\n                        x -= step\n                    ) {\n                        if (x > start || !axisArrows) {\n                            this.label(\n                                [x, axisCenter[1]],\n                                xLabelFormat(x),\n                                xAxisPosition\n                            );\n                        }\n                    }\n\n                    step = gridStep[1] * tickStep[1] * labelStep[1];\n                    start = gridRange[1][0];\n                    stop = gridRange[1][1];\n\n                    // positive y-axis\n                    for (\n                        let y = (yShowZero ? 0 : step) + axisCenter[1];\n                        y <= stop;\n                        y += step\n                    ) {\n                        if (y < stop || !axisArrows) {\n                            this.label(\n                                [axisCenter[0], y],\n                                yLabelFormat(y),\n                                yAxisPosition\n                            );\n                        }\n                    }\n\n                    // negative y-axis\n                    for (\n                        let y = -step * (showUnityY ? 1 : 2) + axisCenter[1];\n                        y >= start;\n                        y -= step\n                    ) {\n                        if (y > start || !axisArrows) {\n                            this.label(\n                                [axisCenter[0], y],\n                                yLabelFormat(y),\n                                yAxisPosition\n                            );\n                        }\n                    }\n                }\n            );\n        }\n    };\n\n    return graphie;\n};\n\n_module_.exports = GraphUtils;\nexport default _module_.exports;\n","import { getCanUse3dTransform } from \"../interactive2/interactive-util.js\";\nimport _colorsJs from \"./colors.js\";\nimport _mathJs from \"./math.js\";\nimport _interactive2WrappedPathJs from \"../interactive2/wrapped-path.js\";\nimport _interactive2WrappedLineJs from \"../interactive2/wrapped-line.js\";\nimport _interactive2WrappedEllipseJs from \"../interactive2/wrapped-ellipse.js\";\nimport _kmath3 from \"kmath\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _graphieJs from \"./graphie.js\";\nimport \"../lib/jquery.mobile.vmouse.js\";\nimport _underscore from \"underscore\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable max-lines */\n\n/**\n * Interactive graphie utilities.\n *\n * This file exposes a couple functions, but mostly it adds functions to the\n * `Graphie` prototype for dealing with interactive graphie elements.\n */\n\n// TODO(emily): This file breaks our line length limits like nobody's business.\n// Figure out how to fix that.\nconst _ = _underscore;\n\n/* global Raphael:false */\nconst GraphUtils = _graphieJs;\nconst kvector = _kmath.vector;\nconst kpoint = _kmath2.point;\nconst kline = _kmath3.line;\nconst WrappedEllipse = _interactive2WrappedEllipseJs;\nconst WrappedLine = _interactive2WrappedLineJs;\nconst WrappedPath = _interactive2WrappedPathJs;\nconst KhanMath = _mathJs;\nconst KhanColors = _colorsJs;\n\nfunction sum(array) {\n    return _.reduce(\n        array,\n        function(memo, arg) {\n            return memo + arg;\n        },\n        0\n    );\n}\n\nfunction clockwise(points) {\n    const segments = _.zip(points, points.slice(1).concat(points.slice(0, 1)));\n    const areas = _.map(segments, function(segment) {\n        const p1 = segment[0];\n        const p2 = segment[1];\n        return (p2[0] - p1[0]) * (p2[1] + p1[1]);\n    });\n    return sum(areas) > 0;\n}\n\n/* vector-add multiple [x, y] coords/vectors */\nfunction addPoints() {\n    const points = _.toArray(arguments);\n    const zipped = _.zip(...points);\n    return _.map(zipped, sum);\n}\n\nfunction reverseVector(vector) {\n    return _.map(vector, function(coord) {\n        return coord * -1;\n    });\n}\n\nfunction scaledDistanceFromAngle(angle) {\n    const a = 3.51470560176242 * 20;\n    const b = 0.5687298702748785 * 20;\n    const c = -0.037587715462826674;\n    return (a - b) * Math.exp(c * angle) + b;\n}\n\nfunction scaledPolarRad(radius, radians) {\n    return [\n        radius * Math.cos(radians),\n        radius * Math.sin(radians) * -1, // SVG flips y axis\n    ];\n}\n\nfunction scaledPolarDeg(radius, degrees) {\n    const radians = degrees * Math.PI / 180;\n    return scaledPolarRad(radius, radians);\n}\n\n// Global dragging state\nlet dragging = false;\n\nconst InteractiveUtils = {\n    // Useful for shapes that are only sometimes drawn. If a shape isn't\n    // needed, it can be replaced with bogusShape which just has stub methods\n    // that successfully do nothing.\n    // The alternative would be 'if..typeof' checks all over the place.\n    bogusShape: {\n        animate: function() {},\n        attr: function() {},\n        remove: function() {},\n    },\n};\n\n_.extend(GraphUtils.Graphie.prototype, {\n    // graphie puts text spans on top of the SVG, which looks good, but gets\n    // in the way of mouse events. This adds another SVG element on top\n    // of everything else where we can add invisible shapes with mouse\n    // handlers wherever we want.\n    addMouseLayer: function(options) {\n        const graph = this;\n        options = _.extend(\n            {\n                allowScratchpad: false,\n                setDrawingAreaAvailable: function() {},\n            },\n            options\n        );\n\n        const mouselayerZIndex = 2;\n        graph.mouselayer = Raphael(\n            graph.raphael.canvas.parentNode,\n            graph.xpixels,\n            graph.ypixels\n        );\n        $(graph.mouselayer.canvas).css(\"z-index\", mouselayerZIndex);\n        if (\n            options.onClick ||\n            options.onMouseDown ||\n            options.onMouseMove ||\n            options.onMouseOver ||\n            options.onMouseOut\n        ) {\n            const canvasClickTarget = graph.mouselayer\n                .rect(0, 0, graph.xpixels, graph.ypixels)\n                .attr({\n                    fill: \"#000\",\n                    opacity: 0,\n                });\n            let isClickingCanvas = false;\n\n            $(graph.mouselayer.canvas).on(\"vmousedown\", function(e) {\n                if (e.target === canvasClickTarget[0]) {\n                    if (options.onMouseDown) {\n                        options.onMouseDown(graph.getMouseCoord(e));\n                    }\n                    isClickingCanvas = true;\n\n                    if (options.onMouseMove) {\n                        $(document).bind(\"vmousemove.mouseLayer\", function(e) {\n                            if (isClickingCanvas) {\n                                e.preventDefault();\n                                options.onMouseMove(graph.getMouseCoord(e));\n                            }\n                        });\n                    }\n\n                    $(document).bind(\"vmouseup.mouseLayer\", function(e) {\n                        $(document).unbind(\".mouseLayer\");\n\n                        // Only register clicks that started on the canvas,\n                        // and not on another mouseLayer target\n                        if (isClickingCanvas && options.onClick) {\n                            options.onClick(graph.getMouseCoord(e));\n                        }\n                        isClickingCanvas = false;\n                    });\n                }\n            });\n            if (options.onMouseOver) {\n                $(graph.mouselayer.canvas).on(\"vmouseover\", function(e) {\n                    options.onMouseOver(graph.getMouseCoord(e));\n                });\n            }\n            if (options.onMouseOut) {\n                $(graph.mouselayer.canvas).on(\"vmouseout\", function(e) {\n                    options.onMouseOut(graph.getMouseCoord(e));\n                });\n            }\n        }\n        if (!options.allowScratchpad) {\n            options.setDrawingAreaAvailable(false);\n        }\n\n        // Add mouse and visible wrapper layers for DOM-node-wrapped movables\n        graph._mouselayerWrapper = document.createElement(\"div\");\n        $(graph._mouselayerWrapper).css({\n            position: \"absolute\",\n            left: 0,\n            top: 0,\n            zIndex: mouselayerZIndex,\n        });\n\n        graph._visiblelayerWrapper = document.createElement(\"div\");\n        $(graph._visiblelayerWrapper).css({\n            position: \"absolute\",\n            left: 0,\n            top: 0,\n        });\n\n        const el = graph.raphael.canvas.parentNode;\n        el.appendChild(graph._visiblelayerWrapper);\n        el.appendChild(graph._mouselayerWrapper);\n\n        // Add functions for adding to wrappers\n        graph.addToMouseLayerWrapper = function(el) {\n            this._mouselayerWrapper.appendChild(el);\n        };\n        graph.addToVisibleLayerWrapper = function(el) {\n            this._visiblelayerWrapper.appendChild(el);\n        };\n    },\n\n    /**\n     * Get mouse coordinates in pixels\n     */\n    getMousePx: function(event) {\n        const graphie = this;\n\n        const mouseX =\n            event.pageX - $(graphie.raphael.canvas.parentNode).offset().left;\n        const mouseY =\n            event.pageY - $(graphie.raphael.canvas.parentNode).offset().top;\n\n        return [mouseX, mouseY];\n    },\n\n    /**\n     * Get mouse coordinates in graph coordinates\n     */\n    getMouseCoord: function(event) {\n        return this.unscalePoint(this.getMousePx(event));\n    },\n\n    /**\n     * Unlike all other Graphie-related code, the following three functions use\n     * a lot of scaled coordinates (so that labels appear the same size\n     * regardless of current shape/figure scale). These are prefixed with 's'.\n     */\n    labelAngle: function(options) {\n        const graphie = this;\n\n        _.defaults(options, {\n            point1: [0, 0],\n            vertex: [0, 0],\n            point3: [0, 0],\n            label: null,\n            numArcs: 1,\n            showRightAngleMarker: true,\n            pushOut: 0,\n            clockwise: false,\n            style: {},\n        });\n\n        let text = options.text === undefined ? \"\" : options.text;\n        const vertex = options.vertex;\n        const sVertex = graphie.scalePoint(vertex);\n        let p1;\n        let p3;\n        if (options.clockwise) {\n            p1 = options.point1;\n            p3 = options.point3;\n        } else {\n            p1 = options.point3;\n            p3 = options.point1;\n        }\n\n        const startAngle = GraphUtils.findAngle(p1, vertex);\n        const endAngle = GraphUtils.findAngle(p3, vertex);\n        const angle = (endAngle + 360 - startAngle) % 360;\n        const halfAngle = (startAngle + angle / 2) % 360;\n        const sPadding = 5 * options.pushOut;\n        let sRadius = sPadding + scaledDistanceFromAngle(angle);\n        const temp = [];\n\n        if (Math.abs(angle - 90) < 1e-9 && options.showRightAngleMarker) {\n            const v1 = addPoints(sVertex, scaledPolarDeg(sRadius, startAngle));\n            const v2 = addPoints(sVertex, scaledPolarDeg(sRadius, endAngle));\n\n            sRadius *= Math.SQRT2;\n            const v3 = addPoints(sVertex, scaledPolarDeg(sRadius, halfAngle));\n\n            _.each([v1, v2], function(v) {\n                temp.push(graphie.scaledPath([v, v3], options.style));\n            });\n        } else {\n            // Draw arcs\n            _.times(options.numArcs, function(i) {\n                temp.push(\n                    graphie.arc(\n                        vertex,\n                        graphie.unscaleVector(sRadius),\n                        startAngle,\n                        endAngle,\n                        options.style\n                    )\n                );\n                sRadius += 3;\n            });\n        }\n\n        if (text) {\n            const match = text.match(/\\$deg(\\d)?/);\n            if (match) {\n                const precision = match[1] || 1;\n                text = text.replace(\n                    match[0],\n                    KhanMath.toFixedApprox(angle, precision) + \"^{\\\\circ}\"\n                );\n            }\n\n            const sOffset = scaledPolarDeg(sRadius + 15, halfAngle);\n            const sPosition = addPoints(sVertex, sOffset);\n            const position = graphie.unscalePoint(sPosition);\n\n            // Reuse label if possible\n            if (options.label) {\n                options.label.setPosition(position);\n                options.label.processMath(text, /* force */ true);\n            } else {\n                graphie.label(position, text, \"center\", options.style);\n            }\n        }\n\n        return temp;\n    },\n\n    labelSide: function(options) {\n        const graphie = this;\n\n        _.defaults(options, {\n            point1: [0, 0],\n            point2: [0, 0],\n            label: null,\n            text: \"\",\n            numTicks: 0,\n            numArrows: 0,\n            clockwise: false,\n            style: {},\n        });\n\n        let p1;\n        let p2;\n        if (options.clockwise) {\n            p1 = options.point1;\n            p2 = options.point2;\n        } else {\n            p1 = options.point2;\n            p2 = options.point1;\n        }\n\n        const midpoint = [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2];\n        const sMidpoint = graphie.scalePoint(midpoint);\n        const parallelAngle = Math.atan2(p2[1] - p1[1], p2[0] - p1[0]);\n        const perpendicularAngle = parallelAngle + Math.PI / 2;\n        const temp = [];\n        let sCumulativeOffset = 0;\n\n        if (options.numTicks) {\n            const n = options.numTicks;\n\n            const sSpacing = 5;\n            const sHeight = 5;\n\n            const style = _.extend({}, options.style, {\n                strokeWidth: 2,\n            });\n\n            _.times(n, function(i) {\n                const sOffset = sSpacing * (i - (n - 1) / 2);\n\n                const sOffsetVector = scaledPolarRad(sOffset, parallelAngle);\n                const sHeightVector = scaledPolarRad(\n                    sHeight,\n                    perpendicularAngle\n                );\n\n                const sPath = [\n                    addPoints(sMidpoint, sOffsetVector, sHeightVector),\n                    addPoints(\n                        sMidpoint,\n                        sOffsetVector,\n                        reverseVector(sHeightVector)\n                    ),\n                ];\n\n                temp.push(graphie.scaledPath(sPath, style));\n            });\n\n            sCumulativeOffset += sSpacing * (n - 1) + 15;\n        }\n\n        if (options.numArrows) {\n            const n = options.numArrows;\n\n            const start = [p1, p2].sort(function(a, b) {\n                if (a[1] === b[1]) {\n                    return a[0] - b[0];\n                } else {\n                    return a[1] - b[1];\n                }\n            })[0];\n            const sStart = graphie.scalePoint(start);\n\n            const style = _.extend({}, options.style, {\n                arrows: \"->\",\n                strokeWidth: 2,\n            });\n\n            const sSpacing = 5;\n\n            _.times(n, function(i) {\n                const sOffset = sCumulativeOffset + sSpacing * i;\n                let sOffsetVector = scaledPolarRad(sOffset, parallelAngle);\n\n                if (start !== p1) {\n                    sOffsetVector = reverseVector(sOffsetVector);\n                }\n\n                const sEnd = addPoints(sMidpoint, sOffsetVector);\n\n                temp.push(graphie.scaledPath([sStart, sEnd], style));\n            });\n        }\n\n        let text = options.text;\n        if (text) {\n            const match = text.match(/\\$len(\\d)?/);\n            if (match) {\n                const distance = GraphUtils.getDistance(p1, p2);\n                const precision = match[1] || 1;\n                text = text.replace(\n                    match[0],\n                    KhanMath.toFixedApprox(distance, precision)\n                );\n            }\n\n            const sOffset = 20;\n            const sOffsetVector = scaledPolarRad(sOffset, perpendicularAngle);\n            const sPosition = addPoints(sMidpoint, sOffsetVector);\n            const position = graphie.unscalePoint(sPosition);\n\n            // Reuse label if possible\n            if (options.label) {\n                options.label.setPosition(position);\n                options.label.processMath(text, /* force */ true);\n            } else {\n                graphie.label(position, text, \"center\", options.style);\n            }\n        }\n\n        return temp;\n    },\n\n    /* Can also be used to label points that aren't vertices */\n    labelVertex: function(options) {\n        const graphie = this;\n\n        _.defaults(options, {\n            point1: null,\n            vertex: [0, 0],\n            point3: null,\n            label: null,\n            text: \"\",\n            clockwise: false,\n            style: {},\n        });\n\n        if (!options.text) {\n            return;\n        }\n\n        const vertex = options.vertex;\n        const sVertex = graphie.scalePoint(vertex);\n        let p1;\n        let p3;\n        if (options.clockwise) {\n            p1 = options.point1;\n            p3 = options.point3;\n        } else {\n            p1 = options.point3;\n            p3 = options.point1;\n        }\n\n        let angle = 135;\n        let halfAngle;\n        if (p1 && p3) {\n            const startAngle = GraphUtils.findAngle(p1, vertex);\n            const endAngle = GraphUtils.findAngle(p3, vertex);\n            angle = (endAngle + 360 - startAngle) % 360;\n            halfAngle = (startAngle + angle / 2 + 180) % 360;\n        } else if (p1) {\n            const parallelAngle = GraphUtils.findAngle(vertex, p1);\n            halfAngle = parallelAngle + 90;\n        } else if (p3) {\n            const parallelAngle = GraphUtils.findAngle(p3, vertex);\n            halfAngle = parallelAngle + 90;\n        } else {\n            // Standalone point\n            halfAngle = 135;\n        }\n\n        const sRadius = 10 + scaledDistanceFromAngle(360 - angle);\n        const sOffsetVector = scaledPolarDeg(sRadius, halfAngle);\n        const sPosition = addPoints(sVertex, sOffsetVector);\n        const position = graphie.unscalePoint(sPosition);\n\n        // Reuse label if possible\n        if (options.label) {\n            options.label.setPosition(position);\n            options.label.processMath(options.text, /* force */ true);\n        } else {\n            graphie.label(position, options.text, \"center\", options.style);\n        }\n    },\n\n    // Add a point to the graph that can be dragged around.\n    // It allows automatic constraints on its movement as well as automatically\n    // managing line segments that terminate at the point.\n    //\n    // Options can be set to control how the point behaves:\n    //   coord[]:\n    //     The initial position of the point\n    //   snapX, snapY:\n    //     The minimum increment the point can be moved\n    //\n    // The return value is an object that can be used to manipulate the point:\n    //   The coordX and coordY properties tell you the current position\n    //\n    //   By adding an onMove() method to the returned object, you can install an\n    //   event handler that gets called every time the user moves the point.\n    //\n    //   The returned object also provides a moveTo(x,y) method that will move\n    //   the point to a specific coordinate\n    //\n    // Constraints can be set on the on the returned object:\n    //\n    //  - Set point to be immovable:\n    //        movablePoint.constraints.fixed = true\n    //\n    //  - Constrain point to a fixed distance from another point. The resulting\n    //    point will move in a circle:\n    //        movablePoint.fixedDistance = {\n    //           dist: 2,\n    //           point: point1\n    //        }\n    //\n    //  - Constrain point to a line defined by a fixed angle between it and\n    //    two other points:\n    //        movablePoint.fixedAngle = {\n    //           angle: 45,\n    //           vertex: point1,\n    //           ref: point2\n    //        }\n    //\n    //  - Confined the point to traveling in a vertical or horizontal line,\n    //    respectively\n    //        movablePoint.constrainX = true;\n    //        movablePoint.constrainY = true;\n    //\n    //  - Connect a movableLineSegment to a movablePoint. The point is attached\n    //    to a specific end of the line segment by adding the segment either to\n    //    the list of lines that start at the point or the list of lines that\n    //    end at the point (movableLineSegment can do this for you):\n    //        movablePoint.lineStarts.push(movableLineSegment);\n    //          - or -\n    //        movablePoint.lineEnds.push(movableLineSegment);\n    //\n    //  - Connect a movablePolygon to a movablePoint in exacty the same way:\n    //        movablePoint.polygonVertices.push(movablePolygon);\n    //\n    addMovablePoint: function(options) {\n        const movablePoint = $.extend(\n            true,\n            {\n                graph: this,\n                coord: [0, 0],\n                snapX: 0,\n                snapY: 0,\n                pointSize: 4,\n                highlight: false,\n                dragging: false,\n                visible: true,\n                bounded: true,\n                constraints: {\n                    fixed: false,\n                    constrainX: false,\n                    constrainY: false,\n                    fixedAngle: {},\n                    fixedDistance: {},\n                },\n                lineStarts: [],\n                lineEnds: [],\n                polygonVertices: [],\n                normalStyle: {},\n                highlightStyle: {\n                    fill: KhanColors.INTERACTING,\n                    stroke: KhanColors.INTERACTING,\n                },\n                labelStyle: {\n                    color: KhanColors.INTERACTIVE,\n                },\n                vertexLabel: \"\",\n                mouseTarget: null,\n            },\n            options\n        );\n\n        const normalColor = movablePoint.constraints.fixed\n            ? KhanColors.DYNAMIC\n            : KhanColors.INTERACTIVE;\n        movablePoint.normalStyle = _.extend(\n            {},\n            {\n                fill: normalColor,\n                stroke: normalColor,\n            },\n            options.normalStyle\n        );\n\n        // deprecated: don't use coordX/coordY; use coord[]\n        if (options.coordX !== undefined) {\n            movablePoint.coord[0] = options.coordX;\n        }\n        if (options.coordY !== undefined) {\n            movablePoint.coord[1] = options.coordY;\n        }\n\n        const graph = movablePoint.graph;\n\n        const applySnapAndConstraints = function(coord) {\n            // coord should be the scaled coordinate\n\n            // move point away from edge of graph unless it's invisible or fixed\n            if (\n                movablePoint.visible &&\n                movablePoint.bounded &&\n                !movablePoint.constraints.fixed\n            ) {\n                // can't go beyond 10 pixels from the edge\n                coord = graph.constrainToBounds(coord, 10);\n            }\n\n            let coordX = coord[0];\n            let coordY = coord[1];\n\n            // snap coordinates to grid\n            if (movablePoint.snapX !== 0) {\n                coordX =\n                    Math.round(coordX / movablePoint.snapX) *\n                    movablePoint.snapX;\n            }\n            if (movablePoint.snapY !== 0) {\n                coordY =\n                    Math.round(coordY / movablePoint.snapY) *\n                    movablePoint.snapY;\n            }\n\n            // snap to points around circle\n            if (movablePoint.constraints.fixedDistance.snapPoints) {\n                const mouse = graph.scalePoint(coord);\n                let mouseX = mouse[0];\n                let mouseY = mouse[1];\n\n                const snapRadians =\n                    2 *\n                    Math.PI /\n                    movablePoint.constraints.fixedDistance.snapPoints;\n                const radius = movablePoint.constraints.fixedDistance.dist;\n\n                const centerCoord =\n                    movablePoint.constraints.fixedDistance.point;\n                const centerX =\n                    (centerCoord[0] - graph.range[0][0]) * graph.scale[0];\n                const centerY =\n                    (-centerCoord[1] + graph.range[1][1]) * graph.scale[1];\n\n                let mouseXrel = mouseX - centerX;\n                let mouseYrel = -mouseY + centerY;\n                let radians = Math.atan(mouseYrel / mouseXrel);\n                const outsideArcTanRange = mouseXrel < 0;\n\n                // adjust so that angles increase from 0 to 2 pi as you go\n                // around the circle\n                if (outsideArcTanRange) {\n                    radians += Math.PI;\n                }\n\n                // perform the snap\n                radians = Math.round(radians / snapRadians) * snapRadians;\n\n                // convert from radians back to pixels\n                mouseXrel = radius * Math.cos(radians);\n                mouseYrel = radius * Math.sin(radians);\n                // convert back to coordinates relative to graphie canvas\n                mouseX = mouseXrel + centerX;\n                mouseY = -mouseYrel + centerY;\n                coordX = KhanMath.roundTo(\n                    5,\n                    mouseX / graph.scale[0] + graph.range[0][0]\n                );\n                coordY = KhanMath.roundTo(\n                    5,\n                    graph.range[1][1] - mouseY / graph.scale[1]\n                );\n            }\n\n            const result = movablePoint.applyConstraint([coordX, coordY]);\n            return result;\n        };\n\n        // Using the passed coordinates, apply any constraints and return\n        // the closest coordinates that match the constraints.\n        movablePoint.applyConstraint = function(coord, extraConstraints, override) {\n            let newCoord = coord.slice();\n            const constraints = {};\n            if (override) {\n                $.extend(\n                    constraints,\n                    {\n                        fixed: false,\n                        constrainX: false,\n                        constrainY: false,\n                        fixedAngle: {},\n                        fixedDistance: {},\n                    },\n                    extraConstraints\n                );\n            } else {\n                $.extend(constraints, this.constraints, extraConstraints);\n            }\n\n            // constrain to vertical movement\n            if (constraints.constrainX) {\n                newCoord = [this.coord[0], coord[1]];\n\n                // constrain to horizontal movement\n            } else if (constraints.constrainY) {\n                newCoord = [coord[0], this.coord[1]];\n\n                // both distance and angle are constrained\n            } else if (\n                typeof constraints.fixedAngle.angle === \"number\" &&\n                typeof constraints.fixedDistance.dist === \"number\"\n            ) {\n                const vertex =\n                    constraints.fixedAngle.vertex.coord ||\n                    constraints.fixedAngle.vertex;\n                const ref =\n                    constraints.fixedAngle.ref.coord ||\n                    constraints.fixedAngle.ref;\n                const distPoint =\n                    constraints.fixedDistance.point.coord ||\n                    constraints.fixedDistance.point;\n\n                const constrainedAngle =\n                    (constraints.fixedAngle.angle +\n                        GraphUtils.findAngle(ref, vertex)) *\n                    Math.PI /\n                    180;\n                const length = constraints.fixedDistance.dist;\n                newCoord[0] =\n                    length * Math.cos(constrainedAngle) + distPoint[0];\n                newCoord[1] =\n                    length * Math.sin(constrainedAngle) + distPoint[1];\n\n                // angle is constrained\n            } else if (typeof constraints.fixedAngle.angle === \"number\") {\n                const vertex =\n                    constraints.fixedAngle.vertex.coord ||\n                    constraints.fixedAngle.vertex;\n                const ref =\n                    constraints.fixedAngle.ref.coord ||\n                    constraints.fixedAngle.ref;\n\n                const constrainedAngle =\n                    (constraints.fixedAngle.angle +\n                        GraphUtils.findAngle(ref, vertex)) *\n                    Math.PI /\n                    180;\n                const angle =\n                    GraphUtils.findAngle(coord, vertex) * Math.PI / 180;\n                const distance = GraphUtils.getDistance(coord, vertex);\n                let length = distance * Math.cos(constrainedAngle - angle);\n                length = length < 1.0 ? 1.0 : length;\n                newCoord[0] = length * Math.cos(constrainedAngle) + vertex[0];\n                newCoord[1] = length * Math.sin(constrainedAngle) + vertex[1];\n\n                // distance is constrained\n            } else if (typeof constraints.fixedDistance.dist === \"number\") {\n                const distPoint =\n                    constraints.fixedDistance.point.coord ||\n                    constraints.fixedDistance.point;\n\n                let angle = GraphUtils.findAngle(coord, distPoint);\n                const length = constraints.fixedDistance.dist;\n                angle = angle * Math.PI / 180;\n                newCoord[0] = length * Math.cos(angle) + distPoint[0];\n                newCoord[1] = length * Math.sin(angle) + distPoint[1];\n\n                // point is fixed\n            } else if (constraints.fixed) {\n                newCoord = movablePoint.coord;\n            }\n            return newCoord;\n        };\n\n        movablePoint.coord = applySnapAndConstraints(movablePoint.coord);\n\n        const highlightScale = 2;\n\n        if (movablePoint.visible) {\n            graph.style(movablePoint.normalStyle, function() {\n                const radii = [\n                    movablePoint.pointSize / graph.scale[0],\n                    movablePoint.pointSize / graph.scale[1],\n                ];\n                const options = {\n                    maxScale: highlightScale,\n                    // Add in 2px of padding to avoid clipping at the edges.\n                    padding: 2,\n                };\n                movablePoint.visibleShape = new WrappedEllipse(\n                    graph,\n                    movablePoint.coord,\n                    radii,\n                    options\n                );\n                movablePoint.visibleShape.attr(\n                    _.omit(movablePoint.normalStyle, \"scale\")\n                );\n                movablePoint.visibleShape.toFront();\n            });\n        }\n        movablePoint.normalStyle.scale = 1;\n        movablePoint.highlightStyle.scale = highlightScale;\n\n        if (movablePoint.vertexLabel) {\n            movablePoint.labeledVertex = this.label(\n                [0, 0],\n                \"\",\n                \"center\",\n                movablePoint.labelStyle\n            );\n        }\n\n        movablePoint.drawLabel = function() {\n            if (movablePoint.vertexLabel) {\n                movablePoint.graph.labelVertex({\n                    vertex: movablePoint.coord,\n                    label: movablePoint.labeledVertex,\n                    text: movablePoint.vertexLabel,\n                    style: movablePoint.labelStyle,\n                });\n            }\n        };\n\n        movablePoint.drawLabel();\n\n        movablePoint.grab = function(offset) {\n            // The offset for the gesture. When provided, the movable point will\n            // track the mouse's position, plus this offset. This is typically\n            // used to lock the distance between a user's finger and the movable\n            // point, when dragging.\n            offset = offset || [0, 0];\n\n            $(document).bind(\"vmousemove.point vmouseup.point\", function(event) {\n                event.preventDefault();\n                movablePoint.dragging = true;\n                dragging = true;\n\n                // Adjust the target coordinate by accounting for the gesture's\n                // offset.\n                let coord = kvector.add(graph.getMouseCoord(event), offset);\n\n                coord = applySnapAndConstraints(coord);\n                let coordX = coord[0];\n                let coordY = coord[1];\n                let mouseX;\n                let mouseY;\n\n                if (event.type === \"vmousemove\") {\n                    let doMove = true;\n                    // The caller has the option of adding an onMove() method\n                    // to the movablePoint object we return as a sort of event\n                    // handler. By returning false from onMove(), the move\n                    // can be vetoed, providing custom constraints on where\n                    // the point can be moved. By returning array [x, y], the\n                    // move can be overridden\n                    if (_.isFunction(movablePoint.onMove)) {\n                        const result = movablePoint.onMove(coordX, coordY);\n                        if (result === false) {\n                            doMove = false;\n                        }\n                        if (_.isArray(result)) {\n                            coordX = result[0];\n                            coordY = result[1];\n                        }\n                    }\n                    // coord{X|Y} may have been modified by constraints or\n                    // onMove handler; adjust mouse{X|Y} to match\n                    mouseX = (coordX - graph.range[0][0]) * graph.scale[0];\n                    mouseY = (-coordY + graph.range[1][1]) * graph.scale[1];\n\n                    if (doMove) {\n                        const point = graph.unscalePoint([mouseX, mouseY]);\n                        movablePoint.visibleShape.moveTo(point);\n                        movablePoint.mouseTarget.moveTo(point);\n                        movablePoint.coord = [coordX, coordY];\n                        movablePoint.updateLineEnds();\n                        $(movablePoint).trigger(\"move\");\n                    }\n\n                    movablePoint.drawLabel();\n                } else if (event.type === \"vmouseup\") {\n                    $(document).unbind(\".point\");\n                    movablePoint.dragging = false;\n                    dragging = false;\n                    if (_.isFunction(movablePoint.onMoveEnd)) {\n                        const result = movablePoint.onMoveEnd(coordX, coordY);\n                        if (_.isArray(result)) {\n                            coordX = result[0];\n                            coordY = result[1];\n                            mouseX =\n                                (coordX - graph.range[0][0]) * graph.scale[0];\n                            mouseY =\n                                (-coordY + graph.range[1][1]) * graph.scale[1];\n                            const point = graph.unscalePoint([mouseX, mouseY]);\n                            movablePoint.visibleShape.moveTo(point);\n                            movablePoint.mouseTarget.moveTo(point);\n                            movablePoint.coord = [coordX, coordY];\n                        }\n                    }\n                    if (!movablePoint.highlight) {\n                        movablePoint.visibleShape.animate(\n                            movablePoint.normalStyle,\n                            50\n                        );\n                        if (movablePoint.onUnhighlight) {\n                            movablePoint.onUnhighlight();\n                        }\n                    }\n                }\n            });\n        };\n\n        if (movablePoint.visible && !movablePoint.constraints.fixed) {\n            // the invisible shape in front of the point that gets mouse events\n            if (!movablePoint.mouseTarget) {\n                const radii = graph.unscaleVector(16);\n                const options = {\n                    mouselayer: true,\n                    padding: 0,\n                    disableMouseEventsOnWrapper: true,\n                };\n                movablePoint.mouseTarget = new WrappedEllipse(\n                    graph,\n                    movablePoint.coord,\n                    radii,\n                    options\n                );\n                movablePoint.mouseTarget.attr({fill: \"#000\", opacity: 0.0});\n            }\n\n            const $mouseTarget = $(movablePoint.mouseTarget.getMouseTarget());\n            $mouseTarget.css(\"cursor\", \"move\");\n            $mouseTarget.bind(\"vmousedown vmouseover vmouseout\", function(event) {\n                if (event.type === \"vmouseover\") {\n                    movablePoint.highlight = true;\n                    if (!dragging) {\n                        movablePoint.visibleShape.animate(\n                            movablePoint.highlightStyle,\n                            50\n                        );\n                        if (movablePoint.onHighlight) {\n                            movablePoint.onHighlight();\n                        }\n                    }\n                } else if (event.type === \"vmouseout\") {\n                    movablePoint.highlight = false;\n                    if (!movablePoint.dragging && !dragging) {\n                        movablePoint.visibleShape.animate(\n                            movablePoint.normalStyle,\n                            50\n                        );\n                        if (movablePoint.onUnhighlight) {\n                            movablePoint.onUnhighlight();\n                        }\n                    }\n                } else if (\n                    event.type === \"vmousedown\" &&\n                    (event.which === 1 || event.which === 0)\n                ) {\n                    event.preventDefault();\n\n                    // The offset between the cursor or finger and the initial\n                    // coordinates of the point. This is tracked so as to avoid\n                    // locking the moving point to the user's finger on touch\n                    // devices, which would obscure it, no matter how large we\n                    // made the touch target. Instead, we respect the offset at\n                    // which the point was grabbed for the entirety of the\n                    // gesture, if it's a touch-based interaction.\n                    const startCoord = movablePoint.coord;\n                    const startMouseCoord = graph.getMouseCoord(event);\n                    const isMouse = !(\"ontouchstart\" in window);\n                    const touchOffset = isMouse\n                        ? [0, 0]\n                        : kvector.subtract(startCoord, startMouseCoord);\n\n                    movablePoint.grab(touchOffset);\n                }\n            });\n        }\n\n        // Method to let the caller animate the point to a new position.\n        // Useful as part of a hint to show the user the correct place\n        // to put the point.\n        movablePoint.moveTo = function(coordX, coordY, updateLines) {\n            const distance = GraphUtils.getDistance(\n                this.graph.scalePoint([coordX, coordY]),\n                this.graph.scalePoint(this.coord)\n            );\n\n            const time = distance * 5;\n\n            const cb =\n                updateLines &&\n                function(coord) {\n                    movablePoint.coord = coord;\n                    movablePoint.updateLineEnds();\n                };\n            this.visibleShape.animateTo([coordX, coordY], time, cb);\n            this.mouseTarget.animateTo([coordX, coordY], time, cb);\n            this.coord = [coordX, coordY];\n            if (_.isFunction(this.onMove)) {\n                this.onMove(coordX, coordY);\n            }\n        };\n\n        // After moving the point, call this to update all line segments\n        // terminating at the point\n        movablePoint.updateLineEnds = function() {\n            $(this.lineStarts).each(function() {\n                this.coordA = movablePoint.coord;\n                this.transform();\n            });\n            $(this.lineEnds).each(function() {\n                this.coordZ = movablePoint.coord;\n                this.transform();\n            });\n            $(this.polygonVertices).each(function() {\n                this.transform();\n            });\n        };\n\n        // Put the point at a new position without any checks, animation,\n        // or callbacks\n        movablePoint.setCoord = function(coord) {\n            if (this.visible) {\n                this.visibleShape.moveTo(coord);\n                if (this.mouseTarget != null) {\n                    this.mouseTarget.moveTo(coord);\n                }\n            }\n            this.coord = coord.slice();\n        };\n\n        // Put the point at the new position, checking that it is\n        // within the graph's bounds\n        movablePoint.setCoordConstrained = function(coord) {\n            this.setCoord(applySnapAndConstraints(coord));\n        };\n\n        // Change z-order to back\n        movablePoint.toBack = function() {\n            if (this.visible) {\n                if (this.mouseTarget != null) {\n                    this.mouseTarget.toBack();\n                }\n                this.visibleShape.toBack();\n            }\n        };\n\n        // Change z-order to front\n        movablePoint.toFront = function() {\n            if (this.visible) {\n                if (this.mouseTarget != null) {\n                    this.mouseTarget.toFront();\n                }\n                this.visibleShape.toFront();\n            }\n        };\n\n        movablePoint.remove = function() {\n            if (this.visibleShape) {\n                this.visibleShape.remove();\n            }\n            if (this.mouseTarget) {\n                this.mouseTarget.remove();\n            }\n            if (this.labeledVertex) {\n                this.labeledVertex.remove();\n            }\n        };\n\n        return movablePoint;\n    },\n\n    // MovableLineSegment is a line segment that can be dragged around the\n    // screen. By attaching a smartPoint to each (or one) end, the ends can be\n    // manipulated individually.\n    //\n    // To use with smartPoints, add the smartPoints first, then:\n    //   addMovableLineSegment({ pointA: smartPoint1, pointZ: smartPoint2 });\n    // Or just one end:\n    //   addMovableLineSegment({ pointA: smartPoint, coordZ: [0, 0] });\n    //\n    // Include \"fixed: true\" in the options if you don't want the entire line\n    // to be draggable (you can still use points to make the endpoints\n    // draggable)\n    //\n    // The returned object includes the following properties/methods:\n    //\n    //   - lineSegment.coordA / lineSegment.coordZ\n    //         The coordinates of each end of the line segment\n    //\n    //   - lineSegment.transform(syncToPoints)\n    //         Repositions the line segment. Call after changing coordA\n    //         and/or coordZ, or pass syncToPoints = true to use the current\n    //         position of the corresponding smartPoints, if the segment was\n    //         defined using smartPoints\n    //\n    addMovableLineSegment: function(options) {\n        const lineSegment = $.extend(\n            {\n                graph: this,\n                coordA: [0, 0],\n                coordZ: [1, 1],\n                snapX: 0,\n                snapY: 0,\n                fixed: false,\n                ticks: 0,\n                normalStyle: {},\n                highlightStyle: {\n                    stroke: KhanColors.INTERACTING,\n                    \"stroke-width\": 6,\n                },\n                labelStyle: {\n                    stroke: KhanColors.INTERACTIVE,\n                    color: KhanColors.INTERACTIVE,\n                },\n                highlight: false,\n                dragging: false,\n                tick: [],\n                extendLine: false,\n                extendRay: false,\n                constraints: {\n                    fixed: false,\n                    constrainX: false,\n                    constrainY: false,\n                },\n                sideLabel: \"\",\n                vertexLabels: [],\n                numArrows: 0,\n                numTicks: 0,\n                movePointsWithLine: false,\n            },\n            options\n        );\n\n        const normalColor = lineSegment.fixed\n            ? KhanColors.DYNAMIC\n            : KhanColors.INTERACTIVE;\n        lineSegment.normalStyle = _.extend(\n            {},\n            {\n                \"stroke-width\": 2,\n                stroke: normalColor,\n            },\n            options.normalStyle\n        );\n        // arrowStyle should be kept in sync with styling of the line\n        lineSegment.arrowStyle = _.extend({}, lineSegment.normalStyle, {\n            color: lineSegment.normalStyle.stroke,\n        });\n\n        // If the line segment is defined by movablePoints, coordA/coordZ are\n        // owned by the points, otherwise they're owned by us\n        if (options.pointA !== undefined) {\n            lineSegment.coordA = options.pointA.coord;\n            lineSegment.pointA.lineStarts.push(lineSegment);\n        } else if (options.coordA !== undefined) {\n            lineSegment.coordA = options.coordA.slice();\n        }\n\n        if (options.pointZ !== undefined) {\n            lineSegment.coordZ = options.pointZ.coord;\n            lineSegment.pointZ.lineEnds.push(lineSegment);\n        } else if (options.coordA !== undefined) {\n            lineSegment.coordA = lineSegment.coordA.slice();\n        }\n\n        const graph = lineSegment.graph;\n\n        graph.style(lineSegment.normalStyle);\n        for (let i = 0; i < lineSegment.ticks; ++i) {\n            lineSegment.tick[i] = InteractiveUtils.bogusShape;\n        }\n        // TODO(kevinb) figure out why path isn't being used\n        /* eslint-disable */\n        let path = GraphUtils.unscaledSvgPath([[0, 0], [1, 0]]);\n        for (let i = 0; i < lineSegment.ticks; ++i) {\n            const tickoffset =\n                0.5 - (lineSegment.ticks - 1 + i * 2) / graph.scale[0];\n            path += GraphUtils.unscaledSvgPath([\n                [tickoffset, -7],\n                [tickoffset, 7],\n            ]);\n        }\n        /* eslint-enable */\n\n        options = {\n            thickness: Math.max(\n                lineSegment.normalStyle[\"stroke-width\"],\n                lineSegment.highlightStyle[\"stroke-width\"]\n            ),\n        };\n        lineSegment.visibleLine = new WrappedLine(\n            graph,\n            [0, 0],\n            [1, 0],\n            options\n        );\n        lineSegment.visibleLine.attr(lineSegment.normalStyle);\n\n        // Add mouse target\n        if (!lineSegment.fixed) {\n            const options = {\n                thickness: 30,\n                mouselayer: true,\n            };\n            lineSegment.mouseTarget = new WrappedLine(\n                graph,\n                [0, 0],\n                [1, 0],\n                options\n            );\n            lineSegment.mouseTarget.attr({fill: \"#000\", opacity: 0.0});\n        }\n\n        // Reposition the line segment. Call after changing coordA and/or\n        // coordZ, or pass syncToPoints = true to use the current position of\n        // the corresponding movablePoints, if the segment was defined using\n        // movablePoints\n        lineSegment.transform = function(syncToPoints) {\n            if (syncToPoints) {\n                if (typeof this.pointA === \"object\") {\n                    this.coordA = this.pointA.coord;\n                }\n                if (typeof this.pointZ === \"object\") {\n                    this.coordZ = this.pointZ.coord;\n                }\n            }\n\n            const getScaledAngle = function(line) {\n                const scaledA = line.graph.scalePoint(line.coordA);\n                const scaledZ = line.graph.scalePoint(line.coordZ);\n                return kvector.polarDegFromCart(\n                    kvector.subtract(scaledZ, scaledA)\n                )[1];\n            };\n\n            const getClipPoint = function(graph, coord, angle) {\n                graph = lineSegment.graph;\n                const xExtent = graph.range[0][1] - graph.range[0][0];\n                const yExtent = graph.range[1][1] - graph.range[1][0];\n\n                const distance = xExtent + yExtent;\n                const angleVec = graph.unscaleVector(\n                    kvector.cartFromPolarDeg([1, angle])\n                );\n                const distVec = kvector.scale(\n                    kvector.normalize(angleVec),\n                    distance\n                );\n                const farCoord = kvector.add(coord, distVec);\n                const scaledAngle = kvector.polarDegFromCart(angleVec)[1];\n                const clipPoint = graph.constrainToBoundsOnAngle(\n                    farCoord,\n                    4,\n                    scaledAngle * Math.PI / 180\n                );\n                return clipPoint;\n            };\n\n            const angle = getScaledAngle(this);\n            let start = this.coordA;\n            let end = this.coordZ;\n\n            // Extend start, end if necessary (i.e., if not a line segment)\n            if (this.extendLine) {\n                start = getClipPoint(graph, start, 360 - angle);\n                end = getClipPoint(graph, end, (540 - angle) % 360);\n            } else if (this.extendRay) {\n                end = getClipPoint(graph, start, 360 - angle);\n            }\n\n            const elements = [this.visibleLine];\n            if (!this.fixed) {\n                elements.push(this.mouseTarget);\n            }\n            _.each(elements, function(element) {\n                element.moveTo(start, end);\n            });\n\n            const createArrow = function(graph, style) {\n                const center = [0.75, 0];\n                let points = [\n                    [-3, 4],\n                    [-2.75, 2.5],\n                    [0, 0.25],\n                    center,\n                    [0, -0.25],\n                    [-2.75, -2.5],\n                    [-3, -4],\n                ];\n\n                const scale = 1.4;\n                points = _.map(points, function(point) {\n                    const pv = kvector.subtract(point, center);\n                    const pvScaled = kvector.scale(pv, scale);\n                    return kvector.add(center, pvScaled);\n                });\n\n                const createCubicPath = function(points) {\n                    let path = \"M\" + points[0][0] + \" \" + points[0][1];\n                    for (let i = 1; i < points.length; i += 3) {\n                        path +=\n                            \"C\" +\n                            points[i][0] +\n                            \" \" +\n                            points[i][1] +\n                            \" \" +\n                            points[i + 1][0] +\n                            \" \" +\n                            points[i + 1][1] +\n                            \" \" +\n                            points[i + 2][0] +\n                            \" \" +\n                            points[i + 2][1];\n                    }\n                    return path;\n                };\n\n                const unscaledPoints = _.map(points, graph.unscalePoint);\n                const options = {\n                    center: graph.unscalePoint(center),\n                    createPath: createCubicPath,\n                };\n                const arrowHead = new WrappedPath(\n                    graph,\n                    unscaledPoints,\n                    options\n                );\n                arrowHead.attr(\n                    _.extend(\n                        {\n                            \"stroke-linejoin\": \"round\",\n                            \"stroke-linecap\": \"round\",\n                            \"stroke-dasharray\": \"\",\n                        },\n                        style\n                    )\n                );\n\n                // Add custom function for transforming arrowheads that\n                // accounts for center, scaling, etc.\n                arrowHead.toCoordAtAngle = function(coord, angle) {\n                    const clipPoint = graph.scalePoint(\n                        getClipPoint(graph, coord, angle)\n                    );\n                    const do3dTransform = getCanUse3dTransform();\n                    arrowHead.transform(\n                        \"translateX(\" +\n                            (clipPoint[0] + scale * center[0]) +\n                            \"px) \" +\n                            \"translateY(\" +\n                            (clipPoint[1] + scale * center[1]) +\n                            \"px) \" +\n                            (do3dTransform ? \"translateZ(0) \" : \"\") +\n                            \"rotate(\" +\n                            (360 - KhanMath.bound(angle)) +\n                            \"deg)\"\n                    );\n                };\n\n                return arrowHead;\n            };\n\n            // Add arrows\n            if (this._arrows == null) {\n                this._arrows = [];\n\n                if (this.extendLine) {\n                    this._arrows.push(createArrow(graph, this.normalStyle));\n                    this._arrows.push(createArrow(graph, this.normalStyle));\n                } else if (this.extendRay) {\n                    this._arrows.push(createArrow(graph, this.normalStyle));\n                }\n            }\n\n            const coordForArrow = [this.coordA, this.coordZ];\n            const angleForArrow = [360 - angle, (540 - angle) % 360];\n            _.each(this._arrows, function(arrow, i) {\n                arrow.toCoordAtAngle(coordForArrow[i], angleForArrow[i]);\n            });\n\n            // Temporary objects: array of SVG nodes that get recreated on drag\n            _.invoke(this.temp, \"remove\");\n            this.temp = [];\n\n            const isClockwise =\n                this.coordA[0] < this.coordZ[0] ||\n                (this.coordA[0] === this.coordZ[0] &&\n                    this.coordA[1] > this.coordZ[1]);\n\n            // Update side label\n            if (this.sideLabel) {\n                this.temp.push(\n                    this.graph.labelSide({\n                        point1: this.coordA,\n                        point2: this.coordZ,\n                        label: this.labeledSide,\n                        text: this.sideLabel,\n                        numArrows: this.numArrows,\n                        numTicks: this.numTicks,\n                        clockwise: isClockwise,\n                        style: this.labelStyle,\n                    })\n                );\n            }\n\n            // Update vertex labels\n            if (this.vertexLabels.length) {\n                this.graph.labelVertex({\n                    vertex: this.coordA,\n                    point3: this.coordZ,\n                    label: this.labeledVertices[0],\n                    text: this.vertexLabels[0],\n                    clockwise: isClockwise,\n                    style: this.labelStyle,\n                });\n\n                this.graph.labelVertex({\n                    point1: this.coordA,\n                    vertex: this.coordZ,\n                    label: this.labeledVertices[1],\n                    text: this.vertexLabels[1],\n                    clockwise: isClockwise,\n                    style: this.labelStyle,\n                });\n            }\n\n            this.temp = _.flatten(this.temp);\n        };\n\n        // Change z-order to back;\n        lineSegment.toBack = function() {\n            if (!lineSegment.fixed) {\n                lineSegment.mouseTarget.toBack();\n            }\n            lineSegment.visibleLine.toBack();\n        };\n\n        // Change z-order to front\n        lineSegment.toFront = function() {\n            if (!lineSegment.fixed) {\n                lineSegment.mouseTarget.toFront();\n            }\n            lineSegment.visibleLine.toFront();\n        };\n\n        lineSegment.remove = function() {\n            if (!lineSegment.fixed) {\n                lineSegment.mouseTarget.remove();\n            }\n            lineSegment.visibleLine.remove();\n            if (lineSegment.labeledSide) {\n                lineSegment.labeledSide.remove();\n            }\n            if (lineSegment.labeledVertices) {\n                _.invoke(lineSegment.labeledVertices, \"remove\");\n            }\n            if (lineSegment._arrows) {\n                _.invoke(lineSegment._arrows, \"remove\");\n            }\n            if (lineSegment.temp.length) {\n                _.invoke(lineSegment.temp, \"remove\");\n            }\n        };\n\n        lineSegment.hide = function() {\n            lineSegment.visibleLine.hide();\n            if (lineSegment.temp.length) {\n                _.invoke(lineSegment.temp, \"hide\");\n            }\n            if (lineSegment._arrows) {\n                _.invoke(lineSegment._arrows, \"hide\");\n            }\n        };\n\n        lineSegment.show = function() {\n            lineSegment.visibleLine.show();\n            if (lineSegment.temp.length) {\n                _.invoke(lineSegment.temp, \"show\");\n            }\n            if (lineSegment._arrows) {\n                _.invoke(lineSegment._arrows, \"show\");\n            }\n        };\n\n        if (lineSegment.sideLabel) {\n            lineSegment.labeledSide = this.label(\n                [0, 0],\n                \"\",\n                \"center\",\n                lineSegment.labelStyle\n            );\n        }\n\n        if (lineSegment.vertexLabels.length) {\n            lineSegment.labeledVertices = _.map(\n                lineSegment.vertexLabels,\n                function(label) {\n                    return this.label(\n                        [0, 0],\n                        \"\",\n                        \"center\",\n                        lineSegment.labelStyle\n                    );\n                },\n                this\n            );\n        }\n\n        if (!lineSegment.fixed && !lineSegment.constraints.fixed) {\n            const $mouseTarget = $(lineSegment.mouseTarget.getMouseTarget());\n            $mouseTarget.css(\"cursor\", \"move\");\n            $mouseTarget.bind(\"vmousedown vmouseover vmouseout\", function(event) {\n                if (event.type === \"vmouseover\") {\n                    if (!dragging) {\n                        lineSegment.highlight = true;\n                        lineSegment.visibleLine.animate(\n                            lineSegment.highlightStyle,\n                            50\n                        );\n                        lineSegment.arrowStyle = _.extend(\n                            {},\n                            lineSegment.arrowStyle,\n                            {\n                                color: lineSegment.highlightStyle.stroke,\n                                stroke: lineSegment.highlightStyle.stroke,\n                            }\n                        );\n                        lineSegment.transform();\n                    }\n                } else if (event.type === \"vmouseout\") {\n                    lineSegment.highlight = false;\n                    if (!lineSegment.dragging) {\n                        lineSegment.visibleLine.animate(\n                            lineSegment.normalStyle,\n                            50\n                        );\n                        lineSegment.arrowStyle = _.extend(\n                            {},\n                            lineSegment.arrowStyle,\n                            {\n                                color: lineSegment.normalStyle.stroke,\n                                stroke: lineSegment.normalStyle.stroke,\n                            }\n                        );\n                        lineSegment.transform();\n                    }\n                } else if (\n                    event.type === \"vmousedown\" &&\n                    (event.which === 1 || event.which === 0)\n                ) {\n                    event.preventDefault();\n                    let coordX =\n                        (event.pageX -\n                            $(graph.raphael.canvas.parentNode).offset().left) /\n                            graph.scale[0] +\n                        graph.range[0][0];\n                    let coordY =\n                        graph.range[1][1] -\n                        (event.pageY -\n                            $(graph.raphael.canvas.parentNode).offset().top) /\n                            graph.scale[1];\n                    if (lineSegment.snapX > 0) {\n                        coordX =\n                            Math.round(coordX / lineSegment.snapX) *\n                            lineSegment.snapX;\n                    }\n                    if (lineSegment.snapY > 0) {\n                        coordY =\n                            Math.round(coordY / lineSegment.snapY) *\n                            lineSegment.snapY;\n                    }\n                    const mouseOffsetA = [\n                        lineSegment.coordA[0] - coordX,\n                        lineSegment.coordA[1] - coordY,\n                    ];\n                    const mouseOffsetZ = [\n                        lineSegment.coordZ[0] - coordX,\n                        lineSegment.coordZ[1] - coordY,\n                    ];\n\n                    const offsetLeft = -Math.min(\n                        graph.scaleVector(mouseOffsetA)[0],\n                        graph.scaleVector(mouseOffsetZ)[0]\n                    );\n                    const offsetRight = Math.max(\n                        graph.scaleVector(mouseOffsetA)[0],\n                        graph.scaleVector(mouseOffsetZ)[0]\n                    );\n                    const offsetTop = Math.max(\n                        graph.scaleVector(mouseOffsetA)[1],\n                        graph.scaleVector(mouseOffsetZ)[1]\n                    );\n                    const offsetBottom = -Math.min(\n                        graph.scaleVector(mouseOffsetA)[1],\n                        graph.scaleVector(mouseOffsetZ)[1]\n                    );\n\n                    $(\n                        document\n                    ).bind(\n                        \"vmousemove.lineSegment vmouseup.lineSegment\",\n                        function(event) {\n                            event.preventDefault();\n                            lineSegment.dragging = true;\n                            dragging = true;\n\n                            let mouseX =\n                                event.pageX -\n                                $(graph.raphael.canvas.parentNode).offset()\n                                    .left;\n                            let mouseY =\n                                event.pageY -\n                                $(graph.raphael.canvas.parentNode).offset().top;\n                            // no part of the line segment can go beyond 10\n                            // pixels from the edge\n                            mouseX = Math.max(\n                                offsetLeft + 10,\n                                Math.min(\n                                    graph.xpixels - 10 - offsetRight,\n                                    mouseX\n                                )\n                            );\n                            mouseY = Math.max(\n                                offsetTop + 10,\n                                Math.min(\n                                    graph.ypixels - 10 - offsetBottom,\n                                    mouseY\n                                )\n                            );\n\n                            let coordX =\n                                mouseX / graph.scale[0] + graph.range[0][0];\n                            let coordY =\n                                graph.range[1][1] - mouseY / graph.scale[1];\n                            if (lineSegment.snapX > 0) {\n                                coordX =\n                                    Math.round(coordX / lineSegment.snapX) *\n                                    lineSegment.snapX;\n                            }\n                            if (lineSegment.snapY > 0) {\n                                coordY =\n                                    Math.round(coordY / lineSegment.snapY) *\n                                    lineSegment.snapY;\n                            }\n\n                            if (event.type === \"vmousemove\") {\n                                if (lineSegment.constraints.constrainX) {\n                                    coordX =\n                                        lineSegment.coordA[0] - mouseOffsetA[0];\n                                }\n                                if (lineSegment.constraints.constrainY) {\n                                    coordY =\n                                        lineSegment.coordA[1] - mouseOffsetA[1];\n                                }\n                                const dX =\n                                    coordX +\n                                    mouseOffsetA[0] -\n                                    lineSegment.coordA[0];\n                                const dY =\n                                    coordY +\n                                    mouseOffsetA[1] -\n                                    lineSegment.coordA[1];\n                                lineSegment.coordA = [\n                                    coordX + mouseOffsetA[0],\n                                    coordY + mouseOffsetA[1],\n                                ];\n                                lineSegment.coordZ = [\n                                    coordX + mouseOffsetZ[0],\n                                    coordY + mouseOffsetZ[1],\n                                ];\n                                lineSegment.transform();\n\n                                if (lineSegment.movePointsWithLine) {\n                                    // If the points are movablePoints, adjust\n                                    // their coordinates when the line itself is\n                                    // dragged\n                                    if (\n                                        typeof lineSegment.pointA === \"object\"\n                                    ) {\n                                        lineSegment.pointA.setCoord([\n                                            lineSegment.pointA.coord[0] + dX,\n                                            lineSegment.pointA.coord[1] + dY,\n                                        ]);\n                                    }\n                                    if (\n                                        typeof lineSegment.pointZ === \"object\"\n                                    ) {\n                                        lineSegment.pointZ.setCoord([\n                                            lineSegment.pointZ.coord[0] + dX,\n                                            lineSegment.pointZ.coord[1] + dY,\n                                        ]);\n                                    }\n                                }\n\n                                if (_.isFunction(lineSegment.onMove)) {\n                                    lineSegment.onMove(dX, dY);\n                                }\n                            } else if (event.type === \"vmouseup\") {\n                                $(document).unbind(\".lineSegment\");\n                                lineSegment.dragging = false;\n                                dragging = false;\n                                if (!lineSegment.highlight) {\n                                    lineSegment.visibleLine.animate(\n                                        lineSegment.normalStyle,\n                                        50\n                                    );\n                                    lineSegment.arrowStyle = _.extend(\n                                        {},\n                                        lineSegment.arrowStyle,\n                                        {\n                                            color:\n                                                lineSegment.normalStyle.stroke,\n                                            stroke:\n                                                lineSegment.normalStyle.stroke,\n                                        }\n                                    );\n                                    lineSegment.transform();\n                                }\n                                if (_.isFunction(lineSegment.onMoveEnd)) {\n                                    lineSegment.onMoveEnd();\n                                }\n                            }\n\n                            $(lineSegment).trigger(\"move\");\n                        }\n                    );\n                }\n            });\n        }\n\n        if (lineSegment.pointA !== undefined) {\n            lineSegment.pointA.toFront();\n        }\n        if (lineSegment.pointZ !== undefined) {\n            lineSegment.pointZ.toFront();\n        }\n        lineSegment.transform();\n        return lineSegment;\n    },\n\n    // MovablePolygon is a polygon that can be dragged around the screen.\n    // By attaching a smartPoint to each vertex, the points can be\n    // manipulated individually.\n    //\n    // To use with smartPoints, add the smartPoints first, then:\n    //   addMovablePolygon({points: [...]});\n    //\n    // Include \"fixed: true\" in the options if you don't want the entire\n    // polygon to be draggable (you can still use points to make the\n    // vertices draggable)\n    //\n    // The returned object includes the following properties/methods:\n    //\n    //   - polygon.points\n    //         The polygon's dynamic smartPoints and static coordinates, mixed.\n    //\n    //   - polygon.coords\n    //         The polygon's current coordinates (generated, don't edit).\n    //\n    //   - polygon.transform()\n    //         Repositions the polygon. Call after changing any points.\n    //\n    addMovablePolygon: function(options) {\n        const graphie = this;\n\n        const polygon = $.extend(\n            {\n                snapX: 0,\n                snapY: 0,\n                fixed: false,\n                constrainToGraph: true,\n                normalStyle: {},\n                highlightStyle: {\n                    stroke: KhanColors.INTERACTING,\n                    \"stroke-width\": 2,\n                    fill: KhanColors.INTERACTING,\n                    \"fill-opacity\": 0.05,\n                },\n                pointHighlightStyle: {\n                    fill: KhanColors.INTERACTING,\n                    stroke: KhanColors.INTERACTING,\n                },\n                labelStyle: {\n                    stroke: KhanColors.DYNAMIC,\n                    \"stroke-width\": 1,\n                    color: KhanColors.DYNAMIC,\n                },\n                angleLabels: [],\n                showRightAngleMarkers: [],\n                sideLabels: [],\n                vertexLabels: [],\n                numArcs: [],\n                numArrows: [],\n                numTicks: [],\n                updateOnPointMove: true,\n                closed: true,\n            },\n            _.omit(options, \"points\")\n        );\n\n        const normalColor = polygon.fixed\n            ? KhanColors.DYNAMIC\n            : KhanColors.INTERACTIVE;\n        polygon.normalStyle = _.extend(\n            {\n                \"stroke-width\": 2,\n                \"fill-opacity\": 0,\n                fill: normalColor,\n                stroke: normalColor,\n            },\n            options.normalStyle\n        );\n\n        // don't deep copy the points array with $.extend;\n        // we may want to append to it later for click-to-add-points\n        polygon.points = options.points;\n\n        const isPoint = function(coordOrPoint) {\n            return !_.isArray(coordOrPoint);\n        };\n\n        polygon.update = function() {\n            const n = polygon.points.length;\n\n            // Update coords\n            polygon.coords = _.map(polygon.points, function(coordOrPoint, i) {\n                if (isPoint(coordOrPoint)) {\n                    return coordOrPoint.coord;\n                } else {\n                    return coordOrPoint;\n                }\n            });\n\n            // Calculate bounding box\n            polygon.left = _.min(_.pluck(polygon.coords, 0));\n            polygon.right = _.max(_.pluck(polygon.coords, 0));\n            polygon.top = _.max(_.pluck(polygon.coords, 1));\n            polygon.bottom = _.min(_.pluck(polygon.coords, 1));\n\n            let scaledCoords = _.map(polygon.coords, function(coord) {\n                return graphie.scalePoint(coord);\n            });\n\n            // Create path\n            if (polygon.closed) {\n                scaledCoords.push(true);\n            } else {\n                // For open polygons, concatenate a reverse of the path,\n                // to remove the inside area of the path, which would\n                // otherwise be clickable (even if the closing line segment\n                // wasn't drawn\n                scaledCoords = scaledCoords.concat(\n                    _.clone(scaledCoords).reverse()\n                );\n            }\n            polygon.path = GraphUtils.unscaledSvgPath(scaledCoords);\n\n            // Temporary objects\n            _.invoke(polygon.temp, \"remove\");\n            polygon.temp = [];\n\n            const isClockwise = clockwise(polygon.coords);\n\n            // Update angle labels\n            if (\n                polygon.angleLabels.length ||\n                polygon.showRightAngleMarkers.length\n            ) {\n                _.each(polygon.labeledAngles, function(label, i) {\n                    polygon.temp.push(\n                        graphie.labelAngle({\n                            point1: polygon.coords[(i - 1 + n) % n],\n                            vertex: polygon.coords[i],\n                            point3: polygon.coords[(i + 1) % n],\n                            label: label,\n                            text: polygon.angleLabels[i],\n                            showRightAngleMarker:\n                                polygon.showRightAngleMarkers[i],\n                            numArcs: polygon.numArcs[i],\n                            clockwise: isClockwise,\n                            style: polygon.labelStyle,\n                        })\n                    );\n                });\n            }\n\n            // Update side labels\n            if (polygon.sideLabels.length) {\n                _.each(polygon.labeledSides, function(label, i) {\n                    polygon.temp.push(\n                        graphie.labelSide({\n                            point1: polygon.coords[i],\n                            point2: polygon.coords[(i + 1) % n],\n                            label: label,\n                            text: polygon.sideLabels[i],\n                            numArrows: polygon.numArrows[i],\n                            numTicks: polygon.numTicks[i],\n                            clockwise: isClockwise,\n                            style: polygon.labelStyle,\n                        })\n                    );\n                });\n            }\n\n            // Update vertex labels\n            if (polygon.vertexLabels.length) {\n                _.each(polygon.labeledVertices, function(label, i) {\n                    graphie.labelVertex({\n                        point1: polygon.coords[(i - 1 + n) % n],\n                        vertex: polygon.coords[i],\n                        point3: polygon.coords[(i + 1) % n],\n                        label: label,\n                        text: polygon.vertexLabels[i],\n                        clockwise: isClockwise,\n                        style: polygon.labelStyle,\n                    });\n                });\n            }\n\n            polygon.temp = _.flatten(polygon.temp);\n        };\n\n        polygon.transform = function() {\n            polygon.update();\n\n            polygon.visibleShape.attr({path: polygon.path});\n\n            if (!polygon.fixed) {\n                polygon.mouseTarget.attr({path: polygon.path});\n            }\n        };\n\n        polygon.remove = function() {\n            polygon.visibleShape.remove();\n\n            if (!polygon.fixed) {\n                polygon.mouseTarget.remove();\n            }\n\n            if (polygon.labeledAngles) {\n                _.invoke(polygon.labeledAngles, \"remove\");\n            }\n\n            if (polygon.labeledSides) {\n                _.invoke(polygon.labeledSides, \"remove\");\n            }\n\n            if (polygon.labeledVertices) {\n                _.invoke(polygon.labeledVertices, \"remove\");\n            }\n\n            if (polygon.temp.length) {\n                _.invoke(polygon.temp, \"remove\");\n            }\n        };\n\n        polygon.toBack = function() {\n            if (!polygon.fixed) {\n                polygon.mouseTarget.toBack();\n            }\n\n            polygon.visibleShape.toBack();\n        };\n\n        polygon.toFront = function() {\n            if (!polygon.fixed) {\n                polygon.mouseTarget.toFront();\n            }\n\n            polygon.visibleShape.toFront();\n        };\n\n        // Setup\n\n        if (polygon.updateOnPointMove) {\n            _.each(_.filter(polygon.points, isPoint), function(coordOrPoint) {\n                coordOrPoint.polygonVertices.push(polygon);\n            });\n        }\n\n        polygon.coords = new Array(polygon.points.length);\n\n        if (polygon.angleLabels.length) {\n            const numLabels = Math.max(\n                polygon.angleLabels.length,\n                polygon.showRightAngleMarkers.length\n            );\n            polygon.labeledAngles = _.times(\n                numLabels,\n                function() {\n                    return this.label([0, 0], \"\", \"center\", polygon.labelStyle);\n                },\n                this\n            );\n        }\n\n        if (polygon.sideLabels.length) {\n            polygon.labeledSides = _.map(\n                polygon.sideLabels,\n                function(label) {\n                    return this.label([0, 0], \"\", \"center\", polygon.labelStyle);\n                },\n                this\n            );\n        }\n\n        if (polygon.vertexLabels.length) {\n            polygon.labeledVertices = _.map(\n                polygon.vertexLabels,\n                function(label) {\n                    return this.label([0, 0], \"\", \"center\", polygon.labelStyle);\n                },\n                this\n            );\n        }\n\n        polygon.update();\n\n        polygon.visibleShape = graphie.raphael.path(polygon.path);\n        polygon.visibleShape.attr(polygon.normalStyle);\n\n        if (!polygon.fixed) {\n            polygon.mouseTarget = graphie.mouselayer.path(polygon.path);\n            polygon.mouseTarget.attr({\n                fill: \"#000\",\n                opacity: 0,\n                cursor: \"move\",\n            });\n\n            $(\n                polygon.mouseTarget[0]\n            ).bind(\"vmousedown vmouseover vmouseout\", function(event) {\n                if (event.type === \"vmouseover\") {\n                    if (!dragging || polygon.dragging) {\n                        polygon.highlight = true;\n                        polygon.visibleShape.animate(\n                            polygon.highlightStyle,\n                            50\n                        );\n                        _.each(_.filter(polygon.points, isPoint), function(point) {\n                            point.visibleShape.animate(\n                                polygon.pointHighlightStyle,\n                                50\n                            );\n                        });\n                    }\n                } else if (event.type === \"vmouseout\") {\n                    polygon.highlight = false;\n                    if (!polygon.dragging) {\n                        polygon.visibleShape.animate(polygon.normalStyle, 50);\n                        const points = _.filter(polygon.points, isPoint);\n                        if (!_.any(_.pluck(points, \"dragging\"))) {\n                            _.each(points, function(point) {\n                                point.visibleShape.animate(\n                                    point.normalStyle,\n                                    50\n                                );\n                            });\n                        }\n                    }\n                } else if (\n                    event.type === \"vmousedown\" &&\n                    (event.which === 1 || event.which === 0)\n                ) {\n                    event.preventDefault();\n\n                    _.each(_.filter(polygon.points, isPoint), function(point) {\n                        point.dragging = true;\n                    });\n\n                    let startX =\n                        (event.pageX -\n                            $(graphie.raphael.canvas.parentNode).offset()\n                                .left) /\n                            graphie.scale[0] +\n                        graphie.range[0][0];\n                    let startY =\n                        graphie.range[1][1] -\n                        (event.pageY -\n                            $(graphie.raphael.canvas.parentNode).offset().top) /\n                            graphie.scale[1];\n                    if (polygon.snapX > 0) {\n                        startX =\n                            Math.round(startX / polygon.snapX) * polygon.snapX;\n                    }\n                    if (polygon.snapY > 0) {\n                        startY =\n                            Math.round(startY / polygon.snapY) * polygon.snapY;\n                    }\n                    let lastX = startX;\n                    let lastY = startY;\n\n                    const polygonCoords = polygon.coords.slice();\n\n                    const offsetLeft =\n                        (startX - polygon.left) * graphie.scale[0];\n                    const offsetRight =\n                        (polygon.right - startX) * graphie.scale[0];\n                    const offsetTop = (polygon.top - startY) * graphie.scale[1];\n                    const offsetBottom =\n                        (startY - polygon.bottom) * graphie.scale[1];\n\n                    $(\n                        document\n                    ).bind(\"vmousemove.polygon vmouseup.polygon\", function(event) {\n                        event.preventDefault();\n\n                        polygon.dragging = true;\n                        dragging = true;\n\n                        let mouseX =\n                            event.pageX -\n                            $(graphie.raphael.canvas.parentNode).offset().left;\n                        let mouseY =\n                            event.pageY -\n                            $(graphie.raphael.canvas.parentNode).offset().top;\n\n                        // no part of the polygon can go beyond 10 pixels from\n                        // the edge\n                        if (polygon.constrainToGraph) {\n                            mouseX = Math.max(\n                                offsetLeft + 10,\n                                Math.min(\n                                    graphie.xpixels - 10 - offsetRight,\n                                    mouseX\n                                )\n                            );\n                            mouseY = Math.max(\n                                offsetTop + 10,\n                                Math.min(\n                                    graphie.ypixels - 10 - offsetBottom,\n                                    mouseY\n                                )\n                            );\n                        }\n\n                        let currentX =\n                            mouseX / graphie.scale[0] + graphie.range[0][0];\n                        let currentY =\n                            graphie.range[1][1] - mouseY / graphie.scale[1];\n                        if (polygon.snapX > 0) {\n                            currentX =\n                                Math.round(currentX / polygon.snapX) *\n                                polygon.snapX;\n                        }\n                        if (polygon.snapY > 0) {\n                            currentY =\n                                Math.round(currentY / polygon.snapY) *\n                                polygon.snapY;\n                        }\n\n                        if (event.type === \"vmousemove\") {\n                            let dX = currentX - startX;\n                            let dY = currentY - startY;\n\n                            let doMove = true;\n                            if (_.isFunction(polygon.onMove)) {\n                                const onMoveResult = polygon.onMove(dX, dY);\n                                if (onMoveResult === false) {\n                                    doMove = false;\n                                } else if (_.isArray(onMoveResult)) {\n                                    dX = onMoveResult[0];\n                                    dY = onMoveResult[1];\n                                    currentX = startX + dX;\n                                    currentY = startY + dY;\n                                }\n                            }\n\n                            const increment = function(i) {\n                                return [\n                                    polygonCoords[i][0] + dX,\n                                    polygonCoords[i][1] + dY,\n                                ];\n                            };\n\n                            if (doMove) {\n                                _.each(polygon.points, function(coordOrPoint, i) {\n                                    if (isPoint(coordOrPoint)) {\n                                        coordOrPoint.setCoord(increment(i));\n                                    } else {\n                                        polygon.points[i] = increment(i);\n                                    }\n                                });\n\n                                polygon.transform();\n\n                                $(polygon).trigger(\"move\");\n\n                                lastX = currentX;\n                                lastY = currentY;\n                            }\n                        } else if (event.type === \"vmouseup\") {\n                            $(document).unbind(\".polygon\");\n\n                            const points = _.filter(polygon.points, isPoint);\n                            _.each(points, function(point) {\n                                point.dragging = false;\n                            });\n\n                            polygon.dragging = false;\n                            dragging = false;\n                            if (!polygon.highlight) {\n                                polygon.visibleShape.animate(\n                                    polygon.normalStyle,\n                                    50\n                                );\n\n                                _.each(points, function(point) {\n                                    point.visibleShape.animate(\n                                        point.normalStyle,\n                                        50\n                                    );\n                                });\n                            }\n                            if (_.isFunction(polygon.onMoveEnd)) {\n                                polygon.onMoveEnd(\n                                    lastX - startX,\n                                    lastY - startY\n                                );\n                            }\n                        }\n                    });\n                }\n            });\n        }\n\n        // Bring any movable points to the front\n        _.invoke(_.filter(polygon.points, isPoint), \"toFront\");\n\n        return polygon;\n    },\n\n    /**\n     * Constrain a point to be within the graph (including padding).\n     * If outside graph, point's x and y coordinates are clamped within\n     * the graph.\n     */\n    constrainToBounds: function(point, padding) {\n        const lower = this.unscalePoint([padding, this.ypixels - padding]);\n        const upper = this.unscalePoint([this.xpixels - padding, padding]);\n        const coordX = Math.max(lower[0], Math.min(upper[0], point[0]));\n        const coordY = Math.max(lower[1], Math.min(upper[1], point[1]));\n        return [coordX, coordY];\n    },\n\n    /**\n     * Constrain a point to be within the graph (including padding).\n     * If outside graph, point is moved along the ray specified by angle\n     * until inside graph.\n     */\n    constrainToBoundsOnAngle: function(point, padding, angle) {\n        const lower = this.unscalePoint([padding, this.ypixels - padding]);\n        const upper = this.unscalePoint([this.xpixels - padding, padding]);\n\n        let result = point.slice();\n\n        if (result[0] < lower[0]) {\n            result = [\n                lower[0],\n                result[1] + (lower[0] - result[0]) * Math.tan(angle),\n            ];\n        } else if (result[0] > upper[0]) {\n            result = [\n                upper[0],\n                result[1] - (result[0] - upper[0]) * Math.tan(angle),\n            ];\n        }\n\n        if (result[1] < lower[1]) {\n            result = [\n                result[0] + (lower[1] - result[1]) / Math.tan(angle),\n                lower[1],\n            ];\n        } else if (result[1] > upper[1]) {\n            result = [\n                result[0] - (result[1] - upper[1]) / Math.tan(angle),\n                upper[1],\n            ];\n        }\n\n        return result;\n    },\n\n    // MovableAngle is an angle that can be dragged around the screen.\n    // By attaching a smartPoint to the vertex and ray control points, the\n    // rays can be manipulated individually.\n    //\n    // Use only with smartPoints; add the smartPoints first, then:\n    //   addMovableAngle({points: [...]});\n    //\n    // The rays can be controlled to snap on degrees (more useful than snapping\n    // on coordinates) by setting snapDegrees to a positive integer.\n    //\n    // The returned object includes the following properties/methods:\n    //\n    //   - movableAngle.points\n    //         The movableAngle's dynamic smartPoints.\n    //\n    //   - movableAngle.coords\n    //         The movableAngle's current coordinates (generated, don't edit).\n    //\n    addMovableAngle: function(options) {\n        return new MovableAngle(this, options);\n    },\n\n    // center: movable point\n    // radius: int\n    // circ: graphie circle\n    // perim: invisible mouse target for dragging/changing radius\n    addCircleGraph: function(options) {\n        const graphie = this;\n        const circle = $.extend(\n            {\n                center: [0, 0],\n                radius: 2,\n                snapX: 0.5,\n                snapY: 0.5,\n                snapRadius: 0.5,\n                minRadius: 1,\n                centerConstraints: {},\n                centerNormalStyle: {},\n                centerHighlightStyle: {\n                    stroke: KhanColors.INTERACTING,\n                    fill: KhanColors.INTERACTING,\n                },\n                circleNormalStyle: {\n                    stroke: KhanColors.INTERACTIVE,\n                    \"fill-opacity\": 0,\n                },\n                circleHighlightStyle: {\n                    stroke: KhanColors.INTERACTING,\n                    fill: KhanColors.INTERACTING,\n                    \"fill-opacity\": 0.05,\n                },\n            },\n            options\n        );\n\n        const normalColor = circle.centerConstraints.fixed\n            ? KhanColors.DYNAMIC\n            : KhanColors.INTERACTIVE;\n        const centerNormalStyle = options ? options.centerNormalStyle : null;\n        circle.centerNormalStyle = _.extend(\n            {},\n            {\n                fill: normalColor,\n                stroke: normalColor,\n            },\n            centerNormalStyle\n        );\n\n        circle.centerPoint = graphie.addMovablePoint({\n            graph: graphie,\n            coord: circle.center,\n            normalStyle: circle.centerNormalStyle,\n            snapX: circle.snapX,\n            snapY: circle.snapY,\n            constraints: circle.centerConstraints,\n        });\n        circle.circ = graphie.circle(\n            circle.center,\n            circle.radius,\n            circle.circleNormalStyle\n        );\n        circle.perim = graphie.mouselayer\n            .circle(\n                graphie.scalePoint(circle.center)[0],\n                graphie.scalePoint(circle.center)[1],\n                graphie.scaleVector(circle.radius)[0]\n            )\n            .attr({\n                \"stroke-width\": 20,\n                opacity: 0.002, // This is as close to 0 as MSIE will allow\n            });\n\n        // Highlight circle circumference on center point hover\n        if (!circle.centerConstraints.fixed) {\n            $(\n                circle.centerPoint.mouseTarget.getMouseTarget()\n            ).on(\"vmouseover vmouseout\", function(event) {\n                if (\n                    circle.centerPoint.highlight ||\n                    circle.centerPoint.dragging\n                ) {\n                    circle.circ.animate(circle.circleHighlightStyle, 50);\n                } else {\n                    circle.circ.animate(circle.circleNormalStyle, 50);\n                }\n            });\n        }\n\n        circle.toFront = function() {\n            circle.circ.toFront();\n            circle.perim.toFront();\n            circle.centerPoint.visibleShape.toFront();\n            if (!circle.centerConstraints.fixed) {\n                circle.centerPoint.mouseTarget.toFront();\n            }\n        };\n\n        circle.centerPoint.onMove = function(x, y) {\n            circle.toFront();\n            circle.circ.attr({\n                cx: graphie.scalePoint(x)[0],\n                cy: graphie.scalePoint(y)[1],\n            });\n            circle.perim.attr({\n                cx: graphie.scalePoint(x)[0],\n                cy: graphie.scalePoint(y)[1],\n            });\n            if (circle.onMove) {\n                circle.onMove(x, y);\n            }\n        };\n\n        $(circle.centerPoint).on(\"move\", function() {\n            circle.center = this.coord;\n            $(circle).trigger(\"move\");\n        });\n\n        // circle.setCenter(x, y) moves the circle to the specified\n        // x, y coordinate as if the user had dragged it there.\n        circle.setCenter = function(x, y) {\n            circle.centerPoint.setCoord([x, y]);\n            circle.centerPoint.onMove(x, y);\n            circle.center = [x, y];\n        };\n\n        // circle.setRadius(r) sets the circle's radius to the specified\n        // value as if the user had dragged it there.\n        circle.setRadius = function(r) {\n            circle.radius = r;\n\n            circle.perim.attr({\n                r: graphie.scaleVector(r)[0],\n            });\n            circle.circ.attr({\n                rx: graphie.scaleVector(r)[0],\n                ry: graphie.scaleVector(r)[1],\n            });\n        };\n\n        circle.remove = function() {\n            circle.centerPoint.remove();\n            circle.circ.remove();\n            circle.perim.remove();\n        };\n\n        // Define a set of axes using polar coordinates to specify\n        // which resizing cursor we want to show based on where the\n        // mouse position lies in relation to the circle's center.\n        // The first two columns in cursorAxes refer to the minimum\n        // and maximum angle values bounding a circle sector, and\n        // the third column refers to the cursor name that will be\n        // applied if the mouse position falls inside the given sector.\n        const cursorAxes = [\n            [Math.PI * -1.0, Math.PI * -0.875, \"ew-resize\"],\n            [Math.PI * -0.875, Math.PI * -0.625, \"nesw-resize\"],\n            [Math.PI * -0.625, Math.PI * -0.375, \"ns-resize\"],\n            [Math.PI * -0.375, Math.PI * -0.125, \"nwse-resize\"],\n            [Math.PI * -0.125, Math.PI * 0.125, \"ew-resize\"],\n            [Math.PI * 0.125, Math.PI * 0.375, \"nesw-resize\"],\n            [Math.PI * 0.375, Math.PI * 0.625, \"ns-resize\"],\n            [Math.PI * 0.625, Math.PI * 0.875, \"nwse-resize\"],\n            [Math.PI * 0.875, Math.PI * 1.0, \"ew-resize\"],\n        ];\n\n        // When the mouse moves along the circle's perimeter, we\n        // dynamically set a CSS rule to show the correct\n        // bidirectional cursor so a student knows they can resize\n        // our circle. To do this, we convert the x and y coordinates\n        // of the mouse position into polar coordinates and use the\n        // defined cursorAxes above to set our rule.\n        $(circle.perim.node).on(\"vmousemove\", event => {\n            let [x, y] = this.getMouseCoord(event);\n\n            x -= circle.center[0];\n            y -= circle.center[1];\n\n            const theta = Math.atan2(y, x);\n\n            cursorAxes.forEach(function(axes) {\n                const [min, max, cursorName] = axes;\n                if (theta >= min && theta < max) {\n                    $(circle.perim.node).css(\"cursor\", cursorName);\n                }\n            });\n        });\n\n        // Set a default resizing-friendly cursor to be safe.\n        $(circle.perim.node).css(\"cursor\", \"nesw-resize\");\n\n        // Prevent the page from scrolling when we grab and drag the circle on\n        // a mobile device.\n        circle.perim.node.addEventListener(\n            \"touchstart\",\n            function(event) {\n                event.preventDefault();\n            },\n            {passive: false}\n        );\n\n        $(circle.perim.node).on(\"vmouseover vmouseout vmousedown\", function(event) {\n            if (event.type === \"vmouseover\") {\n                circle.highlight = true;\n                if (!dragging) {\n                    // TODO(jack): Figure out why this doesn't work\n                    // for circleHighlightStyle's that change\n                    // stroke-dasharray\n                    circle.circ.animate(circle.circleHighlightStyle, 50);\n                    circle.centerPoint.visibleShape.animate(\n                        circle.centerHighlightStyle,\n                        50\n                    );\n                }\n            } else if (event.type === \"vmouseout\") {\n                circle.highlight = false;\n                if (!circle.dragging && !circle.centerPoint.dragging) {\n                    circle.circ.animate(circle.circleNormalStyle, 50);\n                    circle.centerPoint.visibleShape.animate(\n                        circle.centerNormalStyle,\n                        50\n                    );\n                }\n            } else if (\n                event.type === \"vmousedown\" &&\n                (event.which === 1 || event.which === 0)\n            ) {\n                event.preventDefault();\n                circle.toFront();\n                const startRadius = circle.radius;\n\n                $(document).on(\"vmousemove vmouseup\", function(event) {\n                    event.preventDefault();\n                    circle.dragging = true;\n                    dragging = true;\n\n                    if (event.type === \"vmousemove\") {\n                        const coord = graphie.constrainToBounds(\n                            graphie.getMouseCoord(event),\n                            10\n                        );\n\n                        let radius = GraphUtils.getDistance(\n                            circle.centerPoint.coord,\n                            coord\n                        );\n                        radius = Math.max(\n                            circle.minRadius,\n                            Math.round(radius / circle.snapRadius) *\n                                circle.snapRadius\n                        );\n                        const oldRadius = circle.radius;\n                        let doResize = true;\n                        if (circle.onResize) {\n                            const onResizeResult = circle.onResize(\n                                radius,\n                                oldRadius\n                            );\n                            if (_.isNumber(onResizeResult)) {\n                                radius = onResizeResult;\n                            } else if (onResizeResult === false) {\n                                doResize = false;\n                            }\n                        }\n                        if (doResize) {\n                            circle.setRadius(radius);\n                            $(circle).trigger(\"move\");\n                        }\n                    } else if (event.type === \"vmouseup\") {\n                        $(document).off(\"vmousemove vmouseup\");\n                        circle.dragging = false;\n                        dragging = false;\n                        if (circle.onResizeEnd) {\n                            circle.onResizeEnd(circle.radius, startRadius);\n                        }\n                    }\n                });\n            }\n        });\n\n        return circle;\n    },\n\n    addRotateHandle: (function() {\n        const drawRotateHandle = function(graphie, center, radius, halfWidth, lengthAngle, angle, interacting) {\n            const getRotateHandlePoint = function(offset, distanceFromArrowMidline) {\n                const distFromRotationCenter =\n                    radius + distanceFromArrowMidline;\n                const vec = kvector.cartFromPolarDeg([\n                    distFromRotationCenter,\n                    angle + offset,\n                ]);\n                const absolute = kvector.add(center, vec);\n                const pixels = graphie.scalePoint(absolute);\n                return pixels[0] + \",\" + pixels[1];\n            };\n\n            const innerR = graphie.scaleVector(radius - halfWidth);\n            const outerR = graphie.scaleVector(radius + halfWidth);\n\n            // Draw the double-headed arrow thing that shows users where to\n            // click and drag to rotate\n            return graphie.raphael\n                .path(\n                    // upper arrowhead\n                    \" M\" +\n                        getRotateHandlePoint(lengthAngle, -halfWidth) +\n                        \" L\" +\n                        getRotateHandlePoint(lengthAngle, -3 * halfWidth) +\n                        \" L\" +\n                        getRotateHandlePoint(2 * lengthAngle, 0) +\n                        \" L\" +\n                        getRotateHandlePoint(lengthAngle, 3 * halfWidth) +\n                        \" L\" +\n                        getRotateHandlePoint(lengthAngle, halfWidth) +\n                        // outer arc\n                        \" A\" +\n                        outerR[0] +\n                        \",\" +\n                        outerR[1] +\n                        \",0,0,1,\" +\n                        getRotateHandlePoint(-lengthAngle, halfWidth) +\n                        // lower arrowhead\n                        \" L\" +\n                        getRotateHandlePoint(-lengthAngle, 3 * halfWidth) +\n                        \" L\" +\n                        getRotateHandlePoint(-2 * lengthAngle, 0) +\n                        \" L\" +\n                        getRotateHandlePoint(-lengthAngle, -3 * halfWidth) +\n                        \" L\" +\n                        getRotateHandlePoint(-lengthAngle, -halfWidth) +\n                        // inner arc\n                        \" A\" +\n                        innerR[0] +\n                        \",\" +\n                        innerR[1] +\n                        \",0,0,0,\" +\n                        getRotateHandlePoint(lengthAngle, -halfWidth) +\n                        \" Z\"\n                )\n                .attr({\n                    stroke: null,\n                    fill: interacting\n                        ? KhanColors.INTERACTING\n                        : KhanColors.INTERACTIVE,\n                });\n        };\n\n        return function(options) {\n            const graph = this;\n\n            let rotatePoint = options.center;\n            const radius = options.radius;\n            const lengthAngle = options.lengthAngle || 30;\n            const hideArrow = options.hideArrow || false;\n            const mouseTarget = options.mouseTarget;\n            const id = _.uniqueId(\"rotateHandle\");\n\n            // Normalize rotatePoint into something that always looks\n            // like a movablePoint\n            if (_.isArray(rotatePoint)) {\n                rotatePoint = {\n                    coord: rotatePoint,\n                };\n            }\n\n            const rotateHandle = graph.addMovablePoint({\n                coord: kpoint.addVector(\n                    rotatePoint.coord,\n                    kvector.cartFromPolarDeg(radius, options.angleDeg || 0)\n                ),\n                constraints: {\n                    fixedDistance: {\n                        dist: radius,\n                        point: rotatePoint,\n                    },\n                },\n                mouseTarget: mouseTarget,\n            });\n\n            // move the rotatePoint in front of the rotateHandle to avoid\n            // confusing clicking/scaling of the rotateHandle when the user\n            // intends to click on the rotatePoint\n            rotatePoint.toFront();\n\n            let rotatePointPrevCoord = rotatePoint.coord;\n            let rotateHandlePrevCoord = rotateHandle.coord;\n            let rotateHandleStartCoord = rotateHandlePrevCoord;\n            let isRotating = false;\n            let isHovering = false;\n            let drawnRotateHandle;\n\n            const redrawRotateHandle = function(handleCoord) {\n                if (hideArrow) {\n                    return; // Don't draw anything!\n                }\n\n                const handleVec = kvector.subtract(\n                    handleCoord,\n                    rotatePoint.coord\n                );\n                const handlePolar = kvector.polarDegFromCart(handleVec);\n                const angle = handlePolar[1];\n\n                if (drawnRotateHandle) {\n                    drawnRotateHandle.remove();\n                }\n\n                drawnRotateHandle = drawRotateHandle(\n                    graph,\n                    rotatePoint.coord,\n                    options.radius,\n                    isRotating || isHovering\n                        ? options.hoverWidth / 2\n                        : options.width / 2,\n                    lengthAngle,\n                    angle,\n                    isRotating || isHovering\n                );\n            };\n\n            // when the rotation center moves, we need to move\n            // the rotationHandle as well, or it will end up out\n            // of sync\n            $(rotatePoint).on(\"move.\" + id, function() {\n                const delta = kvector.subtract(\n                    rotatePoint.coord,\n                    rotatePointPrevCoord\n                );\n\n                rotateHandle.setCoord(kvector.add(rotateHandle.coord, delta));\n\n                redrawRotateHandle(rotateHandle.coord);\n\n                rotatePointPrevCoord = rotatePoint.coord;\n                rotateHandle.constraints.fixedDistance.point = rotatePoint;\n                rotateHandlePrevCoord = rotateHandle.coord;\n            });\n\n            // Rotate polygon with rotateHandle\n            rotateHandle.onMove = function(x, y) {\n                if (!isRotating) {\n                    rotateHandleStartCoord = rotateHandlePrevCoord;\n                    isRotating = true;\n                }\n\n                let coord = [x, y];\n\n                if (options.onMove) {\n                    const oldPolar = kvector.polarDegFromCart(\n                        kvector.subtract(\n                            rotateHandlePrevCoord,\n                            rotatePoint.coord\n                        )\n                    );\n                    const newPolar = kvector.polarDegFromCart(\n                        kvector.subtract(coord, rotatePoint.coord)\n                    );\n\n                    const oldAngle = oldPolar[1];\n                    const newAngle = newPolar[1];\n                    let result = options.onMove(newAngle, oldAngle);\n                    if (result != null && result !== true) {\n                        if (result === false) {\n                            result = oldAngle;\n                        }\n                        coord = kvector.add(\n                            rotatePoint.coord,\n                            kvector.cartFromPolarDeg([oldPolar[0], result])\n                        );\n                    }\n                }\n\n                redrawRotateHandle(coord);\n\n                rotateHandlePrevCoord = coord;\n                return coord;\n            };\n\n            rotateHandle.onMoveEnd = function() {\n                isRotating = false;\n                redrawRotateHandle(rotateHandle.coord);\n                if (options.onMoveEnd) {\n                    const oldPolar = kvector.polarDegFromCart(\n                        kvector.subtract(\n                            rotateHandleStartCoord,\n                            rotatePoint.coord\n                        )\n                    );\n                    const newPolar = kvector.polarDegFromCart(\n                        kvector.subtract(rotateHandle.coord, rotatePoint.coord)\n                    );\n                    options.onMoveEnd(newPolar[1], oldPolar[1]);\n                }\n            };\n\n            // Remove the default dot added by the movablePoint since we have\n            // our double-arrow thing\n            rotateHandle.visibleShape.remove();\n\n            if (!mouseTarget) {\n                // Make the default mouse target bigger to encompass the whole\n                // area around the double-arrow thing\n                rotateHandle.mouseTarget.attr({scale: 2});\n            }\n\n            const $mouseTarget = $(rotateHandle.mouseTarget.getMouseTarget());\n            $mouseTarget.bind(\"vmouseover\", function(e) {\n                isHovering = true;\n                redrawRotateHandle(rotateHandle.coord);\n            });\n            $mouseTarget.bind(\"vmouseout\", function(e) {\n                isHovering = false;\n                redrawRotateHandle(rotateHandle.coord);\n            });\n\n            redrawRotateHandle(rotateHandle.coord);\n\n            const oldRemove = rotateHandle.remove;\n            rotateHandle.remove = function() {\n                oldRemove.call(rotateHandle);\n                if (drawnRotateHandle) {\n                    drawnRotateHandle.remove();\n                }\n                $(rotatePoint).off(\"move.\" + id);\n            };\n\n            rotateHandle.update = function() {\n                redrawRotateHandle(rotateHandle.coord);\n            };\n\n            return rotateHandle;\n        };\n    })(),\n\n    addReflectButton: (function() {\n        const drawButton = function(\n            graphie,\n            buttonCoord,\n            lineCoords,\n            size,\n            distanceFromCenter,\n            leftStyle,\n            rightStyle\n        ) {\n            // Avoid invalid lines\n            if (kpoint.equal(lineCoords[0], lineCoords[1])) {\n                lineCoords = [\n                    lineCoords[0],\n                    kpoint.addVector(lineCoords[0], [1, 1]),\n                ];\n            }\n\n            const lineDirection = kvector.normalize(\n                kvector.subtract(lineCoords[1], lineCoords[0])\n            );\n\n            const lineVec = kvector.scale(lineDirection, size / 2);\n\n            const centerVec = kvector.scale(lineDirection, distanceFromCenter);\n            const leftCenterVec = kvector.rotateDeg(centerVec, 90);\n            const rightCenterVec = kvector.rotateDeg(centerVec, -90);\n\n            const negLineVec = kvector.negate(lineVec);\n            const leftVec = kvector.rotateDeg(lineVec, 90);\n            const rightVec = kvector.rotateDeg(lineVec, -90);\n\n            const leftCenter = kpoint.addVectors(buttonCoord, leftCenterVec);\n            const rightCenter = kpoint.addVectors(buttonCoord, rightCenterVec);\n\n            const leftCoord1 = kpoint.addVectors(\n                buttonCoord,\n                leftCenterVec,\n                lineVec,\n                leftVec\n            );\n            const leftCoord2 = kpoint.addVectors(\n                buttonCoord,\n                leftCenterVec,\n                negLineVec,\n                leftVec\n            );\n            const rightCoord1 = kpoint.addVectors(\n                buttonCoord,\n                rightCenterVec,\n                lineVec,\n                rightVec\n            );\n            const rightCoord2 = kpoint.addVectors(\n                buttonCoord,\n                rightCenterVec,\n                negLineVec,\n                rightVec\n            );\n\n            const leftButton = graphie.path(\n                [leftCenter, leftCoord1, leftCoord2, true],\n                leftStyle\n            );\n            const rightButton = graphie.path(\n                [rightCenter, rightCoord1, rightCoord2, true],\n                rightStyle\n            );\n\n            return {\n                remove: function() {\n                    leftButton.remove();\n                    rightButton.remove();\n                },\n            };\n        };\n\n        return function(options) {\n            const graphie = this;\n\n            const line = options.line;\n\n            const button = graphie.addMovablePoint({\n                constraints: options.constraints,\n                coord: kline.midpoint([line.pointA.coord, line.pointZ.coord]),\n                snapX: graphie.snap[0],\n                snapY: graphie.snap[1],\n                onMove: function(x, y) {\n                    // Don't allow the button to actually move. This is a hack\n                    // around the inability to both set a point as fixed AND\n                    // allow it to be clicked.\n                    return false;\n                },\n                onMoveEnd: function(x, y) {\n                    if (options.onMoveEnd) {\n                        options.onMoveEnd.call(this, x, y);\n                    }\n                },\n            });\n\n            let isHovering = false;\n            let isFlipped = false;\n            let currentlyDrawnButton;\n\n            const isHighlight = function() {\n                return isHovering;\n            };\n\n            const styles = _.map([0, 1], function(isHighlight) {\n                const baseStyle = isHighlight\n                    ? options.highlightStyle\n                    : options.normalStyle;\n\n                return _.map([0, 1], function(opacity) {\n                    return _.defaults(\n                        {\n                            \"fill-opacity\": opacity,\n                        },\n                        baseStyle\n                    );\n                });\n            });\n\n            const getStyle = function(isRight) {\n                if (isFlipped) {\n                    isRight = !isRight;\n                }\n                return styles[+isHighlight()][+isRight];\n            };\n\n            const redraw = function(coord, lineCoords) {\n                if (currentlyDrawnButton) {\n                    currentlyDrawnButton.remove();\n                }\n                currentlyDrawnButton = drawButton(\n                    graphie,\n                    coord,\n                    lineCoords,\n                    isHighlight() ? options.size * 1.5 : options.size,\n                    isHighlight() ? options.size * 0.125 : 0.25,\n                    getStyle(0),\n                    getStyle(1)\n                );\n            };\n\n            const update = function(coordA, coordZ) {\n                coordA = coordA || line.pointA.coord;\n                coordZ = coordZ || line.pointZ.coord;\n\n                const buttonCoord = kline.midpoint([coordA, coordZ]);\n                button.setCoord(buttonCoord);\n\n                redraw(buttonCoord, [coordA, coordZ]);\n            };\n\n            $(line).on(\"move\", _.bind(update, button, null, null));\n\n            const $mouseTarget = $(button.mouseTarget.getMouseTarget());\n            $mouseTarget.on(\"vclick\", function() {\n                const result = options.onClick();\n                if (result !== false) {\n                    isFlipped = !isFlipped;\n                    redraw(button.coord, [\n                        line.pointA.coord,\n                        line.pointZ.coord,\n                    ]);\n                }\n            });\n\n            // Bring the reflection line handles in front of the button, so\n            // that if we drag the reflectPoints really close together, we can\n            // still move the handles away from each other, rather than only\n            // being able to apply the reflection.\n            line.pointA.toFront();\n            line.pointZ.toFront();\n\n            // Replace the visual point with the double triangle thing\n            button.visibleShape.remove();\n            const pointScale = graphie.scaleVector(options.size)[0] / 20;\n            button.mouseTarget.attr({scale: 1.5 * pointScale});\n            $mouseTarget.css(\"cursor\", \"pointer\");\n\n            // Make the arrow-thing grow and shrink with mouseover/out\n            $mouseTarget.bind(\"vmouseover\", function(e) {\n                isHovering = true;\n                redraw(button.coord, [line.pointA.coord, line.pointZ.coord]);\n            });\n            $mouseTarget.bind(\"vmouseout\", function(e) {\n                isHovering = false;\n                redraw(button.coord, [line.pointA.coord, line.pointZ.coord]);\n            });\n\n            const oldButtonRemove = button.remove;\n            button.remove = function() {\n                currentlyDrawnButton.remove();\n                oldButtonRemove.call(button);\n            };\n\n            button.update = update;\n            button.isFlipped = function() {\n                return isFlipped;\n            };\n\n            update();\n            return button;\n        };\n    })(),\n\n    protractor: function(center) {\n        return new Protractor(this, center);\n    },\n\n    ruler: function(options) {\n        return new Ruler(this, options || {});\n    },\n\n    addPoints: addPoints,\n});\n\nfunction Protractor(graph, center) {\n    this.set = graph.raphael.set();\n\n    this.cx = center[0];\n    this.cy = center[1];\n    const pro = this;\n\n    const r = graph.unscaleVector(180.5)[0];\n    const imgPos = graph.scalePoint([\n        this.cx - r,\n        this.cy + r - graph.unscaleVector(10.5)[1],\n    ]);\n    const image = graph.mouselayer.image(\n        \"https://ka-perseus-graphie.s3.amazonaws.com/e9d032f2ab8b95979f674fbfa67056442ba1ff6a.png\",\n        imgPos[0],\n        imgPos[1],\n        360,\n        180\n    );\n    this.set.push(image);\n\n    // Prevent the page from scrolling when we grab and drag the image on a\n    // mobile device.\n    image.node.addEventListener(\n        \"touchstart\",\n        function(event) {\n            event.preventDefault();\n        },\n        {passive: false}\n    );\n\n    const arrowHelper = function(angle, pixelsFromEdge) {\n        const scaledRadius = graph.scaleVector(r);\n        scaledRadius[0] -= 16;\n        scaledRadius[1] -= 16;\n        const scaledCenter = graph.scalePoint(center);\n        const x =\n            Math.sin((angle + 90) * Math.PI / 180) *\n                (scaledRadius[0] + pixelsFromEdge) +\n            scaledCenter[0];\n        const y =\n            Math.cos((angle + 90) * Math.PI / 180) *\n                (scaledRadius[1] + pixelsFromEdge) +\n            scaledCenter[1];\n        return x + \",\" + y;\n    };\n\n    const arrow = graph.raphael\n        .path(\n            \" M\" +\n                arrowHelper(180, 6) +\n                \" L\" +\n                arrowHelper(180, 2) +\n                \" L\" +\n                arrowHelper(183, 10) +\n                \" L\" +\n                arrowHelper(180, 18) +\n                \" L\" +\n                arrowHelper(180, 14) +\n                \" A\" +\n                (graph.scaleVector(r)[0] + 10) +\n                \",\" +\n                (graph.scaleVector(r)[1] + 10) +\n                \",0,0,1,\" +\n                arrowHelper(170, 14) +\n                \" L\" +\n                arrowHelper(170, 18) +\n                \" L\" +\n                arrowHelper(167, 10) +\n                \" L\" +\n                arrowHelper(170, 2) +\n                \" L\" +\n                arrowHelper(170, 6) +\n                \" A\" +\n                (graph.scaleVector(r)[0] + 10) +\n                \",\" +\n                (graph.scaleVector(r)[1] + 10) +\n                \",0,0,0,\" +\n                arrowHelper(180, 6) +\n                \" Z\"\n        )\n        .attr({\n            stroke: null,\n            fill: KhanColors.INTERACTIVE,\n        });\n\n    // add it to the set so it translates with everything else\n    this.set.push(arrow);\n\n    this.centerPoint = graph.addMovablePoint({\n        coord: center,\n        visible: false,\n    });\n\n    // Use a movablePoint for rotation\n    this.rotateHandle = graph.addMovablePoint({\n        bounded: false,\n        coord: [\n            Math.sin(275 * Math.PI / 180) * r + this.cx,\n            Math.cos(275 * Math.PI / 180) * r + this.cy,\n        ],\n        onMove: function(x, y) {\n            const angle =\n                Math.atan2(\n                    pro.centerPoint.coord[1] - y,\n                    pro.centerPoint.coord[0] - x\n                ) *\n                180 /\n                Math.PI;\n            pro.rotate(-angle - 5, true);\n        },\n    });\n\n    // Add a constraint so the point moves in a circle\n    this.rotateHandle.constraints.fixedDistance.dist = r;\n    this.rotateHandle.constraints.fixedDistance.point = this.centerPoint;\n\n    // Remove the default dot added by the movablePoint since we have our\n    // double-arrow thing\n    this.rotateHandle.visibleShape.remove();\n    // Make the mouse target bigger to encompass the whole area around the\n    // double-arrow thing\n    this.rotateHandle.mouseTarget.attr({scale: 2.0});\n\n    let isDragging = false;\n    let isHovering = false;\n    const isHighlight = function() {\n        return isHovering || isDragging;\n    };\n\n    const self = this;\n    const $mouseTarget = $(self.rotateHandle.mouseTarget.getMouseTarget());\n    $mouseTarget.bind(\"vmousedown\", function(event) {\n        isDragging = true;\n        $mouseTarget.css(\"cursor\", \"-webkit-grabbing\");\n        $mouseTarget.css(\"cursor\", \"grabbing\");\n        arrow.animate({scale: 1.5, fill: KhanColors.INTERACTING}, 50);\n\n        $(document).bind(\"vmouseup.rotateHandle\", function(event) {\n            isDragging = false;\n            $mouseTarget.css(\"cursor\", \"-webkit-grab\");\n            $mouseTarget.css(\"cursor\", \"grab\");\n\n            if (!isHighlight()) {\n                arrow.animate({scale: 1.0, fill: KhanColors.INTERACTIVE}, 50);\n            }\n\n            $(document).unbind(\"vmouseup.rotateHandle\");\n        });\n    });\n\n    $mouseTarget.bind(\"vmouseover\", function(event) {\n        isHovering = true;\n        arrow.animate({scale: 1.5, fill: KhanColors.INTERACTING}, 50);\n    });\n    $mouseTarget.bind(\"vmouseout\", function(event) {\n        isHovering = false;\n        if (!isHighlight()) {\n            arrow.animate({scale: 1.0, fill: KhanColors.INTERACTIVE}, 50);\n        }\n    });\n\n    const setNodes = $.map(this.set, function(el) {\n        return el.node;\n    });\n    this.makeTranslatable = function makeTranslatable() {\n        $(setNodes).css(\"cursor\", \"move\");\n        $mouseTarget.css(\"cursor\", \"-webkit-grab\");\n        $mouseTarget.css(\"cursor\", \"grab\");\n\n        $(setNodes).bind(\"vmousedown\", function(event) {\n            event.preventDefault();\n            let startx =\n                event.pageX - $(graph.raphael.canvas.parentNode).offset().left;\n            let starty =\n                event.pageY - $(graph.raphael.canvas.parentNode).offset().top;\n\n            $(document).bind(\"vmousemove.protractor\", function(event) {\n                let mouseX =\n                    event.pageX -\n                    $(graph.raphael.canvas.parentNode).offset().left;\n                let mouseY =\n                    event.pageY -\n                    $(graph.raphael.canvas.parentNode).offset().top;\n                // can't go beyond 10 pixels from the edge\n                mouseX = Math.max(10, Math.min(graph.xpixels - 10, mouseX));\n                mouseY = Math.max(10, Math.min(graph.ypixels - 10, mouseY));\n\n                const dx = mouseX - startx;\n                const dy = mouseY - starty;\n\n                $.each(pro.set.items, function() {\n                    this.translate(dx, dy);\n                });\n                pro.centerPoint.setCoord([\n                    pro.centerPoint.coord[0] + dx / graph.scale[0],\n                    pro.centerPoint.coord[1] - dy / graph.scale[1],\n                ]);\n                pro.rotateHandle.setCoord([\n                    pro.rotateHandle.coord[0] + dx / graph.scale[0],\n                    pro.rotateHandle.coord[1] - dy / graph.scale[1],\n                ]);\n                startx = mouseX;\n                starty = mouseY;\n            });\n\n            $(document).one(\"vmouseup\", function(event) {\n                $(document).unbind(\"vmousemove.protractor\");\n            });\n        });\n    };\n\n    this.rotation = 0;\n\n    this.rotate = function(offset, absolute) {\n        const center = graph.scalePoint(this.centerPoint.coord);\n\n        if (absolute) {\n            this.rotation = 0;\n        }\n\n        this.set.rotate(this.rotation + offset, center[0], center[1]);\n        this.rotation = this.rotation + offset;\n\n        return this;\n    };\n\n    this.moveTo = function moveTo(x, y) {\n        const start = graph.scalePoint(pro.centerPoint.coord);\n        const end = graph.scalePoint([x, y]);\n        const time = GraphUtils.getDistance(start, end) * 2;\n\n        $({x: start[0], y: start[1]}).animate(\n            {x: end[0], y: end[1]},\n            {\n                duration: time,\n                step: function(now, fx) {\n                    let dx = 0;\n                    let dy = 0;\n                    if (fx.prop === \"x\") {\n                        dx = now - graph.scalePoint(pro.centerPoint.coord)[0];\n                    } else if (fx.prop === \"y\") {\n                        dy = now - graph.scalePoint(pro.centerPoint.coord)[1];\n                    }\n                    $.each(pro.set.items, function() {\n                        this.translate(dx, dy);\n                    });\n                    pro.centerPoint.setCoord([\n                        pro.centerPoint.coord[0] + dx / graph.scale[0],\n                        pro.centerPoint.coord[1] - dy / graph.scale[1],\n                    ]);\n                    pro.rotateHandle.setCoord([\n                        pro.rotateHandle.coord[0] + dx / graph.scale[0],\n                        pro.rotateHandle.coord[1] - dy / graph.scale[1],\n                    ]);\n                },\n            }\n        );\n    };\n\n    this.rotateTo = function rotateTo(angle) {\n        if (Math.abs(this.rotation - angle) > 180) {\n            this.rotation += 360;\n        }\n        const time = Math.abs(this.rotation - angle) * 5;\n        $({0: this.rotation}).animate(\n            {0: angle},\n            {\n                duration: time,\n                step: function(now, fx) {\n                    pro.rotate(now, true);\n                    pro.rotateHandle.setCoord([\n                        Math.sin((now + 275) * Math.PI / 180) * r +\n                            pro.centerPoint.coord[0],\n                        Math.cos((now + 275) * Math.PI / 180) * r +\n                            pro.centerPoint.coord[1],\n                    ]);\n                },\n            }\n        );\n    };\n\n    this.remove = function() {\n        this.set.remove();\n    };\n\n    this.makeTranslatable();\n    return this;\n}\n\nfunction Ruler(graphie, options) {\n    _.defaults(options, {\n        center: [0, 0],\n        pixelsPerUnit: 40,\n        ticksPerUnit: 10, // 10 or power of 2\n        units: 10, // the length the ruler can measure\n        label: \"\", // e.g \"cm\" (the shorter, the better)\n        style: {\n            fill: null,\n            stroke: KhanColors.GRAY,\n        },\n    });\n\n    const light = _.extend({}, options.style, {strokeWidth: 1});\n    const bold = _.extend({}, options.style, {strokeWidth: 2});\n\n    const width = options.units * options.pixelsPerUnit;\n    const height = 50;\n\n    const leftBottom = graphie.unscalePoint(\n        kvector.subtract(\n            graphie.scalePoint(options.center),\n            kvector.scale([width, -height], 0.5)\n        )\n    );\n\n    const graphieUnitsPerUnit = options.pixelsPerUnit / graphie.scale[0];\n    const graphieUnitsHeight = height / graphie.scale[0];\n\n    const rightTop = kvector.add(leftBottom, [\n        options.units * graphieUnitsPerUnit,\n        graphieUnitsHeight,\n    ]);\n\n    const tickHeight = 1.0;\n    let tickHeightMap;\n\n    if (options.ticksPerUnit === 10) {\n        // decimal, as on a centimeter ruler\n        tickHeightMap = {\n            10: tickHeight,\n            5: tickHeight * 0.55,\n            1: tickHeight * 0.35,\n        };\n    } else {\n        const sizes = [1, 0.6, 0.45, 0.3];\n\n        tickHeightMap = {};\n        for (let i = options.ticksPerUnit; i >= 1; i /= 2) {\n            tickHeightMap[i] = tickHeight * (sizes.shift() || 0.2);\n        }\n    }\n\n    const tickFrequencies = _.keys(tickHeightMap).sort(function(a, b) {\n        return b - a;\n    });\n\n    function getTickHeight(i) {\n        for (let k = 0; k < tickFrequencies.length; k++) {\n            const key = tickFrequencies[k];\n            if (i % key === 0) {\n                return tickHeightMap[key];\n            }\n        }\n    }\n\n    const left = leftBottom[0];\n    const bottom = leftBottom[1];\n    const right = rightTop[0];\n    const top = rightTop[1];\n\n    const numTicks = options.units * options.ticksPerUnit + 1;\n\n    const set = graphie.raphael.set();\n\n    const px = 1 / graphie.scale[0];\n    set.push(graphie.line([left - px, bottom], [right + px, bottom], bold));\n    set.push(graphie.line([left - px, top], [right + px, top], bold));\n\n    _.times(numTicks, function(i) {\n        const n = i / options.ticksPerUnit;\n        const x = left + n * graphieUnitsPerUnit;\n        const height = getTickHeight(i) * graphieUnitsHeight;\n\n        const style = i === 0 || i === numTicks - 1 ? bold : light;\n        set.push(graphie.line([x, bottom], [x, bottom + height], style));\n\n        if (n % 1 === 0) {\n            const coord = graphie.scalePoint([x, top]);\n            let text;\n            let offset;\n\n            if (n === 0) {\n                // Unit label\n                text = options.label;\n                offset =\n                    {\n                        mm: 13,\n                        cm: 11,\n                        m: 8,\n                        km: 11,\n                        in: 8,\n                        ft: 8,\n                        yd: 10,\n                        mi: 10,\n                    }[text] || 3 * text.toString().length;\n            } else {\n                // Tick label\n                text = n;\n                offset = -3 * (n.toString().length + 1);\n            }\n            const label = graphie.raphael.text(\n                coord[0] + offset,\n                coord[1] + 10,\n                text\n            );\n            label.attr({\n                \"font-family\": \"KaTeX_Main\",\n                \"font-size\": \"12px\",\n                color: \"#444\",\n            });\n            set.push(label);\n        }\n    });\n\n    const mouseTarget = graphie.mouselayer.path(\n        GraphUtils.svgPath([\n            leftBottom,\n            [left, top],\n            rightTop,\n            [right, bottom],\n            /* closed */ true,\n        ])\n    );\n    mouseTarget.attr({\n        fill: \"#000\",\n        opacity: 0,\n        stroke: \"#000\",\n        \"stroke-width\": 2,\n    });\n    set.push(mouseTarget);\n\n    // Prevent the page from scrolling when we grab and drag the ruler on a\n    // mobile device.\n    mouseTarget.node.addEventListener(\n        \"touchstart\",\n        function(event) {\n            event.preventDefault();\n        },\n        {passive: false}\n    );\n\n    const setNodes = $.map(set, function(el) {\n        return el.node;\n    });\n    $(setNodes).css(\"cursor\", \"move\");\n\n    $(setNodes).bind(\"vmousedown\", function(event) {\n        event.preventDefault();\n        let startx =\n            event.pageX - $(graphie.raphael.canvas.parentNode).offset().left;\n        let starty =\n            event.pageY - $(graphie.raphael.canvas.parentNode).offset().top;\n\n        $(document).bind(\"vmousemove.ruler\", function(event) {\n            let mouseX =\n                event.pageX -\n                $(graphie.raphael.canvas.parentNode).offset().left;\n            let mouseY =\n                event.pageY - $(graphie.raphael.canvas.parentNode).offset().top;\n            // can't go beyond 10 pixels from the edge\n            mouseX = Math.max(10, Math.min(graphie.xpixels - 10, mouseX));\n            mouseY = Math.max(10, Math.min(graphie.ypixels - 10, mouseY));\n\n            const dx = mouseX - startx;\n            const dy = mouseY - starty;\n\n            set.translate(dx, dy);\n            leftBottomHandle.setCoord([\n                leftBottomHandle.coord[0] + dx / graphie.scale[0],\n                leftBottomHandle.coord[1] - dy / graphie.scale[1],\n            ]);\n            rightBottomHandle.setCoord([\n                rightBottomHandle.coord[0] + dx / graphie.scale[0],\n                rightBottomHandle.coord[1] - dy / graphie.scale[1],\n            ]);\n\n            startx = mouseX;\n            starty = mouseY;\n        });\n\n        $(document).one(\"vmouseup\", function(event) {\n            $(document).unbind(\"vmousemove.ruler\");\n        });\n    });\n\n    const leftBottomHandle = graphie.addMovablePoint({\n        coord: leftBottom,\n        normalStyle: {\n            fill: KhanColors.INTERACTIVE,\n            \"fill-opacity\": 0,\n            stroke: KhanColors.INTERACTIVE,\n        },\n        highlightStyle: {\n            fill: KhanColors.INTERACTING,\n            \"fill-opacity\": 0.1,\n            stroke: KhanColors.INTERACTING,\n        },\n        pointSize: 6, // or 8 maybe?\n        onMove: function(x, y) {\n            const dy = rightBottomHandle.coord[1] - y;\n            const dx = rightBottomHandle.coord[0] - x;\n            const angle = Math.atan2(dy, dx) * 180 / Math.PI;\n            const center = kvector.scale(\n                kvector.add([x, y], rightBottomHandle.coord),\n                0.5\n            );\n            const scaledCenter = graphie.scalePoint(center);\n            const oldCenter = kvector.scale(\n                kvector.add(leftBottomHandle.coord, rightBottomHandle.coord),\n                0.5\n            );\n            const scaledOldCenter = graphie.scalePoint(oldCenter);\n            const diff = kvector.subtract(scaledCenter, scaledOldCenter);\n            set.rotate(-angle, scaledOldCenter[0], scaledOldCenter[1]);\n            set.translate(diff[0], diff[1]);\n        },\n    });\n    const rightBottomHandle = graphie.addMovablePoint({\n        coord: [right, bottom],\n        normalStyle: {\n            fill: KhanColors.INTERACTIVE,\n            \"fill-opacity\": 0,\n            stroke: KhanColors.INTERACTIVE,\n        },\n        highlightStyle: {\n            fill: KhanColors.INTERACTING,\n            \"fill-opacity\": 0.1,\n            stroke: KhanColors.INTERACTING,\n        },\n        pointSize: 6, // or 8 maybe?\n        onMove: function(x, y) {\n            const dy = y - leftBottomHandle.coord[1];\n            const dx = x - leftBottomHandle.coord[0];\n            const angle = Math.atan2(dy, dx) * 180 / Math.PI;\n            const center = kvector.scale(\n                kvector.add([x, y], leftBottomHandle.coord),\n                0.5\n            );\n            const scaledCenter = graphie.scalePoint(center);\n            const oldCenter = kvector.scale(\n                kvector.add(leftBottomHandle.coord, rightBottomHandle.coord),\n                0.5\n            );\n            const scaledOldCenter = graphie.scalePoint(oldCenter);\n            const diff = kvector.subtract(scaledCenter, scaledOldCenter);\n            set.rotate(-angle, scaledOldCenter[0], scaledOldCenter[1]);\n            set.translate(diff[0], diff[1]);\n        },\n    });\n\n    // Make each handle rotate the ruler about the other one\n    leftBottomHandle.constraints.fixedDistance.dist = width / graphie.scale[0];\n    leftBottomHandle.constraints.fixedDistance.point = rightBottomHandle;\n    rightBottomHandle.constraints.fixedDistance.dist = width / graphie.scale[0];\n    rightBottomHandle.constraints.fixedDistance.point = leftBottomHandle;\n\n    this.remove = function() {\n        set.remove();\n        leftBottomHandle.remove();\n        rightBottomHandle.remove();\n    };\n\n    return this;\n}\n\nfunction MovableAngle(graphie, options) {\n    this.graphie = graphie;\n\n    // TODO(alex): Move standard colors from math.js to somewhere else\n    // so that they are available when this file is first parsed\n    _.extend(this, options);\n    _.defaults(this, {\n        normalStyle: {\n            stroke: KhanColors.INTERACTIVE,\n            \"stroke-width\": 2,\n            fill: KhanColors.INTERACTIVE,\n        },\n        highlightStyle: {\n            stroke: KhanColors.INTERACTING,\n            \"stroke-width\": 2,\n            fill: KhanColors.INTERACTING,\n        },\n        labelStyle: {\n            stroke: KhanColors.DYNAMIC,\n            \"stroke-width\": 1,\n            color: KhanColors.DYNAMIC,\n        },\n        angleStyle: {\n            stroke: KhanColors.DYNAMIC,\n            \"stroke-width\": 1,\n            color: KhanColors.DYNAMIC,\n        },\n        allowReflex: true, // not on MovableAngle.prototype so that\n        // it is not overridden by undefined\n    });\n\n    if (!this.points || this.points.length !== 3) {\n        throw new Error(\"MovableAngle requires 3 points\");\n    }\n\n    // Handle coordinates that are not MovablePoints (i.e. [2, 4])\n    this.points = _.map(\n        options.points,\n        function(point) {\n            if (_.isArray(point)) {\n                return graphie.addMovablePoint({\n                    coord: point,\n                    visible: false,\n                    constraints: {\n                        fixed: true,\n                    },\n                    normalStyle: this.normalStyle,\n                });\n            } else {\n                return point;\n            }\n        },\n        this\n    );\n    this.coords = _.pluck(this.points, \"coord\");\n    if (this.reflex == null) {\n        if (this.allowReflex) {\n            this.reflex = this._getClockwiseAngle(this.coords) > 180;\n        } else {\n            this.reflex = false;\n        }\n    }\n\n    this.rays = _.map(\n        [0, 2],\n        function(i) {\n            return graphie.addMovableLineSegment({\n                pointA: this.points[1],\n                pointZ: this.points[i],\n                fixed: true,\n                extendRay: true,\n            });\n        },\n        this\n    );\n\n    this.temp = [];\n    this.labeledAngle = graphie.label([0, 0], \"\", \"center\", this.labelStyle);\n\n    if (!this.fixed) {\n        this.addMoveHandlers();\n        this.addHighlightHandlers();\n    }\n    this.update();\n}\n\n_.extend(MovableAngle.prototype, {\n    points: [],\n    snapDegrees: 0,\n    snapOffsetDeg: 0,\n    angleLabel: \"\",\n    numArcs: 1,\n    pushOut: 0,\n    fixed: false,\n\n    addMoveHandlers: function() {\n        const graphie = this.graphie;\n\n        function tooClose(point1, point2) {\n            const safeDistance = 30;\n            const distance = GraphUtils.getDistance(\n                graphie.scalePoint(point1),\n                graphie.scalePoint(point2)\n            );\n            return distance < safeDistance;\n        }\n\n        const points = this.points;\n\n        // Drag the vertex to move the entire angle\n        points[1].onMove = function(x, y) {\n            const oldVertex = points[1].coord;\n            const newVertex = [x, y];\n            const delta = addPoints(newVertex, reverseVector(oldVertex));\n\n            let valid = true;\n            const newPoints = {};\n            _.each([0, 2], function(i) {\n                const oldPoint = points[i].coord;\n                let newPoint = addPoints(oldPoint, delta);\n\n                let angle = GraphUtils.findAngle(newVertex, newPoint);\n                angle *= Math.PI / 180;\n                newPoint = graphie.constrainToBoundsOnAngle(\n                    newPoint,\n                    10,\n                    angle\n                );\n                newPoints[i] = newPoint;\n\n                if (tooClose(newVertex, newPoint)) {\n                    valid = false;\n                }\n            });\n\n            // Only move points if all new positions are valid\n            if (valid) {\n                _.each(newPoints, function(newPoint, i) {\n                    points[i].setCoord(newPoint);\n                });\n            }\n            return valid;\n        };\n\n        const snap = this.snapDegrees;\n        const snapOffset = this.snapOffsetDeg;\n\n        // Drag ray control points to move each ray individually\n        _.each([0, 2], function(i) {\n            points[i].onMove = function(x, y) {\n                const newPoint = [x, y];\n                const vertex = points[1].coord;\n\n                if (tooClose(vertex, newPoint)) {\n                    return false;\n                } else if (snap) {\n                    let angle = GraphUtils.findAngle(newPoint, vertex);\n                    angle =\n                        Math.round((angle - snapOffset) / snap) * snap +\n                        snapOffset;\n                    const distance = GraphUtils.getDistance(newPoint, vertex);\n                    return addPoints(vertex, graphie.polar(distance, angle));\n                } else {\n                    return true;\n                }\n            };\n        });\n\n        // Expose only a single move event\n        $(points).on(\n            \"move\",\n            function() {\n                this.update();\n                $(this).trigger(\"move\");\n            }.bind(this)\n        );\n    },\n\n    addHighlightHandlers: function() {\n        const vertex = this.points[1];\n\n        vertex.onHighlight = function() {\n            _.each(\n                this.points,\n                function(point) {\n                    point.visibleShape.animate(this.highlightStyle, 50);\n                },\n                this\n            );\n            _.each(\n                this.rays,\n                function(ray) {\n                    ray.visibleLine.animate(this.highlightStyle, 50);\n                    ray.arrowStyle = _.extend({}, ray.arrowStyle, {\n                        color: this.highlightStyle.stroke,\n                        stroke: this.highlightStyle.stroke,\n                    });\n                },\n                this\n            );\n\n            this.angleStyle = _.extend({}, this.angleStyle, {\n                color: this.highlightStyle.stroke,\n                stroke: this.highlightStyle.stroke,\n            });\n            this.update();\n        }.bind(this);\n\n        vertex.onUnhighlight = function() {\n            _.each(\n                this.points,\n                function(point) {\n                    point.visibleShape.animate(this.normalStyle, 50);\n                },\n                this\n            );\n            _.each(\n                this.rays,\n                function(ray) {\n                    ray.visibleLine.animate(ray.normalStyle, 50);\n                    ray.arrowStyle = _.extend({}, ray.arrowStyle, {\n                        color: ray.normalStyle.stroke,\n                        stroke: ray.normalStyle.stroke,\n                    });\n                },\n                this\n            );\n\n            this.angleStyle = _.extend({}, this.angleStyle, {\n                color: KhanColors.DYNAMIC,\n                stroke: KhanColors.DYNAMIC,\n            });\n            this.update();\n        }.bind(this);\n    },\n\n    /**\n     * Returns the angle in [0, 360) degrees created by the\n     * coords when interpreted in a clockwise direction.\n     */\n    _getClockwiseAngle: function(coords) {\n        const rawAngle = GraphUtils.findAngle(\n            // The order of these is \"weird\" to match what a clockwise\n            // order is in graphie.labelAngle\n            coords[2], // from the second point\n            coords[0], // clockwise to the first point\n            coords[1] // the vertex parameter is last\n        );\n        const clockwiseAngle = rawAngle + 360 % 360;\n\n        return clockwiseAngle;\n    },\n\n    isReflex: function() {\n        return this.reflex;\n    },\n\n    isClockwise: function() {\n        const clockwiseReflexive = this._getClockwiseAngle(this.coords) > 180;\n        return clockwiseReflexive === this.reflex;\n    },\n\n    getClockwiseCoords: function() {\n        if (this.isClockwise()) {\n            return _.clone(this.coords);\n        } else {\n            return _.clone(this.coords).reverse();\n        }\n    },\n\n    update: function(shouldChangeReflexivity) {\n        const prevCoords = this.coords;\n        this.coords = _.pluck(this.points, \"coord\");\n\n        // Update lines\n        _.invoke(this.points, \"updateLineEnds\");\n\n        const prevAngle = this._getClockwiseAngle(prevCoords);\n        const angle = this._getClockwiseAngle(this.coords);\n        const prevClockwiseReflexive = prevAngle > 180;\n        const clockwiseReflexive = angle > 180;\n\n        if (this.allowReflex) {\n            if (shouldChangeReflexivity == null) {\n                shouldChangeReflexivity =\n                    prevClockwiseReflexive !== clockwiseReflexive &&\n                    Math.abs(angle - prevAngle) < 180;\n            }\n\n            if (shouldChangeReflexivity) {\n                this.reflex = !this.reflex;\n            }\n        }\n\n        _.invoke(this.temp, \"remove\");\n        this.temp = this.graphie.labelAngle({\n            point1: this.coords[0],\n            vertex: this.coords[1],\n            point3: this.coords[2],\n            label: this.labeledAngle,\n            text: this.angleLabel,\n            numArcs: this.numArcs,\n            pushOut: this.pushOut,\n            clockwise: this.reflex === clockwiseReflexive,\n            style: this.angleStyle,\n        });\n    },\n\n    remove: function() {\n        _.invoke(this.rays, \"remove\");\n        _.invoke(this.temp, \"remove\");\n        this.labeledAngle.remove();\n    },\n});\n\n_module_.exports = InteractiveUtils;\nexport default _module_.exports;\n","import \"./interactive.js\"; // For side effects\nimport _graphieJs from \"./graphie.js\";\n\nvar _module_ = {\n exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A wrapper around graphie.js and interactive.js to make sure interactive.js\n * is always required at the same time as graphie.js. This is because\n * interactive.js has side effects that are hard to see (it adds things to\n * `Graphie.prototype`), so someone might forget to require interactive.js.\n *\n * To use the utilities exported from interactive.js, require that file\n * itself.\n */\nconst GraphUtils = _graphieJs;\n\n_module_.exports = GraphUtils;\nexport default _module_.exports;\n","import _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A library of options to pass to add/draw/remove/constraints\n */\n\nconst _ = _underscore;\nconst kpoint = _kmath.point;\nconst kvector = _kmath2.vector;\n\nfunction sum(array) {\n    return _.reduce(array, function(memo, arg) {\n        return memo + arg;\n    }, 0);\n}\n\nfunction clockwise(points) {\n    const segments = _.zip(points, points.slice(1).concat(points.slice(0, 1)));\n    const areas = _.map(segments, function(segment) {\n        const p1 = segment[0];\n        const p2 = segment[1];\n        return (p2[0] - p1[0]) * (p2[1] + p1[1]);\n    });\n    return sum(areas) > 0;\n}\n\nconst add = {\n    constrain: function() {\n        this.constrain();\n    },\n\n    pointsToFront: function(state) {\n        _.invoke(state.points, \"toFront\");\n    },\n};\n\nadd.standard = [add.constrain, add.pointsToFront];\n\nconst modify = {\n    draw: function() {\n        this.draw();\n    },\n};\n\nmodify.standard = [modify.draw];\n\n\nconst draw = {\n    basic: function(state, prevState) {\n        const graphie = this.graphie;\n        const path = this.path(state);\n\n        if (!this.state.visibleShape) {\n            this.state.visibleShape = graphie.raphael.path(path);\n            this.state.visibleShape.attr(this.normalStyle());\n        }\n        if (state.normalStyle !== prevState.normalStyle &&\n                !_.isEqual(state.normalStyle, prevState.normalStyle)) {\n            this.state.visibleShape.attr(this.normalStyle());\n        }\n        this.state.visibleShape.attr({path: path});\n        if (this.mouseTarget()) {\n            this.mouseTarget().attr({path: path});\n        }\n    },\n\n    /* Labels are handled primarily by label objects, but sometimes require\n     * extra movables, e.g., for the arcs drawn at labeled angles. These extra\n     * movables are stored in the label cache. */\n    labels: function(state, prevState) {\n        const graphie = this.graphie;\n        const self = this;\n\n        const coords = _.invoke(state.points, \"coord\");\n        const isClockwise = clockwise(coords);\n        const n = coords.length;\n\n        // graphie.labelAngle and similar methods attempt to re-use the label\n        // provided, which will have been stored on state._labeledAngles.\n        // If they cannot re-use the label, they make a new one, which will\n        // get stored on state._labelCache. These will all be cleared out when\n        // we remove the polygon.\n        // (This logic is borrowed from graphie:addMovablePolygon.)\n        if (self.state._labelCache != null) {\n            _.invoke(self.state._labelCache, \"remove\");\n        }\n        self.state._labelCache = [];\n\n        // Update angle labels\n        if (state.angleLabels.length || state.showRightAngleMarkers.length) {\n            // Generate labels\n            if (self.state._labeledAngles == null) {\n                self.state._labeledAngles = _.times(\n                    Math.max(\n                        state.angleLabels.length,\n                        state.showRightAngleMarkers.length),\n                    function() {\n                        return graphie.label(\n                            [0, 0], \"\", \"center\", state.labelStyle\n                        );\n                    }\n                );\n            }\n\n            _.each(self.state._labeledAngles, function(label, i) {\n                self.state._labelCache.push(graphie.labelAngle({\n                    point1: coords[(i - 1 + n) % n],\n                    vertex: coords[i],\n                    point3: coords[(i + 1) % n],\n                    label: label,\n                    text: state.angleLabels[i],\n                    showRightAngleMarker: state.showRightAngleMarkers[i],\n                    numArcs: state.numArcs[i],\n                    clockwise: isClockwise,\n                    style: state.labelStyle,\n                }));\n            });\n        }\n\n        // Update side labels\n        if (state.sideLabels.length) {\n            // Generate labels\n            if (self.state._labeledSides == null) {\n                self.state._labeledSides = _.map(state.sideLabels,\n                    function(label) {\n                        return graphie.label([0, 0], \"\", \"center\",\n                            state.labelStyle);\n                    }\n                );\n            }\n\n            _.each(self.state._labeledSides, function(label, i) {\n                self.state._labelCache.push(graphie.labelSide({\n                    point1: coords[i],\n                    point2: coords[(i + 1) % n],\n                    label: label,\n                    text: state.sideLabels[i],\n                    numArrows: state.numArrows[i],\n                    numTicks: state.numTicks[i],\n                    clockwise: isClockwise,\n                    style: state.labelStyle,\n                }));\n            });\n        }\n\n        // Update vertex labels\n        if (state.vertexLabels.length) {\n            // Generate labels\n            if (self.state._labeledVertices == null) {\n                self.state._labeledVertices = _.map(state.vertexLabels,\n                    function(label) {\n                        return graphie.label([0, 0], \"\", \"center\",\n                            state.labelStyle);\n                    }\n                );\n            }\n\n            _.each(self.state._labeledVertices, function(label, i) {\n                self.state._labelCache.push(graphie.labelVertex({\n                    point1: coords[(i - 1 + n) % n],\n                    vertex: coords[i],\n                    point3: coords[(i + 1) % n],\n                    label: label,\n                    text: state.vertexLabels[i],\n                    clockwise: isClockwise,\n                    style: state.labelStyle,\n                }));\n            });\n        }\n\n        // graphie.labelVertex and its peer methods return an array of movables\n        self.state._labelCache = _.flatten(self.state._labelCache);\n    },\n\n    highlight: function(state, prevState) {\n        if (state.isHovering && !prevState.isHovering) {\n            state.visibleShape.animate(\n                this.highlightStyle(),\n                50\n            );\n        } else if (!state.isHovering && prevState.isHovering) {\n            state.visibleShape.animate(\n                this.normalStyle(),\n                50\n            );\n        }\n    },\n};\n\ndraw.standard = [draw.basic, draw.labels, draw.highlight];\n\n\nconst remove = {\n    basic: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.remove();\n        }\n    },\n    labels: function() {\n        const labels = [this.state._labeledSides, this.state._labeledVertices,\n            this.state._labeledAngles, this.state._labelCache];\n\n        _.each(labels, function(labelType) {\n            if (labelType != null && labelType.length) {\n                _.invoke(labelType, \"remove\");\n            }\n        });\n    },\n};\n\nremove.standard = [remove.basic, remove.labels];\n\n\nconst constraints = {\n    fixed: function() {\n        return function() {\n            return false;\n        };\n    },\n\n    snap: function(snap) {\n        return function(coord) {\n            if (snap === null) {\n                return true;\n            }\n            snap = snap || this.graphie.snap;\n            return kpoint.roundTo(coord, snap);\n        };\n    },\n\n    bound: function(range, snap, paddingPx) {\n        if (paddingPx === undefined) {\n            if (range === undefined) {\n                paddingPx = 10;\n            } else {\n                paddingPx = 0;\n            }\n        }\n        return function(coord, prevCoord) {\n            const graphie = this.graphie;\n            const delta = kvector.subtract(coord, prevCoord);\n            const range = range || graphie.range;\n            // A null snap means no snap; an undefined snap means\n            // default to graphie's\n            if (snap === undefined) {\n                snap = graphie.snap;\n            }\n\n            // Calculate the bounds for both points\n            let absoluteLower = graphie.unscalePoint([\n                paddingPx,\n                graphie.ypixels - paddingPx,\n            ]);\n            let absoluteUpper = graphie.unscalePoint([\n                graphie.xpixels - paddingPx,\n                paddingPx,\n            ]);\n            if (snap) {\n                absoluteLower = kpoint.ceilTo(absoluteLower, snap);\n                absoluteUpper = kpoint.floorTo(absoluteUpper, snap);\n            }\n\n            // Calculate the bounds for the delta.\n            const deltaBounds = _.map(this.coords(), function(coord, i) {\n                const max = kvector.subtract(absoluteUpper, coord);\n                const min = kvector.subtract(absoluteLower, coord);\n                return [min, max];\n            });\n\n            // bound the delta by the calculated bounds\n            const boundedDelta = _.reduce(\n                deltaBounds,\n                function(delta, bound) {\n                    const lower = bound[0];\n                    const upper = bound[1];\n                    const deltaX = Math.max(\n                        lower[0], Math.min(upper[0], delta[0])\n                    );\n                    const deltaY = Math.max(\n                        lower[1], Math.min(upper[1], delta[1])\n                    );\n                    return [deltaX, deltaY];\n                },\n                delta\n            );\n\n            return kvector.add(prevCoord, boundedDelta);\n        };\n    },\n};\n\nconstraints.standard = null;\n\n\nconst onMove = {\n    updatePoints: function(coord, prevCoord) {\n        const actualDelta = kvector.subtract(coord, prevCoord);\n        _.each(this.state.points, function(point) {\n            point.setCoord(kvector.add(\n                point.coord(),\n                actualDelta\n            ));\n        });\n    },\n};\n\nonMove.standard = null;\n\n\n_module_.exports = {\n    add: add,\n    modify: modify,\n    draw: draw,\n    remove: remove,\n\n    onMoveStart: {standard: null},\n    constraints: constraints,\n    onMove: onMove,\n    onMoveEnd: {standard: null},\n    onClick: {standard: null},\n};\nexport default _module_.exports;\n","import _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _objective_Js from \"./objective_.js\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _movablePolygonOptionsJs from \"./movable-polygon-options.js\";\nimport _underscore from \"underscore\";\nimport _kmath from \"kmath\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Creates and adds a polygon to the graph that can be dragged around.\n * It allows constraints on its movement and draws when moves happen.\n */\nconst kvector = _kmath.vector;\nconst _ = _underscore;\n\nconst MovablePolygonOptions = _movablePolygonOptionsJs;\nconst InteractiveUtil = _interactiveUtilJs;\nconst objective_ = _objective_Js;\nconst assert = InteractiveUtil.assert;\nconst normalizeOptions = InteractiveUtil.normalizeOptions;\nconst KhanColors = _utilColorsJs;\nconst GraphUtils = _utilGraphUtilsJs;\n\n// State parameters that should be converted into an array of\n// functions\nconst FUNCTION_ARRAY_OPTIONS = _.keys(MovablePolygonOptions);\n\n// Default \"props\" and \"state\". Both are added to this.state and\n// receive magic getter methods (this.points() etc).\n// However, properties in DEFAULT_PROPS are updated on `modify()`,\n// while those in DEFAULT_STATE persist and are not updated.\n// Things that the user might want to change should be on \"props\",\n// while things used to render the point should be on \"state\".\nconst DEFAULT_PROPS = {\n    points: null,\n    angleLabels: [],\n    showRightAngleMarkers: [],\n    sideLabels: [],\n    vertexLabels: [],\n    numArcs: [],\n    numArrows: [],\n    numTicks: [],\n    closed: true,\n    static: false,\n    cursor: \"move\",\n    normalStyle: null,    // turned into an object in this.modify\n    highlightStyle: null, // likewise\n    labelStyle: null,     // likewise\n};\nconst DEFAULT_STATE = {\n    added: false,\n    hasMoved: false,\n    visibleShape: null,\n    mouseTarget: null,\n};\n\nconst MovablePolygon = function(graphie, movable, options) {\n    assert(graphie != null);\n    assert(options != null);\n\n    _.extend(this, {\n        graphie: graphie,\n        movable: movable,\n        state: {\n            // Set here because this must be unique for each instance\n            id: _.uniqueId(\"movablePolygon\"),\n        },\n    });\n\n    // We only set DEFAULT_STATE once, here\n    this.modify(_.extend({}, DEFAULT_STATE, options));\n};\n\n_.extend(MovablePolygon, MovablePolygonOptions);\nInteractiveUtil.createGettersFor(MovablePolygon, _.extend({},\n    DEFAULT_PROPS,\n    DEFAULT_STATE\n));\nInteractiveUtil.addMovableHelperMethodsTo(MovablePolygon);\n\n_.extend(MovablePolygon.prototype, {\n\n    cloneState: function() {\n        return _.extend(this.movable.cloneState(), this.state);\n    },\n\n    _createDefaultState: function() {\n        return _.extend({\n            id: this.state.id,\n        }, normalizeOptions(\n            FUNCTION_ARRAY_OPTIONS,\n            // Defaults are copied from MovablePolygonOptions.*.standard\n            // These defaults are set here instead of DEFAULT_PROPS/STATE\n            // because they:\n            //    - are objects, not primitives (and need a deeper copy)\n            //    - they don't need getters created for them\n            // TODO(jack): Consider \"default\" once we es3ify perseus\n            objective_.pluck(MovablePolygonOptions, \"standard\")\n\n        // We only update props here, because we want things on state to\n        // be persistent, and updated appropriately in modify()\n        ), DEFAULT_PROPS);\n    },\n\n    /**\n     * Resets the object to its state as if it were constructed with\n     * `options` originally. state not on DEFAULT_PROPS is maintained.\n     *\n     * Analogous to React.js's replaceProps\n     */\n    modify: function(options) {\n        this.update(_.extend(this._createDefaultState(), options));\n    },\n\n    /**\n     * Adjusts constructor parameters without changing previous settings\n     * for any option not specified\n     *\n     * Analogous to React.js's setProps\n     */\n    update: function(options) {\n        const self = this;\n        const graphie = self.graphie;\n        const state = _.extend(\n            self.state,\n            normalizeOptions(FUNCTION_ARRAY_OPTIONS, options)\n        );\n\n        // Default things inside the state.normalStyle object, because\n        // _.extend is not deep.\n        // We use _.extend instead of _.defaults because we don't want\n        // to modify the passed-in copy (especially if it's from\n        // DEFAULT_PROPS/STATE!)\n        const normalColor = (state.static) ? KhanColors.DYNAMIC :\n                                           KhanColors.INTERACTIVE;\n        state.normalStyle = _.extend({}, state.normalStyle, {\n            \"stroke-width\": 2,\n            \"fill-opacity\": 0,\n            \"fill\": normalColor,\n            \"stroke\": normalColor,\n        }, options.normalStyle);\n\n        state.highlightStyle = _.extend({}, {\n            \"stroke\": KhanColors.INTERACTING,\n            \"stroke-width\": 2,\n            \"fill\": KhanColors.INTERACTING,\n            \"fill-opacity\": 0.05,\n        }, state.highlightStyle);\n\n        state.labelStyle = _.extend({}, {\n            \"stroke\": KhanColors.DYNAMIC,\n            \"stroke-width\": 1,\n            \"color\": KhanColors.DYNAMIC,\n        }, state.labelStyle);\n\n        if (!state.static) {\n            // the invisible shape in front of the point that gets mouse events\n            if (!state.mouseTarget) {\n                state.mouseTarget = graphie.mouselayer.path(this.path());\n                state.mouseTarget.attr({fill: \"#000\", opacity: 0,\n                    cursor: \"move\"});\n            }\n        }\n\n        // The Movable representing this MovablePolygon's representation\n        // This handles mouse events for us, which we propagate in\n        // onMove. The onMoveStart-onMove-onMoveEnd logic is borrowed from\n        // movable-line.js.\n        self.movable.modify(_.extend({}, state, {\n            modify: null,\n            draw: self.draw.bind(self),\n            remove: null,\n            onMoveStart: function() {\n                self._initialRefCoord = self.coord(0);\n                self._prevRefCoord = self._initialRefCoord;\n                self._totalDelta = [0, 0];\n\n                self._fireEvent(self.state.onMoveStart,\n                    self.coord(0),\n                    self.coord(0)\n                );\n            },\n            onMove: function(mouseCoord, prevMouseCoord) {\n                const delta = kvector.subtract(mouseCoord, prevMouseCoord);\n                self._totalDelta = kvector.add(self._totalDelta, delta);\n                let refCoord = kvector.add(\n                    self._initialRefCoord, self._totalDelta\n                );\n\n                refCoord = self._applyConstraints(refCoord, self._prevRefCoord);\n                if (refCoord === false) {\n                    return;\n                }\n\n                self._fireEvent(\n                    self.state.onMove, refCoord, self._prevRefCoord\n                );\n                self._prevRefCoord = refCoord;\n            },\n            onMoveEnd: function() {\n                self._fireEvent(self.state.onMoveEnd,\n                    self._prevRefCoord,\n                    self._initialRefCoord\n                );\n            },\n        }));\n\n        // Update the polygon with the points' movement\n        _.invoke(state.points, \"listen\", \"onMove\", state.id,\n            self.draw.bind(self));\n\n        // Trigger an add event if this hasn't been added before\n        if (!state.added) {\n            self.prevState = {};\n            self._fireEvent(state.add, self.cloneState(), self.prevState);\n            state.added = true;\n\n            // Update the state for `added` and in case the add event\n            // changed it\n            self.prevState = self.cloneState();\n        }\n\n        // Trigger a modify event\n        self._fireEvent(state.modify, self.cloneState(), self.prevState);\n    },\n\n    path: function(state) {\n        const graphie = this.graphie;\n        state = state || this.state;\n\n        let coords = _.map(state.points, function(point) {\n            return graphie.scalePoint(point.coord());\n        });\n\n        // Create path\n        if (state.closed) {\n            coords.push(true);\n        } else {\n            // For open polygons, concatenate a reverse of the path,\n            // to remove the inside area of the path, which would\n            // otherwise be clickable (even if the closing line segment\n            // wasn't drawn\n            coords = coords.concat(\n                _.clone(coords).reverse()\n            );\n        }\n\n        return GraphUtils.unscaledSvgPath(coords);\n    },\n\n    coords: function() {\n        return _.invoke(this.state.points, \"coord\");\n    },\n\n    point: function(index) {\n        return this.state.points[index];\n    },\n\n    coord: function(index) {\n        return this.point(index).coord();\n    },\n\n    remove: function() {\n        this.state.added = false;\n        this._fireEvent(this.state.remove);\n        if (this.state.points) {\n            _.invoke(this.state.points, \"unlisten\", \"onMove\", this.state.id);\n        }\n\n        if (this.movable) {\n            // We need this to be guarded because it is called on the initial\n            // constructor/modify call, before this.movable is created\n            this.movable.remove();\n        }\n\n        // TODO(jack): This should really be moved off of\n        // movablePolygon.state and only kept on movable.state\n        this.state.mouseTarget = null;\n    },\n\n    constrain: function() {\n        if (this.points == null || this.points.length === 0) {\n            return;\n        }\n\n        const prevRefCoord = this.coord(0);\n        const refCoord = this._applyConstraints(prevRefCoord, prevRefCoord);\n        if (refCoord !== false) {\n            this._fireEvent(this.state.onMove, refCoord, prevRefCoord);\n        }\n    },\n\n    // Clone these for use with raphael, which modifies the input\n    // style parameters\n    normalStyle: function() {\n        return _.clone(this.state.normalStyle);\n    },\n\n    highlightStyle: function() {\n        return _.clone(this.state.highlightStyle);\n    },\n\n    // Change z-order to back\n    toBack: function() {\n        this.movable.toBack();\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toBack();\n        }\n    },\n\n    // Change z-order to front\n    toFront: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toFront();\n        }\n        this.movable.toFront();\n    },\n\n    /**\n     * Forwarding methods to this.movable:\n     */\n    isHovering: function() {\n        return this.movable.isHovering();\n    },\n\n    isDragging: function() {\n        return this.movable.isDragging();\n    },\n\n    mouseTarget: function() {\n        return this.movable.mouseTarget();\n    },\n});\n\n_module_.exports = MovablePolygon;\nexport default _module_.exports;\n","import _utilMathJs from \"../util/math.js\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _wrappedPathJs from \"./wrapped-path.js\";\nimport _wrappedLineJs from \"./wrapped-line.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A library of options to pass to add/draw/remove/constraints\n */\nconst _ = _underscore;\nconst WrappedLine = _wrappedLineJs;\nconst WrappedPath = _wrappedPathJs;\nconst kvector = _kmath.vector;\nconst kpoint = _kmath2.point;\nconst KhanMath = _utilMathJs;\n\n/**\n * Helper functions\n */\nconst getScaledAngle = function(line) {\n    const scaledA = line.graphie.scalePoint(line.coord(0));\n    const scaledZ = line.graphie.scalePoint(line.coord(1));\n    return kvector.polarDegFromCart(\n        kvector.subtract(\n            scaledZ,\n            scaledA\n        )\n    )[1];\n};\n\n// Given `coord` and `angle`, find the point where a line extended\n// from `coord` in the direction of `angle` would be clipped by the\n// edge of the graphie canvas. Then draw an arrowhead at that point\n// pointing in the direction of `angle`.\nconst getClipPoint = function(graph, coord, angle) {\n    // Actually put the arrowheads 4px from the edge so they have\n    // a bit of room\n    const xExtent = graph.range[0][1] - graph.range[0][0];\n    const yExtent = graph.range[1][1] - graph.range[1][0];\n\n    // shoot a point off into the distance ...\n    const distance = xExtent + yExtent;\n    // we need to scale the point according to the scale of the axes\n    const angleVec = graph.unscaleVector(\n        kvector.cartFromPolarDeg([1, angle])\n    );\n    const distVec = kvector.scale(\n        kvector.normalize(angleVec),\n        distance\n    );\n    const farCoord = kvector.add(coord, distVec);\n    const scaledAngle = kvector.polarDegFromCart(angleVec)[1];\n    // ... and then bring it back\n    const clipPoint = graph.constrainToBoundsOnAngle(farCoord, 4,\n                                  scaledAngle * Math.PI / 180);\n    return clipPoint;\n};\n\n// Given `coord` and `angle`, find the point where a line extended\n// from `coord` in the direction of `angle` would be clipped by the\n// edge of the graphie canvas. Then draw an arrowhead at that point\n// pointing in the direction of `angle`.\nconst createArrow = function(graph, style) {\n    // Points that define the arrowhead\n    const center = [0.75, 0];\n    let points = [\n        [-3, 4],\n        [-2.75, 2.5],\n        [0, 0.25],\n        center,\n        [0, -0.25],\n        [-2.75, -2.5],\n        [-3, -4],\n    ];\n\n    // Scale points by 1.4 around (0.75, 0)\n    const scale = 1.4;\n    points = _.map(points, function(point) {\n        const pv = kvector.subtract(point, center);\n        const pvScaled = kvector.scale(pv, scale);\n        return kvector.add(center, pvScaled);\n    });\n\n    // We can't just pass in a path to `graph.fixedPath` as we need to modify\n    // the points in some way, so instead we provide a function for creating\n    // the path once the points have been transformed\n    const createCubicPath = function(points) {\n        let path = \"M\" + points[0][0] + \" \" + points[0][1];\n        for (let i = 1; i < points.length; i += 3) {\n            path += \"C\" + points[i][0] + \" \" + points[i][1] + \" \" +\n                          points[i + 1][0] + \" \" + points[i + 1][1] + \" \" +\n                          points[i + 2][0] + \" \" + points[i + 2][1];\n        }\n        return path;\n    };\n\n    // Create arrowhead\n    const unscaledPoints = _.map(points, graph.unscalePoint);\n    const options = {\n        center: graph.unscalePoint(center),\n        createPath: createCubicPath,\n    };\n    const arrowHead = new WrappedPath(graph, unscaledPoints, options);\n    arrowHead.attr(_.extend({\n        \"stroke-linejoin\": \"round\",\n        \"stroke-linecap\": \"round\",\n        \"stroke-dasharray\": \"\",\n    }, style));\n\n    // Add custom function for transforming arrowheads that accounts for\n    // center, scaling, etc.\n    arrowHead.toCoordAtAngle = function(coord, angle) {\n        const clipPoint = graph.scalePoint(getClipPoint(graph, coord, angle));\n        arrowHead.transform(\n            \"translateX(\" + (clipPoint[0] + scale * center[0]) + \"px) \" +\n            \"translateY(\" + (clipPoint[1] + scale * center[1]) + \"px) \" +\n            \"translateZ(0) \" +\n            \"rotate(\" + (360 - KhanMath.bound(angle)) + \"deg)\");\n    };\n\n    return arrowHead;\n};\n\n\n/**\n * MovableLine option functions\n */\nconst add = {\n    // We do this in add as well as in standard so that we can call\n    // pointsToFront after the first draw (which adds `this.visibleShape`)\n    draw: function() {\n        this.draw();\n    },\n\n    pointsToFront: function(state) {\n        _.invoke(state.points, \"toFront\");\n    },\n};\n\nadd.standard = [add.draw, add.pointsToFront];\n\nconst modify = {\n    draw: function() {\n        this.draw();\n    },\n};\n\nmodify.standard = [modify.draw];\n\nconst draw = {\n    basic: function(state) {\n        const graphie = this.graphie;\n        let start = this.coord(0);\n        let end = this.coord(1);\n\n        if (!this.state.visibleShape) {\n            const options = {\n                thickness: 10,\n            };\n            this.state.visibleShape = new WrappedLine(graphie, start, end,\n                options);\n            this.state.visibleShape.attr(this.normalStyle());\n            this.state.visibleShape.toFront();\n\n            if (this.mouseTarget()) {\n                this.mouseTarget().toFront();\n            }\n        }\n\n        // Compute angle\n        const angle = getScaledAngle(this);\n\n        // Extend start, end if necessary (i.e., if not a line segment)\n        if (state.extendLine) {\n            start = getClipPoint(graphie, start, 360 - angle);\n            end = getClipPoint(graphie, end, (540 - angle) % 360);\n        } else if (state.extendRay) {\n            end = getClipPoint(graphie, end, 360 - angle);\n        }\n\n        // Move elements\n        const elements = [this.state.visibleShape];\n\n        if (this.mouseTarget()) {\n            elements.push(this.mouseTarget());\n        }\n        _.each(elements, function(element) {\n            element.moveTo(start, end);\n        });\n    },\n\n    arrows: function(state) {\n        // Create arrows, if not yet created\n        if (this._arrows == null) {\n            this._arrows = [];\n            if (state.extendLine) {\n                this._arrows.push(createArrow(\n                    this.graphie, this.normalStyle()));\n                this._arrows.push(createArrow(\n                    this.graphie, this.normalStyle()));\n            } else if (state.extendRay) {\n                this._arrows.push(createArrow(\n                    this.graphie, this.normalStyle()));\n            }\n        }\n\n        // Transform arrows\n        const angle = getScaledAngle(this);\n        const angleForArrow = [360 - angle, (540 - angle) % 360];\n        _.each(this._arrows, function(arrow, i) {\n            arrow.toCoordAtAngle(this.coord(i), angleForArrow[i]);\n        }, this);\n    },\n\n    highlight: function(state, prevState) {\n        // TODO(jack): Figure out a way to highlight the points attached to\n        // the line. Maybe this means an additional isHovering: []\n        // function to state of movable/movablepoint to define [additional?]\n        // times it should be highlighted\n        if (state.isHovering && !prevState.isHovering) {\n            state.visibleShape.animate(\n                state.highlightStyle,\n                50\n            );\n        } else if (!state.isHovering && prevState.isHovering) {\n            state.visibleShape.animate(\n                state.normalStyle,\n                50\n            );\n        }\n    },\n};\n\ndraw.standard = [draw.basic, draw.arrows, draw.highlight];\n\n\nconst remove = {\n    basic: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.remove();\n        }\n    },\n\n    arrows: function() {\n        if (this._arrows != null) {\n            _.invoke(this._arrows, \"remove\");\n        }\n        this._arrows = null;\n    },\n};\n\nremove.standard = [remove.basic, remove.arrows];\n\n\nconst constraints = {\n    fixed: function() {\n        return function() {\n            return false;\n        };\n    },\n\n    snap: function(snap) {\n        return function(coord, prevCoord) {\n            if (snap === null) {\n                return true;\n            }\n            let delta = kvector.subtract(coord, prevCoord);\n            snap = snap || this.graphie.snap;\n            delta = kpoint.roundTo(delta, snap);\n            return kvector.add(prevCoord, delta);\n        };\n    },\n\n    bound: function(range, snap, paddingPx) {\n        if (paddingPx === undefined) {\n            if (range === undefined) {\n                paddingPx = 10;\n            } else {\n                paddingPx = 0;\n            }\n        }\n        return function(coord, prevCoord) {\n            const graphie = this.graphie;\n            const delta = kvector.subtract(coord, prevCoord);\n            const range = range || graphie.range;\n            // A null snap means no snap; an undefined snap means\n            // default to graphie's\n            if (snap === undefined) {\n                snap = graphie.snap;\n            }\n\n            // Calculate the bounds for both points\n            let absoluteLower = graphie.unscalePoint([\n                paddingPx,\n                graphie.ypixels - paddingPx,\n            ]);\n            let absoluteUpper = graphie.unscalePoint([\n                graphie.xpixels - paddingPx,\n                paddingPx,\n            ]);\n            if (snap) {\n                absoluteLower = kpoint.ceilTo(absoluteLower, snap);\n                absoluteUpper = kpoint.floorTo(absoluteUpper, snap);\n            }\n\n            // Calculate the bounds for the delta.\n            const deltaBounds = _.map(this.coords(), function(coord, i) {\n                const max = kvector.subtract(absoluteUpper, coord);\n                const min = kvector.subtract(absoluteLower, coord);\n                return [min, max];\n            });\n\n            // bound the delta by the calculated bounds\n            const boundedDelta = _.reduce(\n                deltaBounds,\n                function(delta, bound) {\n                    const lower = bound[0];\n                    const upper = bound[1];\n                    const deltaX = Math.max(\n                        lower[0], Math.min(upper[0], delta[0])\n                    );\n                    const deltaY = Math.max(\n                        lower[1], Math.min(upper[1], delta[1])\n                    );\n                    return [deltaX, deltaY];\n                },\n                delta,\n            );\n\n            return kvector.add(prevCoord, boundedDelta);\n        };\n    },\n};\n\nconstraints.standard = null;\n\n\nconst onMove = {\n    updatePoints: function(coord, prevCoord) {\n        const actualDelta = kvector.subtract(coord, prevCoord);\n        _.each(this.state.points, function(point) {\n            point.setCoord(kvector.add(\n                point.coord(),\n                actualDelta\n            ));\n        });\n    },\n};\n\nonMove.standard = null;\n\n\n_module_.exports = {\n    add: add,\n    modify: modify,\n    draw: draw,\n    remove: remove,\n\n    onMoveStart: {standard: null},\n    constraints: constraints,\n    onMove: onMove,\n    onMoveEnd: {standard: null},\n};\nexport default _module_.exports;\n","import _utilColorsJs from \"../util/colors.js\";\nimport _kmath from \"kmath\";\nimport _objective_Js from \"./objective_.js\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _wrappedLineJs from \"./wrapped-line.js\";\nimport _movableLineOptionsJs from \"./movable-line-options.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * MovableLine\n */\nconst _ = _underscore;\n\nconst MovableLineOptions = _movableLineOptionsJs;\nconst WrappedLine = _wrappedLineJs;\nconst InteractiveUtil = _interactiveUtilJs;\nconst objective_ = _objective_Js;\nconst assert = InteractiveUtil.assert;\nconst normalizeOptions = InteractiveUtil.normalizeOptions;\n\nconst kvector = _kmath.vector;\nconst KhanColors = _utilColorsJs;\n\nconst FUNCTION_ARRAY_OPTIONS = [\n    \"add\",\n    \"draw\",\n    \"remove\",\n    \"onMoveStart\",\n    \"constraints\",\n    \"onMove\",\n    \"onMoveEnd\",\n];\n\n// Default \"props\" and \"state\". Both are added to this.state and\n// receive magic getter methods (this.cursor() etc).\n// However, properties in DEFAULT_PROPS are updated on `modify()`,\n// while those in DEFAULT_STATE persist and are not updated.\n// Things that the user might want to change should be on \"props\",\n// while things used to render the point should be on \"state\".\nconst DEFAULT_PROPS = {\n    points: null,\n    static: false,\n    cursor: \"move\",\n    normalStyle: null,     // turned into an object in this.modify\n    highlightStyle: null,  // likewise\n    extendLine: false,\n    extendRay: false,\n};\nconst DEFAULT_STATE = {\n    visibleShape: null,\n    mouseTarget: null,\n};\n\nconst MovableLine = function(graphie, movable, options) {\n    assert(graphie != null);\n    assert(options != null);\n\n    _.extend(this, {\n        graphie: graphie,\n        movable: movable,\n        state: {\n            // Set here because this must be unique for each instance\n            id: _.uniqueId(\"movableLine\"),\n        },\n    });\n\n    // We only set DEFAULT_STATE once, here\n    this.modify(_.extend({}, DEFAULT_STATE, options));\n};\n\n_.extend(MovableLine, MovableLineOptions);\nInteractiveUtil.createGettersFor(MovableLine, _.extend({},\n    DEFAULT_PROPS,\n    DEFAULT_STATE\n));\nInteractiveUtil.addMovableHelperMethodsTo(MovableLine);\n\n_.extend(MovableLine.prototype, {\n\n    cloneState: function() {\n        return _.extend(this.movable.cloneState(), {\n            coords: this.coords(),\n        }, this.state);\n    },\n\n    _createDefaultState: function() {\n        return _.extend({\n            id: this.state.id,\n        }, normalizeOptions(\n            FUNCTION_ARRAY_OPTIONS,\n            // Defaults are copied from MovableLineOptions.*.standard\n            // These defaults are set here instead of DEFAULT_PROPS/STATE\n            // because they:\n            //    - are objects, not primitives (and need a deeper copy)\n            //    - they don't need getters created for them\n            // TODO(jack): Consider \"default\" once we es3ify perseus\n            objective_.pluck(MovableLineOptions, \"standard\")\n        ), DEFAULT_PROPS);\n    },\n\n    /**\n     * Resets the object to its state as if it were constructed with\n     * `options` originally. state not on DEFAULT_PROPS is maintained.\n     *\n     * Analogous to React.js's replaceProps\n     */\n    modify: function(options) {\n        this.update(_.extend(this._createDefaultState(), options));\n    },\n\n    /**\n     * Adjusts constructor parameters without changing previous settings\n     * for any option not specified\n     *\n     * Analogous to React.js's setProps\n     */\n    update: function(options) {\n        const self = this;\n        const graphie = this.graphie;\n        const state = self.state = _.extend(\n            self.state,\n            normalizeOptions(FUNCTION_ARRAY_OPTIONS, options)\n        );\n\n        // Default things inside the state.normalStyle object, because\n        // _.extend is not deep.\n        // We use _.extend instead of _.defaults because we don't want\n        // to modify the passed-in copy (especially if it's from\n        // DEFAULT_PROPERTIES!)\n        const normalColor = (state.static) ? KhanColors.DYNAMIC :\n                                           KhanColors.INTERACTIVE;\n        state.normalStyle = _.extend({\n            stroke: normalColor,\n            \"stroke-width\": 2,\n        }, state.normalStyle);\n\n        state.highlightStyle = _.extend({\n            stroke: KhanColors.INTERACTING,\n            \"stroke-width\": 3,\n        }, state.highlightStyle);\n\n        if (!state.static) {\n            // the invisible shape in front of the line that gets mouse events\n            if (!state.mouseTarget) {\n                const options = {\n                    thickness: 30,\n                    mouselayer: true,\n                };\n                state.mouseTarget = new WrappedLine(graphie, this.coord(0),\n                    this.coord(1), options);\n                state.mouseTarget.attr({fill: \"#000\", \"opacity\": 0.0});\n            }\n        }\n\n        if (state.static && state.mouseTarget) {\n            // state.static was specified, remove any previously\n            // existing mousetarget (from a previous modify)\n            state.mouseTarget.remove();\n            state.mouseTarget = null;\n        }\n\n        // The movable that handles mouse events for us\n        self.movable.modify(_.extend({}, state, {\n            mouseTarget: state.mouseTarget,\n\n            // We null out the add/modify/remove to avoid propagating our\n            // state.add... to the movable, so that we can fire those\n            // events ourselves, rather than letting the movable handle\n            // them\n            add: null,\n            modify: null,\n            draw: self.draw.bind(self),\n            remove: null,\n\n            onMoveStart: function() {\n                self._initialRefCoord = self.coord(0);\n                self._prevRefCoord = self._initialRefCoord;\n                self._totalDelta = [0, 0];\n\n                self._fireEvent(self.state.onMoveStart,\n                    self.coord(0),\n                    self.coord(0)\n                );\n            },\n\n            onMove: function(mouseCoord, prevMouseCoord) {\n                const delta = kvector.subtract(mouseCoord, prevMouseCoord);\n                self._totalDelta = kvector.add(self._totalDelta, delta);\n                let refCoord = kvector.add(\n                    self._initialRefCoord, self._totalDelta\n                );\n\n                refCoord = self._applyConstraints(refCoord, self._prevRefCoord);\n                if (refCoord === false) {\n                    return;\n                }\n\n                self._fireEvent(\n                    self.state.onMove, refCoord, self._prevRefCoord\n                );\n                self._prevRefCoord = refCoord;\n            },\n\n            onMoveEnd: function() {\n                self._fireEvent(self.state.onMoveEnd,\n                    self._prevRefCoord,\n                    self._initialRefCoord\n                );\n            },\n        }));\n\n        // Trigger an add event if this hasn't been added before\n        if (!state.added) {\n            self.prevState = {};\n            self._fireEvent(state.add, self.cloneState(), self.prevState);\n            state.added = true;\n\n            // Update the line with the points' movement\n            _.invoke(state.points, \"listen\", \"onMove\", state.id,\n                    self.draw.bind(self));\n\n            // Update the state for `added` and in case the add event\n            // changed it\n            self.prevState = self.cloneState();\n        }\n\n        // Trigger a modify event\n        self._fireEvent(state.modify, self.cloneState(), self.prevState);\n    },\n\n    coords: function() {\n        return _.invoke(this.state.points, \"coord\");\n    },\n\n    point: function(index) {\n        return this.state.points[index];\n    },\n\n    coord: function(index) {\n        return this.point(index).coord();\n    },\n\n    remove: function() {\n        this.state.added = false;\n        this._fireEvent(this.state.remove);\n        if (this.points) {\n            _.invoke(this.points, \"unlisten\", \"onMove\", this.state.id);\n        }\n\n        if (this.movable) {\n            // We need this to be guarded because it is called on the initial\n            // constructor/modify call, before this.movable is created\n            this.movable.remove();\n        }\n    },\n\n    // Change z-order to back\n    toBack: function() {\n        this.movable.toBack();\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toBack();\n        }\n    },\n\n    // Change z-order to front\n    toFront: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toFront();\n        }\n        this.movable.toFront();\n    },\n\n    /**\n     * Forwarding methods to this.movable:\n     */\n    isHovering: function() {\n        return this.movable.isHovering();\n    },\n\n    isDragging: function() {\n        return this.movable.isDragging();\n    },\n\n    mouseTarget: function() {\n        return this.movable.mouseTarget();\n    },\n});\n\n_module_.exports = MovableLine;\nexport default _module_.exports;\n","/**\n * Icon paths to be used with `inline-icon.jsx`.\n *\n * These paths are taken directly from webapp's `icon-paths.js`. Unlike the\n * webapp equivalent, these can be directly required within Perseus files since\n * this is all bundled together anyway.\n */\n\n/* eslint-disable max-len */\nexport const iconCheck = {\n        path: `M8.70710678,12.2928932 C8.31658249,11.9023689 7.68341751,11.9023689 7.29289322,12.2928932 C6.90236893,12.6834175 6.90236893,13.3165825 7.29289322,13.7071068 L9.82842712,16.2426407 C10.2207367,16.6349502 10.8574274,16.6328935 11.2471942,16.2380576 L16.7116603,10.7025237 C17.0996535,10.3094846 17.0955629,9.67633279 16.7025237,9.28833966 C16.3094846,8.90034653 15.6763328,8.90443714 15.2883397,9.29747629 L10.5309507,14.1167372 L8.70710678,12.2928932 Z`,\n        width: 24,\n        height: 24,\n};\nexport const iconChevronDown = {\n        path:\n            \"M99.669 13.048q0 3.36-2.352 5.712l-41.664 41.664q-2.408 2.408-5.88 2.408t-5.712-2.408l-41.664-41.664q-2.408-2.24-2.408-5.712t2.408-5.88l4.76-4.816q2.52-2.352 5.88-2.352t5.656 2.352l31.136 31.136 31.08-31.136q2.352-2.352 5.712-2.352t5.88 2.352l4.816 4.816q2.352 2.52 2.352 5.88z\",\n        width: 100,\n        height: 63.034,\n};\nexport const iconChevronRight = {\n        path:\n            \"M62.808 49.728q0 3.36-2.352 5.88l-41.72 41.664q-2.352 2.408-5.768 2.408t-5.768-2.408l-4.872-4.76q-2.352-2.52-2.352-5.88t2.352-5.712l31.08-31.136-31.08-31.024q-2.352-2.52-2.352-5.88t2.352-5.712l4.872-4.76q2.296-2.408 5.768-2.408t5.768 2.408l41.72 41.664q2.352 2.296 2.352 5.656z\",\n        width: 63.034,\n        height: 100,\n};\nexport const iconCircle = {\n        path:\n            \"M100.035 50.046q.057 13.623-6.669 25.137t-18.24 18.183-25.08 6.669-25.137-6.726q-11.514-6.726-18.183-18.183-6.726-11.571-6.726-25.137t6.726-25.08 18.24-18.24 25.08-6.669q13.566 0 25.08 6.726 11.514 6.669 18.24 18.183t6.669 25.137z\",\n        width: 100,\n        height: 100,\n};\nexport const iconCircleArrowDown = {\n        path:\n            \"M50.046 83.676q1.767 0 2.907-1.14l29.526-29.526q1.197-1.197 1.197-2.907t-1.197-2.964l-5.928-5.928q-1.197-1.14-2.964-1.14t-2.907 1.14l-12.312 12.312l0-32.661q0-1.71-1.254-2.964t-2.907-1.254l-8.322 0q-1.71 0-2.964 1.254t-1.254 2.964l0 32.661l-12.312-12.312q-1.197-1.254-2.907-1.254t-2.907 1.254l-5.928 5.928q-1.197 1.197-1.197 2.964t1.197 2.907l29.469 29.526q1.197 1.14 2.964 1.14zm49.989-33.63q.057 13.623-6.669 25.137t-18.24 18.183-25.08 6.669-25.137-6.726q-11.514-6.726-18.183-18.183-6.726-11.571-6.726-25.137t6.726-25.08 18.24-18.24 25.08-6.669q13.566 0 25.08 6.726 11.514 6.669 18.24 18.183t6.669 25.137z\",\n        width: 100,\n        height: 100,\n};\nexport const iconCircleArrowUp = {\n        path:\n            \"M54.207 83.391q1.653 0 2.907-1.254t1.254-2.907l0-32.718l12.312 12.312q1.254 1.254 2.964 1.254t2.907-1.254l5.928-5.928q1.197-1.197 1.14-2.964 0-1.767-1.14-2.907l-29.526-29.526q-1.197-1.14-2.907-1.14t-2.964 1.14l-29.469 29.526q-1.197 1.254-1.197 2.964t1.197 2.907l5.928 5.928q1.197 1.197 2.907 1.197t2.907-1.197l12.312-12.312l0 32.718q0 1.653 1.254 2.907t2.964 1.254l8.322 0zm45.828-33.345q.057 13.623-6.669 25.137t-18.24 18.183-25.08 6.669-25.137-6.726q-11.514-6.726-18.183-18.183-6.726-11.571-6.726-25.137t6.726-25.08 18.24-18.24 25.08-6.669q13.566 0 25.08 6.726 11.514 6.669 18.24 18.183t6.669 25.137z\",\n        width: 100,\n        height: 100,\n};\nexport const iconCircleThin = {\n        path:\n            \"M50.046 8.322q-8.493 0-16.188 3.306-15.561 6.669-22.173 22.23-3.363 7.695-3.363 16.188t3.306 16.188 8.949 13.281q5.586 5.586 13.281 8.892t16.188 3.306 16.188-3.306 13.281-8.892 8.892-13.281 3.306-16.188-3.306-16.188-8.892-13.281-13.281-8.949q-7.695-3.306-16.188-3.306zm0 91.713q-13.623 0-25.137-6.726t-18.183-18.183q-6.726-11.571-6.726-25.137t6.726-25.08 18.24-18.24 25.08-6.669q13.566 0 25.08 6.726 11.514 6.669 18.24 18.183t6.726 25.137-6.726 25.137-18.24 18.126q-11.514 6.726-25.08 6.726z\",\n        width: 100,\n        height: 99.944,\n};\nexport const iconDesktop = {\n        path:\n            \"M94.208 52.119l0-43.746q0-.69-.506-1.15t-1.196-.506l-84.088 0q-.69 0-1.196.506t-.506 1.15l0 43.746q0 .69.506 1.196t1.196.506l84.088 0q.69 0 1.196-.506t.506-1.196zm6.716-43.746l0 57.224q0 3.45-2.484 5.934t-5.934 2.484l-28.566 0q0 3.128 2.53 7.774.828 1.61.828 2.622t-1.012 2.07q-1.012 1.012-2.346.966l-26.91 0q-1.38 0-2.392-1.012t-1.012-2.024q0-1.058 1.656-4.14t1.748-6.256l-28.612 0q-3.45 0-5.934-2.484t-2.484-5.934l0-57.224q0-3.45 2.484-5.934t5.934-2.438l84.088 0q3.45 0 5.98 2.438 2.438 2.484 2.438 5.934z\",\n        width: 100,\n        height: 86.648,\n};\nexport const iconDropdownArrow = {\n        path:\n            \"M9 9.8c0 .5.7 1.7 1.5 2.8 1.5 1.9 1.5 1.9 3 0C15.7 9.7 15.4 9 12 9c-1.6 0-3 .4-3 .8z\",\n        width: 24,\n        height: 24,\n};\nexport const iconExclamationSign = {\n        path:\n            \"M58.368 81.225l0-12.369q0-.912-.57-1.539t-1.425-.627l-12.54 0q-.855-.057-1.482.627t-.684 1.539l0 12.369q-.057.855.627 1.482t1.539.684l12.54 0q.855 0 1.425-.627t.57-1.539zm1.026-62.871q0-1.596-2.223-1.71l-14.307 0q-2.109 0-2.223 1.71l1.14 40.47q0 .627.627 1.14t1.539.456l12.084 0q.912-.057 1.539-.513t.684-1.083zm-9.348-18.354q13.566 0 25.08 6.726 11.514 6.669 18.24 18.183t6.726 25.137-6.726 25.137-18.24 18.183-25.08 6.669-25.137-6.726q-11.514-6.726-18.183-18.183-6.726-11.571-6.726-25.137t6.726-25.08 18.24-18.24 25.08-6.669z\",\n        width: 100,\n        height: 99.944,\n};\n    // Grabbed from https://github.com/encharm/Font-Awesome-SVG-PNG\nexport const iconGear = {\n        path:\n            \"M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z\",\n        width: 1792,\n        height: 1792,\n};\nexport const iconMobilePhone = {\n        path:\n            \"M36.04 89.557q0-2.584-1.836-4.42t-4.42-1.836-4.352 1.836q-1.836 1.836-1.836 4.42t1.836 4.352 4.42 1.836q2.652-.068 4.42-1.836t1.768-4.352zm16.184-12.444l0-54.74q0-1.088-.748-1.768t-1.768-.68l-39.78 0q-1.088 0-1.768.748t-.68 1.7l0 54.74q0 1.02.748 1.768t1.7.68l39.78 0q1.02-.068 1.768-.748t.748-1.7zm-14.892-65.892q0-1.224-1.292-1.292l-12.444 0q-1.224.068-1.224 1.292t1.224 1.224l12.444 0q1.292 0 1.292-1.224zm22.372-1.292l0 79.628q0 3.944-2.992 6.936t-7.004 2.992l-39.78 0q-4.012 0-7.004-2.924-2.924-2.924-2.924-7.004l0-79.628q0-4.012 2.924-6.936t7.004-2.992l39.78 0q4.012-.068 7.004 2.924t2.992 7.004z\",\n        width: 60.013,\n        height: 100,\n};\nexport const iconOk = {\n        path:\n            \"M37.964 76.048q-2.576 0-4.368-1.792l-31.864-31.864q-1.792-1.792-1.792-4.368t1.792-4.368l8.736-8.68q1.792-1.792 4.368-1.792t4.312 1.792l18.816 18.872 42-42.056q1.792-1.792 4.368-1.792t4.312 1.792l8.736 8.736q1.792 1.792 1.792 4.368t-1.792 4.312l-55.048 55.048q-1.792 1.792-4.368 1.792z\",\n        width: 100,\n        height: 76.637,\n};\nexport const iconPlus = {\n        path:\n            \"M99.758 43.09l0 13.578q0 2.852-1.984 4.836t-4.836 1.984l-29.45 0l0 29.45q0 2.852-1.984 4.836t-4.836 1.984l-13.578 0q-2.852 0-4.836-1.984t-1.984-4.836l0-29.45l-29.45 0q-2.852 0-4.836-1.984t-1.984-4.836l0-13.578q0-2.852 1.984-4.836t4.836-1.984l29.45 0l0-29.45q0-2.852 1.984-4.836t4.836-1.984l13.578 0q2.852 0 4.836 1.984t1.984 4.836l0 29.45l29.45 0q2.852 0 4.836 1.984t1.984 4.836z\",\n        width: 100,\n        height: 100,\n};\nexport const iconRemove = {\n        path:\n            \"M100.464 80.808q0 3.404-2.368 5.772l-11.47 11.544q-2.368 2.368-5.772 2.368t-5.698-2.368l-24.864-24.864-24.864 24.864q-2.368 2.368-5.772 2.368t-5.772-2.368l-11.47-11.544q-2.368-2.368-2.368-5.772t2.368-5.698l24.864-24.864-24.864-24.864q-2.368-2.368-2.368-5.772t2.368-5.772l11.47-11.47q2.368-2.368 5.772-2.368t5.772 2.368l24.864 24.864 24.864-24.864q2.294-2.368 5.698-2.368t5.772 2.368l11.47 11.47q2.368 2.368 2.368 5.772t-2.368 5.772l-24.864 24.864 24.864 24.864q2.368 2.294 2.368 5.698z\",\n        width: 100,\n        height: 100,\n};\nexport const iconStar = {\n        path:\n            \"M15.1052249,9.55978547 L22.0028147,9.55978545 C23.6568673,9.55978545 23.9349557,10.3753626 22.6181351,11.3858845 L16.9943688,15.7015366 L19.2518801,22.8294455 C19.7526645,24.4106317 19.0984455,24.8825885 17.769353,23.8673293 L12.0490577,19.4977438 L6.5116497,23.8422153 C5.20921411,24.8640642 4.53299569,24.4067544 5.00266927,22.8160582 L7.10332364,15.7015366 L1.42794544,11.3634306 C0.110226041,10.3562014 0.383967283,9.54239221 2.0409646,9.54574013 L8.9924676,9.55978547 L11.1485117,2.72669438 C11.6458693,1.15043244 12.4548928,1.15900049 12.9494787,2.72669438 L15.1052249,9.55978547 Z\",\n        width: 24,\n        height: 24,\n};\nexport const iconTryAgain = {\n        path:\n            \"M3.74890556,17.9799506 C2.19251241,16.1970909 1.10103636,13.4971457 1.13090903,11.1491783 C1.17160478,7.95052637 4.01704076,0.865059407 11.7028044,0.865059407 C19.388568,0.865059407 22.3026521,7.35203035 22.3026521,11.5879453 C22.3026521,15.8238603 19.386629,20.5574509 13.6832464,21.7131548 L13.6757539,17.3722171 C17.0812986,16.2190517 18.331158,14.1944123 18.3311578,11.5879451 C18.3311574,8.16554692 15.6664205,5.03476549 11.7028048,5.20494205 C7.73918903,5.37511861 5.59244567,8.66930079 5.59244567,11.1491783 C5.59244567,12.9090077 6.11128139,14.1753512 6.93640437,15.3053215 L8.14052356,14.2949456 C8.98559348,13.5858477 9.6994861,13.9070448 9.73489556,15.0076413 L9.91284941,20.5388014 C9.94832683,21.6415103 9.09967118,22.3514475 8.02194403,22.1254594 L2.60571602,20.9897332 C1.5259204,20.7633114 1.34338662,19.9984207 2.18070755,19.295825 L3.74890556,17.9799506 Z\",\n        width: 23,\n        height: 23,\n};\nexport const iconTablet = {\n        path:\n            \"M45.322 90.706q0-1.86-1.302-3.224-1.364-1.364-3.224-1.364t-3.224 1.364-1.302 3.224q0 1.86 1.364 3.224 1.302 1.364 3.162 1.302 1.86.062 3.224-1.302t1.302-3.224zm27.218-11.346l0-68.014q0-.93-.682-1.612t-1.55-.682l-58.962 0q-.93 0-1.612.682t-.682 1.612l0 68.014q0 .93.682 1.612t1.612.62l58.962 0q.992-.062 1.612-.682t.62-1.55zm9.114-68.014l0 77.066q0 4.65-3.348 7.998t-7.998 3.348l-58.962 0q-4.65 0-7.998-3.348t-3.348-7.998l0-77.066q0-4.65 3.348-7.998t7.998-3.348l58.962 0q4.65 0 7.998 3.348t3.348 7.998z\",\n        width: 81.852,\n        height: 100,\n};\nexport const iconTrash = {\n        path:\n            \"M31.293 37.506q2.052 0 2.052 2.109l0 37.506q0 1.995-2.052 2.109l-4.218 0q-.912-.057-1.482-.627t-.57-1.482l0-37.506q0-2.109 2.052-2.109l4.218 0zm18.753 2.109l0 37.506q0 .912-.57 1.482t-1.539.627l-4.161 0q-1.995 0-2.109-2.109l0-37.506q.057-.912.627-1.482t1.482-.627l4.161 0q.969.057 1.539.627t.57 1.482zm14.592-2.109q2.052 0 2.052 2.109l0 37.506q0 1.995-2.052 2.109l-4.161 0q-.969-.057-1.539-.627t-.57-1.482l0-37.506q0-2.109 2.109-2.109l4.161 0zm10.431 49.248l0-61.731l-58.368 0l0 61.731q.057 2.679.969 3.819t1.083 1.14l54.207 0q.171 0 1.14-1.083t.969-3.876zm-43.776-70.11l29.184 0l-3.135-7.581q-.456-.57-1.14-.741l-20.634 0q-.627.114-1.083.741zm-31.293 2.109q0-1.995 2.109-2.109l20.121 0l4.56-10.83q.969-2.394 3.477-4.104 2.565-1.71 5.187-1.71l20.805 0q2.622 0 5.187 1.71t3.477 4.104l4.56 10.83l20.178 0q.912.057 1.482.627t.57 1.482l0 4.161q0 1.995-2.052 2.109l-6.27 0l0 61.731q0 5.415-3.078 9.348t-7.353 3.933l-54.207 0q-4.275 0-7.353-3.819t-3.078-9.177l0-62.016l-6.213 0q-.969 0-1.539-.57t-.57-1.539l0-4.161z\",\n        width: 91.681,\n        height: 100,\n};\nexport const iconUndo = {\n        path:\n            \"M10,6.6C10,7.2,9.8,8,9.3,9.1c0,0,0,0.1-0.1,0.1S9.2,9.3,9.2,9.4c0,0,0,0.1-0.1,0.1C9,9.6,9,9.6,8.9,9.6 c-0.1,0-0.1,0-0.1-0.1c0,0,0-0.1,0-0.1c0,0,0-0.1,0-0.1s0-0.1,0-0.1c0-0.3,0-0.5,0-0.7c0-0.4,0-0.7-0.1-1C8.6,7.1,8.5,6.9,8.4,6.7S8.2,6.3,8,6.1C7.8,5.9,7.6,5.8,7.4,5.7S6.9,5.5,6.7,5.5S6.1,5.4,5.8,5.4c-0.3,0-0.6,0-1,0H3.6v1.4c0,0.1,0,0.2-0.1,0.3C3.4,7.1,3.3,7.1,3.2,7.1C3.1,7.1,3,7.1,3,7L0.1,4.1C0,4.1,0,4,0,3.9s0-0.2,0.1-0.3L3,0.8C3,0.7,3.1,0.7,3.2,0.7c0.1,0,0.2,0,0.3,0.1C3.5,0.9,3.6,0.9,3.6,1v1.4h1.2c2.6,0,4.3,0.7,4.9,2.2C9.9,5.2,10,5.8,10,6.6z\",\n        width: 10,\n        height: 10,\n};\nexport const iconMinus = {\n        path: `M8,13 L16,13 C16.5522847,13 17,12.5522847 17,12 C17,11.4477153 16.5522847,11 16,11 L8,11 C7.44771525,11 7,11.4477153 7,12 C7,12.5522847 7.44771525,13 8,13 Z`,\n        width: 24,\n        height: 24,\n};\n","import _kmath from \"kmath\";\nimport _wrappedEllipseJs from \"./wrapped-ellipse.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A library of options to pass to add/draw/remove/constraints\n */\nconst _ = _underscore;\n\nconst WrappedEllipse = _wrappedEllipseJs;\nconst kpoint = _kmath.point;\n\nconst add = {\n    constrain: function() {\n        this.constrain();\n    },\n};\n\nadd.standard = [add.constrain];\n\n\nconst modify = {\n    draw: function() {\n        this.draw();\n    },\n};\n\nmodify.standard = [modify.draw];\n\n\nconst draw = {\n    basic: function(state, prevState) {\n        const graphie = this.graphie;\n        if (!this.state.visibleShape) {\n            const radii = [\n                this.pointSize() / graphie.scale[0],\n                this.pointSize() / graphie.scale[1],\n            ];\n            const options = {\n                maxScale: Math.max(\n                    this.highlightStyle().scale, this.normalStyle().scale),\n                // Add in 10px of padding to avoid clipping at the edges.\n                padding: 10,\n                shadow: state.shadow,\n            };\n            this.state.visibleShape = new WrappedEllipse(graphie, this.coord(),\n                radii, options);\n\n            this.state.visibleShape.attr(_.omit(this.normalStyle(), \"scale\"));\n            this.state.visibleShape.toFront();\n\n            // Keep mouseTarget in front of visible shape\n            if (this.mouseTarget()) {\n                this.mouseTarget().toFront();\n            }\n        }\n        if (state.normalStyle !== prevState.normalStyle &&\n                !_.isEqual(state.normalStyle, prevState.normalStyle)) {\n            this.state.visibleShape.attr(this.normalStyle());\n        }\n\n        this.state.visibleShape.moveTo(this.coord());\n        if (this.mouseTarget()) {\n            this.mouseTarget().moveTo(this.coord());\n        }\n    },\n\n    highlight: function(state, prevState) {\n        if (state.isHovering && !prevState.isHovering) {\n            state.visibleShape.animate(\n                this.highlightStyle(),\n                50\n            );\n        } else if (!state.isHovering && prevState.isHovering) {\n            state.visibleShape.animate(\n                this.normalStyle(),\n                50\n            );\n        }\n    },\n};\n\ndraw.standard = [draw.basic, draw.highlight];\n\n\nconst remove = {\n    basic: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.remove();\n            this.state.visibleShape = null;\n        }\n    },\n};\n\nremove.standard = remove.basic;\n\n\nconst constraints = {\n    fixed: function() {\n        return function() {\n            return false;\n        };\n    },\n\n    snap: function(snap) {\n        return function(coord) {\n            if (snap === null) {\n                return true;\n            }\n            snap = snap || this.graphie.snap;\n            return kpoint.roundTo(coord, snap);\n        };\n    },\n\n    bound: function(range, snap, paddingPx) {\n        if (paddingPx === undefined) {\n            if (range === undefined) {\n                paddingPx = 10;\n            } else {\n                paddingPx = 0;\n            }\n        }\n        return function(coord, prev, options) {\n            const graphie = this.graphie;\n            range = range || graphie.range;\n\n            if (snap === undefined) {\n                snap = graphie.snap;\n            }\n\n            let lower = graphie.unscalePoint([\n                paddingPx,\n                graphie.ypixels - paddingPx,\n            ]);\n\n            let upper = graphie.unscalePoint([\n                graphie.xpixels - paddingPx,\n                paddingPx,\n            ]);\n\n            if (snap) {\n                lower = kpoint.ceilTo(lower, snap);\n                upper = kpoint.floorTo(upper, snap);\n            }\n\n            if (!!options && !!options.onOutOfBounds) {\n                if (coord[0] > upper[0] || coord[0] < lower[0] ||\n                    coord[1] > upper[1] || coord[1] < lower[1]) {\n                    options.onSkipRemaining();\n                    options.onOutOfBounds();\n                }\n\n                return coord;\n            }\n\n            const coordX = Math.max(lower[0], Math.min(upper[0], coord[0]));\n            const coordY = Math.max(lower[1], Math.min(upper[1], coord[1]));\n\n            return [coordX, coordY];\n        };\n    },\n};\n\nconstraints.standard = null;\n\n_module_.exports = {\n    add: add,\n    modify: modify,\n    draw: draw,\n    remove: remove,\n\n    onMoveStart: {standard: null},\n    constraints: constraints,\n    onMove: {standard: null},\n    onMoveEnd: {standard: null},\n    onClick: {standard: null},\n};\nexport default _module_.exports;\n","import _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport { iconTrash } from \"../icon-paths.js\";\nimport _utilTexJs from \"../util/tex.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _objective_Js from \"./objective_.js\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _wrappedEllipseJs from \"./wrapped-ellipse.js\";\nimport _movablePointOptionsJs from \"./movable-point-options.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Creates and adds a point to the graph that can be dragged around.\n * It allows constraints on its movement and draws when moves happen.\n *\n * Options can be passed to the constructor to control how the point behaves:\n *   coord: [x, y]\n *     The initial position of the point\n *   pointSize:\n *     changes the size of the point. defaults to 4\n *   static: boolean\n *     draw the point, but don't let it be interactable\n *   cursor: \"move\", \"pointer\"\n *     css cursor for this point\n *   add: [function(state)]\n *     called immediately when this movablePoint is added\n *     default: apply any constraints and draw\n *   draw: [function(prevState, currentState)]\n *     drawing functions. default to [basic, highlight]\n *   remove: [function(state)]\n *     called when this movablePoint is removed\n *   onMoveStart: [function(coord)]\n *     called when this point is clicked on\n *   constraints: [function(coord)]\n *     called when this point is dragged\n *     return true or nothing to accept the move\n *     return false to cancel the move\n *     return an [x, y] coordinate to override the move\n *   onMove: [function(coord)]\n *     called after all constraints functions pass and the point\n *     is moved to a new location\n *   onMoveEnd: [function(coord)]\n *     called when the mouse is released from a click or move\n *   onClick: [function(coord)]\n *     called when someone mouses down, doesn't move the point,\n *     and mouses up.\n *   normalStyle:\n *     the raphael/graphie style of the point when not hovering\n *   highlightStyle:\n *     the raphael/graphie style of the point when hovering, if\n *     MovablePoint.draw.highlight is used\n *\n * This creates a MovablePoint object with the following methods:\n *   setCoord: [x, y]\n *     changes the point's coordinate\n *   draw:\n *     redraws the coord\n *   modify: {options}\n *     modifies the original options passed to the point\n *   remove:\n *     removes the point from graphie\n */\nconst _ = _underscore;\n\nconst MovablePointOptions = _movablePointOptionsJs;\nconst WrappedEllipse = _wrappedEllipseJs;\nconst InteractiveUtil = _interactiveUtilJs;\nconst objective_ = _objective_Js;\nconst assert = InteractiveUtil.assert;\nconst normalizeOptions = InteractiveUtil.normalizeOptions;\n\nconst kpoint = _kmath.point;\nconst kvector = _kmath2.vector;\nconst KhanColors = _utilColorsJs;\nconst processMath = _utilTexJs.processMath;\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst InlineIcon = _componentsInlineIconJsx;\n\n// State parameters that should be converted into an array of\n// functions\nconst FUNCTION_ARRAY_OPTIONS = _.keys(MovablePointOptions);\n\n// Default \"props\" and \"state\". Both are added to this.state and\n// receive magic getter methods (this.coord() etc).\n// However, properties in DEFAULT_PROPS are updated on `modify()`,\n// while those in DEFAULT_STATE persist and are not updated.\n// Things that the user might want to change should be on \"props\",\n// while things used to render the point should be on \"state\".\nconst DEFAULT_PROPS = {\n    coord: [0, 0],\n    pointSize: 4,\n    static: false,\n    cursor: \"move\",\n    normalStyle: null,    // turned into an object in this.modify\n    highlightStyle: null, // likewise\n    shadow: false,\n    tooltip: false,\n};\nconst DEFAULT_STATE = {\n    added: false,\n    hasMoved: false,\n    visibleShape: null,\n    outOfBounds: false,\n    mouseTarget: null,\n    touchOffset: null,\n};\n\nconst tooltipResetFunctions = [];\n\nconst MovablePoint = function(graphie, movable, options) {\n    _.extend(this, {\n        graphie: graphie,\n        movable: movable,\n        state: {\n            // Set here because this must be unique for each instance\n            id: _.uniqueId(\"movablePoint\"),\n        },\n    });\n\n    // We only set DEFAULT_STATE once, here\n    this.modify(_.extend({}, DEFAULT_STATE, options));\n};\n\n_.extend(MovablePoint, MovablePointOptions);\nInteractiveUtil.createGettersFor(MovablePoint, _.extend({},\n    DEFAULT_PROPS,\n    DEFAULT_STATE\n));\nInteractiveUtil.addMovableHelperMethodsTo(MovablePoint);\n\n_.extend(MovablePoint.prototype, {\n\n    cloneState: function() {\n        return _.extend(this.movable.cloneState(), this.state);\n    },\n\n    _createDefaultState: function() {\n        return _.extend({\n            id: this.state.id,\n        }, normalizeOptions(\n            FUNCTION_ARRAY_OPTIONS,\n            // Defaults are copied from MovablePointOptions.*.standard\n            // These defaults are set here instead of DEFAULT_PROPS/STATE\n            // because they:\n            //    - are objects, not primitives (and need a deeper copy)\n            //    - they don't need getters created for them\n            // TODO(jack): Consider \"default\" once we es3ify perseus\n            objective_.pluck(MovablePointOptions, \"standard\")\n\n        // We only update props here, because we want things on state to\n        // be persistent, and updated appropriately in modify()\n        ), DEFAULT_PROPS);\n    },\n\n    /**\n     * Resets the object to its state as if it were constructed with\n     * `options` originally. state not on DEFAULT_PROPS is maintained.\n     *\n     * Analogous to React.js's replaceProps\n     */\n    modify: function(options) {\n        this.update(_.extend(this._createDefaultState(), options));\n    },\n\n    /**\n     * Displays a tooltip above the point, replacing any previous contents. If\n     * there is no tooltip initialized, adds the tooltip.\n     *\n     * If the type of contents is string, the contents will be rendered with\n     * KaTeX. Otherwise, the content will be assumed to be a DOM node and will\n     * be appended inside the tooltip.\n     */\n    _showTooltip: function(contents) {\n        if (!this._tooltip) {\n            this._tooltip = document.createElement(\"div\");\n            this._tooltip.className = \"tooltip-content\";\n            this.state.visibleShape.wrapper.className = \"tooltip\";\n            this.state.visibleShape.wrapper.appendChild(this._tooltip);\n\n            // Only one tooltip should be displayed at a time, so store a list\n            // of all the tooltips initialized.\n            tooltipResetFunctions.push(() => {\n                if (this.state.added) {\n                    this._hideTooltip();\n                }\n            });\n        }\n\n        if (this._tooltip.firstChild) {\n            this._tooltip.removeChild(this._tooltip.firstChild);\n        }\n\n        this.state.visibleShape.wrapper.className = \"tooltip visible\";\n        this._tooltip.appendChild(document.createElement(\"span\"));\n\n        if (typeof contents === \"string\") {\n            processMath(this._tooltip.firstChild, contents, false);\n        } else if (typeof contents === \"function\") {\n            contents(this._tooltip.firstChild);\n        } else {\n            this._tooltip.firstChild.appendChild(contents);\n        }\n    },\n\n    _hideTooltip: function() {\n        if (this._tooltip) {\n            // Without the visible class, tooltips have display: none set\n            this.state.visibleShape.wrapper.className = \"tooltip\";\n        }\n    },\n\n    /**\n     * Adjusts constructor parameters without changing previous settings\n     * for any option not specified\n     *\n     * Analogous to React.js's setProps\n     */\n    update: function(options) {\n        const self = this;\n        const graphie = self.graphie;\n        const state = _.extend(\n            self.state,\n            normalizeOptions(FUNCTION_ARRAY_OPTIONS, options)\n        );\n\n        assert(kpoint.is(state.coord));\n\n        // Default things inside the state.normalStyle object, because\n        // _.extend is not deep.\n        // We use _.extend instead of _.defaults because we don't want\n        // to modify the passed-in copy (especially if it's from\n        // DEFAULT_PROPS/STATE!)\n        const normalColor = (state.static) ? KhanColors.DYNAMIC\n                                         : KhanColors.INTERACTIVE;\n        state.normalStyle = _.extend({\n            fill: normalColor,\n            stroke: normalColor,\n            scale: 1,\n        }, state.normalStyle);\n\n        state.highlightStyle = _.extend({\n            fill: KhanColors.INTERACTING,\n            stroke: KhanColors.INTERACTING,\n            scale: 2,\n        }, state.highlightStyle);\n\n        if (!state.static) {\n            // the invisible shape in front of the point that gets mouse events\n            if (!state.mouseTarget) {\n                const center = self.state.coord;\n                const radii = graphie.unscaleVector(24);\n                const options = {\n                    mouselayer: true,\n                    padding: 0,\n                };\n                state.mouseTarget = new WrappedEllipse(graphie, center, radii,\n                    options);\n                state.mouseTarget.attr({fill: \"#000\", opacity: 0.0});\n            }\n        }\n\n        const showTrashTooltip = () => {\n            this._showTooltip(container => {\n                ReactDOM.render(\n                    <span style={{fontSize: \"2em\"}}>\n                                <InlineIcon {...iconTrash} style={{\n                                    position: \"static\",\n                                    color: KhanColors.INTERACTIVE,\n                                    marginLeft: 9,\n                                    marginRight: 9,\n                                }}\n                                />\n                            </span>,\n                    container\n                );\n            });\n        };\n\n        // The starting coord of any move, sent to onMoveEnd as the previous\n        // value\n        let startCoord = state.coord;\n\n        // The Movable representing this movablePoint's representation\n        // This handles mouse events for us, which we propagate in\n        // onMove\n        self.movable.modify(_.extend({}, state, {\n            add: null,\n            modify: null,\n            draw: self.draw.bind(self),\n            remove: null,\n            onMoveStart: startMouseCoord => {\n                state.hasMoved = false;\n                startCoord = state.coord;\n\n                // Save the offset between the cursor and the initial coordinate\n                // of the point. This is tracked so as to avoid locking the\n                // moving point to the user's finger on touch devices, which\n                // would obscure it, no matter how large we made the touch\n                // target. Instead, we respect the offset at which the point was\n                // grabbed for the entirety of the gesture, if it's a\n                // touch-based interaction.\n                if (state.touchOffset == null) {\n                    const isMouse = !('ontouchstart' in window);\n                    state.touchOffset = isMouse ? [0, 0] : kvector.subtract(\n                        startCoord, startMouseCoord\n                    );\n                }\n\n                const svgElem = state.visibleShape.wrapper;\n                if (state.shadow) {\n                    const filter = \"none\";\n                    svgElem.style.webkitFilter = filter;\n                    svgElem.style.filter = filter;\n                }\n\n                if (state.showHairlines) {\n                    state.showHairlines(state.coord);\n                }\n\n                tooltipResetFunctions.forEach(f => f());\n                if (state.tooltip) {\n                    if (state.xOnlyTooltip) {\n                        this._showTooltip(`${state.coord[0]}`);\n                    } else {\n                        this._showTooltip(\n                            `(${state.coord[0]}, ${state.coord[1]})`);\n                    }\n\n                    if (state.shadow) {\n                        const content = svgElem\n                            .getElementsByClassName(\"tooltip-content\")[0];\n                        const filter =\n                            \"drop-shadow(0px 0px 5px rgba(0, 0, 0, 0.5))\";\n\n                        content.style.webkitFilter = filter;\n                        content.style.filter = filter;\n                    }\n                }\n\n                self._fireEvent(state.onMoveStart, startCoord, startCoord);\n                self.draw();\n            },\n            onMove: (mouseCoord, prevMouseCoord) => {\n                const transformedCoord = kvector.add(\n                    mouseCoord, state.touchOffset\n                );\n\n                self.moveTo(transformedCoord);\n\n                if (state.showHairlines) {\n                    if (!this.state.outOfBounds) {\n                        state.showHairlines(state.coord);\n                    } else {\n                        state.hideHairlines();\n                    }\n                }\n\n                if (state.tooltip) {\n                    if (!this.state.outOfBounds) {\n                        if (state.xOnlyTooltip) {\n                            this._showTooltip(`${state.coord[0]}`);\n                        } else {\n                            this._showTooltip(\n                                `(${state.coord[0]}, ${state.coord[1]})`);\n                        }\n                    }\n                }\n\n                if (state.onRemove && this.state.outOfBounds) {\n                    showTrashTooltip();\n                }\n            },\n            onMoveEnd: () => {\n                if (self.isHovering() && !state.hasMoved) {\n                    self._fireEvent(state.onClick, state.coord, startCoord);\n                }\n\n                const svgElem = state.visibleShape.wrapper;\n\n                if (state.shadow) {\n                    const filter =\n                        \"drop-shadow(0px 0px 5px rgba(0, 0, 0, 0.5))\";\n                    svgElem.style.webkitFilter = filter;\n                    svgElem.style.filter = filter;\n                }\n\n                if (state.hideHairlines) {\n                    state.hideHairlines();\n                }\n\n                if (state.hasMoved) {\n                    this._hideTooltip();\n                } else if (state.onRemove) {\n                    // If we haven't moved and we should be displaying trash\n                    // tooltips.\n                    showTrashTooltip();\n\n                    const content =\n                        svgElem.getElementsByClassName(\"tooltip-content\")[0];\n\n                    content.style.webkitFilter = \"none\";\n                    content.style.filter = \"none\";\n\n                    this._tooltip.firstChild.addEventListener(\"touchstart\",\n                        e => {\n                            // Prevent creation of a new point when the event is\n                            // propagated up the DOM.\n                            e.stopPropagation();\n                        }, true);\n\n                    this._tooltip.firstChild.addEventListener(\"touchend\",\n                        e => {\n                            // Remove the point and prevent creation of a\n                            // new point.\n                            state.onRemove();\n                            e.stopPropagation();\n                        }, true);\n                } else if (state.tooltip) {\n                    this._hideTooltip();\n                }\n\n                if (state.outOfBounds) {\n                    state.onRemove();\n                }\n\n                self._fireEvent(state.onMoveEnd, state.coord, startCoord);\n                state.hasMoved = false;\n                state.touchOffset = null;\n                self.draw();\n            },\n        }));\n\n        // Trigger an add event if this hasn't been added before\n        if (!state.added) {\n            self.prevState = {};\n            self._fireEvent(state.add, self.cloneState(), self.prevState);\n            state.added = true;\n\n            // Update the state for `added` and in case the add event\n            // changed it\n            self.prevState = self.cloneState();\n        }\n\n        // Trigger a modify event\n        self._fireEvent(state.modify, self.cloneState(), self.prevState);\n    },\n\n    remove: function() {\n        this.state.added = false;\n        this._fireEvent(this.state.remove);\n        if (this.movable) {\n            this.movable.remove();\n        }\n        // TODO(jack): This should really be moved off of\n        // movablePoint.state and only kept on movable.state\n        this.state.mouseTarget = null;\n    },\n\n    constrain: function() {\n        const result = this._applyConstraints(this.coord(), this.coord());\n        if (kpoint.is(result)) {\n            this.setCoord(result);\n        }\n        return result !== false;\n    },\n\n    setCoord: function(coord) {\n        assert(kpoint.is(coord, 2));\n        this.state.coord = _.clone(coord);\n        this.draw();\n    },\n\n    setCoordConstrained: function(coord) {\n        assert(kpoint.is(coord, 2));\n        const result = this._applyConstraints(coord, this.coord());\n        if (result !== false) {\n            this.state.coord = _.clone(result);\n            this.draw();\n        }\n    },\n\n    moveTo: function(coord) {\n        // The caller has the option of adding an onMove() method to the\n        // movablePoint object we return as a sort of event handler\n        // By returning false from onMove(), the move can be vetoed,\n        // providing custom constraints on where the point can be moved.\n        // By returning array [x, y], the move can be overridden\n\n        const state = this.state;\n\n        this.state.outOfBounds = false;\n        const result = this._applyConstraints(coord, state.coord,\n            state.onRemove ? {\n                onOutOfBounds: () => {\n                    this.state.outOfBounds = true;\n                },\n            } : {});\n\n        if (result === false) {\n            return;\n        } else if (kpoint.is(result)) {\n            coord = result;\n        }\n        if (!kpoint.equal(coord, state.coord)) {\n            const prevCoord = state.coord;\n            state.coord = coord;\n            state.hasMoved = true;\n            this._fireEvent(state.onMove, state.coord, prevCoord);\n            this.draw();\n        }\n    },\n\n    // Clone these for use with raphael, which modifies the input\n    // style parameters\n    normalStyle: function() {\n        return _.clone(this.state.normalStyle);\n    },\n\n    highlightStyle: function() {\n        return _.clone(this.state.highlightStyle);\n    },\n\n    // Change z-order to back\n    toBack: function() {\n        this.movable.toBack();\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toBack();\n        }\n    },\n\n    // Change z-order to front\n    toFront: function() {\n        if (this.state.visibleShape) {\n            this.state.visibleShape.toFront();\n        }\n        this.movable.toFront();\n    },\n\n    /**\n     * Forwarding methods to this.movable:\n     */\n    isHovering: function() {\n        return this.movable.isHovering();\n    },\n\n    isDragging: function() {\n        return this.movable.isDragging();\n    },\n\n    mouseTarget: function() {\n        return this.movable.mouseTarget();\n    },\n\n    grab: function(coord) {\n        // Provide an explicit touchOffset override, so that we track the user's\n        // finger when a point has been grabbed.\n        this.state.touchOffset = [0, 0];\n\n        this.movable.grab(coord);\n        this.moveTo(coord);\n    },\n});\n\n_module_.exports = MovablePoint;\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _interactiveUtilJs from \"./interactive-util.js\";\nimport _underscore from \"underscore\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Movable\n *\n * A Movable Something, that sends onMove events based on the\n * mouse coordinate (graphie unscaled, non-pixel-value) of the\n * move.\n *\n * Other MovableThings should generally have a Movable field, and\n * let this class handle all of the virtual mouse events, and then\n * take appropriate action in onMoveStart, onMove, onMoveEnd\n */\nconst _ = _underscore;\n\nconst InteractiveUtil = _interactiveUtilJs;\nconst normalizeOptions = InteractiveUtil.normalizeOptions;\n\nconst assert = InteractiveUtil.assert;\nconst kpoint = _kmath.point;\n\n// state parameters that should be converted into an array of\n// functions\nconst FUNCTION_ARRAY_OPTIONS = [\n    \"add\",\n    \"modify\",\n    \"draw\",\n    \"remove\",\n    \"onMoveStart\",\n    \"onMove\",\n    \"onMoveEnd\",\n    \"onClick\",\n];\n\n// Default \"props\" and \"state\". Both are added to this.state and\n// receive magic getter methods (this.isHovering() etc).\n// However, properties in DEFAULT_PROPS are updated on `modify()`,\n// while those in DEFAULT_STATE persist and are not updated.\n// Things that the user might want to change should be on \"props\",\n// while things used to render the movable should be on \"state\".\nconst DEFAULT_PROPS = {\n    cursor: null,\n};\nconst DEFAULT_STATE = {\n    added: false,\n    isHovering: false,\n    isMouseOver: false,\n    isDragging: false,\n    mouseTarget: null,\n};\n\nconst Movable = function(graphie, options) {\n    _.extend(this, {\n        graphie: graphie,\n        state: {\n            // Set here because this must be unique for each instance\n            id: _.uniqueId(\"movable\"),\n        },\n    });\n\n    // We only set DEFAULT_STATE once, here\n    this.modify(_.extend({}, DEFAULT_STATE, options));\n};\n\nInteractiveUtil.createGettersFor(Movable, _.extend({},\n    DEFAULT_PROPS,\n    DEFAULT_STATE\n));\nInteractiveUtil.addMovableHelperMethodsTo(Movable);\n\n_.extend(Movable.prototype, {\n\n    cloneState: function() {\n        return _.clone(this.state);\n    },\n\n    _createDefaultState: function() {\n        return _.extend({\n            id: this.state.id,\n            add: [],\n            modify: [],\n            draw: [],\n            remove: [],\n            onMoveStart: [],\n            onMove: [],\n            onMoveEnd: [],\n            onClick: [],\n\n        // We only update props here, because we want things on state to\n        // be persistent, and updated appropriately in modify()\n        }, DEFAULT_PROPS);\n    },\n\n    /**\n     * Resets the object to its state as if it were constructed with\n     * `options` originally. The only state maintained is `state.id`\n     *\n     * Analogous to React.js's replaceProps\n     */\n    modify: function(options) {\n        this.update(_.extend({}, this._createDefaultState(), options));\n    },\n\n    /**\n     * Simulates a mouse grab event on the movable object.\n     */\n    grab: function(coord) {\n        assert(kpoint.is(coord));\n        const self = this;\n        const graphie = self.graphie;\n        const state = self.state;\n\n        state.isHovering = true;\n        state.isDragging = true;\n        graphie.isDragging = true;\n\n        const startMouseCoord = coord;\n        let prevMouseCoord = startMouseCoord;\n        self._fireEvent(\n            state.onMoveStart,\n            startMouseCoord,\n            startMouseCoord\n        );\n\n        const moveHandler = function(e) {\n            e.preventDefault();\n\n            const mouseCoord = graphie.getMouseCoord(e);\n            self._fireEvent(\n                state.onMove,\n                mouseCoord,\n                prevMouseCoord\n            );\n            self.draw();\n            prevMouseCoord = mouseCoord;\n        };\n\n        const upHandler = function(e) {\n            $(document).unbind(\"vmousemove\", moveHandler);\n            $(document).unbind(\"vmouseup\", upHandler);\n            if (state.isHovering) {\n                self._fireEvent(\n                    state.onClick,\n                    prevMouseCoord,\n                    startMouseCoord\n                );\n            }\n            state.isHovering = self.state.isMouseOver;\n            state.isDragging = false;\n            graphie.isDragging = false;\n            self._fireEvent(\n                state.onMoveEnd,\n                prevMouseCoord,\n                startMouseCoord\n            );\n            self.draw();\n        };\n\n        $(document).bind(\"vmousemove\", moveHandler);\n        $(document).bind(\"vmouseup\", upHandler);\n    },\n\n    /**\n     * Adjusts constructor parameters without changing previous settings\n     * for any option not specified\n     *\n     * Analogous to React.js's setProps\n     */\n    update: function(options) {\n        const self = this;\n        const graphie = self.graphie;\n\n        const prevState = self.cloneState();\n        const state = _.extend(\n            self.state,\n            normalizeOptions(FUNCTION_ARRAY_OPTIONS, options)\n        );\n\n        // the invisible shape in front of the point that gets mouse events\n        if (state.mouseTarget && !prevState.mouseTarget) {\n            let $mouseTarget;\n            if (state.mouseTarget.getMouseTarget) {\n                $mouseTarget = $(state.mouseTarget.getMouseTarget());\n            } else {\n                $mouseTarget = $(state.mouseTarget[0]);\n            }\n\n            const isMouse = !('ontouchstart' in window);\n\n            if (isMouse) {\n                $mouseTarget.on(\"vmouseover\", function() {\n                    state.isMouseOver = true;\n                    if (!graphie.isDragging) {\n                        state.isHovering = true;\n                    }\n                    if (self.state.added) {\n                        // Avoid drawing if the point has been removed\n                        self.draw();\n                    }\n                });\n\n                $mouseTarget.on(\"vmouseout\", function() {\n                    state.isMouseOver = false;\n                    if (!state.isDragging) {\n                        state.isHovering = false;\n                    }\n                    if (self.state.added) {\n                        // Avoid drawing if the point has been removed\n                        self.draw();\n                    }\n                });\n            }\n\n            // Prevent the page from scrolling when we grab and drag the\n            // movable object on a mobile device.\n            $mouseTarget[0].addEventListener(\"touchstart\", function(event) {\n                event.preventDefault();\n            }, {passive: false});\n\n            $mouseTarget.on(\"vmousedown\", function(e) {\n                if (e.which !== 0 && e.which !== 1) {\n                    return;\n                }\n                e.preventDefault();\n\n                const mouseCoord = graphie.getMouseCoord(e);\n                self.grab(mouseCoord);\n            });\n        }\n\n        if (state.mouseTarget && state.cursor !== undefined) {\n            let $mouseTarget;\n            if (state.mouseTarget.getMouseTarget) {\n                $mouseTarget = $(state.mouseTarget.getMouseTarget());\n            } else {\n                $mouseTarget = $(state.mouseTarget[0]);\n            }\n\n            // \"\" removes the css cursor if state.cursor is null\n            $mouseTarget.css(\"cursor\", state.cursor || \"\");\n        }\n\n\n        // Trigger an add event if this hasn't been added before\n        if (!state.added) {\n            self._fireEvent(state.modify, self.cloneState(), {});\n            state.added = true;\n\n            // Update the state for `added` and in case the add event\n            // changed it\n            self.prevState = self.cloneState();\n        }\n\n        // Trigger a modify event\n        self._fireEvent(state.modify, self.cloneState(), self.prevState);\n    },\n\n    remove: function() {\n        this.state.added = false;\n        this._fireEvent(this.state.remove);\n        if (this.state.mouseTarget) {\n            $(this.state.mouseTarget).off();\n            this.state.mouseTarget.remove();\n            this.state.mouseTarget = null;\n        }\n    },\n\n    // Change z-order to back\n    toBack: function() {\n        if (this.state.mouseTarget) {\n            this.state.mouseTarget.toBack();\n        }\n    },\n\n    // Change z-order to front\n    toFront: function() {\n        if (this.state.mouseTarget) {\n            this.state.mouseTarget.toFront();\n        }\n    },\n});\n\n_module_.exports = Movable;\nexport default _module_.exports;\n","import _utilColorsJs from \"./util/colors.js\";\nimport _interactive2MovablePolygonJs from \"./interactive2/movable-polygon.js\";\nimport _interactive2MovableLineJs from \"./interactive2/movable-line.js\";\nimport _interactive2MovablePointJsx from \"./interactive2/movable-point.jsx\";\nimport _interactive2MovableJs from \"./interactive2/movable.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst Movable = _interactive2MovableJs;\nconst MovablePoint = _interactive2MovablePointJsx;\nconst MovableLine = _interactive2MovableLineJs;\nconst MovablePolygon = _interactive2MovablePolygonJs;\n\nconst KhanColors = _utilColorsJs;\n\nconst Interactive2 = {\n    MovablePoint: MovablePoint,\n    addMovablePoint: function(graphie, options) {\n        const movable = new Movable(graphie, {});\n        return new MovablePoint(graphie, movable, options);\n    },\n    MovableLine: MovableLine,\n    addMovableLine: function(graphie, options) {\n        const movable = new Movable(graphie, {});\n        return new MovableLine(graphie, movable, options);\n    },\n    MovablePolygon: MovablePolygon,\n    addMovablePolygon: function(graphie, options) {\n        const movable = new Movable(graphie, {});\n        return new MovablePolygon(graphie, movable, options);\n    },\n\n    addMaybeMobileMovablePoint: function(widget, extraProps) {\n        const isMobile = widget.props.apiOptions.isMobile;\n\n        const commonStyle = isMobile\n            ? {\n                stroke: \"#ffffff\",\n                \"stroke-width\": 3,\n                fill: KhanColors.INTERACTIVE,\n            }\n            : {\n                stroke: KhanColors.INTERACTIVE,\n                fill: KhanColors.INTERACTIVE,\n            };\n\n        const normalStyle = Object.assign(commonStyle, extraProps.normalStyle);\n\n        const highlightStyle = Object.assign(\n            isMobile\n                ? {\n                    ...commonStyle,\n                    \"stroke-width\": 0,\n                    scale: 0.75,\n                }\n                : {},\n            extraProps.highlightStyle\n        );\n\n        const props = Object.assign(\n            {\n                normalStyle: normalStyle,\n                highlightStyle: highlightStyle,\n                shadow: isMobile,\n                tooltip: isMobile && widget.props.showTooltips,\n                showHairlines: widget.showHairlines,\n                hideHairlines: widget.hideHairlines,\n            },\n            isMobile ? {pointSize: 7} : {}\n        );\n\n        return Interactive2.addMovablePoint(\n            widget.graphie,\n            Object.assign(extraProps, props)\n        );\n    },\n};\n\n_module_.exports = Interactive2;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _utilJs from \"../util.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst Util = _utilJs;\nconst nestedMap = Util.nestedMap;\nconst deepEq = Util.deepEq;\nconst _ = _underscore;\n\n/**\n * A base class for all Graphie Movables\n *\n * Used for checking that all Graphie children are, in fact,\n * GraphieMovables\n */\nfunction GraphieMovable(descriptor) {\n    _.extend(this, descriptor);\n}\n\nconst abstractMethod = function() {\n    throw new Error(\n        \"Abstract method! Must be implemented by Graphie Movable\" +\n            this.constructor.displayName\n    );\n};\n\n_.extend(GraphieMovable.prototype, {\n    movableProps: [],\n    add: abstractMethod,\n    modify: abstractMethod,\n    remove: abstractMethod,\n    toFront: function() {\n        /* no op */\n    },\n});\n\n/**\n * returns cloned props modified with `children: childrenArray`\n */\nconst rewriteProps = function(props, childrenArray) {\n    // Clone the props and add `children:`\n    // childrenArray is always an array here because this is only called\n    // from createClass, which initializes childrenArray as _.rest(arguments)\n    return _.extend({}, props, {\n        children: _.filter(_.flatten(childrenArray), _.identity),\n    });\n};\n\n/**\n * Create a custom GraphieMovable class\n */\nconst createClass = function(spec) {\n    const GraphieClass = function(props) {\n        if (!(this instanceof GraphieClass)) {\n            throw new Error(\"Use createElement or JSX with graphie movables\");\n        }\n        this.props = rewriteProps(props, props.children || []);\n        return this;\n    };\n\n    spec.displayName = spec.displayName || _.uniqueId(\"GraphieClass\");\n\n    // Add the displayName to the constructor for compatibility with\n    // React's myDescriptor.constructor.displayName\n    GraphieClass.displayName = spec.displayName;\n\n    GraphieClass.prototype = new GraphieMovable(spec);\n    GraphieClass.prototype.constructor = GraphieClass;\n\n    return GraphieClass;\n};\n\n/**\n * Create a GraphieMovable class from a function that describes\n * how to add said class to a graphie, and returns an array of\n * `.remove()`able elements to be used when a remove() or\n * modify() is called.\n *\n * This convenience method creates an inefficient class, although\n * it does check for a difference in this.props and prevProps before\n * removing and re-adding itself.\n *\n * The primary benefit of this is being able to very easily create\n * a wrapper for old graphie code to make it interface with <Graphie>\n *\n * Commonly used elements should use the fully-fledged createClass\n * and implement an efficient modify() operation.\n */\nconst createSimpleClass = function(addFunction) {\n    return createClass({\n        displayName: addFunction.name || _.uniqueId(\"GraphieSimpleClass\"),\n        movableProps: [\"children\"],\n\n        add: function(graphie) {\n            this._elements = addFunction(graphie, this.props);\n            this._prevProps = this.props;\n        },\n\n        modify: function(graphie) {\n            if (!deepEq(this.props, this._prevProps)) {\n                this.remove();\n                this.add(graphie);\n                this._prevProps = this.props;\n                return \"reordered\";\n            }\n        },\n\n        remove: function() {\n            nestedMap(this._elements, elem => {\n                if (elem) {\n                    elem.remove();\n                }\n            });\n            this._elements = null;\n            this._prevProps = null;\n        },\n\n        toFront: function() {\n            nestedMap(this._elements, elem => {\n                if (_.isFunction(elem.toFront)) {\n                    elem.toFront();\n                }\n            });\n        },\n    });\n};\n\n_module_.exports = {\n    GraphieMovable: GraphieMovable,\n    createClass: createClass,\n    createSimpleClass: createSimpleClass,\n};\nexport default _module_.exports;\n","import _utilColorsJs from \"../util/colors.js\";\nimport _interactive2Js from \"../interactive2.js\";\nimport _graphieClassesJsx from \"./graphie-classes.jsx\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst GraphieClasses = _graphieClassesJsx;\nconst Interactive2 = _interactive2Js;\n\nconst KhanColors = _utilColorsJs;\n\nconst MovablePoint = GraphieClasses.createClass({\n    displayName: \"MovablePoint\",\n\n    movableProps: [\"children\"],\n\n    _getProps: function() {\n        if (this.props.isMobile) {\n            const isMobile = this.props.isMobile;\n\n            // TODO(kevinb) precompute commonStyle and commonMobileStyle\n            /* eslint-disable indent */\n            const commonStyle = isMobile\n                ? {\n                      stroke: \"#ffffff\",\n                      \"stroke-width\": 3,\n                      fill: KhanColors.INTERACTIVE,\n                  }\n                : {\n                      stroke: KhanColors.INTERACTIVE,\n                      fill: KhanColors.INTERACTIVE,\n                  };\n\n            // TODO(kevinb) precompute normalStyle and normalMobileStyle\n            const normalStyle = isMobile\n                ? Object.assign(\n                      commonStyle,\n                      this.props.mobileStyleOverride || {}\n                  )\n                : Object.assign(commonStyle, this.props.normalStyle);\n\n            // TODO(kevinb) precompute highlightStyle and highlightMobileStyle\n            const highlightStyle = isMobile\n                ? {\n                      ...commonStyle,\n                      \"stroke-width\": 0,\n                      scale: 0.75,\n                  }\n                : this.props.highlightStyle;\n            /* eslint-enable indent */\n\n            const addedProps = Object.assign(\n                {\n                    normalStyle: normalStyle,\n                    highlightStyle: highlightStyle,\n                    shadow: isMobile,\n                    tooltip: isMobile && this.props.showTooltips,\n                },\n                isMobile ? {pointSize: 7} : {}\n            );\n\n            return Object.assign(this.props, addedProps);\n        } else {\n            return this.props;\n        }\n    },\n\n    add: function(graphie) {\n        this.point = Interactive2.addMovablePoint(graphie, this._getProps());\n    },\n\n    modify: function() {\n        this.point.modify(this._getProps());\n    },\n\n    remove: function() {\n        this.point.remove();\n    },\n\n    toFront: function() {\n        this.point.toFront();\n    },\n\n    grab: function(coord) {\n        this.point.grab(coord);\n    },\n});\n\n// Include helper methods, such as MovablePoint.constrain.snap()\n_.extend(MovablePoint, Interactive2.MovablePoint);\n\nconst MovableLine = GraphieClasses.createClass({\n    displayName: \"MovableLine\",\n\n    movableProps: [\"children\"],\n\n    add: function(graphie) {\n        // Add MovablePoint children\n        const points = _.pluck(this.props.children, \"point\");\n        const props = _.extend({}, this.props, {\n            points: points,\n        });\n        this.line = Interactive2.addMovableLine(graphie, props);\n    },\n\n    modify: function() {\n        // Add MovablePoint children\n        const points = _.pluck(this.props.children, \"point\");\n        const props = _.extend({}, this.props, {\n            points: points,\n        });\n        this.line.modify(props);\n    },\n\n    remove: function() {\n        this.line.remove();\n    },\n\n    toFront: function() {\n        this.line.toFront();\n    },\n});\n\n// Include helper methods, such as MovableLine.constrain.snap()\n_.extend(MovableLine, Interactive2.MovableLine);\n\nconst Label = GraphieClasses.createSimpleClass((graphie, props) => {\n    let coord = props.coord;\n    if (props.unscaled) {\n        coord = graphie.unscalePoint(coord);\n    }\n\n    return graphie.label(\n        coord,\n        props.text,\n        props.direction,\n        props.tex,\n        props.style\n    );\n});\n\nconst Line = GraphieClasses.createClass({\n    displayName: \"Line\",\n\n    movableProps: [\"children\"],\n\n    add: function(graphie) {\n        const props = this.props;\n        this.graphie = graphie;\n        this.line = this.graphie.line(props.start, props.end, props.style);\n    },\n\n    modify: function() {\n        const props = this.props;\n        const path = this.graphie.svgPath([props.start, props.end]);\n        this.line.attr(_.extend({}, props.style, {path: path}));\n    },\n\n    remove: function() {\n        this.line.remove();\n    },\n\n    toFront: function() {\n        this.line.toFront();\n    },\n});\n\nconst Parabola = GraphieClasses.createClass({\n    displayName: \"Parabola\",\n\n    movableProps: [\"children\"],\n\n    add: function(graphie) {\n        const props = this.props;\n        this.graphie = graphie;\n        this.parabola = this.graphie.parabola(\n            props.a,\n            props.b,\n            props.c,\n            props.style\n        );\n    },\n\n    modify: function() {\n        const props = this.props;\n        const path = this.graphie.svgParabolaPath(props.a, props.b, props.c);\n        this.parabola.attr(_.extend({}, props.style, {path: path}));\n    },\n\n    remove: function() {\n        this.parabola.remove();\n    },\n\n    toFront: function() {\n        this.parabola.toFront();\n    },\n});\n\nconst Sinusoid = GraphieClasses.createClass({\n    displayName: \"Sinusoid\",\n\n    movableProps: [\"children\"],\n\n    add: function(graphie) {\n        const props = this.props;\n        this.graphie = graphie;\n        this.sinusoid = this.graphie.sinusoid(\n            props.a,\n            props.b,\n            props.c,\n            props.d,\n            props.style\n        );\n    },\n\n    modify: function() {\n        const props = this.props;\n        const path = this.graphie.svgSinusoidPath(\n            props.a,\n            props.b,\n            props.c,\n            props.d\n        );\n        this.sinusoid.attr(_.extend({}, props.style, {path: path}));\n    },\n\n    remove: function() {\n        this.sinusoid.remove();\n    },\n\n    toFront: function() {\n        this.sinusoid.toFront();\n    },\n});\n\nconst Plot = GraphieClasses.createSimpleClass((graphie, props) => {\n    return graphie.plot(props.fn, props.range, props.style);\n});\n\nconst PlotParametric = GraphieClasses.createSimpleClass((graphie, props) => {\n    return graphie.plotParametric(props.fn, props.range, props.style);\n});\n\nconst Point = GraphieClasses.createSimpleClass((graphie, props) => {\n    return graphie.ellipse(props.coord, graphie.unscaleVector([4, 4]), {\n        fill: props.color || KhanColors.BLACK,\n        stroke: props.color || KhanColors.BLACK,\n    });\n});\n\nconst Path = GraphieClasses.createClass({\n    displayName: \"Path\",\n\n    movableProps: [\"children\"],\n\n    add: function(graphie) {\n        const props = this.props;\n        this.graphie = graphie;\n        this.path = this.graphie.path(props.coords, props.style);\n    },\n\n    modify: function() {\n        const props = this.props;\n        const path = this.graphie.svgPath(props.coords);\n        this.path.attr({path: path});\n    },\n\n    remove: function() {\n        this.path.remove();\n    },\n\n    toFront: function() {\n        this.path.toFront();\n    },\n});\n\nconst Arc = GraphieClasses.createSimpleClass((graphie, props) => {\n    let center = props.center;\n    let radius = props.radius;\n    if (props.unscaled) {\n        center = graphie.unscalePoint(center);\n        radius = graphie.unscaleVector(radius);\n    }\n\n    return graphie.arc(\n        center,\n        radius,\n        props.startAngle,\n        props.endAngle,\n        props.sector,\n        props.style\n    );\n});\n\nconst Circle = GraphieClasses.createSimpleClass((graphie, props) => {\n    return graphie.circle(props.center, props.radius, props.style);\n});\n\nconst Rect = GraphieClasses.createSimpleClass((graphie, props) => {\n    return graphie.rect(\n        props.x,\n        props.y,\n        props.width,\n        props.height,\n        props.style\n    );\n});\n\n_module_.exports = {\n    Arc: Arc,\n    Circle: Circle,\n    Label: Label,\n    Line: Line,\n    MovableLine: MovableLine,\n    MovablePoint: MovablePoint,\n    Parabola: Parabola,\n    Path: Path,\n    Plot: Plot,\n    PlotParametric: PlotParametric,\n    Point: Point,\n    Sinusoid: Sinusoid,\n    Rect: Rect,\n};\nexport default _module_.exports;\n","import _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport _graphieMovablesJsx from \"./graphie-movables.jsx\";\nimport _graphieClassesJsx from \"./graphie-classes.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst GraphieClasses = _graphieClassesJsx;\nconst Movables = _graphieMovablesJsx;\n\nconst GraphieMovable = GraphieClasses.GraphieMovable;\n\nconst deepEq = _utilJs.deepEq;\nconst nestedMap = _utilJs2.nestedMap;\nconst assert = _interactive2InteractiveUtilJs.assert;\n\nconst GraphUtils = _utilGraphUtilsJs;\nconst createGraphie = GraphUtils.createGraphie;\n\nconst Graphie = createReactClass({\n    propTypes: {\n        addMouseLayer: PropTypes.bool,\n        box: PropTypes.arrayOf(PropTypes.number).isRequired,\n        children: PropTypes.node,\n        isMobile: PropTypes.bool,\n        onClick: PropTypes.func,\n        onMouseDown: PropTypes.func,\n        onMouseMove: PropTypes.func,\n        onMouseUp: PropTypes.func,\n        options: PropTypes.shape({\n            snapStep: PropTypes.arrayOf(PropTypes.number),\n        }),\n        range: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.number)\n        ),\n        responsive: PropTypes.bool,\n        setDrawingAreaAvailable: PropTypes.func,\n        setup: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            range: [[-10, 10], [-10, 10]],\n            options: {},\n            responsive: false,\n            addMouseLayer: true,\n        };\n    },\n\n    componentDidMount: function() {\n        this._setupGraphie();\n        this._updateMovables();\n    },\n\n    shouldComponentUpdate: function(nextProps) {\n        return !deepEq(this.props, nextProps);\n    },\n\n    componentDidUpdate: function(prevProps) {\n        // If someone changes the setup function passed in, we should\n        // technically setup graphie again. But that's definitely an\n        // anti-pattern, since it is most-likely caused by passing in an\n        // anonymous function rather than a \"real\" change, and re-rendering\n        // in that case would cause us to constantly re-setup graphie, which\n        // would have horrible performance implications. In order to avoid\n        // those, we just warn here.\n        if (\n            this.props.setup !== prevProps.setup &&\n            window.console &&\n            window.console.warn\n        ) {\n            window.console.warn(\n                \"<Graphie> was given a new setup function. \" +\n                    \"This is a bad idea; please refactor your code to give \" +\n                    \"the same setup function reference to <Graphie> on \" +\n                    \"every render.\"\n            );\n        }\n        if (\n            !deepEq(this.props.options, prevProps.options) ||\n            !deepEq(this.props.box, prevProps.box) ||\n            !deepEq(this.props.range, prevProps.range)\n        ) {\n            this._setupGraphie();\n        }\n        this._updateMovables();\n    },\n\n    /**\n     * Allow parents of the <Graphie> component to grab a reference to the\n     * underlying graphie object using\n     * `this.refs.graphieComponent.getGraphie()`\n     *\n     * This shouldn't be necessary for 90% of cases, but the power is there.\n     * Use it for good and not evil.\n     */\n    getGraphie: function() {\n        return this._graphie;\n    },\n\n    // bounds-checked range\n    _range: function() {\n        return _.map(this.props.range, dimRange => {\n            if (dimRange[0] >= dimRange[1]) {\n                return [-10, 10];\n            } else {\n                return dimRange;\n            }\n        });\n    },\n\n    _box: function() {\n        return _.map(this.props.box, pixelDim => {\n            // 340 = default size in the editor. exact value\n            // is arbitrary; this is just a safety check.\n            return pixelDim > 0 ? pixelDim : 340;\n        });\n    },\n\n    _scale: function() {\n        const box = this._box();\n        const range = this._range();\n        return _.map(box, (pixelDim, i) => {\n            const unitDim = range[i][1] - range[i][0];\n            return pixelDim / unitDim;\n        });\n    },\n\n    _setupGraphie: function() {\n        this._removeMovables();\n\n        const graphieDiv = ReactDOM.findDOMNode(this.refs.graphieDiv);\n        $(graphieDiv).empty();\n        const graphie = (this._graphie = createGraphie(graphieDiv));\n\n        // This has to be called before addMouseLayer. You can re-init\n        // with graphInit later if you prefer\n        graphie.init({\n            range: this._range(),\n            scale: this._scale(),\n            isMobile: this.props.isMobile,\n        });\n        // Only add the mouselayer if we actually want one.\n        if (this.props.addMouseLayer) {\n            graphie.addMouseLayer({\n                onClick: this.props.onClick,\n                onMouseDown: this.props.onMouseDown,\n                onMouseUp: this.props.onMouseUp,\n                onMouseMove: this.props.onMouseMove,\n                setDrawingAreaAvailable: this.props.setDrawingAreaAvailable,\n            });\n        }\n\n        graphie.snap = this.props.options.snapStep || [1, 1];\n\n        if (this.props.responsive) {\n            // Overwrite fixed styles set in init()\n            // TODO(alex): Either make this component always responsive by\n            // itself, or always wrap it in other components so that it is.\n            $(graphieDiv).css({width: \"100%\", height: \"100%\"});\n            graphie.raphael.setSize(\"100%\", \"100%\");\n        }\n\n        this.props.setup(\n            graphie,\n            _.extend(\n                {\n                    range: this._range(),\n                    scale: this._scale(),\n                },\n                this.props.options\n            )\n        );\n    },\n\n    _removeMovables: function() {\n        // _.invoke works even when this._movables is undefined\n        _.invoke(this._movables, \"remove\");\n        this._movables = {};\n    },\n\n    _renderMovables: function(children, options) {\n        // Each leaf of `children` is a movable descriptor created by a call to\n        // some `GraphieMovable`, such as `MovablePoint`.\n        //\n        // This function takes these descriptors and renders them into\n        // on-screen movables, or updates on-screen movables for\n        // descriptors when possible.\n        //\n        // If there is no movable with that key already, this descriptor is\n        // stored in this._movables and promoted to an on-screen movable by\n        // calling `child.add(graphie)`.\n        //\n        // If a movable of the same type with the same key exists already,\n        // we take `child.props` and give them to the already-existing\n        // on-screen movable, and call `movable.modify()`\n\n        const graphie = options.graphie;\n        const oldMovables = options.oldMovables;\n        const newMovables = options.newMovables; /* output parameter */\n\n        const renderChildren = elem => {\n            _.each(elem.movableProps, prop => {\n                // Render the children, and save the results of that\n                // render to the appropriate props\n                elem.props[prop] = this._renderMovables(\n                    elem.props[prop],\n                    options\n                );\n            });\n        };\n\n        // Add/modify movables\n\n        // We want to keep track of whether we have added a new svg element,\n        // because if we have, then we need to call .toFront() on any svg\n        // elements occurring afterwards. If this happens, we set\n        // `areMovablesOutOfOrder` to true:\n        let areMovablesOutOfOrder = false;\n        return nestedMap(children, childDescriptor => {\n            if (!childDescriptor) {\n                // Still increment the key to avoid cascading key changes\n                // on hiding/unhiding children, i.e. by using\n                // {someBoolean && <MovablePoint />}\n                options.nextKey++;\n                // preserve the null/undefined in the resulting array\n                return childDescriptor;\n            }\n\n            // Instantiate the descriptor to turn it into a real Movable\n            const child = new childDescriptor.type(childDescriptor.props);\n            assert(\n                child instanceof GraphieMovable,\n                \"All children of a Graphie component must be Graphie \" +\n                    \"movables\"\n            );\n\n            // Give each child a key\n            const keyProp = childDescriptor.key;\n            const key = keyProp == null ? \"_no_id_\" + options.nextKey : keyProp;\n            options.nextKey++;\n            const ref = childDescriptor.ref;\n\n            // We render our children first. This allows us to replace any\n            // `movableProps` on our child with the on-screen movables\n            // corresponding with those descriptors.\n            renderChildren(child);\n\n            const prevMovable = oldMovables[key];\n            if (!prevMovable) {\n                // We're creating a new child\n                child.add(graphie);\n                areMovablesOutOfOrder = true;\n\n                newMovables[key] = child;\n            } else if (child.constructor === prevMovable.constructor) {\n                // We're updating an old child\n                prevMovable.props = child.props;\n                const modifyResult = prevMovable.modify(graphie);\n                if (modifyResult === \"reordered\") {\n                    areMovablesOutOfOrder = true;\n                }\n\n                newMovables[key] = prevMovable;\n            } else {\n                // We're destroying an old child and replacing it\n                // with a new child of a different type\n\n                // This generally is a bad idea, so warn about it if this\n                // is being caused by implicit keys\n                if (keyProp == null) {\n                    /* eslint-disable no-console */\n                    if (typeof console !== \"undefined\" && console.warn) {\n                        console.warn(\n                            \"Replacing a <Graphie> child with a \" +\n                                \"child of a different type. Please add keys \" +\n                                \"to your <Graphie> children\"\n                        );\n                    }\n                    /* eslint-enable no-console */\n                }\n\n                prevMovable.remove();\n                child.add(graphie);\n                areMovablesOutOfOrder = true;\n\n                newMovables[key] = child;\n            }\n\n            if (areMovablesOutOfOrder) {\n                newMovables[key].toFront();\n            }\n\n            if (ref) {\n                this.movables[ref] = newMovables[key];\n            }\n\n            return newMovables[key];\n        });\n    },\n\n    // Sort of like react diffing, but for movables\n    _updateMovables: function() {\n        const graphie = this._graphie;\n\n        const oldMovables = this._movables;\n        const newMovables = {};\n        this._movables = newMovables;\n        this.movables = {};\n\n        this._renderMovables(this.props.children, {\n            nextKey: 1,\n            graphie: graphie,\n            oldMovables: oldMovables,\n            newMovables: newMovables,\n        });\n\n        // Remove any movables that no longer exist in the child array\n        _.each(oldMovables, (oldMovable, key) => {\n            if (!newMovables[key]) {\n                oldMovable.remove();\n            }\n        });\n    },\n\n    render: function() {\n        return (\n            <div className=\"graphie-container\">\n                <div className=\"graphie\" ref=\"graphieDiv\" />\n            </div>\n        );\n    },\n});\n\n// Attach Graphie.createClass and Graphie.createSimpleClass\n_.extend(Graphie, GraphieClasses);\n// Attach the Movable react components for easy reference\n_.extend(Graphie, Movables);\n\n_module_.exports = Graphie;\nexport default _module_.exports;\n","import { negativePhoneMargin } from \"../styles/constants.js\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/prop-types */\n\n/**\n * A wrapper for a component that would otherwise have a fixed width and\n * height, that magically makes it reponsive while preserving its aspect ratio.\n * Specifically, the component will shrink dynamically when it needs to but\n * won't ever grow past its original dimensions.\n *\n * Can wrap multiple components with the same dimensions at the same time;\n * these will be overlaid on top of each other.\n *\n * Usage:\n * <FixedToResponsive width={400} height={400}>\n *     <img src=\"bottom-layer.png\" />\n *     <img src=\"top-layer.png\" />\n * </FixedToResponsive>\n */\nconst classNames = _classnames;\nconst React = _react;\n\nconst MIN_VIEWPORT_HEIGHT = 480;\n\nconst FixedToResponsive = createReactClass({\n    propTypes: {\n        width: PropTypes.number.isRequired,\n        height: PropTypes.number.isRequired,\n        className: PropTypes.string,\n        constrainHeight: PropTypes.bool,\n        allowFullBleed: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            className: \"\",\n            constrainHeight: false,\n            allowFullBleed: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            viewportHeight: null,\n            viewportWidth: null,\n        };\n    },\n\n    componentDidMount: function() {\n        // Cache viewport sizes instead of computing on each render.\n        // We setState() in componentDidMount(), even though it's a React\n        // anti-pattern, because we do actually want to trigger a re-render\n        // after the initial render (because initial render may be\n        // server-side).\n        // TODO(david): Don't do this for each image. Do this once per page.\n        if (window.innerHeight < MIN_VIEWPORT_HEIGHT) {\n            // There is a weird issue when this gets rendered in an Android\n            // webview where window.innerHeight might be initially very small,\n            // like 46, but seems to be good after ~400ms.\n            setTimeout(this._cacheViewportSize, 800);\n        } else {\n            this._cacheViewportSize();\n        }\n    },\n\n    _cacheViewportSize: function() {\n        if (this.isMounted()) {\n            this.setState({\n                viewportHeight: Math.max(\n                    MIN_VIEWPORT_HEIGHT,\n                    window.innerHeight\n                ),\n                viewportWidth: window.innerWidth,\n            });\n        }\n    },\n\n    render: function() {\n        // The ideal behavior for responsified, fixed size child components is\n        // that they shrink when they need to (while preserving aspect ratio)\n        // but never grow larger than their original dimensions. We accomplish\n        // this by absolutely positioning the children and telling them to fill\n        // up all of a space that has the correct aspect ratio.\n        const aspectRatio = this.props.width / this.props.height;\n\n        // This works because padding percentages are interpreted in terms of\n        // the width of the containing block, so:\n        //     (fixed height / fixed width) * display width = display height\n        // Based on http://refills.bourbon.io/components/#video && medium.com\n        const spacer = (\n            <div\n                style={{\n                    paddingBottom: (1 / aspectRatio).toFixed(4) * 100 + \"%\",\n                }}\n            />\n        );\n\n        let {width, height} = this.props;\n\n        // Constrain height to be at most 2/3 viewport height, maintaining\n        // aspect ratio.\n        if (this.props.constrainHeight && this.state.viewportHeight) {\n            const maxHeight = 2 / 3 * this.state.viewportHeight;\n            if (this.props.height >= maxHeight) {\n                height = maxHeight;\n                width = maxHeight * aspectRatio;\n            }\n        }\n\n        // Prevent child components from growing (aka \"the Peter Pan effect\")\n        const style = {\n            maxWidth: width,\n            maxHeight: height,\n        };\n\n        const className = classNames(\n            \"fixed-to-responsive\",\n            this.props.className\n        );\n\n        const container = (\n            <div className={className} style={style}>\n                {spacer}\n                {this.props.children}\n            </div>\n        );\n\n        const shouldFullBleed =\n            this.props.allowFullBleed &&\n            this.state.viewportWidth &&\n            width >= this.state.viewportWidth;\n\n        if (shouldFullBleed) {\n            return (\n                <div\n                    style={{\n                        marginLeft: negativePhoneMargin,\n                        marginRight: negativePhoneMargin,\n                    }}\n                >\n                    {container}\n                </div>\n            );\n        } else {\n            return container;\n        }\n    },\n});\n\n_module_.exports = FixedToResponsive;\nexport default _module_.exports;\n","import _zoomJs from \"../zoom.js\";\nimport _utilJs from \"../util.js\";\nimport { maybeUnescape } from \"../jipt-hack.jsx\";\nimport _componentsImageLoaderJsx from \"../components/image-loader.jsx\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _componentsFixedToResponsiveJsx from \"../components/fixed-to-responsive.jsx\";\nimport _underscore from \"underscore\";\nimport _jquery from \"jquery\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\nimport { isLabeledSVG, getLocalizedDataUrl, getSvgUrl, getDataUrl, getRealImageUrl } from \"../util/svg-image-utils.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* globals KA */\nconst classNames = _classnames;\nconst React = _react;\nconst $ = _jquery;\nconst _ = _underscore;\n\nconst FixedToResponsive = _componentsFixedToResponsiveJsx;\nconst Graphie = _componentsGraphieJsx;\nconst ImageLoader = _componentsImageLoaderJsx;\nconst Util = _utilJs;\nconst Zoom = _zoomJs;\n\n// Minimum image width to make an image appear as zoomable.\nconst ZOOMABLE_THRESHOLD = 700;\n\n// The global cache of label data. Its format is:\n// {\n//   hash (e.g. \"c21435944d2cf0c8f39d9059cb35836aa701d04a\"): {\n//     loaded: a boolean of whether the data has been loaded or not\n//     dataCallbacks: a list of callbacks to call with the data when the data\n//                    is loaded\n//     data: the other data for this hash\n//   },\n//   ...\n// }\nconst labelDataCache = {};\n\n// Write our own JSONP handler because all the other ones don't do things we\n// need.\nconst doJSONP = function(url, options) {\n    options = {\n        callbackName: \"callback\",\n        success: $.noop,\n        error: $.noop,\n        ...options,\n    };\n\n    // Create the script\n    const script = document.createElement(\"script\");\n    script.setAttribute(\"async\", \"\");\n    script.setAttribute(\"src\", url);\n\n    // A cleanup function to run when we're done.\n    function cleanup() {\n        document.head.removeChild(script);\n        delete window[options.callbackName];\n    }\n\n    // Add the global callback.\n    window[options.callbackName] = function() {\n        cleanup();\n        options.success.apply(null, arguments);\n    };\n\n    // Add the error handler.\n    script.addEventListener(\"error\", function() {\n        cleanup();\n        options.error.apply(null, arguments);\n    });\n\n    // Insert the script to start the download.\n    document.head.appendChild(script);\n};\n\nconst hashRegex = /\\/([^/]+)$/;\n\n\nfunction isImageProbablyPhotograph(imageUrl) {\n    // TODO(david): Do an inventory to refine this heuristic. For example, what\n    //     % of .png images are illustrations?\n    return /\\.(jpg|jpeg)$/i.test(imageUrl);\n}\n\nfunction shouldUseLocalizedData() {\n    // TODO(emily): Remove this depenency on `KA` and pass it down with\n    // Perseus' initialization. (Also used in renderer.jsx)\n    return typeof KA !== \"undefined\" && KA.language !== \"en\";\n}\n\nfunction shouldRenderJipt() {\n    return typeof KA !== \"undefined\" && KA.language === \"en-pt\";\n}\n\nconst jiptLabels = [];\nif (shouldRenderJipt()) {\n    if (!KA.jipt_dom_insert_checks) {\n        KA.jipt_dom_insert_checks = [];\n    }\n\n    KA.jipt_dom_insert_checks.push(function(text, node, attribute) {\n        const index = $(node).data(\"jipt-label-index\");\n        if (node && typeof index !== \"undefined\") {\n            const {label, useMath} = jiptLabels[index];\n\n            label.text(\"\");\n\n            text = maybeUnescape(text);\n\n            if (useMath) {\n                const mathRegex = /^\\$(.*)\\$$/;\n                const match = text.match(mathRegex);\n                const mathText = match\n                    ? match[1]\n                    : \"\\\\color{red}{\\\\text{Invalid Math}}\";\n                label.processMath(mathText, true);\n            } else {\n                label.processText(text);\n            }\n\n            return false;\n        }\n        return text;\n    });\n}\n\n// Get the hash from the url, which is just the filename\nfunction getUrlHash(url) {\n    const match = url.match(hashRegex);\n\n    return match && match[1];\n}\n\nfunction defaultPreloader() {\n    return ReactDOMtags.span({\n        style: {\n            background: \"url(/images/spinner.gif) no-repeat\",\n            backgroundPosition: \"center\",\n            width: \"100%\",\n            height: \"100%\",\n            position: \"absolute\",\n            minWidth: \"20px\",\n        },\n    });\n}\n\nconst SvgImage = createReactClass({\n    propTypes: {\n        allowFullBleed: PropTypes.bool,\n        alt: PropTypes.string,\n        constrainHeight: PropTypes.bool,\n\n        extraGraphie: PropTypes.shape({\n            box: PropTypes.array.isRequired,\n            range: PropTypes.array.isRequired,\n            labels: PropTypes.array.isRequired,\n        }),\n\n        height: PropTypes.number,\n\n        // When the DOM updates to replace the preloader with the image, or\n        // vice-versa, we trigger this callback.\n        onUpdate: PropTypes.func,\n\n        preloader: PropTypes.func,\n\n        // By default, this component attempts to be responsive whenever\n        // possible (specifically, when width and height are passed in).\n        // You can expliclty force unresponsive behavior by *either*\n        // not passing in width/height *or* setting this prop to false.\n        // The difference is that forcing via this prop will result in\n        // explicit width and height styles being set on the rendered\n        // component.\n        responsive: PropTypes.bool,\n\n        scale: PropTypes.number,\n        src: PropTypes.string.isRequired,\n        title: PropTypes.string,\n        trackInteraction: PropTypes.func,\n        width: PropTypes.number,\n\n        // Whether clicking this image will allow it to be fully zoomed in to\n        // its original size on click, and allow the user to scroll in that\n        // state. This also does some hacky viewport meta tag changing to\n        // ensure this works on mobile devices, so I (david@) don't recommend\n        // enabling this on desktop yet.\n        zoomToFullSizeOnMobile: PropTypes.bool,\n    },\n\n    statics: {\n        // Sometimes other components want to download the actual image e.g. to\n        // determine its size. Here, we transform an .svg-labels url into the\n        // correct image url, and leave normal image urls alone\n        getRealImageUrl: getRealImageUrl,\n    },\n\n    getDefaultProps: function() {\n        return {\n            constrainHeight: false,\n            onUpdate: () => {},\n            responsive: true,\n            src: \"\",\n            scale: 1,\n            zoomToFullSizeOnMobile: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            imageLoaded: false,\n            imageDimensions: null,\n            dataLoaded: false,\n            labelDataIsLocalized: false,\n            labels: [],\n            range: [[0, 0], [0, 0]],\n        };\n    },\n\n    componentDidMount: function() {\n        if (isLabeledSVG(this.props.src)) {\n            this.loadResources();\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (this.props.src !== nextProps.src) {\n            this.setState({\n                imageLoaded: false,\n                dataLoaded: false,\n            });\n        }\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        // If the props changed, we definitely need to update\n        if (!_.isEqual(this.props, nextProps)) {\n            return true;\n        }\n\n        if (!isLabeledSVG(nextProps.src)) {\n            return false;\n        }\n\n        const wasLoaded = this.isLoadedInState(this.state);\n        const nextLoaded = this.isLoadedInState(nextState);\n\n        return wasLoaded !== nextLoaded;\n    },\n\n    componentDidUpdate: function() {\n        if (isLabeledSVG(this.props.src) && !this.isLoadedInState(this.state)) {\n            this.loadResources();\n        }\n    },\n\n    // Check if all of the resources are loaded in a given state\n    isLoadedInState: function(state) {\n        return state.imageLoaded && state.dataLoaded;\n    },\n\n    loadResources: function() {\n        const hash = getUrlHash(this.props.src);\n\n        // We can't make multiple jsonp calls to the same file because their\n        // callbacks will collide with each other. Instead, we cache the data\n        // and only make the jsonp calls once.\n        if (labelDataCache[hash]) {\n            if (labelDataCache[hash].loaded) {\n                const {data, localized} = labelDataCache[hash];\n                this.onDataLoaded(data, localized);\n            } else {\n                labelDataCache[hash].dataCallbacks.push(this.onDataLoaded);\n            }\n        } else {\n            const cacheData = {\n                loaded: false,\n                dataCallbacks: [this.onDataLoaded],\n                data: null,\n                localized: shouldUseLocalizedData(),\n            };\n\n            labelDataCache[hash] = cacheData;\n\n            const retrieveData = (url, errorCallback) => {\n                doJSONP(url, {\n                    callbackName: \"svgData\" + hash,\n                    success: data => {\n                        cacheData.data = data;\n                        cacheData.loaded = true;\n\n                        _.each(cacheData.dataCallbacks, callback => {\n                            callback(cacheData.data, cacheData.localized);\n                        });\n                    },\n                    error: errorCallback,\n                });\n            };\n\n            if (shouldUseLocalizedData()) {\n                retrieveData(\n                    getLocalizedDataUrl(this.props.src),\n                    (x, status, error) => {\n                        cacheData.localized = false;\n\n                        // If there is isn't any localized data, fall back to\n                        // the original, unlocalized data\n                        retrieveData(\n                            getDataUrl(this.props.src),\n                            (x, status, error) => {\n                                // eslint-disable-next-line no-console\n                                console.error(\n                                    \"Data load failed:\",\n                                    getDataUrl(this.props.src),\n                                    error\n                                );\n                            }\n                        );\n                    }\n                );\n            } else {\n                retrieveData(getDataUrl(this.props.src), (x, status, error) => {\n                    // eslint-disable-next-line no-console\n                    console.error(\n                        \"Data load failed:\",\n                        getDataUrl(this.props.src),\n                        error\n                    );\n                });\n            }\n        }\n    },\n\n    onDataLoaded: function(data, localized) {\n        if (this.isMounted() && data.labels && data.range) {\n            this.setState({\n                dataLoaded: true,\n                labelDataIsLocalized: localized,\n                labels: data.labels,\n                range: data.range,\n            });\n        }\n    },\n\n    sizeProvided: function() {\n        return this.props.width != null && this.props.height != null;\n    },\n\n    onImageLoad: function() {\n        // Only need to do this if rendering a Graphie\n        if (this.sizeProvided()) {\n            // If width and height are provided, we don't need to calculate the\n            // size ourselves\n            this.setState({\n                imageLoaded: true,\n            });\n        } else {\n            Util.getImageSize(this.props.src, (width, height) => {\n                if (this.isMounted()) {\n                    this.setState({\n                        imageLoaded: true,\n                        imageDimensions: [width, height],\n                    });\n                }\n            });\n        }\n    },\n\n    setupGraphie: function(graphie, options) {\n        _.map(options.labels, labelData => {\n            if (shouldRenderJipt() && this.state.labelDataIsLocalized) {\n                // If we're using JIPT translation and we got proper JIPT tags,\n                // render the labels as plain text (so JIPT can find them) and\n                // add some extra properties to the element so we can properly\n                // re-render the label once it is replaced with translated\n                // text.\n                const elem = graphie.label(\n                    labelData.coordinates,\n                    labelData.content,\n                    labelData.alignment,\n                    false\n                );\n\n                $(elem).data(\"jipt-label-index\", jiptLabels.length);\n                jiptLabels.push({\n                    label: elem,\n                    useMath: labelData.typesetAsMath,\n                });\n            } else if (labelData.coordinates) {\n                // Create labels from the data\n                // TODO(charlie): Some erroneous labels are being sent down\n                // without coordinates. They don't seem to have any content, so\n                // it seems fine to just ignore them (rather than error), but\n                // we should figure out why this is happening.\n                const label = graphie.label(\n                    labelData.coordinates,\n                    labelData.content,\n                    labelData.alignment,\n                    labelData.typesetAsMath,\n                    {\"font-size\": 100 * this.props.scale + \"%\"}\n                );\n\n                // Convert absolute positioning css from pixels to percentages\n                // TODO(alex): Dynamically resize font-size as well. This\n                // almost certainly means listening to throttled window.resize\n                // events.\n                const labelStyle = label[0].style;\n                let labelTop = this._tryGetPixels(labelStyle.top);\n                let labelLeft = this._tryGetPixels(labelStyle.left);\n                if (labelTop === null || labelLeft === null) {\n                    // Graphie labels are supposed to have an explicit position,\n                    // but to be on the safe side, let's fall back to using\n                    // jQuery's position(). The reason we're not always using\n                    // this is that in the presence of CSS transforms, it will\n                    // give the rendered position, which may be scaled and\n                    // not equal to the explicitly specified one.\n                    const labelPosition = label.position();\n                    labelTop = labelPosition.top;\n                    labelLeft = labelPosition.left;\n                }\n                const svgHeight = this.props.height * this.props.scale;\n                const svgWidth = this.props.width * this.props.scale;\n                label.css({\n                    top: labelTop / svgHeight * 100 + \"%\",\n                    left: labelLeft / svgWidth * 100 + \"%\",\n                });\n\n                // Add back the styles to each of the labels\n                _.each(labelData.style, (styleValue, styleName) => {\n                    label.css(styleName, styleValue);\n                });\n            }\n        });\n    },\n\n    // Try to parse a CSS value as pixels. Returns null if the parameter string\n    // does not contain a number followed by \"px\".\n    _tryGetPixels: function(value) {\n        value = value || \"\";\n        // While this doesn't check that there are no other alphabetical\n        // characters prior to \"px\", that should be taken care of by the DOM,\n        // which won't accept invalid units.\n        if (!value.endsWith(\"px\")) {\n            return null;\n        }\n        // parseFloat() ignores trailing non-numerical characters.\n        return parseFloat(value) || null;\n    },\n\n    _handleZoomClick: function(e) {\n        const $image = $(e.target);\n\n        // It's possible that the image is already displayed at its\n        // full size, but we don't really know that until we get a chance\n        // to measure it (just now, after the user clicks). We only zoom\n        // if there's more image to be shown.\n        //\n        // TODO(kevindangoor) If the window is narrow and the image is\n        // already displayed as wide as possible, we may want to do\n        // nothing in that case as well. Figuring this out correctly\n        // likely required accounting for the image alignment and margins.\n        if (\n            $image.width() < this.props.width ||\n            this.props.zoomToFullSizeOnMobile\n        ) {\n            Zoom.ZoomService.handleZoomClick(\n                e,\n                this.props.zoomToFullSizeOnMobile\n            );\n        }\n        this.props.trackInteraction && this.props.trackInteraction();\n    },\n\n    render: function() {\n        const imageSrc = this.props.src;\n\n        // Props to send to all images\n        const imageProps = {\n            alt: this.props.alt,\n            title: this.props.title,\n        };\n\n        const width = this.props.width && this.props.width * this.props.scale;\n        const height =\n            this.props.height && this.props.height * this.props.scale;\n        const dimensions = {\n            width: width,\n            height: height,\n        };\n\n        // To make an image responsive, we need to know what its width and\n        // height are in advance (before inserting it into the DOM) so that we\n        // can ensure it doesn't grow past those limits. We don't always have\n        // this information, especially in places where <Renderer /> is used\n        // to render inline Markdown images within a widget. See Radio, Sorter,\n        // Matcher, etc.\n        // TODO(alex): Make all of those image rendering locations aware of\n        // width+height so that they too can render responsively.\n        const responsive = this.props.responsive && !!(width && height);\n\n        // An additional <Graphie /> may be inserted after the image/graphie\n        // pair. Only used by the image widget, for its legacy labels support.\n        // Note that since the image widget always provides width and height\n        // data, extraGraphie can be ignored for unresponsive images.\n        // TODO(alex): Convert all existing uses of that to web+graphie. This\n        // is tricky because web+graphie doesn't support labels on non-graphie\n        // images.\n        let extraGraphie;\n        if (this.props.extraGraphie && this.props.extraGraphie.labels.length) {\n            extraGraphie = (\n                <Graphie\n                    box={this.props.extraGraphie.box}\n                    range={this.props.extraGraphie.range}\n                    options={{labels: this.props.extraGraphie.labels}}\n                    responsive={true}\n                    addMouseLayer={false}\n                    setup={this.setupGraphie}\n                />\n            );\n        }\n\n        // If preloader is undefined, we use the default. If it's\n        // null, there will be no preloader in use.\n        const preloaderBaseFunc =\n            this.props.preloader === undefined\n                ? defaultPreloader\n                : this.props.preloader;\n\n        const preloader = preloaderBaseFunc\n            ? () => preloaderBaseFunc(dimensions)\n            : null;\n\n        // Just use a normal image if a normal image is provided\n        if (!isLabeledSVG(imageSrc)) {\n            if (responsive) {\n                const wrapperClasses = classNames({\n                    zoomable: width > ZOOMABLE_THRESHOLD,\n                    \"svg-image\": true,\n                });\n\n                imageProps.onClick = this._handleZoomClick;\n\n                return (\n                    <FixedToResponsive\n                        className={wrapperClasses}\n                        width={width}\n                        height={height}\n                        constrainHeight={this.props.constrainHeight}\n                        allowFullBleed={\n                            this.props.allowFullBleed &&\n                            isImageProbablyPhotograph(imageSrc)\n                        }\n                    >\n                        <ImageLoader\n                            src={imageSrc}\n                            imgProps={imageProps}\n                            preloader={preloader}\n                            onUpdate={this.props.onUpdate}\n                        />\n                        {extraGraphie}\n                    </FixedToResponsive>\n                );\n            } else {\n                imageProps.style = dimensions;\n                return (\n                    <ImageLoader\n                        src={imageSrc}\n                        preloader={preloader}\n                        imgProps={imageProps}\n                        onUpdate={this.props.onUpdate}\n                    />\n                );\n            }\n        }\n\n        const imageUrl = getSvgUrl(imageSrc);\n\n        let graphie;\n        // Since we only want to do the graphie setup once, we only render the\n        // graphie once everything is loaded\n        if (this.isLoadedInState(this.state)) {\n            // Use the provided width and height to size the graphie if\n            // possible, otherwise use our own calculated size\n            let box;\n            if (this.sizeProvided()) {\n                box = [width, height];\n            } else {\n                box = [\n                    this.state.imageDimensions[0] * this.props.scale,\n                    this.state.imageDimensions[1] * this.props.scale,\n                ];\n            }\n\n            const scale = [40 * this.props.scale, 40 * this.props.scale];\n\n            graphie = (\n                <Graphie\n                    ref=\"graphie\"\n                    box={box}\n                    scale={scale}\n                    range={this.state.range}\n                    options={_.pick(this.state, \"labels\")}\n                    responsive={responsive}\n                    addMouseLayer={false}\n                    setup={this.setupGraphie}\n                />\n            );\n        }\n\n        if (responsive) {\n            return (\n                <FixedToResponsive\n                    className=\"svg-image\"\n                    width={width}\n                    height={height}\n                    constrainHeight={this.props.constrainHeight}\n                >\n                    <ImageLoader\n                        src={imageUrl}\n                        onLoad={this.onImageLoad}\n                        onUpdate={this.props.onUpdate}\n                        preloader={preloader}\n                        imgProps={imageProps}\n                    />\n                    {graphie}\n                    {extraGraphie}\n                </FixedToResponsive>\n            );\n        } else {\n            imageProps.style = dimensions;\n            return (\n                <div className=\"unresponsive-svg-image\" style={dimensions}>\n                    <ImageLoader\n                        src={imageUrl}\n                        onLoad={this.onImageLoad}\n                        onUpdate={this.props.onUpdate}\n                        preloader={preloader}\n                        imgProps={imageProps}\n                    />\n                    {graphie}\n                </div>\n            );\n        }\n    },\n});\n\n_module_.exports = SvgImage;\nexport default _module_.exports;\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\n\nvar QuestionParagraph = createReactClass({\n    render: function() {\n        var className = this.props.className\n            ? \"paragraph \" + this.props.className\n            : \"paragraph\";\n        // For perseus-article just-in-place-translation (jipt), we need\n        // to attach some metadata to top-level QuestionParagraphs:\n        return (\n            <div\n                className={className}\n                data-perseus-component-index={this.props.translationIndex}\n                data-perseus-paragraph-index={this.props.paragraphIndex}\n            >\n                {this.props.children}\n            </div>\n        );\n    },\n});\n\n_module_.exports = QuestionParagraph;\nexport default _module_.exports;\n","import _simpleMarkdown from \"simple-markdown\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Paragraph parsing/splitting for article jipt i18n\n */\n\nconst SimpleMarkdown = _simpleMarkdown;\n\nconst arrayRules = {\n    fence: {\n        match: SimpleMarkdown.defaultRules.fence.match,\n        order: 1,\n        parse: (capture, state, parse) => capture[3],\n    },\n    paragraph: {\n        match: SimpleMarkdown.defaultRules.paragraph.match,\n        order: 2,\n        parse: (capture, state, parse) => capture[1],\n    },\n};\n\nconst builtArrayParser = SimpleMarkdown.parserFor(arrayRules);\n\n// This should just return an array of strings! magick!\nconst parseToArray = source => {\n    // Remove any leading newlines to avoid splitting weirdness\n    // (simple-markdown has the `newline` rule for this, and i have\n    // no idea how this will handle leading newlines without that rule),\n    // and add \\n\\n to let it parse at a block/paragraph level\n    const paragraphedSource = source.replace(/^\\n\\s*\\n/, \"\") + \"\\n\\n\";\n    return builtArrayParser(paragraphedSource, {inline: false});\n};\n\nconst joinFromArray = paragraphs => paragraphs.join(\"\\n\\n\");\n\n_module_.exports = {\n    parseToArray: parseToArray,\n    joinFromArray: joinFromArray,\n};\nexport default _module_.exports;\n","\nimport Rule from \"./gorgon/rule.js\";\n\n/**\n * NotGorgon asynchronously calls Khan Academy's poentry linter.\n *\n * The poentry linter checks for issues that prevent content from being\n * translated. This linter is KA-specific and so NotGorgon does not do anything\n * in non-KA environments.\n *\n * NotGorgon is named as such because it is not Gorgon, Perseus' built-in\n * linter.\n */\n\nimport { debounce } from \"underscore\";\n\n// msec to wait before we actually call the linter after receiving the\n// last call. The timer is reset if the lint is called during the wait.\nconst DEBOUNCE_TIMEOUT = 1000;\n\nexport default class NotGorgon {\n  // To avoid linting when nothing has changed.\n  previousContent = null;\n\n  /**\n   * Runs the poentry linter on the given perseus string asynchronously.\n   *\n   * It doesn't do anything unless we're in a KA environment.\n   *\n   * onLintErrorsGenerated is called even if there are no errors. It is not\n   * called if perseusStr is unchanged from the last call.\n   *\n   * Linting is relatively expensive -- so we debounce linting each instance\n   * for some amount of time.\n   */\n  runLinter = debounce((perseusStr, onLintErrorsGenerated) => {\n    // $FlowFixMe -- TODO(joshuan): use an api flag instead?\n    if (typeof KA === \"undefined\") {\n      return;\n    }\n\n    if (perseusStr === this.previousContent) {\n      return;\n    }\n\n    this.previousContent = perseusStr;\n\n    if (perseusStr === \"\") {\n      onLintErrorsGenerated([]);\n      return;\n    }\n\n    fetch(\"/api/internal/translate/lint_poentry?preview=1&lang=en\", {\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        // The poentry linter verifies that the translation from\n        // the original text to the translated text is sane. We\n        // want to ensure that the translation from English to\n        // English is sane, so msgid === mstr.\n        msgid: perseusStr, // msgid is the original text\n        msgstr: perseusStr, // msgstr is the translated text\n        format: \"perseus_text\",\n        filename: \"\"\n      }),\n      method: \"POST\"\n    })\n      .then(\n        response => {\n          if (response.status >= 400) {\n            return {\n              status: \"error\",\n              message: \"Could not run i18n linter.\"\n            };\n          }\n          return response.json();\n        },\n        rejection => {\n          return {\n            status: \"error\",\n            message: \"Could not run i18n linter.\"\n          };\n        }\n      )\n      .then(json => {\n        if (json.status === \"error\") {\n          onLintErrorsGenerated([\n            \"Some part of this text makes it untranslatable. \" +\n              \"The specific message from the i18n linter was: \" +\n              json.message.replace(/\\n/g, \" \")\n          ]);\n        } else {\n          onLintErrorsGenerated([]);\n        }\n      });\n  }, DEBOUNCE_TIMEOUT);\n\n  /**\n   * Applies an array of errors generated by linters without position\n   * information (NotGorgon and the legacy getSaveWarnings()) to the top\n   * of a Perseus tree.\n   */\n  applyLintErrors(parsedMarkdown, notGorgonLintErrors) {\n    // These lint errors do not have position data associated with\n    // them, so we just plop them at the top.\n    if (notGorgonLintErrors.length) {\n      const errorText = notGorgonLintErrors.join(\"\\n\\n\");\n      parsedMarkdown.unshift({\n        content: {\n          type: \"text\",\n          content: \"\"\n        },\n        insideTable: false,\n        message: errorText,\n        ruleName: \"legacy-error\",\n        severity: Rule.Severity.ERROR,\n        type: \"lint\"\n      });\n    }\n  }\n\n  destroy() {\n    this.runLinter = null;\n    this.previousContent = null;\n  }\n}\n","import { mapObject, mapObjectFromArray } from \"./interactive2/objective_.js\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport _utilKatexPreprocessJs from \"./util/katex-preprocess.js\";\nimport _deferredJs from \"./deferred.js\";\nimport _componentsZoomableJsx from \"./components/zoomable.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _mixinsApiOptionsPropsJs from \"./mixins/api-options-props.js\";\nimport _utilJs from \"./util.js\";\nimport _widgetsJs from \"./widgets.js\";\nimport _widgetContainerJsx from \"./widget-container.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _componentsSvgImageJsx from \"./components/svg-image.jsx\";\nimport _questionParagraphJsx from \"./question-paragraph.jsx\";\nimport _perseusMarkdownJsx from \"./perseus-markdown.jsx\";\nimport { maybeUnescape } from \"./jipt-hack.jsx\";\nimport _jiptParagraphsJsx from \"./jipt-paragraphs.jsx\";\nimport _classnames from \"classnames\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _jquery from \"jquery\";\nimport NotGorgon from \"./not-gorgon.js\"; // The i18n linter\n/* eslint-disable max-lines, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals KA */\nvar $ = _jquery;\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\nvar classNames = _classnames;\n\nvar JiptParagraphs = _jiptParagraphsJsx;\nvar PerseusMarkdown = _perseusMarkdownJsx;\nvar QuestionParagraph = _questionParagraphJsx;\nvar SvgImage = _componentsSvgImageJsx;\nvar TeX = _reactComponentsTexJsx;\nvar WidgetContainer = _widgetContainerJsx;\nvar Widgets = _widgetsJs;\n\nvar Util = _utilJs;\nvar ApiOptionsProps = _mixinsApiOptionsPropsJs;\nvar ApiClassNames = _perseusApiJsx.ClassNames;\nvar Zoomable = _componentsZoomableJsx;\nvar Deferred = _deferredJs;\nvar preprocessTex = _utilKatexPreprocessJs;\n\nconst Gorgon = _gorgonGorgonJs; // The linter engine\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\nconst {keypadElementPropType} = _mathInput.propTypes;\n\nvar rContainsNonWhitespace = /\\S/;\nvar rImageURL = /(web\\+graphie|https):\\/\\/[^\\s]*/;\n\nconst noopOnRender = () => {};\n\nif (typeof KA !== \"undefined\" && KA.language === \"en-pt\") {\n    // When using crowdin's jipt (Just in place translation), we need to keep a\n    // registry of crowdinId's to component so that we can update the\n    // component's state as the translator enters their translation.\n    window.PerseusTranslationComponents = [];\n\n    if (!KA.jipt_dom_insert_checks) {\n        KA.jipt_dom_insert_checks = [];\n    }\n\n    // We add a function that will get called whenever jipt says the dom needs\n    // to be updated\n    KA.jipt_dom_insert_checks.push(function(text, node, attribute) {\n        var $node = $(node);\n        var index = $node.data(\"perseus-component-index\");\n        var paragraphIndex = $node.data(\"perseus-paragraph-index\");\n        // We only update if we had added an index onto the node's data.\n        if (node && typeof index !== \"undefined\") {\n            var component = window.PerseusTranslationComponents[index];\n\n            if (!component) {\n                // The component has disappeared, so we tell jipt not to try\n                // and insert anything\n                return false;\n            }\n            // Jipt sometimes sends down the escaped translation, so we need to\n            // unescape \\\\t to \\t among other characters here\n            text = maybeUnescape(text);\n\n            component.replaceJiptContent(text, paragraphIndex);\n\n            // Return false to tell jipt not to insert anything into the DOM\n            // itself, otherwise it will mess up what React expects there to be\n            return false;\n        }\n        // The string updated wasn't part of perseus, so we tell jipt to just\n        // insert the translation as-is.\n        return text;\n    });\n}\n\nvar SHOULD_CLEAR_WIDGETS_PROP_LIST = [\"content\", \"problemNum\", \"widgets\"];\n\n// Check if one focus path / id path is a prefix of another\n// The focus path null will never be a prefix of any non-null\n// path, since it represents no focus.\n// Otherwise, prefix is calculated by whether every array\n// element in the prefix is present in the same position in the\n// wholeArray path.\nvar isIdPathPrefix = function(prefixArray, wholeArray) {\n    if (prefixArray === null || wholeArray === null) {\n        return prefixArray === wholeArray;\n    }\n    return _.every(prefixArray, (elem, i) => {\n        return _.isEqual(elem, wholeArray[i]);\n    });\n};\n\n/**\n * Wrapper for the trackInteraction apiOption.\n *\n * @param trackApi Original API\n * @param widgetType String name of the widget type\n * @param widgetID String ID of the widget instance\n * @param setting string setting for tracking (either \"\" for track once or\n *          \"all\")\n */\nvar InteractionTracker = function(trackApi, widgetType, widgetID, setting) {\n    if (!trackApi) {\n        this.track = this._noop;\n    } else {\n        this._tracked = false;\n        this.trackApi = trackApi;\n        this.widgetType = widgetType;\n        this.widgetID = widgetID;\n        this.setting = setting;\n        this.track = this._track.bind(this);\n    }\n};\n\n/**\n * Function that actually calls the API to mark the interaction. This is\n * private. The public version is just `.track` and is bound to this object\n * for easy use in other context.\n *\n * @param extraData Any extra data to track about the event.\n * @private\n */\nInteractionTracker.prototype._track = function(extraData) {\n    if (this._tracked && !this.setting) {\n        return;\n    }\n    this._tracked = true;\n    this.trackApi({\n        type: this.widgetType,\n        id: this.widgetID,\n        ...extraData,\n    });\n};\n\n/**\n * This alternate version of `.track` does nothing as an optimization.\n *\n * @private\n */\nInteractionTracker.prototype._noop = function() {};\n\nvar Renderer = createReactClass({\n    propTypes: {\n        ...ApiOptionsProps.propTypes,\n        alwaysUpdate: PropTypes.bool,\n        findExternalWidgets: PropTypes.func,\n        highlightedWidgets: PropTypes.arrayOf(PropTypes.any),\n        ignoreMissingWidgets: PropTypes.bool,\n        images: PropTypes.any,\n        keypadElement: keypadElementPropType,\n        onInteractWithWidget: PropTypes.func,\n        onRender: PropTypes.func,\n        problemNum: PropTypes.number,\n        questionCompleted: PropTypes.bool,\n        reviewMode: PropTypes.bool,\n\n        serializedState: PropTypes.any,\n        // Callback which is called when serialized state changes with the new\n        // serialized state.\n        onSerializedStateUpdated: PropTypes.func,\n\n        // If linterContext.highlightLint is true, then content will be passed\n        // to the linter and any warnings will be highlighted in the rendered\n        // output.\n        linterContext: linterContextProps,\n\n        legacyPerseusLint: PropTypes.arrayOf(PropTypes.string),\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            widgets: {},\n            images: {},\n            // TODO(aria): Remove this now that it is true everywhere\n            // (here and in perseus-i18n)\n            ignoreMissingWidgets: true,\n            highlightedWidgets: [],\n            // onRender may be called multiple times per render, for example\n            // if there are multiple images or TeX pieces within `content`.\n            // It is a good idea to debounce any functions passed here.\n            questionCompleted: false,\n            onRender: noopOnRender,\n            onInteractWithWidget: function() {},\n            findExternalWidgets: () => [],\n            alwaysUpdate: false,\n            reviewMode: false,\n            serializedState: null,\n            onSerializedStateUpdated: () => {},\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return _.extend({\n            jiptContent: null,\n            // The i18n linter.\n            // TODO(joshuan): If this becomes an ES6 class, move to a\n            // member variable.\n            notGorgon: new NotGorgon(),\n            // NotGorgon is async and currently does not contain a location.\n            // This is a list of error strings NotGorgon detected on its last\n            // run.\n            notGorgonLintErrors: [],\n        }, this._getInitialWidgetState());\n    },\n\n    componentDidMount: function() {\n        this.handleRender({});\n        this._currentFocus = null;\n\n        this._rootNode = ReactDOM.findDOMNode(this);\n        this._isMounted = true;\n\n        // TODO(emily): actually make the serializedState prop work like a\n        // controlled prop, instead of manually calling .restoreSerializedState\n        // at the right times.\n        if (this.props.serializedState) {\n            this.restoreSerializedState(this.props.serializedState);\n        }\n\n        if (this.props.linterContext.highlightLint) {\n            // Get i18n lint errors asynchronously. If there are lint errors,\n            // this component will be rerendered.\n            this.state.notGorgon.runLinter(\n                this.props.content,\n                this.handleNotGorgonLintErrors);\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (\n            !_.isEqual(\n                _.pick(this.props, SHOULD_CLEAR_WIDGETS_PROP_LIST),\n                _.pick(nextProps, SHOULD_CLEAR_WIDGETS_PROP_LIST)\n            )\n        ) {\n            this.setState(this._getInitialWidgetState(nextProps));\n        }\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        if (this.props.alwaysUpdate) {\n            // TOTAL hacks so that findWidgets doesn't break\n            // when one widget updates without the other.\n            // See passage-refs inside radios, which was why\n            // this was introduced.\n            // I'm sorry!\n            // TODO(aria): cry\n            return true;\n        }\n        var stateChanged = !_.isEqual(this.state, nextState);\n        var propsChanged = !_.isEqual(this.props, nextProps);\n        return propsChanged || stateChanged;\n    },\n\n    componentWillUpdate: function(nextProps, nextState) {\n        var oldJipt = this.shouldRenderJiptPlaceholder(this.props, this.state);\n        var newJipt = this.shouldRenderJiptPlaceholder(nextProps, nextState);\n        var oldContent = this.getContent(this.props, this.state);\n        var newContent = this.getContent(nextProps, nextState);\n        var oldHighlightedWidgets = this.props.highlightedWidgets;\n        var newHighlightedWidgets = nextProps.highlightedWidgets;\n\n        // TODO(jared): This seems to be a perfect overlap with\n        // \"shouldComponentUpdate\" -- can we just remove this\n        // componentWillUpdate and the reuseMarkdown attr?\n\n\n        // TODO(aria): The nextState.notGorgonLintErrors`),` seems to be semantically incorrect?\n        this.reuseMarkdown =\n            !oldJipt &&\n            !newJipt &&\n            oldContent === newContent &&\n            _.isEqual(this.state.notGorgonLintErrors,\n            // WARN(aria): I changed the , condition here to an &&\n                nextState.notGorgonLintErrors) &&\n            // If we are running the linter then we need to know when\n            // widgets have changed because we need for force the linter to\n            // run when that happens. Note: don't do identity comparison here:\n            // it can cause frequent re-renders that break MathJax somehow\n            (!this.props.linterContext.highlightLint ||\n                _.isEqual(this.props.widgets, nextProps.widgets)) &&\n            // If the linter is turned on or off, we have to rerender\n            this.props.linterContext.highlightLint ===\n                nextProps.linterContext.highlightLint &&\n            // yes, this is identity array comparison, but these are passed\n            // in from state in the item-renderer, so they should be\n            // identity equal unless something changed, and it's expensive\n            // to loop through them to look for differences.\n            // Technically, we could reuse the markdown when this changes,\n            // but to do that we'd have to do more expensive checking of\n            // whether a widget should be highlighted in the common case\n            // where this array hasn't changed, so we just redo the whole\n            // render if this changed\n            oldHighlightedWidgets === newHighlightedWidgets;\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        this.handleRender(prevProps);\n        // We even do this if we did reuse the markdown because\n        // we might need to update the widget props on this render,\n        // even though we have the same widgets.\n        // WidgetContainers don't update their widgets' props when\n        // they are re-rendered, so even if they've been\n        // re-rendered we need to call these methods on them.\n        _.each(this.widgetIds, id => {\n            var container = this.refs[\"container:\" + id];\n            container.replaceWidgetProps(this.getWidgetProps(id));\n        });\n\n        if (\n            this.props.serializedState &&\n            !_.isEqual(this.props.serializedState, this.getSerializedState())\n        ) {\n            this.restoreSerializedState(this.props.serializedState);\n        }\n\n        if (this.props.linterContext.highlightLint) {\n            // Get i18n lint errors asynchronously. If lint errors have changed\n            // since the last run, this component will be rerendered.\n            this.state.notGorgon.runLinter(\n                this.props.content,\n                this.handleNotGorgonLintErrors);\n        }\n    },\n\n    componentWillUnmount: function() {\n        // Clean out the list of widgetIds when unmounting, as this list is\n        // meant to be consistent with the refs controlled by the renderer, and\n        // refs are also cleared out during unmounting.\n        // (This may not be totally necessary, but mobile clients have been\n        // seeing JS errors due to an inconsistency between the list of\n        // widgetIds and the child refs of the renderer.\n        // See: https://phabricator.khanacademy.org/D32420.)\n        this.widgetIds = [];\n\n        if (this.translationIndex != null) {\n            window.PerseusTranslationComponents[this.translationIndex] = null;\n        }\n\n        this.state.notGorgon.destroy();\n\n        this._isMounted = false;\n    },\n\n    getApiOptions() {\n        return ApiOptionsProps.getApiOptions.call(this);\n    },\n\n    _getInitialWidgetState: function(props) {\n        props = props || this.props;\n        var allWidgetInfo = this._getAllWidgetsInfo(props);\n        return {\n            widgetInfo: allWidgetInfo,\n            widgetProps: this._getAllWidgetsStartProps(allWidgetInfo, props),\n        };\n    },\n\n    _getAllWidgetsInfo: function(props) {\n        props = props || this.props;\n        return mapObject(props.widgets, (widgetInfo, widgetId) => {\n            if (!widgetInfo.type || !widgetInfo.alignment) {\n                var newValues = {};\n\n                if (!widgetInfo.type) {\n                    newValues.type = widgetId.split(\" \")[0];\n                }\n                if (!widgetInfo.alignment) {\n                    newValues.alignment = \"default\";\n                }\n\n                widgetInfo = _.extend({}, widgetInfo, newValues);\n            }\n            return Widgets.upgradeWidgetInfoToLatestVersion(widgetInfo);\n        });\n    },\n\n    _getAllWidgetsStartProps: function(allWidgetInfo, props) {\n        return mapObject(allWidgetInfo, editorProps => {\n            return Widgets.getRendererPropsForWidgetInfo(\n                editorProps,\n                props.problemNum\n            );\n        });\n    },\n\n    _getDefaultWidgetInfo: function(widgetId) {\n        var widgetIdParts = Util.rTypeFromWidgetId.exec(widgetId);\n        if (widgetIdParts == null) {\n            return {};\n        }\n        return {\n            type: widgetIdParts[1],\n            graded: true,\n            options: {},\n        };\n    },\n\n    _getWidgetInfo: function(widgetId) {\n        return (\n            this.state.widgetInfo[widgetId] ||\n            this._getDefaultWidgetInfo(widgetId)\n        );\n    },\n\n    renderWidget: function(impliedType, id, state) {\n        var widgetInfo = this.state.widgetInfo[id];\n\n        if (widgetInfo && widgetInfo.alignment === \"full-width\") {\n            state.foundFullWidth = true;\n        }\n\n        if (widgetInfo || this.props.ignoreMissingWidgets) {\n            var type = (widgetInfo && widgetInfo.type) || impliedType;\n            var shouldHighlight = _.contains(this.props.highlightedWidgets, id);\n\n            // By this point we should have no duplicates, which are\n            // filtered out in this.render(), so we shouldn't have to\n            // worry about using this widget key and ref:\n            return (\n                <WidgetContainer\n                    ref={\"container:\" + id}\n                    key={\"container:\" + id}\n                    type={type}\n                    initialProps={this.getWidgetProps(id)}\n                    shouldHighlight={shouldHighlight}\n                    linterContext={Gorgon.pushContextStack(\n                        this.props.linterContext,\n                        \"widget\"\n                    )}\n                />\n            );\n        } else {\n            return null;\n        }\n    },\n\n    getWidgetProps: function(id) {\n        const apiOptions = this.getApiOptions();\n        const widgetProps = this.state.widgetProps[id] || {};\n\n        // The widget needs access to its \"rubric\" at all times when in review\n        // mode (which is really just part of its widget info).\n        let reviewModeRubric = null;\n        const widgetInfo = this.state.widgetInfo[id];\n        if (this.props.reviewMode && widgetInfo) {\n            reviewModeRubric = widgetInfo.options;\n        }\n\n        if (!this._interactionTrackers) {\n            this._interactionTrackers = {};\n        }\n\n        let interactionTracker = this._interactionTrackers[id];\n        if (!interactionTracker) {\n            interactionTracker = this._interactionTrackers[\n                id\n            ] = new InteractionTracker(\n                apiOptions.trackInteraction,\n                widgetInfo && widgetInfo.type,\n                id,\n                Widgets.getTracking(widgetInfo && widgetInfo.type)\n            );\n        }\n\n        return {\n            ...widgetProps,\n            ref: id,\n            widgetId: id,\n            alignment: widgetInfo && widgetInfo.alignment,\n            static: widgetInfo && widgetInfo.static,\n            problemNum: this.props.problemNum,\n            apiOptions: this.getApiOptions(this.props),\n            keypadElement: this.props.keypadElement,\n            questionCompleted: this.props.questionCompleted,\n            onFocus: _.partial(this._onWidgetFocus, id),\n            onBlur: _.partial(this._onWidgetBlur, id),\n            findWidgets: this.findWidgets,\n            reviewModeRubric: reviewModeRubric,\n            onChange: (newProps, cb, silent = false) => {\n                this._setWidgetProps(id, newProps, cb, silent);\n            },\n            trackInteraction: interactionTracker.track,\n        };\n    },\n\n    /**\n    * Serializes the questions state so it can be recovered.\n    *\n    * The return value of this function can be sent to the\n    * `restoreSerializedState` method to restore this state.\n    *\n    * If an instance of widgetProps is passed in, it generates the serialized\n    * state from that instead of the current widget props.\n    */\n    getSerializedState: function(widgetProps) {\n        return mapObject(\n            widgetProps || this.state.widgetProps,\n            (props, widgetId) => {\n                var widget = this.getWidgetInstance(widgetId);\n                if (widget && widget.getSerializedState) {\n                    return widget.getSerializedState();\n                } else {\n                    return props;\n                }\n            }\n        );\n    },\n\n    restoreSerializedState: function(serializedState, callback) {\n        // Do some basic validation on the serialized state (just make sure the\n        // widget IDs are what we expect).\n        var serializedWidgetIds = _.keys(serializedState);\n        var widgetPropIds = _.keys(this.state.widgetProps);\n\n        // If the two lists of IDs match (ignoring order)\n        if (\n            serializedWidgetIds.length !== widgetPropIds.length ||\n            _.intersection(serializedWidgetIds, widgetPropIds).length !==\n                serializedWidgetIds.length\n        ) {\n            // eslint-disable-next-line no-console\n            console.error(\n                \"Refusing to restore bad serialized state:\",\n                serializedState,\n                \"Current props:\",\n                this.state.widgetProps\n            );\n            return;\n        }\n\n        // We want to wait until any children widgets who have a\n        // restoreSerializedState function also call their own callbacks before\n        // we declare that the operation is finished.\n        var numCallbacks = 1;\n        var fireCallback = () => {\n            --numCallbacks;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        this.setState(\n            {\n                widgetProps: mapObject(serializedState, (props, widgetId) => {\n                    var widget = this.getWidgetInstance(widgetId);\n                    if (widget && widget.restoreSerializedState) {\n                        // Note that we probably can't call\n                        // `this.change()/this.props.onChange()` in this\n                        // function, so we take the return value and use\n                        // that as props if necessary so that\n                        // `restoreSerializedState` in a widget can\n                        // change the props as well as state.\n                        // If a widget has no props to change, it can\n                        // safely return null.\n                        ++numCallbacks;\n                        var restoreResult = widget.restoreSerializedState(\n                            props,\n                            fireCallback\n                        );\n                        return _.extend(\n                            {},\n                            this.state.widgetProps[widgetId],\n                            restoreResult\n                        );\n                    } else {\n                        return props;\n                    }\n                }),\n            },\n            fireCallback\n        );\n    },\n\n    /**\n     * Tell each of the radio widgets to show rationales for each of the\n     * currently selected choices inside of them. If the widget is correct, it\n     * shows rationales for all of the choices. This also disables interaction\n     * with the choices that we show rationales for.\n     */\n    showRationalesForCurrentlySelectedChoices() {\n        Object.keys(this.props.widgets).forEach(widgetId => {\n            const widget = this.getWidgetInstance(widgetId);\n            if (widget && widget.showRationalesForCurrentlySelectedChoices) {\n                widget.showRationalesForCurrentlySelectedChoices(\n                    this._getWidgetInfo(widgetId).options\n                );\n            }\n        });\n    },\n\n    /**\n     * Tells each of the radio widgets to deselect any of the incorrect choices\n     * that are currently selected (leaving correct choices still selected).\n     */\n    deselectIncorrectSelectedChoices() {\n        // TODO(emily): this has the exact same structure as\n        // showRationalesForCurrentlySelectedChoices above. Maybe DRY this up.\n        Object.keys(this.props.widgets).forEach(widgetId => {\n            const widget = this.getWidgetInstance(widgetId);\n            if (widget && widget.deselectIncorrectSelectedChoices) {\n                widget.deselectIncorrectSelectedChoices();\n            }\n        });\n    },\n\n    /**\n     * Allows inter-widget communication.\n     *\n     * This function yields this Renderer's own internal widgets, and it's used\n     * in two places.\n     *\n     * First, we expose our own internal widgets to each other by giving them\n     * a `findWidgets` function that, in turn, calls this function.\n     *\n     * Second, we expose our own internal widgets to this Renderer's parent,\n     * by allowing it to call this function directly. That way, it can hook us\n     * up to other Renderers on the page, by writing a `findExternalWidgets`\n     * prop that calls each other Renderer's `findInternalWidgets` function.\n     *\n     * Takes a `filterCriterion` on which widgets to return.\n     * `filterCriterion` can be one of:\n     *  * A string widget id\n     *  * A string widget type\n     *  * a function from (id, widgetInfo, widgetComponent) to true or false\n     *\n     * Returns an array of the matching widget components.\n     *\n     * If you need to do logic with more than the components, it is possible\n     * to do such logic inside the filter, rather than on the result array.\n     *\n     * See the passage-ref widget for an example.\n     *\n     * \"Remember: abilities are not inherently good or evil, it's how you use\n     * them.\" ~ Kyle Katarn\n     * Please use this one with caution.\n     */\n    findInternalWidgets: function(filterCriterion) {\n        var filterFunc;\n        // Convenience filters:\n        // \"interactive-graph 3\" will give you [[interactive-graph 3]]\n        // \"interactive-graph\" will give you all interactive-graphs\n        if (typeof filterCriterion === \"string\") {\n            if (filterCriterion.indexOf(\" \") !== -1) {\n                var widgetId = filterCriterion;\n                filterFunc = (id, widgetInfo) => id === widgetId;\n            } else {\n                var widgetType = filterCriterion;\n                filterFunc = (id, widgetInfo) => {\n                    return widgetInfo.type === widgetType;\n                };\n            }\n        } else {\n            filterFunc = filterCriterion;\n        }\n\n        var results = this.widgetIds\n            .filter(id => {\n                var widgetInfo = this._getWidgetInfo(id);\n                var widget = this.getWidgetInstance(id);\n                return filterFunc(id, widgetInfo, widget);\n            })\n            .map(this.getWidgetInstance);\n\n        return results;\n    },\n\n    /**\n     * Allows inter-widget communication.\n     *\n     * Includes both widgets internal to this Renderer, and external widgets\n     * exposed by the `findExternalWidgets` prop.\n     *\n     * See `findInteralWidgets` for more information.\n     */\n    findWidgets: function(filterCriterion) {\n        return [\n            ...this.findInternalWidgets(filterCriterion),\n            ...this.props.findExternalWidgets(filterCriterion),\n        ];\n    },\n\n    getWidgetInstance: function(id) {\n        var ref = this.refs[\"container:\" + id];\n        if (!ref) {\n            return null;\n        }\n        return ref.getWidget();\n    },\n\n    _onWidgetFocus: function(id, focusPath) {\n        if (focusPath === undefined) {\n            focusPath = [];\n        } else {\n            if (!_.isArray(focusPath)) {\n                throw new Error(\n                    \"widget props.onFocus focusPath must be an Array, \" +\n                        \"but was\" +\n                        JSON.stringify(focusPath)\n                );\n            }\n        }\n        this._setCurrentFocus([id].concat(focusPath));\n    },\n\n    _onWidgetBlur: function(id, blurPath) {\n        var blurringFocusPath = this._currentFocus;\n\n        // Failsafe: abort if ID is different, because focus probably happened\n        // before blur\n        var fullPath = [id].concat(blurPath);\n        if (!_.isEqual(fullPath, blurringFocusPath)) {\n            return;\n        }\n\n        // Wait until after any new focus events fire this tick before\n        // declaring that nothing is focused.\n        // If a different widget was focused, we'll see an onBlur event\n        // now, but then an onFocus event on a different element before\n        // this callback is executed\n        _.defer(() => {\n            if (_.isEqual(this._currentFocus, blurringFocusPath)) {\n                this._setCurrentFocus(null);\n            }\n        });\n    },\n\n    getContent: function(props, state) {\n        return state.jiptContent || props.content;\n    },\n\n    shouldRenderJiptPlaceholder: function(props, state) {\n        // TODO(aria): Pass this in via webapp as an apiOption\n        return (\n            typeof KA !== \"undefined\" &&\n            KA.language === \"en-pt\" &&\n            state.jiptContent == null &&\n            props.content.indexOf(\"crwdns\") !== -1\n        );\n    },\n\n    replaceJiptContent: function(content, paragraphIndex) {\n        if (paragraphIndex == null) {\n            // we're not translating paragraph-wise; replace the whole content\n            // (we could also theoretically check for apiOptions.isArticle\n            // here, which is what causes paragraphIndex to not be null)\n            this.setState({\n                jiptContent: content,\n            });\n        } else {\n            // This is the same regex we use in perseus/translate.py to find\n            // code blocks. We use it to count entire code blocks as\n            // paragraphs.\n            const codeFenceRegex = /^\\s*(`{3,}|~{3,})\\s*(\\S+)?\\s*\\n([\\s\\S]+?)\\s*\\1\\s*$/; // eslint-disable-line max-len\n\n            if (codeFenceRegex.test(content)) {\n                // If a paragraph is a code block, we're going to treat it as a\n                // single paragraph even if it has double-newlines in it, so\n                // skip the next two checks.\n            } else if (/\\S\\n\\s*\\n\\S/.test(content)) {\n                // Our \"render the exact same QuestionParagraphs each time\"\n                // strategy will fail if we allow translating a paragraph\n                // to more than one paragraph. This hack renders as a single\n                // paragraph and lets the translator know to not use \\n\\n,\n                // hopefully. We can't wait for linting because we can't\n                // safely render the node.\n                // TODO(aria): Check for the max number of backticks or tildes\n                // in the content, and just render a red code block of the\n                // content here instead?\n                content =\n                    \"$\\\\large{\\\\red{\\\\text{Please translate each \" +\n                    \"paragraph to a single paragraph.}}}$\";\n            } else if (/^\\s*$/.test(content)) {\n                // We similarly can't have an all-whitespace paragraph, or\n                // we will parse it as the closing of the previous paragraph\n                content =\n                    \"$\\\\large{\\\\red{\\\\text{Translated paragraph is \" +\n                    \"currently empty}}}$\";\n            }\n            // Split the paragraphs; we have to use getContent() in case\n            // nothing has been translated yet (in which case we just have\n            // this.props.content)\n            var allContent = this.getContent(this.props, this.state);\n            var paragraphs = JiptParagraphs.parseToArray(allContent);\n            paragraphs[paragraphIndex] = content;\n            this.setState({\n                jiptContent: JiptParagraphs.joinFromArray(paragraphs),\n            });\n        }\n    },\n\n    // wrap top-level elements in a QuestionParagraph, mostly\n    // for appropriate spacing and other css\n    outputMarkdown: function(ast, state) {\n        if (_.isArray(ast)) {\n            // This is duplicated from simple-markdown\n            // TODO(aria): Don't duplicate this logic\n            var oldKey = state.key;\n            var result = [];\n\n            // map nestedOutput over the ast, except group any text\n            // nodes together into a single string output.\n            // NOTE(aria): These are never strings--always QuestionParagraphs\n            // TODO(aria): We probably don't need this string logic here.\n            var lastWasString = false;\n            for (var i = 0; i < ast.length; i++) {\n                state.key = i;\n                state.paragraphIndex = i;\n                var nodeOut = this.outputMarkdown(ast[i], state);\n                var isString = typeof nodeOut === \"string\";\n                if (isString && lastWasString) {\n                    result[result.length - 1] += nodeOut;\n                } else {\n                    result.push(nodeOut);\n                }\n                lastWasString = isString;\n            }\n\n            state.key = oldKey;\n            return result;\n        } else {\n            // !!! WARNING: Mutative hacks! mutates `this._foundTextNodes`:\n            // because I wrote a bad interface to simple-markdown.js' `output`\n            this._foundTextNodes = false;\n            state.foundFullWidth = false;\n            var output = this.outputNested(ast, state);\n\n            // In Jipt-land, we need to render the exact same outer\n            // QuestionParagraph nodes always. This means the number of\n            // paragraphs needs to stay the same, and we can't modify\n            // the classnames on the QuestionParagraphs or we'll destroy\n            // the crowdin classnames. So we just only use the\n            // 'paragraph' classname from the QuestionParagraph.\n            // If this becomes a problem it would be easy to fix by wrapping\n            // the nodes in an extra layer (hopefully only for jipt) that\n            // handles the jipt classnames, and let this layer handle the\n            // dynamic classnames.\n            // We can't render the classes the first time and leave them\n            // the same because we don't know at the time of the first\n            // render whether they are full-bleed or centered, since they\n            // only contain crowdin IDs like `crwdns:972384209:0...`\n            var className;\n            if (this.translationIndex != null) {\n                className = null;\n            } else {\n                className = classNames({\n                    \"perseus-paragraph-centered\": !this._foundTextNodes,\n                    // There is only one node being rendered,\n                    // and it's a full-width widget.\n                    \"perseus-paragraph-full-width\":\n                        state.foundFullWidth && ast.content.length === 1,\n                });\n            }\n\n            return (\n                <QuestionParagraph\n                    key={state.key}\n                    className={className}\n                    translationIndex={this.translationIndex}\n                    paragraphIndex={state.paragraphIndex}\n                >\n                    {output}\n                </QuestionParagraph>\n            );\n        }\n    },\n\n    // output non-top-level nodes or arrays\n    outputNested: function(ast, state) {\n        if (_.isArray(ast)) {\n            // This is duplicated from simple-markdown\n            // TODO(aria): Don't duplicate this logic\n            var oldKey = state.key;\n            var result = [];\n\n            // map nestedOutput over the ast, except group any text\n            // nodes together into a single string output.\n            var lastWasString = false;\n            for (var i = 0; i < ast.length; i++) {\n                state.key = i;\n                var nodeOut = this.outputNested(ast[i], state);\n                var isString = typeof nodeOut === \"string\";\n                if (isString && lastWasString) {\n                    result[result.length - 1] += nodeOut;\n                } else {\n                    result.push(nodeOut);\n                }\n                lastWasString = isString;\n            }\n\n            state.key = oldKey;\n            return result;\n        } else {\n            return this.outputNode(ast, this.outputNested, state);\n        }\n    },\n\n    // output individual AST nodes [not arrays]\n    outputNode: function(node, nestedOutput, state) {\n        var apiOptions = this.getApiOptions();\n        var imagePlaceholder = apiOptions.imagePlaceholder;\n\n        if (node.type === \"widget\") {\n            var widgetPlaceholder = apiOptions.widgetPlaceholder;\n\n            if (widgetPlaceholder) {\n                return widgetPlaceholder;\n            }\n            // Widgets can contain text nodes, so we don't center them with\n            // markdown magic here.\n            // Instead, we center them with css magic in articles.less\n            // /cry(aria)\n            this._foundTextNodes = true;\n\n            if (_.contains(this.widgetIds, node.id)) {\n                // We don't want to render a duplicate widget key/ref,\n                // as this causes problems with react (for obvious\n                // reasons). Instead we just notify the\n                // hopefully-content-creator that they need to change the\n                // widget id.\n                return (\n                    <span key={state.key} className=\"renderer-widget-error\">\n                        Widget [[{\"\\u2603\"} {node.id}]] already exists.\n                    </span>\n                );\n            } else {\n                this.widgetIds.push(node.id);\n                return this.renderWidget(node.widgetType, node.id, state);\n            }\n        } else if (node.type === \"blockMath\") {\n            // We render math here instead of in perseus-markdown.jsx\n            // because we need to pass it our onRender callback.\n            const deferred = new Deferred();\n\n            const onRender = node => {\n                this.props.onRender && this.props.onRender(node);\n\n                if (apiOptions.isMobile) {\n                    // `onRender` only returns a node on the initial render.\n                    if (node) {\n                        const katex = node.querySelector(\".katex\");\n\n                        // Though MathJax's visible elements should have been\n                        // inserted into the DOM by now (and, thus, we should be\n                        // able to query for .MathJax instead), we're not seeing\n                        // that guarantee play out in practice. So we look for\n                        // either .MathJax or the script tag that is inserted\n                        // on initial render.\n                        // TODO(charlie): This works, but feels very brittle.\n                        // Figure out how we can call `onRender` only after the\n                        // elements have been inserted into the DOM.\n                        const mathjax =\n                            node.querySelector('script[type=\"math/tex\"]') ||\n                            node.querySelector(\".MathJax\");\n\n                        if (katex) {\n                            deferred.resolve();\n                        } else if (mathjax) {\n                            deferred.resolve();\n                        } else {\n                            throw new Error(\"No math present in Renderer\");\n                        }\n                    }\n                }\n            };\n\n            const content = (\n                <TeX onRender={onRender} onResourceLoaded={onRender}>\n                    {preprocessTex(node.content)}\n                </TeX>\n            );\n\n            const innerStyle = {\n                // HACK(benkomalo): we only want horizontal scrolling, but\n                // overflowX: 'auto' causes a vertical scrolling scrollbar\n                // as well, despite the parent and child elements having\n                // the exact same height. Force it to not scroll by\n                // applying overflowY: 'hidden'\n                overflowX: \"auto\",\n                overflowY: \"hidden\",\n\n                // HACK(kevinb): overflowY: 'hidden' inadvertently clips the\n                // top and bottom of some fractions.  We add padding to the\n                // top and bottom to avoid the clipping and then correct for\n                // the padding by adding equal but opposite margins.\n                paddingTop: 10,\n                paddingBottom: 10,\n                marginTop: -10,\n                marginBottom: -10,\n            };\n\n            if (apiOptions.isMobile) {\n                // The style for the body of articles and exercises on mobile is\n                // to have a 16px margin.  When a user taps to zoom math we'd\n                // like the math to extend all the way to the edge of the page/\n                // To achieve this affect we nest the Zoomable component in two\n                // nested divs. The outer div has a negative margin to\n                // counteract the margin on main perseus container.  The inner\n                // div adds the margin back as padding so that when the math is\n                // scaled out it's inset from the edge of the page.  When the\n                // TeX component is full size it will extend to the edge of the\n                // page if it's larger than the page.\n                //\n                // TODO(kevinb) automatically determine the margin size\n                const margin = 16;\n                const outerStyle = {\n                    marginLeft: -margin,\n                    marginRight: -margin,\n                };\n                const horizontalPadding = {\n                    paddingLeft: margin,\n                    paddingRight: margin,\n                };\n\n                const computeMathBounds = (parentNode, parentBounds) => {\n                    const textElement =\n                        parentNode.querySelector(\".katex-html\") ||\n                        parentNode.querySelector(\".MathJax\");\n                    const textBounds = {\n                        width: textElement.offsetWidth,\n                        height: textElement.offsetHeight,\n                    };\n\n                    // HACK(benkomalo): when measuring math content, note that\n                    // sometimes it actually peeks outside of the\n                    // container in some cases. Just be conservative and use\n                    // the maximum value of the text and the parent. :(\n                    return {\n                        width: Math.max(parentBounds.width, textBounds.width),\n                        height: Math.max(\n                            parentBounds.height,\n                            textBounds.height\n                        ),\n                    };\n                };\n\n                return (\n                    <div\n                        key={state.key}\n                        className=\"perseus-block-math\"\n                        style={outerStyle}\n                    >\n                        <div\n                            className=\"perseus-block-math-inner\"\n                            style={{...innerStyle, ...horizontalPadding}}\n                        >\n                            <Zoomable\n                                readyToMeasureDeferred={deferred}\n                                computeChildBounds={computeMathBounds}\n                            >\n                                {content}\n                            </Zoomable>\n                        </div>\n                    </div>\n                );\n            } else {\n                return (\n                    <div key={state.key} className=\"perseus-block-math\">\n                        <div\n                            className=\"perseus-block-math-inner\"\n                            style={innerStyle}\n                        >\n                            {content}\n                        </div>\n                    </div>\n                );\n            }\n        } else if (node.type === \"math\") {\n            // Replace uses of \\begin{align}...\\end{align} which KaTeX doesn't\n            // support (yet) with \\begin{aligned}...\\end{aligned} which renders\n            // the same is supported by KaTeX.  It does the same for align*.\n            // TODO(kevinb) update content to use aligned instead of align.\n            const tex = node.content.replace(/\\{align[*]?\\}/g, \"{aligned}\");\n\n            // We render math here instead of in perseus-markdown.jsx\n            // because we need to pass it our onRender callback.\n            return (\n                <span\n                    key={state.key}\n                    style={{\n                        // If math is directly next to text, don't let it\n                        // wrap to the next line\n                        whiteSpace: \"nowrap\",\n                    }}\n                >\n                    {/* We add extra empty spans around the math to make it not\n                    wrap (I don't know why this works, but it does) */}\n                    <span />\n                    <TeX\n                        onRender={this.props.onRender}\n                        onResourceLoaded={this.props.onRender}\n                    >\n                        {tex}\n                    </TeX>\n                    <span />\n                </span>\n            );\n        } else if (node.type === \"image\") {\n            if (imagePlaceholder) {\n                return imagePlaceholder;\n            }\n\n            // We need to add width and height to images from our\n            // props.images mapping.\n\n            // We do a _.has check here to avoid weird things like\n            // 'toString' or '__proto__' as a url.\n            var extraAttrs = _.has(this.props.images, node.target)\n                ? this.props.images[node.target]\n                : null;\n\n            // The width of a table column is determined by the widest table\n            // cell within that column, but responsive images constrain\n            // themselves to the width of their parent containers. Thus,\n            // responsive images don't do very well within tables. To avoid\n            // haphazard sizing, simply make images within tables unresponsive.\n            // TODO(alex): Make tables themselves responsive.\n            var responsive = !state.inTable;\n\n            return (\n                <SvgImage\n                    key={state.key}\n                    src={PerseusMarkdown.sanitizeUrl(node.target)}\n                    alt={node.alt}\n                    title={node.title}\n                    responsive={responsive}\n                    onUpdate={this.props.onRender}\n                    zoomToFullSizeOnMobile={\n                        apiOptions.isMobile && apiOptions.isArticle\n                    }\n                    {...extraAttrs}\n                />\n            );\n        } else if (node.type === \"columns\") {\n            // Note that we have two columns. This is so we can put\n            // a className on the outer renderer content for SAT.\n            // TODO(aria): See if there is a better way we can do\n            // things like this\n            this._isTwoColumn = true;\n            // but then render normally:\n            return PerseusMarkdown.ruleOutput(node, nestedOutput, state);\n        } else if (node.type === \"text\") {\n            if (rContainsNonWhitespace.test(node.content)) {\n                this._foundTextNodes = true;\n            }\n\n            // Used by the translator portal to replace image URLs with\n            // placeholders, see preprocessWidgets in manticore-utils.js\n            // for more details.\n            if (imagePlaceholder && rImageURL.test(node.content)) {\n                return imagePlaceholder;\n            } else {\n                return node.content;\n            }\n        } else if (node.type === \"table\" || node.type === \"titledTable\") {\n            state.inTable = true;\n            const output = PerseusMarkdown.ruleOutput(\n                node,\n                nestedOutput,\n                state\n            );\n            state.inTable = false;\n\n            if (!apiOptions.isMobile) {\n                return output;\n            }\n\n            const margin = 16;\n            const outerStyle = {\n                marginLeft: -margin,\n                marginRight: -margin,\n            };\n            const innerStyle = {\n                paddingLeft: 0,\n                paddingRight: 0,\n            };\n\n            const wrappedOutput = (\n                <div style={{...innerStyle, overflowX: \"auto\"}}>\n                    <Zoomable animateHeight={true}>\n                        {output}\n                    </Zoomable>\n                </div>\n            );\n\n            // TODO(benkomalo): how should we deal with tappable items inside\n            // of tables?\n            return (\n                <div style={outerStyle}>\n                    {wrappedOutput}\n                </div>\n            );\n        } else {\n            // If it's a \"normal\" or \"simple\" markdown node, just\n            // output it using its output rule.\n            return PerseusMarkdown.ruleOutput(node, nestedOutput, state);\n        }\n    },\n\n    handleRender: function(prevProps) {\n        const onRender = this.props.onRender;\n        const oldOnRender = prevProps.onRender;\n\n        // In the common case of no callback specified, avoid this work.\n        if (onRender !== noopOnRender || oldOnRender !== noopOnRender) {\n            const $images = $(ReactDOM.findDOMNode(this)).find(\"img\");\n\n            // Fire callback on image load...\n            if (oldOnRender !== noopOnRender) {\n                $images.off(\"load\", oldOnRender);\n            }\n\n            if (onRender !== noopOnRender) {\n                $images.on(\"load\", onRender);\n            }\n        }\n\n        // ...as well as right now (non-image, non-TeX or image from cache)\n        onRender();\n    },\n\n    // Sets the current focus path\n    // If the new focus path is not a prefix of the old focus path,\n    // we send an onChangeFocus event back to our parent.\n    _setCurrentFocus: function(path) {\n        const apiOptions = this.getApiOptions();\n\n        // We don't do this when the new path is a prefix because\n        // that prefix is already focused (we're just in a more specific\n        // area of it). This makes it safe to call _setCurrentFocus\n        // whenever a widget is interacted with--we won't wipe out\n        // our focus state if we are already focused on a subpart\n        // of that widget (i.e. a transformation NumberInput inside\n        // of a transformer widget).\n        if (!isIdPathPrefix(path, this._currentFocus)) {\n            var prevFocus = this._currentFocus;\n\n            if (prevFocus) {\n                this.blurPath(prevFocus);\n            }\n\n            this._currentFocus = path;\n            if (apiOptions.onFocusChange != null) {\n                apiOptions.onFocusChange(this._currentFocus, prevFocus);\n            }\n        }\n    },\n\n    focus: function() {\n        var id;\n        var focusResult;\n        for (var i = 0; i < this.widgetIds.length; i++) {\n            var widgetId = this.widgetIds[i];\n            var widget = this.getWidgetInstance(widgetId);\n            var widgetFocusResult = widget && widget.focus && widget.focus();\n            if (widgetFocusResult) {\n                id = widgetId;\n                focusResult = widgetFocusResult;\n                break;\n            }\n        }\n\n        if (id) {\n            // reconstruct a {path, element} focus object\n            var path;\n            if (_.isObject(focusResult)) {\n                // The result of focus was a {path, id} object itself\n                path = [id].concat(focusResult.path || []);\n            } else {\n                // The result of focus was true or the like; just\n                // construct a root focus object\n                path = [id];\n            }\n\n            this._setCurrentFocus(path);\n            return true;\n        }\n    },\n\n    getDOMNodeForPath: function(path) {\n        var widgetId = _.first(path);\n        var interWidgetPath = _.rest(path);\n\n        // Widget handles parsing of the interWidgetPath. If the path is empty\n        // beyond the widgetID, as a special case we just return the widget's\n        // DOM node.\n        var widget = this.getWidgetInstance(widgetId);\n        var getNode = widget.getDOMNodeForPath;\n        if (getNode) {\n            return getNode(interWidgetPath);\n        } else if (interWidgetPath.length === 0) {\n            return ReactDOM.findDOMNode(widget);\n        }\n    },\n\n    getGrammarTypeForPath: function(path) {\n        var widgetId = _.first(path);\n        var interWidgetPath = _.rest(path);\n\n        var widget = this.getWidgetInstance(widgetId);\n        return widget.getGrammarTypeForPath(interWidgetPath);\n    },\n\n    getInputPaths: function() {\n        var inputPaths = [];\n        _.each(this.widgetIds, widgetId => {\n            var widget = this.getWidgetInstance(widgetId);\n            if (widget.getInputPaths) {\n                // Grab all input paths and add widgetID to the front\n                var widgetInputPaths = widget.getInputPaths();\n                // Prefix paths with their widgetID and add to collective\n                // list of paths.\n                _.each(widgetInputPaths, inputPath => {\n                    var relativeInputPath = [widgetId].concat(inputPath);\n                    inputPaths.push(relativeInputPath);\n                });\n            }\n        });\n\n        return inputPaths;\n    },\n\n    focusPath: function(path) {\n        // No need to focus if it's already focused\n        if (_.isEqual(this._currentFocus, path)) {\n            return;\n        } else if (this._currentFocus) {\n            // Unfocus old path, if exists\n            this.blurPath(this._currentFocus);\n        }\n\n        var widgetId = _.first(path);\n        var interWidgetPath = _.rest(path);\n\n        // Widget handles parsing of the interWidgetPath\n        var focusWidget = this.getWidgetInstance(widgetId).focusInputPath;\n        focusWidget && focusWidget(interWidgetPath);\n    },\n\n    blurPath: function(path) {\n        // No need to blur if it's not focused\n        if (!_.isEqual(this._currentFocus, path)) {\n            return;\n        }\n\n        var widgetId = _.first(path);\n        var interWidgetPath = _.rest(path);\n        var widget = this.getWidgetInstance(widgetId);\n        // We might be in the editor and blurring a widget that no\n        // longer exists, so only blur if we actually found the widget\n        if (widget) {\n            var blurWidget = this.getWidgetInstance(widgetId).blurInputPath;\n            // Widget handles parsing of the interWidgetPath\n            blurWidget && blurWidget(interWidgetPath);\n        }\n    },\n\n    blur: function() {\n        if (this._currentFocus) {\n            this.blurPath(this._currentFocus);\n        }\n    },\n\n    serialize: function() {\n        var state = {};\n        _.each(\n            this.state.widgetInfo,\n            function(info, id) {\n                var widget = this.getWidgetInstance(id);\n                var s = widget.serialize();\n                if (!_.isEmpty(s)) {\n                    state[id] = s;\n                }\n            },\n            this\n        );\n        return state;\n    },\n\n    emptyWidgets: function() {\n        return _.filter(this.widgetIds, id => {\n            var widgetInfo = this._getWidgetInfo(id);\n            var score = this.getWidgetInstance(id).simpleValidate(\n                widgetInfo.options,\n                null\n            );\n            return Util.scoreIsEmpty(score);\n        });\n    },\n\n    _setWidgetProps: function(\n        id,\n        newProps,\n        cb,\n        // Widgets can call `onChange` with `silent` set to `true` to prevent\n        // interaction events from being triggered in listeners.\n        silent\n    ) {\n        this.setState(\n            prevState => {\n                const widgetProps = {\n                    ...prevState.widgetProps,\n                    [id]: {\n                        ...prevState.widgetProps[id],\n                        ...newProps,\n                    },\n                };\n\n                if (!silent) {\n                    this.props.onSerializedStateUpdated(\n                        this.getSerializedState(widgetProps)\n                    );\n                }\n\n                return {\n                    widgetProps,\n                };\n            },\n            () => {\n                var cbResult = cb && cb();\n                if (!silent) {\n                    this.props.onInteractWithWidget(id);\n                }\n                if (cbResult !== false) {\n                    // TODO(jack): For some reason, some widgets don't always\n                    // end up in refs here, which is repro-able if you make an\n                    // [[ orderer 1 ]] and copy-paste this, then change it to\n                    // be an [[ orderer 2 ]]. The resulting Renderer ends up\n                    // with an \"orderer 2\" ref but not an \"orderer 1\" ref.\n                    // @_@??\n                    // TODO(jack): Figure out why this is happening and fix it\n                    // As far as I can tell, this is only an issue in the\n                    // editor-page, so doing this shouldn't break clients\n                    // hopefully\n                    this._setCurrentFocus([id]);\n                }\n            }\n        );\n    },\n\n    setInputValue: function(path, newValue, focus) {\n        var widgetId = _.first(path);\n        var interWidgetPath = _.rest(path);\n        var widget = this.getWidgetInstance(widgetId);\n\n        // Widget handles parsing of the interWidgetPath.\n        widget.setInputValue(interWidgetPath, newValue, focus);\n    },\n\n    /**\n     * Returns an array of the widget `.getUserInput()` results\n     */\n    getUserInput: function() {\n        return _.map(this.widgetIds, id => {\n            return this.getWidgetInstance(id).getUserInput();\n        });\n    },\n\n    /**\n     * Returns an array of all widget IDs in the order they occur in\n     * the content.\n     */\n    getWidgetIds: function() {\n        return this.widgetIds;\n    },\n\n    /**\n     * WARNING: This is an experimental/temporary API and should not be relied\n     *     upon in production code. This function may change its behavior or\n     *     disappear without notice.\n     *\n     * Returns a treelike structure containing all widget IDs (this will\n     * descend into group widgets as well).\n     *\n     * An example of what the structure looks like:\n     *\n     * [\n     *    {id: \"radio 1\", children: []},\n     *    {\n     *        id: \"group 1\",\n     *        children: [\n     *            {id: \"radio 1\", children: []}\n     *            {id: \"radio 2\", children: []}\n     *        ]\n     *    }\n     * ]\n     *\n     * Widgets will be listed in the order that they appear in their renderer.\n     *\n     * Note: If a group hasn't been rendered yet, though, then its children\n     * ids will not be returned.\n     * TODO(marcia): We should figure out a way to either return the widget ids\n     * without needing to render all-the-things, or we should probably have a\n     * better pattern for requesting widget ids so we are more likely to get\n     * one true answer.\n     */\n    getAllWidgetIds: function() {\n        // Recursively builds our result\n        return _.map(this.getWidgetIds(), id => {\n            var groupPrefix = \"group\";\n            if (\n                id.substring(0, groupPrefix.length) === groupPrefix &&\n                this.getWidgetInstance(id)\n            ) {\n                return {\n                    id: id,\n                    children: this.getWidgetInstance(id)\n                        .getRenderer()\n                        .getAllWidgetIds(),\n                };\n            }\n\n            // This is our base case\n            return {id: id, children: []};\n        });\n    },\n\n    /**\n     * Returns the result of `.getUserInput()` for each widget, in\n     * a map from widgetId to userInput.\n     */\n    getUserInputForWidgets: function() {\n        return mapObjectFromArray(this.widgetIds, id => {\n            return this.getWidgetInstance(id).getUserInput();\n        });\n    },\n\n    /**\n     * Returns an object mapping from widget ID to perseus-style score.\n     * The keys of this object are the values of the array returned\n     * from `getWidgetIds`.\n     */\n    scoreWidgets: function() {\n        var widgetProps = this.state.widgetInfo;\n        var onInputError = this.getApiOptions().onInputError || function() {};\n\n        var gradedWidgetIds = _.filter(this.widgetIds, id => {\n            var props = widgetProps[id];\n            // props.graded is unset or true\n            return props.graded == null || props.graded;\n        });\n\n        var widgetScores = {};\n        _.each(gradedWidgetIds, id => {\n            var props = widgetProps[id];\n            var widget = this.getWidgetInstance(id);\n            if (!widget) {\n                // This can occur if the widget has not yet been rendered\n                return;\n            }\n            widgetScores[id] = widget.simpleValidate(\n                props.options,\n                onInputError\n            );\n        });\n\n        return widgetScores;\n    },\n\n    /**\n     * Grades the content.\n     *\n     * Returns a perseus-style score of {\n     *     type: \"invalid\"|\"points\",\n     *     message: string,\n     *     earned: undefined|number,\n     *     total: undefined|number\n     * }\n     */\n    score: function() {\n        return _.reduce(this.scoreWidgets(), Util.combineScores, Util.noScore);\n    },\n\n    guessAndScore: function() {\n        var totalGuess = this.getUserInput();\n        var totalScore = this.score();\n\n        return [totalGuess, totalScore];\n    },\n\n    examples: function() {\n        var widgets = this.widgetIds;\n        var examples = _.compact(\n            _.map(widgets, function(widget) {\n                return widget.examples ? widget.examples() : null;\n            })\n        );\n\n        // no widgets with examples\n        if (!examples.length) {\n            return null;\n        }\n\n        var allEqual = _.all(examples, function(example) {\n            return _.isEqual(examples[0], example);\n        });\n\n        // some widgets have different examples\n        // TODO(alex): handle this better\n        if (!allEqual) {\n            return null;\n        }\n\n        return examples[0];\n    },\n\n    // NotGorgon callback\n    handleNotGorgonLintErrors: function(lintErrors) {\n        if (!this._isMounted) {\n            return;\n        }\n\n        this.setState({\n            notGorgonLintErrors: lintErrors,\n        });\n    },\n\n    render: function() {\n        const apiOptions = this.getApiOptions();\n\n        if (this.reuseMarkdown) {\n            return this.lastRenderedMarkdown;\n        }\n\n        var content = this.getContent(this.props, this.state);\n        // `this.widgetIds` is appended to in `this.outputMarkdown`:\n        this.widgetIds = [];\n\n        if (this.shouldRenderJiptPlaceholder(this.props, this.state)) {\n            // Crowdin's JIPT (Just in place translation) uses a fake language\n            // with language tag \"en-pt\" where the value of the translations\n            // look like: {crwdns2657085:0}{crwdne2657085:0} where it keeps the\n            // {crowdinId:ngettext variant}. We detect whether the current\n            // content matches this, so we can take over rendering of\n            // the perseus content as the translators interact with jipt.\n            // We search for only part of the tag that crowdin uses to guard\n            // against them changing the format on us. The full tag it looks\n            // for can be found in https://cdn.crowdin.net/jipt/jipt.js\n            // globalPhrase var.\n\n            // If we haven't already added this component to the registry do so\n            // now. showHints() may cause this component to be rerendered\n            // before jipt has a chance to replace its contents, so this check\n            // will keep us from adding the component to the registry a second\n            // time.\n            if (!this.translationIndex) {\n                this.translationIndex =\n                    window.PerseusTranslationComponents.push(this) - 1;\n            }\n\n            // For articles, we add jipt data to individual paragraphs. For\n            // exercises, we add it to the renderer and let translators\n            // translate the entire thing. For the article equivalent of\n            // this if block, search this file for where we render a\n            // QuestionParagraph, and see the `isJipt:` parameter sent to\n            // PerseusMarkdown.parse()\n            if (!apiOptions.isArticle) {\n                // We now need to output this tag, as jipt looks for it to be\n                // able to replace it with a translation that it runs an ajax\n                // call to get.  We add a data attribute with the index to the\n                // Persues.TranslationComponent registry so that when jipt\n                // calls its before_dom_insert we can lookup this component by\n                // this attribute and render the text with markdown.\n                return (\n                    <div data-perseus-component-index={this.translationIndex}>\n                        {content}\n                    </div>\n                );\n            }\n        }\n\n        // Hacks:\n        // We use mutable state here to figure out whether the output\n        // had two columns.\n        // It is updated to true by `this.outputMarkdown` if a\n        // column break is found\n        // TODO(aria): We now have a state variable threaded through\n        // simple-markdown output. We should mutate it instead of\n        // state on this component to do this in a less hacky way.\n        this._isTwoColumn = false;\n\n        // Parse the string of markdown to a parse tree\n        var parsedMarkdown = PerseusMarkdown.parse(content, {\n            // Recognize crowdin IDs while translating articles\n            // (This should never be hit by exercises, though if you\n            // decide you want to add a check that this is an article,\n            // go for it.)\n            isJipt: this.translationIndex != null,\n        });\n\n        // Optionally apply the linter to the parse tree\n        if (this.props.linterContext.highlightLint) {\n            // If highlightLint is true and lint is detected, this call\n            // will modify the parse tree by adding lint nodes that will\n            // serve to highlight the lint when rendered\n            const context = {\n                content: this.props.content,\n                widgets: this.props.widgets,\n                ...this.props.linterContext,\n            };\n\n            Gorgon.runLinter(parsedMarkdown, context, true);\n\n            // Apply the lint errors from the last NotGorgon run.\n            // TODO(joshuan): Support overlapping dots.\n            this.state.notGorgon.applyLintErrors(parsedMarkdown,\n                [...this.state.notGorgonLintErrors,\n                    ...(this.props.legacyPerseusLint || [])]);\n        }\n\n        // Render the linted markdown parse tree with React components\n        var markdownContents = this.outputMarkdown(parsedMarkdown, {\n            baseElements: apiOptions.baseElements,\n        });\n\n        const className = classNames({\n            [ApiClassNames.RENDERER]: true,\n            [ApiClassNames.RESPONSIVE_RENDERER]: true,\n            [ApiClassNames.TWO_COLUMN_RENDERER]: this._isTwoColumn,\n        });\n\n        this.lastRenderedMarkdown = (\n            <div className={className}>\n                {markdownContents}\n            </div>\n        );\n        return this.lastRenderedMarkdown;\n    },\n});\n\n_module_.exports = Renderer;\nexport default _module_.exports;\n","import {\n    pureXsMax,\n    pureSmMin,\n    pureSmMax,\n    pureMdMin,\n    pureMdMax,\n    pureLgMin,\n    pureLgMax,\n    pureXlMin,\n} from \"./constants.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n_module_.exports = {\n    xs: `@media screen and (max-width: ${pureXsMax})`,\n    sm: `@media screen and (min-width: ${pureSmMin}) and ` +\n        `(max-width: ${pureSmMax})`,\n    md: `@media screen and (min-width: ${pureMdMin}) and ` +\n        `(max-width: ${pureMdMax})`,\n    lg: `@media screen and (min-width: ${pureLgMin}) and ` +\n        `(max-width: ${pureLgMax})`,\n    xl: `@media screen and (min-width: ${pureXlMin})`,\n\n    smOrSmaller: `@media screen and (max-width: ${pureSmMax})`,\n    mdOrSmaller: `@media screen and (max-width: ${pureMdMax})`,\n    lgOrSmaller: `@media screen and (max-width: ${pureLgMax})`,\n\n    smOrLarger: `@media screen and (min-width: ${pureSmMin})`,\n    mdOrLarger: `@media screen and (min-width: ${pureMdMin})`,\n    lgOrLarger: `@media screen and (min-width: ${pureLgMin})`,\n};\nexport default _module_.exports;\n","import {\n    zIndexAboveScratchpad,\n    zIndexInteractiveComponent,\n    radioBorderColor,\n    checkedColor,\n    circleSize,\n    radioMarginWidth,\n} from \"./constants.js\";\n\nimport _mediaQueriesJs from \"./media-queries.js\";\nimport { StyleSheet } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst mediaQueries = _mediaQueriesJs;\n\n_module_.exports = StyleSheet.create({\n    perseusInteractive: {\n        zIndex: zIndexInteractiveComponent,\n        position: \"relative\",\n    },\n\n    aboveScratchpad: {\n        position: \"relative\",\n        zIndex: zIndexAboveScratchpad,\n    },\n\n    blankBackground: {\n        // TODO(emily): Use KhanUtil._BACKGROUND?\n        backgroundColor: \"#FDFDFD\",\n    },\n\n    perseusSrOnly: {\n        border: 0,\n        clip: \"rect(0,0,0,0)\",\n        height: 1,\n        margin: -1,\n        overflow: \"hidden\",\n        padding: 0,\n        position: \"absolute\",\n        width: 1,\n    },\n\n    responsiveLabel: {\n        // NOTE(charlie): The values used here should be kept in sync with the\n        // caption text sizing in articles.less.\n        // TODO(charlie): Migrate the captions over to using this style.\n        [mediaQueries.smOrSmaller]: {\n            fontSize: 14,\n            lineHeight: 1.3,\n        },\n        [mediaQueries.md]: {\n            fontSize: 17,\n            lineHeight: 1.4,\n        },\n        [mediaQueries.lgOrLarger]: {\n            fontSize: 20,\n            lineHeight: 1.4,\n        },\n    },\n\n    responsiveInput: {\n        display: \"inline-block\",\n        WebkitAppearance: \"none\",\n        appearance: \"none\",\n\n        \"::-ms-check\": {\n            display: \"none\",\n        },\n\n        backgroundColor: \"#fff\",\n        border: \"2px solid #fff\",\n        boxShadow: `0 0px 0px 1px ${radioBorderColor}`,\n        outline: \"none\",\n\n        boxSizing: \"border-box\",\n        flexShrink: 0,\n        marginBottom: 1,\n        marginLeft: 1,\n        marginRight: 1,\n        marginTop: 1,\n\n        height: circleSize - 2,\n        width: circleSize - 2,\n    },\n\n    responsiveRadioInput: {\n        borderRadius: \"50%\",\n\n        \":checked\": {\n            backgroundColor: checkedColor,\n            border: \"none\",\n            borderRadius: \"50%\",\n            boxShadow: `inset 0px 0px 0px 2px white, ` +\n                `0 0px 0px 2px ${checkedColor}`,\n\n            marginTop: radioMarginWidth,\n            marginBottom: radioMarginWidth,\n            marginLeft: radioMarginWidth,\n            marginRight: radioMarginWidth,\n\n            height: circleSize - 2 * radioMarginWidth,\n            width: circleSize - 2 * radioMarginWidth,\n        },\n    },\n\n    responsiveRadioInputActive: {\n        backgroundColor: \"#fff\",\n        border: \"2px solid #fff\",\n        borderRadius: \"50%\",\n        boxShadow: `0 0px 0px 2px ${checkedColor}`,\n\n        marginTop: radioMarginWidth,\n        marginBottom: radioMarginWidth,\n        marginLeft: radioMarginWidth,\n        marginRight: radioMarginWidth,\n\n        height: circleSize - 2 * radioMarginWidth,\n        width: circleSize - 2 * radioMarginWidth,\n\n        \":checked\": {\n            backgroundColor: \"#fff\",\n        },\n    },\n\n    disableTextSelection: {\n        userSelect: 'none',\n    },\n});\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport { baseUnitPx, hintBorderWidth, kaGreen, gray97 } from \"./styles/constants.js\";\nimport _stylesMediaQueriesJs from \"./styles/media-queries.js\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _rendererJsx from \"./renderer.jsx\";\nimport _classnames from \"classnames\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst classnames = _classnames;\nconst i18n = window.i18n;\n\nconst Renderer = _rendererJsx;\n\nconst ApiOptions = _perseusApiJsx.Options;\n\nconst mediaQueries = _stylesMediaQueriesJs;\n\nconst Gorgon = _gorgonGorgonJs;\n\n/* Renders just a hint preview */\nconst HintRenderer = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        className: PropTypes.string,\n        hint: PropTypes.any,\n        lastHint: PropTypes.bool,\n        lastRendered: PropTypes.bool,\n        pos: PropTypes.number,\n        totalHints: PropTypes.number,\n        findExternalWidgets: PropTypes.func,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps() {\n        return {\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getSerializedState: function() {\n        return this.refs.renderer.getSerializedState();\n    },\n\n    restoreSerializedState: function(state, callback) {\n        this.refs.renderer.restoreSerializedState(state, callback);\n    },\n\n    render: function() {\n        const {\n            apiOptions,\n            className,\n            hint,\n            lastHint,\n            lastRendered,\n            pos,\n            totalHints,\n        } = this.props;\n\n        const {isMobile} = apiOptions;\n\n        const classNames = classnames(\n            !isMobile && \"perseus-hint-renderer\",\n            isMobile && css(styles.newHint),\n            isMobile && lastRendered && css(styles.lastRenderedNewHint),\n            lastHint && \"last-hint\",\n            lastRendered && \"last-rendered\",\n            className\n        );\n\n        // TODO(charlie): Allowing `staticRender` here would require that we\n        // extend `HintsRenderer` and `HintRenderer` to implement the full\n        // \"input' API, so that clients could access the static inputs. Allowing\n        // `customKeypad` would require that we extend `ItemRenderer` to support\n        // nested inputs in the `HintsRenderer`. For now, we disable these\n        // options. Instead, clients will get standard <input/> elements, which\n        // aren't nice to use on mobile, but are at least usable.\n        const rendererApiOptions = {\n            ...apiOptions,\n            customKeypad: false,\n            staticRender: false,\n        };\n\n        return (\n            <div className={classNames} tabIndex=\"-1\">\n                {!apiOptions.isMobile &&\n                    <span className=\"perseus-sr-only\">\n                        {i18n._(\"Hint #%(pos)s\", {pos: pos + 1})}\n                    </span>}\n                {!apiOptions.isMobile &&\n                    !apiOptions.satStyling &&\n                    totalHints &&\n                    pos != null &&\n                    <span\n                        className=\"perseus-hint-label\"\n                        style={{\n                            display: \"block\",\n                            color: apiOptions.hintProgressColor,\n                        }}\n                    >\n                        {`${pos + 1} / ${totalHints}`}\n                    </span>}\n                <Renderer\n                    ref=\"renderer\"\n                    widgets={hint.widgets}\n                    content={hint.content || \"\"}\n                    images={hint.images}\n                    apiOptions={rendererApiOptions}\n                    findExternalWidgets={this.props.findExternalWidgets}\n                    linterContext={Gorgon.pushContextStack(\n                        this.props.linterContext,\n                        \"hint\"\n                    )}\n                />\n            </div>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    newHint: {\n        marginBottom: 1.5 * baseUnitPx,\n\n        borderLeftColor: gray97,\n        borderLeftStyle: \"solid\",\n        borderLeftWidth: hintBorderWidth,\n\n        // Only apply left-padding on tablets, to avoid being flush with the\n        // border. On phones, padding is applied internally by the child\n        // renderers. Some content on phones that is rendered at full-bleed may\n        // end up flush with the border, but that's acceptable for now.\n        [mediaQueries.lgOrSmaller]: {\n            paddingLeft: baseUnitPx,\n        },\n        [mediaQueries.smOrSmaller]: {\n            paddingLeft: 0,\n        },\n\n        \":focus\": {\n            outline: \"none\",\n        },\n    },\n\n    lastRenderedNewHint: {\n        marginBottom: 0,\n        borderLeftColor: kaGreen,\n    },\n});\n\n_module_.exports = HintRenderer;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport { baseUnitPx, hintBorderWidth, kaGreen, gray85, gray17 } from \"./styles/constants.js\";\nimport _stylesSharedJs from \"./styles/shared.js\";\nimport _stylesMediaQueriesJs from \"./styles/media-queries.js\";\nimport _mixinsApiOptionsPropsJs from \"./mixins/api-options-props.js\";\nimport _componentsSvgImageJsx from \"./components/svg-image.jsx\";\nimport _hintRendererJsx from \"./hint-renderer.jsx\";\nimport _underscore from \"underscore\";\nimport _classnames from \"classnames\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst classnames = _classnames;\nconst _ = _underscore;\nconst i18n = window.i18n;\n\nconst HintRenderer = _hintRendererJsx;\nconst SvgImage = _componentsSvgImageJsx;\nconst ApiOptionsProps = _mixinsApiOptionsPropsJs;\n\nconst mediaQueries = _stylesMediaQueriesJs;\nconst sharedStyles = _stylesSharedJs;\n\nconst Gorgon = _gorgonGorgonJs;\n\nconst HintsRenderer = createReactClass({\n    propTypes: {\n        ...ApiOptionsProps.propTypes,\n        className: PropTypes.string,\n        hints: PropTypes.arrayOf(PropTypes.any),\n        hintsVisible: PropTypes.number,\n        findExternalWidgets: PropTypes.func,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            linterContext: linterContextDefault,\n        };\n    },\n\n    componentDidMount: function() {\n        this._cacheHintImages();\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        if (\n            !_.isEqual(prevProps.hints, this.props.hints) ||\n            prevProps.hintsVisible !== this.props.hintsVisible\n        ) {\n            this._cacheHintImages();\n        }\n\n        // When a new hint is displayed we immediately focus it\n        if (prevProps.hintsVisible < this.props.hintsVisible) {\n            const pos = this.props.hintsVisible - 1;\n            ReactDOM.findDOMNode(this.refs[\"hintRenderer\" + pos]).focus();\n        }\n    },\n\n    _hintsVisible: function() {\n        if (this.props.hintsVisible == null || this.props.hintsVisible === -1) {\n            return this.props.hints.length;\n        } else {\n            return this.props.hintsVisible;\n        }\n    },\n\n    _cacheImagesInHint: function(hint) {\n        _.each(hint.images, (data, src) => {\n            const image = new Image();\n            image.src = SvgImage.getRealImageUrl(src);\n        });\n    },\n\n    _cacheHintImages: function() {\n        // Only cache images in the first hint at the start. When hints are\n        // taken, cache images in the rest of the hints\n        if (this._hintsVisible() > 0) {\n            _.each(this.props.hints, this._cacheImagesInHint);\n        } else if (this.props.hints.length > 0) {\n            this._cacheImagesInHint(this.props.hints[0]);\n        }\n    },\n\n    getApiOptions() {\n        return ApiOptionsProps.getApiOptions.call(this);\n    },\n\n    getSerializedState: function() {\n        return _.times(this._hintsVisible(), i => {\n            return this.refs[\"hintRenderer\" + i].getSerializedState();\n        });\n    },\n\n    restoreSerializedState: function(state, callback) {\n        // We need to wait until all the renderers are finished restoring their\n        // state before we fire our callback.\n        let numCallbacks = 1;\n        const fireCallback = () => {\n            --numCallbacks;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        _.each(state, (hintState, i) => {\n            const hintRenderer = this.refs[\"hintRenderer\" + i];\n            // This is not ideal in that it doesn't restore state\n            // if the hint isn't visible, but we can't exactly restore\n            // the state to an unmounted renderer, so...\n            // If you want to restore state to hints, make sure to\n            // have the appropriate number of hints visible already.\n            if (hintRenderer) {\n                ++numCallbacks;\n                hintRenderer.restoreSerializedState(hintState, fireCallback);\n            }\n        });\n\n        // This makes sure that the callback is fired if there aren't any\n        // mounted renderers.\n        fireCallback();\n    },\n\n    render: function() {\n        const apiOptions = this.getApiOptions();\n        const hintsVisible = this._hintsVisible();\n        const hints = [];\n        this.props.hints.slice(0, hintsVisible).forEach((hint, i) => {\n            const lastHint =\n                i === this.props.hints.length - 1 && !/\\*\\*/.test(hint.content);\n            const lastRendered = i === hintsVisible - 1;\n\n            const renderer = (\n                <HintRenderer\n                    lastHint={lastHint}\n                    lastRendered={lastRendered}\n                    hint={hint}\n                    pos={i}\n                    totalHints={this.props.hints.length}\n                    ref={\"hintRenderer\" + i}\n                    key={\"hintRenderer\" + i}\n                    apiOptions={apiOptions}\n                    findExternalWidgets={this.props.findExternalWidgets}\n                    linterContext={Gorgon.pushContextStack(\n                        this.props.linterContext,\n                        \"hints[\" + i + \"]\"\n                    )}\n                />\n            );\n\n            if (hint.replace && hints.length > 0) {\n                hints[hints.length - 1] = renderer;\n            } else {\n                hints.push(renderer);\n            }\n        });\n\n        const showGetAnotherHint =\n            apiOptions.getAnotherHint &&\n            hintsVisible > 0 &&\n            hintsVisible < this.props.hints.length;\n        const hintRatioCopy = `(${hintsVisible}/${this.props.hints.length})`;\n\n        const classNames = classnames(\n            this.props.className,\n            apiOptions.isMobile &&\n                hintsVisible > 0 &&\n                css(styles.mobileHintStylesHintsRenderer)\n        );\n\n        return (\n            <div className={classNames}>\n                {apiOptions.isMobile &&\n                    hintsVisible > 0 &&\n                    <div\n                        className={css(\n                            styles.mobileHintStylesHintTitle,\n                            sharedStyles.responsiveLabel\n                        )}\n                    >\n                        {i18n._(\"Hints\")}\n                    </div>}\n                {hints}\n                {showGetAnotherHint &&\n                    <button\n                        rel=\"button\"\n                        className={css(\n                            styles.linkButton,\n                            styles.getAnotherHintButton,\n                            apiOptions.isMobile &&\n                                styles.mobileHintStylesGetAnotherHintButton\n                        )}\n                        onClick={evt => {\n                            evt.preventDefault();\n                            evt.stopPropagation();\n                            apiOptions.getAnotherHint();\n                        }}\n                    >\n                        <span\n                            className={css(\n                                styles.plusText,\n                                apiOptions.isMobile &&\n                                    styles.mobileHintStylesPlusText\n                            )}\n                        >\n                            +\n                        </span>\n                        <span className={css(styles.getAnotherHintText)}>\n                            {i18n._(\"Get another hint\")} {hintRatioCopy}\n                        </span>\n                    </button>}\n            </div>\n        );\n    },\n});\n\nconst hintIndentation = baseUnitPx + hintBorderWidth;\n\nconst styles = StyleSheet.create({\n    rendererMargins: {\n        marginTop: baseUnitPx,\n    },\n\n    linkButton: {\n        cursor: \"pointer\",\n        border: \"none\",\n        backgroundColor: \"transparent\",\n        fontSize: \"100%\",\n        fontFamily: \"inherit\",\n        fontWeight: \"bold\",\n        color: kaGreen,\n        padding: 0,\n        position: \"relative\",\n    },\n\n    plusText: {\n        fontSize: 20,\n        position: \"absolute\",\n        top: -3,\n        left: 0,\n    },\n    getAnotherHintText: {\n        marginLeft: 16,\n    },\n\n    mobileHintStylesHintsRenderer: {\n        marginTop: 4 * baseUnitPx,\n        border: `solid ${gray85}`,\n        borderWidth: \"1px 0 0 0\",\n\n        position: \"relative\",\n        \":before\": {\n            content: '\"\"',\n            display: \"table\",\n            clear: \"both\",\n        },\n        \":after\": {\n            content: '\"\"',\n            display: \"table\",\n            clear: \"both\",\n        },\n    },\n\n    mobileHintStylesHintTitle: {\n        fontFamily: \"inherit\",\n        fontStyle: \"normal\",\n        fontWeight: \"bold\",\n        color: gray17,\n\n        paddingTop: baseUnitPx,\n        paddingBottom: 1.5 * baseUnitPx,\n\n        [mediaQueries.lgOrSmaller]: {\n            paddingLeft: 0,\n        },\n        [mediaQueries.smOrSmaller]: {\n            // On phones, ensure that the button is aligned with the hint body\n            // content, which is inset at the standard `baseUnitPx`, plus an\n            // additional `hintBorderWidth`.\n            paddingLeft: hintIndentation,\n        },\n    },\n\n    getAnotherHintButton: {\n        marginTop: 1.5 * baseUnitPx,\n    },\n\n    mobileHintStylesGetAnotherHintButton: {\n        [mediaQueries.lgOrSmaller]: {\n            paddingLeft: 0,\n        },\n        [mediaQueries.smOrSmaller]: {\n            // As with the title, on phones, ensure that the button is aligned\n            // with the hint body content.\n            paddingLeft: hintIndentation,\n        },\n    },\n\n    mobileHintStylesPlusText: {\n        [mediaQueries.lgOrSmaller]: {\n            left: 0,\n        },\n        [mediaQueries.smOrSmaller]: {\n            left: hintIndentation,\n        },\n    },\n});\n\n_module_.exports = HintsRenderer;\nexport default _module_.exports;\n","import _shapesJs from \"./shapes.js\";\nimport { buildMapper } from \"./trees.js\";\n\nconst shapes = _shapesJs;\n\n/**\n * Return a semantically empty ItemTree that conforms to the given shape.\n *\n * - An empty content node has an empty content string and no widgets/images.\n * - An empty hint node has an empty content string and no widgets/images.\n * - An empty array node has no elements.\n * - An empty object node has a semantically empty node for each of its keys.\n *   (That is, we recursively call buildEmptyItemTreeForShape for each key.)\n */\nfunction buildEmptyItemTreeForShape(shape) {\n    if (shape.type === \"content\") {\n        return {\n            \"__type\": \"content\",\n            \"content\": \"\",\n            \"images\": {},\n            \"widgets\": {},\n        };\n    } else if (shape.type === \"hint\") {\n        return {\n            \"__type\": \"hint\",\n            \"replace\": false,\n            \"content\": \"\",\n            \"images\": {},\n            \"widgets\": {},\n        };\n    } else if (shape.type === \"tags\") {\n        return [];\n    } else if (shape.type === \"array\") {\n        return [];\n    } else if (shape.type === \"object\") {\n        const valueShapes = shape.shape;\n        const object = {};\n        Object.keys(valueShapes).forEach(key => {\n            object[key] = buildEmptyItemTreeForShape(valueShapes[key]);\n        });\n        return object;\n    } else {\n        throw new Error(`unexpected shape type ${shape.type}`);\n    }\n}\n\n/**\n * Return a semantically empty Item that conforms to the given shape.\n *\n * - An empty content node has an empty content string and no widgets/images.\n * - An empty hint node has an empty content string and no widgets/images.\n * - An empty array node has no elements.\n * - An empty object node has a semantically empty node for each of its keys.\n *   (That is, we recursively call buildEmptyItemTreeForShape for each key.)\n */\nfunction buildEmptyItemForShape(shape) {\n    return treeToItem(buildEmptyItemTreeForShape(shape));\n}\n\n/**\n * Given an Item and its Shape, yield all of its content nodes to the callback.\n */\nfunction findContentNodesInItem(item, shape, callback) {\n    const itemTree = itemToTree(item);\n    buildMapper()\n        .setContentMapper(callback)\n        .mapTree(itemTree, shape);\n}\n\n/**\n * Given an Item and its Shape, yield all of its hint nodes to the callback.\n */\nfunction findHintNodesInItem(item, shape, callback) {\n    const itemTree = itemToTree(item);\n    buildMapper()\n        .setHintMapper(callback)\n        .mapTree(itemTree, shape);\n}\n\n/**\n * Given an ItemTree, return a Shape that it conforms to.\n *\n * The Shape might not be complete or correct Shape that this Item was designed\n * for. If you have access to the intended Shape, use that instead.\n */\nfunction inferItemShape(item) {\n    const itemTree = itemToTree(item);\n    return inferItemTreeShape(itemTree);\n}\n\nfunction inferItemTreeShape(node) {\n    if (Array.isArray(node)) {\n        if (node.length) {\n            if (typeof node[0] === \"string\") {\n                // There's no ItemTree that can manifest as a string.\n                // So, an array of strings must be a TagsNode, not ArrayNode.\n                return shapes.tags;\n            } else {\n                // Otherwise, assume that this is a valid ArrayNode, and\n                // therefore the shape of the first element applies to all\n                // elements in the array.\n                return shapes.arrayOf(inferItemTreeShape(node[0]));\n            }\n        } else {\n            // The array is empty, so we arbitrarily guess that it's a content\n            // array. As discussed in the docstring, this might be incorrect,\n            // and you shouldn't depend on it.\n            return shapes.arrayOf(shapes.content);\n        }\n    } else if (\n        // TODO(mdr): Remove #LegacyContentNode support.\n        typeof node === \"object\" &&\n        (node.__type === \"content\" || node.__type === \"item\")\n    ) {\n        return shapes.content;\n    } else if (typeof node === \"object\" && node.__type === \"hint\") {\n        return shapes.hint;\n    } else if (typeof node === \"object\") {\n        const valueShapes = {};\n        Object.keys(node).forEach(key => {\n            // $FlowFixMe: Not sure why this property deref is an error.\n            valueShapes[key] = inferItemTreeShape(node[key]);\n        });\n        return shapes.shape(valueShapes);\n    } else {\n        throw new Error(`unexpected multi-item node ${JSON.stringify(node)}`);\n    }\n}\n\n/**\n * Convert the given ItemTree to an Item, by wrapping it in the `_multi` key.\n */\nfunction itemToTree(item) {\n    return item._multi;\n}\n\n/**\n * Convert the given Item to an ItemTree, by unwrapping the `_multi` key.\n */\nfunction treeToItem(node) {\n    return {_multi: node};\n}\n\nexport {\n    buildEmptyItemTreeForShape,\n    buildEmptyItemForShape,\n    findContentNodesInItem,\n    findHintNodesInItem,\n    inferItemShape,\n    itemToTree,\n    treeToItem,\n};\nexport default {\n    buildEmptyItemTreeForShape,\n    buildEmptyItemForShape,\n    findContentNodesInItem,\n    findHintNodesInItem,\n    inferItemShape,\n    itemToTree,\n    treeToItem,\n};\n","var isObject = function(obj) {\n    return obj === Object(obj);;\n}\n\nvar merge = function() {\n    var obj = {};\n\n    for (var i = 0; i < arguments.length; i++) {\n        var source = arguments[i];\n        if (source) {\n            for (var prop in source) {\n                obj[prop] = source[prop];\n            }\n        }\n    }\n\n    return obj;\n};\n\nvar clone = function(obj) {\n    if (!isObject(obj)) {\n        return obj;\n    }\n\n    return Array.isArray(obj) ? obj.slice() : merge(obj);\n};\n\nexport { isObject, merge, clone };\nexport default { isObject, merge, clone };\n","var get = function(arr, monocle) {\n    return arr[monocle];\n};\n\nvar set = function(arr, monocle, val) {\n    var newArr = arr.splice();\n    newArr[monocle] = val;\n    return newArr;\n};\n\nvar mod = function(arr, monocle, f) {\n    var newArr = arr.slice();\n    newArr[monocle] = f(arr[monocle]);\n    return newArr;\n};\n\nvar del = function(arr, monocle) {\n    var newArr = arr.slice();\n    newArr.splice(monocle, 1);\n    return newArr;\n};\n\n/*\n// Lens must point to a member of an array. We'll insert into that array.\nlens.prototype.insertAt = function(lensArr, toInsert) {\n    var obj = this._wrapped;\n\n    var arrLens = lensArr.slice(0, -1);\n    var arr = lens(obj).get(arrLens).slice(); // slice to copy\n\n    var arrIdx = lensArr[lensArr.length-1];\n    arr.splice(arrIdx, 0, toInsert);\n    return lens(obj).set(arrLens, arr);\n};\n\nlens.prototype.insertBefore = lens.prototype.insertAt;\nlens.prototype.insertAfter = function(lensArr, toInsert) {\n    var newLens = lensArr.slice();\n    newLens[newLens.length-1] += 1;\n    return lens(this._wrapped).insertAt(newLens, toInsert);\n};\n*/\n\nexport default { get: get, set: set, mod: mod, del: del };\n","import { clone } from \"./util.js\";\n\nvar get = function(obj, monocle) {\n    return obj[monocle];\n};\n\nvar set = function(obj, monocle, val) {\n    var newObj = clone(obj);\n    newObj[monocle] = val;\n    return newObj;\n};\n\nvar mod = function(obj, monocle, f) {\n    var newObj = clone(obj);\n    newObj[monocle] = f(obj[monocle]);\n    return newObj;\n};\n\nvar del = function(obj, monocle) {\n    var newObj = clone(obj);\n    delete newObj[monocle];\n    return newObj;\n};\n\nexport default { get: get, set: set, mod: mod, del: del };\n","var get = function(arr, monocle) {\n    return arr[monocle];\n};\n\nvar set = function(arr, monocle, val) {\n    var newArr = arr.splice();\n    newArr[monocle] = val;\n    return newArr;\n};\n\nvar mod = function(arr, monocle, f) {\n    var newArr = arr.splice();\n    newArr[monocle] = f(arr[monocle]);\n    return newArr;\n};\n\nvar del = function(arr, monocle) {\n    var newArr = arr.slice();\n    newArr.splice(monocle);\n    return newArr;\n};\n\nexport default { get: get, set: set, mod: mod, del: del };\n","/* TODO batch *all* mutations\n * idea: freeze / thaw implementations for all types\n * lens constructor thaws, freeze delegates to type's freeze\n */\n\nimport { clone, isObject, merge } from './util.js'\n\nimport arr from './arr.js';\nimport obj from './obj.js';\nimport str from './str.js';\n\n// equivalents, without requiring it\n// find the implementation to use for a given object\nvar dispatch = function(x) {\n    if (Array.isArray(x)) {\n        return arr;\n    } else if (isObject(x)) {\n        return obj;\n    } else if (typeof x === \"string\") {\n        return str;\n    }\n};\n\n// This is underscore with a different name\nvar lens = function(obj) {\n    if (obj instanceof lens) {\n        return obj;\n    }\n\n    if (!(this instanceof lens)) {\n        return new lens(obj);\n    }\n\n    var ops = dispatch(obj);\n    this._wrapped = ops.thaw ? ops.thaw(obj) : obj;\n};\n\nlens.prototype.freeze = function() {\n    var obj = this._wrapped;\n    var ops = dispatch(obj);\n\n    return ops.freeze ? ops.freeze(obj) : obj;\n};\n\nlens.prototype.zoom = function(lensArr) {\n    if (this._zoomStack === undefined) {\n        this._zoomStack = [];\n    }\n\n    this._zoomStack.push({\n        zoom: lensArr,\n        wrapped: this._wrapped\n    });\n    this._wrapped = lens(this._wrapped).get(lensArr);\n\n    return this;\n};\n\nlens.prototype.deZoom = function() {\n    var frame = this._zoomStack.pop();\n    this._wrapped = lens(frame.wrapped)\n        .set(frame.zoom, this._wrapped)\n        .freeze();\n\n    return this;\n};\n\nlens.prototype.get = function(lensArr) {\n    var obj = this._wrapped;\n\n    for (var i = 0; i < lensArr.length; i++) {\n        obj = dispatch(obj).get(obj, lensArr[i]);\n    }\n\n    return obj;\n};\n\nlens.prototype.mod = function(lensArr, f) {\n    var obj = this._wrapped;\n    var newObj = clone(obj);\n    var ops = dispatch(obj);\n\n    if (lensArr.length === 0) {\n        this._wrapped = f(this._wrapped);\n    } else if (lensArr.length === 1) {\n        this._wrapped = ops.mod(newObj, lensArr[0], f);\n    } else {\n        var monocle = lensArr[0];\n        var shortLens = lensArr.slice(1);\n\n        // newObj = ops.mod(obj[monocle], shortLens, f);\n\n        newObj[monocle] = lens(obj[monocle])\n            .mod(shortLens, f)\n            .freeze();\n        this._wrapped = newObj;\n    }\n\n    return this;\n};\n\n// TODO - move to individual files\nlens.prototype.merge = function(lensArr, props) {\n    this._wrapped = lens(this._wrapped).mod(lensArr, function(oldProps) {\n        return merge(oldProps, props);\n    }).freeze();\n\n    return this;\n};\n\n// Lens must have length >= 1 or there would be nothing to return\nlens.prototype.del = function(lensArr) {\n    var obj = this._wrapped;\n    var ops = dispatch(obj);\n\n    if (lensArr.length === 1) {\n        this._wrapped = ops.del(obj, lensArr[0]);\n    } else {\n        var monocle = lensArr[0];\n        var shortLens = lensArr.slice(1);\n        var newObj = clone(obj);\n\n        newObj[monocle] = lens(obj[monocle])\n            .del(shortLens)\n            .freeze();\n\n        this._wrapped = newObj;\n    }\n\n    return this;\n};\n\nlens.prototype.set = function(lensArr, set) {\n    return this.mod(lensArr, function() { return set; });\n};\n\nexport default lens;\n","import _utilJs from \"../util.js\";\nimport { buildMapper } from \"./trees.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _hintsRendererJsx from \"../hints-renderer.jsx\";\nimport { itemToTree } from \"./items.js\";\nimport _react from \"react\";\nimport _hubbleIndexJs from \"../hubble/index.js\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst lens = _hubbleIndexJs;\nconst React = _react;\n\nconst HintsRenderer = _hintsRendererJsx;\nconst Renderer = _rendererJsx;\nconst Util = _utilJs;\n\n\n\nclass MultiRenderer extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.rendererDataTreeMapper = buildMapper()\n            .setContentMapper((c, _, p) => this._makeContentRendererData(c, p))\n            .setHintMapper(h => this._makeHintRendererData(h))\n            .setTagsMapper(t => null);\n\n        this.getRenderersMapper = buildMapper()\n            .setContentMapper(c => c.makeRenderer())\n            .setHintMapper(h => h.makeRenderer())\n            .setArrayMapper(this._annotateRendererArray.bind(this));\n\n        // Keep state in sync with props.\n        this.state = this._tryMakeRendererState(this.props);\n    }\n    /* eslint-enable react/sort-comp */\n\n    componentWillReceiveProps(nextProps) {\n        // Keep state in sync with props.\n        if (nextProps.item !== this.props.item) {\n            this.setState(this._tryMakeRendererState(nextProps));\n        }\n    }\n\n    /**\n     * Attempt to build a State that includes a renderer tree corresponding to\n     * the item provided in props. On error, return a state with `renderError`\n     * set instead.\n     */\n    _tryMakeRendererState(props) {\n        try {\n            return {\n                rendererDataTree: this._makeRendererDataTree(\n                    props.item, props.shape),\n                renderError: null,\n            };\n        } catch (e) {\n            // NOTE(mdr): It's appropriate to log an error traceback in a\n            //     caught error condition, and console.error is supported in\n            //     all target browsers. Just do it, linter.\n            // eslint-disable-next-line no-console\n            console.error(e);\n            return {\n                rendererDataTree: null,\n                renderError: e,\n            };\n        }\n    }\n\n    _handleSerializedStateUpdated = (path, newState) => {\n        const {onSerializedStateUpdated} = this.props;\n\n        if (onSerializedStateUpdated) {\n            const oldState = this._getSerializedState(\n                this.props.serializedState);\n            onSerializedStateUpdated(\n                lens(oldState).set(path, newState).freeze());\n        }\n    }\n\n    /**\n     * Props that aren't directly used by the MultiRenderer are delegated to\n     * the underlying Renderers.\n     */\n    _getRendererProps() {\n        /* eslint-disable no-unused-vars */\n        // eslint is complaining that `item` and `children` are unused. I'm\n        // explicitly pulling them out of `this.props` so I don't pass them to\n        // `<Renderer>`. I'm not sure how else to do this.\n        const {\n            item,\n            children,\n            shape,\n            ...otherProps\n        } = this.props;\n        /* eslint-enable no-unused-vars */\n\n        return otherProps;\n    }\n\n    /**\n     * Construct a Renderer and a ref placeholder for the given ContentNode.\n     */\n    _makeContentRendererData(content, path) {\n        // NOTE(emily): The `findExternalWidgets` function here is computed\n        //     inline and thus changes each time we run this function. If it\n        //     were to change every render, it would cause the Renderer to\n        //     re-render a lot more than is necessary. Don't re-compute this\n        //     element unless it is necessary!\n        // HACK(mdr): Flow can't prove that this is a ContentRendererData,\n        //     because of how we awkwardly construct it in order to obtain a\n        //     circular reference. But it is, I promise.\n        const data = {ref: null, makeRenderer: null};\n\n        const refFunc = e => data.ref = e;\n        const findExternalWidgets =\n            criterion => this._findWidgets(data, criterion);\n        const handleSerializedState = state => this._handleSerializedStateUpdated(path, state);\n\n        data.makeRenderer = () => <Renderer\n            {...this._getRendererProps()}\n            {...content}\n            ref={refFunc}\n            findExternalWidgets={findExternalWidgets}\n            serializedState={this.props.serializedState\n                ? lens(this.props.serializedState).get(path)\n                : null}\n            onSerializedStateUpdated={handleSerializedState}\n        />;\n        return data;\n    }\n\n    /**\n     * Construct a Renderer for the given HintNode, and keep track of the hint\n     * itself for future use, too.\n     */\n    _makeHintRendererData(hint) {\n        // TODO(mdr): Once HintsRenderer supports inter-widget communication,\n        //     give it a ref. Until then, leave the ref null forever, to avoid\n        //     confusing the findWidgets functions.\n        //\n        // NOTE(davidflanagan): As a partial step toward inter-widget\n        // communication we're going to pass a findExternalWidgets function\n        // (using a dummy data object). This allows passage-ref widgets in\n        // hints to use findWidget() to find the passage widgets they reference.\n        // Note that this is one-way only, however. It does not allow\n        // widgets in the question to find widgets in the hints, for example.\n        const findExternalWidgets =\n              criterion => this._findWidgets({}, criterion);\n\n        return {\n            hint,\n            findExternalWidgets, // _annotateRendererArray() needs this\n            ref: null,\n            makeRenderer: () => <HintsRenderer\n                {...this._getRendererProps()}\n                findExternalWidgets={findExternalWidgets}\n                hints={[hint]}\n            />,\n        };\n    }\n\n    /**\n     * Construct a tree of interconnected RendererDatas, corresponding to the\n     * given item. Called in `_tryMakeRendererState`, in order to store this\n     * tree in the component state.\n     */\n    _makeRendererDataTree(item, shape) {\n        const itemTree = itemToTree(item);\n        return this.rendererDataTreeMapper.mapTree(itemTree, shape);\n    }\n\n    /**\n     * Return all widgets that meet the given criterion, from all Renderers\n     * except the Renderer that triggered this call.\n     *\n     * This function is provided to each Renderer's `findExternalWidgets` prop,\n     * which enables widgets in different Renderers to discover each other and\n     * communicate.\n     */\n    _findWidgets(callingData, filterCriterion) {\n        const results = [];\n\n        this._mapRenderers(data => {\n            if (callingData !== data && data.ref) {\n                results.push(...data.ref.findInternalWidgets(filterCriterion));\n            }\n        });\n\n        return results;\n    }\n\n    /**\n     * Copy the renderer tree, apply the given transformation to the leaf nodes\n     * and the optional given transformation to the array nodes, and return the\n     * result.\n     *\n     * Used to provide structured data to the call site (the Renderer tree on\n     * `render`, the Score tree on `getScores`, etc.), and to traverse the\n     * renderer tree even when we disregard the output (like in\n     * `_findWidgets`).\n     */\n    _mapRenderers(leafMapper) {\n        const {rendererDataTree} = this.state;\n\n        if (!rendererDataTree) {\n            return null;\n        }\n\n        const mapper = buildMapper()\n            .setContentMapper(leafMapper)\n            .setHintMapper(leafMapper);\n        return mapper.mapTree(rendererDataTree, this.props.shape);\n    }\n\n    _scoreFromRef(ref) {\n        if (!ref) {\n            return null;\n        }\n\n        const [guess, score] = ref.guessAndScore();\n        let state;\n        if (ref.getSerializedState) {\n            state = ref.getSerializedState();\n        }\n        return Util.keScoreFromPerseusScore(score, guess, state);\n    }\n\n    /**\n     * Return a tree in the shape of the multi-item, with scores at each of\n     * the content nodes and `null` at the other leaf nodes.\n     */\n    getScores() {\n        return this._mapRenderers(data => this._scoreFromRef(data.ref));\n    }\n\n    /**\n     * Return a single composite score for all rendered content nodes.\n     * The `guess` is a tree in the shape of the multi-item, with an individual\n     * guess at each content node and `null` at the other leaf nodes.\n     */\n    score() {\n        const scores = [];\n        const state = [];\n        const guess = this._mapRenderers(data => {\n            if (!data.ref) {\n                return null;\n            }\n\n            if (data.ref.getSerializedState) {\n                state.push(data.ref.getSerializedState());\n            }\n\n            scores.push(data.ref.score());\n            return data.ref.getUserInput();\n        });\n\n        const combinedScore = scores.reduce(Util.combineScores);\n\n        return Util.keScoreFromPerseusScore(combinedScore, guess, state);\n    }\n\n    /**\n     * Return a tree in the shape of the multi-item, with serialized state at\n     * each of the content nodes and `null` at the other leaf nodes.\n     *\n     * If the lastSerializedState argument is supplied, this function will fill\n     * in the state of not-currently-rendered content and hint nodes with the\n     * values from the previous serialized state. If no lastSerializedState is\n     * supplied, `null` will be returned for not-currently-rendered content and\n     * hint nodes.\n     */\n    _getSerializedState(lastSerializedState) {\n        return this._mapRenderers((data, _, path) => {\n            if (data.ref) {\n                return data.ref.getSerializedState();\n            } else if (lastSerializedState) {\n                return lens(lastSerializedState).get(path);\n            } else {\n                return null;\n            }\n        });\n    }\n\n    /**\n     * Given a tree in the shape of the multi-item, with serialized state at\n     * each of the content nodes, restore each state to the corresponding\n     * renderer if currently mounted.\n     */\n    restoreSerializedState(serializedState, callback) {\n        // We want to call our async callback only once all of the childrens'\n        // callbacks have run. We add one to this counter before we call out to\n        // each renderer and decrement it when it runs our callback.\n        let numCallbacks = 0;\n        const countCallback = () => {\n            numCallbacks--;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        this._mapRenderers((data, _, path) => {\n            if (!data.ref) {\n                return;\n            }\n\n            const state = lens(serializedState).get(path);\n            if (!state) {\n                return;\n            }\n\n            numCallbacks++;\n            data.ref.restoreSerializedState(state, countCallback);\n        });\n    }\n\n    /**\n     * Given an array of renderers, if it happens to be an array of *hint*\n     * renderers, then attach a `firstN` method to the array, which allows the\n     * layout to render the hints together in one HintsRenderer.\n     */\n    _annotateRendererArray(renderers, rendererDatas, shape) {\n        if (shape.elementShape.type === \"hint\") {\n            // The shape says that these are HintRendererDatas, even though\n            // it's not provable at compile time, so perform a cast.\n            const hintRendererDatas =\n                (rendererDatas);\n\n            renderers = [...renderers];\n            (renderers).firstN = n => <HintsRenderer\n                {...this._getRendererProps()}\n                findExternalWidgets={\n                    hintRendererDatas[0]\n                        ? hintRendererDatas[0].findExternalWidgets\n                        : undefined\n                }\n                hints={hintRendererDatas.map(d => d.hint)}\n                hintsVisible={n}\n            />;\n        }\n        return renderers;\n    }\n\n    /**\n     * Return a tree in the shape of the multi-item, with a Renderer at each\n     * content node and a HintRenderer at each hint node.\n     *\n     * This is generated by running each of the `makeRenderer` functions at the\n     * leaf nodes.\n     */\n    _getRenderers() {\n        return this.getRenderersMapper.mapTree(\n            this.state.rendererDataTree, this.props.shape);\n    }\n\n    render() {\n        if (this.state.renderError) {\n            return <div className={css(styles.error)}>\n                Error rendering: {String(this.state.renderError)}\n            </div>;\n        }\n\n        // Pass the renderer tree to the `children` function, which will\n        // determine the actual content of this component.\n        return this.props.children({\n            renderers: this._getRenderers(),\n        });\n    }\n}\n\nconst styles = StyleSheet.create({\n    error: {\n        color: \"red\",\n    },\n});\n\n_module_.exports = MultiRenderer;\nexport default _module_.exports;\n","import _multiItemsShapesJs from \"./multi-items/shapes.js\";\nimport { buildPropTypeForShape } from \"./multi-items/prop-type-builders.js\";\nimport _multiItemsMultiRendererJsx from \"./multi-items/multi-renderer.jsx\";\n\nimport {\n    buildEmptyItemForShape,\n    findContentNodesInItem,\n    findHintNodesInItem,\n    inferItemShape,\n} from \"./multi-items/items.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst MultiRenderer = _multiItemsMultiRendererJsx;\nconst shapes = _multiItemsShapesJs;\n\nexport {\n    // Tools for rendering your multi-items\n    MultiRenderer,\n\n    // Tools for declaring your multi-item shapes\n    shapes,\n    buildPropTypeForShape,\n\n    // Tools for generically manipulating multi-items\n    buildEmptyItemForShape,\n    findContentNodesInItem,\n    findHintNodesInItem,\n    inferItemShape,\n};\nexport default {\n    // Tools for rendering your multi-items\n    MultiRenderer,\n\n    // Tools for declaring your multi-item shapes\n    shapes,\n    buildPropTypeForShape,\n\n    // Tools for generically manipulating multi-items\n    buildEmptyItemForShape,\n    findContentNodesInItem,\n    findHintNodesInItem,\n    inferItemShape,\n};\n","import _mathInput from \"@khanacademy/math-input\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * A mixin that renders a custom software keypad in additional to the base\n * component. The base component will receive blur events when the keypad is\n * dismissed and can access the keypad element itself so as to manage its\n * activation and dismissal.\n *\n * TODO(charlie): This would make a nicer higher-order component, except that\n * we need to expose methods on the base component (i.e., `ItemRenderer`). When\n * `ItemRenderer` and friends are written as ES6 Classes, we can have them\n * extend a `ProvideKeypad` component instead of using this mixin.\n */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\n\nconst { Keypad } = _mathInput.components;\n\nconst ProvideKeypad = {\n    propTypes: {\n        apiOptions: PropTypes.shape({\n            customKeypad: PropTypes.bool,\n        }),\n        // An Aphrodite style object, to be applied to the keypad container.\n        // Note that, given our awkward structure of injecting the keypad, this\n        // style won't be applied or updated dynamically. Rather, it will only\n        // be applied in `componentDidMount`.\n        keypadStyle: PropTypes.any,\n    },\n\n    getInitialState() {\n        return {\n            keypadElement: null,\n        };\n    },\n\n    componentDidMount() {\n        if (this.props.apiOptions && this.props.apiOptions.customKeypad) {\n            // TODO(charlie): Render this and the wrapped component in the same\n            // React tree. We may also want to add this keypad asynchronously or\n            // on-demand in the future.\n            this._keypadContainer = document.createElement('div');\n            document.body.appendChild(this._keypadContainer);\n\n            ReactDOM.render(\n                <Keypad\n                    onElementMounted={element => {\n                        this.setState({\n                            keypadElement: element,\n                        });\n                    }}\n                    onDismiss={() => {\n                        this.blur && this.blur();\n                    }}\n                    style={this.props.keypadStyle}\n                />,\n                this._keypadContainer\n            );\n        }\n    },\n\n    componentWillUnmount() {\n        if (this._keypadContainer) {\n            ReactDOM.unmountComponentAtNode(this._keypadContainer);\n            if (this._keypadContainer.parentNode) {\n                // Note ChildNode.remove() isn't available in older Android\n                // webviews.\n                this._keypadContainer.parentNode.removeChild(\n                        this._keypadContainer);\n            }\n            this._keypadContainer = null;\n        }\n    },\n\n    keypadElement() {\n        return this.state.keypadElement;\n    },\n};\n\n_module_.exports = ProvideKeypad;\nexport default _module_.exports;\n","import { mapObject } from \"./interactive2/objective_.js\";\nimport _utilJs from \"./util.js\";\nimport _rendererJsx from \"./renderer.jsx\";\nimport _mixinsProvideKeypadJsx from \"./mixins/provide-keypad.jsx\";\nimport _hintsRendererJsx from \"./hints-renderer.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A copy of the ItemRenderer which renders its question renderer and hints\n * renderer normally instead of ReactDOM.render()ing them into elements in the\n * DOM.\n *\n * This allows this component to be used in server-rendering of a perseus\n * exercise.\n */\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst HintsRenderer = _hintsRendererJsx;\nconst ProvideKeypad = _mixinsProvideKeypadJsx;\nconst Renderer = _rendererJsx;\nconst Util = _utilJs;\n\nconst RP = PropTypes;\n\nconst ItemRenderer = createReactClass({\n    propTypes: {\n        ...ProvideKeypad.propTypes,\n        apiOptions: RP.any,\n        hintsVisible: RP.number,\n        item: RP.shape({\n            answerArea: RP.shape({\n                calculator: RP.bool,\n                chi2Table: RP.bool,\n                periodicTable: RP.bool,\n                tTable: RP.bool,\n                zTable: RP.bool,\n            }),\n            hints: RP.arrayOf(RP.object),\n            question: RP.object,\n        }).isRequired,\n        problemNum: RP.number,\n        reviewMode: RP.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            apiOptions: {}, // a deep default is done in `this.update()`\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            ...ProvideKeypad.getInitialState(),\n            questionCompleted: false,\n            questionHighlightedWidgets: [],\n        };\n    },\n\n    componentDidMount: function() {\n        ProvideKeypad.componentDidMount.call(this);\n        this._currentFocus = null;\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            questionHighlightedWidgets: [],\n        });\n    },\n\n    componentDidUpdate: function() {\n        if (this.props.apiOptions.answerableCallback) {\n            const isAnswerable =\n                this.questionRenderer.emptyWidgets().length === 0;\n            this.props.apiOptions.answerableCallback(isAnswerable);\n        }\n    },\n\n    componentWillUnmount() {\n        ProvideKeypad.componentWillUnmount.call(this);\n    },\n\n    keypadElement() {\n        return ProvideKeypad.keypadElement.call(this);\n    },\n\n    _handleFocusChange: function(newFocus, oldFocus) {\n        if (newFocus != null) {\n            this._setCurrentFocus(newFocus);\n        } else {\n            this._onRendererBlur(oldFocus);\n        }\n    },\n\n    // Sets the current focus path and element and\n    // send an onChangeFocus event back to our parent.\n    _setCurrentFocus: function(newFocus) {\n        const keypadElement = this.keypadElement();\n\n        // By the time this happens, newFocus cannot be a prefix of\n        // prevFocused, since we must have either been called from\n        // an onFocusChange within a renderer, which is only called when\n        // this is not a prefix, or between the question and answer areas,\n        // which can never prefix each other.\n        const prevFocus = this._currentFocus;\n        this._currentFocus = newFocus;\n\n        // Determine whether the newly focused path represents an input.\n        const inputPaths = this.getInputPaths();\n        const didFocusInput =\n            this._currentFocus &&\n            inputPaths.some(inputPath => {\n                return Util.inputPathsEqual(inputPath, this._currentFocus);\n            });\n\n        if (this.props.apiOptions.onFocusChange != null) {\n            this.props.apiOptions.onFocusChange(\n                this._currentFocus,\n                prevFocus,\n                didFocusInput &&\n                    keypadElement &&\n                    ReactDOM.findDOMNode(keypadElement)\n            );\n        }\n\n        if (keypadElement) {\n            if (didFocusInput) {\n                keypadElement.activate();\n            } else {\n                keypadElement.dismiss();\n            }\n        }\n    },\n\n    _onRendererBlur: function(blurPath) {\n        const blurringFocusPath = this._currentFocus;\n\n        // Failsafe: abort if ID is different, because focus probably happened\n        // before blur\n        if (!_.isEqual(blurPath, blurringFocusPath)) {\n            return;\n        }\n\n        // Wait until after any new focus events fire this tick before\n        // declaring that nothing is focused.\n        // If a different widget was focused, we'll see an onBlur event\n        // now, but then an onFocus event on a different element before\n        // this callback is executed\n        _.defer(() => {\n            if (_.isEqual(this._currentFocus, blurringFocusPath)) {\n                this._setCurrentFocus(null);\n            }\n        });\n    },\n\n    /**\n     * Accepts a question area widgetId, or an answer area widgetId of\n     * the form \"answer-input-number 1\", or the string \"answer-area\"\n     * for the whole answer area (if the answer area is a single widget).\n     */\n    _setWidgetProps: function(widgetId, newProps, callback) {\n        this.questionRenderer._setWidgetProps(widgetId, newProps, callback);\n    },\n\n    _handleAPICall: function(functionName, path) {\n        // Get arguments to pass to function, including `path`\n        const functionArgs = _.rest(arguments);\n        const caller = this.questionRenderer;\n\n        return caller[functionName](...functionArgs);\n    },\n\n    setInputValue: function(path, newValue, focus) {\n        return this._handleAPICall(\"setInputValue\", path, newValue, focus);\n    },\n\n    focusPath: function(path) {\n        return this._handleAPICall(\"focusPath\", path);\n    },\n\n    blurPath: function(path) {\n        return this._handleAPICall(\"blurPath\", path);\n    },\n\n    getDOMNodeForPath: function(path) {\n        return this._handleAPICall(\"getDOMNodeForPath\", path);\n    },\n\n    getGrammarTypeForPath: function(path) {\n        return this._handleAPICall(\"getGrammarTypeForPath\", path);\n    },\n\n    getInputPaths: function() {\n        const questionAreaInputPaths = this.questionRenderer.getInputPaths();\n        return questionAreaInputPaths;\n    },\n\n    handleInteractWithWidget: function(widgetId) {\n        const withRemoved = _.difference(\n            this.state.questionHighlightedWidgets,\n            [widgetId]\n        );\n        this.setState({\n            questionCompleted: false,\n            questionHighlightedWidgets: withRemoved,\n        });\n\n        if (this.props.apiOptions.interactionCallback) {\n            this.props.apiOptions.interactionCallback();\n        }\n    },\n\n    focus: function() {\n        return this.questionRenderer.focus();\n    },\n\n    blur: function() {\n        if (this._currentFocus) {\n            this.blurPath(this._currentFocus);\n        }\n    },\n\n    getNumHints: function() {\n        return this.props.item.hints.length;\n    },\n\n    /**\n     * Grades the item.\n     *\n     * Returns a KE-style score of {\n     *     empty: bool,\n     *     correct: bool,\n     *     message: string|null,\n     *     guess: Array\n     * }\n     */\n    scoreInput: function() {\n        const guessAndScore = this.questionRenderer.guessAndScore();\n        const guess = guessAndScore[0];\n        const score = guessAndScore[1];\n\n        // Continue to include an empty guess for the now defunct answer area.\n        // TODO(alex): Check whether we rely on the format here for\n        //             analyzing ProblemLogs. If not, remove this layer.\n        const maxCompatGuess = [guess, []];\n\n        const keScore = Util.keScoreFromPerseusScore(\n            score,\n            maxCompatGuess,\n            this.questionRenderer.getSerializedState()\n        );\n\n        const emptyQuestionAreaWidgets = this.questionRenderer.emptyWidgets();\n\n        this.setState({\n            questionCompleted: keScore.correct,\n            questionHighlightedWidgets: emptyQuestionAreaWidgets,\n        });\n\n        return keScore;\n    },\n\n    /**\n     * Returns an array of all widget IDs in the order they occur in\n     * the question content.\n     */\n    getWidgetIds: function() {\n        return this.questionRenderer.getWidgetIds();\n    },\n\n    /**\n     * Returns an object mapping from widget ID to KE-style score.\n     * The keys of this object are the values of the array returned\n     * from `getWidgetIds`.\n     */\n    scoreWidgets: function() {\n        const qScore = this.questionRenderer.scoreWidgets();\n        const qGuess = this.questionRenderer.getUserInputForWidgets();\n        const state = this.questionRenderer.getSerializedState();\n        return mapObject(qScore, (score, id) => {\n            return Util.keScoreFromPerseusScore(score, qGuess[id], state);\n        });\n    },\n\n    /**\n     * Get a representation of the current state of the item.\n     */\n    getSerializedState: function() {\n        return {\n            question: this.questionRenderer.getSerializedState(),\n            hints: this.hintsRenderer.getSerializedState(),\n        };\n    },\n\n    restoreSerializedState: function(state, callback) {\n        // We need to wait for both the question renderer and the hints\n        // renderer to finish restoring their states.\n        let numCallbacks = 2;\n        const fireCallback = () => {\n            --numCallbacks;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        this.questionRenderer.restoreSerializedState(\n            state.question,\n            fireCallback\n        );\n        this.hintsRenderer.restoreSerializedState(state.hints, fireCallback);\n    },\n\n    showRationalesForCurrentlySelectedChoices() {\n        this.questionRenderer.showRationalesForCurrentlySelectedChoices();\n    },\n\n    deselectIncorrectSelectedChoices() {\n        this.questionRenderer.deselectIncorrectSelectedChoices();\n    },\n\n    render: function() {\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n            onFocusChange: this._handleFocusChange,\n        };\n\n        const questionRenderer = (\n            <Renderer\n                keypadElement={this.keypadElement()}\n                problemNum={this.props.problemNum}\n                onInteractWithWidget={this.handleInteractWithWidget}\n                highlightedWidgets={this.state.questionHighlightedWidgets}\n                apiOptions={apiOptions}\n                questionCompleted={this.state.questionCompleted}\n                reviewMode={this.props.reviewMode}\n                ref={elem => this.questionRenderer = elem}\n                {...this.props.item.question}\n            />\n        );\n\n        const hintsRenderer = (\n            <HintsRenderer\n                hints={this.props.item.hints}\n                hintsVisible={this.props.hintsVisible}\n                apiOptions={apiOptions}\n                ref={elem => this.hintsRenderer = elem}\n            />\n        );\n\n        return (\n            <div>\n                <div>\n                    {questionRenderer}\n                </div>\n                <div\n                    className={\n                        // Avoid adding any horizontal padding when applying the\n                        // mobile hint styles, which are flush to the left.\n                        // NOTE(charlie): We may still want to apply this\n                        // padding for desktop exercises.\n                        !apiOptions.isMobile && css(styles.hintsContainer)\n                    }\n                >\n                    {hintsRenderer}\n                </div>\n            </div>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    hintsContainer: {\n        marginLeft: 50,\n    },\n});\n\n_module_.exports = ItemRenderer;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport { mapObject } from \"./interactive2/objective_.js\";\nimport _utilJs from \"./util.js\";\nimport _mixinsProvideKeypadJsx from \"./mixins/provide-keypad.jsx\";\nimport _rendererJsx from \"./renderer.jsx\";\nimport _hintsRendererJsx from \"./hints-renderer.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, prefer-spread */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst HintsRenderer = _hintsRendererJsx;\nconst Renderer = _rendererJsx;\nconst ProvideKeypad = _mixinsProvideKeypadJsx;\nconst Util = _utilJs;\n\nconst Gorgon = _gorgonGorgonJs;\n\nconst RP = PropTypes;\n\nconst ItemRenderer = createReactClass({\n    propTypes: {\n        ...ProvideKeypad.propTypes,\n        // defaults are set in `this.update()` so as to adhere to\n        // `ApiOptions.PropTypes`, though the API options that are passed in\n        // can be in any degree of completeness\n        apiOptions: RP.shape({\n            interactionCallback: RP.func,\n            onFocusChange: RP.func,\n            setDrawingAreaAvailable: RP.func,\n        }),\n        // Whether this component should control hiding/showing peripheral\n        // item-related components (for list, see item.answerArea below).\n        // TODO(alex): Generalize this to an 'expectsToBeInTemplate' prop\n        controlPeripherals: RP.bool,\n        hintsAreaSelector: RP.string,\n        initialHintsVisible: RP.number,\n        item: RP.shape({\n            answerArea: RP.shape({\n                calculator: RP.bool,\n                chi2Table: RP.bool,\n                periodicTable: RP.bool,\n                tTable: RP.bool,\n                zTable: RP.bool,\n            }),\n            hints: RP.arrayOf(RP.object),\n            question: RP.object,\n        }).isRequired,\n\n        onShowCalculator: RP.func,\n        onShowChi2Table: RP.func,\n        onShowPeriodicTable: RP.func,\n        onShowTTable: RP.func,\n        onShowZTable: RP.func,\n\n        problemNum: RP.number,\n        reviewMode: PropTypes.bool,\n        savedState: RP.any,\n        workAreaSelector: RP.string,\n        linterContext: linterContextProps,\n        legacyPerseusLint: PropTypes.arrayOf(PropTypes.string),\n    },\n\n    getDefaultProps: function() {\n        return {\n            apiOptions: {}, // defaults are set in `this.update()`\n            controlPeripherals: true,\n            hintsAreaSelector: \"#hintsarea\",\n            initialHintsVisible: 0,\n            workAreaSelector: \"#workarea\",\n            reviewMode: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            ...ProvideKeypad.getInitialState(),\n            hintsVisible: this.props.initialHintsVisible,\n            questionCompleted: false,\n            questionHighlightedWidgets: [],\n        };\n    },\n\n    componentDidMount: function() {\n        ProvideKeypad.componentDidMount.call(this);\n        if (\n            this.props.controlPeripherals &&\n            this.props.apiOptions.setDrawingAreaAvailable\n        ) {\n            this.props.apiOptions.setDrawingAreaAvailable(true);\n        }\n        this._currentFocus = null;\n        this.update();\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            questionHighlightedWidgets: [],\n        });\n    },\n\n    componentDidUpdate: function() {\n        this.update();\n    },\n\n    componentWillUnmount: function() {\n        ProvideKeypad.componentWillUnmount.call(this);\n        ReactDOM.unmountComponentAtNode(\n            document.querySelector(this.props.workAreaSelector)\n        );\n        ReactDOM.unmountComponentAtNode(\n            document.querySelector(this.props.hintsAreaSelector)\n        );\n\n        if (this.props.controlPeripherals) {\n            var answerArea = this.props.item.answerArea || {};\n            if (answerArea.calculator) {\n                $(\"#calculator\").hide();\n            }\n            if (answerArea.periodicTable) {\n                $(\".periodic-table-info-box\").hide();\n            }\n            if (answerArea.zTable) {\n                $(\".z-table-info-box\").hide();\n            }\n            if (answerArea.tTable) {\n                $(\".t-table-info-box\").hide();\n            }\n            if (answerArea.chi2Table) {\n                $(\".chi2-table-info-box\").hide();\n            }\n        }\n    },\n\n    keypadElement() {\n        return ProvideKeypad.keypadElement.call(this);\n    },\n\n    update: function() {\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n            onFocusChange: this._handleFocusChange,\n        };\n\n        // Since the item renderer works by rendering things into three divs\n        // that have completely different places in the DOM, we have to do this\n        // strangeness instead of relying on React's normal render() method.\n        // TODO(alpert): Figure out how to clean this up somehow\n        this.questionRenderer = ReactDOM.render(\n            <Renderer\n                keypadElement={this.keypadElement()}\n                problemNum={this.props.problemNum}\n                onInteractWithWidget={this.handleInteractWithWidget}\n                highlightedWidgets={this.state.questionHighlightedWidgets}\n                apiOptions={apiOptions}\n                questionCompleted={this.state.questionCompleted}\n                reviewMode={this.props.reviewMode}\n                savedState={this.props.savedState}\n                linterContext={Gorgon.pushContextStack(\n                    this.props.linterContext,\n                    \"question\"\n                )}\n                {...this.props.item.question}\n                legacyPerseusLint={this.props.legacyPerseusLint}\n            />,\n            document.querySelector(this.props.workAreaSelector)\n        );\n\n        this.hintsRenderer = ReactDOM.render(\n            <HintsRenderer\n                hints={this.props.item.hints}\n                hintsVisible={this.state.hintsVisible}\n                apiOptions={apiOptions}\n                linterContext={Gorgon.pushContextStack(\n                    this.props.linterContext,\n                    \"hints\"\n                )}\n            />,\n            document.querySelector(this.props.hintsAreaSelector)\n        );\n\n        var answerArea = this.props.item.answerArea || {};\n        if (this.props.controlPeripherals) {\n            $(\"#calculator\").toggle(answerArea.calculator || false);\n            $(\".periodic-table-info-box\").toggle(\n                answerArea.periodicTable || false\n            );\n            $(\".z-table-info-box\").toggle(answerArea.zTable || false);\n            $(\".t-table-info-box\").toggle(answerArea.tTable || false);\n            $(\".chi2-table-info-box\").toggle(answerArea.chi2Table || false);\n        } else {\n            if (answerArea.calculator) {\n                this.props.onShowCalculator && this.props.onShowCalculator();\n            }\n            if (answerArea.periodicTable) {\n                this.props.onShowPeriodicTable &&\n                    this.props.onShowPeriodicTable();\n            }\n            if (answerArea.zTable) {\n                this.props.onShowZTable && this.props.onShowZTable();\n            }\n            if (answerArea.tTable) {\n                this.props.onShowTTable && this.props.onShowTTable();\n            }\n            if (answerArea.chi2Table) {\n                this.props.onShowChi2Table && this.props.onShowChi2Table();\n            }\n        }\n\n        if (apiOptions.answerableCallback) {\n            const isAnswerable =\n                this.questionRenderer.emptyWidgets().length === 0;\n            apiOptions.answerableCallback(isAnswerable);\n        }\n    },\n\n    _handleFocusChange: function(newFocus, oldFocus) {\n        if (newFocus != null) {\n            this._setCurrentFocus(newFocus);\n        } else {\n            this._onRendererBlur(oldFocus);\n        }\n    },\n\n    // Sets the current focus path and element and send an onChangeFocus event\n    // back to our parent.\n    _setCurrentFocus: function(newFocus) {\n        const keypadElement = this.keypadElement();\n\n        // By the time this happens, newFocus cannot be a prefix of\n        // prevFocused, since we must have either been called from\n        // an onFocusChange within a renderer, which is only called when\n        // this is not a prefix, or between the question and answer areas,\n        // which can never prefix each other.\n        const prevFocus = this._currentFocus;\n        this._currentFocus = newFocus;\n\n        // Determine whether the newly focused path represents an input.\n        const inputPaths = this.getInputPaths();\n        const didFocusInput =\n            this._currentFocus &&\n            inputPaths.some(inputPath => {\n                return Util.inputPathsEqual(inputPath, this._currentFocus);\n            });\n\n        if (this.props.apiOptions.onFocusChange != null) {\n            this.props.apiOptions.onFocusChange(\n                this._currentFocus,\n                prevFocus,\n                didFocusInput &&\n                    keypadElement &&\n                    ReactDOM.findDOMNode(keypadElement)\n            );\n        }\n\n        if (keypadElement) {\n            if (didFocusInput) {\n                keypadElement.activate();\n            } else {\n                keypadElement.dismiss();\n            }\n        }\n    },\n\n    _onRendererBlur: function(blurPath) {\n        var blurringFocusPath = this._currentFocus;\n\n        // Failsafe: abort if ID is different, because focus probably happened\n        // before blur.\n        if (!Util.inputPathsEqual(blurPath, blurringFocusPath)) {\n            return;\n        }\n\n        // Wait until after any new focus events fire this tick before\n        // declaring that nothing is focused, since if there were a focus change\n        // across Renderers (e.g., from the HintsRenderer to the\n        // QuestionRenderer), we could receive the blur before the focus.\n        setTimeout(() => {\n            if (Util.inputPathsEqual(this._currentFocus, blurringFocusPath)) {\n                this._setCurrentFocus(null);\n            }\n        });\n    },\n\n    /**\n     * Accepts a question area widgetId, or an answer area widgetId of\n     * the form \"answer-input-number 1\", or the string \"answer-area\"\n     * for the whole answer area (if the answer area is a single widget).\n     */\n    _setWidgetProps: function(widgetId, newProps, callback) {\n        this.questionRenderer._setWidgetProps(widgetId, newProps, callback);\n    },\n\n    _handleAPICall: function(functionName, path) {\n        // Get arguments to pass to function, including `path`.\n        var functionArgs = _.rest(arguments);\n\n        // TODO(charlie): Extend this API to support inputs in the\n        // HintsRenderer as well.\n        var caller = this.questionRenderer;\n\n        return caller[functionName].apply(caller, functionArgs);\n    },\n\n    setInputValue: function(path, newValue, focus) {\n        return this._handleAPICall(\"setInputValue\", path, newValue, focus);\n    },\n\n    focusPath: function(path) {\n        return this._handleAPICall(\"focusPath\", path);\n    },\n\n    blurPath: function(path) {\n        return this._handleAPICall(\"blurPath\", path);\n    },\n\n    getDOMNodeForPath: function(path) {\n        return this._handleAPICall(\"getDOMNodeForPath\", path);\n    },\n\n    getGrammarTypeForPath: function(path) {\n        return this._handleAPICall(\"getGrammarTypeForPath\", path);\n    },\n\n    getInputPaths: function() {\n        var questionAreaInputPaths = this.questionRenderer.getInputPaths();\n        return questionAreaInputPaths;\n    },\n\n    handleInteractWithWidget: function(widgetId) {\n        var withRemoved = _.difference(this.state.questionHighlightedWidgets, [\n            widgetId,\n        ]);\n        this.setState({\n            questionCompleted: false,\n            questionHighlightedWidgets: withRemoved,\n        });\n\n        if (this.props.apiOptions.interactionCallback) {\n            this.props.apiOptions.interactionCallback();\n        }\n    },\n\n    focus: function() {\n        return this.questionRenderer.focus();\n    },\n\n    blur: function() {\n        if (this._currentFocus) {\n            this.blurPath(this._currentFocus);\n        }\n    },\n\n    showHint: function() {\n        if (this.state.hintsVisible < this.getNumHints()) {\n            this.setState({\n                hintsVisible: this.state.hintsVisible + 1,\n            });\n        }\n    },\n\n    getNumHints: function() {\n        return this.props.item.hints.length;\n    },\n\n    /**\n     * Grades the item.\n     *\n     * Returns a KE-style score of {\n     *     empty: bool,\n     *     correct: bool,\n     *     message: string|null,\n     *     guess: Array\n     * }\n     */\n    scoreInput: function() {\n        var guessAndScore = this.questionRenderer.guessAndScore();\n        var guess = guessAndScore[0];\n        var score = guessAndScore[1];\n\n        // Continue to include an empty guess for the now defunct answer area.\n        // TODO(alex): Check whether we rely on the format here for\n        //             analyzing ProblemLogs. If not, remove this layer.\n        var maxCompatGuess = [guess, []];\n\n        var keScore = Util.keScoreFromPerseusScore(\n            score,\n            maxCompatGuess,\n            this.questionRenderer.getSerializedState()\n        );\n\n        var emptyQuestionAreaWidgets = this.questionRenderer.emptyWidgets();\n\n        this.setState({\n            questionCompleted: keScore.correct,\n            questionHighlightedWidgets: emptyQuestionAreaWidgets,\n        });\n\n        return keScore;\n    },\n\n    /**\n     * Returns an array of all widget IDs in the order they occur in\n     * the question content.\n     */\n    getWidgetIds: function() {\n        return this.questionRenderer.getWidgetIds();\n    },\n\n    /**\n     * Returns an object mapping from widget ID to KE-style score.\n     * The keys of this object are the values of the array returned\n     * from `getWidgetIds`.\n     */\n    scoreWidgets: function() {\n        var qScore = this.questionRenderer.scoreWidgets();\n        var qGuess = this.questionRenderer.getUserInputForWidgets();\n        var state = this.questionRenderer.getSerializedState();\n        return mapObject(qScore, (score, id) => {\n            return Util.keScoreFromPerseusScore(score, qGuess[id], state);\n        });\n    },\n\n    /**\n     * Get a representation of the current state of the item.\n     */\n    getSerializedState: function() {\n        return {\n            question: this.questionRenderer.getSerializedState(),\n            hints: this.hintsRenderer.getSerializedState(),\n        };\n    },\n\n    restoreSerializedState: function(state, callback) {\n        // We need to wait for both the question renderer and the hints\n        // renderer to finish restoring their states.\n        var numCallbacks = 2;\n        var fireCallback = () => {\n            --numCallbacks;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        this.questionRenderer.restoreSerializedState(\n            state.question,\n            fireCallback\n        );\n        this.hintsRenderer.restoreSerializedState(state.hints, fireCallback);\n    },\n\n    showRationalesForCurrentlySelectedChoices() {\n        this.questionRenderer.showRationalesForCurrentlySelectedChoices();\n    },\n\n    deselectIncorrectSelectedChoices() {\n        this.questionRenderer.deselectIncorrectSelectedChoices();\n    },\n\n    render: function() {\n        return <div />;\n    },\n});\n\n_module_.exports = ItemRenderer;\nexport default _module_.exports;\n","import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport _ from \"underscore\";\nimport { mapObject } from \"./interactive2/objective_.js\";\nimport Util from \"./util.js\";\nimport Renderer from \"./renderer.jsx\";\nimport ProvideKeypad from \"./mixins/provide-keypad.jsx\";\nimport HintsRenderer from \"./hints-renderer.jsx\";\nimport { Options as ApiOptions } from \"./perseus-api.jsx\";\nimport { StyleSheet, css } from \"aphrodite\";\n\n/**\n * A copy of the ItemRenderer which renders its question renderer and hints\n * renderer normally instead of ReactDOM.render()ing them into elements in the\n * DOM.\n *\n * As well as check answer, grading, and hints buttons built in\n */\n\nconst styles = StyleSheet.create({\n    hintsContainer: {\n        marginLeft: 50,\n    },\n    checkAnswerButton: {\n        padding: 10,\n        color: \"white\",\n        fontSize: 14,\n        borderRadius: 5,\n        display: \"inline-grid\",\n        gridTemplateColumns: \"1fr\",\n        gridTemplateRows: \"1fr\",\n    },\n    checkAnswerText: {\n        gridArea: \"1 / 1 / 2 / 2\",\n    },\n});\n\nconst QuestionRenderer = createReactClass({\n    propTypes: {\n        ...ProvideKeypad.propTypes,\n        apiOptions: PropTypes.any,\n        initialHintsVisible: PropTypes.number,\n        item: PropTypes.shape({\n            answerArea: PropTypes.shape({\n                calculator: PropTypes.bool,\n                chi2Table: PropTypes.bool,\n                periodicTable: PropTypes.bool,\n                tTable: PropTypes.bool,\n                zTable: PropTypes.bool,\n            }),\n            hints: PropTypes.arrayOf(PropTypes.object),\n            question: PropTypes.object,\n        }).isRequired,\n        problemNum: PropTypes.number,\n        reviewMode: PropTypes.bool,\n        onAnswer: PropTypes.func,\n        onHint: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            apiOptions: {}, // a deep default is done in `this.update()`\n            initialHintsVisible: 0,\n            problemNum: 0,\n            reviewMode: false,\n            onAnswer: () => {},\n            onHint: () => {},\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            ...ProvideKeypad.getInitialState(),\n            hintsVisible: this.props.initialHintsVisible,\n            answerState: 'unanswered',\n            questionHighlightedWidgets: [],\n        };\n    },\n\n    componentDidMount: function() {\n        ProvideKeypad.componentDidMount.call(this);\n        this._currentFocus = null;\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            questionHighlightedWidgets: [],\n        });\n    },\n\n    componentDidUpdate: function() {\n        if (this.props.apiOptions.answerableCallback) {\n            const isAnswerable =\n                this.questionRenderer.emptyWidgets().length === 0;\n            this.props.apiOptions.answerableCallback(isAnswerable);\n        }\n    },\n\n    componentWillUnmount() {\n        ProvideKeypad.componentWillUnmount.call(this);\n    },\n\n    keypadElement() {\n        return ProvideKeypad.keypadElement.call(this);\n    },\n\n    _handleFocusChange: function(newFocus, oldFocus) {\n        if (newFocus != null) {\n            this._setCurrentFocus(newFocus);\n        } else {\n            this._onRendererBlur(oldFocus);\n        }\n    },\n\n    // Sets the current focus path and element and\n    // send an onChangeFocus event back to our parent.\n    _setCurrentFocus: function(newFocus) {\n        const keypadElement = this.keypadElement();\n\n        // By the time this happens, newFocus cannot be a prefix of\n        // prevFocused, since we must have either been called from\n        // an onFocusChange within a renderer, which is only called when\n        // this is not a prefix, or between the question and answer areas,\n        // which can never prefix each other.\n        const prevFocus = this._currentFocus;\n        this._currentFocus = newFocus;\n\n        // Determine whether the newly focused path represents an input.\n        const inputPaths = this.getInputPaths();\n        const didFocusInput =\n            this._currentFocus &&\n            inputPaths.some(inputPath => {\n                return Util.inputPathsEqual(inputPath, this._currentFocus);\n            });\n\n        if (this.props.apiOptions.onFocusChange != null) {\n            this.props.apiOptions.onFocusChange(\n                this._currentFocus,\n                prevFocus,\n                didFocusInput &&\n                    keypadElement &&\n                    ReactDOM.findDOMNode(keypadElement)\n            );\n        }\n\n        if (keypadElement) {\n            if (didFocusInput) {\n                keypadElement.activate();\n            } else {\n                keypadElement.dismiss();\n            }\n        }\n    },\n\n    _onRendererBlur: function(blurPath) {\n        const blurringFocusPath = this._currentFocus;\n\n        // Failsafe: abort if ID is different, because focus probably happened\n        // before blur\n        if (!_.isEqual(blurPath, blurringFocusPath)) {\n            return;\n        }\n\n        // Wait until after any new focus events fire this tick before\n        // declaring that nothing is focused.\n        // If a different widget was focused, we'll see an onBlur event\n        // now, but then an onFocus event on a different element before\n        // this callback is executed\n        _.defer(() => {\n            if (_.isEqual(this._currentFocus, blurringFocusPath)) {\n                this._setCurrentFocus(null);\n            }\n        });\n    },\n\n    /**\n     * Accepts a question area widgetId, or an answer area widgetId of\n     * the form \"answer-input-number 1\", or the string \"answer-area\"\n     * for the whole answer area (if the answer area is a single widget).\n     */\n    _setWidgetProps: function(widgetId, newProps, callback) {\n        this.questionRenderer._setWidgetProps(widgetId, newProps, callback);\n    },\n\n    _handleAPICall: function(functionName, path) {\n        // Get arguments to pass to function, including `path`\n        const functionArgs = _.rest(arguments);\n        const caller = this.questionRenderer;\n\n        return caller[functionName](...functionArgs);\n    },\n\n    setInputValue: function(path, newValue, focus) {\n        return this._handleAPICall(\"setInputValue\", path, newValue, focus);\n    },\n\n    focusPath: function(path) {\n        return this._handleAPICall(\"focusPath\", path);\n    },\n\n    blurPath: function(path) {\n        return this._handleAPICall(\"blurPath\", path);\n    },\n\n    getDOMNodeForPath: function(path) {\n        return this._handleAPICall(\"getDOMNodeForPath\", path);\n    },\n\n    getGrammarTypeForPath: function(path) {\n        return this._handleAPICall(\"getGrammarTypeForPath\", path);\n    },\n\n    getInputPaths: function() {\n        const questionAreaInputPaths = this.questionRenderer.getInputPaths();\n        return questionAreaInputPaths;\n    },\n\n    handleInteractWithWidget: function(widgetId) {\n        const withRemoved = _.difference(\n            this.state.questionHighlightedWidgets,\n            [widgetId]\n        );\n        this.setState({\n            answerState: \"unanswered\",\n            questionHighlightedWidgets: withRemoved,\n        });\n\n        if (this.props.apiOptions.interactionCallback) {\n            this.props.apiOptions.interactionCallback();\n        }\n    },\n\n    focus: function() {\n        return this.questionRenderer.focus();\n    },\n\n    blur: function() {\n        if (this._currentFocus) {\n            this.blurPath(this._currentFocus);\n        }\n    },\n\n    showHint: function() {\n        if (this.state.hintsVisible < this.getNumHints()) {\n            this.props.onHint(this.state.hintsVisible + 1, this.getNumHints());\n            this.setState({\n                hintsVisible: this.state.hintsVisible + 1,\n            });\n        }\n    },\n\n    getNumHints: function() {\n        return this.props.item.hints.length;\n    },\n\n    /**\n     * Grades the item.\n     *\n     * Returns a KE-style score of {\n     *     empty: bool,\n     *     correct: bool,\n     *     message: string|null,\n     *     guess: Array\n     * }\n     */\n    scoreInput: function() {\n        const [guess, score] = this.questionRenderer.guessAndScore();\n\n        const isCorrect = score.type === \"points\" && score.earned >= score.total;\n        const emptyQuestionAreaWidgets = this.questionRenderer.emptyWidgets();\n\n        // TODO(aria): Add in \"unfinished\"/invalid suppost to answerState\n        // for better check answer messages\n        this.setState({\n            answerState: isCorrect ? \"correct\" : \"incorrect\",\n            questionHighlightedWidgets: emptyQuestionAreaWidgets,\n        });\n\n        return [guess, score];\n    },\n\n    checkAnswer: function(e) {\n        e.preventDefault();\n        const [guess, score] = this.scoreInput();\n        this.props.onAnswer(guess, score);\n    },\n\n    /**\n     * Returns an array of all widget IDs in the order they occur in\n     * the question content.\n     */\n    getWidgetIds: function() {\n        return this.questionRenderer.getWidgetIds();\n    },\n\n    /**\n     * Returns an object mapping from widget ID to KE-style score.\n     * The keys of this object are the values of the array returned\n     * from `getWidgetIds`.\n     */\n    scoreWidgets: function() {\n        const qScore = this.questionRenderer.scoreWidgets();\n        const qGuess = this.questionRenderer.getUserInputForWidgets();\n        const state = this.questionRenderer.getSerializedState();\n        return mapObject(qScore, (score, id) => {\n            return Util.keScoreFromPerseusScore(score, qGuess[id], state);\n        });\n    },\n\n    /**\n     * Get a representation of the current state of the item.\n     */\n    getSerializedState: function() {\n        return {\n            question: this.questionRenderer.getSerializedState(),\n            hints: this.hintsRenderer.getSerializedState(),\n        };\n    },\n\n    restoreSerializedState: function(state, callback) {\n        // We need to wait for both the question renderer and the hints\n        // renderer to finish restoring their states.\n        let numCallbacks = 2;\n        const fireCallback = () => {\n            --numCallbacks;\n            if (callback && numCallbacks === 0) {\n                callback();\n            }\n        };\n\n        this.questionRenderer.restoreSerializedState(\n            state.question,\n            fireCallback\n        );\n        this.hintsRenderer.restoreSerializedState(state.hints, fireCallback);\n    },\n\n    showRationalesForCurrentlySelectedChoices() {\n        this.questionRenderer.showRationalesForCurrentlySelectedChoices();\n    },\n\n    deselectIncorrectSelectedChoices() {\n        this.questionRenderer.deselectIncorrectSelectedChoices();\n    },\n\n    render: function() {\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n            onFocusChange: this._handleFocusChange,\n        };\n\n        const questionRenderer = (\n            <Renderer\n                keypadElement={this.keypadElement()}\n                problemNum={this.props.problemNum}\n                onInteractWithWidget={this.handleInteractWithWidget}\n                highlightedWidgets={this.state.questionHighlightedWidgets}\n                apiOptions={apiOptions}\n                questionCompleted={this.state.answerState === \"correct\"}\n                reviewMode={this.props.reviewMode}\n                ref={elem => this.questionRenderer = elem}\n                {...this.props.item.question}\n            />\n        );\n\n        const hintsRenderer = (\n            <HintsRenderer\n                hints={this.props.item.hints}\n                hintsVisible={this.state.hintsVisible}\n                apiOptions={apiOptions}\n                ref={elem => this.hintsRenderer = elem}\n            />\n        );\n\n        const isOutOfHints = this.state.hintsVisible >= this.getNumHints()\n\n        return (\n            <form\n                className=\"framework-perseus\"\n                onSubmit={this.checkAnswer}\n            >\n                <div>\n                    {questionRenderer}\n                </div>\n                <div style={{ paddingTop: 10, paddingBottom: 10 }}>\n                    <button\n                        type=\"submit\"\n                        className={\"check-answer-button \" + css(styles.checkAnswerButton)}\n                        style={{\n                            backgroundColor: this.state.answerState === \"incorrect\" ? \"orange\" : \"green\",\n                        }}\n                        disabled={this.state.answerState === \"correct\"}\n                    >\n                        <span className={css(styles.checkAnswerText)} style={{ visibility: this.state.answerState === \"correct\" ? \"visible\" : \"hidden\"}}>\n                             Yes! You got it!\n                        </span>\n                        <span className={css(styles.checkAnswerText)} style={{ visibility: this.state.answerState === \"incorrect\" ? \"visible\" : \"hidden\"}}>\n                            Try again\n                        </span>\n                        <span className={css(styles.checkAnswerText)} style={{ visibility: this.state.answerState === \"unanswered\" ? \"visible\" : \"hidden\"}}>\n                            Check answer\n                        </span>\n                    </button>\n                    <div style={{ display: 'inline-block', width: 10 }} />\n                    <button\n                        type=\"button\"\n                        style={{\n                            padding: 10,\n                            backgroundColor: isOutOfHints ? \"darkgray\" : \"orange\",\n                            color: \"white\",\n                            fontSize: 14,\n                            borderRadius: 5,\n                        }}\n                        disabled={isOutOfHints}\n                        onClick={this.showHint}\n                    >\n                        {isOutOfHints ?\n                            \"We're out of hints!\" :\n                            \"I'd like a hint!\"\n                        }\n                    </button>\n                </div>\n                <div\n                    className={\n                        // Avoid adding any horizontal padding when applying the\n                        // mobile hint styles, which are flush to the left.\n                        // NOTE(charlie): We may still want to apply this\n                        // padding for desktop exercises.\n                        !apiOptions.isMobile && css(styles.hintsContainer)\n                    }\n                >\n                    {hintsRenderer}\n                </div>\n            </form>\n        );\n    },\n});\n\nexport default QuestionRenderer;\n","import { linterContextProps, linterContextDefault } from \"./gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport _mixinsProvideKeypadJsx from \"./mixins/provide-keypad.jsx\";\nimport _rendererJsx from \"./renderer.jsx\";\nimport _perseusApiJsx2 from \"./perseus-api.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _utilJs from \"./util.js\";\nimport _classnames from \"classnames\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * An article renderer. Articles are long-form pieces of content,\n * composed of multiple (Renderer) sections concatenated together.\n */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst classNames = _classnames;\n\nconst Util = _utilJs;\nconst ApiOptions = _perseusApiJsx.Options;\nconst ApiClassNames = _perseusApiJsx2.ClassNames;\nconst Renderer = _rendererJsx;\nconst ProvideKeypad = _mixinsProvideKeypadJsx;\n\nconst Gorgon = _gorgonGorgonJs;\n\nconst rendererProps = PropTypes.shape({\n    content: PropTypes.string,\n    widgets: PropTypes.object,\n    images: PropTypes.object,\n});\n\nconst ArticleRenderer = createReactClass({\n    propTypes: {\n        ...ProvideKeypad.propTypes,\n        apiOptions: PropTypes.shape({\n            onFocusChange: PropTypes.func,\n            isMobile: PropTypes.bool,\n        }),\n        json: PropTypes.oneOfType([\n            rendererProps,\n            PropTypes.arrayOf(rendererProps),\n        ]).isRequired,\n\n        // Whether to use the new Bibliotron styles for articles\n        useNewStyles: PropTypes.bool,\n        linterContext: linterContextProps,\n        legacyPerseusLint: PropTypes.arrayOf(PropTypes.string),\n    },\n\n    getDefaultProps() {\n        return {\n            apiOptions: {},\n            useNewStyles: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState() {\n        return ProvideKeypad.getInitialState();\n    },\n\n    componentDidMount() {\n        ProvideKeypad.componentDidMount.call(this);\n        this._currentFocus = null;\n    },\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return nextProps !== this.props || nextState !== this.state;\n    },\n\n    componentWillUnmount() {\n        ProvideKeypad.componentWillUnmount.call(this);\n    },\n\n    keypadElement() {\n        return ProvideKeypad.keypadElement.call(this);\n    },\n\n    _handleFocusChange(newFocusPath, oldFocusPath) {\n        // TODO(charlie): DRY this up--some of this logic is repeated in\n        // ItemRenderer.\n        if (newFocusPath) {\n            this._setCurrentFocus(newFocusPath);\n        } else {\n            this._onRendererBlur(oldFocusPath);\n        }\n    },\n\n    _setCurrentFocus(newFocusPath) {\n        const keypadElement = this.keypadElement();\n\n        const prevFocusPath = this._currentFocus;\n        this._currentFocus = newFocusPath;\n\n        // Use the section prefix to extract the relevant Renderer's input\n        // paths, so as to check whether the focused path represents an\n        // input.\n        let didFocusInput = false;\n        if (this._currentFocus) {\n            const [sectionRef, ...focusPath] = this._currentFocus;\n            const inputPaths = this.refs[sectionRef].getInputPaths();\n            didFocusInput = inputPaths.some(inputPath => {\n                return Util.inputPathsEqual(inputPath, focusPath);\n            });\n        }\n\n        if (this.props.apiOptions.onFocusChange != null) {\n            this.props.apiOptions.onFocusChange(\n                this._currentFocus,\n                prevFocusPath,\n                didFocusInput &&\n                    keypadElement &&\n                    ReactDOM.findDOMNode(keypadElement)\n            );\n        }\n\n        if (keypadElement) {\n            if (didFocusInput) {\n                keypadElement.activate();\n            } else {\n                keypadElement.dismiss();\n            }\n        }\n    },\n\n    _onRendererBlur(blurPath) {\n        const blurringFocusPath = this._currentFocus;\n\n        // Failsafe: abort if ID is different, because focus probably happened\n        // before blur.\n        if (!Util.inputPathsEqual(blurPath, blurringFocusPath)) {\n            return;\n        }\n\n        // Wait until after any new focus events fire this tick before declaring\n        // that nothing is focused, since if there were a focus change across\n        // sections, we could receive the blur before the focus.\n        setTimeout(() => {\n            if (Util.inputPathsEqual(this._currentFocus, blurringFocusPath)) {\n                this._setCurrentFocus(null);\n            }\n        });\n    },\n\n    blur() {\n        if (this._currentFocus) {\n            const [sectionRef, ...inputPath] = this._currentFocus;\n            this.refs[sectionRef].blurPath(inputPath);\n        }\n    },\n\n    _sections() {\n        return Array.isArray(this.props.json)\n            ? this.props.json\n            : [this.props.json];\n    },\n\n    render() {\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n            isArticle: true,\n        };\n\n        const classes = classNames({\n            \"framework-perseus\": true,\n            \"perseus-article\": true,\n            \"bibliotron-article\": this.props.useNewStyles,\n            // NOTE(charlie): For exercises, this is applied outside of Perseus\n            // (in webapp).\n            [ApiClassNames.MOBILE]: apiOptions.isMobile,\n        });\n\n        // TODO(alex): Add mobile api functions and pass them down here\n        const sections = this._sections().map((section, i) => {\n            const refForSection = `section-${i}`;\n            return (\n                <div key={i} className=\"clearfix\">\n                    <Renderer\n                        {...section}\n                        ref={refForSection}\n                        key={i}\n                        key_={i}\n                        keypadElement={this.keypadElement()}\n                        apiOptions={{\n                            ...apiOptions,\n                            onFocusChange: (newFocusPath, oldFocusPath) => {\n                                // Prefix the paths with the relevant section,\n                                // so as to allow us to distinguish between\n                                // equivalently-named inputs across Renderers.\n                                this._handleFocusChange(\n                                    newFocusPath &&\n                                        [refForSection].concat(newFocusPath),\n                                    oldFocusPath &&\n                                        [refForSection].concat(oldFocusPath)\n                                );\n                            },\n                        }}\n                        linterContext={Gorgon.pushContextStack(\n                            this.props.linterContext,\n                            \"article\"\n                        )}\n                        legacyPerseusLint={this.props.legacyPerseusLint}\n                    />\n                </div>\n            );\n        });\n\n        return (\n            <div className={classes}>\n                {sections}\n            </div>\n        );\n    },\n});\n\n_module_.exports = ArticleRenderer;\nexport default _module_.exports;\n","var _module_ = {\n exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * These are things that widgets should exclude when serializing themselves.\n *\n * The use of this list needs to die. Basically, there are codepaths that\n * blindly serialize the \"props\" of a widget so that it can pass around its\n * info. Unfortunately, props aren't guaranteed to be serializable, and\n * automatically serializing schemaless list of attributes causes issues (e.g.\n * circular JSON structures sometimes).\n *\n * This blacklists things that we know don't need to be serialized.\n */\n_module_.exports = [\n    // standard props \"added\" by react\n    // (technically the renderer still adds them)\n    \"key\",\n    \"ref\",\n    // added by src/renderer.jsx\n    \"containerSizeClass\",\n    \"widgetId\",\n    \"onChange\",\n    \"problemNum\",\n    \"apiOptions\",\n    \"questionCompleted\",\n    \"findWidgets\",\n    // added by src/editor.jsx, for widgets removing themselves\n    // this is soooo not the right place for this, but alas.\n    \"onRemove\",\n    // also added by src/editor.jsx\n    \"id\",\n    // Callbacks and items for interaction handling\n    \"onBlur\",\n    \"onFocus\",\n    \"trackInteraction\",\n    \"keypadElement\",\n];\nexport default _module_.exports;\n","import _widgetPropBlacklistJsx from \"./widget-prop-blacklist.jsx\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar _ = _underscore;\n\nvar WIDGET_PROP_BLACKLIST = _widgetPropBlacklistJsx;\n\nvar EditorJsonify = {\n    serialize: function() {\n        // Omit props that get passed to all widgets\n        return _.omit(this.props, WIDGET_PROP_BLACKLIST);\n    }\n};\n\n_module_.exports = EditorJsonify;\nexport default _module_.exports;\n","\nimport WIDGET_PROP_BLACKLIST from \"./widget-prop-blacklist.jsx\";\nimport _ from \"underscore\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\n\n/**\n * Changeable\n *\n * Adds a this.change() function to a component\n *\n * This.change takes prop changes as parameters, and calls\n * this.props.onChange with the modified props.\n */\n\nconst USAGE = \"Usage:\\n\" +\n            \"  this.change({propName: 5}, callback);\\n\" +\n            \"  this.change(\\\"propName\\\", 5, callback);\\n\" +\n            \"  this.change(\\\"propName\\\")\";\n\n/**\n * Primary helper function for this.change()\n *\n * Takes the parameters in a consistent style, once this.change() has\n * figured out which way it was called.\n */\nconst _changeMultiple = function(component, newProps, callback) {\n    // Omit \"default\" props:\n    // ref and key come from react, and don't actually represent\n    //   the conceptual state of our component\n    // onChange comes from our parent to allow this modification,\n    //   and doesn't conceptually represent the state of our component\n    const currProps = _.omit(component.props, WIDGET_PROP_BLACKLIST);\n    const nextProps = _.extend(currProps, newProps);\n    component.props.onChange(nextProps, callback);\n};\n\n/**\n * Helper function for changing a single prop\n */\nconst _changeSingle = function(component, propName, value, callback) {\n    if (value === undefined) {\n        // If called with a single prop name, return a lambda to change\n        // a single prop on the current object\n        return _.partial(_changeSingle, component, propName);\n    } else {\n        // If called with two values, change a single prop of the\n        // current object\n        const newProps = {};\n        newProps[propName] = value;\n        _changeMultiple(component, newProps, callback);\n    }\n};\n\n/**\n * this.change()\n *\n * Can be called as follows:\n * this.change(newProps, callback);\n *\n * this.change(propName, propValue, callback);\n *\n * this.change(propName) -> returns a lambda that takes a prop value to\n * set and a callback to call after having set that value.\n */\nexport const change = function(newPropsOrSinglePropName, propValue, callback) {\n\n    if (_.isObject(newPropsOrSinglePropName) &&\n            callback === undefined) {\n        // Called with an object of multiple props to change\n        callback = propValue;\n        return _changeMultiple(\n            this,\n            newPropsOrSinglePropName,  // object newProps\n            callback\n        );\n\n    } else if (_.isString(newPropsOrSinglePropName)) {\n        // Called with a string propName of a single prop to change\n        return _changeSingle(\n            this,\n            newPropsOrSinglePropName,  // string propName\n            propValue,\n            callback\n        );\n\n    } else {\n        throw new Error(\"Invalid types sent to this.change(): \" +\n                _.toArray(arguments).join() + \"\\n\" + USAGE);\n    }\n};\n\nexport const propTypes = {\n    onChange: PropTypes.func.isRequired,\n};\n\nexport const ChangeableProps = {\n    onChange: PropTypes.func.isRequired,\n};\n\nconst Changeable = {\n  change: change,\n  propTypes: propTypes,\n}\n\nexport default Changeable;\n","import _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This is the editor for the simple-markdown-tester widget. This is what shows\n * up on the left side of the screen in the demo. Only the question writer\n * sees this.\n */\nvar React = _react;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar TextArea = createReactClass({\n    render: function() {\n        return (\n            <textarea\n                ref=\"input\"\n                value={this.props.value || \"\"}\n                onChange={this.changeValue}\n            />\n        );\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    changeValue: function(e) {\n        // Translating from the js event e to the value\n        // of the textbox to send to onChange\n        this.props.onChange(e.target.value);\n    },\n});\n\nvar SimpleMarkdownTesterEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n        };\n    },\n\n    render: function() {\n        return (\n            <div>\n                <label>\n                    <div>Simple markdown contents:</div>\n                    <div>\n                        <TextArea\n                            value={this.props.value}\n                            onChange={this.change(\"value\")}\n                            ref=\"input\"\n                        />\n                    </div>\n                </label>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = SimpleMarkdownTesterEditor;\nexport default _module_.exports;\n","import _perseusMarkdownJsx from \"../perseus-markdown.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\n\nvar PerseusMarkdown = _perseusMarkdownJsx;\nvar mdParse = PerseusMarkdown.parse;\nvar mdOutput = PerseusMarkdown.basicOutput;\n\nvar SimpleMarkdownTester = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        value: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    toJSON: function() {\n        return {};\n    },\n\n    render: function() {\n        var parsed = mdParse(this.props.value);\n        var output = mdOutput(parsed);\n        return (\n            <div>\n                {output}\n            </div>\n        );\n    },\n\n    /**\n     * Widgets that are focusable should add a focus method that returns\n     * true if focusing succeeded. The first such widget found will be\n     * focused on page load.\n     */\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    /**\n     * simpleValidate is called for grading. Rubric is the result of calling\n     * toJSON() on the editor that created this widget.\n     *\n     * Should return an object representing the grading result, such as\n     * {\n     *     type: \"points\",\n     *     earned: 1,\n     *     total: 1,\n     *     message: null\n     * }\n     */\n    simpleValidate: function(rubric) {\n        return SimpleMarkdownTester.validate(this.toJSON(), rubric);\n    },\n});\n\n/**\n * This is the widget's grading function\n */\n_.extend(SimpleMarkdownTester, {\n    /**\n     * simpleValidate generally defers to this function\n     *\n     * state is usually the result of toJSON on the widget\n     * rubric is the result of calling toJSON() on the editor\n     */\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n/**\n * For this widget to work, we must require() this file in src/all-widgets.js\n */\n_module_.exports = {\n    name: \"simple-markdown-tester\",\n    displayName: \"Simple Markdown Tester\",\n    hidden: true, // Hides this widget from the Perseus.Editor widget select\n    widget: SimpleMarkdownTester,\n    transform: _.identity,\n};\nexport default _module_.exports;\n","import _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\n/**\n * This is the widget's editor. This is what shows up on the left side\n * of the screen in the demo. Only the question writer sees this.\n */\nvar ExampleWidgetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correct: \"\",\n        };\n    },\n\n    handleAnswerChange: function(event) {\n        this.change({\n            correct: event.target.value,\n        });\n    },\n\n    render: function() {\n        return (\n            <div>\n                <label>\n                    Correct answer:\n                    <input\n                        value={this.props.correct}\n                        onChange={this.handleAnswerChange}\n                        ref=\"input\"\n                    />\n                </label>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = ExampleWidgetEditor;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This is a simple number-entry widget\n * It is not as powerful as number-input, but has a simpler, more\n * representative structure as an example widget, and is easier to\n * test new ideas on.\n *\n * TODO(jack): Add more comments\n */\n\nvar React = _react;\nvar Changeable = _mixinsChangeableJsx;\nvar _ = _underscore;\n\nvar TextInput = createReactClass({\n    render: function() {\n        return (\n            <input\n                ref=\"input\"\n                value={this.props.value || \"\"}\n                onChange={this.changeValue}\n            />\n        );\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    changeValue: function(e) {\n        // Translating from the js event e to the value\n        // of the textbox to send to onChange\n        this.props.onChange(e.target.value);\n    },\n});\n\n/**\n * This is the widget's renderer. It shows up in the right column\n * in the demo, and is what is visible to users, and where\n * users enter their answers.\n */\nvar ExampleWidget = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        value: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n        };\n    },\n\n    /**\n     * Tell our parent to update our props.\n     */\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <TextInput\n                ref=\"input\"\n                value={this.props.value}\n                onChange={this.change(\"value\")}\n            />\n        );\n    },\n\n    getUserInput: function() {\n        return this.props.value;\n    },\n\n    /**\n     * Widgets that are focusable should add a focus method that returns\n     * true if focusing succeeded. The first such widget found will be\n     * focused on page load.\n     */\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    /**\n     * simpleValidate is called for grading. Rubric is the result of calling\n     * getUserInput() on the editor that created this widget.\n     *\n     * Should return an object representing the grading result, such as\n     * {\n     *     type: \"points\",\n     *     earned: 1,\n     *     total: 1,\n     *     message: null\n     * }\n     */\n    simpleValidate: function(rubric) {\n        return ExampleWidget.validate(this.getUserInput(), rubric);\n    },\n});\n\n/**\n * This is the widget's grading function\n */\n_.extend(ExampleWidget, {\n    /**\n     * simpleValidate generally defers to this function\n     *\n     * value is usually the result of getUserInput on the widget\n     * rubric is the result of calling serialize() on the editor\n     */\n    validate: function(value, rubric) {\n        if (value === \"\") {\n            return {\n                type: \"invalid\",\n                message:\n                    \"It looks like you haven't answered all of the \" +\n                    \"question yet.\",\n            };\n        } else if (value === rubric.correct) {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n/**\n * For this widget to work, we must require() this file in src/all-widgets.js\n */\n_module_.exports = {\n    name: \"example-widget\",\n    displayName: \"Example Widget\",\n\n    // Tell the renderer what type of `display:` style we would like\n    // for the component wrapping this one.\n    defaultAlignment: \"inline-block\",\n\n    hidden: true, // Hides this widget from the Perseus.Editor widget select\n    widget: ExampleWidget,\n};\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _widgetPropBlacklistJsx from \"./widget-prop-blacklist.jsx\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* Free implementation of getUserInput. This should be used sparingly, since it\n * just returns all the widget's props rather than picking out those which were\n * input by the user.\n */\nvar WIDGET_PROP_BLACKLIST = _widgetPropBlacklistJsx;\nconst _ = _underscore;\n\nvar WidgetJsonifyDeprecated = {\n    getUserInput: function() {\n        // Omit props that get passed to all widgets\n        return _.omit(this.props, WIDGET_PROP_BLACKLIST);\n    }\n};\n\n_module_.exports = WidgetJsonifyDeprecated;\nexport default _module_.exports;\n","import _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _utilJs from \"../util.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, no-unused-vars, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This is an example graphie-using widget\n *\n * TODO(jack): Add more comments\n */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar Util = _utilJs;\nvar Changeable = _mixinsChangeableJsx;\nvar WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\n\nvar Graphie = _componentsGraphieJsx;\nvar MovablePoint = Graphie.MovablePoint;\n\nvar knumber = _kmath.number;\nvar kpoint = _kmath2.point;\n\n/**\n * This is the widget's renderer. It shows up in the right column\n * in the demo, and is what is visible to users, and where\n * users enter their answers.\n */\nvar ExampleGraphieWidget = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n\n        graph: PropTypes.object.isRequired,\n        coord: PropTypes.arrayOf(PropTypes.number),\n    },\n\n    getDefaultProps: function() {\n        return {\n            // We want to allow our coord to be null to test if the\n            // user has interacted with this widget yet when grading it\n            coord: null,\n            graph: {\n                box: [400, 400],\n                labels: [\"x\", \"y\"],\n                range: [[-10, 10], [-10, 10]],\n                step: [1, 1],\n                gridStep: [1, 1],\n                valid: true,\n                backgroundImage: null,\n                markings: \"grid\",\n                showProtractor: false,\n            },\n        };\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    render: function() {\n        return (\n            <Graphie\n                ref=\"graphie\"\n                box={this.props.graph.box}\n                range={this.props.graph.range}\n                options={this.props.graph}\n                setup={this.setupGraphie}\n                setDrawingAreaAvailable={\n                    this.props.apiOptions.setDrawingAreaAvailable\n                }\n            >\n                <MovablePoint\n                    pointSize={5}\n                    coord={this.props.coord || [0, 0]}\n                    constraints={[\n                        MovablePoint.constraints.snap(),\n                        MovablePoint.constraints.bound(),\n                    ]}\n                    onMove={this.movePoint}\n                />\n            </Graphie>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    movePoint: function(newCoord) {\n        this.change({\n            coord: newCoord,\n        });\n    },\n\n    _getGridConfig: function(options) {\n        return _.map(options.step, function(step, i) {\n            return Util.gridDimensionConfig(\n                step,\n                options.range[i],\n                options.box[i],\n                options.gridStep[i]\n            );\n        });\n    },\n\n    setupGraphie: function(graphie, options) {\n        var gridConfig = this._getGridConfig(options);\n        graphie.graphInit({\n            range: options.range,\n            scale: _.pluck(gridConfig, \"scale\"),\n            axisArrows: \"<->\",\n            labelFormat: function(s) {\n                return \"\\\\small{\" + s + \"}\";\n            },\n            gridStep: options.gridStep,\n            tickStep: _.pluck(gridConfig, \"tickStep\"),\n            labelStep: 1,\n            unityLabels: _.pluck(gridConfig, \"unityLabel\"),\n        });\n        graphie.label([0, options.range[1][1]], options.labels[1], \"above\");\n    },\n\n    simpleValidate: function(rubric) {\n        return ExampleGraphieWidget.validate(this.getUserInput(), rubric);\n    },\n});\n\n/**\n * This is the widget's grading function\n */\n_.extend(ExampleGraphieWidget, {\n    validate: function(state, rubric) {\n        if (state.coord == null) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else if (kpoint.equal(state.coord, rubric.correct)) {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n/**\n * For this widget to work, we must export it.\n * We also must require() this file in src/all-widgets.js\n */\n_module_.exports = {\n    name: \"example-graphie-widget\",\n    displayName: \"Example Graphie Widget\",\n    hidden: true, // Hides this widget from the Perseus.Editor widget select\n    widget: ExampleGraphieWidget,\n};\nexport default _module_.exports;\n","import _exampleGraphieWidgetJsx from \"./example-graphie-widget.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar ExampleGraphieWidget = _exampleGraphieWidgetJsx.widget;\n\n/**\n * This is the widget's editor. This is what shows up on the left side\n * of the screen in the demo page. Only the question writer sees this.\n */\nvar ExampleGraphieWidgetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correct: [4, 4],\n            graph: {\n                box: [340, 340],\n                labels: [\"x\", \"y\"],\n                range: [[-10, 10], [-10, 10]],\n                step: [1, 1],\n                gridStep: [1, 1],\n                valid: true,\n                backgroundImage: null,\n                markings: \"grid\",\n                showProtractor: false,\n            },\n        };\n    },\n\n    render: function() {\n        return (\n            <div>\n                <ExampleGraphieWidget\n                    graph={this.props.graph}\n                    coord={this.props.correct}\n                    onChange={this.handleChange}\n                    apiOptions={this.props.apiOptions}\n                />\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handleChange: function(newProps) {\n        if (newProps.coord) {\n            this.change({\n                correct: newProps.coord,\n            });\n        }\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = ExampleGraphieWidgetEditor;\nexport default _module_.exports;\n","import _reactComponentsInfoTipJsx from \"react-components/info-tip.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A wrapper around react-components/info-tip.jsx that can be rendered on the\n * server without causing a checksum mismatch on the client.\n * (RCSS generates classnames with a randomSuffix, which ensures that any\n * two sets of generated classnames will not match.)\n */\n\nconst React = _react;\n\nconst ReactComponentsInfoTip = _reactComponentsInfoTipJsx;\n\nconst InfoTip = createReactClass({\n    getInitialState: function() {\n        return {\n            didMount: false,\n        };\n    },\n\n    componentDidMount: function() {\n        /* eslint-disable react/no-did-mount-set-state */\n        this.setState({didMount: true});\n        /* eslint-enable react/no-did-mount-set-state */\n    },\n\n    render: function() {\n        if (this.state.didMount) {\n            return <ReactComponentsInfoTip {...this.props} />;\n        } else {\n            return <div />;\n        }\n    },\n});\n\n_module_.exports = InfoTip;\nexport default _module_.exports;\n","import _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst BlurInput = _reactComponentsBlurInputJsx;\n\nconst KA_VIDEO_URL = /khanacademy\\.org\\/.*\\/v\\/(.*)$/;\n\n/**\n * Turns Khan Academy URLs into the KA slugs, if possible. Any other URLs are\n * returned unchanged.\n */\nfunction getSlugFromUrl(url) {\n    var match = KA_VIDEO_URL.exec(url);\n    if (match) {\n        return match[1];\n    }\n    return url;\n}\n\n/**\n * This is the main editor for this widget, to specify all the options.\n */\nconst VideoEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        location: PropTypes.string,\n        onChange: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            location: \"\",\n        };\n    },\n\n    _handleUrlChange: function(url) {\n        this.props.onChange({location: getSlugFromUrl(url)});\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <label>\n                    URL or KA Video Slug:{\" \"}\n                    <BlurInput\n                        name=\"location\"\n                        value={this.props.location}\n                        style={{width: 290}}\n                        onChange={this._handleUrlChange}\n                    />\n                    <InfoTip>\n                        You can paste any URL here. KA video URLs will be\n                        converted to just the slug.\n                    </InfoTip>\n                </label>\n            </div>\n        );\n    },\n});\n\n_module_.exports = VideoEditor;\nexport default _module_.exports;\n","import _componentsFixedToResponsiveJsx from \"../components/fixed-to-responsive.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This is a video widget for embedding videos in articles.\n */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar FixedToResponsive = _componentsFixedToResponsiveJsx;\n\n// Current default is 720p, based on the typical videos we upload currently\nvar DEFAULT_WIDTH = 1280;\nvar DEFAULT_HEIGHT = 720;\n\nvar KA_EMBED =\n    \"https://{hostname}/embed_video?slug={slug}\" + \"&internal_video_only=1\";\nvar IS_URL = /^https?:\\/\\//;\nvar IS_KA_SITE = /khanacademy\\.org/;\n\n/**\n * Video renderer.\n */\nvar Video = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        alignment: PropTypes.string,\n        location: PropTypes.string,\n    },\n\n    getUserInput: function() {\n        return null;\n    },\n\n    simpleValidate: function(rubric) {\n        return Video.validate(null, rubric);\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        var location = this.props.location;\n        if (!location) {\n            return <div />;\n        }\n\n        var url;\n\n        if (IS_URL.test(location)) {\n            url = location;\n        } else {\n            url = KA_EMBED.replace(\"{slug}\", location);\n            var currentHostname = document.location.hostname;\n            var embedHostname = \"www.khanacademy.org\";\n            if (IS_KA_SITE.test(currentHostname)) {\n                embedHostname = currentHostname;\n            }\n            url = url.replace(\"{hostname}\", embedHostname);\n        }\n\n        return (\n            <FixedToResponsive // @Nolint this is fine, the linter is wrong\n                width={DEFAULT_WIDTH}\n                height={DEFAULT_HEIGHT}\n                // The key is here for the benefit of the editor, to ensure that\n                // any changes cause a re-rendering of the frame.\n                key={location + this.props.alignment}\n            >\n                <iframe\n                    className=\"perseus-video-widget\"\n                    sandbox=\"allow-same-origin allow-scripts\"\n                    width={DEFAULT_WIDTH}\n                    height={DEFAULT_HEIGHT}\n                    src={url}\n                    allowFullScreen={true}\n                />\n            </FixedToResponsive>\n        );\n    },\n});\n\n/**\n * This is the widget's grading function.\n * Points for videos are tallied by the embedded video itself, in the case\n * of Khan Academy videos.\n */\n_.extend(Video, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"video\",\n    displayName: \"Video\",\n    defaultAlignment: \"block\",\n    supportedAlignments: [\"block\", \"float-left\", \"float-right\", \"full-width\"],\n    widget: Video,\n};\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable eqeqeq, indent, keyword-spacing, max-len, no-mixed-spaces-and-tabs, no-unused-vars, no-var, semi, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n/*\n * A class for formatting number to significant digits.\n * Copyright (C) 2001 Stephen Ostermiller\n * http://ostermiller.org/contact.pl?regarding?JavaScript+Significant+Figures\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n */\n\n/**\n * An object tho both scans floating points to\n * determine the number of significant figures.\n * and can display a floating point using any number\n * of significant figures.\n *\n * @param s A string representation of a floating point.\n */\nexport function SignificantFigures(s) {\n    this.order = parseOrder(s);\n    this.mantissa = parseMantissa(s);\n    this.positive = parseSign(s);\n\n    /**\n     * Get the number of significant figures this object uses.\n     * Leading zeros are not significant.  Traling zeros up to\n     * and after the decimal point are significant.\n     * Significant figures is good to know when the number is\n     * used in multiplication.\n     *\n     * @return the number of significant figures.\n     */\n    this.sigFigs = this.mantissa.length;\n\n    /**\n     * Get the least significant decimal this object uses.\n     * This is useful to know if a number is being used\n     * in addition.\n     * 400 - 2 the hundreds place (10^2) is the least significant decimal.\n     * 75 - 0 the ones place (10^0) is the least significant decimal.\n     * .543 - -3 the 1/1000's place (10^-3) is the least significant decimal.\n     *\n     * @return an integer representing the least significant decimal place.\n     */\n    this.sigDecs = this.order - this.mantissa.length;\n}\n\n/**\n * Format a floating point for display using the specified\n * number of significant figures and least significant decimal.\n * Scientific notation may used by this method if this\n * object is very small, very large, has many significant\n * figures, or the number of significant figures would be\n * ambiguous in the output if scientific notation were not\n * used.\n *\n * @param f A floating point number that should be displayed\n * @param sigFigs desired number of significant figures (integer).\n * @param sigDecs the least significant decimal place (integer).\n * @param scientific true iff scientific notation should always be used.\n * @return a string of this object formatted correctly.\n */\nexport function displaySigFigs(f, sigFigs, sigDecs, scientific) {\n    var s = \"\" + f;\n    var order = parseOrder(s);\n    var mantissa = parseMantissa(s);\n    var positive = parseSign(s);\n    var add;\n    var decAdd;\n    var sigAdd;\n    var zeroScientific = false;\n    if (f == 0 || mantissa == \"\" || mantissa == \"0\") {\n        mantissa = \"\";\n        for (i = 0; i < sigFigs; i++) {\n            mantissa += \"0\";\n        }\n        order = sigFigs + sigDecs;\n        if (sigDecs < 0 && -sigDecs >= sigFigs) {\n            zeroScientific = true;\n        }\n    } else {\n        decAdd = order - mantissa.length - sigDecs;\n        sigAdd = sigFigs - mantissa.length;\n        add = Math.min(sigAdd, decAdd);\n        if (add < 0) {\n            var rounded = round(mantissa, -add);\n            if (rounded.length > mantissa.length + add) {\n                order++;\n                if (decAdd > sigAdd) {\n                    rounded = round(rounded, 1);\n                }\n            }\n            mantissa = rounded;\n        } else if (add > 0) {\n            for (i = 0; i < add; i++) {\n                mantissa += \"0\";\n            }\n        }\n        if (mantissa == \"\" || mantissa == \"0\") {\n            mantissa = \"0\";\n            positive = true;\n            order = 1 + sigDecs;\n            if (order != 0) {\n                zeroScientific = true;\n            }\n        }\n    }\n    var useScientific =\n        scientific ||\n        mantissa.length > 20 ||\n        order > 4 ||\n        order < -2 ||\n        (order - mantissa.length > 0 && trailingZeros(mantissa) > 0) ||\n        zeroScientific;\n    var returnVal = \"\";\n    if (!positive) {\n        returnVal += \"-\";\n    }\n    if (useScientific) {\n        returnVal += mantissa.charAt(0);\n        if (mantissa.length > 1) {\n            returnVal += \".\" + mantissa.substring(1, mantissa.length);\n        }\n        if (order - 1 != 0) {\n            returnVal += \" x 10^\" + (order - 1);\n        }\n    } else {\n        var wholePart = \"\";\n        var fractPart = \"\";\n        var needDot = true;\n        if (order > 0) {\n            if (mantissa.length > order) {\n                wholePart = mantissa.substring(0, order);\n                fractPart = mantissa.substring(order, mantissa.length);\n            } else {\n                wholePart = mantissa;\n                needDot = trailingZeros(mantissa) != 0;\n                for (var i = 0; i < order - mantissa.length; i++) {\n                    wholePart += \"0\";\n                }\n            }\n        } else {\n            for (i = 0; i < -order; i++) {\n                fractPart += \"0\";\n            }\n            fractPart += mantissa;\n        }\n        returnVal +=\n            (wholePart == \"\" ? \"0\" : wholePart) +\n            (needDot ? \".\" : \"\") +\n            fractPart;\n    }\n    return returnVal;\n}\n\n/**\n * Count the significant trailing zeros on this object.\n *\n * @return the number of trailing zeros\n */\nfunction trailingZeros(mantissa) {\n    var zeros = 0;\n    for (var i = mantissa.length - 1; i >= 0; i--) {\n        var c = mantissa.charAt(i);\n        if (c == \"0\") {\n            zeros++;\n        } else {\n            return zeros;\n        }\n    }\n    return zeros;\n}\n\n/**\n * Parse a string representation of a floating point\n * and pull out the sign.\n *\n * @param s the string representation of a floating point.\n * @return true iff this is a positive number\n */\nfunction parseSign(s) {\n    var beginning = true;\n    var seenDot = false;\n    var seenSomething = false;\n    var zeros = \"\";\n    var leadZeros = \"\";\n    var all = \"\";\n    var decPlaces = 0;\n    var totalDecs = 0;\n    var pos = true;\n    for (var i = 0; i < s.length; i++) {\n        var c = s.charAt(i);\n        if (c >= \"1\" && c <= \"9\") {\n            all += zeros + c;\n            zeros = \"\";\n            seenSomething = true;\n            if (!seenDot) {\n                totalDecs++;\n                decPlaces++;\n            }\n            beginning = false;\n        } else if (c == \"0\") {\n            if (seenDot) {\n                if (seenSomething) {\n                    all += zeros + c;\n                    zeros = \"\";\n                } else {\n                    leadZeros += c;\n                    decPlaces--;\n                }\n            } else {\n                totalDecs++;\n                if (seenSomething) {\n                    leadZeros += c;\n                    decPlaces++;\n                    zeros += c;\n                } else {\n                    leadZeros += c;\n                }\n            }\n            beginning = false;\n        } else if (!seenDot && c == \".\") {\n            all += zeros;\n            zeros = \"\";\n            seenDot = true;\n            beginning = false;\n        } else if (c == \"e\" || (c == \"E\" && i + 1 < s.length)) {\n            var raised = parseInt(s.substring(i + 1, s.length));\n            decPlaces += raised;\n            totalDecs += raised;\n            i = s.length;\n        } else if (beginning && (c == \"+\" || c == \"-\")) {\n            if (c == \"-\") {\n                pos = !pos;\n            }\n        }\n    }\n    if (all == \"\") {\n        return true;\n    } else {\n        return pos;\n    }\n}\n\n/**\n * Parse a string representation of a floating point\n * and pull out the mantissa.\n *\n * @param s the string representation of a floating point.\n * @return the mantissa of this number.\n */\nfunction parseMantissa(s) {\n    var beginning = true;\n    var seenDot = false;\n    var seenSomething = false;\n    var zeros = \"\";\n    var leadZeros = \"\";\n    var all = \"\";\n    var decPlaces = 0;\n    var totalDecs = 0;\n    var pos = true;\n    for (var i = 0; i < s.length; i++) {\n        var c = s.charAt(i);\n        if (c >= \"1\" && c <= \"9\") {\n            all += zeros + c;\n            zeros = \"\";\n            seenSomething = true;\n            if (!seenDot) {\n                totalDecs++;\n                decPlaces++;\n            }\n            beginning = false;\n        } else if (c == \"0\") {\n            if (seenDot) {\n                if (seenSomething) {\n                    all += zeros + c;\n                    zeros = \"\";\n                } else {\n                    leadZeros += c;\n                    decPlaces--;\n                }\n            } else {\n                totalDecs++;\n                if (seenSomething) {\n                    leadZeros += c;\n                    decPlaces++;\n                    zeros += c;\n                } else {\n                    leadZeros += c;\n                }\n            }\n            beginning = false;\n        } else if (!seenDot && c == \".\") {\n            all += zeros;\n            zeros = \"\";\n            seenDot = true;\n            beginning = false;\n        } else if (c == \"e\" || (c == \"E\" && i + 1 < s.length)) {\n            var raised = parseInt(s.substring(i + 1, s.length));\n            decPlaces += raised;\n            totalDecs += raised;\n            i = s.length;\n        } else if (beginning && (c == \"+\" || c == \"-\")) {\n            if (c == \"-\") {\n                pos = !pos;\n            }\n        }\n    }\n    if (all == \"\") {\n        return leadZeros;\n    } else {\n        return all;\n    }\n}\n\n/**\n * Parse a string representation of a floating point\n * and pull out the exponent.\n *\n * @param s the string representation of a floating point.\n * @return (integer) the number after the e.\n */\nfunction parseOrder(s) {\n    var beginning = true;\n    var seenDot = false;\n    var seenSomething = false;\n    var zeros = \"\";\n    var leadZeros = \"\";\n    var all = \"\";\n    var decPlaces = 0;\n    var totalDecs = 0;\n    var pos = true;\n    for (var i = 0; i < s.length; i++) {\n        var c = s.charAt(i);\n        if (c >= \"1\" && c <= \"9\") {\n            all += zeros + c;\n            zeros = \"\";\n            seenSomething = true;\n            if (!seenDot) {\n                totalDecs++;\n                decPlaces++;\n            }\n            beginning = false;\n        } else if (c == \"0\") {\n            if (seenDot) {\n                if (seenSomething) {\n                    all += zeros + c;\n                    zeros = \"\";\n                } else {\n                    leadZeros += c;\n                    decPlaces--;\n                }\n            } else {\n                totalDecs++;\n                if (seenSomething) {\n                    leadZeros += c;\n                    decPlaces++;\n                    zeros += c;\n                } else {\n                    leadZeros += c;\n                }\n            }\n            beginning = false;\n        } else if (!seenDot && c == \".\") {\n            all += zeros;\n            zeros = \"\";\n            seenDot = true;\n            beginning = false;\n        } else if (c == \"e\" || (c == \"E\" && i + 1 < s.length)) {\n            var raised = parseInt(s.substring(i + 1, s.length));\n            decPlaces += raised;\n            totalDecs += raised;\n            i = s.length;\n        } else if (beginning && (c == \"+\" || c == \"-\")) {\n            if (c == \"-\") {\n                pos = !pos;\n            }\n        }\n    }\n    if (all == \"\") {\n        return totalDecs;\n    } else {\n        return decPlaces;\n    }\n}\n\n/**\n * Remove the specified number of digits from string by\n * rounding.  Proper rounding rules for scientific purposes\n * are followed.\n * This method may cause an extra significant figure\n * to be added to the number.  For example, if 999999\n * were rounded, A one would carry over and become\n * a significant figure.  Those who call this method\n * should check for this and call round again if needed.\n *\n * @param mantissa A string representing an whole number of arbitrary length.\n * @param digits A number of digits to remove\n * @return A string represted the rounded version of mantissa\n */\nfunction round(mantissa, digits) {\n    var last = mantissa.length - digits - 1;\n    if (last < 0) {\n        return \"\";\n    } else if (last >= mantissa.length - 1) {\n        return mantissa;\n    } else {\n        var nextToLast = mantissa.charAt(last + 1);\n        var lastChar = mantissa.charAt(last);\n        var roundUp = false;\n        if (nextToLast > \"5\") {\n            roundUp = true;\n        } else if (nextToLast == \"5\") {\n            for (var j = last + 2; j < mantissa.length; j++) {\n                if (mantissa.charAt(j) != \"0\") {\n                    roundUp = true;\n                }\n            }\n            if (lastChar % 2 == 1) {\n                roundUp = true;\n            }\n        }\n        var result = \"\";\n        for (var i = last; i >= 0; i--) {\n            var c = mantissa.charAt(i);\n            if (roundUp) {\n                var nextChar;\n                if (c == \"9\") {\n                    nextChar = \"0\";\n                } else {\n                    switch (c) {\n                        case \"0\":\n                            nextChar = \"1\";\n                            break;\n                        case \"1\":\n                            nextChar = \"2\";\n                            break;\n                        case \"2\":\n                            nextChar = \"3\";\n                            break;\n                        case \"3\":\n                            nextChar = \"4\";\n                            break;\n                        case \"4\":\n                            nextChar = \"5\";\n                            break;\n                        case \"5\":\n                            nextChar = \"6\";\n                            break;\n                        case \"6\":\n                            nextChar = \"7\";\n                            break;\n                        case \"7\":\n                            nextChar = \"8\";\n                            break;\n                        case \"8\":\n                            nextChar = \"9\";\n                            break;\n                    }\n                    roundUp = false;\n                }\n                result = nextChar + result;\n            } else {\n                result = c + result;\n            }\n        }\n        if (roundUp) {\n            result = \"1\" + result;\n        }\n        return result;\n    }\n}\n\nexport default {\n    SignificantFigures,\n    displaySigFigs,\n};\n","import _utilMathJs from \"../util/math.js\";\nimport _kmath from \"kmath\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/prop-types, react/sort-comp */\n\nconst classNames = _classnames;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst firstNumericalParse = _utilJs.firstNumericalParse;\nconst captureScratchpadTouchStart = _utilJs2\n    .captureScratchpadTouchStart;\nconst knumber = _kmath.number;\nconst KhanMath = _utilMathJs;\n\nconst toNumericString = KhanMath.toNumericString;\nconst getNumericFormat = KhanMath.getNumericFormat;\n\n/* An input box that accepts only numeric strings\n *\n * Calls onChange(value, format) for valid numbers.\n * Reverts to the current value onBlur or on [ENTER],\n *   but maintains the format (i.e. 3/2, 1 1/2, 150%)\n * Accepts empty input and sends it to onChange as null\n *   if no numeric placeholder is set.\n * If given a checkValidity function, will turn\n *   the background/outline red when invalid\n * If useArrowKeys is set to true, up/down arrows will\n *   increment/decrement integers\n * Optionally takes a size (\"mini\", \"small\", \"normal\")\n */\nconst NumberInput = createReactClass({\n    propTypes: {\n        value: PropTypes.number,\n        format: PropTypes.string,\n        placeholder: PropTypes.oneOfType([\n            PropTypes.string,\n            PropTypes.number,\n        ]),\n        onChange: PropTypes.func.isRequired,\n        onFormatChange: PropTypes.func,\n        checkValidity: PropTypes.func,\n        size: PropTypes.string,\n        label: PropTypes.oneOf([\"put your labels outside your inputs!\"]),\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: null,\n            placeholder: null,\n            format: null,\n            onFormatChange: () => null,\n            checkValidity: () => true,\n            useArrowKeys: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            format: this.props.format,\n        };\n    },\n\n    render: function() {\n        let classes = classNames({\n            \"number-input\": true,\n            \"invalid-input\": !this._checkValidity(this.props.value),\n            mini: this.props.size === \"mini\",\n            small: this.props.size === \"small\",\n            normal: this.props.size === \"normal\",\n        });\n        if (this.props.className != null) {\n            classes = classes + \" \" + this.props.className;\n        }\n\n        return (\n            <input\n                {...this.props}\n                className={classes}\n                type=\"text\"\n                ref=\"input\"\n                onChange={this._handleChange}\n                onFocus={this._handleFocus}\n                onBlur={this._handleBlur}\n                onKeyPress={this._handleBlur}\n                onKeyDown={this._onKeyDown}\n                onTouchStart={captureScratchpadTouchStart}\n                defaultValue={toNumericString(\n                    this.props.value,\n                    this.state.format\n                )}\n                value={undefined}\n            />\n        );\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (!knumber.equal(this.getValue(), this.props.value)) {\n            this._setValue(this.props.value, this.state.format);\n        }\n    },\n\n    /* Return the current \"value\" of this input\n     * If empty, it returns the placeholder (if it is a number) or null\n     */\n    getValue: function() {\n        return this.parseInputValue(\n            ReactDOM.findDOMNode(this.refs.input).value\n        );\n    },\n\n    /* Return the current string value of this input */\n    getStringValue: function() {\n        return ReactDOM.findDOMNode(this.refs.input).value.toString();\n    },\n\n    parseInputValue: function(value) {\n        if (value === \"\") {\n            const placeholder = this.props.placeholder;\n            return _.isFinite(placeholder) ? +placeholder : null;\n        } else {\n            const result = firstNumericalParse(value);\n            return _.isFinite(result) ? result : this.props.value;\n        }\n    },\n\n    /* Set text input focus to this input */\n    focus: function() {\n        ReactDOM.findDOMNode(this.refs.input).focus();\n        this._handleFocus();\n    },\n\n    blur: function() {\n        ReactDOM.findDOMNode(this.refs.input).blur();\n        this._handleBlur();\n    },\n\n    setSelectionRange: function(selectionStart, selectionEnd) {\n        ReactDOM.findDOMNode(this).setSelectionRange(\n            selectionStart,\n            selectionEnd\n        );\n    },\n\n    getSelectionStart: function() {\n        return ReactDOM.findDOMNode(this).selectionStart;\n    },\n\n    getSelectionEnd: function() {\n        return ReactDOM.findDOMNode(this).selectionEnd;\n    },\n\n    _checkValidity: function(value) {\n        if (value == null) {\n            return true;\n        }\n\n        const val = firstNumericalParse(value);\n        const checkValidity = this.props.checkValidity;\n\n        return _.isFinite(val) && checkValidity(val);\n    },\n\n    _handleChange: function(e) {\n        const text = e.target.value;\n        const value = this.parseInputValue(text);\n        const format = getNumericFormat(text);\n\n        this.props.onChange(value);\n        if (format) {\n            this.props.onFormatChange(value, format);\n            this.setState({format: format});\n        }\n    },\n\n    _handleFocus: function() {\n        if (this.props.onFocus) {\n            this.props.onFocus();\n        }\n    },\n\n    _handleBlur: function(e) {\n        // Only continue on blur or \"enter\"\n        if (e && e.type === \"keypress\" && e.keyCode !== 13) {\n            return;\n        }\n\n        this._setValue(this.props.value, this.state.format);\n        if (this.props.onBlur) {\n            this.props.onBlur();\n        }\n    },\n\n    _onKeyDown: function(e) {\n        if (this.props.onKeyDown) {\n            this.props.onKeyDown(e);\n        }\n\n        if (\n            !this.props.useArrowKeys ||\n            !_.contains([\"ArrowUp\", \"ArrowDown\"], e.key)\n        ) {\n            return;\n        }\n\n        let val = this.getValue();\n        if (val !== Math.floor(val)) {\n            return; // bail if not an integer\n        }\n\n        if (e.key === \"ArrowUp\") {\n            val = val + 1;\n        } else if (e.key === \"ArrowDown\") {\n            val = val - 1;\n        }\n\n        if (this._checkValidity(val)) {\n            this.props.onChange(val);\n        }\n    },\n\n    _setValue: function(val, format) {\n        $(ReactDOM.findDOMNode(this.refs.input)).val(\n            toNumericString(val, format)\n        );\n    },\n});\n\n_module_.exports = NumberInput;\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport { displaySigFigs } from \"../sigfigs.jsx\";\nimport { iconOk, iconRemove } from \"../icon-paths.js\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n// TODO(joel): teach KAS how to accept an answer only if it's expressed in\n// terms of a certain type.\n// TODO(joel): Allow sigfigs within a range rather than an exact expected\n// value?\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst InlineIcon = _componentsInlineIconJsx;\nconst NumberInput = _componentsNumberInputJsx;\n\nconst ALL = \"all\";\nconst SOME = \"some\";\nconst MAX_SIGFIGS = 10;\n\nvar sigfigPrint = function(num, sigfigs) {\n    return displaySigFigs(num, sigfigs, -MAX_SIGFIGS, false);\n};\n\n// Extract the primitive units from a unit expression. This first simplifies\n// `expr` to a `Mul` like \"5 kg m / s^2\" then removes the first term.\nvar primUnits = function(expr) {\n    return expr.simplify().asMul().partition()[1].flatten().simplify();\n};\n\n// Show the name of a unit and whether it's recognized by KAS.\n//\n// In the future I plan for this to show an example of a thing that would be\n// accepted in that unit.\nvar UnitExample = createReactClass({\n    render: function() {\n        var icon;\n        if (this.state.valid) {\n            icon = (\n                <span>\n                    <span className=\"unit-example-okay\">\n                        <InlineIcon {...iconOk} />\n                    </span>\n                    {this.state.solvedExample}\n                </span>\n            );\n        } else {\n            icon = (\n                <span className=\"unit-example-not-okay\">\n                    <InlineIcon {...iconRemove} />\n                </span>\n            );\n        }\n\n        return (\n            <div>\n                {icon} {this.props.name}\n            </div>\n        );\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this._checkValidity(nextProps);\n    },\n\n    componentWillMount: function() {\n        this._checkValidity(this.props);\n    },\n\n    _checkValidity: function(\n        {\n            name,\n            original,\n            sigfigs\n        }\n    ) {\n        var parseResult = KAS.unitParse(name);\n        var solvedExample = \"\";\n\n        // A unit is valid if it parses and is equivalent to the original.\n        var valid = true;\n\n        if (parseResult.parsed && original) {\n            var x = new KAS.Var(\"x\");\n            var {unit} = parseResult;\n            var equality = new KAS.Eq(original, \"=\", new KAS.Mul(x, unit));\n            try {\n                var answer = equality.solveLinearEquationForVariable(x);\n\n                // The third parameter is the least significant decimal place.\n                // I.e. the index of the last place you care about\n                // (543210.(-1)(-2)(-3) etc). We use -10 because that should\n                // always be safe since we only care up to maximum 10 decimal\n                // places.\n                solvedExample = sigfigPrint(answer.eval(), sigfigs);\n\n                valid = KAS.compare(primUnits(original), primUnits(unit)).equal;\n            } catch (e) {\n                valid = false;\n            }\n        } else {\n            valid = false;\n        }\n\n        this.setState({\n            valid,\n            solvedExample,\n        });\n    },\n});\n\nconst UnitInputEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        value: PropTypes.string,\n        acceptingUnits: PropTypes.arrayOf(PropTypes.string),\n        accepting: PropTypes.oneOf([ALL, SOME]),\n        sigfigs: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"5x10^5 kg m / s^2\",\n            accepting: ALL,\n            sigfigs: 3,\n        };\n    },\n\n    render: function() {\n        var {acceptingUnits, accepting} = this.props;\n        acceptingUnits = acceptingUnits || [];\n        var acceptingElem = null;\n        if (accepting === SOME) {\n            var unitsArr = acceptingUnits.map((name, i) => <UnitExample\n                name={name}\n                original={this.original || null}\n                sigfigs={this.props.sigfigs}\n                key={i}\n            />\n            );\n\n            acceptingElem = (\n                <div>\n                    <input\n                        type=\"text\"\n                        defaultValue={acceptingUnits.join(\", \")}\n                        onChange={this.handleAcceptingUnitsChange}\n                    />{\" \"}\n                    (comma-separated)\n                    {unitsArr}\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"unit-editor\">\n                <div>\n                    <input\n                        value={this.props.value}\n                        className=\"unit-editor-canonical\"\n                        onBlur={this._handleBlur}\n                        onKeyPress={this._handleBlur}\n                        onChange={this.onChange}\n                    />{\" \"}\n                    {this.parsed\n                        ? <span className=\"unit-example-okay\">\n                              <InlineIcon {...iconOk} />\n                          </span>\n                        : <span className=\"unit-example-not-okay\">\n                              <InlineIcon {...iconRemove} />\n                          </span>}\n                </div>\n\n                <div>\n                    Significant Figures:{\" \"}\n                    <NumberInput\n                        value={this.props.sigfigs}\n                        onChange={this.handleSigfigChange}\n                        checkValidity={this._checkSigfigValidity}\n                        useArrowKeys\n                    />\n                </div>\n\n                <div>\n                    <label>\n                        <input\n                            type=\"radio\"\n                            name={this.groupId}\n                            onChange={() => this._setAccepting(ALL)}\n                            checked={this.props.accepting === ALL}\n                        />\n                        {\" Any equivalent unit \"}\n                    </label>\n                    <label>\n                        <input\n                            type=\"radio\"\n                            name={this.groupId}\n                            onChange={() => this._setAccepting(SOME)}\n                            checked={this.props.accepting === SOME}\n                        />\n                        {\" Only these units \"}\n                    </label>\n                </div>\n\n                {acceptingElem}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handleAcceptingUnitsChange: function(event) {\n        var acceptingUnits = event.target.value\n            .split(\",\")\n            .map(str => str.trim())\n            .filter(str => str !== \"\");\n        this.change({acceptingUnits});\n    },\n\n    handleSigfigChange: function(sigfigs) {\n        this.change({sigfigs});\n    },\n\n    _checkSigfigValidity: function(sigfigs) {\n        return sigfigs > 0 && sigfigs <= MAX_SIGFIGS;\n    },\n\n    _setAccepting: function(val) {\n        this.change({accepting: val});\n    },\n\n    componentWillMount: function() {\n        this.groupId = _.uniqueId(\"accepting\");\n        this._doOriginal(this.props);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this._doOriginal(nextProps);\n    },\n\n    _doOriginal: function(props) {\n        var tryParse = KAS.unitParse(props.value);\n        this.parsed = false;\n\n        // Only update this state if the unit parsed *and* it has a magnitude\n        // attached to it. KAS can also parse units without magnitudes (\"1.2\n        // g\" vs \"g\").\n        if (tryParse.parsed && tryParse.type === \"unitMagnitude\") {\n            this.original = tryParse.expr;\n            this.parsed = true;\n        }\n    },\n\n    onChange: function(event) {\n        this.props.onChange({value: event.target.value});\n    },\n\n    getSaveWarnings: function() {\n        var {value, accepting, acceptingUnits} = this.props;\n        var warnings = [];\n\n        var tryParse = KAS.unitParse(value);\n        if (!tryParse.parsed) {\n            warnings.push(\"Answer did not parse\");\n        }\n\n        if (accepting === SOME && acceptingUnits.length === 0) {\n            warnings.push(\"There are no accepted units\");\n        }\n\n        return warnings;\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = UnitInputEditor;\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/*\n * In this file, an `expression` is some portion of valid TeX enclosed in\n * curly brackets.\n */\n\n/*\n  * Find the index at which an expression ends, i.e., has an unmatched\n  * closing curly bracket. This method assumes that we start with a non-open\n  * bracket character and end when we've seen more left than right brackets\n  * (rather than assuming that we start with a bracket character and wait for\n  * bracket equality).\n  */\nfunction findEndpoint(tex, currentIndex) {\n    var bracketDepth = 0;\n\n    for (var i = currentIndex, len = tex.length; i < len; i++) {\n        var c = tex[i];\n\n        if (c === \"{\") {\n            bracketDepth++;\n        } else if (c === \"}\") {\n            bracketDepth--;\n        }\n\n        if (bracketDepth < 0) {\n            return i;\n        }\n    }\n    // If we never see unbalanced curly brackets, default to the\n    // entire string\n    return tex.length;\n}\n\n/*\n * Parses an individual set of curly brackets into TeX.\n */\nfunction parseNextExpression(tex, currentIndex, handler) {\n    // Find the first '{' and grab subsequent TeX\n    // Ex) tex: '{3}{7}', and we want the '3'\n    var openBracketIndex = tex.indexOf(\"{\", currentIndex);\n    var nextExpIndex = openBracketIndex + 1;\n\n    // Truncate to only contain remaining TeX\n    var endpoint = findEndpoint(tex, nextExpIndex);\n    var expressionTeX = tex.substring(nextExpIndex, endpoint);\n    var parsedExp = walkTex(expressionTeX, handler);\n\n    return {\n        endpoint: endpoint,\n        expression: parsedExp,\n    };\n}\n\nfunction getNextFracIndex(tex, currentIndex) {\n    var dfrac = \"\\\\dfrac\";\n    var frac = \"\\\\frac\";\n\n    var nextFrac = tex.indexOf(frac, currentIndex);\n    var nextDFrac = tex.indexOf(dfrac, currentIndex);\n\n    if (nextFrac > -1 && nextDFrac > -1) {\n        return Math.min(nextFrac, nextDFrac);\n    } else if (nextFrac > -1) {\n        return nextFrac;\n    } else if (nextDFrac > -1) {\n        return nextDFrac;\n    } else {\n        return -1;\n    }\n}\n\nfunction walkTex(tex, handler) {\n    // Ex) tex: '2 \\dfrac {3}{7}'\n    var parsedString = \"\";\n    var currentIndex = 0;\n    var nextFrac = getNextFracIndex(tex, currentIndex);\n\n    // For each \\dfrac, find the two expressions (wrapped in {}) and recur\n    while (nextFrac > -1) {\n        // Gather first fragment, preceding \\dfrac\n        // Ex) parsedString: '2 '\n        parsedString += tex.substring(currentIndex, nextFrac);\n\n        // Remove everything preceding \\dfrac, which has been parsed\n        currentIndex = nextFrac;\n\n        // Parse first expression and move index past it\n        // Ex) firstParsedExpression.expression: '3'\n        var firstParsedExpression = parseNextExpression(\n            tex,\n            currentIndex,\n            handler\n        );\n        currentIndex = firstParsedExpression.endpoint + 1;\n\n        // Parse second expression\n        // Ex) secondParsedExpression.expression: '7'\n        var secondParsedExpression = parseNextExpression(\n            tex,\n            currentIndex,\n            handler\n        );\n        currentIndex = secondParsedExpression.endpoint + 1;\n\n        // Add expressions to running total of parsed expressions\n        if (parsedString.length) {\n            parsedString += \" \";\n        }\n\n        // Apply a custom handler based on the parsed subexpressions\n        parsedString += handler(\n            firstParsedExpression.expression,\n            secondParsedExpression.expression\n        );\n\n        // Find next DFrac, relative to currentIndex\n        nextFrac = getNextFracIndex(tex, currentIndex);\n    }\n\n    // Add remaining TeX, which is \\dfrac-free\n    parsedString += tex.slice(currentIndex);\n\n    return parsedString;\n}\n\n/*\n * Modify a TeX expression, returning another TeX expression. The resulting\n * expression will have its innermost fractions stubbed out with \\fracs\n * (as opposed to \\dfracs). All other content will remain untouched.\n */\nfunction modifyTex(tex) {\n    function isNestedFraction(tex) {\n        return tex.indexOf(\"\\\\frac\") > -1 || tex.indexOf(\"\\\\dfrac\") > -1;\n    }\n    var handler = function(exp1, exp2) {\n        var prefix;\n        if (isNestedFraction(exp1) || isNestedFraction(exp2)) {\n            prefix = \"\\\\dfrac\";\n        } else {\n            prefix = \"\\\\frac\";\n        }\n        return prefix + \" {\" + exp1 + \"}{\" + exp2 + \"}\";\n    };\n    return walkTex(tex, handler);\n}\n\n/*\n * Parse a TeX expression into something interpretable by input-number.\n * The process is concerned with: (1) parsing fractions, i.e., \\dfracs; and\n * (2) removing backslash-escaping from certain characters (right now, only\n * percent signs).\n *\n * The basic algorithm for handling \\dfracs splits on \\dfracs and then recurs\n * on the subsequent \"expressions\", i.e., the {} pairs that follow \\dfrac. The\n * recursion is to allow for nested \\dfrac elements.\n *\n * Backslash-escapes are removed with a simple search-and-replace.\n */\nfunction parseTex(tex) {\n    const handler = function(exp1, exp2) {\n        return exp1 + \"/\" + exp2;\n    };\n    const texWithoutFracs = walkTex(tex, handler);\n    return texWithoutFracs.replace(\"\\\\%\", \"%\");\n}\n\n_module_.exports = {\n    parseTex,\n    modifyTex,\n};\nexport default _module_.exports;\n","import _texWranglerJs from \"../tex-wrangler.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\nconst TeX = _reactComponentsTexJsx;\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst ModifyTex = _texWranglerJs.modifyTex;\n\nconst MathOutput = createReactClass({\n    propTypes: {\n        value: PropTypes.oneOfType([\n            PropTypes.string,\n            PropTypes.number,\n        ]),\n        className: PropTypes.string,\n        labelText: PropTypes.string,\n        onFocus: PropTypes.func,\n        onBlur: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n            onFocus: function() {},\n            onBlur: function() {},\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            focused: false,\n            selectorNamespace: _.uniqueId(\"math-output\"),\n        };\n    },\n\n    _getInputClassName: function() {\n        let className =\n            \"math-output \" +\n            ApiClassNames.INPUT +\n            \" \" +\n            ApiClassNames.INTERACTIVE;\n        if (this.state.focused) {\n            className += \" \" + ApiClassNames.FOCUSED;\n        }\n        if (this.props.className) {\n            className += \" \" + this.props.className;\n        }\n        return className;\n    },\n\n    _getDisplayValue: function(value) {\n        // Cast from (potentially a) number to string\n        let displayText;\n        if (value != null) {\n            displayText = \"\" + value;\n        } else {\n            displayText = \"\";\n        }\n        return ModifyTex(displayText);\n    },\n\n    render: function() {\n        const divStyle = {\n            textAlign: \"center\",\n        };\n\n        return (\n            <span\n                ref=\"input\"\n                className={this._getInputClassName()}\n                aria-label={this.props.labelText}\n                onMouseDown={this.focus}\n                onTouchStart={this.focus}\n            >\n                <div style={divStyle}>\n                    <TeX>\n                        {this._getDisplayValue(this.props.value)}\n                    </TeX>\n                </div>\n            </span>\n        );\n    },\n\n    getValue: function() {\n        return this.props.value;\n    },\n\n    focus: function() {\n        if (!this.state.focused) {\n            this.props.onFocus();\n            this._bindBlurHandler();\n            this.setState({\n                focused: true,\n            });\n        }\n    },\n\n    blur: function() {\n        if (this.state.focused) {\n            this.props.onBlur();\n            this._unbindBlurHandler();\n            this.setState({\n                focused: false,\n            });\n        }\n    },\n\n    _bindBlurHandler: function() {\n        $(document).bind(\"vclick.\" + this.state.selectorNamespace, e => {\n            // Detect whether the target has our ReactDOMtags.node as a parent\n            const $closestWidget = $(e.target).closest(\n                ReactDOM.findDOMNode(this)\n            );\n            if (!$closestWidget.length) {\n                this.blur();\n            }\n        });\n    },\n\n    _unbindBlurHandler: function() {\n        $(document).unbind(\".\" + this.state.selectorNamespace);\n    },\n\n    componentWillUnmount: function() {\n        this._unbindBlurHandler();\n    },\n});\n\n_module_.exports = MathOutput;\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport { SignificantFigures, displaySigFigs } from \"../sigfigs.jsx\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _hubbleIndexJs from \"../hubble/index.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-redeclare, no-undef, no-unused-vars, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n// TODO(joel): teach KAS how to accept an answer only if it's expressed in\n// terms of a certain type.\n// TODO(joel): Allow sigfigs within a range rather than an exact expected\n// value?\n\nvar lens = _hubbleIndexJs;\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar ApiClassNames = _perseusApiJsx.ClassNames;\nvar ApiOptions = _perseusApiJsx2.Options;\nvar Changeable = _mixinsChangeableJsx;\nvar MathOutput = _componentsMathOutputJsx;\n\nvar ALL = \"all\";\nvar SOME = \"some\";\nvar MAX_SIGFIGS = 10;\n\nvar countSigfigs = function(value) {\n    return new SignificantFigures(value).sigFigs;\n};\n\nvar sigfigPrint = function(num, sigfigs) {\n    return displaySigFigs(num, sigfigs, -MAX_SIGFIGS, false);\n};\n\n/* I just wrote this, but it's old by analogy to `OldExpression`, in that it's\n * the version that non-mathquill platforms get stuck with. Constructed with an\n * <input>, a parser, popsicle sticks, and glue.\n *\n * In the same way as OldExpression, this parses continuously as you type, then\n * shows and hides an error buddy. The error message is only shown after a\n* rolling two second delay, but hidden immediately on further typing.\n */\nvar OldUnitInput = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        value: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            apiOptions: ApiOptions.defaults,\n            value: \"\",\n        };\n    },\n\n    // TODO(joel) think about showing the error buddy\n    render: function() {\n        var inputType = this.props.apiOptions.staticRender\n            ? React.createFactory(MathOutput)\n            : ReactDOMtags.input;\n        var input = inputType({\n            onChange: this.handleChange,\n            ref: \"input\",\n            className: ApiClassNames.INTERACTIVE,\n            value: this.props.value,\n            onFocus: this.handleFocus,\n            onBlur: this.handleBlur,\n        });\n\n        return (\n            <div className=\"old-unit-input\">\n                {input}\n                <div ref=\"error\" className=\"error\" style={{display: \"none\"}}>\n                    {i18n._(\"I don't understand that\")}\n                </div>\n            </div>\n        );\n    },\n\n    _errorTimeout: null,\n\n    _showError: function() {\n        if (this.props.value === \"\") {\n            return;\n        }\n\n        var $error = $(ReactDOM.findDOMNode(this.refs.error));\n        if (!$error.is(\":visible\")) {\n            $error\n                .css({top: 50, opacity: 0.1})\n                .show()\n                .animate({top: 0, opacity: 1.0}, 300);\n        }\n    },\n\n    _hideError: function() {\n        var $error = $(ReactDOM.findDOMNode(this.refs.error));\n        if ($error.is(\":visible\")) {\n            $error.animate({top: 50, opacity: 0.1}, 300, function() {\n                $(this).hide();\n            });\n        }\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    componentDidUpdate: function() {\n        clearTimeout(this._errorTimeout);\n        if (KAS.unitParse(this.props.value).parsed) {\n            this._hideError();\n        } else {\n            this._errorTimeout = setTimeout(this._showError, 2000);\n        }\n    },\n\n    componentWillUnmount: function() {\n        clearTimeout(this._errorTimeout);\n    },\n\n    handleBlur: function() {\n        this.props.onBlur([]);\n        clearTimeout(this._errorTimeout);\n        if (!KAS.unitParse(this.props.value).parsed) {\n            this._showError();\n        }\n    },\n\n    handleChange: function(event) {\n        this._hideError();\n        this.props.onChange({value: event.target.value});\n    },\n\n    simpleValidate: function(rubric, onInputError) {\n        onInputError = onInputError || function() {};\n        return OldUnitInput.validate(this.getUserInput(), rubric);\n    },\n\n    getUserInput: function() {\n        return this.props.value;\n    },\n\n    // begin mobile stuff\n\n    getInputPaths: function() {\n        // The widget itself is an input, so we return a single empty list to\n        // indicate this.\n        return [[]];\n    },\n\n    focusInputPath: function(inputPath) {\n        ReactDOM.findDOMNode(this.refs.input).focus();\n    },\n\n    handleFocus: function() {\n        this.props.onFocus([]);\n    },\n\n    blurInputPath: function(inputPath) {\n        ReactDOM.findDOMNode(this.refs.input).blur();\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        this.props.onChange(\n            {\n                value: newValue,\n            },\n            cb\n        );\n    },\n\n    getDOMNodeForPath: function() {\n        return ReactDOM.findDOMNode(this.refs.input);\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        return \"unit\";\n    },\n\n    // end mobile stuff\n});\n\n// Extract the primitive units from a unit expression. This first simplifies\n// `expr` to a `Mul` like \"5 kg m / s^2\" then removes the first term.\nvar primUnits = function(expr) {\n    return expr.simplify().asMul().partition()[1].flatten().simplify();\n};\n\n_.extend(OldUnitInput, {\n    validate: function(state, rubric) {\n        var answer = KAS.unitParse(rubric.value).expr;\n        var guess = KAS.unitParse(state);\n        if (!guess.parsed) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\"I couldn't understand those units.\"),\n            };\n        }\n\n        // Note: we check sigfigs, then numerical correctness, then units, so\n        // the most significant things come last, that way the user will see\n        // the most important message.\n        var message = null;\n\n        // did the user specify the right number of sigfigs?\n        // TODO(joel) - add a grading mode where the wrong number of sigfigs\n        // isn't marked wrong\n        var sigfigs = rubric.sigfigs;\n        var sigfigsCorrect = countSigfigs(guess.coefficient) === sigfigs;\n        if (!sigfigsCorrect) {\n            message = i18n._(\"Check your significant figures.\");\n        }\n\n        // now we need to check that the answer is correct to the precision we\n        // require.\n        var numericallyCorrect;\n        try {\n            var x = new KAS.Var(\"x\");\n            var equality = new KAS.Eq(\n                answer.simplify(),\n                \"=\",\n                new KAS.Mul(x, guess.expr.simplify())\n            );\n\n            var conversion = equality.solveLinearEquationForVariable(x);\n\n            // Make sure the conversion factor between the user's input answer\n            // and the canonical answer is 1, to sigfig places.\n            // TODO(joel) is this sound?\n            numericallyCorrect =\n                Number(conversion.eval()).toPrecision(sigfigs) ===\n                Number(1).toPrecision(sigfigs);\n        } catch (e) {\n            numericallyCorrect = false;\n        }\n\n        if (!numericallyCorrect) {\n            message = i18n._(\"That answer is numerically incorrect.\");\n        }\n\n        var kasCorrect;\n        var guessUnit = primUnits(guess.expr.simplify());\n        var answerUnit = primUnits(answer.simplify());\n\n        if (rubric.accepting === ALL) {\n            // We're accepting all units - KAS does the hard work of figuring\n            // out if the user's unit is equivalent to the author's unit.\n            kasCorrect = KAS.compare(guessUnit, answerUnit).equal;\n        } else {\n            // Are any of the accepted units the same as what the user entered?\n            kasCorrect = rubric.acceptingUnits.some(unit => {\n                var thisAnswerUnit = primUnits(\n                    KAS.unitParse(unit).unit.simplify()\n                );\n                return KAS.compare(\n                    thisAnswerUnit,\n                    guessUnit\n                    // TODO(joel) - make this work as intended.\n                    // { form: true }\n                ).equal;\n            });\n        }\n        if (!kasCorrect) {\n            var message = i18n._(\"Check your units.\");\n        }\n\n        var correct = kasCorrect && numericallyCorrect && sigfigsCorrect;\n\n        return {\n            type: \"points\",\n            earned: correct ? 1 : 0,\n            total: 1,\n            message,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"unit-input\",\n    displayName: \"Unit\",\n    defaultAlignment: \"inline-block\",\n    widget: OldUnitInput,\n    transform: x => lens(x).del([\"value\"]).freeze(),\n    version: {major: 0, minor: 1},\n    countSigfigs,\n    sigfigPrint,\n    hidden: true,\n};\nexport default _module_.exports;\n","import _mathInput3 from \"@khanacademy/math-input\";\nimport _mathInput2 from \"@khanacademy/math-input\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A version of the `math-input` subrepo's KeypadInput component that adheres to\n * the same API as Perseus's  MathOuput and NumberInput, allowing it to be\n * dropped in as a replacement for those components without any modifications.\n *\n * TODO(charlie): Once the keypad API has stabilized, move this into the\n * `math-input` subrepo and use it everywhere as a simpler, keypad-coupled\n * interface to `math-input`'s MathInput component.\n */\n\nconst React = _react;\n\nconst {KeypadInput} = _mathInput.components;\nconst {KeypadTypes} = _mathInput2.consts;\nconst {keypadElementPropType} = _mathInput3.propTypes;\n\nconst SimpleKeypadInput = createReactClass({\n    propTypes: {\n        keypadElement: keypadElementPropType,\n        onFocus: PropTypes.func,\n        value: PropTypes.oneOfType([\n            PropTypes.string,\n            PropTypes.number,\n        ]),\n    },\n\n    focus() {\n        this.refs.input.focus();\n    },\n\n    blur() {\n        this.refs.input.blur();\n    },\n\n    getValue: function() {\n        return this.props.value;\n    },\n\n    render() {\n        // Intercept the `onFocus` prop, as we need to configure the keypad\n        // before continuing with the default focus logic for Perseus inputs.\n        // Intercept the `value` prop so as to map `null` to the empty string,\n        // as the `KeypadInput` does not support `null` values.\n        const {keypadElement, onFocus, value, ...rest} = this.props;\n\n        return (\n            <KeypadInput\n                ref=\"input\"\n                keypadElement={keypadElement}\n                onFocus={() => {\n                    if (keypadElement) {\n                        keypadElement.configure(\n                            {\n                                keypadType: KeypadTypes.FRACTION,\n                            },\n                            () => {\n                                if (this.isMounted()) {\n                                    onFocus && onFocus();\n                                }\n                            }\n                        );\n                    } else {\n                        onFocus && onFocus();\n                    }\n                }}\n                value={value == null ? \"\" : \"\" + value}\n                {...rest}\n            />\n        );\n    },\n});\n\n_module_.exports = SimpleKeypadInput;\nexport default _module_.exports;\n","import _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport { interactiveSizes } from \"../styles/constants.js\";\nimport _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types, react/prop-types, react/sort-comp */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst Util = _utilJs;\nconst GraphUtils = _utilGraphUtilsJs;\n\nconst SvgImage = _componentsSvgImageJsx;\n\nconst defaultBackgroundImage = {\n    url: null,\n};\n\n/* Style objects */\nconst defaultInstructionsStyle = {\n    fontStyle: \"italic\",\n    fontWeight: \"bold\",\n    fontSize: \"32px\",\n    width: \"100%\",\n    height: \"100%\",\n    textAlign: \"center\",\n    backgroundColor: \"white\",\n    position: \"absolute\",\n    zIndex: 1,\n    transition: \"opacity .25s ease-in-out\",\n    \"-moz-transition\": \"opacity .25s ease-in-out\",\n    \"-webkit-transition\": \"opacity .25s ease-in-out\",\n};\n\nconst instructionsTextStyle = {\n    position: \"relative\",\n    top: \"25%\",\n};\n\nfunction numSteps(range, step) {\n    return Math.floor((range[1] - range[0]) / step);\n}\n\nconst Graph = createReactClass({\n    propTypes: {\n        box: PropTypes.array.isRequired,\n        labels: PropTypes.arrayOf(PropTypes.string),\n        range: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.number)\n        ),\n        step: PropTypes.arrayOf(PropTypes.number),\n        gridStep: PropTypes.arrayOf(PropTypes.number),\n        snapStep: PropTypes.arrayOf(PropTypes.number),\n        markings: PropTypes.string,\n        backgroundImage: PropTypes.shape({\n            url: PropTypes.string,\n        }),\n        showProtractor: PropTypes.bool,\n        showRuler: PropTypes.bool,\n        rulerLabel: PropTypes.string,\n        rulerTicks: PropTypes.number,\n        onGraphieUpdated: PropTypes.func,\n        instructions: PropTypes.string,\n        onClick: PropTypes.func,\n        setDrawingAreaAvailable: PropTypes.func,\n        isMobile: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            labels: [\"x\", \"y\"],\n            range: [[-10, 10], [-10, 10]],\n            step: [1, 1],\n            gridStep: [1, 1],\n            snapStep: [0.5, 0.5],\n            markings: \"graph\",\n            backgroundImage: defaultBackgroundImage,\n            showProtractor: false,\n            showRuler: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n            instructions: null,\n            onGraphieUpdated: null,\n            onClick: null,\n            onMouseDown: null,\n            isMobile: false,\n        };\n    },\n\n    render: function() {\n        let image;\n        const imageData = this.props.backgroundImage;\n        if (imageData.url) {\n            const scale = this.props.box[0] / interactiveSizes.defaultBoxSize;\n            image = (\n                <SvgImage\n                    src={imageData.url}\n                    width={imageData.width}\n                    height={imageData.height}\n                    scale={scale}\n                    responsive={false}\n                />\n            );\n        } else {\n            image = null;\n        }\n\n        return (\n            <div\n                className=\"graphie-container above-scratchpad\"\n                style={{\n                    width: this.props.box[0],\n                    height: this.props.box[1],\n                }}\n                onMouseOut={this.onMouseOut}\n                onMouseOver={this.onMouseOver}\n                onClick={this.onClick}\n            >\n                {image}\n                <div className=\"graphie\" ref=\"graphieDiv\" />\n            </div>\n        );\n    },\n\n    componentDidMount: function() {\n        this._setupGraphie(true);\n    },\n\n    componentDidUpdate: function() {\n        // Only setupGraphie once per componentDidUpdate().\n        // See explanation in setupGraphie().\n        this._hasSetupGraphieThisUpdate = false;\n        if (this._shouldSetupGraphie) {\n            this._setupGraphie(false);\n            this._shouldSetupGraphie = false;\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        const potentialChanges = [\n            \"labels\",\n            \"range\",\n            \"step\",\n            \"markings\",\n            \"showProtractor\",\n            \"showRuler\",\n            \"rulerLabel\",\n            \"rulerTicks\",\n            \"gridStep\",\n            \"snapStep\",\n        ];\n        const self = this;\n        _.each(potentialChanges, function(prop) {\n            if (!_.isEqual(self.props[prop], nextProps[prop])) {\n                self._shouldSetupGraphie = true;\n            }\n        });\n    },\n\n    /* Reset the graphie canvas to its initial state\n     *\n     * Use when re-rendering the parent component and you need a blank\n     * graphie.\n     */\n    reset: function() {\n        this._setupGraphie(false);\n    },\n\n    graphie: function() {\n        return this._graphie;\n    },\n\n    pointsFromNormalized: function(coordsList, noSnap) {\n        const self = this;\n        return _.map(coordsList, function(coords) {\n            return _.map(coords, function(coord, i) {\n                const range = self.props.range[i];\n                if (noSnap) {\n                    return range[0] + (range[1] - range[0]) * coord;\n                } else {\n                    const step = self.props.step[i];\n                    const nSteps = numSteps(range, step);\n                    const tick = Math.round(coord * nSteps);\n                    return range[0] + step * tick;\n                }\n            });\n        });\n    },\n\n    _setupGraphie: function(initialMount) {\n        // Only setupGraphie once per componentDidUpdate().\n        // This prevents this component from rendering graphie\n        // and then immediately re-render graphie because its\n        // parent component asked it to. This will happen when\n        // props on the parent and props on this component both\n        // require graphie to be re-rendered.\n        if (this._hasSetupGraphieThisUpdate) {\n            return;\n        }\n\n        const graphieDiv = ReactDOM.findDOMNode(this.refs.graphieDiv);\n        $(graphieDiv).empty();\n        const labels = this.props.labels;\n        const range = this.props.range;\n        const graphie = (this._graphie = GraphUtils.createGraphie(graphieDiv));\n\n        const gridConfig = this._getGridConfig();\n        graphie.snap = this.props.snapStep;\n\n        if (this.props.markings === \"graph\") {\n            graphie.graphInit({\n                range: range,\n                scale: _.pluck(gridConfig, \"scale\"),\n                axisArrows: \"<->\",\n                labelFormat: function(s) {\n                    return \"\\\\small{\" + s + \"}\";\n                },\n                gridStep: this.props.gridStep,\n                tickStep: _.pluck(gridConfig, \"tickStep\"),\n                labelStep: 1,\n                unityLabels: _.pluck(gridConfig, \"unityLabel\"),\n                isMobile: this.props.isMobile,\n            });\n            graphie.label(\n                [0, range[1][1]],\n                labels[1],\n                this.props.isMobile ? \"below right\" : \"above\"\n            );\n            graphie.label(\n                [range[0][1], 0],\n                labels[0],\n                this.props.isMobile ? \"above left\" : \"right\"\n            );\n        } else if (this.props.markings === \"grid\") {\n            graphie.graphInit({\n                range: range,\n                scale: _.pluck(gridConfig, \"scale\"),\n                gridStep: this.props.gridStep,\n                axes: false,\n                ticks: false,\n                labels: false,\n                isMobile: this.props.isMobile,\n            });\n        } else if (this.props.markings === \"none\") {\n            graphie.init({\n                range: range,\n                scale: _.pluck(gridConfig, \"scale\"),\n                isMobile: this.props.isMobile,\n            });\n        }\n\n        // Add instructions just before mouse layer\n        const visible = 0.5;\n        const invisible = 0.0;\n        let $instructionsWrapper;\n        if (this.props.instructions) {\n            $instructionsWrapper = $(\"<div/>\");\n            _.each(defaultInstructionsStyle, function(value, key) {\n                $instructionsWrapper.css(key, value);\n            });\n            $instructionsWrapper.css(\"opacity\", visible);\n\n            const $instructions = $(\"<span/>\", {\n                text: this.props.instructions,\n            });\n            _.each(instructionsTextStyle, function(value, key) {\n                $instructions.css(key, value);\n            });\n\n            $instructionsWrapper.append($instructions);\n            $(graphieDiv).append($instructionsWrapper);\n        } else {\n            $instructionsWrapper = undefined;\n        }\n\n        // Add some handlers for instructions text (if necessary)\n        /* eslint-disable indent */\n        const onMouseDown =\n            $instructionsWrapper || this.props.onMouseDown\n                ? _.bind(function(coord) {\n                      if ($instructionsWrapper) {\n                          $instructionsWrapper.remove();\n                          $instructionsWrapper = null;\n                      }\n                      this.props.onMouseDown(coord);\n                  }, this)\n                : null;\n\n        const onMouseOver = $instructionsWrapper\n            ? function() {\n                  $instructionsWrapper &&\n                      $instructionsWrapper.css(\"opacity\", invisible);\n              }\n            : null;\n\n        const onMouseOut = $instructionsWrapper\n            ? function() {\n                  $instructionsWrapper &&\n                      $instructionsWrapper.css(\"opacity\", visible);\n              }\n            : null;\n        /* eslint-enable indent */\n\n        graphie.addMouseLayer({\n            onClick: this.props.onClick,\n            onMouseDown: onMouseDown,\n            onMouseOver: onMouseOver,\n            onMouseOut: onMouseOut,\n            onMouseUp: this.props.onMouseUp,\n            onMouseMove: this.props.onMouseMove,\n            allowScratchpad: true,\n            setDrawingAreaAvailable: this.props.setDrawingAreaAvailable,\n        });\n\n        this._updateProtractor();\n        this._updateRuler();\n\n        // We set this flag before jumping into our callback\n        // to avoid recursing if our callback calls reset() itself\n        this._hasSetupGraphieThisUpdate = true;\n        if (!initialMount && this.props.onGraphieUpdated) {\n            // Calling a parent callback in componentDidMount is bad and\n            // results in hard-to-reason-about lifecycle problems (esp. with\n            // refs), so we do it only on update and rely on the parent to\n            // query for the graphie object on initial mount\n            this.props.onGraphieUpdated(graphie);\n        }\n    },\n\n    _getGridConfig: function() {\n        const self = this;\n        return _.map(self.props.step, function(step, i) {\n            return Util.gridDimensionConfig(\n                step,\n                self.props.range[i],\n                self.props.box[i],\n                self.props.gridStep[i]\n            );\n        });\n    },\n\n    _updateProtractor: function() {\n        if (this.protractor) {\n            this.protractor.remove();\n        }\n\n        if (this.props.showProtractor) {\n            const coord = this.pointsFromNormalized([[0.5, 0.05]])[0];\n            this.protractor = this._graphie.protractor(coord);\n        }\n    },\n\n    _updateRuler: function() {\n        if (this.ruler) {\n            this.ruler.remove();\n        }\n\n        if (this.props.showRuler) {\n            const coord = this.pointsFromNormalized([[0.5, 0.25]])[0];\n            const extent =\n                this._graphie.range[0][1] - this._graphie.range[0][0];\n            this.ruler = this._graphie.ruler({\n                center: coord,\n                label: this.props.rulerLabel,\n                pixelsPerUnit: this._graphie.scale[0],\n                ticksPerUnit: this.props.rulerTicks,\n                units: Math.round(0.8 * extent),\n            });\n        }\n    },\n\n    toJSON: function() {\n        return _.pick(\n            this.props,\n            \"range\",\n            \"step\",\n            \"markings\",\n            \"labels\",\n            \"backgroundImage\",\n            \"showProtractor\",\n            \"showRuler\",\n            \"rulerLabel\",\n            \"rulerTicks\",\n            \"gridStep\",\n            \"snapStep\"\n        );\n    },\n});\n\n_module_.exports = Graph;\nexport default _module_.exports;\n","import _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _utilMathJs from \"../util/math.js\";\nimport _kmath5 from \"kmath\";\nimport _kmath4 from \"kmath\";\nimport _kmath3 from \"kmath\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _utilJs3 from \"../util.js\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport { iconPlus, iconUndo } from \"../icon-paths.js\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _componentsGraphJsx from \"../components/graph.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable camelcase, comma-dangle, indent, max-lines, no-redeclare, no-undef, no-var, object-curly-spacing, prefer-spread, react/jsx-closing-bracket-location, react/jsx-indent-props, react/no-did-update-set-state, react/prop-types, react/sort-comp, space-before-function-paren, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar Graph = _componentsGraphJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nvar NumberInput = _componentsNumberInputJsx;\nvar MathOutput = _componentsMathOutputJsx;\nvar TeX = _reactComponentsTexJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\n\nvar ApiOptions = _perseusApiJsx.Options;\nconst {keypadElementPropType} = _mathInput.propTypes;\n\nvar ROTATE_SNAP_DEGREES = 15;\nvar DEGREE_SIGN = \"\\u00B0\";\nvar RENDER_TRANSFORM_DELAY_IN_MS = 300;\nvar ROTATE_HANDLE_DIST = 1.5;\nvar REFLECT_ROTATE_HANDLE_DIST = 2;\nvar REFLECT_BUTTON_SIZE = 1;\n\nvar deepEq = _utilJs.deepEq;\nvar getGridStep = _utilJs2.getGridStep;\nvar captureScratchpadTouchStart = _utilJs3\n    .captureScratchpadTouchStart;\n\nvar knumber = _kmath.number;\nvar kvector = _kmath2.vector;\nvar kpoint = _kmath3.point;\nvar kray = _kmath4.ray;\nvar kline = _kmath5.line;\nconst KhanMath = _utilMathJs;\nconst KhanColors = _utilColorsJs;\n\nvar assert = _interactive2InteractiveUtilJs.assert;\n\nvar defaultBoxSize = 400;\nvar defaultBackgroundImage = {\n    url: null,\n};\n\n/* Does a pluck on keys inside objects in an object\n *\n * Ex:\n * tools = {\n *     translation: {\n *         enabled: true\n *     },\n *     rotation: {\n *         enabled: false\n *     }\n * };\n * pluckObject(tools, \"enabled\") returns {\n *     translation: true\n *     rotation: false\n * }\n */\nfunction pluckObject(object, subKey) {\n    return _.object(\n        _.map(object, function(value, key) {\n            return [key, value[subKey]];\n        })\n    );\n}\n\nvar defaultGraphProps = function(setProps, boxSize) {\n    setProps = setProps || {};\n    var labels = setProps.labels || [\"x\", \"y\"];\n    var range = setProps.range || [[-10, 10], [-10, 10]];\n    var step = setProps.step || [1, 1];\n    var gridStep = setProps.gridStep || getGridStep(range, step, boxSize);\n    return {\n        box: [boxSize, boxSize],\n        labels: labels,\n        range: range,\n        step: step,\n        gridStep: gridStep,\n        valid: true,\n        backgroundImage: defaultBackgroundImage,\n        markings: \"grid\",\n        showProtractor: false,\n    };\n};\n\nvar defaultTransformerProps = {\n    apiOptions: ApiOptions.defaults,\n    gradeEmpty: false,\n    graphMode: \"interactive\",\n    listMode: \"dynamic\",\n    graph: {},\n    tools: {\n        translation: {\n            enabled: true,\n            required: false,\n            constraints: {},\n        },\n        rotation: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coord: [1, 6],\n        },\n        reflection: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coords: [[2, -4], [2, 2]],\n        },\n        dilation: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coord: [6, 6],\n        },\n    },\n    drawSolutionShape: true,\n    starting: {\n        shape: {\n            type: \"polygon-3\",\n            coords: [[2, 2], [2, 6], [7, 2]],\n        },\n        transformations: [],\n    },\n    correct: {\n        shape: {\n            type: \"polygon-3\",\n            coords: [[2, 2], [2, 6], [7, 2]],\n        },\n        transformations: [],\n    },\n};\n\nfunction colorForTool(tool) {\n    return tool.constraints.fixed ? KhanColors.DYNAMIC : KhanColors.INTERACTIVE;\n}\n\n/* Scales a distance from the default range of\n * [-10, 10] to a given props.range pair\n *\n * Used for sizing various transformation tools\n * (rotation handle, dilation circle)\n */\nfunction scaleToRange(dist, range) {\n    var spreadX = range[0][1] - range[0][0];\n    var spreadY = range[1][1] - range[1][0];\n\n    return dist * Math.max(spreadX, spreadY) / 20;\n}\n\nfunction dilatePointFromCenter(point, dilationCenter, scale) {\n    var pv = kvector.subtract(point, dilationCenter);\n    var pvScaled = kvector.scale(pv, scale);\n    var transformedPoint = kvector.add(dilationCenter, pvScaled);\n    return transformedPoint;\n}\n\n// TODO(jack): i18nize this\nfunction stringFromDecimal(number) {\n    return String(KhanMath.roundTo(9, number));\n}\n\nfunction stringFromFraction(number) {\n    var frac = KhanMath.toFraction(number, knumber.DEFAULT_TOLERANCE);\n    if (frac[1] === 1) {\n        return stringFromDecimal(number);\n    } else {\n        return stringFromDecimal(frac[0]) + \"/\" + stringFromDecimal(frac[1]);\n    }\n}\n\nfunction texFromPoint(point) {\n    return [\n        <TeX>\n            {\"(\"}\n        </TeX>,\n        stringFromDecimal(point[0]),\n        <TeX>\n            {\", {}\"}\n        </TeX>,\n        stringFromDecimal(point[1]),\n        <TeX>\n            {\")\"}\n        </TeX>,\n    ];\n}\n\nfunction texFromVector(vector) {\n    return [\n        <TeX>\n            {\"\\\\langle\"}\n        </TeX>,\n        stringFromDecimal(vector[0]),\n        <TeX>\n            {\", {}\"}\n        </TeX>,\n        stringFromDecimal(vector[1]),\n        <TeX>\n            {\"\\\\rangle\"}\n        </TeX>,\n    ];\n}\n\nfunction texFromAngleDeg(angleDeg) {\n    return stringFromDecimal(angleDeg) + DEGREE_SIGN;\n}\n\nfunction orderInsensitiveCoordsEqual(coords1, coords2) {\n    coords1 = _.clone(coords1).sort(kpoint.compare);\n    coords2 = _.clone(coords2).sort(kpoint.compare);\n    return _.all(\n        _.map(coords1, function(coord1, i) {\n            var coord2 = coords2[i];\n            return kpoint.equal(coord1, coord2);\n        })\n    );\n}\n\nconst inputComponentForApiOptions = apiOptions => {\n    if (apiOptions.customKeypad) {\n        return SimpleKeypadInput;\n    } else if (apiOptions.staticRender) {\n        return MathOutput;\n    } else {\n        return NumberInput;\n    }\n};\n\n/* Perform operations on raw transform objects */\nvar TransformOps = {\n    apply: function(transform) {\n        // Any transformation with empty text boxes is a no-op until\n        // filled out (these show up as nulls in transform.vector/line/etc).\n        // TODO (jack): Merge this just into reflections now that other\n        // transforms are always valid (after merging transformation\n        // collapsing, which may use isValid)\n        if (!Transformations[transform.type].isValid(transform)) {\n            return _.identity; // do not transform the coord\n        } else {\n            return Transformations[transform.type].apply(transform);\n        }\n    },\n\n    append: function(transformList, newTransform) {\n        // Append newTransform to transformList, and collapse the last\n        // two transforms if they are collapsable\n        var results = TransformOps._appendAndCollapseLastTwo(\n            transformList,\n            newTransform\n        );\n        // Collapse any no-ops at the end of the transformation list\n        return TransformOps._collapseFinalNoOps(results);\n    },\n\n    _collapseFinalNoOps: function(transforms) {\n        // Collapse no-op transformations at the end of the list\n        if (transforms.length && TransformOps.isNoOp(_.last(transforms))) {\n            return _.initial(transforms);\n        } else {\n            return transforms;\n        }\n    },\n\n    _appendAndCollapseLastTwo: function(transformList, newTransform) {\n        if (!transformList.length) {\n            return [newTransform];\n        } else {\n            var collapsed = TransformOps.collapse(\n                _.last(transformList),\n                newTransform\n            );\n            return _.initial(transformList).concat(collapsed);\n        }\n    },\n\n    isNoOp: function(transform) {\n        return Transformations[transform.type].isNoOp(transform);\n    },\n\n    collapse: function(transform1, transform2) {\n        // We can only collapse transforms that have the same type\n        if (transform1.type !== transform2.type) {\n            return [transform1, transform2];\n        }\n\n        // Clicking the button again removes empty transformations\n        if (\n            TransformOps.isEmpty(transform1) &&\n            TransformOps.isEmpty(transform2)\n        ) {\n            return [];\n        }\n\n        // Don't collapse invalid transformations otherwise\n        if (\n            !TransformOps.isValid(transform1) ||\n            !TransformOps.isValid(transform2)\n        ) {\n            return [transform1, transform2];\n        }\n\n        return TransformOps._collapseValidMonotypedTransforms(\n            transform1,\n            transform2\n        );\n    },\n\n    isValid: function(transform) {\n        return Transformations[transform.type].isValid(transform);\n    },\n\n    isEmpty: function(transform) {\n        return Transformations[transform.type].isEmpty(transform);\n    },\n\n    _collapseValidMonotypedTransforms: function(transform1, transform2) {\n        var collapsed = Transformations[transform1.type].collapse(\n            transform1,\n            transform2\n        );\n        if (collapsed) {\n            // Force all answers into an array\n            if (!_.isArray(collapsed)) {\n                collapsed = [collapsed];\n            }\n            // Add types to all transforms in the answer\n            _.each(collapsed, function(transform) {\n                transform.type = transform1.type;\n            });\n            return collapsed;\n        } else {\n            // These transforms can't be collapsed together\n            return [transform1, transform2];\n        }\n    },\n\n    toTeX: function(transform) {\n        return Transformations[transform.type].toTeX(transform);\n    },\n\n    /* A react representation of this transform object */\n    ListItem: createReactClass({\n        render: function() {\n            if (this.props.mode === \"dynamic\") {\n                return (\n                    <div>\n                        {TransformOps.toTeX(this.props.transform)}\n                    </div>\n                );\n            } else if (this.props.mode === \"interactive\") {\n                var TransformClass =\n                    Transformations[this.props.transform.type].Input;\n                return (\n                    <TransformClass\n                        ref=\"transform\"\n                        onChange={this.handleChange}\n                        onFocus={this.props.onFocus}\n                        onBlur={this.props.onBlur}\n                        keypadElement={this.props.keypadElement}\n                        apiOptions={this.props.apiOptions}\n                        {...this.props.transform}\n                    />\n                );\n            } else {\n                throw new Error(\"Invalid mode: \" + this.props.mode);\n            }\n        },\n        value: function() {\n            if (this.props.mode === \"interactive\") {\n                return _.extend(\n                    {\n                        type: this.props.transform.type,\n                    },\n                    this.refs.transform.value()\n                );\n            } else {\n                return this.props.transform;\n            }\n        },\n        handleChange: _.debounce(function(callback) {\n            this.props.onChange(this.value(), callback);\n        }, RENDER_TRANSFORM_DELAY_IN_MS),\n\n        /* InputPath API: depending on the API call, this could involve simply\n         * navigating to the right ref and calling the function on that\n         * component, or threading the call down and returning the result. */\n        _getComponentAtPath: function(path) {\n            var transform = this.refs.transform;\n            var ref = _.head(path);\n            return transform.refs[ref];\n        },\n        focus: function() {\n            var transform = this.refs.transform;\n            var path = _.head(transform.getInputPaths());\n            if (path) {\n                this.focusInputPath(path);\n            }\n        },\n        focusInputPath: function(path) {\n            this._getComponentAtPath(path).focus();\n        },\n        blurInputPath: function(path) {\n            this._getComponentAtPath(path).blur();\n        },\n        getDOMNodeForPath: function(path) {\n            return ReactDOM.findDOMNode(this._getComponentAtPath(path));\n        },\n        getGrammarTypeForPath: function(path) {\n            return \"number\";\n        },\n        setInputValue: function(path, value, cb) {\n            // `value` comes in as a string on mobile, but we need a number\n            // We let through the empty string so that \"Clear\" works -- in\n            // that case, the transformer widget will just act as if there is\n            // no input, which is what we want.\n            if (value.length) {\n                value = parseFloat(value);\n                if (isNaN(value)) {\n                    return;\n                }\n            }\n            this.refs.transform.setInputValue(path, value, cb);\n        },\n        getInputPaths: function() {\n            // If we're in dynamic mode, then the list items are made up of\n            // static text.\n            if (this.props.mode === \"dynamic\") {\n                return [];\n            } else {\n                return this.refs.transform.getInputPaths();\n            }\n        },\n    }),\n};\n\nvar Transformations = {\n    translation: {\n        // I18N: As in the command, \"Translate the polygon\"\n        verbName: i18n._(\"Translate\"),\n        nounName: i18n._(\"Translation\"),\n        lowerNounName: i18n._(\"translation\"),\n        apply: function(transform) {\n            return function(coord) {\n                return kvector.add(coord, transform.vector);\n            };\n        },\n        isValid: function(transform) {\n            return (\n                _.isFinite(transform.vector[0]) &&\n                _.isFinite(transform.vector[1])\n            );\n        },\n        isEmpty: function(transform) {\n            return transform.vector[0] === null && transform.vector[1] === null;\n        },\n        isNoOp: function(transform) {\n            return kvector.equal(transform.vector, [0, 0]);\n        },\n        collapse: function(transform1, transform2) {\n            return {\n                vector: kvector.add(transform1.vector, transform2.vector),\n            };\n        },\n        toTeX: function(transform) {\n            // I18N: As in the command, \"Translation by <3, 1>\"\n            return $_(\n                {vector: texFromVector(transform.vector)},\n                \"Translation by %(vector)s\"\n            );\n        },\n        Input: createReactClass({\n            getInitialState: function() {\n                return {\n                    vector: this.props.vector || [null, null],\n                };\n            },\n            componentDidUpdate: function(prevProps) {\n                if (!deepEq(this.props, prevProps)) {\n                    this.setState({vector: this.props.vector});\n                }\n            },\n            render: function() {\n                const InputComponent = inputComponentForApiOptions(\n                    this.props.apiOptions\n                );\n\n                var vector = [\n                    <TeX>\\langle</TeX>,\n                    <InputComponent\n                        ref=\"x\"\n                        placeholder={0}\n                        value={this.state.vector[0]}\n                        useArrowKeys={true}\n                        onChange={val0 => {\n                            var val1 = this.state.vector[1];\n                            this.setState({vector: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"x\")}\n                        onBlur={_.partial(this.props.onBlur, \"x\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\n                        {\", {}\"}\n                    </TeX>,\n                    <InputComponent\n                        ref=\"y\"\n                        placeholder={0}\n                        value={this.state.vector[1]}\n                        useArrowKeys={true}\n                        onChange={val1 => {\n                            var val0 = this.state.vector[0];\n                            this.setState({vector: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"y\")}\n                        onBlur={_.partial(this.props.onBlur, \"y\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\\rangle</TeX>,\n                ];\n                return (\n                    <div>\n                        {$_({vector: vector}, \"Translation by %(vector)s\")}\n                    </div>\n                );\n            },\n            value: function() {\n                var x = this.refs.x.getValue();\n                var y = this.refs.y.getValue();\n                return {\n                    vector: [x, y],\n                };\n            },\n            /* InputPath API */\n            setInputValue: function(path, value, cb) {\n                var id = _.first(path);\n                var vector = _.clone(this.state.vector);\n                if (id === \"x\") {\n                    vector[0] = value;\n                } else if (id === \"y\") {\n                    vector[1] = value;\n                }\n                this.setState({vector: vector}, () => {\n                    this.props.onChange(cb);\n                });\n            },\n            getInputPaths: function() {\n                return [[\"x\"], [\"y\"]];\n            },\n        }),\n    },\n\n    rotation: {\n        // I18N: As in the command, \"Rotate the polygon\"\n        verbName: i18n._(\"Rotate\"),\n        nounName: i18n._(\"Rotation\"),\n        lowerNounName: i18n._(\"rotation\"),\n        apply: function(transform) {\n            return function(coord) {\n                return kpoint.rotateDeg(\n                    coord,\n                    transform.angleDeg,\n                    transform.center\n                );\n            };\n        },\n        isValid: function(transform) {\n            return (\n                _.isFinite(transform.angleDeg) &&\n                _.isFinite(transform.center[0]) &&\n                _.isFinite(transform.center[1])\n            );\n        },\n        isEmpty: function(transform) {\n            return (\n                transform.angleDeg === null &&\n                transform.center[0] === null &&\n                transform.center[1] === null\n            );\n        },\n        isNoOp: function(transform) {\n            return knumber.equal(transform.angleDeg, 0);\n        },\n        collapse: function(transform1, transform2) {\n            if (!kpoint.equal(transform1.center, transform2.center)) {\n                return false;\n            }\n            return {\n                center: transform1.center,\n                angleDeg: transform1.angleDeg + transform2.angleDeg,\n            };\n        },\n        toTeX: function(transform) {\n            return $_(\n                {\n                    degrees: texFromAngleDeg(transform.angleDeg),\n                    point: texFromPoint(transform.center),\n                },\n                \"Rotation by %(degrees)s about %(point)s\"\n            );\n        },\n        Input: createReactClass({\n            getInitialState: function() {\n                return {\n                    center: this.props.center || [null, null],\n                    angleDeg: this.props.angleDeg || null,\n                };\n            },\n            componentDidUpdate: function(prevProps) {\n                if (!deepEq(this.props, prevProps)) {\n                    this.setState({\n                        center: this.props.center,\n                        angleDeg: this.props.angleDeg,\n                    });\n                }\n            },\n            render: function() {\n                const InputComponent = inputComponentForApiOptions(\n                    this.props.apiOptions\n                );\n\n                var point = [\n                    <TeX>(</TeX>,\n                    <InputComponent\n                        ref=\"centerX\"\n                        placeholder={0}\n                        value={this.state.center[0]}\n                        useArrowKeys={true}\n                        onChange={val0 => {\n                            var val1 = this.state.center[1];\n                            this.setState({center: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"centerX\")}\n                        onBlur={_.partial(this.props.onBlur, \"centerX\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\n                        {\", {}\"}\n                    </TeX>,\n                    <InputComponent\n                        ref=\"centerY\"\n                        placeholder={0}\n                        value={this.state.center[1]}\n                        useArrowKeys={true}\n                        onChange={val1 => {\n                            var val0 = this.state.center[0];\n                            this.setState({center: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"centerY\")}\n                        onBlur={_.partial(this.props.onBlur, \"centerY\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>)</TeX>,\n                ];\n                var degrees = [\n                    <InputComponent\n                        ref=\"angleDeg\"\n                        placeholder={0}\n                        value={this.state.angleDeg}\n                        useArrowKeys={true}\n                        onChange={val => {\n                            this.setState({angleDeg: val}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"angleDeg\")}\n                        onBlur={_.partial(this.props.onBlur, \"angleDeg\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    DEGREE_SIGN,\n                ];\n                // I18N: %(point)s must come before %(degrees)s in this phrase\n                var text = $_(\n                    {point, degrees},\n                    \"Rotation about %(point)s by %(degrees)s\"\n                );\n\n                return (\n                    <div>\n                        {text}\n                    </div>\n                );\n            },\n            value: function() {\n                var angleDeg = this.refs.angleDeg.getValue();\n                var centerX = this.refs.centerX.getValue();\n                var centerY = this.refs.centerY.getValue();\n                return {\n                    angleDeg: angleDeg,\n                    center: [centerX, centerY],\n                };\n            },\n            /* InputPath API */\n            setInputValue: function(path, value, cb) {\n                var id = _.first(path);\n                var angleDeg = _.clone(this.state.angleDeg);\n                var center = _.clone(this.state.center);\n                if (id === \"angleDeg\") {\n                    angleDeg = value;\n                } else if (id === \"centerX\") {\n                    center[0] = value;\n                } else if (id === \"centerY\") {\n                    center[1] = value;\n                }\n                this.setState({angleDeg: angleDeg, center: center}, () => {\n                    this.props.onChange(cb);\n                });\n            },\n            getInputPaths: function() {\n                return [[\"centerX\"], [\"centerY\"], [\"angleDeg\"]];\n            },\n        }),\n    },\n\n    reflection: {\n        // I18N: As in the command, \"Reflect the polygon\"\n        verbName: i18n._(\"Reflect\"),\n        nounName: i18n._(\"Reflection\"),\n        lowerNounName: i18n._(\"reflection\"),\n        apply: function(transform) {\n            return function(coord) {\n                return kpoint.reflectOverLine(coord, transform.line);\n            };\n        },\n        isValid: function(transform) {\n            // A bit hacky, but we'll also define reflecting over a\n            // single point as a no-op, to avoid NaN fun.\n            return (\n                _.all(_.flatten(transform.line), _.isFinite) &&\n                !kpoint.equal(transform.line[0], transform.line[1])\n            );\n        },\n        isEmpty: function(transform) {\n            return _.all(_.flatten(transform.line), _.isNull);\n        },\n        isNoOp: function(transform) {\n            // Invalid transforms are implicitly no-ops, so we don't\n            // have to catch that case here.\n            return false;\n        },\n        collapse: function(transform1, transform2) {\n            if (!kline.equal(transform1.line, transform2.line)) {\n                return false;\n            }\n            return [];\n        },\n        toTeX: function(transform) {\n            var point1 = transform.line[0];\n            var point2 = transform.line[1];\n            return $_(\n                {\n                    point1: texFromPoint(point1),\n                    point2: texFromPoint(point2),\n                },\n                \"Reflection over the line from %(point1)s to %(point2)s\"\n            );\n        },\n        Input: createReactClass({\n            getInitialState: function() {\n                return {\n                    line: this.props.line || [[null, null], [null, null]],\n                };\n            },\n            componentDidUpdate: function(prevProps) {\n                if (!deepEq(this.props, prevProps)) {\n                    this.setState({line: this.props.line});\n                }\n            },\n            render: function() {\n                const InputComponent = inputComponentForApiOptions(\n                    this.props.apiOptions\n                );\n\n                var point1 = [\n                    <TeX>(</TeX>,\n                    <InputComponent\n                        ref=\"x1\"\n                        value={this.state.line[0][0]}\n                        useArrowKeys={true}\n                        onChange={this.changePoint.bind(this, 0, 0)}\n                        onFocus={_.partial(this.props.onFocus, \"x1\")}\n                        onBlur={_.partial(this.props.onBlur, \"x1\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\n                        {\", {}\"}\n                    </TeX>,\n                    <InputComponent\n                        ref=\"y1\"\n                        value={this.state.line[0][1]}\n                        useArrowKeys={true}\n                        onChange={this.changePoint.bind(this, 0, 1)}\n                        onFocus={_.partial(this.props.onFocus, \"y1\")}\n                        onBlur={_.partial(this.props.onBlur, \"y1\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>)</TeX>,\n                ];\n                var point2 = [\n                    <TeX>(</TeX>,\n                    <InputComponent\n                        ref=\"x2\"\n                        value={this.state.line[1][0]}\n                        useArrowKeys={true}\n                        onChange={this.changePoint.bind(this, 1, 0)}\n                        onFocus={_.partial(this.props.onFocus, \"x2\")}\n                        onBlur={_.partial(this.props.onBlur, \"x2\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\n                        {\", {}\"}\n                    </TeX>,\n                    <InputComponent\n                        ref=\"y2\"\n                        value={this.state.line[1][1]}\n                        useArrowKeys={true}\n                        onChange={this.changePoint.bind(this, 1, 1)}\n                        onFocus={_.partial(this.props.onFocus, \"y2\")}\n                        onBlur={_.partial(this.props.onBlur, \"y2\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>)</TeX>,\n                ];\n                return (\n                    <div>\n                        {$_(\n                            {point1, point2},\n                            \"Reflection over the line from \" +\n                                \"%(point1)s to %(point2)s\"\n                        )}\n                    </div>\n                );\n            },\n            changePoint: function(i, j, val, cb) {\n                var line = _.map(this.state.line, _.clone);\n                line[i][j] = val;\n                this.setState({line: line}, () => {\n                    this.props.onChange(cb);\n                });\n            },\n            value: function() {\n                var x1 = this.refs.x1.getValue();\n                var y1 = this.refs.y1.getValue();\n                var x2 = this.refs.x2.getValue();\n                var y2 = this.refs.y2.getValue();\n                return {\n                    line: [[x1, y1], [x2, y2]],\n                };\n            },\n            /* InputPath API */\n            setInputValue: function(path, value, cb) {\n                var id = _.first(path);\n                var j;\n                if (id[0] === \"x\") {\n                    j = 0;\n                } else if (id[0] === \"y\") {\n                    j = 1;\n                }\n                var i;\n                if (id[1] === \"1\") {\n                    i = 0;\n                } else if (id[1] === \"2\") {\n                    i = 1;\n                }\n                this.changePoint(i, j, value, cb);\n            },\n            getInputPaths: function() {\n                return [[\"x1\"], [\"y1\"], [\"x2\"], [\"y2\"]];\n            },\n        }),\n    },\n\n    dilation: {\n        // I18N: As in the command, \"Dilate the polygon\"\n        verbName: i18n._(\"Dilate\"),\n        nounName: i18n._(\"Dilation\"),\n        lowerNounName: i18n._(\"dilation\"),\n        apply: function(transform) {\n            return function(coord) {\n                return dilatePointFromCenter(\n                    coord,\n                    transform.center,\n                    transform.scale\n                );\n            };\n        },\n        isValid: function(transform) {\n            return (\n                _.isFinite(transform.scale) &&\n                _.isFinite(transform.center[0]) &&\n                _.isFinite(transform.center[1])\n            );\n        },\n        isEmpty: function(transform) {\n            return (\n                transform.scale === null &&\n                transform.center[0] === null &&\n                transform.center[1] === null\n            );\n        },\n        isNoOp: function(transform) {\n            return knumber.equal(transform.scale, 1);\n        },\n        collapse: function(transform1, transform2) {\n            if (!kpoint.equal(transform1.center, transform2.center)) {\n                return false;\n            }\n            return {\n                center: transform1.center,\n                scale: transform1.scale * transform2.scale,\n            };\n        },\n        toTeX: function(transform) {\n            var scaleString = stringFromFraction(transform.scale);\n            return $_(\n                {\n                    scale: scaleString,\n                    point: texFromPoint(transform.center),\n                },\n                \"Dilation of scale %(scale)s about %(point)s\"\n            );\n        },\n        Input: createReactClass({\n            getInitialState: function() {\n                return {\n                    center: this.props.center || [null, null],\n                    scale: this.props.scale || null,\n                };\n            },\n            componentDidUpdate: function(prevProps) {\n                if (!deepEq(this.props, prevProps)) {\n                    this.setState({\n                        center: this.props.center,\n                        scale: this.props.scale,\n                    });\n                }\n            },\n            render: function() {\n                const InputComponent = inputComponentForApiOptions(\n                    this.props.apiOptions\n                );\n\n                var point = [\n                    <TeX>(</TeX>,\n                    <InputComponent\n                        ref=\"x\"\n                        placeholder={0}\n                        value={this.state.center[0]}\n                        useArrowKeys={true}\n                        onChange={val0 => {\n                            var val1 = this.state.center[1];\n                            this.setState({center: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"x\")}\n                        onBlur={_.partial(this.props.onBlur, \"x\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>\n                        {\", {}\"}\n                    </TeX>,\n                    <InputComponent\n                        ref=\"y\"\n                        placeholder={0}\n                        value={this.state.center[1]}\n                        useArrowKeys={true}\n                        onChange={val1 => {\n                            var val0 = this.state.center[0];\n                            this.setState({center: [val0, val1]}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"y\")}\n                        onBlur={_.partial(this.props.onBlur, \"y\")}\n                        keypadElement={this.props.keypadElement}\n                    />,\n                    <TeX>)</TeX>,\n                ];\n                var scale = (\n                    <InputComponent\n                        ref=\"scale\"\n                        placeholder={1}\n                        value={this.state.scale}\n                        useArrowKeys={true}\n                        onChange={val => {\n                            this.setState({scale: val}, () => {\n                                this.props.onChange();\n                            });\n                        }}\n                        onFocus={_.partial(this.props.onFocus, \"scale\")}\n                        onBlur={_.partial(this.props.onBlur, \"scale\")}\n                        keypadElement={this.props.keypadElement}\n                    />\n                );\n                return (\n                    <div>\n                        {$_(\n                            {point, scale},\n                            \"Dilation about %(point)s by %(scale)s\"\n                        )}\n                    </div>\n                );\n            },\n            value: function() {\n                var scale = this.refs.scale.getValue();\n                var x = this.refs.x.getValue();\n                var y = this.refs.y.getValue();\n                return {\n                    scale: scale,\n                    center: [x, y],\n                };\n            },\n            /* InputPath API */\n            setInputValue: function(path, value, cb) {\n                var id = _.first(path);\n                var scale = this.state.scale;\n                var center = _.clone(this.state.center);\n                if (id === \"x\") {\n                    center[0] = value;\n                } else if (id === \"y\") {\n                    center[1] = value;\n                } else if (id === \"scale\") {\n                    scale = value;\n                }\n                this.setState({scale: scale, center: center}, () => {\n                    this.props.onChange(cb);\n                });\n            },\n            getInputPaths: function() {\n                return [[\"x\"], [\"y\"], [\"scale\"]];\n            },\n        }),\n    },\n};\n\n/* Various functions to deal with different shape types */\nvar ShapeTypes = {\n    getPointCountForType: function(type) {\n        var splitType = type.split(\"-\");\n        if (splitType[0] === \"polygon\") {\n            return splitType[1] || 3;\n        } else if (splitType[0] === \"line\" || splitType[0] === \"lineSegment\") {\n            return 2;\n        } else if (splitType[0] === \"angle\") {\n            return 3;\n        } else if (splitType[0] === \"circle\") {\n            return 2;\n        } else if (splitType[0] === \"point\") {\n            return 1;\n        }\n    },\n\n    addMovableShape: function(graphie, options) {\n        if (options.editable && options.translatable) {\n            throw new Error(\n                \"It doesn't make sense to have a movable shape \" +\n                    \"where you can stretch the points and translate them \" +\n                    \"simultaneously. options: \" +\n                    JSON.stringify(options)\n            );\n        }\n\n        var shape;\n        var points = _.map(options.shape.coords, function(coord) {\n            var currentPoint;\n            var isMoving = false;\n            var previousCoord = coord;\n\n            var onMove = function(x, y) {\n                if (!isMoving) {\n                    previousCoord = currentPoint.coord;\n                    isMoving = true;\n                }\n\n                var moveVector = kvector.subtract([x, y], currentPoint.coord);\n\n                // Translate from (x, y) semantics to (dX, dY) semantics\n                // This is more useful for translations on multiple points,\n                // where we care about how the points moved, not where any\n                // individual point ended up\n                if (options.onMove) {\n                    moveVector = options.onMove(moveVector[0], moveVector[1]);\n                }\n\n                // Perform a translation on all points in this shape when\n                // any point moves\n                if (options.translatable) {\n                    _.each(points, function(point) {\n                        // The point itself will be updated by the\n                        // movablePoint class, so only translate the other\n                        // points\n                        if (point !== currentPoint) {\n                            point.setCoord(\n                                kvector.add(point.coord, moveVector)\n                            );\n                        }\n                    });\n                }\n\n                // Update our shape and our currentPoint\n                // Without this, some shapes (circles, angles) appear\n                // \"bouncy\" as they are updated with currentPoint at the\n                // current mouse coordinate (oldCoord), rather than newCoord\n                var oldCoord = currentPoint.coord;\n                var newCoord = kvector.add(currentPoint.coord, moveVector);\n                // Temporarily change our coordinate so that\n                // shape.update() sees the new coordinate\n                currentPoint.coord = newCoord;\n                shape.update();\n                // ...But don't break onMove, which assumes it\n                // is the only thing changing our coord\n                currentPoint.coord = oldCoord;\n                return newCoord;\n            };\n\n            var onMoveEnd = function() {\n                // onMove isn't guaranteed to be called before onMoveEnd, so\n                // we have to take into account that we may not have moved and\n                // set previousCoord.\n                if (options.onMoveEnd && isMoving) {\n                    isMoving = false;\n                    // We don't use the supplied x and y parameters here\n                    // because MovablePoint's onMoveEnd semantics suck.\n                    // It returns the mouseX, mouseY without processing them\n                    // through onMove, leaving us with weird fractional moves\n                    var change = kvector.subtract(\n                        currentPoint.coord,\n                        previousCoord\n                    );\n                    options.onMoveEnd(change[0], change[1]);\n                }\n                shape.update();\n            };\n\n            currentPoint = graphie.addMovablePoint({\n                coord: coord,\n                normalStyle: options.normalPointStyle,\n                highlightStyle: options.highlightPointStyle,\n                constraints: {\n                    fixed: !options.translatable && !options.editable,\n                },\n                visible: options.showPoints,\n                snapX: (options.snap && options.snap[0]) || 0,\n                snapY: (options.snap && options.snap[1]) || 0,\n                bounded: false, // Don't bound it when placing it on the graph\n                onMove: onMove,\n                onMoveEnd: onMoveEnd,\n            });\n\n            // Bound it when moving\n            // We can't set this earlier, because doing so would mean any\n            // points outside of the graph would be moved into a moved into\n            // a position that doesn't preserve the shape\n            currentPoint.bounded = true;\n\n            return currentPoint;\n        });\n\n        shape = ShapeTypes.addShape(graphie, options, points);\n        var removeShapeWithoutPoints = shape.remove;\n        shape.remove = function() {\n            removeShapeWithoutPoints.apply(shape);\n            _.invoke(points, \"remove\");\n        };\n        return shape;\n    },\n\n    addShape: function(graphie, options, points) {\n        points = points || options.shape.coords;\n\n        var types = ShapeTypes._typesOf(options.shape);\n        var typeOptions =\n            options.shape.options || ShapeTypes.defaultOptions(types);\n\n        var shapes = ShapeTypes._mapTypes(types, points, function(type, points, i) {\n            var shapeOptions = _.extend({}, options, typeOptions[i]);\n            return ShapeTypes._addType(graphie, type, points, shapeOptions);\n        });\n\n        var updateFuncs = _.filter(_.pluck(shapes, \"update\"), _.identity);\n        var update = function() {\n            _.invoke(updateFuncs, \"call\");\n        };\n\n        var removeFuncs = _.filter(_.pluck(shapes, \"remove\"), _.identity);\n        var remove = function() {\n            _.invoke(removeFuncs, \"call\");\n        };\n\n        var getOptions = function() {\n            return _.map(shapes, function(shape) {\n                if (shape.getOptions) {\n                    return shape.getOptions();\n                } else {\n                    return {};\n                }\n            });\n        };\n\n        var toJSON = function() {\n            var coords = _.map(points, function(pt) {\n                if (_.isArray(pt)) {\n                    return pt;\n                } else {\n                    return pt.coord;\n                }\n            });\n            return {\n                type: types,\n                coords: coords,\n                options: getOptions(),\n            };\n        };\n\n        return {\n            type: types,\n            points: points,\n            update: update,\n            remove: remove,\n            toJSON: toJSON,\n            getOptions: getOptions,\n        };\n    },\n\n    equal: function(shape1, shape2) {\n        var types1 = ShapeTypes._typesOf(shape1);\n        var types2 = ShapeTypes._typesOf(shape2);\n        if (types1.length !== types2.length) {\n            return false;\n        }\n        var shapes1 = ShapeTypes._mapTypes(\n            types1,\n            shape1.coords,\n            ShapeTypes._combine\n        );\n        var shapes2 = ShapeTypes._mapTypes(\n            types2,\n            shape2.coords,\n            ShapeTypes._combine\n        );\n        return _.all(\n            _.map(shapes1, function(partialShape1, i) {\n                var partialShape2 = shapes2[i];\n                if (partialShape1.type !== partialShape2.type) {\n                    return false;\n                }\n                return ShapeTypes._forType(partialShape1.type).equal(\n                    partialShape1.coords,\n                    partialShape2.coords\n                );\n            })\n        );\n    },\n\n    _typesOf: function(shape) {\n        var types = shape.type;\n        if (!_.isArray(types)) {\n            types = [types];\n        }\n        return _.map(types, function(type) {\n            if (type === \"polygon\") {\n                return \"polygon-3\";\n            } else {\n                return type;\n            }\n        });\n    },\n\n    defaultOptions: function(types) {\n        return _.map(types, function(type) {\n            var typeDefaultOptions = ShapeTypes._forType(type).defaultOptions;\n            return _.extend({}, typeDefaultOptions);\n        });\n    },\n\n    _forType: function(type) {\n        var baseType = type.split(\"-\")[0];\n        return ShapeTypes[baseType];\n    },\n\n    _mapTypes: function(types, points, func, context) {\n        return _.map(types, function(type, i) {\n            var pointCount = ShapeTypes.getPointCountForType(type);\n            var currentPoints = _.first(points, pointCount);\n            points = _.rest(points, pointCount);\n            return func.call(context, type, currentPoints, i);\n        });\n    },\n\n    _addType: function(graphie, type, points, options) {\n        var lineCoords = _.isArray(points[0])\n            ? {\n                  coordA: points[0],\n                  coordZ: points[1],\n              }\n            : {\n                  pointA: points[0],\n                  pointZ: points[1],\n              };\n\n        type = type.split(\"-\")[0];\n        if (type === \"polygon\") {\n            var polygon = graphie.addMovablePolygon(\n                _.extend({}, options, {\n                    fixed: !options.editable,\n                    snapX: (options.snap && options.snap[0]) || 0,\n                    snapY: (options.snap && options.snap[1]) || 0,\n                    points: points,\n                    constrainToGraph: false,\n                })\n            );\n            return {\n                update: polygon.transform.bind(polygon),\n                remove: polygon.remove.bind(polygon),\n            };\n        } else if (type === \"line\" || type === \"lineSegment\") {\n            var line = graphie.addMovableLineSegment(\n                _.extend({}, options, lineCoords, {\n                    movePointsWithLine: true,\n                    fixed: true,\n                    constraints: {\n                        fixed: true,\n                    },\n                    extendLine: type === \"line\",\n                })\n            );\n\n            // TODO(jack): Hide points on uneditable lines when translation\n            // is a vector.\n            // We can't just remove the points yet, because they are the\n            // translation handle for the line.\n            return {\n                update: line.transform.bind(line, true),\n                remove: line.remove.bind(line),\n            };\n        } else if (type === \"angle\") {\n            // If this angle is editable, we want to be able to make angles\n            // both larger and smaller than 180 degrees.\n            // If this angle is not editable, it should always maintain\n            // it's angle measure, even if it is reflected (causing the\n            // clockwise-ness of the points to change)\n            var shouldChangeReflexivity = options.editable ? null : false;\n\n            var angle = graphie.addMovableAngle({\n                angleLabel: \"$deg0\",\n                fixed: true,\n                points: points,\n                normalStyle: options.normalStyle,\n                reflex: options.reflex,\n            });\n\n            // Hide non-vertex points on uneditable angles\n            if (!_.isArray(points[0]) && !options.editable) {\n                points[0].remove();\n                points[2].remove();\n            }\n            return {\n                update: angle.update.bind(angle, shouldChangeReflexivity),\n                remove: angle.remove.bind(angle),\n                getOptions: function() {\n                    return {\n                        reflex: angle.isReflex(),\n                    };\n                },\n            };\n        } else if (type === \"circle\") {\n            var perimeter = {\n                // temporary object for the first removal\n                remove: _.identity,\n            };\n            var redrawPerim = function() {\n                var coord0 = points[0].coord || points[0];\n                var coord1 = points[1].coord || points[1];\n                var radius = kpoint.distanceToPoint(coord0, coord1);\n                perimeter.remove();\n                perimeter = graphie.circle(\n                    coord0,\n                    radius,\n                    _.extend(\n                        {\n                            stroke: KhanColors.DYNAMIC,\n                            \"stroke-width\": 2,\n                        },\n                        options.normalStyle\n                    )\n                );\n            };\n\n            redrawPerim();\n            if (points[1].remove && !options.editable) {\n                points[1].remove();\n            }\n\n            return {\n                update: redrawPerim,\n                remove: function() {\n                    // Not _.bind because the remove function changes\n                    // when the perimeter is redrawn\n                    perimeter.remove();\n                },\n            };\n        } else if (type === \"point\") {\n            // do nothing\n            return {\n                update: null,\n                remove: null,\n            };\n        } else {\n            throw new Error(\"Invalid shape type \" + type);\n        }\n    },\n\n    _combine: function(type, coords) {\n        return {\n            type: type,\n            coords: coords,\n        };\n    },\n\n    polygon: {\n        equal: orderInsensitiveCoordsEqual,\n    },\n\n    line: {\n        equal: kline.equal,\n    },\n\n    lineSegment: {\n        equal: orderInsensitiveCoordsEqual,\n    },\n\n    angle: {\n        equal: function(points1, points2) {\n            if (!kpoint.equal(points1[1], points2[1])) {\n                return false;\n            }\n\n            var line1_0 = [points1[1], points1[0]];\n            var line1_2 = [points1[1], points1[2]];\n            var line2_0 = [points2[1], points2[0]];\n            var line2_2 = [points2[1], points2[2]];\n\n            var equalUnflipped =\n                kray.equal(line1_0, line2_0) && kray.equal(line1_2, line2_2);\n            var equalFlipped =\n                kray.equal(line1_0, line2_2) && kray.equal(line1_2, line2_0);\n\n            return equalUnflipped || equalFlipped;\n        },\n\n        defaultOptions: {\n            reflex: false,\n        },\n    },\n\n    circle: {\n        equal: function(points1, points2) {\n            var radius1 = kpoint.distanceToPoint(points1[0], points1[1]);\n            var radius2 = kpoint.distanceToPoint(points2[0], points2[1]);\n            return (\n                kpoint.equal(points1[0], points2[0]) &&\n                knumber.equal(radius1, radius2)\n            );\n        },\n    },\n\n    point: {\n        equal: kpoint.equal,\n    },\n};\n\nvar TransformationListItem = TransformOps.ListItem;\n\nvar TransformationList = createReactClass({\n    render: function() {\n        if (this.props.mode === \"static\") {\n            return <span />; // don't render anything\n        }\n\n        var transformationList = _.map(\n            this.props.transformations,\n            function(transform, i) {\n                return (\n                    <TransformationListItem\n                        ref={\"transformation\" + i}\n                        key={\"transformation\" + i}\n                        transform={transform}\n                        mode={this.props.mode}\n                        onChange={this.handleChange}\n                        onFocus={_.partial(this.props.onFocus, \"\" + i)}\n                        onBlur={_.partial(this.props.onBlur, \"\" + i)}\n                        keypadElement={this.props.keypadElement}\n                        apiOptions={this.props.apiOptions}\n                    />\n                );\n            },\n            this\n        );\n\n        return (\n            <div className=\"perseus-transformation-list\">\n                {transformationList}\n            </div>\n        );\n    },\n\n    _transformationRefs: function() {\n        return _.times(this.props.transformations.length, i => {\n            return this.refs[\"transformation\" + i];\n        });\n    },\n\n    value: function() {\n        return _.invoke(this._transformationRefs(), \"value\");\n    },\n\n    handleChange: function(changed, callback) {\n        this.props.onChange(this.value(), callback);\n    },\n\n    focusLast: function() {\n        var transformationRefs = this._transformationRefs();\n        if (transformationRefs.length !== 0) {\n            _.last(transformationRefs).focus();\n        }\n    },\n});\n\nvar ToolButton = createReactClass({\n    render: function() {\n        var classes = this.props.toggled\n            ? \"simple-button exercise-orange toggled highlighted-tool-button\"\n            : \"simple-button\";\n\n        return (\n            <button\n                type=\"button\"\n                className={classes}\n                disabled={this.props.disabled}\n                onClick={this.props.onClick}\n                onTouchStart={captureScratchpadTouchStart}\n            >\n                {this.props.children}\n            </button>\n        );\n    },\n});\n\nvar ToolsBar = createReactClass({\n    getInitialState: function() {\n        return {\n            selected: null,\n        };\n    },\n\n    render: function() {\n        var tools = _.map(\n            Transformations,\n            function(tool, type) {\n                if (this.props.enabled[type]) {\n                    return (\n                        <ToolButton\n                            key={type}\n                            disabled={this.props.apiOptions.readOnly}\n                            toggled={this.state.selected === type}\n                            onClick={this.changeSelected.bind(this, type)}\n                        >\n                            {tool.verbName}\n                        </ToolButton>\n                    );\n                }\n            },\n            this\n        );\n\n        return (\n            <div className=\"transformer-tools-bar\">\n                <span className=\"simple-button-group\">\n                    {tools}\n                </span>\n                <button\n                    className=\"transformer-undo-button simple-button\"\n                    type=\"button\"\n                    disabled={this.props.apiOptions.readOnly}\n                    onClick={this.props.onUndoClick}\n                    onTouchStart={captureScratchpadTouchStart}\n                >\n                    <InlineIcon {...iconUndo} />\n                    {\" \" + i18n._(\"Undo\")}\n                </button>\n                <div className=\"clear\" />\n            </div>\n        );\n    },\n\n    changeSelected: function(tool) {\n        this.props.removeTool(this.state.selected);\n\n        if (!tool || tool === this.state.selected) {\n            this.setState({\n                selected: null,\n            });\n        } else {\n            this.props.addTool(tool);\n            this.setState({\n                selected: tool,\n            });\n        }\n    },\n});\n\nvar AddTransformBar = createReactClass({\n    render: function() {\n        var tools = _.map(\n            Transformations,\n            function(tool, type) {\n                if (this.props.enabled[type]) {\n                    return (\n                        <ToolButton\n                            key={type}\n                            toggled={false}\n                            disabled={this.props.apiOptions.readOnly}\n                            onClick={this.changeSelected.bind(this, type)}\n                        >\n                            <InlineIcon {...iconPlus} /> {tool.nounName}\n                        </ToolButton>\n                    );\n                }\n            },\n            this\n        );\n\n        return (\n            <div className=\"transformer-tools-bar\">\n                {tools}\n                <button\n                    className=\"transformer-undo-button simple-button\"\n                    type=\"button\"\n                    onClick={this.props.onUndoClick}\n                    disabled={this.props.apiOptions.readOnly}\n                    onTouchStart={captureScratchpadTouchStart}\n                >\n                    <InlineIcon {...iconUndo} />\n                    {\" \" + i18n._(\"Undo\")}\n                </button>\n                <div className=\"clear\" />\n            </div>\n        );\n    },\n\n    changeSelected: function(tool) {\n        if (tool) {\n            this.props.addTool(tool);\n        }\n    },\n});\n\nvar Transformer = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        keypadElement: keypadElementPropType,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return _.defaults(\n            {\n                transformations: [],\n            },\n            defaultTransformerProps\n        );\n    },\n\n    render: function() {\n        // Fill in any missing value in this.props.graph\n        // this can happen because the graph json doesn't include\n        // box, for example\n        var graph = _.extend(\n            defaultGraphProps(this.props.graph, defaultBoxSize),\n            this.props.graph\n        );\n\n        var interactiveToolsMode = this.props.graphMode === \"interactive\";\n\n        var ToolsBarClass = interactiveToolsMode ? ToolsBar : AddTransformBar;\n\n        // This style is applied inline because it is dependent on the\n        // size of the graph as set by the graph.box prop, and this also\n        // lets us specify it in the same place the graph's width is\n        // specified.\n        var toolsBar = (\n            <div style={{width: graph.box[0]}}>\n                <ToolsBarClass\n                    ref=\"toolsBar\"\n                    enabled={pluckObject(this.props.tools, \"enabled\")}\n                    apiOptions={this.props.apiOptions}\n                    addTool={this.addTool}\n                    removeTool={this.removeTool}\n                    onUndoClick={this.handleUndoClick}\n                />\n            </div>\n        );\n\n        return (\n            <div className={\"perseus-widget \" + \"perseus-widget-transformer\"}>\n                <Graph\n                    ref=\"graph\"\n                    box={graph.box}\n                    range={graph.range}\n                    labels={graph.labels}\n                    step={graph.step}\n                    gridStep={graph.gridStep}\n                    markings={graph.markings}\n                    backgroundImage={graph.backgroundImage}\n                    showProtractor={graph.showProtractor}\n                    onGraphieUpdated={this.setupGraphie}\n                    setDrawingAreaAvailable={\n                        this.props.apiOptions.setDrawingAreaAvailable\n                    }\n                />\n\n                {!interactiveToolsMode && \"Add transformations below:\"}\n\n                {this.props.graphMode === \"static\" && [\n                    <br key=\"static-br\" />,\n                    <em key=\"static-nomove\">\n                        {\" \"}Note: For this question, the shape will not\n                        move.{\" \"}\n                    </em>,\n                ]}\n\n                {interactiveToolsMode && toolsBar}\n\n                <TransformationList\n                    ref=\"transformationList\"\n                    mode={this.props.listMode}\n                    transformations={this.props.transformations}\n                    onChange={this.setTransformationProps}\n                    onFocus={this._handleFocus}\n                    onBlur={this._handleBlur}\n                    keypadElement={this.props.keypadElement}\n                    apiOptions={this.props.apiOptions}\n                />\n\n                {!interactiveToolsMode && toolsBar}\n            </div>\n        );\n    },\n\n    componentDidMount: function() {\n        this.setupGraphie(this.graphie());\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (this.shouldSetupGraphie(this.props, prevProps)) {\n            this.refs.graph.reset();\n        } else if (!deepEq(this.props.transformations, this.transformations)) {\n            this.setTransformations(this.props.transformations);\n        }\n    },\n\n    shouldSetupGraphie: function(nextProps, prevProps) {\n        if (!deepEq(prevProps.starting, nextProps.starting)) {\n            return true;\n        } else if (prevProps.graphMode !== nextProps.graphMode) {\n            return true;\n        } else if (prevProps.listMode !== nextProps.listMode) {\n            return true;\n        } else if (\n            prevProps.drawSolutionShape !== nextProps.drawSolutionShape\n        ) {\n            return true;\n        } else if (\n            nextProps.drawSolutionShape &&\n            !deepEq(prevProps.correct.shape, nextProps.correct.shape)\n        ) {\n            return true;\n        } else if (!deepEq(this.tools, nextProps.tools)) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n\n    graphie: function() {\n        return this.refs.graph.graphie();\n    },\n\n    setupGraphie: function(graphie) {\n        // A background image of our solution:\n        if (\n            this.props.drawSolutionShape &&\n            this.props.correct.shape &&\n            this.props.correct.shape.coords\n        ) {\n            ShapeTypes.addShape(graphie, {\n                fixed: true,\n                shape: this.props.correct.shape,\n                normalStyle: {\n                    stroke: KhanColors.GRAY,\n                    \"stroke-dasharray\": \"\",\n                    \"stroke-width\": 2,\n                },\n            });\n        }\n\n        this.currentTool = null;\n        this.refs.toolsBar.changeSelected(null);\n        this.addTransformerShape(\n            this.props.starting.shape,\n            /* translatable */ false\n        );\n        this.setTransformations(this.props.transformations);\n\n        // Save a copy of our tools so that we can check future\n        // this.props.tools changes against them\n        // This seems weird, but gives us an easy way to tell whether\n        // props changes were self-inflicted (for which a graphie reset\n        // is not required, and is in fact a bad idea right now because\n        // of resetting the size of the dilation tool).\n        // TODO (jack): A deepClone method would be nice here\n        this.tools = {\n            translation: _.clone(this.props.tools.translation),\n            rotation: _.clone(this.props.tools.rotation),\n            reflection: _.clone(this.props.tools.reflection),\n            dilation: _.clone(this.props.tools.dilation),\n        };\n    },\n\n    /* Applies all transformations in `transformations`\n     * to the starting shape, and updates this.transformations\n     * to reflect this\n     *\n     * Usually called with this.props.transformations\n     */\n    setTransformations: function(transformations) {\n        this.resetCoords();\n        this.transformations = _.clone(transformations);\n        _.each(this.transformations, this.applyTransform);\n    },\n\n    // the polygon that we transform\n    addTransformerShape: function(shape, translatable) {\n        var self = this;\n        var graphie = this.graphie();\n\n        this.shape = ShapeTypes.addMovableShape(graphie, {\n            shape: shape,\n            editable: false,\n            showPoints: this.props.graphMode !== \"static\",\n            translatable: translatable,\n            onMove: function(dX, dY) {\n                dX = KhanMath.roundToNearest(graphie.snap[0], dX);\n                dY = KhanMath.roundToNearest(graphie.snap[1], dY);\n                self.addTransform({\n                    type: \"translation\",\n                    vector: [dX, dY],\n                });\n                return [dX, dY];\n            },\n            normalPointStyle: {\n                fill: translatable\n                    ? KhanColors.INTERACTIVE\n                    : KhanColors.DYNAMIC,\n                stroke: translatable\n                    ? KhanColors.INTERACTIVE\n                    : KhanColors.DYNAMIC,\n            },\n            highlightPointStyle: {\n                fill: KhanColors.INTERACTING,\n                stroke: KhanColors.INTERACTING,\n            },\n        });\n    },\n\n    addTool: function(toolId) {\n        var self = this;\n\n        if (this.props.graphMode === \"interactive\") {\n            if (toolId === \"translation\") {\n                this.currentTool = this.addTranslationTool();\n            } else if (toolId === \"rotation\") {\n                this.currentTool = this.addRotationTool();\n            } else if (toolId === \"reflection\") {\n                this.currentTool = this.addReflectionTool();\n            } else if (toolId === \"dilation\") {\n                this.currentTool = this.addDilationTool();\n            } else {\n                throw new Error(\"Invalid tool id: \" + toolId);\n            }\n        } else {\n            var transform;\n            if (toolId === \"translation\") {\n                transform = {\n                    type: toolId,\n                    vector: [null, null],\n                };\n            } else if (toolId === \"rotation\") {\n                transform = {\n                    type: toolId,\n                    center: [null, null],\n                    angleDeg: null,\n                };\n            } else if (toolId === \"reflection\") {\n                // Reflections with nulls in them won't be applied until\n                // fills in the blanks\n                transform = {\n                    type: toolId,\n                    line: [[null, null], [null, null]],\n                };\n            } else if (toolId === \"dilation\") {\n                transform = {\n                    type: toolId,\n                    center: [null, null],\n                    scale: null,\n                };\n            } else {\n                throw new Error(\"Invalid tool id: \" + toolId);\n            }\n\n            this.doTransform(transform, function() {\n                self.refs.transformationList.focusLast();\n            });\n        }\n    },\n\n    removeTool: function(toolId) {\n        if (this.currentTool) {\n            this.currentTool.remove();\n        }\n        this.currentTool = null;\n    },\n\n    addTranslationTool: function() {\n        var self = this;\n        this.shape.remove();\n        this.addTransformerShape(this.shape.toJSON(), /* translatable */ true);\n\n        return {\n            remove: function() {\n                self.shape.remove();\n                self.addTransformerShape(\n                    self.shape.toJSON(),\n                    /* translatable */ false\n                );\n            },\n        };\n    },\n\n    // Snaps a coord to this.graphie()'s snap\n    snapCoord: function(coord) {\n        var graphie = this.graphie();\n        return _.map(coord, function(val, dim) {\n            return KhanMath.roundToNearest(graphie.snap[dim], val);\n        });\n    },\n\n    // Normalize the coords into something that fits the new 45 degree\n    // reflection line.\n    normalizeReflectionCoords: function(messyCoords) {\n        var midpoint = this.snapCoord(kline.midpoint(messyCoords));\n        var origDirectionPolar = kvector.polarDegFromCart(\n            kvector.subtract(messyCoords[0], messyCoords[1])\n        );\n        var directionPolar = [\n            1,\n            KhanMath.roundToNearest(45, origDirectionPolar[1]),\n        ];\n        var direction = kvector.cartFromPolarDeg(directionPolar);\n        var coords = _.map(\n            [-1, 1],\n            function(directionCoefficient) {\n                var coord = kvector.add(\n                    midpoint,\n                    kvector.scale(\n                        direction,\n                        directionCoefficient *\n                            this.scaleToCurrentRange(REFLECT_ROTATE_HANDLE_DIST)\n                    )\n                );\n                return this.snapCoord(coord);\n            },\n            this\n        );\n        return coords;\n    },\n\n    addReflectionTool: function() {\n        var options = this.props.tools.reflection;\n        if (!options.enabled) {\n            return;\n        }\n        var self = this;\n        var graphie = this.refs.graph.graphie();\n\n        var updateReflectionTool = function() {\n            self.changeTool(\"reflection\", {\n                coords: _.pluck(reflectPoints, \"coord\"),\n            });\n        };\n\n        var coords = this.normalizeReflectionCoords(options.coords);\n\n        // The points defining the line of reflection; hidden from the\n        // user.\n        var reflectPoints = _.map(\n            coords,\n            function(coord) {\n                return graphie.addMovablePoint({\n                    coord: coord,\n                    visible: false,\n                });\n            },\n            this\n        );\n\n        // the line of reflection\n        // TODO(jack): graphie.style here is a hack to prevent the dashed\n        // style from leaking into the rest of the shapes. Remove when\n        // graphie.addMovableLineSegment doesn't leak styles anymore.\n        var reflectLine;\n        var normalColor = colorForTool(options);\n        graphie.style({}, function() {\n            reflectLine = graphie.addMovableLineSegment({\n                fixed: options.constraints.fixed,\n                constraints: options.constraints,\n                pointA: reflectPoints[0],\n                pointZ: reflectPoints[1],\n                snapX: graphie.snap[0],\n                snapY: graphie.snap[1],\n                extendLine: true,\n                normalStyle: {\n                    stroke: normalColor,\n                    \"stroke-width\": 2,\n                    \"stroke-dasharray\": \"- \",\n                },\n                highlightStyle: {\n                    stroke: KhanColors.INTERACTING,\n                    \"stroke-width\": 2,\n                    \"stroke-dasharray\": \"- \", // TODO(jack) solid doesn't\n                    // work here, but would be\n                    // nicer\n                },\n                movePointsWithLine: true,\n                onMoveEnd: updateReflectionTool,\n            });\n        });\n\n        // the \"button\" point in the center of the line of reflection\n        var reflectButton = graphie.addReflectButton({\n            fixed: options.constraints.fixed,\n            line: reflectLine,\n            size: this.scaleToCurrentRange(REFLECT_BUTTON_SIZE),\n            onClick: function() {\n                self.doTransform({\n                    type: \"reflection\",\n                    line: _.pluck(reflectPoints, \"coord\"),\n                });\n                if (reflectRotateHandle) {\n                    // flip the rotation handle\n                    reflectRotateHandle.setCoord(\n                        kvector.add(\n                            reflectButton.coord,\n                            kvector.subtract(\n                                reflectButton.coord,\n                                reflectRotateHandle.coord\n                            )\n                        )\n                    );\n                    reflectRotateHandle.update();\n                }\n            },\n            normalStyle: {\n                stroke: normalColor,\n                \"stroke-width\": 2,\n                fill: normalColor,\n            },\n            highlightStyle: {\n                stroke: KhanColors.INTERACTING,\n                \"stroke-width\": 3,\n                fill: KhanColors.INTERACTING,\n            },\n            onMoveEnd: updateReflectionTool,\n        });\n\n        var reflectRotateHandle = null;\n        if (!options.constraints.fixed) {\n            // The rotation handle for rotating the line of reflection\n            var initRotateHandleAngle =\n                kvector.polarDegFromCart(\n                    kvector.subtract(\n                        reflectPoints[1].coord,\n                        reflectPoints[0].coord\n                    )\n                )[1] + 90; // 90 degrees off of the line\n            reflectRotateHandle = graphie.addRotateHandle({\n                center: reflectButton,\n                radius: this.scaleToCurrentRange(REFLECT_ROTATE_HANDLE_DIST),\n                angleDeg: initRotateHandleAngle,\n                width: this.scaleToCurrentRange(0.24),\n                hoverWidth: this.scaleToCurrentRange(0.4),\n                lengthAngle: 17,\n                onMove: function(newAngle) {\n                    return KhanMath.roundToNearest(45, newAngle);\n                },\n                onMoveEnd: updateReflectionTool,\n            });\n        }\n\n        // Move the reflectButton and reflectRotateHandle with the line\n        $(reflectLine).on(\"move\", function() {\n            reflectButton.update();\n            $(reflectButton).trigger(\"move\"); // update the rotation handle,\n            // which watches for this in util/interactive.js.\n        });\n\n        // Update the line and reflect button when the reflectRotateHandle is\n        // rotated\n        if (reflectRotateHandle) {\n            $(reflectRotateHandle).on(\"move\", function() {\n                var rotateHandleApprox = self.snapCoord(\n                    reflectRotateHandle.coord\n                );\n\n                var rotateVector = kvector.subtract(\n                    rotateHandleApprox,\n                    reflectButton.coord\n                );\n\n                var flipped = reflectButton.isFlipped() ? 1 : 0;\n                reflectPoints[flipped].setCoord(\n                    kvector.add(\n                        reflectButton.coord,\n                        kvector.rotateDeg(rotateVector, 90)\n                    )\n                );\n                reflectPoints[1 - flipped].setCoord(\n                    kvector.add(\n                        reflectButton.coord,\n                        kvector.rotateDeg(rotateVector, -90)\n                    )\n                );\n\n                reflectLine.transform(true);\n                reflectButton.update();\n            });\n        }\n\n        return {\n            remove: function() {\n                reflectButton.remove();\n                if (reflectRotateHandle) {\n                    reflectRotateHandle.remove();\n                }\n                reflectLine.remove();\n                reflectPoints[0].remove();\n                reflectPoints[1].remove();\n            },\n        };\n    },\n\n    /* Scales a distance from the default range of\n     * [-10, 10] to the current this.props.graph.range\n     *\n     * Used for sizing various transformation tools\n     * (rotation handle, dilation circle)\n     */\n    scaleToCurrentRange: function(dist) {\n        return scaleToRange(dist, this.refs.graph.props.range);\n    },\n\n    addRotationTool: function() {\n        var options = this.props.tools.rotation;\n        if (!options.enabled) {\n            return;\n        }\n        var self = this;\n        var graphie = this.refs.graph.graphie();\n\n        var pointColor = colorForTool(options);\n        // The center of our rotation, which can be moved to change the\n        // center of rotation\n        this.rotatePoint = graphie.addMovablePoint({\n            constraints: options.constraints,\n            coord: options.coord,\n            snapX: graphie.snap[0],\n            snapY: graphie.snap[1],\n            normalStyle: {\n                // ugh, this seems to be a global and\n                \"stroke-dasharray\": \"\", // is set to dash above\n                stroke: pointColor,\n                fill: pointColor,\n            },\n            highlightStyle: {\n                \"stroke-dasharray\": \"\",\n                stroke: KhanColors.INTERACTING,\n                fill: KhanColors.INTERACTING,\n            },\n        });\n\n        // The point that we move around the center of rotation to actually\n        // cause rotations\n        this.rotateHandle = graphie.addRotateHandle({\n            center: this.rotatePoint,\n            radius: this.scaleToCurrentRange(ROTATE_HANDLE_DIST),\n            width: this.scaleToCurrentRange(0.24),\n            hoverWidth: this.scaleToCurrentRange(0.4),\n            onMove: function(newAngle, oldAngle) {\n                var transform = self.getRotationTransformFromAngle(\n                    self.rotatePoint.coord,\n                    newAngle - oldAngle\n                );\n\n                // Rotate polygon with rotateHandle\n                self.doTransform(transform);\n\n                return oldAngle + transform.angleDeg;\n            },\n        });\n\n        // Update tools.rotation.coord\n        this.rotatePoint.onMoveEnd = function(x, y) {\n            self.changeTool(\"rotation\", {\n                coord: [x, y],\n            });\n        };\n\n        return {\n            remove: function() {\n                self.rotateHandle.remove();\n                self.rotatePoint.remove();\n            },\n        };\n    },\n\n    addDilationTool: function() {\n        var options = this.props.tools.dilation;\n        if (!options.enabled) {\n            return;\n        }\n        var self = this;\n        var graphie = this.refs.graph.graphie();\n\n        var pointColor = colorForTool(options);\n        // the circle for causing dilation transforms\n        self.dilationCircle = graphie.addCircleGraph({\n            centerConstraints: options.constraints,\n            center: options.coord,\n            radius: self.scaleToCurrentRange(2),\n            snapX: graphie.snap[0],\n            snapY: graphie.snap[1],\n            minRadius: self.scaleToCurrentRange(1),\n            snapRadius: self.scaleToCurrentRange(0.5),\n            onResize: function(newRadius, oldRadius) {\n                self.doTransform({\n                    type: \"dilation\",\n                    center: self.dilationCircle.centerPoint.coord,\n                    scale: newRadius / oldRadius,\n                });\n            },\n            circleNormalStyle: {\n                stroke: pointColor,\n                \"stroke-width\": 2,\n                \"stroke-dasharray\": \"- \",\n                \"fill-opacity\": 0,\n            },\n            circleHighlightStyle: {\n                stroke: KhanColors.INTERACTING,\n                \"stroke-width\": 2,\n                \"stroke-dasharray\": \"\",\n                fill: KhanColors.INTERACTING,\n                \"fill-opacity\": 0.05,\n            },\n            centerNormalStyle: {\n                stroke: pointColor,\n                fill: pointColor,\n                \"stroke-width\": 2,\n                \"stroke-dasharray\": \"\",\n            },\n            centerHighlightStyle: {\n                stroke: pointColor,\n                fill: pointColor,\n                \"stroke-width\": 2,\n                \"stroke-dasharray\": \"\",\n            },\n        });\n\n        var origOnMoveEnd = this.dilationCircle.centerPoint.onMoveEnd;\n        this.dilationCircle.centerPoint.onMoveEnd = function() {\n            if (origOnMoveEnd) {\n                origOnMoveEnd.apply(this, _.toArray(arguments));\n            }\n            self.changeTool(\"dilation\", {\n                coord: self.dilationCircle.centerPoint.coord,\n            });\n        };\n\n        return {\n            remove: function() {\n                self.dilationCircle.remove();\n            },\n        };\n    },\n\n    // returns a transformation object representing a rotation\n    // rounds the angle to the nearest 15 degrees\n    getRotationTransformFromAngle: function(center, angleChanged) {\n        angleChanged = (angleChanged + 360) % 360;\n        if (angleChanged > 180) {\n            angleChanged -= 360;\n        }\n        var roundedAngle =\n            Math.round(angleChanged / ROTATE_SNAP_DEGREES) *\n            ROTATE_SNAP_DEGREES;\n\n        return {\n            type: \"rotation\",\n            center: center,\n            angleDeg: roundedAngle,\n        };\n    },\n\n    // apply and save a transform\n    doTransform: function(transform, callback) {\n        this.applyTransform(transform);\n        this.addTransform(transform, callback);\n    },\n\n    // apply a transform to our polygon (without modifying our transformation\n    // list)\n    applyTransform: function(transform) {\n        if (this.props.graphMode !== \"static\") {\n            var transformFunc = TransformOps.apply(transform);\n            this.applyCoordTransformation(transformFunc);\n        }\n    },\n\n    // transform our polygon by transforming each point using a given function\n    applyCoordTransformation: function(pointTransform) {\n        _.each(this.shape.points, function(point) {\n            var newCoord = pointTransform(point.coord);\n            point.setCoord(newCoord);\n        });\n        this.shape.update();\n    },\n\n    resetCoords: function() {\n        var startCoords = this.props.starting.shape.coords;\n        _.each(this.shape.points, function(point, i) {\n            point.setCoord(startCoords[i]);\n        });\n        this.shape.update();\n    },\n\n    // Remove the last transformation\n    handleUndoClick: function() {\n        this.refs.toolsBar.changeSelected(null);\n        if (this.props.transformations.length) {\n            this.props.onChange({\n                transformations: _.initial(this.props.transformations),\n            });\n        }\n    },\n\n    setTransformationProps: function(newTransfomationList, callback) {\n        this.props.onChange(\n            {\n                transformations: newTransfomationList,\n            },\n            callback\n        );\n    },\n\n    // add a transformation to our props list of transformation\n    addTransform: function(transform, callback) {\n        this.transformations = TransformOps.append(\n            this.transformations,\n            transform\n        );\n        this.props.onChange(\n            {\n                transformations: _.clone(this.transformations),\n            },\n            callback\n        );\n    },\n\n    changeTool: function(tool, changes) {\n        var newTools = _.clone(this.props.tools);\n        newTools[tool] = _.extend({}, this.props.tools[tool], changes);\n        this.tools[tool] = _.clone(newTools[tool]);\n        this.props.onChange({\n            tools: newTools,\n        });\n        this.props.trackInteraction();\n    },\n\n    simpleValidate: function(rubric) {\n        return Transformer.validate(this.getUserInput(), rubric);\n    },\n\n    /**\n     * Calculate where the coordinates would be if they were\n     * moved, even if we're in formal mode with no movement\n     * (and thus the actual movablepoints may not have moved\n     */\n    getCoords: function() {\n        var startCoords = this.props.starting.shape.coords;\n        var transforms = this.props.transformations;\n        return _.reduce(\n            transforms,\n            function(coords, transform) {\n                return _.map(coords, TransformOps.apply(transform));\n            },\n            startCoords\n        );\n    },\n\n    getEditorJSON: function() {\n        var json = _.pick(\n            this.props,\n            \"grading\",\n            \"starting\",\n            \"graphMode\",\n            \"listMode\",\n            \"tools\",\n            \"drawSolutionShape\",\n            \"gradeEmpty\"\n        );\n        json.graph = this.refs.graph.toJSON();\n        json.version = 1.2; // Give us some safety to change the format\n        // when we realize that I wrote\n        // a horrible json spec for this widget\n\n        json.answer = this.getUserInput();\n        return json;\n    },\n\n    getUserInput: function() {\n        return {\n            transformations: this.props.transformations,\n            // This doesn't call this.shape.toJSON() because that doesn't\n            // handle coordinates in formal mode without movement, since\n            // the movablepoints never move\n            shape: {\n                type: this.shape.type,\n                coords: this.getCoords(),\n                options: this.shape.getOptions(),\n            },\n        };\n    },\n\n    /* InputPath API */\n\n    _handleFocus: function() {\n        var path = Array.prototype.slice.call(arguments);\n        this.props.onFocus(path);\n    },\n\n    _handleBlur: function() {\n        var path = Array.prototype.slice.call(arguments);\n        this.props.onBlur(path);\n    },\n\n    _getTransformationForID: function(transformationID) {\n        // Returns the 'transformation' component corresponding to a given ID\n        var refPath = [\n            \"transformationList\",\n            \"transformation\" + transformationID,\n        ];\n\n        // Follow the path of references\n        var component = this;\n        _.each(refPath, ref => {\n            component = component.refs[ref];\n        });\n        return component;\n    },\n\n    getInputPaths: function() {\n        // If we're in static mode, then there is no transformation list, and,\n        // as a result, no input paths.\n        if (this.props.listMode === \"static\") {\n            return [];\n        }\n\n        var inputPaths = [];\n        _.each(this.props.transformations, (transformation, i) => {\n            var transformation = this._getTransformationForID(i);\n            var innerPaths = transformation.getInputPaths();\n            var fullPaths = _.map(innerPaths, innerPath => {\n                return [\"\" + i].concat(innerPath);\n            });\n            inputPaths = inputPaths.concat(fullPaths);\n        });\n        return inputPaths;\n    },\n\n    _passToInner: function(functionName, path) {\n        if (!path || !path.length) {\n            return;\n        }\n\n        // First argument tells us which transformation will receive the call;\n        // remaining arguments are used within that transformation to identify\n        // a specific input.\n        var innerPath = _.rest(path);\n        var args = [innerPath].concat(_.rest(arguments, 2));\n\n        // Pass arguments down to appropriate 'transformation' component\n        var transformationID = _.head(path);\n        var caller = this._getTransformationForID(transformationID);\n        return caller[functionName].apply(caller, args);\n    },\n\n    focus: function() {\n        // Just focus the first showing input\n        var inputs = this.getInputPaths();\n        if (inputs.length > 0) {\n            this.focusInputPath(inputs[0]);\n            return true;\n        }\n        return false;\n    },\n\n    focusInputPath: function(path) {\n        // Since the transformer exposes the input API, it needs to be robust\n        // to empty paths. We don't expect this to happen, as entire-widget\n        // focusing is typically done through the focus() method, which already\n        // handles the empty path case properly, but it's better to be safe\n        // here.\n        if (path.length === 0) {\n            return false;\n        }\n\n        assert(path.length >= 2);\n        return this._passToInner(\"focusInputPath\", path);\n    },\n\n    blurInputPath: function(path) {\n        // Since the transformer exposes the input API, it needs to be robust\n        // to empty paths (which indicate a blurring of the entire widget,\n        // e.g., when switching from interacting with the transformer to\n        // interacting with some other widget).\n        if (path.length === 0) {\n            return false;\n        }\n\n        assert(path.length >= 2);\n        return this._passToInner(\"blurInputPath\", path);\n    },\n\n    setInputValue: function(path, value, cb) {\n        assert(path.length >= 2);\n        return this._passToInner(\"setInputValue\", path, value, cb);\n    },\n\n    getDOMNodeForPath: function(path) {\n        assert(path.length >= 2);\n        return this._passToInner(\"getDOMNodeForPath\", path);\n    },\n\n    getGrammarTypeForPath: function(path) {\n        assert(path.length >= 2);\n        return this._passToInner(\"getGrammarTypeForPath\", path);\n    },\n});\n\n_.extend(Transformer, {\n    validate: function(guess, rubric) {\n        // Check for any required transformations\n        for (var type in Transformations) {\n            if (rubric.tools[type].required) {\n                var isUsed = _.any(\n                    _.map(guess.transformations, function(transform) {\n                        // Required transformations must appear in the\n                        // transformation list, and must not be no-ops\n                        return (\n                            transform.type === type &&\n                            !TransformOps.isEmpty(transform) &&\n                            !TransformOps.isNoOp(transform)\n                        );\n                    })\n                );\n\n                if (!isUsed) {\n                    return {\n                        type: \"invalid\",\n                        message: i18n._(\n                            \"Your transformation must use a \" + \"%(type)s.\",\n                            {\n                                type: Transformations[type].lowerNounName,\n                            }\n                        ),\n                    };\n                }\n            }\n        }\n\n        // Compare shapes\n        if (ShapeTypes.equal(guess.shape, rubric.correct.shape)) {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: null,\n            };\n        } else if (\n            !rubric.gradeEmpty &&\n            deepEq(guess.shape.coords, rubric.starting.shape.coords)\n        ) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\n                    \"Use the interactive graph to define a \" +\n                        \"correct transformation.\"\n                ),\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n_module_.exports = {\n    name: \"transformer\",\n    displayName: \"Transformer\",\n    widget: Transformer,\n};\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/prop-types, react/sort-comp */\n\nconst React = _react;\nconst _ = _underscore;\n\n/* A checkbox that syncs its value to props using the\n * renderer's onChange method, and gets the prop name\n * dynamically from its props list\n */\nconst PropCheckBox = createReactClass({\n    propTypes: {\n        labelAlignment: PropTypes.oneOf([\"left\", \"right\"]),\n    },\n\n    DEFAULT_PROPS: {\n        label: null,\n        onChange: null,\n        labelAlignment: \"left\",\n    },\n\n    getDefaultProps: function() {\n        return this.DEFAULT_PROPS;\n    },\n\n    propName: function() {\n        const propName = _.find(\n            _.keys(this.props),\n            function(localPropName) {\n                return !_.has(this.DEFAULT_PROPS, localPropName);\n            },\n            this\n        );\n\n        if (!propName) {\n            throw new Error(\n                \"Attempted to create a PropCheckBox with no prop!\"\n            );\n        }\n\n        return propName;\n    },\n\n    _labelAlignLeft: function() {\n        return this.props.labelAlignment === \"left\";\n    },\n\n    render: function() {\n        const propName = this.propName();\n        return (\n            <label>\n                {this._labelAlignLeft() && this.props.label}\n                <input\n                    type=\"checkbox\"\n                    checked={this.props[propName]}\n                    onChange={this.toggle}\n                />\n                {!this._labelAlignLeft() && this.props.label}\n            </label>\n        );\n    },\n\n    toggle: function() {\n        const propName = this.propName();\n        const changes = {};\n        changes[propName] = !this.props[propName];\n        this.props.onChange(changes);\n    },\n});\n\n_module_.exports = PropCheckBox;\nexport default _module_.exports;\n","import _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types, react/sort-comp */\n\nconst React = _react;\nconst NumberInput = _componentsNumberInputJsx;\n\nconst truth = () => true;\n\n/* A minor abstraction on top of NumberInput for ranges\n *\n */\nconst RangeInput = createReactClass({\n    propTypes: {\n        value: PropTypes.array.isRequired,\n        onChange: PropTypes.func.isRequired,\n        placeholder: PropTypes.array,\n        checkValidity: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            placeholder: [null, null],\n        };\n    },\n\n    render: function() {\n        const value = this.props.value;\n        const checkValidity = this.props.checkValidity || truth;\n\n        return (\n            <div className=\"range-input\">\n                <NumberInput\n                    {...this.props}\n                    value={value[0]}\n                    checkValidity={val => checkValidity([val, value[1]])}\n                    onChange={this.onChange.bind(this, 0)}\n                    placeholder={this.props.placeholder[0]}\n                />\n                <NumberInput\n                    {...this.props}\n                    value={value[1]}\n                    checkValidity={val => checkValidity([value[0], val])}\n                    onChange={this.onChange.bind(this, 1)}\n                    placeholder={this.props.placeholder[1]}\n                />\n            </div>\n        );\n    },\n\n    onChange: function(i, newVal) {\n        const value = this.props.value;\n        if (i === 0) {\n            this.props.onChange([newVal, value[1]]);\n        } else {\n            this.props.onChange([value[0], newVal]);\n        }\n    },\n});\n\n_module_.exports = RangeInput;\nexport default _module_.exports;\n","import { interactiveSizes } from \"../styles/constants.js\";\nimport _utilMathJs from \"../util/math.js\";\nimport _utilJs from \"../util.js\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst RangeInput = _componentsRangeInputJsx;\nconst TeX = _reactComponentsTexJsx;\nconst Util = _utilJs;\nconst KhanMath = _utilMathJs;\n\nconst defaultBackgroundImage = {\n    url: null,\n    width: 0,\n    height: 0,\n};\n\nfunction numSteps(range, step) {\n    return Math.floor((range[1] - range[0]) / step);\n}\n\nconst GraphSettings = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        editableSettings: PropTypes.arrayOf(\n            PropTypes.oneOf([\n                \"canvas\",\n                \"graph\",\n                \"snap\",\n                \"image\",\n                \"measure\",\n            ])\n        ),\n        box: PropTypes.arrayOf(PropTypes.number),\n        labels: PropTypes.arrayOf(PropTypes.string),\n        range: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.number)\n        ),\n        step: PropTypes.arrayOf(PropTypes.number),\n        gridStep: PropTypes.arrayOf(PropTypes.number),\n        snapStep: PropTypes.arrayOf(PropTypes.number),\n        valid: PropTypes.oneOfType([\n            PropTypes.bool,\n            PropTypes.string,\n        ]),\n        backgroundImage: PropTypes.object,\n        markings: PropTypes.oneOf([\"graph\", \"grid\", \"none\"]),\n        showProtractor: PropTypes.bool,\n        showRuler: PropTypes.bool,\n        showTooltips: PropTypes.bool,\n        rulerLabel: PropTypes.string,\n        rulerTicks: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            editableSettings: [\"graph\", \"snap\", \"image\", \"measure\"],\n            box: [\n                interactiveSizes.defaultBoxSizeSmall,\n                interactiveSizes.defaultBoxSizeSmall,\n            ],\n            labels: [\"x\", \"y\"],\n            range: [[-10, 10], [-10, 10]],\n            step: [1, 1],\n            gridStep: [1, 1],\n            snapStep: [1, 1],\n            valid: true,\n            backgroundImage: defaultBackgroundImage,\n            markings: \"graph\",\n            showProtractor: false,\n            showRuler: false,\n            showTooltips: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n        };\n    },\n\n    getInitialState: function() {\n        return this.stateFromProps(this.props);\n    },\n\n    componentDidMount: function() {\n        this.changeGraph = _.debounce(this.changeGraph, 300);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        // Make sure that state updates when switching\n        // between different items in a multi-item editor.\n        if (\n            !_.isEqual(this.props.labels, nextProps.labels) ||\n            !_.isEqual(this.props.gridStep, nextProps.gridStep) ||\n            !_.isEqual(this.props.snapStep, nextProps.snapStep) ||\n            !_.isEqual(this.props.step, nextProps.step) ||\n            !_.isEqual(this.props.range, nextProps.range) ||\n            !_.isEqual(this.props.backgroundImage, nextProps.backgroundImage)\n        ) {\n            this.setState(this.stateFromProps(nextProps));\n        }\n    },\n\n    stateFromProps: function(props) {\n        return {\n            labelsTextbox: props.labels,\n            gridStepTextbox: props.gridStep,\n            snapStepTextbox: props.snapStep,\n            stepTextbox: props.step,\n            rangeTextbox: props.range,\n            backgroundImage: _.clone(props.backgroundImage),\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    // TODO(aria): Make either a wrapper for standard events to work\n    // with this.change, or make these use some TextInput/NumberInput box\n    changeRulerLabel: function(e) {\n        this.change({rulerLabel: e.target.value});\n    },\n\n    changeRulerTicks: function(e) {\n        this.change({rulerTicks: +e.target.value});\n    },\n\n    changeBackgroundUrl: function(e) {\n        // Only continue on blur or \"enter\"\n        if (e.type === \"keypress\" && e.key !== \"Enter\") {\n            return;\n        }\n\n        const setUrl = (url, width, height) => {\n            const image = _.clone(this.props.backgroundImage);\n            image.url = url;\n            image.width = width;\n            image.height = height;\n            this.setState(\n                {\n                    backgroundImage: image,\n                },\n                this.changeGraph\n            );\n        };\n\n        const url = ReactDOM.findDOMNode(this.refs[\"bg-url\"]).value;\n        if (url) {\n            Util.getImageSize(url, (width, height) => {\n                if (this.isMounted()) {\n                    setUrl(url, width, height);\n                }\n            });\n        } else {\n            setUrl(null, 0, 0);\n        }\n    },\n\n    renderLabelChoices: function(choices) {\n        return _.map(choices, function(nameAndValue) {\n            return (\n                <option value={nameAndValue[1]}>\n                    {nameAndValue[0]}\n                </option>\n            );\n        });\n    },\n\n    validRange: function(range) {\n        const numbers = _.every(range, function(num) {\n            return _.isFinite(num);\n        });\n        if (!numbers) {\n            return \"Range must be a valid number\";\n        }\n        if (range[0] >= range[1]) {\n            return \"Range must have a higher number on the right\";\n        }\n        return true;\n    },\n\n    validateStepValue: function(settings) {\n        const {step, range, name, minTicks, maxTicks} = settings;\n\n        if (!_.isFinite(step)) {\n            return name + \" must be a valid number\";\n        }\n        const nSteps = numSteps(range, step);\n        if (nSteps < minTicks) {\n            return (\n                name +\n                \" is too large, there must be at least \" +\n                minTicks +\n                \" ticks.\"\n            );\n        }\n        if (nSteps > maxTicks) {\n            return (\n                name +\n                \" is too small, there can be at most \" +\n                maxTicks +\n                \" ticks.\"\n            );\n        }\n        return true;\n    },\n\n    validSnapStep: function(step, range) {\n        return this.validateStepValue({\n            step: step,\n            range: range,\n            name: \"Snap step\",\n            minTicks: 5,\n            maxTicks: 60,\n        });\n    },\n\n    validGridStep: function(step, range) {\n        return this.validateStepValue({\n            step: step,\n            range: range,\n            name: \"Grid step\",\n            minTicks: 3,\n            maxTicks: 60,\n        });\n    },\n\n    validStep: function(step, range) {\n        return this.validateStepValue({\n            step: step,\n            range: range,\n            name: \"Step\",\n            minTicks: 3,\n            maxTicks: 20,\n        });\n    },\n\n    validBackgroundImageSize: function(image) {\n        // Ignore empty images\n        if (!image.url) {\n            return true;\n        }\n\n        const validSize = image.width <= 450 && image.height <= 450;\n\n        if (!validSize) {\n            return \"Image must be smaller than 450px x 450px.\";\n        }\n        return true;\n    },\n\n    validateGraphSettings: function(range, step, gridStep, snapStep, image) {\n        const self = this;\n        let msg;\n        const goodRange = _.every(range, function(range) {\n            msg = self.validRange(range);\n            return msg === true;\n        });\n        if (!goodRange) {\n            return msg;\n        }\n        const goodStep = _.every(step, function(step, i) {\n            msg = self.validStep(step, range[i]);\n            return msg === true;\n        });\n        if (!goodStep) {\n            return msg;\n        }\n        const goodGridStep = _.every(gridStep, function(gridStep, i) {\n            msg = self.validGridStep(gridStep, range[i]);\n            return msg === true;\n        });\n        if (!goodGridStep) {\n            return msg;\n        }\n        const goodSnapStep = _.every(snapStep, function(snapStep, i) {\n            msg = self.validSnapStep(snapStep, range[i]);\n            return msg === true;\n        });\n        if (!goodSnapStep) {\n            return msg;\n        }\n        const goodImageSize = this.validBackgroundImageSize(image);\n        if (goodImageSize !== true) {\n            msg = goodImageSize;\n            return msg;\n        }\n        return true;\n    },\n\n    changeLabel: function(i, e) {\n        const val = e.target.value;\n        const labels = this.state.labelsTextbox.slice();\n        labels[i] = val;\n        this.setState({labelsTextbox: labels}, this.changeGraph);\n    },\n\n    changeRange: function(i, values) {\n        const ranges = this.state.rangeTextbox.slice();\n        ranges[i] = values;\n        const step = this.state.stepTextbox.slice();\n        const gridStep = this.state.gridStepTextbox.slice();\n        const snapStep = this.state.snapStepTextbox.slice();\n        const scale = Util.scaleFromExtent(ranges[i], this.props.box[i]);\n        if (this.validRange(ranges[i]) === true) {\n            step[i] = Util.tickStepFromExtent(ranges[i], this.props.box[i]);\n            gridStep[i] = Util.gridStepFromTickStep(step[i], scale);\n            snapStep[i] = gridStep[i] / 2;\n        }\n        this.setState(\n            {\n                stepTextbox: step,\n                gridStepTextbox: gridStep,\n                snapStepTextbox: snapStep,\n                rangeTextbox: ranges,\n            },\n            this.changeGraph\n        );\n    },\n\n    changeStep: function(step) {\n        this.setState({stepTextbox: step}, this.changeGraph);\n    },\n\n    changeSnapStep: function(snapStep) {\n        this.setState({snapStepTextbox: snapStep}, this.changeGraph);\n    },\n\n    changeGridStep: function(gridStep) {\n        this.setState(\n            {\n                gridStepTextbox: gridStep,\n                snapStepTextbox: _.map(gridStep, function(step) {\n                    return step / 2;\n                }),\n            },\n            this.changeGraph\n        );\n    },\n\n    changeGraph: function() {\n        const labels = this.state.labelsTextbox;\n        const range = _.map(this.state.rangeTextbox, function(range) {\n            return _.map(range, Number);\n        });\n        const step = _.map(this.state.stepTextbox, Number);\n        const gridStep = this.state.gridStepTextbox;\n        const snapStep = this.state.snapStepTextbox;\n        const image = this.state.backgroundImage;\n\n        // validationResult is either:\n        //   true -> the settings are valid\n        //   a string -> the settings are invalid, and the explanation\n        //               is contained in the string\n        // TODO(aria): Refactor this to not be confusing\n        const validationResult = this.validateGraphSettings(\n            range,\n            step,\n            gridStep,\n            snapStep,\n            image\n        );\n\n        if (validationResult === true) {\n            // either true or a string\n            this.change({\n                valid: true,\n                labels: labels,\n                range: range,\n                step: step,\n                gridStep: gridStep,\n                snapStep: snapStep,\n                backgroundImage: image,\n            });\n        } else {\n            this.change({\n                valid: validationResult, // a string message, not false\n            });\n        }\n    },\n\n    render: function() {\n        const scale = [\n            KhanMath.roundTo(\n                2,\n                Util.scaleFromExtent(this.props.range[0], this.props.box[0])\n            ),\n            KhanMath.roundTo(\n                2,\n                Util.scaleFromExtent(this.props.range[1], this.props.box[1])\n            ),\n        ];\n\n        return (\n            <div>\n                {_.contains(this.props.editableSettings, \"canvas\") &&\n                    <div className=\"graph-settings\">\n                        <div className=\"perseus-widget-row\">\n                            Canvas size (x,y pixels)\n                            <RangeInput\n                                value={this.props.box}\n                                onChange={box => {\n                                    this.change({box: box});\n                                }}\n                            />\n                        </div>\n                        <div className=\"perseus-widget-row\">\n                            Scale (px per div):{\" \"}\n                            <TeX>{\"(\" + scale[0] + \", \" + scale[1] + \")\"}</TeX>\n                        </div>\n                    </div>}\n\n                {_.contains(this.props.editableSettings, \"graph\") &&\n                    <div className=\"graph-settings\">\n                        <div className=\"perseus-widget-row\">\n                            <div className=\"perseus-widget-left-col\">\n                                {\" \"}x Label\n                                <input\n                                    type=\"text\"\n                                    className=\"graph-settings-axis-label\"\n                                    ref=\"labels-0\"\n                                    onChange={e => this.changeLabel(0, e)}\n                                    value={this.state.labelsTextbox[0]}\n                                />\n                            </div>\n                            <div className=\"perseus-widget-right-col\">\n                                y Label\n                                <input\n                                    type=\"text\"\n                                    className=\"graph-settings-axis-label\"\n                                    ref=\"labels-1\"\n                                    onChange={e => this.changeLabel(1, e)}\n                                    value={this.state.labelsTextbox[1]}\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"perseus-widget-row\">\n                            <div className=\"perseus-widget-left-col\">\n                                x Range\n                                <RangeInput\n                                    value={this.state.rangeTextbox[0]}\n                                    onChange={vals => this.changeRange(0, vals)}\n                                />\n                            </div>\n                            <div className=\"perseus-widget-right-col\">\n                                y Range\n                                <RangeInput\n                                    value={this.state.rangeTextbox[1]}\n                                    onChange={vals => this.changeRange(1, vals)}\n                                />\n                            </div>\n                        </div>\n                        <div className=\"perseus-widget-row\">\n                            <div className=\"perseus-widget-left-col\">\n                                Tick Step\n                                <RangeInput\n                                    value={this.state.stepTextbox}\n                                    onChange={this.changeStep}\n                                />\n                            </div>\n                            <div className=\"perseus-widget-right-col\">\n                                Grid Step\n                                <RangeInput\n                                    value={this.state.gridStepTextbox}\n                                    onChange={this.changeGridStep}\n                                />\n                            </div>\n                        </div>\n                        {_.contains(this.props.editableSettings, \"snap\") &&\n                            <div className=\"perseus-widget-row\">\n                                <div className=\"perseus-widget-left-col\">\n                                    Snap Step\n                                    <RangeInput\n                                        value={this.state.snapStepTextbox}\n                                        onChange={this.changeSnapStep}\n                                    />\n                                </div>\n                            </div>}\n                        <div className=\"perseus-widget-row\">\n                            <label>Markings: </label>\n                            <ButtonGroup\n                                value={this.props.markings}\n                                allowEmpty={false}\n                                buttons={[\n                                    {value: \"graph\", content: \"Graph\"},\n                                    {value: \"grid\", content: \"Grid\"},\n                                    {value: \"none\", content: \"None\"},\n                                ]}\n                                onChange={this.change(\"markings\")}\n                            />\n                        </div>\n                        <div className=\"perseus-widget-left-col\">\n                            <PropCheckBox\n                                label=\"Show tooltips\"\n                                showTooltips={this.props.showTooltips}\n                                onChange={this.change}\n                            />\n                        </div>\n                    </div>}\n\n                {_.contains(this.props.editableSettings, \"image\") &&\n                    <div className=\"image-settings\">\n                        <div>Background image:</div>\n                        <div>\n                            Url:{\" \"}\n                            <input\n                                type=\"text\"\n                                className=\"graph-settings-background-url\"\n                                ref=\"bg-url\"\n                                value={this.state.backgroundImage.url}\n                                onChange={e => {\n                                    const image = _.clone(\n                                        this.props.backgroundImage\n                                    );\n                                    image.url = e.target.value;\n                                    this.setState({backgroundImage: image});\n                                }}\n                                onKeyPress={this.changeBackgroundUrl}\n                                onBlur={this.changeBackgroundUrl}\n                            />\n                            <InfoTip>\n                                <p>\n                                    Create an image in graphie, or use the \"Add\n                                    image\" function to create a background.\n                                </p>\n                            </InfoTip>\n                        </div>\n                    </div>}\n\n                {_.contains(this.props.editableSettings, \"measure\") &&\n                    <div className=\"misc-settings\">\n                        <div className=\"perseus-widget-row\">\n                            <div className=\"perseus-widget-left-col\">\n                                <PropCheckBox\n                                    label=\"Show ruler\"\n                                    showRuler={this.props.showRuler}\n                                    onChange={this.change}\n                                />\n                            </div>\n                            <div className=\"perseus-widget-right-col\">\n                                <PropCheckBox\n                                    label=\"Show protractor\"\n                                    showProtractor={this.props.showProtractor}\n                                    onChange={this.change}\n                                />\n                            </div>\n                        </div>\n                        {this.props.showRuler &&\n                            <div>\n                                <div>\n                                    <label>\n                                        {\" \"}Ruler label:{\" \"}\n                                        <select\n                                            onChange={this.changeRulerLabel}\n                                            value={this.props.rulerLabel}\n                                        >\n                                            <option value=\"\">None</option>\n                                            <optgroup label=\"Metric\">\n                                                {this.renderLabelChoices([\n                                                    [\"milimeters\", \"mm\"],\n                                                    [\"centimeters\", \"cm\"],\n                                                    [\"meters\", \"m\"],\n                                                    [\"kilometers\", \"km\"],\n                                                ])}\n                                            </optgroup>\n                                            <optgroup label=\"Imperial\">\n                                                {this.renderLabelChoices([\n                                                    [\"inches\", \"in\"],\n                                                    [\"feet\", \"ft\"],\n                                                    [\"yards\", \"yd\"],\n                                                    [\"miles\", \"mi\"],\n                                                ])}\n                                            </optgroup>\n                                        </select>\n                                    </label>\n                                </div>\n                                <div>\n                                    <label>\n                                        {\" \"}Ruler ticks:{\" \"}\n                                        <select\n                                            onChange={this.changeRulerTicks}\n                                            value={this.props.rulerTicks}\n                                        >\n                                            {_.map(\n                                                [1, 2, 4, 8, 10, 16],\n                                                function(n) {\n                                                    return (\n                                                        <option value={n}>\n                                                            {n}\n                                                        </option>\n                                                    );\n                                                }\n                                            )}\n                                        </select>\n                                    </label>\n                                </div>\n                            </div>}\n                    </div>}\n            </div>\n        );\n    },\n});\n\n_module_.exports = GraphSettings;\nexport default _module_.exports;\n","import _utilColorsJs from \"../util/colors.js\";\nimport _kmath5 from \"kmath\";\nimport _kmath4 from \"kmath\";\nimport _kmath3 from \"kmath\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport _transformerJsx from \"./transformer.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _componentsGraphSettingsJsx from \"../components/graph-settings.jsx\";\nimport _componentsGraphJsx from \"../components/graph.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, camelcase, comma-dangle, indent, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\n\nconst Graph = _componentsGraphJsx;\nconst GraphSettings = _componentsGraphSettingsJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\n\nconst Transformer = _transformerJsx.widget;\n\nconst deepEq = _utilJs.deepEq;\nconst getGridStep = _utilJs2.getGridStep;\nconst kline = _kmath.line;\nconst knumber = _kmath2.number;\nconst kpoint = _kmath3.point;\nconst kray = _kmath4.ray;\nconst kvector = _kmath5.vector;\nconst KhanColors = _utilColorsJs;\n\nfunction arraySum(array) {\n    return _.reduce(\n        array,\n        function(memo, arg) {\n            return memo + arg;\n        },\n        0\n    );\n}\n\nvar defaultBackgroundImage = {\n    url: null,\n};\n\n/* Scales a distance from the default range of\n * [-10, 10] to a given props.range pair\n *\n * Used for sizing various transformation tools\n * (rotation handle, dilation circle)\n */\nfunction scaleToRange(dist, range) {\n    var spreadX = range[0][1] - range[0][0];\n    var spreadY = range[1][1] - range[1][0];\n\n    return dist * Math.max(spreadX, spreadY) / 20;\n}\n\nfunction orderInsensitiveCoordsEqual(coords1, coords2) {\n    coords1 = _.clone(coords1).sort(kpoint.compare);\n    coords2 = _.clone(coords2).sort(kpoint.compare);\n    return _.all(\n        _.map(coords1, function(coord1, i) {\n            var coord2 = coords2[i];\n            return kpoint.equal(coord1, coord2);\n        })\n    );\n}\n\nvar defaultGraphProps = function(setProps, boxSize) {\n    setProps = setProps || {};\n    var labels = setProps.labels || [\"x\", \"y\"];\n    var range = setProps.range || [[-10, 10], [-10, 10]];\n    var step = setProps.step || [1, 1];\n    var gridStep = setProps.gridStep || getGridStep(range, step, boxSize);\n    return {\n        box: [boxSize, boxSize],\n        labels: labels,\n        range: range,\n        step: step,\n        gridStep: gridStep,\n        valid: true,\n        backgroundImage: defaultBackgroundImage,\n        markings: \"grid\",\n        showProtractor: false,\n    };\n};\n\nvar defaultTransformerProps = {\n    apiOptions: ApiOptions.defaults,\n    gradeEmpty: false,\n    graphMode: \"interactive\",\n    listMode: \"dynamic\",\n    graph: {},\n    tools: {\n        translation: {\n            enabled: true,\n            required: false,\n            constraints: {},\n        },\n        rotation: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coord: [1, 6],\n        },\n        reflection: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coords: [[2, -4], [2, 2]],\n        },\n        dilation: {\n            enabled: true,\n            required: false,\n            constraints: {\n                fixed: false,\n            },\n            coord: [6, 6],\n        },\n    },\n    drawSolutionShape: true,\n    starting: {\n        shape: {\n            type: \"polygon-3\",\n            coords: [[2, 2], [2, 6], [7, 2]],\n        },\n        transformations: [],\n    },\n    correct: {\n        shape: {\n            type: \"polygon-3\",\n            coords: [[2, 2], [2, 6], [7, 2]],\n        },\n        transformations: [],\n    },\n};\n\nconst ToolSettings = createReactClass({\n    getDefaultProps: function() {\n        return {\n            allowFixed: true,\n        };\n    },\n\n    render: function() {\n        return (\n            <div>\n                {this.props.name}: {\" \"}\n                <PropCheckBox\n                    label=\"enabled:\"\n                    enabled={this.props.settings.enabled}\n                    onChange={this.props.onChange}\n                />{\" \"}\n                {this.props.settings.enabled &&\n                    <PropCheckBox\n                        label=\"required:\"\n                        required={this.props.settings.required}\n                        onChange={this.props.onChange}\n                    />}\n                {this.props.settings.enabled &&\n                    <InfoTip>\n                        'Required' will only grade the answer as correct if the\n                        student has used at least one such transformation.\n                    </InfoTip>}{\" \"}\n                {this.props.allowFixed &&\n                    this.props.settings.enabled &&\n                    <PropCheckBox\n                        label=\"fixed:\"\n                        fixed={this.props.settings.constraints.fixed}\n                        onChange={this.changeConstraints}\n                    />}\n                {this.props.allowFixed &&\n                    this.props.settings.enabled &&\n                    <InfoTip>\n                        Enable 'fixed' to prevent the student from repositioning\n                        the tool. The tool will appear in the position at which\n                        it is placed in the editor below.\n                    </InfoTip>}\n            </div>\n        );\n    },\n\n    changeConstraints: function(changed) {\n        var newConstraints = _.extend({}, this.props.constraints, changed);\n        this.props.onChange({\n            constraints: newConstraints,\n        });\n    },\n});\n\nvar TransformationExplorerSettings = createReactClass({\n    render: function() {\n        return (\n            <div className=\"transformer-settings\">\n                <div>\n                    {\" \"}Mode:{\" \"}\n                    <select value={this.getMode()} onChange={this.changeMode}>\n                        <option value=\"interactive,dynamic\">\n                            {\" \"}Exploration with text{\" \"}\n                        </option>\n                        <option value=\"interactive,static\">\n                            {\" \"}Exploration without text{\" \"}\n                        </option>\n                        <option value=\"dynamic,interactive\">\n                            {\" \"}Formal with movement{\" \"}\n                        </option>\n                        <option value=\"static,interactive\">\n                            {\" \"}Formal without movement{\" \"}\n                        </option>\n                    </select>\n                    <InfoTip>\n                        <ul>\n                            <li>\n                                <b>Exploration:</b> Students create\n                                transformations with tools on the graph.{\" \"}\n                            </li>\n                            <li>\n                                <b>Formal with movement:</b> Students specify\n                                transformations mathematically in the\n                                transformation list. Graph shows the results of\n                                these transformations.{\" \"}\n                            </li>\n                            <li>\n                                <b>Formal without movement:</b> Students specify\n                                transformations mathematically in the\n                                transformation list. Graph does not update.{\" \"}\n                            </li>\n                        </ul>\n                    </InfoTip>\n                </div>\n                <ToolSettings\n                    name=\"Translations\"\n                    settings={this.props.tools.translation}\n                    allowFixed={false}\n                    onChange={this.changeHandlerFor(\"translation\")}\n                />\n                <ToolSettings\n                    name=\"Rotations\"\n                    settings={this.props.tools.rotation}\n                    onChange={this.changeHandlerFor(\"rotation\")}\n                />\n                <ToolSettings\n                    name=\"Reflections\"\n                    settings={this.props.tools.reflection}\n                    onChange={this.changeHandlerFor(\"reflection\")}\n                />\n                <ToolSettings\n                    name=\"Dilations\"\n                    settings={this.props.tools.dilation}\n                    onChange={this.changeHandlerFor(\"dilation\")}\n                />\n                <PropCheckBox\n                    label=\"Draw Solution:\"\n                    drawSolutionShape={this.props.drawSolutionShape}\n                    onChange={this.props.onChange}\n                />\n            </div>\n        );\n    },\n\n    getMode: function() {\n        return this.props.graphMode + \",\" + this.props.listMode;\n    },\n\n    changeMode: function(e) {\n        var selected = e.target.value;\n        var modes = selected.split(\",\");\n\n        this.props.onChange({\n            graphMode: modes[0],\n            listMode: modes[1],\n        });\n    },\n\n    changeHandlerFor: function(toolName) {\n        return change => {\n            var newTools = _.clone(this.props.tools);\n            newTools[toolName] = _.extend(\n                {},\n                this.props.tools[toolName],\n                change\n            );\n\n            this.props.onChange({\n                tools: newTools,\n            });\n        };\n    },\n});\nvar ShapeTypes = {\n    getPointCountForType: function(type) {\n        var splitType = type.split(\"-\");\n        if (splitType[0] === \"polygon\") {\n            return splitType[1] || 3;\n        } else if (splitType[0] === \"line\" || splitType[0] === \"lineSegment\") {\n            return 2;\n        } else if (splitType[0] === \"angle\") {\n            return 3;\n        } else if (splitType[0] === \"circle\") {\n            return 2;\n        } else if (splitType[0] === \"point\") {\n            return 1;\n        }\n    },\n\n    addMovableShape: function(graphie, options) {\n        if (options.editable && options.translatable) {\n            throw new Error(\n                \"It doesn't make sense to have a movable shape \" +\n                    \"where you can stretch the points and translate them \" +\n                    \"simultaneously. options: \" +\n                    JSON.stringify(options)\n            );\n        }\n\n        var shape;\n        var points = _.map(options.shape.coords, function(coord) {\n            var currentPoint;\n            var isMoving = false;\n            var previousCoord = coord;\n\n            var onMove = function(x, y) {\n                if (!isMoving) {\n                    previousCoord = currentPoint.coord;\n                    isMoving = true;\n                }\n\n                var moveVector = kvector.subtract([x, y], currentPoint.coord);\n\n                // Translate from (x, y) semantics to (dX, dY) semantics\n                // This is more useful for translations on multiple points,\n                // where we care about how the points moved, not where any\n                // individual point ended up\n                if (options.onMove) {\n                    moveVector = options.onMove(moveVector[0], moveVector[1]);\n                }\n\n                // Perform a translation on all points in this shape when\n                // any point moves\n                if (options.translatable) {\n                    _.each(points, function(point) {\n                        // The point itself will be updated by the\n                        // movablePoint class, so only translate the other\n                        // points\n                        if (point !== currentPoint) {\n                            point.setCoord(\n                                kvector.add(point.coord, moveVector)\n                            );\n                        }\n                    });\n                }\n\n                // Update our shape and our currentPoint\n                // Without this, some shapes (circles, angles) appear\n                // \"bouncy\" as they are updated with currentPoint at the\n                // current mouse coordinate (oldCoord), rather than newCoord\n                var oldCoord = currentPoint.coord;\n                var newCoord = kvector.add(currentPoint.coord, moveVector);\n                // Temporarily change our coordinate so that\n                // shape.update() sees the new coordinate\n                currentPoint.coord = newCoord;\n                shape.update();\n                // ...But don't break onMove, which assumes it\n                // is the only thing changing our coord\n                currentPoint.coord = oldCoord;\n                return newCoord;\n            };\n\n            var onMoveEnd = function() {\n                // onMove isn't guaranteed to be called before onMoveEnd, so\n                // we have to take into account that we may not have moved and\n                // set previousCoord.\n                if (options.onMoveEnd && isMoving) {\n                    isMoving = false;\n                    // We don't use the supplied x and y parameters here\n                    // because MovablePoint's onMoveEnd semantics suck.\n                    // It returns the mouseX, mouseY without processing them\n                    // through onMove, leaving us with weird fractional moves\n                    var change = kvector.subtract(\n                        currentPoint.coord,\n                        previousCoord\n                    );\n                    options.onMoveEnd(change[0], change[1]);\n                }\n                shape.update();\n            };\n\n            currentPoint = graphie.addMovablePoint({\n                coord: coord,\n                normalStyle: options.normalPointStyle,\n                highlightStyle: options.highlightPointStyle,\n                constraints: {\n                    fixed: !options.translatable && !options.editable,\n                },\n                visible: options.showPoints,\n                snapX: (options.snap && options.snap[0]) || 0,\n                snapY: (options.snap && options.snap[1]) || 0,\n                bounded: false, // Don't bound it when placing it on the graph\n                onMove: onMove,\n                onMoveEnd: onMoveEnd,\n            });\n\n            // Bound it when moving\n            // We can't set this earlier, because doing so would mean any\n            // points outside of the graph would be moved into a moved into\n            // a position that doesn't preserve the shape\n            currentPoint.bounded = true;\n\n            return currentPoint;\n        });\n\n        shape = ShapeTypes.addShape(graphie, options, points);\n        var removeShapeWithoutPoints = shape.remove;\n        shape.remove = function() {\n            removeShapeWithoutPoints.apply(shape);\n            _.invoke(points, \"remove\");\n        };\n        return shape;\n    },\n\n    addShape: function(graphie, options, points) {\n        points = points || options.shape.coords;\n\n        var types = ShapeTypes._typesOf(options.shape);\n        var typeOptions =\n            options.shape.options || ShapeTypes.defaultOptions(types);\n\n        var shapes = ShapeTypes._mapTypes(types, points, function(type, points, i) {\n            var shapeOptions = _.extend({}, options, typeOptions[i]);\n            return ShapeTypes._addType(graphie, type, points, shapeOptions);\n        });\n\n        var updateFuncs = _.filter(_.pluck(shapes, \"update\"), _.identity);\n        var update = function() {\n            _.invoke(updateFuncs, \"call\");\n        };\n\n        var removeFuncs = _.filter(_.pluck(shapes, \"remove\"), _.identity);\n        var remove = function() {\n            _.invoke(removeFuncs, \"call\");\n        };\n\n        var getOptions = function() {\n            return _.map(shapes, function(shape) {\n                if (shape.getOptions) {\n                    return shape.getOptions();\n                } else {\n                    return {};\n                }\n            });\n        };\n\n        var toJSON = function() {\n            var coords = _.map(points, function(pt) {\n                if (_.isArray(pt)) {\n                    return pt;\n                } else {\n                    return pt.coord;\n                }\n            });\n            return {\n                type: types,\n                coords: coords,\n                options: getOptions(),\n            };\n        };\n\n        return {\n            type: types,\n            points: points,\n            update: update,\n            remove: remove,\n            toJSON: toJSON,\n            getOptions: getOptions,\n        };\n    },\n\n    equal: function(shape1, shape2) {\n        var types1 = ShapeTypes._typesOf(shape1);\n        var types2 = ShapeTypes._typesOf(shape2);\n        if (types1.length !== types2.length) {\n            return false;\n        }\n        var shapes1 = ShapeTypes._mapTypes(\n            types1,\n            shape1.coords,\n            ShapeTypes._combine\n        );\n        var shapes2 = ShapeTypes._mapTypes(\n            types2,\n            shape2.coords,\n            ShapeTypes._combine\n        );\n        return _.all(\n            _.map(shapes1, function(partialShape1, i) {\n                var partialShape2 = shapes2[i];\n                if (partialShape1.type !== partialShape2.type) {\n                    return false;\n                }\n                return ShapeTypes._forType(partialShape1.type).equal(\n                    partialShape1.coords,\n                    partialShape2.coords\n                );\n            })\n        );\n    },\n\n    _typesOf: function(shape) {\n        var types = shape.type;\n        if (!_.isArray(types)) {\n            types = [types];\n        }\n        return _.map(types, function(type) {\n            if (type === \"polygon\") {\n                return \"polygon-3\";\n            } else {\n                return type;\n            }\n        });\n    },\n\n    defaultOptions: function(types) {\n        return _.map(types, function(type) {\n            var typeDefaultOptions = ShapeTypes._forType(type).defaultOptions;\n            return _.extend({}, typeDefaultOptions);\n        });\n    },\n\n    _forType: function(type) {\n        var baseType = type.split(\"-\")[0];\n        return ShapeTypes[baseType];\n    },\n\n    _mapTypes: function(types, points, func, context) {\n        return _.map(types, function(type, i) {\n            var pointCount = ShapeTypes.getPointCountForType(type);\n            var currentPoints = _.first(points, pointCount);\n            points = _.rest(points, pointCount);\n            return func.call(context, type, currentPoints, i);\n        });\n    },\n\n    _addType: function(graphie, type, points, options) {\n        var lineCoords = _.isArray(points[0])\n            ? {\n                  coordA: points[0],\n                  coordZ: points[1],\n              }\n            : {\n                  pointA: points[0],\n                  pointZ: points[1],\n              };\n\n        type = type.split(\"-\")[0];\n        if (type === \"polygon\") {\n            var polygon = graphie.addMovablePolygon(\n                _.extend({}, options, {\n                    fixed: !options.editable,\n                    snapX: (options.snap && options.snap[0]) || 0,\n                    snapY: (options.snap && options.snap[1]) || 0,\n                    points: points,\n                    constrainToGraph: false,\n                })\n            );\n            return {\n                update: polygon.transform.bind(polygon),\n                remove: polygon.remove.bind(polygon),\n            };\n        } else if (type === \"line\" || type === \"lineSegment\") {\n            var line = graphie.addMovableLineSegment(\n                _.extend({}, options, lineCoords, {\n                    movePointsWithLine: true,\n                    fixed: true,\n                    constraints: {\n                        fixed: true,\n                    },\n                    extendLine: type === \"line\",\n                })\n            );\n\n            // TODO(jack): Hide points on uneditable lines when translation\n            // is a vector.\n            // We can't just remove the points yet, because they are the\n            // translation handle for the line.\n            return {\n                update: line.transform.bind(line, true),\n                remove: line.remove.bind(line),\n            };\n        } else if (type === \"angle\") {\n            // If this angle is editable, we want to be able to make angles\n            // both larger and smaller than 180 degrees.\n            // If this angle is not editable, it should always maintain\n            // it's angle measure, even if it is reflected (causing the\n            // clockwise-ness of the points to change)\n            var shouldChangeReflexivity = options.editable ? null : false;\n\n            var angle = graphie.addMovableAngle({\n                angleLabel: \"$deg0\",\n                fixed: true,\n                points: points,\n                normalStyle: options.normalStyle,\n                reflex: options.reflex,\n            });\n\n            // Hide non-vertex points on uneditable angles\n            if (!_.isArray(points[0]) && !options.editable) {\n                points[0].remove();\n                points[2].remove();\n            }\n            return {\n                update: angle.update.bind(angle, shouldChangeReflexivity),\n                remove: angle.remove.bind(angle),\n                getOptions: function() {\n                    return {\n                        reflex: angle.isReflex(),\n                    };\n                },\n            };\n        } else if (type === \"circle\") {\n            var perimeter = {\n                // temporary object for the first removal\n                remove: _.identity,\n            };\n            var redrawPerim = function() {\n                var coord0 = points[0].coord || points[0];\n                var coord1 = points[1].coord || points[1];\n                var radius = kpoint.distanceToPoint(coord0, coord1);\n                perimeter.remove();\n                perimeter = graphie.circle(\n                    coord0,\n                    radius,\n                    _.extend(\n                        {\n                            stroke: KhanColors.DYNAMIC,\n                            \"stroke-width\": 2,\n                        },\n                        options.normalStyle\n                    )\n                );\n            };\n\n            redrawPerim();\n            if (points[1].remove && !options.editable) {\n                points[1].remove();\n            }\n\n            return {\n                update: redrawPerim,\n                remove: function() {\n                    // Not _.bind because the remove function changes\n                    // when the perimeter is redrawn\n                    perimeter.remove();\n                },\n            };\n        } else if (type === \"point\") {\n            // do nothing\n            return {\n                update: null,\n                remove: null,\n            };\n        } else {\n            throw new Error(\"Invalid shape type \" + type);\n        }\n    },\n\n    _combine: function(type, coords) {\n        return {\n            type: type,\n            coords: coords,\n        };\n    },\n\n    polygon: {\n        equal: orderInsensitiveCoordsEqual,\n    },\n\n    line: {\n        equal: kline.equal,\n    },\n\n    lineSegment: {\n        equal: orderInsensitiveCoordsEqual,\n    },\n\n    angle: {\n        equal: function(points1, points2) {\n            if (!kpoint.equal(points1[1], points2[1])) {\n                return false;\n            }\n\n            var line1_0 = [points1[1], points1[0]];\n            var line1_2 = [points1[1], points1[2]];\n            var line2_0 = [points2[1], points2[0]];\n            var line2_2 = [points2[1], points2[2]];\n\n            var equalUnflipped =\n                kray.equal(line1_0, line2_0) && kray.equal(line1_2, line2_2);\n            var equalFlipped =\n                kray.equal(line1_0, line2_2) && kray.equal(line1_2, line2_0);\n\n            return equalUnflipped || equalFlipped;\n        },\n\n        defaultOptions: {\n            reflex: false,\n        },\n    },\n\n    circle: {\n        equal: function(points1, points2) {\n            var radius1 = kpoint.distanceToPoint(points1[0], points1[1]);\n            var radius2 = kpoint.distanceToPoint(points2[0], points2[1]);\n            return (\n                kpoint.equal(points1[0], points2[0]) &&\n                knumber.equal(radius1, radius2)\n            );\n        },\n    },\n\n    point: {\n        equal: kpoint.equal,\n    },\n};\n\nvar TransformationsShapeEditor = createReactClass({\n    render: function() {\n        return (\n            <div>\n                <Graph\n                    ref=\"graph\"\n                    box={this.props.graph.box}\n                    range={this.props.graph.range}\n                    labels={this.props.graph.labels}\n                    step={this.props.graph.step}\n                    gridStep={this.props.graph.gridStep}\n                    markings={this.props.graph.markings}\n                    backgroundImage={this.props.graph.backgroundImage}\n                    onGraphieUpdated={this.setupGraphie}\n                />\n                <select\n                    key=\"type-select\"\n                    value={this.getTypeString(this.props.shape.type)}\n                    onChange={this.changeType}\n                >\n                    <option value=\"polygon-3\">Triangle</option>\n                    <option value=\"polygon-4\">Quadrilateral</option>\n                    <option value=\"polygon-5\">Pentagon</option>\n                    <option value=\"polygon-6\">Hexagon</option>\n                    <option value=\"line\">Line</option>\n                    <option value=\"line,line\">2 lines</option>\n                    <option value=\"lineSegment\">Line segment</option>\n                    <option value=\"lineSegment,lineSegment\">\n                        {\" \"}2 line segments{\" \"}\n                    </option>\n                    <option value=\"angle\">Angle</option>\n                    <option value=\"circle\">Circle</option>\n                </select>\n            </div>\n        );\n    },\n\n    /* Return the option string for a given type */\n    getTypeString: function(type) {\n        if (_.isArray(type)) {\n            return _.map(type, this.getTypeString).join(\",\");\n        } else if (type === \"polygon\") {\n            return \"polygon-\" + this.props.shape.coords.length;\n        } else {\n            return type;\n        }\n    },\n\n    /* Change the type on the window event e\n     *\n     * e.target.value is the new type string\n     */\n    changeType: function(e) {\n        var types = String(e.target.value).split(\",\");\n        var pointCount = arraySum(\n            _.map(types, ShapeTypes.getPointCountForType)\n        );\n\n        var radius = scaleToRange(4, this.refs.graph.props.range);\n        var offset = (1 / 2 - 1 / pointCount) * 180;\n        var coords = _.times(pointCount, function(i) {\n            return kpoint.rotateDeg([radius, 0], 360 * i / pointCount + offset);\n        });\n\n        this.props.onChange({\n            shape: {\n                type: types,\n                coords: coords,\n                options: ShapeTypes.defaultOptions(types),\n            },\n        });\n    },\n\n    componentDidMount: function() {\n        this.setupGraphie(this.refs.graph.graphie());\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (!deepEq(prevProps.shape, this.props.shape)) {\n            this.refs.graph.reset();\n        }\n    },\n\n    updateCoords: function() {\n        this.props.onChange({\n            shape: this.shape.toJSON(),\n        });\n    },\n\n    setupGraphie: function(graphie) {\n        this.shape = ShapeTypes.addMovableShape(graphie, {\n            editable: true,\n            snap: graphie.snap,\n            shape: this.props.shape,\n            onMoveEnd: this.updateCoords,\n        });\n    },\n});\n\nvar TransformerEditor = createReactClass({\n    // TODO (jack): These should be refactored into a nice object at the top\n    // so that we don't have all this duplication\n    getDefaultProps: function() {\n        return defaultTransformerProps;\n    },\n\n    render: function() {\n        // Fill in any missing value in this.props.graph\n        // this can happen because the graph json doesn't include\n        // box, for example\n        var graph = _.extend(\n            defaultGraphProps(this.props.graph, 340),\n            this.props.graph\n        );\n\n        return (\n            <div>\n                <div>\n                    <PropCheckBox\n                        label=\"Grade empty answers as wrong:\"\n                        gradeEmpty={this.props.gradeEmpty}\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            We generally do not grade empty answers. This\n                            usually works well, but sometimes can result in\n                            giving away part of an answer in a multi-part\n                            question.\n                        </p>\n                        <p>\n                            If this is a multi-part question (there is another\n                            widget), you probably want to enable this option.\n                            Otherwise, you should leave it disabled.\n                        </p>\n                        <p>Confused? Talk to Elizabeth.</p>\n                    </InfoTip>\n                </div>\n                <div>Graph settings:</div>\n                <GraphSettings\n                    box={graph.box}\n                    labels={graph.labels}\n                    range={graph.range}\n                    step={graph.step}\n                    gridStep={graph.gridStep}\n                    valid={graph.valid}\n                    backgroundImage={graph.backgroundImage}\n                    markings={graph.markings}\n                    showProtractor={graph.showProtractor}\n                    onChange={this.changeGraph}\n                />\n                <div>Transformation settings:</div>\n                <TransformationExplorerSettings\n                    ref=\"transformationSettings\"\n                    graphMode={this.props.graphMode}\n                    listMode={this.props.listMode}\n                    tools={this.props.tools}\n                    drawSolutionShape={this.props.drawSolutionShape}\n                    onChange={this.props.onChange}\n                />\n                <div>Starting location:</div>\n                <TransformationsShapeEditor\n                    ref=\"shapeEditor\"\n                    graph={graph}\n                    shape={this.props.starting.shape}\n                    onChange={this.changeStarting}\n                    setDrawingAreaAvailable={\n                        this.props.apiOptions.setDrawingAreaAvailable\n                    }\n                />\n                <div>Solution transformations:</div>\n                <Transformer\n                    ref=\"explorer\"\n                    graph={graph}\n                    graphMode={this.props.graphMode}\n                    listMode={this.props.listMode}\n                    gradeEmpty={this.props.gradeEmpty}\n                    tools={this.props.tools}\n                    drawSolutionShape={this.props.drawSolutionShape}\n                    starting={this.props.starting}\n                    correct={this.props.starting}\n                    transformations={this.props.correct.transformations}\n                    onChange={this.changeTransformer}\n                    trackInteraction={() => {}}\n                />\n            </div>\n        );\n    },\n\n    // propagate a props change on our graph settings to\n    // this.props.graph\n    changeGraph: function(graphChanges, callback) {\n        var newGraph = _.extend({}, this.props.graph, graphChanges);\n        this.props.onChange(\n            {\n                graph: newGraph,\n            },\n            callback\n        );\n    },\n\n    // propagate a props change on our starting graph to\n    // this.props.starting\n    changeStarting: function(startingChanges) {\n        var newStarting = _.extend({}, this.props.starting, startingChanges);\n        this.props.onChange({\n            starting: newStarting,\n        });\n    },\n\n    // propagate a transformations change onto correct.transformations\n    changeTransformer: function(changes, callback) {\n        if (changes.transformations) {\n            changes.correct = {\n                ...this.props.correct,\n                transformations: changes.transformations,\n            };\n            delete changes.transformations;\n        }\n        this.props.onChange(changes, callback);\n    },\n\n    serialize: function() {\n        var json = this.refs.explorer.getEditorJSON();\n        json.correct = json.answer;\n        delete json.answer;\n        return json;\n    },\n});\n\n_module_.exports = TransformerEditor;\nexport default _module_.exports;\n","import _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _utilAnswerTypesJs from \"../util/answer-types.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _utilJs from \"../util.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar MathOutput = _componentsMathOutputJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\nvar Renderer = _rendererJsx;\nvar Util = _utilJs;\n\nconst {keypadElementPropType} = _mathInput.propTypes;\nvar ApiOptions = _perseusApiJsx.Options;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\n\nvar assert = _interactive2InteractiveUtilJs.assert;\n\n/* Input handling: Maps a (row, column) pair to a unique ref used by React,\n * and extracts (row, column) pairs from input paths, used to allow outsiders\n * to focus, blur, set input values, etc. */\nvar getInputPath = function(row, column) {\n    return [\"\" + row, \"\" + column];\n};\n\nvar getDefaultPath = function() {\n    return getInputPath(0, 0);\n};\n\nvar getRowFromPath = function(path) {\n    // 'path' should be a (row, column) pair\n    assert(_.isArray(path) && path.length === 2);\n    return +path[0];\n};\n\nvar getColumnFromPath = function(path) {\n    // 'path' should be a (row, column) pair\n    assert(_.isArray(path) && path.length === 2);\n    return +path[1];\n};\n\nvar getRefForPath = function(path) {\n    var row = getRowFromPath(path);\n    var column = getColumnFromPath(path);\n    return \"answer\" + row + \",\" + column;\n};\n\nvar Table = createReactClass({\n    propTypes: {\n        answers: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.string)\n        ),\n        editableHeaders: PropTypes.bool,\n        // The editor to use when editableHeaders is enabled\n        Editor: PropTypes.func,\n        headers: PropTypes.arrayOf(PropTypes.string),\n        keypadElement: keypadElementPropType,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        var defaultRows = 4;\n        var defaultColumns = 1;\n        var blankAnswers = _.times(defaultRows, function() {\n            return Util.stringArrayOfSize(defaultColumns);\n        });\n        return {\n            apiOptions: ApiOptions.defaults,\n            headers: [\"\"],\n            editableHeaders: false,\n            rows: defaultRows,\n            columns: defaultColumns,\n            answers: blankAnswers,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    _getRows: function() {\n        return this.props.answers.length;\n    },\n\n    _getColumns: function() {\n        return this.props.answers[0].length;\n    },\n\n    render: function() {\n        var rows = this._getRows();\n        var columns = this._getColumns();\n        var headers = this.props.headers;\n\n        let InputComponent;\n        let inputStyle;\n        if (this.props.apiOptions.customKeypad) {\n            InputComponent = SimpleKeypadInput;\n            // NOTE(charlie): This is intended to match the \"width: 80px\" in\n            // input in table.less. Those values should be kept in-sync.\n            inputStyle = {width: 80};\n        } else if (this.props.apiOptions.staticRender) {\n            InputComponent = MathOutput;\n            inputStyle = {};\n        } else {\n            InputComponent = \"input\";\n            inputStyle = {};\n        }\n\n        return (\n            <table className=\"perseus-widget-table-of-values non-markdown\">\n                <thead>\n                    <tr>\n                        {_.map(headers, (header, i) => {\n                            if (this.props.editableHeaders) {\n                                return (\n                                    <th key={i}>\n                                        <this.props.Editor\n                                            ref={\"columnHeader\" + i}\n                                            apiOptions={this.props.apiOptions}\n                                            content={header}\n                                            widgetEnabled={false}\n                                            onChange={_.partial(\n                                                this.onHeaderChange,\n                                                i\n                                            )}\n                                        />\n                                    </th>\n                                );\n                            } else {\n                                return (\n                                    <th key={i}>\n                                        <Renderer\n                                            content={header}\n                                            linterContext={\n                                                this.props.linterContext\n                                            }\n                                        />\n                                    </th>\n                                );\n                            }\n                        })}\n                    </tr>\n                </thead>\n                <tbody>\n                    {_.times(rows, r => {\n                        return (\n                            <tr key={r}>\n                                {_.times(columns, c => {\n                                    return (\n                                        <td key={c}>\n                                            <InputComponent\n                                                ref={getRefForPath(\n                                                    getInputPath(r, c)\n                                                )}\n                                                type=\"text\"\n                                                value={this.props.answers[r][c]}\n                                                keypadElement={\n                                                    this.props.keypadElement\n                                                }\n                                                disabled={\n                                                    this.props.apiOptions\n                                                        .readOnly\n                                                }\n                                                onFocus={_.partial(\n                                                    this._handleFocus,\n                                                    getInputPath(r, c)\n                                                )}\n                                                onBlur={_.partial(\n                                                    this._handleBlur,\n                                                    getInputPath(r, c)\n                                                )}\n                                                onChange={_.partial(\n                                                    this.onValueChange,\n                                                    r,\n                                                    c\n                                                )}\n                                                style={inputStyle}\n                                            />\n                                        </td>\n                                    );\n                                })}\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            </table>\n        );\n    },\n\n    getUserInput: function() {\n        return _.map(this.props.answers, _.clone);\n    },\n\n    onValueChange: function(row, column, eventOrValue) {\n        var answers = _.map(this.props.answers, _.clone);\n\n        // If this is coming from an \"input\", the last argument will be an\n        // event. If it's coming from a SimpleKeypadInput, it'll be the value.\n        answers[row][column] = eventOrValue.target\n            ? eventOrValue.target.value\n            : eventOrValue;\n\n        this.props.onChange({\n            answers: answers,\n        });\n        this.props.trackInteraction();\n    },\n\n    onHeaderChange: function(index, e) {\n        var headers = this.props.headers.slice();\n        headers[index] = e.content;\n        this.props.onChange({\n            headers: headers,\n        });\n    },\n\n    simpleValidate: function(rubric) {\n        return Table.validate(this.getUserInput(), rubric);\n    },\n\n    _handleFocus: function(inputPath) {\n        this.props.onFocus(inputPath);\n    },\n\n    _handleBlur: function(inputPath) {\n        this.props.onBlur(inputPath);\n    },\n\n    focus: function() {\n        this.focusInputPath(getDefaultPath());\n        return true;\n    },\n\n    focusInputPath: function(path) {\n        var inputID = getRefForPath(path);\n        var inputComponent = this.refs[inputID];\n        if (this.props.apiOptions.customKeypad) {\n            inputComponent.focus();\n        } else if (this.props.apiOptions.staticRender) {\n            inputComponent.focus();\n        } else {\n            ReactDOM.findDOMNode(inputComponent).focus();\n        }\n    },\n\n    blurInputPath: function(path) {\n        var inputID = getRefForPath(path);\n        var inputComponent = this.refs[inputID];\n        if (this.props.apiOptions.customKeypad) {\n            inputComponent.blur();\n        } else if (this.props.apiOptions.staticRender) {\n            inputComponent.blur();\n        } else {\n            ReactDOM.findDOMNode(inputComponent).blur();\n        }\n    },\n\n    getDOMNodeForPath: function(path) {\n        var inputID = getRefForPath(path);\n        return ReactDOM.findDOMNode(this.refs[inputID]);\n    },\n\n    getInputPaths: function() {\n        var rows = this._getRows();\n        var columns = this._getColumns();\n        var inputPaths = [];\n        _.times(rows, r => {\n            _.times(columns, c => {\n                var inputPath = getInputPath(r, c);\n                inputPaths.push(inputPath);\n            });\n        });\n        return inputPaths;\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        return \"number\";\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        // Extract row, column information\n        var row = getRowFromPath(path);\n        var column = getColumnFromPath(path);\n\n        var answers = _.map(this.props.answers, _.clone);\n        answers[row][column] = newValue;\n        this.props.onChange(\n            {\n                answers: answers,\n            },\n            cb\n        );\n    },\n});\n\n_.extend(Table, {\n    validate: function(state, rubric) {\n        var filterNonEmpty = function(table) {\n            return _.filter(table, function(row) {\n                // Check if row has a cell that is nonempty\n                return _.some(row, _.identity);\n            });\n        };\n        var solution = filterNonEmpty(rubric.answers);\n        var supplied = filterNonEmpty(state);\n        var hasEmptyCell = _.some(supplied, function(row) {\n            return _.some(row, function(cell) {\n                return cell === \"\";\n            });\n        });\n        if (hasEmptyCell || !supplied.length) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        }\n        if (supplied.length !== solution.length) {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n        var createValidator = KhanAnswerTypes.number.createValidatorFunctional;\n        var message = null;\n        var allCorrect = _.every(solution, function(rowSolution) {\n            var i;\n            for (i = 0; i < supplied.length; i++) {\n                var rowSupplied = supplied[i];\n                var correct = _.every(rowSupplied, function(cellSupplied, i) {\n                    var cellSolution = rowSolution[i];\n                    var validator = createValidator(cellSolution, {\n                        simplify: true,\n                    });\n                    var result = validator(cellSupplied);\n                    if (result.message) {\n                        message = result.message;\n                    }\n                    return result.correct;\n                });\n                if (correct) {\n                    supplied.splice(i, 1);\n                    return true;\n                }\n            }\n            return false;\n        });\n        return {\n            type: \"points\",\n            earned: allCorrect ? 1 : 0,\n            total: 1,\n            message: message,\n        };\n    },\n});\n\nvar propTransform = editorProps => {\n    // Remove answers before passing to widget\n    var rows = editorProps.answers.length;\n    var columns = editorProps.answers[0].length;\n    var blankAnswers = _.times(rows, function() {\n        return Util.stringArrayOfSize(columns);\n    });\n    return _.extend({}, editorProps, {\n        answers: blankAnswers,\n    });\n};\n\n_module_.exports = {\n    name: \"table\",\n    displayName: \"Table of values\",\n    accessible: true,\n    widget: Table,\n    transform: propTransform,\n    hidden: true,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import { List } from \"immutable\";\n\nimport {\n    CharacterMetadata,\n    BlockMapBuilder,\n    ContentBlock,\n    EditorState,\n    Entity,\n    Modifier,\n    SelectionState,\n    genKey,\n} from \"draft-js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n// This provides sensible defaults for editorState, contentState, and selection.\n// This means that if I wanted to insert text at the current cursor location,\n// I could just pass in editorState, but if I wanted it to insert text at a\n// custom location, I would just pass in a selection as well\nconst _fillData = draftData => {\n    const {editorState, contentState, selection} = draftData;\n    const newData = {};\n    newData.editorState = editorState || null;\n    newData.contentState =\n        contentState ||\n        (editorState && editorState.getCurrentContent()) ||\n        null;\n    newData.selection =\n        selection ||\n        (editorState && editorState.getSelection()) ||\n        (contentState && contentState.getSelectionAfter()) ||\n        null;\n    return newData;\n};\n\n// Draft.js bugs currently emerge when the editor doesn't have focus.  This\n// avoids those by ensuring that the editor state always assumes it is focused\nconst _createEmptySelection = block => {\n    return SelectionState.createEmpty(block.getKey()).set(\"hasFocus\", true);\n};\n\nfunction regexStrategy(contentBlock, callback, regex, selectionFromMatch) {\n    const text = contentBlock.getText();\n    let matchArr;\n    while ((matchArr = regex.exec(text)) !== null) {\n        if (selectionFromMatch) {\n            const {start, end} = selectionFromMatch(matchArr);\n            callback(start, end);\n        } else {\n            const start = matchArr.index;\n            callback(start, start + matchArr[0].length);\n        }\n    }\n}\n\n// TODO: Make this return an array of all matches, rather than first\nfunction findPattern(contentState, regExp) {\n    // The entire content is organized into blocks, and so each one must be\n    // searched in order to find every widget\n    const blocks = contentState.getBlockMap().values();\n    for (const block of blocks) {\n        const match = regExp.exec(block.getText());\n        if (match !== null) {\n            const base = _createEmptySelection(block);\n            const selection = base.merge({\n                anchorOffset: match.index,\n                focusOffset: match.index + match[0].length,\n            });\n            return selection;\n        }\n    }\n}\n\nfunction replaceSelection(draftData, text, entity = null) {\n    const data = _fillData(draftData);\n    const newData = {};\n    newData.contentState = Modifier.replaceText(\n        data.contentState,\n        data.selection,\n        text,\n        null, // For custom styling, but we use a decorator instead\n        entity\n    );\n\n    if (data.editorState) {\n        newData.editorState = EditorState.push(\n            data.editorState,\n            newData.contentState,\n            \"insert-characters\"\n        );\n    }\n\n    return newData;\n}\n\nfunction deleteSelection(draftData) {\n    const data = _fillData(draftData);\n    const newData = {};\n    newData.contentState = Modifier.removeRange(\n        data.contentState,\n        data.selection,\n        \"backward\"\n    );\n\n    if (data.editorState) {\n        newData.editorState = EditorState.push(\n            data.editorState,\n            newData.contentState,\n            \"remove-range\"\n        );\n    }\n\n    return newData;\n}\n\nconst _getBlocksForSelection = (contentState, selection) => {\n    const blocks = [];\n    const startKey = selection.getStartKey();\n    const endKey = selection.getEndKey();\n    const pastEndKey = contentState.getKeyAfter(endKey);\n\n    for (\n        let blockKey = startKey;\n        blockKey !== pastEndKey;\n        blockKey = contentState.getKeyAfter(blockKey)\n    ) {\n        blocks.push(contentState.getBlockForKey(blockKey));\n    }\n\n    return blocks;\n};\n\n// Returns an array of all entiies contained within\n// the provided selection, or in the entire contentState\n// if no selection is provided\nfunction getEntities(contentState, selection) {\n    let blockMap = null;\n\n    // Overriden if a selection is specified\n    let filter = () => true;\n\n    if (!selection) {\n        blockMap = contentState.getBlockMap();\n    } else {\n        const blocks = _getBlocksForSelection(contentState, selection);\n        blockMap = BlockMapBuilder.createFromArray(blocks);\n\n        // Ensure that entities in the same block as the start/end of the\n        // selection are not included if they are not fully contained\n        // within the selection\n        const startKey = selection.getStartKey();\n        const endKey = selection.getEndKey();\n        filter = (key, start, end) => {\n            if (key === startKey && start < selection.getStartOffset()) {\n                return false;\n            }\n            if (key === endKey && end > selection.getEndOffset()) {\n                return false;\n            }\n            return true;\n        };\n    }\n\n    const entities = [];\n    blockMap.forEach((block, blockKey) => {\n        block.findEntityRanges(\n            char => char.getEntity() !== null,\n            (start, end) => {\n                if (filter(blockKey, start, end)) {\n                    entities.push(Entity.get(block.getEntityAt(start)));\n                }\n            }\n        );\n    });\n    return entities;\n}\n\nfunction findEntity(contentState, filter) {\n    const blocks = contentState.getBlocksAsArray();\n\n    let selection = null;\n    blocks.some(block => {\n        block.findEntityRanges(\n            char => char.getEntity() !== null &&\n            filter(Entity.get(char.getEntity())),\n            (start, end) => {\n                const base = _createEmptySelection(block);\n                selection = base.merge({\n                    anchorOffset: start,\n                    focusOffset: end,\n                    isBackward: false,\n                });\n            }\n        );\n        return !!selection;\n    });\n\n    return selection;\n}\n\n/*\n    This function is needed in cases like pasting, where raw text must be\n    converted into Draft.js ContentBlocks.\n    The sanitizer allows for actions such as stripping characters and\n    adding in entities where needed\n    */\nconst NEWLINE_REGEX = /\\r\\n?|\\n/g;\nfunction insertText(draftData, rawText, sanitizer = () => null) {\n    const data = _fillData(draftData);\n    const newData = {};\n\n    // To insert text such that it will appear as multiple blocks,\n    // createFragment must be used.  A fragment is an ordered map of\n    // ContentBlocks.  There should be a ContentBlock for each paragraph\n    const textLines = rawText.split(NEWLINE_REGEX);\n\n    // Without basic character data, the text appears blank\n    const charData = CharacterMetadata.create();\n\n    // Create an array of ContentBlock objects, one for each line\n    const contentBlocks = textLines.map(textLine => {\n        // Styles and entities in draft.js are applied per character, therefore\n        // each block uses a list, where each element corresponds to a single\n        // character.\n        let text = textLine;\n        let characterList = Array(textLine.length).fill(charData);\n        const sanitizedObj = sanitizer(text, characterList);\n        if (sanitizedObj !== null) {\n            text = sanitizedObj.text;\n            characterList = sanitizedObj.characterList;\n        }\n\n        return new ContentBlock({\n            key: genKey(),\n            text: text,\n            type: \"unstyled\",\n            characterList: List(characterList),\n        });\n    });\n    const fragment = BlockMapBuilder.createFromArray(contentBlocks);\n\n    newData.contentState = Modifier.replaceWithFragment(\n        data.contentState,\n        data.selection,\n        fragment\n    );\n\n    if (data.editorState) {\n        newData.editorState = EditorState.push(\n            data.editorState,\n            newData.contentState,\n            \"insert-fragment\"\n        );\n    }\n\n    return newData;\n}\n\nfunction selectEnd(block) {\n    const emptySelection = _createEmptySelection(block);\n    const newSelection = emptySelection.merge({\n        focusOffset: block.getCharacterList().size,\n        anchorOffset: block.getCharacterList().size,\n    });\n    return newSelection;\n}\n\n// An offset is editable if it is not inside an immutable entity\nconst _canEditOffset = (block, offset) => {\n    if (offset === 0 || offset === block.getLength()) {\n        return true;\n    }\n    const leftKey = block.getEntityAt(offset - 1);\n    const rightKey = block.getEntityAt(offset);\n    const isImmutableEntity = rightKey\n        ? Entity.get(rightKey).mutability === \"IMMUTABLE\"\n        : false; // false if not an entity at all\n    return !(isImmutableEntity && leftKey === rightKey);\n};\n\nconst _getSkippedOffset = (contentBlock, startOffset, step) => {\n    let currOffset = startOffset;\n    while (\n        currOffset > 0 &&\n        currOffset < contentBlock.getLength() &&\n        !_canEditOffset(contentBlock, currOffset)\n    ) {\n        currOffset += step;\n    }\n    return currOffset;\n};\n\nfunction snapSelectionOutsideEntities(draftData, prevSelection) {\n    const data = _fillData(draftData);\n    const {contentState, selection, editorState} = data;\n\n    const anchorBlock = contentState.getBlockForKey(selection.getAnchorKey());\n    const focusBlock = contentState.getBlockForKey(selection.getFocusKey());\n    let anchorOffset = selection.getAnchorOffset();\n    let focusOffset = selection.getFocusOffset();\n    const direction = selection.getIsBackward() ? -1 : 1;\n\n    // If the cursor has moved by one, that means the user is moving it\n    // manually with the arrow keys.  If that is happening and the cursor\n    // moves from non-entity to entity, it should skip over the entity.\n    const focusDiff = focusOffset - prevSelection.getFocusOffset();\n    const isSameBlock = selection.getFocusKey() === prevSelection.getFocusKey();\n    if (\n        isSameBlock &&\n        Math.abs(focusDiff) === 1 &&\n        !_canEditOffset(focusBlock, focusOffset)\n    ) {\n        focusOffset = _getSkippedOffset(focusBlock, focusOffset, focusDiff);\n    }\n\n    // These no-op if the offsets aren't/are no longer on entities\n    focusOffset = _getSkippedOffset(focusBlock, focusOffset, direction);\n    anchorOffset = _getSkippedOffset(anchorBlock, anchorOffset, -direction);\n\n    if (selection.isCollapsed()) {\n        anchorOffset = focusOffset;\n    }\n\n    const newData = {contentState};\n    newData.selection = selection.merge({\n        focusOffset,\n        anchorOffset,\n    });\n\n    if (editorState) {\n        // EditorState.forceSelection results in strange behavior\n        // where characters are repeated when typing normally\n        newData.editorState = EditorState.set(editorState, {\n            selection: newData.selection,\n            forceSelection: true,\n        });\n    }\n\n    return newData;\n}\n\nconst _surroundWithText = (contentState, block, left, right, text) => {\n    let area = _createEmptySelection(block);\n    let content = contentState;\n\n    area = area.merge({anchorOffset: right, focusOffset: right});\n    content = Modifier.insertText(content, area, text);\n\n    area = area.merge({anchorOffset: left, focusOffset: left});\n    content = Modifier.insertText(content, area, text);\n\n    return content;\n};\n\nconst _clearSurrounding = (contentState, block, left, right, text) => {\n    let area = _createEmptySelection(block);\n    let content = contentState;\n    area = area.merge({anchorOffset: right - text.length, focusOffset: right});\n    content = Modifier.removeRange(content, area);\n\n    area = area.merge({anchorOffset: left, focusOffset: left + text.length});\n    content = Modifier.removeRange(content, area);\n\n    return content;\n};\n\nfunction toggleDecoration(draftData, decoration) {\n    const data = _fillData(draftData);\n    const newData = {};\n\n    const {contentState, selection} = data;\n    const blocks = _getBlocksForSelection(contentState, selection);\n\n    // If all the blocks are already surrounded by the decoration, we must\n    // instead be disabling the decoration.  To do this without duplicating\n    // code, two copies are made, one as if we were decorating, and another\n    // as if we were removing a decoration.  If it was the case that all\n    // the selected text was already decorated, we use the version which\n    // removed all decoration, otherwise we use the newly decorated one\n    let allSurrounded = true;\n    let decorated = data.contentState;\n    let undecorated = data.contentState;\n    blocks.forEach(block => {\n        let leftOffset = 0;\n        let rightOffset = block.getLength();\n        if (block.getKey() === selection.getStartKey()) {\n            leftOffset = selection.getStartOffset();\n        }\n        if (block.getKey() === selection.getEndKey()) {\n            rightOffset = selection.getEndOffset();\n        }\n\n        // Ignore unless there is something to decorate\n        if (leftOffset === rightOffset) {\n            return;\n        }\n\n        // Check if we are undecorating\n        const selectedStr = block.getText().substring(leftOffset, rightOffset);\n        if (\n            !allSurrounded ||\n            !selectedStr.endsWith(decoration) ||\n            !selectedStr.startsWith(decoration)\n        ) {\n            allSurrounded = false;\n        } else {\n            undecorated = _clearSurrounding(\n                undecorated,\n                block,\n                leftOffset,\n                rightOffset,\n                decoration\n            );\n        }\n\n        // Decorate the decorated version\n        decorated = _surroundWithText(\n            decorated,\n            block,\n            leftOffset,\n            rightOffset,\n            decoration\n        );\n    });\n\n    if (allSurrounded) {\n        newData.contentState = undecorated;\n    } else {\n        newData.contentState = decorated;\n    }\n\n    if (data.editorState) {\n        newData.editorState = EditorState.push(\n            data.editorState,\n            newData.contentState,\n            allSurrounded ? \"remove-range\" : \"insert-characters\"\n        );\n\n        // Shift the selection to deal with the added/removed characters\n        let newEndOffset = selection.getEndOffset();\n        if (newEndOffset > 0) {\n            // If not ending on an empty block (no-ops)\n            const change = allSurrounded ? -2 : 2;\n            newEndOffset += change * decoration.length;\n        }\n\n        let newSelection = null;\n        if (selection.getIsBackward()) {\n            newSelection = selection.merge({anchorOffset: newEndOffset});\n        } else {\n            newSelection = selection.merge({focusOFfset: newEndOffset});\n        }\n\n        newData.editorState = EditorState.forceSelection(\n            newData.editorState,\n            newSelection\n        );\n    }\n\n    return newData;\n}\n\n_module_.exports = {\n    regexStrategy,\n    findPattern,\n    replaceSelection,\n    deleteSelection,\n    getEntities,\n    findEntity,\n    insertText,\n    selectEnd,\n    snapSelectionOutsideEntities,\n    toggleDecoration,\n};\nexport default _module_.exports;\n","import _draftUtilsJs from \"./draft-utils.js\";\nimport _widgetsJs from \"./widgets.js\";\n\nimport {\n    CharacterMetadata,\n    Entity,\n    Editor,\n    EditorState,\n    CompositeDecorator,\n    ContentState,\n    Modifier,\n    genKey,\n    getDefaultKeyBinding,\n    KeyBindingUtil,\n} from \"draft-js\";\n\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/*\nThis is essentially a more advanced `textarea`, using Draft.js\nhttps://facebook.github.io/draft-js/\n\nThe important Draft.js concepts needed to understand this file are:\n    - Everything is immutable, and inputs all result in a new `editorState`\n      object being passed to `handleChange`.  All changes must be done by\n      constructing new objects.  This means simply editing text involves\n      creating a new ContentState, which is used to create a new EditorState\n    - `EditorState` contains a `ContentState` property which contains the data\n      relevant to the text content\n    - `ContentState` is organized into individual \"Blocks\", which helps with\n      performance as updates only affect a single block\n    - Specific text in blocks can be denoted as \"Entities\", which can store\n      data relevant to its text.  This is what allows backspacing a widget\n      to result in its deletion in Perseus\n    - Special styling is done using Decorators, which allow substituting text\n      content with a custom react element\n    - Modifier is a collection of helpful utilities for modification purposes\n\nTODO(samiskin): Make tasks such as \"addWidget\" and \"updateWidget\" not functions\n                that you call on the PerseusEditor component (Can do once this\n                fully replacess the old editor).\n*/\n\nconst React = _react;\nconst Widgets = _widgetsJs;\nconst DraftUtils = _draftUtilsJs;\n\n// This controls the minimum time between when updates for the parent\n// component are generated.  The best time for this number sort of depends\n// on the user's typing speed though, as if the time between each letter being\n// typed is longer than the throttle, they would notice a freeze when the update\n// is being calculated.\n// TODO(samiskin): Figure out whats the best value for this number\n// 100 is best for my typing speed, but may not work as well for slower typists\nconst UPDATE_PARENT_THROTTLE = 100;\n\nconst widgetPlaceholder = \"[[\\u2603 {id}]]\";\nconst widgetRegExp = /\\[\\[\\u2603 [a-z-]+ [0-9]+\\]\\]/g;\nconst widgetPartsRegExp = /^\\[\\[\\u2603 (([a-z-]+) ([0-9]+))\\]\\]$/;\nconst widgetRegexForId = id => new RegExp(`(\\\\[\\\\[\\u2603 ${id}\\\\]\\\\])`, \"gm\");\nconst partialWidgetRegex = /\\[\\[([a-z-]+)$/; // Used for autocompletion\n\nconst imageRegExp = /!\\[[^\\]]*?\\]\\([^\\)].*?\\)/g;\n\n// Note: Nested decorators currently do not work, therefore this will not\n//       work when nesting bold/italics/underline.  Hopefully this is\n//       fixed in future versions of Draft.js\nconst boldRegExp = /\\*\\*([\\s\\S]+?)\\*\\*(?!\\*)/g;\nconst italicsRegExp = /\\**(?:^|[^*])((\\*|_)(\\w+(\\s\\w+)*)\\2)/g; // copied from https://github.com/ayberkt/RFMarkdownTextView/blob/387312e602f03b87f3ef82dc82c62df455d6fd30/RFMarkdownTextView/RFMarkdownSyntaxStorage.m\nconst boldItalicsRegExp = /(\\*\\*\\*\\w+(\\s\\w+)*\\*\\*\\*)/g;\nconst underlineRegExp = /__([\\s\\S]+?)__(?!_)/g;\nconst headerRegExp = /^ *(#{1,6})([^\\n]+)$/g;\n\n/*\n    Styled ranges in Draft.js are done using a `CompositeDecorator`,\n    where a `strategy` is given to denote what ranges of text to style,\n    and a `component` is given to denote how that range should be rendered\n*/\nconst entityStrategy = (contentBlock, callback, type) => contentBlock.findEntityRanges(\n    char => char.getEntity() && Entity.get(char.getEntity()).type === type,\n    callback\n);\n\nconst styledBlock = (props, style) => <span {...props} style={style}>\n    {props.children}\n</span>;\nstyledBlock.propTypes = {children: PropTypes.any};\n\nconst highlightedBlock = (props, backgroundColor) => styledBlock(props, {backgroundColor});\n\nconst entityColorDecorator = (type, color) => ({\n    strategy: (...args) => entityStrategy(...args, type),\n    component: props => highlightedBlock(props, color)\n});\n\nconst regexColorDecorator = (regex, color) => ({\n    strategy: (...args) => DraftUtils.regexStrategy(...args, regex),\n    component: props => highlightedBlock(props, color)\n});\n\nconst boldDecorator = {\n    strategy: (...args) => DraftUtils.regexStrategy(...args, boldRegExp),\n    component: props => styledBlock(props, {fontWeight: \"bold\"}),\n};\n\n// The italics regex has a group that ensures that the *___* block\n// does not include the * used to create a list.  Since this results\n// in match.index also including the first non-capturing group, we must\n// use custom logic for this strategy\nconst italicsStrategy = (...args) => {\n    return DraftUtils.regexStrategy(...args, italicsRegExp, matchArr => {\n        const start = matchArr.index + matchArr[0].length - matchArr[1].length;\n        const end = start + matchArr[1].length;\n        return {start, end};\n    });\n};\nconst italicsDecorator = {\n    strategy: italicsStrategy,\n    component: props => styledBlock(props, {fontStyle: \"italic\"}),\n};\n\nconst underlineDecorator = {\n    strategy: (...args) => DraftUtils.regexStrategy(...args, underlineRegExp),\n    component: props => styledBlock(props, {textDecoration: \"underline\"}),\n};\n\nconst boldItalicsDecorator = {\n    strategy: (...args) => DraftUtils.regexStrategy(...args, boldItalicsRegExp),\n    component: props => styledBlock(props, {\n        fontWeight: \"bold\",\n        fontStyle: \"italic\",\n    }),\n};\n\n// TODO: Make the headers also able to scale with the rest of the text\n// when changing the fontSize percentage\nconst headerComponent = props => {\n    const text = props.decoratedText;\n    const headerSize = text.split(headerRegExp)[1].length;\n    const style = {marginBottom: 0};\n    return React.createElement(`h${headerSize}`, {style}, props.children);\n};\nheaderComponent.propTypes = {\n    decoratedText: PropTypes.string,\n    children: PropTypes.any,\n};\n\nconst headerDecorator = {\n    strategy: (...args) => DraftUtils.regexStrategy(...args, headerRegExp),\n    component: headerComponent,\n};\n\nconst decorator = new CompositeDecorator([\n    entityColorDecorator(\"WIDGET\", \"#DFD\"),\n    entityColorDecorator(\"TEMP_IMAGE\", \"#fdffdd\"),\n    regexColorDecorator(imageRegExp, \"#dffdfa\"),\n    boldItalicsDecorator,\n    boldDecorator,\n    underlineDecorator,\n    italicsDecorator,\n    headerDecorator,\n]);\n\n// Key bindings are handled by mapping events to strings\nconst keyBindings = e => {\n    const isCommandPressed = KeyBindingUtil.hasCommandModifier(e);\n    if (isCommandPressed && e.keyCode === 66) {\n        // 66 = b\n        return \"perseus-bold\";\n    } else if (isCommandPressed && e.keyCode === 73) {\n        // 73 = i\n        return \"perseus-italics\";\n    } else if (isCommandPressed && e.keyCode === 85) {\n        // 85 = u\n        return \"perseus-underline\";\n    } else if (isCommandPressed && e.keyCode === 219) {\n        // 219 = [\n        return \"perseus-decrease-font-size\";\n    } else if (isCommandPressed && e.keyCode === 221) {\n        // 221 = ]\n        return \"perseus-increase-font-size\";\n    } else if (isCommandPressed && e.keyCode === 220) {\n        // 220 = ]\n        return \"perseus-reset-font-size\";\n    } else {\n        return getDefaultKeyBinding(e);\n    }\n};\n\n/*\n    This is the main Draft.js editor.  It keeps track of its internal Draft.js\n    state, however what it exposes through its `onChange` is a simple string\n    as well as a list of the currently active widgets.\n*/\nconst PerseusEditor = createReactClass({\n    propTypes: {\n        onChange: PropTypes.func,\n        content: PropTypes.string,\n        initialWidgets: PropTypes.any,\n        placeholder: PropTypes.string,\n        imageUploader: PropTypes.func,\n        widgetEnabled: PropTypes.bool,\n    },\n\n    getDefaultProps: () => ({\n        onChange: () => {},\n        content: \"\",\n        initialWidgets: {},\n        widgetEnabled: true,\n        placeholder: \"Type here\"\n    }),\n\n    getInitialState() {\n        const {content, initialWidgets, widgetEnabled} = this.props;\n        const contentState = ContentState.createFromText(content);\n        let editorState = EditorState.createWithContent(\n            contentState,\n            decorator\n        );\n\n        if (widgetEnabled) {\n            editorState = this._insertWidgetsAsEntities(\n                editorState,\n                initialWidgets\n            );\n        }\n\n        return {\n            editorState,\n            widgets: initialWidgets,\n            fontSizePercentage: 100,\n        };\n    },\n\n    // The editor can have its content changed completely by changing the\n    // content prop, however if the data this component sent to its parent\n    // using `this.props.onChange()` is being fed back in, ignore it\n    componentDidUpdate(prevProps) {\n        if (this.props.content !== this.lastContentUpdate) {\n            this.lastContentUpdate = this.props.content;\n            this.setState(this.getInitialState()); //eslint-disable-line\n        }\n    },\n\n    // By turning widgets into Entities, we allow for widgets to be considered\n    // \"IMMUTABLE\", that is, backspacing a widget will delete the entire text\n    // rather than just a \"]\" character.  It also enables us to detect which\n    // widget id has been deleted, as metadata can be attached to entities\n    // TODO(samiskin): Turn this task of `applyEntities(pattern, createEntity)`\n    // into a DraftUtils function\n    _insertWidgetsAsEntities(editorState, widgets) {\n        let content = editorState.getCurrentContent();\n\n        Object.keys(widgets).forEach(id => {\n            const selection = DraftUtils.findPattern(\n                content,\n                widgetRegexForId(id)\n            ); //eslint-disable-line max-len\n            if (selection) {\n                // Sometimes the widgets don't actually exist\n                const entity = Entity.create(\"WIDGET\", \"IMMUTABLE\", {id});\n                content = Modifier.applyEntity(content, selection, entity);\n            }\n        });\n\n        // EditorState.set is used rather than push, because no state should\n        // be added to the undo stack.\n        const withEntity = EditorState.set(editorState, {\n            currentContent: content,\n        });\n\n        return withEntity;\n    },\n\n    _getDraftData() {\n        const editorState = this.state.editorState;\n        const contentState = editorState.getCurrentContent();\n        const selection = editorState.getSelection();\n        return {editorState, contentState, selection};\n    },\n\n    _getNextWidgetId(type) {\n        const currWidgets = this.state.widgets;\n        return Object.keys(currWidgets)\n            .filter(id => currWidgets[id].type === type)\n            .map(id => +id.split(\" \")[1]) //ids are (([a-z-]+) ([0-9]+))\n            .reduce((maxId, currId) => Math.max(maxId, currId), 0);\n    },\n\n    _createInitialWidget(widgetType) {\n        // Since widgets are given IDs, adding a new widget must ensure that a\n        // unique id is generated for it.\n        const widgetNum = this._getNextWidgetId(widgetType);\n        const id = widgetType + \" \" + (widgetNum + 1);\n        const widget = {\n            options: Widgets.getEditor(widgetType).defaultProps,\n            type: widgetType,\n            // Track widget version on creation, so that a widget editor\n            // without a valid version prop can only possibly refer to a\n            // pre-versioning creation time.\n            version: Widgets.getVersion(widgetType),\n        };\n        return [id, widget];\n    },\n\n    addWidget(type) {\n        this.focus(() => this._handleChange(this._insertNewWidget(type)));\n    },\n\n    _insertNewWidget(type, draftDataParams) {\n        const draftData = {\n            ...this._getDraftData(),\n            ...draftDataParams,\n        };\n        const [id, widget] = this._createInitialWidget(type);\n\n        const newWidgets = {...this.state.widgets, [id]: widget};\n        const newDraftData = this._insertWidgetText(draftData, id);\n\n        return {\n            editorState: newDraftData.editorState,\n            widgets: newWidgets,\n        };\n    },\n\n    _insertWidgetText(draftData, id) {\n        // Text for the widget is inserted, and an entity is assigned\n        const text = widgetPlaceholder.replace(\"{id}\", id);\n        const entity = Entity.create(\"WIDGET\", \"IMMUTABLE\", {id});\n\n        return DraftUtils.replaceSelection(draftData, text, entity);\n    },\n\n    updateWidget(id, newProps) {\n        this.setState({widgets: {...this.state.widgets, [id]: newProps}});\n    },\n\n    // This function only removes the widget from the content, and then\n    // handleChange handles removing widgets from the state, as widgets\n    // can also be deleted by editor actions such as backspace and delete\n    removeWidget(id) {\n        this.focus(() => {\n            const {editorState, contentState} = this._getDraftData();\n            const selection = DraftUtils.findPattern(\n                contentState,\n                widgetRegexForId(id)\n            ); //eslint-disable-line max-len\n            const newDraftData = DraftUtils.deleteSelection({\n                editorState,\n                selection,\n            });\n\n            this._handleChange({editorState: newDraftData.editorState});\n        });\n    },\n\n    addTemplate(templateType) {\n        this.focus(() => {\n            this._addTemplate(templateType);\n        });\n    },\n\n    _addTemplate(templateType) {\n        let {editorState, contentState, selection} = this._getDraftData();\n\n        const widgets = {...this.state.widgets};\n\n        // Templates shouldn't interrupt a line if the cursor is not at the end\n        const currBlock = contentState.getBlockForKey(selection.getEndKey());\n        selection = DraftUtils.selectEnd(currBlock);\n\n        // Insert a new line at the beginning if there is content there, that\n        // way the template appears on a newline in the rendered markdown\n        if (currBlock.getText().length > 0) {\n            contentState = Modifier.splitBlock(contentState, selection);\n            selection = contentState.getSelectionAfter();\n        }\n\n        if (templateType === \"allWidgets\") {\n            const allTypes = Widgets.getAllWidgetTypes().sort();\n\n            // Insert a newline at the beginning\n            contentState = Modifier.splitBlock(contentState, selection);\n            contentState = allTypes.reduce((content, type) => {\n                const [id, widget] = this._createInitialWidget(type);\n                widgets[id] = widget;\n                content = this._insertWidgetText(\n                    {\n                        contentState: content,\n                        selection: content.getSelectionAfter(),\n                    },\n                    id\n                ).contentState;\n                return Modifier.splitBlock(\n                    // Put each widget on a new line\n                    content,\n                    content.getSelectionAfter()\n                );\n            }, contentState);\n\n            editorState = EditorState.push(\n                editorState,\n                contentState,\n                \"insert-fragment\"\n            );\n        } else {\n            let template = \"\";\n            if (templateType === \"table\") {\n                template =\n                    \"header 1 | header 2 | header 3\\n\" +\n                    \"- | - | -\\n\" +\n                    \"data 1 | data 2 | data 3\\n\" +\n                    \"data 4 | data 5 | data 6\\n\" +\n                    \"data 7 | data 8 | data 9\";\n            } else if (templateType === \"titledTable\") {\n                template =\n                    \"|| **Table title** ||\\n\" +\n                    \"header 1 | header 2 | header 3\\n\" +\n                    \"- | - | -\\n\" +\n                    \"data 1 | data 2 | data 3\\n\" +\n                    \"data 4 | data 5 | data 6\\n\" +\n                    \"data 7 | data 8 | data 9\";\n            } else if (templateType === \"alignment\") {\n                template =\n                    \"$\\\\begin{align} x+5 &= 30 \\\\\\\\\\n\" +\n                    \"x+5-5 &= 30-5 \\\\\\\\\\n\" +\n                    \"x &= 25 \\\\end{align}$\";\n            } else if (templateType === \"piecewise\") {\n                template =\n                    \"$f(x) = \\\\begin{cases}\\n\" +\n                    \"7 & \\\\text{if }x=1 \\\\\\\\\\n\" +\n                    \"f(x-1)+5 & \\\\text{if }x > 1\\n\" +\n                    \"\\\\end{cases}$\";\n            }\n\n            editorState = DraftUtils.insertText(\n                {editorState, contentState, selection},\n                `\\n${template}\\n`\n            ).editorState;\n        }\n        this._handleChange({editorState, widgets});\n    },\n\n    _handleCopy() {\n        const {contentState, selection} = this._getDraftData();\n        const entities = DraftUtils.getEntities(contentState, selection);\n\n        const copiedWidgets = entities.reduce((map, entity) => {\n            const id = entity.getData().id;\n            map[id] = this.state.widgets[id];\n            return map;\n        }, {});\n\n        localStorage.perseusLastCopiedWidgets = JSON.stringify(copiedWidgets);\n        return false;\n    },\n\n    // Widgets cannot have ID conflicts, therefore this function exists\n    // to return a mapping of { new id -> safe id }\n    _createSafeWidgetMapping(newWidgets, currentWidgets) {\n        // Create a mapping of { type -> largest id of that type }\n        const maxIds = Object.keys(currentWidgets).reduce((idMap, widget) => {\n            const [type, id] = widget.split(\" \");\n            idMap[type] = idMap[type] ? Math.max(idMap[type], +id) : +id;\n            return idMap;\n        }, {});\n\n        const safeWidgetMapping = Object.keys(\n            newWidgets\n        ).reduce((safeMap, widget) => {\n            const type = widget.split(\" \")[0];\n            maxIds[type] = maxIds[type] ? maxIds[type] + 1 : 1;\n            safeMap[widget] = type + \" \" + maxIds[type];\n            return safeMap;\n        }, {});\n\n        return safeWidgetMapping;\n    },\n\n    // Pasting text from another Perseus editor instance should also copy over\n    // the widgets.  To do this properly, we must parse the text, replace the\n    // widget ids with non-conflicting ones, store them, and also assign them\n    // proper entities.  Sadly Draft.js only supports `handlePastedText` which\n    // happens prior to the new content state being generated (which is needed\n    // to add entities to).  We therefore must reimplement the default Paste\n    // functionality, in order to add our custom steps afterwards\n    _handlePaste(pastedText, html, selection) {\n        // If no widgets are in localstorage, just use default behavior\n        const sourceWidgetsJSON = localStorage.perseusLastCopiedWidgets;\n        if (!sourceWidgetsJSON) {\n            return false;\n        }\n\n        const sourceWidgets = JSON.parse(sourceWidgetsJSON);\n        const widgets = {...this.state.widgets};\n        const safeWidgetMapping = this._createSafeWidgetMapping(\n            sourceWidgets,\n            widgets\n        ); //eslint-disable-line max-len\n        const charData = CharacterMetadata.create();\n\n        // insertText takes a sanitizer function which gets ran on every\n        // line.  It is used here in order to fix the new widgets to not\n        // have conflicting IDs, as well as fill in the widget data\n        const sanitizeText = textLine => {\n            const sanitized = textLine.replace(new RegExp(\"\\r\", \"g\"), \"\"); //eslint-disable-line no-control-regex\n            const characterList = Array(sanitized.length).fill(charData);\n            const safeText = sanitized.replace(\n                widgetRegExp,\n                (syntax, offset) => {\n                    //eslint-disable-line max-len\n                    const match = widgetPartsRegExp.exec(syntax);\n                    const fullText = match[0]; // The entire [[ widgetName id ]]\n                    const widgetId = match[1]; // Just the \"widgetName id\" part\n                    const newId = safeWidgetMapping[widgetId];\n                    const newText = widgetPlaceholder.replace(\"{id}\", newId);\n\n                    // Create an entity for the new widget, and assign it to the\n                    // characters that match up to the new widget text (splice)\n                    const entity = Entity.create(\"WIDGET\", \"IMMUTABLE\", {\n                        id: newId,\n                    }); //eslint-disable-line max-len\n                    const entityChar = CharacterMetadata.applyEntity(\n                        charData,\n                        entity\n                    ); //eslint-disable-line max-len\n                    const entityChars = Array(newText.length).fill(entityChar);\n                    characterList.splice(\n                        offset,\n                        fullText.length,\n                        ...entityChars\n                    );\n\n                    widgets[newId] = sourceWidgets[widgetId];\n                    return fullText.replace(widgetId, newId);\n                }\n            );\n            return {text: safeText, characterList};\n        };\n\n        const data = this._getDraftData();\n        data.selection = selection || data.selection;\n        const {editorState} = DraftUtils.insertText(\n            data,\n            pastedText,\n            sanitizeText\n        );\n        this._handleChange({editorState, widgets});\n        return true; // True means draft doesn't run its default behavior\n    },\n\n    _handleDrop(selection, dataTransfer) {\n        // All insertions are done to the end of the current block\n        const contentState = this.state.editorState.getCurrentContent();\n        const endKey = selection.getEndKey();\n        const endBlock = contentState.getBlockForKey(endKey);\n        const endSelection = DraftUtils.selectEnd(endBlock);\n\n        const imageUrl = dataTransfer.getLink();\n        if (imageUrl) {\n            // Adds new lines and collapses the selection\n            const {editorState} = DraftUtils.insertText(\n                {...this._getDraftData(), selection: endSelection},\n                `\\n![](${imageUrl})`\n            );\n            this._handleChange({editorState});\n        } else {\n            const text = dataTransfer.getText();\n            return this._handlePaste(text, null, endSelection);\n        }\n\n        return true; // Disable default draft drop handler\n    },\n\n    _handleDroppedFiles(selection, files) {\n        const images = files.filter(file => file.type.match(\"image.*\"));\n        let contentState = this.state.editorState.getCurrentContent();\n        images.forEach(image => {\n            // Insert placeholder text to show that the image is being uploaded\n            const text = `![](${image.name}...)`;\n            const id = genKey();\n            const entity = Entity.create(\"TEMP_IMAGE\", \"IMMUTABLE\", {id});\n\n            const charData = CharacterMetadata.create().merge({entity});\n            const characterList = Array(text.length).fill(charData);\n            const sanitizer = textLine => textLine === text ? {text, characterList} : null;\n\n            const blockKey = selection.getEndKey();\n            const contentBlock = contentState.getBlockForKey(blockKey);\n            const endOfBlockSelection = DraftUtils.selectEnd(contentBlock);\n            contentState = DraftUtils.insertText(\n                {contentState, selection: endOfBlockSelection},\n                `\\n${text}\\n`,\n                sanitizer\n            ).contentState;\n\n            // Begin uploading the image, and update the link once complete\n            this.props.imageUploader(image, url => {\n                const currEditor = this.state.editorState;\n                const currContent = currEditor.getCurrentContent();\n                const placeholderLocation = DraftUtils.findEntity(\n                    currContent,\n                    c => c.getData().id === id\n                );\n                const newDraftData = DraftUtils.replaceSelection(\n                    {\n                        editorState: currEditor,\n                        contentState: currContent,\n                        selection: placeholderLocation,\n                    },\n                    `![](${url})`\n                );\n                this._handleChange({editorState: newDraftData.editorState});\n            });\n        });\n        const editorState = EditorState.push(\n            this.state.editorState,\n            contentState,\n            \"insert-fragment\"\n        );\n        this._handleChange({editorState});\n        return true; // Disable default draft drop handler\n    },\n\n    // This implements tab completion for widgets.  When the user\n    // has typed [[d, then presses tab, we should replace [[d\n    // with the full [[ {emoji} dropdown 1 ]] text\n    _handleTab(e) {\n        const {contentState, selection} = this._getDraftData();\n\n        // isCollapsed means that there is no active selection, its just\n        // a blinking cursor.  For the SelectionState object, this\n        // essentially means that anchorOffset === focusOffset\n        if (!selection.isCollapsed() || !this.props.widgetEnabled) {\n            return;\n        }\n        e.preventDefault();\n\n        const currBlock = contentState.getBlockForKey(selection.getEndKey());\n        const text = currBlock.getText().substring(0, selection.getEndOffset());\n        const match = text.match(partialWidgetRegex);\n        if (match) {\n            const partialName = match[1];\n            const allWidgets = Widgets.getAllWidgetTypes();\n            const matchingWidgets = allWidgets.filter(widget => {\n                return widget.substring(0, partialName.length) === partialName;\n            });\n\n            // If only one match is available, complete it\n            if (matchingWidgets.length === 1) {\n                const widgetType = matchingWidgets[0];\n                const replacementArea = selection.merge({\n                    anchorOffset: match.index,\n                });\n\n                this._handleChange(\n                    this._insertNewWidget(widgetType, {\n                        selection: replacementArea,\n                    })\n                );\n            }\n        }\n        return true; // Say that we've handled the event, no other work needed\n    },\n\n    _getDecorationForStyle(style) {\n        switch (style) {\n            case \"perseus-bold\":\n                return \"**\";\n            case \"perseus-italics\":\n                return \"*\";\n            case \"perseus-underline\":\n                return \"__\";\n            default:\n                return null;\n        }\n    },\n\n    _handleKeyCommand(command) {\n        // Check if the font size should be changed\n        const {fontSizePercentage} = this.state;\n        if (command === \"perseus-increase-font-size\") {\n            this.setState({fontSizePercentage: fontSizePercentage + 10});\n            return true;\n        } else if (command === \"perseus-decrease-font-size\") {\n            this.setState({fontSizePercentage: fontSizePercentage - 10});\n            return true;\n        } else if (command === \"perseus-reset-font-size\") {\n            this.setState({fontSizePercentage: 100});\n            return true;\n        }\n\n        // Check whether a style such as bold/italics/underline should be added\n        const decoration = this._getDecorationForStyle(command);\n        if (decoration !== null) {\n            const data = this._getDraftData();\n            const {editorState} = DraftUtils.toggleDecoration(data, decoration);\n            this._handleChange({editorState});\n            return true;\n        }\n\n        return false;\n    },\n\n    lastContentUpdate: \"\",\n    _updateParent(content, widgets) {\n        // The parent component should know of only the active widgets,\n        // however the widgets are not deleted from this.state because a\n        // user undoing a widget deletion should also recover the\n        // widget's metadata\n        const currEntities = DraftUtils.getEntities(content);\n        const visibleWidgets = currEntities.reduce((map, entity) => {\n            const id = entity.getData().id;\n            map[id] = widgets[id];\n            return map;\n        }, {});\n\n        this.lastContentUpdate = content.getPlainText(\"\\n\");\n\n        // Provide the parent component with the current text\n        // representation, as well as the current active widgets\n        this.props.onChange({\n            content: this.lastContentUpdate,\n            widgets: visibleWidgets,\n        });\n    },\n\n    pastContentState: null,\n    lastIdleCallback: null,\n    _handleChange(newState) {\n        const state = {...this.state, ...newState};\n        const widgets = state.widgets;\n        let editorState = state.editorState;\n\n        // The cursor should not exist within an entity\n        editorState = DraftUtils.snapSelectionOutsideEntities(\n            {editorState},\n            this.state.editorState.getSelection()\n        ).editorState;\n\n        const newContent = editorState.getCurrentContent();\n\n        // editorState contains more than just the content, such as the current\n        // cursor position.  This means `handleChange` gets called for more than\n        // just content changes, so certain calculations aren't always needed.\n        if (newContent !== this.pastContentState) {\n            // This ensures that unless the content stops changing for a certain\n            // short duration, no processing will be done to update the parent.\n            // This allows the editing to remain performant for large files,\n            // as basic tasks only occur on individual ContentBlocks, while\n            // updating the parent involves iterating through them all\n            clearTimeout(this.lastIdleCallback);\n            this.lastIdleCallback = setTimeout(\n                () => this._updateParent(newContent, widgets),\n                UPDATE_PARENT_THROTTLE\n            );\n        }\n\n        this.pastContentState = newContent;\n        this.setState({editorState, widgets});\n    },\n\n    // HACK: There are currently serious Draft.js bugs related to mutating the\n    //       editorState when it is not in focus, then pressing undo.  This\n    //       workaround uses a callback parameter to run code after the\n    //       editorState has been updated to be in focus, that way functions\n    //       such as addWidget will not bring up serious issues when undone\n    focus(callback) {\n        this.editor.focus();\n        let editorState = this.state.editorState;\n        editorState = EditorState.set(editorState, {\n            selection: editorState.getSelection().set(\"hasFocus\", true),\n            forceSelection: true,\n        });\n        this.setState({editorState}, callback);\n    },\n\n    render() {\n        return (\n            <div\n                onCopy={this._handleCopy}\n                onCut={this._handleCopy}\n                onDragStart={this._handleCopy}\n                style={{\n                    fontSize: `${this.state.fontSizePercentage}%`,\n                }}\n            >\n                <Editor\n                    ref={e => this.editor = e}\n                    editorState={this.state.editorState}\n                    onChange={editorState => this._handleChange({editorState})}\n                    spellCheck={true}\n                    stripPastedStyles={true}\n                    placeholder={this.props.placeholder}\n                    handlePastedText={this._handlePaste}\n                    handleDroppedFiles={this._handleDroppedFiles}\n                    handleDrop={this._handleDrop}\n                    keyBindingFn={keyBindings}\n                    handleKeyCommand={this._handleKeyCommand}\n                    onTab={this._handleTab}\n                />\n            </div>\n        );\n    },\n});\n\n_module_.exports = PerseusEditor;\nexport default _module_.exports;\n","import { css, StyleSheet } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Displays a collapsable list of KaTeX rendering errors.\n */\nconst React = _react;\n\nconst KatexErrorView = createReactClass({\n    propTypes: {\n        errorList: PropTypes.arrayOf(\n            PropTypes.shape({\n                math: PropTypes.string.isRequired,\n                message: PropTypes.string.isRequired,\n            })\n        ).isRequired,\n    },\n\n    getInitialState() {\n        return {\n            showErrors: false,\n        };\n    },\n\n    handleToggleKatexErrors(e) {\n        this.setState({showErrors: !this.state.showErrors});\n    },\n\n    render() {\n        const {errorList} = this.props;\n        const {showErrors} = this.state;\n\n        // TODO(riley) replace with SVG icons\n        const disclosureClass = showErrors\n            ? \"icon-chevron-down\"\n            : \"icon-chevron-right\";\n\n        return (\n            <div className={css(styles.errorContainer)}>\n                <div\n                    className={css(styles.title)}\n                    onClick={this.handleToggleKatexErrors}\n                >\n                    <i className={disclosureClass} style={{fontSize: 14}} />\n                    &nbsp; KaTeX Errors ({errorList.length})\n                </div>\n                {showErrors &&\n                    <div className={css(styles.errorExplanation)}>\n                        These errors will cause your LaTeX to load really slowly\n                        for the student. Please fix them if you can. If you\n                        cant because KaTeX doesnt support the feature you\n                        need, please message Cam.\n                    </div>}\n                {showErrors &&\n                    errorList.map((e, index) => <div className={css(styles.error)} key={index}>\n                        <div style={{color: \"red\"}}>\n                            {e.math}\n                        </div>\n                        <div>\n                            {e.message}\n                        </div>\n                    </div>\n                    )}\n            </div>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    title: {\n        backgroundColor: \"#eee\",\n        fontSize: \"1.25em\",\n        padding: \"4px 10px\",\n    },\n    errorContainer: {\n        border: \"1px solid #ddd\",\n        borderTop: \"none\",\n    },\n    errorExplanation: {\n        padding: \"4px 10px\",\n        backgroundColor: \"pink\",\n    },\n    error: {\n        padding: \"4px 10px\",\n    },\n});\n\n_module_.exports = KatexErrorView;\nexport default _module_.exports;\n","import _mixinsWidgetPropBlacklistJsx from \"./mixins/widget-prop-blacklist.jsx\";\nimport _perseusEditorJsx from \"./perseus-editor.jsx\";\nimport _utilKatexPreprocessJs from \"./util/katex-preprocess.js\";\nimport _widgetsJs from \"./widgets.js\";\nimport _utilJs from \"./util.js\";\nimport _componentsPropCheckBoxJsx from \"./components/prop-check-box.jsx\";\nimport _perseusMarkdownJsx from \"./perseus-markdown.jsx\";\nimport _katexErrorViewJsx from \"./katex-error-view.jsx\";\nimport _componentsInlineIconJsx from \"./components/inline-icon.jsx\";\nimport { iconChevronDown, iconChevronRight, iconTrash } from \"./icon-paths.js\";\nimport _reactComponentsDragTargetJsx from \"react-components/drag-target.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _jquery from \"jquery\";\nimport _reactAddonsCreateFragment from \"react-addons-create-fragment\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable max-lines, no-console, no-var, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals katex */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar ReactCreateFragment = _reactAddonsCreateFragment;\nvar $ = _jquery;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar DragTarget = _reactComponentsDragTargetJsx;\nvar InlineIcon = _componentsInlineIconJsx;\nvar KatexErrorView = _katexErrorViewJsx;\nvar PerseusMarkdown = _perseusMarkdownJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\nvar Util = _utilJs;\nvar Widgets = _widgetsJs;\nvar preprocessTex = _utilKatexPreprocessJs;\n\nvar PerseusEditor = _perseusEditorJsx;\n\nvar WIDGET_PROP_BLACKLIST = _mixinsWidgetPropBlacklistJsx;\n\n// like [[snowman input-number 1]]\nvar widgetPlaceholder = \"[[\\u2603 {id}]]\";\nvar widgetRegExp = \"(\\\\[\\\\[\\u2603 {id}\\\\]\\\\])\";\nvar rWidgetSplit = new RegExp(\n    widgetRegExp.replace(\"{id}\", \"[a-z-]+ [0-9]+\"),\n    \"g\"\n);\n\nvar shortcutRegexp = /^\\[\\[([a-z\\-]+)$/; // like [[nu, [[int, etc\n\nvar ENDS_WITH_A_PARAGRAPH = /(?:\\n{2,}|^\\n*)$/;\nvar TRAILING_NEWLINES = /(\\n*)$/;\nvar LEADING_NEWLINES = /^(\\n*)/;\n\nvar commafyInteger = n => {\n    var str = n.toString();\n    if (str.length >= 5) {\n        str = str.replace(/(\\d)(?=(\\d{3})+$)/g, \"$1{,}\");\n    }\n    return str;\n};\nvar makeEndWithAParagraphIfNecessary = content => {\n    if (!ENDS_WITH_A_PARAGRAPH.test(content)) {\n        var newlines = TRAILING_NEWLINES.exec(content)[1];\n        return content + \"\\n\\n\".slice(0, 2 - newlines.length);\n    } else {\n        return content;\n    }\n};\nvar makeStartWithAParagraphAlways = content => {\n    var newlines = LEADING_NEWLINES.exec(content)[1];\n    return \"\\n\\n\".slice(0, 2 - newlines.length) + content;\n};\n\nvar WidgetSelect = createReactClass({\n    shouldComponentUpdate: function() {\n        return false;\n    },\n\n    handleChange: function(e) {\n        var widgetType = e.target.value;\n        if (widgetType === \"\") {\n            // TODO(alpert): Not sure if change will trigger here\n            // but might as well be safe\n            return;\n        }\n        if (this.props.onChange) {\n            this.props.onChange(widgetType);\n        }\n    },\n\n    render: function() {\n        var widgets = Widgets.getPublicWidgets();\n        var orderedWidgetNames = _.sortBy(_.keys(widgets), name => {\n            return widgets[name].displayName;\n        });\n        var addWidgetString = \"Add a widget\\u2026\";\n        return (\n            <select value=\"\" onChange={this.handleChange}>\n                <option value=\"\">\n                    {addWidgetString}\n                </option>\n                <option disabled>--</option>\n                {_.map(orderedWidgetNames, name => {\n                    return (\n                        <option key={name} value={name}>\n                            {widgets[name].displayName}\n                        </option>\n                    );\n                })}\n            </select>\n        );\n    },\n});\n\n// This component handles upgading widget editor props via prop\n// upgrade transforms. Widget editors will always be rendered\n// with all available transforms applied, but the results of those\n// transforms will not be propogated upwards until serialization.\nvar WidgetEditor = createReactClass({\n    propTypes: {\n        // Unserialized props\n        id: PropTypes.string.isRequired,\n        onChange: PropTypes.func.isRequired,\n        onRemove: PropTypes.func.isRequired,\n        apiOptions: ApiOptions.propTypes,\n\n        // Serialized props\n        type: PropTypes.string.isRequired,\n        alignment: PropTypes.string,\n        static: PropTypes.bool,\n        graded: PropTypes.bool,\n        options: PropTypes.any,\n        version: PropTypes.shape({\n            major: PropTypes.number.isRequired,\n            minor: PropTypes.number.isRequired,\n        }),\n    },\n\n    getInitialState: function() {\n        return {\n            showWidget: false,\n        };\n    },\n\n    componentWillMount: function() {\n        this._upgradeWidgetInfo(this.props);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this._upgradeWidgetInfo(nextProps);\n    },\n\n    _upgradeWidgetInfo: function(props) {\n        // We can't call serialize here because this.refs.widget\n        // doesn't exist before this component is mounted.\n        var filteredProps = _.omit(props, WIDGET_PROP_BLACKLIST);\n        var info = Widgets.upgradeWidgetInfoToLatestVersion(filteredProps);\n        this.setState({\n            widgetInfo: info,\n        });\n    },\n\n    _toggleWidget: function(e) {\n        e.preventDefault();\n        this.setState({showWidget: !this.state.showWidget});\n    },\n\n    _handleWidgetChange: function(newProps, cb, silent) {\n        var newWidgetInfo = _.clone(this.state.widgetInfo);\n        newWidgetInfo.options = _.extend(\n            this.refs.widget.serialize(),\n            newProps\n        );\n        this.props.onChange(newWidgetInfo, cb, silent);\n    },\n\n    _toggleStatic: function(e) {\n        e.preventDefault();\n        var newWidgetInfo = _.extend({}, this.state.widgetInfo, {\n            static: !this.state.widgetInfo.static,\n        });\n        this.props.onChange(newWidgetInfo);\n    },\n\n    _handleAlignmentChange: function(e) {\n        var newAlignment = e.target.value;\n        var newWidgetInfo = _.clone(this.state.widgetInfo);\n        newWidgetInfo.alignment = newAlignment;\n        this.props.onChange(newWidgetInfo);\n    },\n\n    render: function() {\n        var widgetInfo = this.state.widgetInfo;\n\n        var Ed = Widgets.getEditor(widgetInfo.type);\n        var supportedAlignments;\n        if (this.props.apiOptions.showAlignmentOptions) {\n            supportedAlignments = Widgets.getSupportedAlignments(\n                widgetInfo.type\n            );\n        } else {\n            supportedAlignments = [\"default\"];\n        }\n\n        var supportsStaticMode = Widgets.supportsStaticMode(widgetInfo.type);\n\n        var isUngradedEnabled = widgetInfo.type === \"transformer\";\n        var gradedPropBox = (\n            <PropCheckBox\n                label=\"Graded:\"\n                graded={widgetInfo.graded}\n                onChange={this.props.onChange}\n            />\n        );\n\n        return (\n            <div className=\"perseus-widget-editor\">\n                <div\n                    className={\n                        \"perseus-widget-editor-title \" +\n                        (this.state.showWidget ? \"open\" : \"closed\")\n                    }\n                >\n                    <a\n                        className=\"perseus-widget-editor-title-id\"\n                        href=\"#\"\n                        onClick={this._toggleWidget}\n                    >\n                        {this.props.id}\n                        {this.state.showWidget\n                            ? <InlineIcon {...iconChevronDown} />\n                            : <InlineIcon {...iconChevronRight} />}\n                    </a>\n\n                    {supportsStaticMode &&\n                        <input\n                            type=\"button\"\n                            onClick={this._toggleStatic}\n                            className=\"simple-button--small\"\n                            value={\n                                widgetInfo.static\n                                    ? \"Unset as static\"\n                                    : \"Set as static\"\n                            }\n                        />}\n                    {supportedAlignments.length > 1 &&\n                        <select\n                            className=\"alignment\"\n                            value={widgetInfo.alignment}\n                            onChange={this._handleAlignmentChange}\n                        >\n                            {supportedAlignments.map(alignment => <option key={alignment}>\n                                {alignment}\n                            </option>\n                            )}\n                        </select>}\n                    <a\n                        href=\"#\"\n                        className={\n                            \"remove-widget \" +\n                            \"simple-button simple-button--small orange\"\n                        }\n                        onClick={e => {\n                            e.preventDefault();\n                            this.props.onRemove();\n                        }}\n                    >\n                        <InlineIcon {...iconTrash} />\n                    </a>\n                </div>\n                <div\n                    className={\n                        \"perseus-widget-editor-content \" +\n                        (this.state.showWidget ? \"enter\" : \"leave\")\n                    }\n                >\n                    {isUngradedEnabled && gradedPropBox}\n                    <Ed\n                        ref=\"widget\"\n                        onChange={this._handleWidgetChange}\n                        static={widgetInfo.static}\n                        apiOptions={this.props.apiOptions}\n                        {...widgetInfo.options}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    getSaveWarnings: function() {\n        var issuesFunc = this.refs.widget.getSaveWarnings;\n        return issuesFunc ? issuesFunc() : [];\n    },\n\n    serialize: function() {\n        // TODO(alex): Make this properly handle the case where we load json\n        // with a more recent widget version than this instance of Perseus\n        // knows how to handle.\n        var widgetInfo = this.state.widgetInfo;\n        return {\n            type: widgetInfo.type,\n            alignment: widgetInfo.alignment,\n            static: widgetInfo.static,\n            graded: widgetInfo.graded,\n            options: this.refs.widget.serialize(),\n            version: widgetInfo.version,\n        };\n    },\n});\n\n// This is more general than the actual markdown image parsing regex,\n// which is fine for correctness since it should only mean we could\n// store extra image dimensions, unless the question is insanely\n// formatted.\n// A simplified regex here should hopefully be easier to keep in\n// sync if the markdown parsing changes, though if it becomes\n// easy to hook into the actual markdown regex without copy-pasting\n// it, we should do that.\nvar IMAGE_REGEX = /!\\[[^\\]]*\\]\\(([^\\s\\)]+)[^\\)]*\\)/g;\n\n/**\n * Find all the matches to a /g regex.\n *\n * Returns an array of the regex matches. Infinite loops if `regex` does not\n * have a /g modifier.\n *\n * Note: Returns an array of the capture objects, whereas String::match\n * ignores captures. If you don't need captures, use String::match\n */\nvar allMatches = function(regex, str) {\n    var result = [];\n    while (true) { // eslint-disable-line no-constant-condition\n        var match = regex.exec(str);\n        if (!match) {\n            break;\n        }\n        result.push(match);\n    }\n    return result;\n};\n\n/**\n * Return an array of URLs of all the images in the given renderer\n * markdown.\n */\nvar imageUrlsFromContent = function(content) {\n    return _.map(allMatches(IMAGE_REGEX, content), capture => capture[1]);\n};\n\n/**\n * NOTE: This Editor class contains a ton of legacy logic which is not used,\n *        as a rewrite using Draft.js was implemented in perseus-editor.jsx.\n *        This code remains as a backup in case bugs in the rewrite block\n *        content creators.\n *        If you are going to make Editor changes, you likely want to navigate\n *        to perseus-editor.jsx\n * TODO: Clear out all the textarea code and replace with Draft.js once we are\n *       comfortable that it is working well consistently\n */\nvar Editor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        imageUploader: PropTypes.func,\n        onChange: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            placeholder: \"\",\n            widgets: {},\n            images: {},\n            disabled: false,\n            widgetEnabled: true,\n            immutableWidgets: false,\n            showWordCount: false,\n            warnNoPrompt: false,\n            warnNoWidgets: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            showKatexErrors: false,\n        };\n    },\n\n    getWidgetEditor: function(id, type) {\n        if (!Widgets.getEditor(type)) {\n            return;\n        }\n        return (\n            <WidgetEditor\n                ref={id}\n                id={id}\n                type={type}\n                onChange={this._handleWidgetEditorChange.bind(this, id)}\n                onRemove={this._handleWidgetEditorRemove.bind(this, id)}\n                apiOptions={this.props.apiOptions}\n                {...this.props.widgets[id]}\n            />\n        );\n    },\n\n    _handleWidgetEditorChange: function(id, newProps, cb, silent) {\n        var widgets = _.clone(this.props.widgets);\n        widgets[id] = _.extend({}, widgets[id], newProps);\n        if (this.props.apiOptions.useDraftEditor) {\n            this.refs.textarea.updateWidget(id, newProps);\n        }\n        this.props.onChange({widgets: widgets}, cb, silent);\n    },\n\n    _handleWidgetEditorRemove: function(id) {\n        const textarea = this.refs.textarea;\n        if (this.props.apiOptions.useDraftEditor) {\n            textarea.removeWidget(id);\n        } else {\n            const re = new RegExp(widgetRegExp.replace(\"{id}\", id), \"gm\");\n            this.props.onChange({content: textarea.value.replace(re, \"\")});\n        }\n    },\n\n    /**\n     * Calculate the size of all the images in props.content, and send\n     * those sizes to this.props.images using props.onChange.\n     */\n    _sizeImages: function(props) {\n        var imageUrls = imageUrlsFromContent(props.content);\n\n        // Discard any images in our dimension table that no\n        // longer exist in content.\n        var images = _.pick(props.images, imageUrls);\n\n        // Only calculate sizes for images that were not present previously.\n        // Most content edits shouldn't have new images.\n        // This could get weird in the case of multiple images with the same\n        // URL, if you've changed the backing image size, but given graphie\n        // hashes it's probably an edge case.\n        var newImageUrls = _.filter(imageUrls, url => !images[url]);\n\n        // TODO(jack): Q promises would make this nicer and only\n        // fire once.\n        _.each(newImageUrls, url => {\n            Util.getImageSize(url, (width, height) => {\n                // We keep modifying the same image object rather than a new\n                // copy from this.props because all changes here are additive.\n                // Maintaining old changes isn't strictly necessary if\n                // props.onChange calls are not batched, but would be if they\n                // were, so this is nice from that anti-race-condition\n                // perspective as well.\n                images[url] = {\n                    width: width,\n                    height: height,\n                };\n                props.onChange(\n                    {\n                        images: _.clone(images),\n                    },\n                    null, // callback\n                    true // silent\n                );\n            });\n        });\n    },\n    componentDidMount: function() {\n        // This can't be in componentWillMount because that's happening during\n        // the middle of our parent's render, so we can't call\n        // this.props.onChange during that, since it calls our parent's\n        // setState\n        this._sizeImages(this.props);\n\n        if (!this.props.apiOptions.useDraftEditor) {\n            $(ReactDOM.findDOMNode(this.refs.textarea))\n                .on(\"copy cut\", this._maybeCopyWidgets)\n                .on(\"paste\", this._maybePasteWidgets);\n        }\n    },\n\n    componentDidUpdate: function(prevProps) {\n        // TODO(alpert): Maybe fix React so this isn't necessary\n        var textarea = ReactDOM.findDOMNode(this.refs.textarea);\n        textarea.value = this.props.content;\n\n        // This can't be in componentWillReceiveProps because that's happening\n        // during the middle of our parent's render.\n        if (this.props.content !== prevProps.content) {\n            this._sizeImages(this.props);\n        }\n    },\n\n    handleDrop: function(e) {\n        if (this.props.apiOptions.useDraftEditor) {\n            return;\n        }\n        var content = this.props.content;\n        var dataTransfer = e.nativeEvent.dataTransfer;\n\n        // files will hold something if the drag was from the desktop or a file\n        // located on the user's computer.\n        var files = dataTransfer.files;\n\n        // ... but we only get a url if the drag originated in another window\n        if (files.length === 0) {\n            var imageUrl = dataTransfer.getData(\"URL\");\n\n            if (imageUrl) {\n                // TODO(joel) - relocate when the image upload dialog lands\n                var newContent = content + \"\\n\\n![](\" + imageUrl + \")\";\n                this.props.onChange({content: newContent});\n            }\n\n            return;\n        }\n\n        /* For each file we make sure it's an image, then create a sentinel -\n         * snowman + identifier to insert into the current text. The sentinel\n         * only lives there temporarily until we get a response back from the\n         * server that the image is now hosted on AWS, at which time we replace\n         * the temporary sentinel with the permanent url for the image.\n         *\n         * There is an abuse of tap in the middle of the pipeline to make sure\n         * everything is sequenced in the correct order. We want to modify the\n         * content (given any number of images) at the same time, i.e. only\n         * once, so we do that step with the tap. After the content has been\n         * changed we send off the request for each image.\n         *\n         * Note that the snowman doesn't do anything special in this case -\n         * it's effectively just part of a broken link. Perseus could be\n         * extended to recognize this sentinel and highlight it like for\n         * widgets.\n         */\n        _.chain(files)\n            .map(function(file) {\n                if (!file.type.match(\"image.*\")) {\n                    return null;\n                }\n\n                var sentinel = \"\\u2603 \" + _.uniqueId(\"image_\");\n                // TODO(joel) - figure out how to temporarily include the image\n                // before the server returns.\n                content += \"\\n\\n![](\" + sentinel + \")\";\n\n                return {file: file, sentinel: sentinel};\n            })\n            .reject(_.isNull)\n            .tap(() => {\n                this.props.onChange({content: content});\n            })\n            .each(fileAndSentinel => {\n                this.props.imageUploader(fileAndSentinel.file, url => {\n                    this.props.onChange({\n                        content: this.props.content.replace(\n                            fileAndSentinel.sentinel,\n                            url\n                        ),\n                    });\n                });\n            });\n    },\n\n    handleChange: function() {\n        var textarea = ReactDOM.findDOMNode(this.refs.textarea);\n        this.props.onChange({content: textarea.value});\n    },\n\n    _handleKeyDown: function(e) {\n        // Tab-completion of widgets. For example, to insert an image:\n        // type `[[im`, then tab.\n        if (e.key === \"Tab\") {\n            var textarea = ReactDOM.findDOMNode(this.refs.textarea);\n\n            var word = Util.textarea.getWordBeforeCursor(textarea);\n            var matches = word.string.toLowerCase().match(shortcutRegexp);\n\n            if (matches != null) {\n                var text = matches[1];\n                var widgets = Widgets.getAllWidgetTypes();\n                var matchingWidgets = _.filter(widgets, name => {\n                    return name.substring(0, text.length) === text;\n                });\n\n                if (matchingWidgets.length === 1) {\n                    var widgetType = matchingWidgets[0];\n\n                    this._addWidgetToContent(\n                        this.props.content,\n                        [word.pos.start, word.pos.end + 1],\n                        widgetType\n                    );\n                }\n\n                e.preventDefault();\n            }\n        }\n    },\n\n    _maybeCopyWidgets: function(e) {\n        // If there are widgets being cut/copied, put the widget JSON in\n        // localStorage.perseusLastCopiedWidgets to allow copy-pasting of\n        // widgets between Editors. Also store the text to be pasted in\n        // localStorage.perseusLastCopiedText since we want to know if the user\n        // is actually pasting something originally from Perseus later.\n        var textarea = e.target;\n        var selectedText = textarea.value.substring(\n            textarea.selectionStart,\n            textarea.selectionEnd\n        );\n\n        var widgetNames = _.map(selectedText.match(rWidgetSplit), syntax => {\n            return Util.rWidgetParts.exec(syntax)[1];\n        });\n\n        var widgetData = _.pick(this.serialize().widgets, widgetNames);\n\n        localStorage.perseusLastCopiedText = selectedText;\n        localStorage.perseusLastCopiedWidgets = JSON.stringify(widgetData);\n\n        console.log(`Widgets copied: ${localStorage.perseusLastCopiedWidgets}`);\n    },\n\n    _maybePasteWidgets: function(e) {\n        // Use the data from localStorage to paste any widgets we copied\n        // before. Avoid name conflicts by renumbering pasted widgets so that\n        // their numbers are always higher than the highest numbered widget of\n        // their type.\n        // TODO(sam): Fix widget numbering in the widget editor titles\n\n        var widgetJSON = localStorage.perseusLastCopiedWidgets;\n        var lastCopiedText = localStorage.perseusLastCopiedText;\n        var textToBePasted = e.originalEvent.clipboardData.getData(\"text\");\n\n        // Only intercept if we have widget data to paste and the user is\n        // pasting something originally from Perseus.\n        // TODO(sam/aria/alex): Make it so that you can paste arbitrary text\n        // (e.g. from a text editor) instead of exactly what was copied, and\n        // let the widgetJSON match up with it. This would let you copy text\n        // into a buffer, perform complex operations on it, then paste it back.\n        if (widgetJSON && lastCopiedText === textToBePasted) {\n            e.preventDefault();\n\n            var widgetData = JSON.parse(widgetJSON);\n            var safeWidgetMapping = this._safeWidgetNameMapping(widgetData);\n\n            // Use safe widget name map to construct the new widget data\n            // TODO(aria/alex): Don't use `rWidgetSplit` or other piecemeal\n            // regexes directly; abstract this out so that we don't have to\n            // worry about potential edge cases.\n            var safeWidgetData = {};\n            for (const [key, data] of Object.entries(widgetData)) {\n                safeWidgetData[safeWidgetMapping[key]] = data;\n            }\n            var newWidgets = _.extend(safeWidgetData, this.props.widgets);\n\n            // Use safe widget name map to construct new text\n            var safeText = lastCopiedText.replace(rWidgetSplit, syntax => {\n                var match = Util.rWidgetParts.exec(syntax);\n                var completeWidget = match[0];\n                var widget = match[1];\n                return completeWidget.replace(\n                    widget,\n                    safeWidgetMapping[widget]\n                );\n            });\n\n            // Add pasted text to previous content, replacing selected text to\n            // replicate normal paste behavior.\n            var textarea = e.target;\n            var selectionStart = textarea.selectionStart;\n            var newContent =\n                this.props.content.substr(0, selectionStart) +\n                safeText +\n                this.props.content.substr(textarea.selectionEnd);\n\n            this.props.onChange(\n                {content: newContent, widgets: newWidgets},\n                () => {\n                    var expectedCursorPosition =\n                        selectionStart + safeText.length;\n                    Util.textarea.moveCursor(textarea, expectedCursorPosition);\n                }\n            );\n        }\n    },\n\n    _safeWidgetNameMapping: function(widgetData) {\n        // Helper function for _maybePasteWidgets.\n        // For each widget about to be pasted, construct a mapping from\n        // old widget name to a new widget name that doesn't have conflicts\n        // with widgets already in the editor.\n        // eg. If there is an \"image 2\" already present in the editor and we're\n        // about to paste in two new images, return\n        // { \"image 1\": \"image 3\", \"image 2\": \"image 4\" }\n\n        // List of widgets about to be pasted as [[name, number], ...]\n        var widgets = _.keys(widgetData).map(name => name.split(\" \"));\n        var widgetTypes = _.uniq(widgets.map(widget => widget[0]));\n\n        // List of existing widgets as [[name, number], ...]\n        var existingWidgets = _.keys(this.props.widgets).map(name => name.split(\" \")\n        );\n\n        // Mapping of widget type to a safe (non-conflicting) number\n        // eg. { \"image\": 2, \"dropdown\": 1 }\n        var safeWidgetNums = {};\n        _.each(widgetTypes, type => {\n            safeWidgetNums[type] = _.chain(existingWidgets)\n                .filter(existingWidget => existingWidget[0] === type)\n                .map(existingWidget => +existingWidget[1] + 1)\n                .max()\n                .value();\n            // If there are no existing widgets _.max returns -Infinity\n            safeWidgetNums[type] = Math.max(safeWidgetNums[type], 1);\n        });\n\n        // Construct mapping, incrementing the vals in safeWidgetNums as we go\n        var safeWidgetMapping = {};\n        _.each(widgets, widget => {\n            var widgetName = widget.join(\" \");\n            var widgetType = widget[0];\n\n            safeWidgetMapping[widgetName] = `${widgetType} ${safeWidgetNums[\n                widgetType\n            ]}`;\n            safeWidgetNums[widgetType]++;\n        });\n\n        return safeWidgetMapping;\n    },\n\n    _addWidgetToContent: function(oldContent, cursorRange, widgetType) {\n        var textarea = ReactDOM.findDOMNode(this.refs.textarea);\n\n        // Note: we have to use _.map here instead of Array::map\n        // because the results of a .match might be null if no\n        // widgets were found.\n        var allWidgetIds = _.map(oldContent.match(rWidgetSplit), syntax => {\n            var match = Util.rWidgetParts.exec(syntax);\n            var type = match[2];\n            var num = +match[3];\n            return [type, num];\n        });\n\n        var widgetNum = _.reduce(\n            allWidgetIds,\n            (currentNum, otherId) => {\n                var [otherType, otherNum] = otherId;\n                if (otherType === widgetType) {\n                    return Math.max(otherNum + 1, currentNum);\n                } else {\n                    return currentNum;\n                }\n            },\n            1\n        );\n\n        var id = widgetType + \" \" + widgetNum;\n        var widgetContent = widgetPlaceholder.replace(\"{id}\", id);\n\n        // Add newlines before block-display widgets like graphs\n        var isBlock = Widgets.getDefaultAlignment(widgetType) === \"block\";\n\n        var prelude = oldContent.slice(0, cursorRange[0]);\n        var postlude = oldContent.slice(cursorRange[1]);\n\n        var newPrelude = isBlock\n            ? makeEndWithAParagraphIfNecessary(prelude)\n            : prelude;\n        var newPostlude = isBlock\n            ? makeStartWithAParagraphAlways(postlude)\n            : postlude;\n\n        var newContent = newPrelude + widgetContent + newPostlude;\n\n        var newWidgets = _.clone(this.props.widgets);\n        newWidgets[id] = {\n            options: Widgets.getEditor(widgetType).defaultProps,\n            type: widgetType,\n            // Track widget version on creation, so that a widget editor\n            // without a valid version prop can only possibly refer to a\n            // pre-versioning creation time.\n            version: Widgets.getVersion(widgetType),\n        };\n\n        this.props.onChange(\n            {\n                content: newContent,\n                widgets: newWidgets,\n            },\n            function() {\n                Util.textarea.moveCursor(\n                    textarea,\n                    // We want to put the cursor after the widget\n                    // and after any added newlines\n                    newContent.length - postlude.length\n                );\n            }\n        );\n    },\n\n    _addWidget: function(widgetType) {\n        var textarea = this.refs.textarea;\n\n        if (this.props.apiOptions.useDraftEditor) {\n            textarea.addWidget(widgetType);\n        } else {\n            this._addWidgetToContent(\n                this.props.content,\n                [textarea.selectionStart, textarea.selectionEnd],\n                widgetType\n            );\n            textarea.focus();\n        }\n    },\n\n    // NOTE: These templates are all duplicated verbatim in perseus-editor.jsx\n    //        so any changes should also be done there, until this code is all\n    //        deleted in favor of perseus-editor.jsx\n    addTemplate: function(e) {\n        var templateType = e.target.value;\n        if (templateType === \"\") {\n            return;\n        }\n        e.target.value = \"\";\n\n        if (this.props.apiOptions.useDraftEditor) {\n            this.refs.textarea.addTemplate(templateType);\n            return;\n        }\n\n        var oldContent = this.props.content;\n\n        // Force templates to have a blank line before them,\n        // as they are usually used as block elements\n        // (especially important for tables)\n        oldContent = oldContent.replace(/\\n*$/, \"\\n\\n\");\n\n        var template;\n        if (templateType === \"table\") {\n            template =\n                \"header 1 | header 2 | header 3\\n\" +\n                \"- | - | -\\n\" +\n                \"data 1 | data 2 | data 3\\n\" +\n                \"data 4 | data 5 | data 6\\n\" +\n                \"data 7 | data 8 | data 9\";\n        } else if (templateType === \"titledTable\") {\n            template =\n                \"|| **Table title** ||\\n\" +\n                \"header 1 | header 2 | header 3\\n\" +\n                \"- | - | -\\n\" +\n                \"data 1 | data 2 | data 3\\n\" +\n                \"data 4 | data 5 | data 6\\n\" +\n                \"data 7 | data 8 | data 9\";\n        } else if (templateType === \"alignment\") {\n            template =\n                \"$\\\\begin{align} x+5 &= 30 \\\\\\\\\\n\" +\n                \"x+5-5 &= 30-5 \\\\\\\\\\n\" +\n                \"x &= 25 \\\\end{align}$\";\n        } else if (templateType === \"piecewise\") {\n            template =\n                \"$f(x) = \\\\begin{cases}\\n\" +\n                \"7 & \\\\text{if }x=1 \\\\\\\\\\n\" +\n                \"f(x-1)+5 & \\\\text{if }x > 1\\n\" +\n                \"\\\\end{cases}$\";\n        } else if (templateType === \"allWidgets\") {\n            template = Widgets.getAllWidgetTypes()\n                .map(type => `[[${Util.snowman} ${type} 1]]`)\n                .join(\"\\n\\n\");\n        } else {\n            throw new Error(\"Invalid template type: \" + templateType);\n        }\n\n        var newContent = oldContent + template;\n\n        this.props.onChange({content: newContent}, this.focusAndMoveToEnd);\n    },\n\n    getSaveWarnings: function() {\n        var widgetIds = _.intersection(this.widgetIds, _.keys(this.refs));\n        var warnings = _.chain(widgetIds)\n            .map(id => {\n                var issuesFunc = this.refs[id].getSaveWarnings;\n                var issues = issuesFunc ? issuesFunc() : [];\n                return _.map(issues, issue => id + \": \" + issue);\n            })\n            .flatten(true)\n            .value();\n\n        return warnings;\n    },\n\n    focus: function() {\n        ReactDOM.findDOMNode(this.refs.textarea).focus();\n    },\n\n    focusAndMoveToEnd: function() {\n        this.focus();\n        var textarea = ReactDOM.findDOMNode(this.refs.textarea);\n        textarea.selectionStart = textarea.value.length;\n        textarea.selectionEnd = textarea.value.length;\n    },\n\n    render: function() {\n        var pieces;\n        var widgets;\n        var underlayPieces;\n        var widgetsDropDown;\n        var templatesDropDown;\n        var widgetsAndTemplates;\n        var wordCountDisplay;\n        var katexErrorList = [];\n\n        if (this.props.showWordCount) {\n            var numChars = PerseusMarkdown.characterCount(this.props.content);\n            var numWords = Math.floor(numChars / 6);\n            wordCountDisplay = (\n                <span\n                    className=\"perseus-editor-word-count\"\n                    title={\n                        \"~\" +\n                        commafyInteger(numWords) +\n                        \" words (\" +\n                        commafyInteger(numChars) +\n                        \" characters)\"\n                    }\n                >\n                    {commafyInteger(numWords)}\n                </span>\n            );\n        }\n\n        if (this.props.widgetEnabled) {\n            pieces = Util.split(this.props.content, rWidgetSplit);\n            widgets = {};\n            underlayPieces = [];\n\n            for (var i = 0; i < pieces.length; i++) {\n                if (i % 2 === 0) {\n                    // Normal text\n                    underlayPieces.push(pieces[i]);\n\n                    const ast = PerseusMarkdown.parse(pieces[i]);\n\n                    PerseusMarkdown.traverseContent(ast, node => {\n                        if (node.type === \"math\" || node.type === \"blockMath\") {\n                            const content = preprocessTex(node.content);\n                            try {\n                                katex.renderToString(content);\n                            } catch (e) {\n                                katexErrorList.push({\n                                    math: content,\n                                    message: e.message,\n                                });\n                            }\n                        }\n                    });\n                } else {\n                    // Widget reference\n                    var match = Util.rWidgetParts.exec(pieces[i]);\n                    var id = match[1];\n                    var type = match[2];\n\n                    var selected = false;\n                    // TODO(alpert):\n                    // var selected = focused && selStart === selEnd &&\n                    //         offset <= selStart &&\n                    //         selStart < offset + text.length;\n                    // if (selected) {\n                    //     selectedWidget = id;\n                    // }\n\n                    var duplicate = id in widgets;\n\n                    widgets[id] = this.getWidgetEditor(id, type);\n                    var classes =\n                        (duplicate || !widgets[id] ? \"error \" : \"\") +\n                        (selected ? \"selected \" : \"\");\n                    var key = duplicate ? i : id;\n                    underlayPieces.push(\n                        <b className={classes} key={key}>\n                            {pieces[i]}\n                        </b>\n                    );\n                }\n            }\n\n            // TODO(alpert): Move this to the content-change event handler\n            // _.each(_.keys(this.props.widgets), function(id) {\n            //     if (!(id in widgets)) {\n            //         // It's strange if these preloaded options stick around\n            //         // since it's inconsistent with how things work if you\n            //         // don't have the serialize/deserialize step in the\n            //         // middle\n            //         // TODO(alpert): Save options in a consistent manner so\n            //         // that you can undo the deletion of a widget\n            //         delete this.props.widgets[id];\n            //     }\n            // }, this);\n\n            this.widgetIds = _.keys(widgets);\n            widgetsDropDown = (\n                <WidgetSelect ref=\"widgetSelect\" onChange={this._addWidget} />\n            );\n\n            var insertTemplateString = \"Insert template\\u2026\";\n            templatesDropDown = (\n                <select onChange={this.addTemplate}>\n                    <option value=\"\">\n                        {insertTemplateString}\n                    </option>\n                    <option disabled>--</option>\n                    <option value=\"table\">Table</option>\n                    <option value=\"titledTable\">Titled table</option>\n                    <option value=\"alignment\">Aligned equations</option>\n                    <option value=\"piecewise\">Piecewise function</option>\n                    <option disabled>--</option>\n                    <option value=\"allWidgets\">\n                        All widgets (for testing)\n                    </option>\n                </select>\n            );\n\n            if (!this.props.immutableWidgets) {\n                widgetsAndTemplates = (\n                    <div className=\"perseus-editor-widgets\">\n                        <div className=\"perseus-editor-widgets-selectors\">\n                            {widgetsDropDown}\n                            {templatesDropDown}\n                            {wordCountDisplay}\n                        </div>\n                        {ReactCreateFragment(widgets)}\n                    </div>\n                );\n                // Prevent word count from being displayed elsewhere\n                wordCountDisplay = null;\n            }\n        } else {\n            underlayPieces = [this.props.content];\n        }\n\n        // Without this, the underlay isn't the proper size when the text ends\n        // with a newline.\n        underlayPieces.push(<br key=\"end\" />);\n\n        var completeTextarea = [\n            <div\n                className=\"perseus-textarea-underlay\"\n                ref=\"underlay\"\n                key=\"underlay\"\n            >\n                {underlayPieces}\n            </div>,\n            <textarea\n                ref=\"textarea\"\n                key=\"textarea\"\n                onChange={this.handleChange}\n                onKeyDown={this._handleKeyDown}\n                placeholder={this.props.placeholder}\n                disabled={this.props.disabled}\n                value={this.props.content}\n            />,\n        ];\n\n        if (this.props.apiOptions.useDraftEditor) {\n            completeTextarea = (\n                <PerseusEditor\n                    ref=\"textarea\"\n                    onChange={this.props.onChange}\n                    content={this.props.content}\n                    placeholder={this.props.placeholder}\n                    initialWidgets={this.props.widgets}\n                    imageUploader={this.props.imageUploader}\n                    widgetEnabled={this.props.widgetEnabled}\n                />\n            );\n        }\n        var textareaWrapper;\n        if (this.props.imageUploader) {\n            textareaWrapper = (\n                <DragTarget\n                    onDrop={this.handleDrop}\n                    className=\"perseus-textarea-pair\"\n                >\n                    {completeTextarea}\n                </DragTarget>\n            );\n        } else {\n            textareaWrapper = (\n                <div className=\"perseus-textarea-pair\">\n                    {completeTextarea}\n                </div>\n            );\n        }\n\n        var contentWithoutWidgets = this.props.content.replace(\n            /\\[\\[\\u2603 (([a-z-]+) ([0-9]+))\\]\\]/g,\n            \"\"\n        );\n        var noPrompt = contentWithoutWidgets.trim().length === 0;\n        var noWidgets = !/\\[\\[\\u2603 (([a-z-]+) ([0-9]+))\\]\\]/g.test(\n            this.props.content\n        );\n\n        var warningStyle = {\n            borderTop: \"none\",\n            padding: 4,\n            backgroundColor: \"pink\",\n        };\n\n        return (\n            <div\n                className={\n                    \"perseus-single-editor \" + (this.props.className || \"\")\n                }\n            >\n                {textareaWrapper}\n                {katexErrorList.length > 0 &&\n                    <KatexErrorView errorList={katexErrorList} />}\n                {this.props.warnNoPrompt &&\n                    noPrompt &&\n                    <div style={warningStyle}>\n                        Graded Groups should contain a prompt\n                    </div>}\n                {this.props.warnNoWidgets &&\n                    noWidgets &&\n                    <div style={warningStyle}>\n                        Graded Groups should contain at least one widget\n                    </div>}\n                {wordCountDisplay}\n                {widgetsAndTemplates}\n            </div>\n        );\n    },\n\n    serialize: function(options) {\n        // need to serialize the widgets since the state might not be\n        // completely represented in props. ahem //transformer// (and\n        // interactive-graph and plotter).\n        var widgets = {};\n        var widgetIds = _.intersection(this.widgetIds, _.keys(this.refs));\n        _.each(widgetIds, id => {\n            widgets[id] = this.refs[id].serialize();\n        });\n\n        // Preserve the data associated with deleted widgets in their last\n        // modified form. This is only intended to be useful in the context of\n        // immediate cut and paste operations if Editor.serialize() is called\n        // in between the two (which ideally should not be happening).\n        // TODO(alex): Remove this once all widget.serialize() methods\n        //             have been fixed to only return props,\n        //             and the above no longer applies.\n        if (options && options.keepDeletedWidgets) {\n            _.chain(this.props.widgets)\n                .keys()\n                .reject(id => _.contains(widgetIds, id))\n                .each(id => {\n                    widgets[id] = this.props.widgets[id];\n                });\n        }\n\n        return {\n            replace: this.props.replace,\n            content: this.props.content,\n            images: this.props.images,\n            widgets: widgets,\n        };\n    },\n});\n\n_module_.exports = Editor;\nexport default _module_.exports;\n","import _tableJsx from \"./table.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst Util = _utilJs;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst Editor = _editorJsx;\n\nconst Table = _tableJsx.widget;\n\nconst TableEditor = createReactClass({\n    propTypes: {\n        rows: PropTypes.number,\n        columns: PropTypes.number,\n        headers: PropTypes.arrayOf(PropTypes.string),\n        answers: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.string)\n        ),\n    },\n\n    getDefaultProps: function() {\n        var defaultRows = 4;\n        var defaultColumns = 1;\n        var blankAnswers = _.times(defaultRows, function() {\n            return Util.stringArrayOfSize(defaultColumns);\n        });\n        return {\n            headers: [\"\"],\n            rows: defaultRows,\n            columns: defaultColumns,\n            answers: blankAnswers,\n        };\n    },\n\n    focus: function() {\n        ReactDOM.findDOMNode(this.refs.numberOfColumns).focus();\n    },\n\n    render: function() {\n        var tableProps = _.pick(\n            this.props,\n            \"headers\",\n            \"answers\",\n            \"onChange\",\n            \"apiOptions\"\n        );\n        _.extend(tableProps, {\n            editableHeaders: true,\n            Editor,\n            onFocus: () => {},\n            onBlur: () => {},\n            trackInteraction: () => {},\n        });\n\n        return (\n            <div>\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Number of columns:{\" \"}\n                        <NumberInput\n                            ref=\"numberOfColumns\"\n                            value={this.props.columns}\n                            onChange={val => {\n                                if (val) {\n                                    this.onSizeInput(this.props.rows, val);\n                                }\n                            }}\n                            useArrowKeys={true}\n                        />\n                    </label>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Number of rows:{\" \"}\n                        <NumberInput\n                            ref=\"numberOfRows\"\n                            value={this.props.rows}\n                            onChange={val => {\n                                if (val) {\n                                    this.onSizeInput(val, this.props.columns);\n                                }\n                            }}\n                            useArrowKeys={true}\n                        />\n                    </label>\n                </div>\n                <div>\n                    {\" \"}Table of answers:{\" \"}\n                    <InfoTip>\n                        <p>\n                            The student has to fill out all cells in the table.\n                            For partially filled tables create a table using the\n                            template, and insert text input boxes as desired.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    <Table {...tableProps} />\n                </div>\n            </div>\n        );\n    },\n\n    onSizeInput: function(numRawRows, numRawColumns) {\n        var rows = +numRawRows || 0;\n        var columns = +numRawColumns || 0;\n        rows = Math.min(Math.max(1, rows), 30);\n        columns = Math.min(Math.max(1, columns), 6);\n        var oldColumns = this.props.columns;\n        var oldRows = this.props.rows;\n\n        var answers = this.props.answers;\n        // Truncate if necessary; else, append\n        if (rows <= oldRows) {\n            answers.length = rows;\n        } else {\n            _.times(rows - oldRows, function() {\n                answers.push(Util.stringArrayOfSize(oldColumns));\n            });\n        }\n\n        function fixColumnSizing(array) {\n            // Truncate if necessary; else, append\n            if (columns <= oldColumns) {\n                array.length = columns;\n            } else {\n                _.times(columns - oldColumns, function() {\n                    array.push(\"\");\n                });\n            }\n        }\n\n        var headers = this.props.headers;\n        fixColumnSizing(headers);\n        _.each(answers, fixColumnSizing);\n\n        this.props.onChange({\n            rows: rows,\n            columns: columns,\n            answers: answers,\n            headers: headers,\n        });\n    },\n\n    serialize: function() {\n        var json = _.pick(this.props, \"headers\", \"rows\", \"columns\");\n\n        return _.extend({}, json, {\n            answers: _.map(this.props.answers, _.clone),\n        });\n    },\n});\n\n_module_.exports = TableEditor;\nexport default _module_.exports;\n","import _componentsTextListEditorJsx from \"../components/text-list-editor.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst TextListEditor = _componentsTextListEditorJsx;\n\nconst HORIZONTAL = \"horizontal\";\nconst VERTICAL = \"vertical\";\n\nconst SorterEditor = createReactClass({\n    propTypes: {\n        correct: PropTypes.array,\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        padding: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correct: [\"$x$\", \"$y$\", \"$z$\"],\n            layout: HORIZONTAL,\n            padding: true,\n        };\n    },\n\n    render: function() {\n        var editor = this;\n\n        return (\n            <div>\n                <div>\n                    {\" \"}Correct answer:{\" \"}\n                    <InfoTip>\n                        <p>\n                            Enter the correct answer (in the correct order)\n                            here. The preview on the right will have the cards\n                            in a randomized order, which is how the student will\n                            see them.\n                        </p>\n                    </InfoTip>\n                </div>\n                <TextListEditor\n                    options={this.props.correct}\n                    onChange={function(options, cb) {\n                        editor.props.onChange({correct: options}, cb);\n                    }}\n                    layout={this.props.layout}\n                />\n                <div>\n                    <label>\n                        {\" \"}Layout:{\" \"}\n                        <select\n                            value={this.props.layout}\n                            onChange={this.onLayoutChange}\n                        >\n                            <option value={HORIZONTAL}>Horizontal</option>\n                            <option value={VERTICAL}>Vertical</option>\n                        </select>\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Use the horizontal layout for short text and small\n                            images. The vertical layout is best for longer text\n                            and larger images.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    <PropCheckBox\n                        label=\"Padding:\"\n                        padding={this.props.padding}\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            Padding is good for text, but not needed for images.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n\n    onLayoutChange: function(e) {\n        this.props.onChange({layout: e.target.value});\n    },\n\n    serialize: function() {\n        return _.pick(this.props, \"correct\", \"layout\", \"padding\");\n    },\n});\n\n_module_.exports = SorterEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"../gorgon/gorgon.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types, react/prop-types, react/sort-comp */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst Util = _utilJs;\nconst Renderer = _rendererJsx;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\n\nconst Gorgon = _gorgonGorgonJs;\n\nconst HORIZONTAL = \"horizontal\";\nconst VERTICAL = \"vertical\";\n\nconst STATIC = \"static\";\nconst DRAGGING = \"dragging\";\nconst ANIMATING = \"animating\";\nconst DISABLED = \"disabled\";\n\n// A placeholder that appears in the sortable whenever an item is dragged.\nconst Placeholder = createReactClass({\n    propTypes: {\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        width: PropTypes.number.isRequired,\n        height: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        const {layout} = this.props;\n        const className = css(\n            styles.card,\n            styles.placeholder,\n            layout === HORIZONTAL && styles.horizontalCard\n        );\n        const style = {width: this.props.width, height: this.props.height};\n\n        if (this.props.margin != null) {\n            style.margin = this.props.margin;\n        }\n\n        return <li className={className} style={style} />;\n    },\n});\n\n// A draggable item in the sortable. Can be in one of four states:\n//     Static:    The item is not being interacted with.\n//     Dragging:  The item is being dragged.\n//     Animating: The item has been released, and is moving to its destination.\n//     Disabled:  The item cannot be interacted with.\n//\n// Usual flow:      Static -> Dragging -> Animating -> Static\n// [Dis|en]abling:  Static|Dragging|Animating -> Disabled -> Static\nconst Draggable = createReactClass({\n    propTypes: {\n        content: PropTypes.string.isRequired,\n        endPosition: PropTypes.object.isRequired,\n        includePadding: PropTypes.bool,\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        onAnimationEnd: PropTypes.func.isRequired,\n        onMouseDown: PropTypes.func.isRequired,\n        onMouseMove: PropTypes.func.isRequired,\n        onMouseUp: PropTypes.func.isRequired,\n        onRender: PropTypes.func.isRequired,\n        type: PropTypes.oneOf([STATIC, DRAGGING, ANIMATING, DISABLED]),\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            includePadding: true,\n            type: STATIC,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            startPosition: {left: 0, top: 0},\n            startMouse: {left: 0, top: 0},\n            mouse: {left: 0, top: 0},\n        };\n    },\n\n    componentDidMount: function() {\n        this.isMouseMoveUpBound = false;\n    },\n\n    componentWillUnmount: function() {\n        // Event handlers should be unbound before component unmounting, but\n        // just in case...\n        if (this.isMouseMoveUpBound) {\n            this.unbindMouseMoveUp();\n        }\n    },\n\n    getCurrentPosition: function() {\n        return {\n            left:\n                this.state.startPosition.left +\n                this.state.mouse.left -\n                this.state.startMouse.left,\n            top:\n                this.state.startPosition.top +\n                this.state.mouse.top -\n                this.state.startMouse.top,\n        };\n    },\n\n    render: function() {\n        const {includePadding, layout, type} = this.props;\n\n        // We need to keep backwards compatbility with rules specified directly\n        // in CSS. Hence the hacky tacking on of manual classNames.\n        // See sortable.less for details.\n        let className =\n            css(\n                styles.card,\n                styles.draggable,\n                layout === HORIZONTAL && styles.horizontalCard,\n                layout === VERTICAL && styles.verticalCard,\n                type === DRAGGING && styles.dragging,\n                type === ANIMATING && styles.animating,\n                type === DISABLED && styles.disabled,\n                !includePadding && styles.unpaddedCard\n            ) +\n            \" \" +\n            ApiClassNames.INTERACTIVE +\n            \" perseus-sortable-draggable\";\n\n        if (!includePadding) {\n            className += \" perseus-sortable-draggable-unpadded\";\n        }\n\n        const style = {\n            position: \"static\",\n        };\n\n        if (this.props.type === DRAGGING || this.props.type === ANIMATING) {\n            _.extend(style, {position: \"absolute\"}, this.getCurrentPosition());\n        }\n\n        if (this.props.width) {\n            style.width = this.props.width + 1; // Fix for non-integer widths\n        }\n        if (this.props.height) {\n            style.height = this.props.height;\n        }\n        if (this.props.margin != null) {\n            style.margin = this.props.margin;\n        }\n        return (\n            <li\n                className={className}\n                style={style}\n                onMouseDown={this.onMouseDown}\n                onTouchStart={this.onMouseDown}\n                onTouchMove={this.onMouseMove}\n                onTouchEnd={this.onMouseUp}\n                onTouchCancel={this.onMouseUp}\n            >\n                <Renderer\n                    content={this.props.content}\n                    linterContext={\n                        Gorgon.pushContextStack(\n                            this.props.linterContext, 'draggable'\n                        )\n                    }\n                    onRender={this.props.onRender}\n                />\n            </li>\n        );\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (this.props.type === prevProps.type) {\n            return;\n        }\n\n        if (this.props.type === ANIMATING) {\n            // Start animating\n            const current = this.getCurrentPosition();\n            const duration =\n                15 *\n                Math.sqrt(\n                    Math.sqrt(\n                        Math.pow(\n                            this.props.endPosition.left - current.left,\n                            2\n                        ) +\n                            Math.pow(\n                                this.props.endPosition.top - current.top,\n                                2\n                            )\n                    )\n                );\n\n            $(ReactDOM.findDOMNode(this)).animate(this.props.endPosition, {\n                duration: Math.max(duration, 1),\n                // Animating -> Static\n                complete: this.props.onAnimationEnd,\n            });\n        } else if (this.props.type === STATIC) {\n            // Ensure that any animations are done\n            $(ReactDOM.findDOMNode(this)).finish();\n        }\n    },\n\n    bindMouseMoveUp: function() {\n        this.isMouseMoveUpBound = true;\n        $(document).on(\"mousemove\", this.onMouseMove);\n        $(document).on(\"mouseup\", this.onMouseUp);\n    },\n\n    unbindMouseMoveUp: function() {\n        this.isMouseMoveUpBound = false;\n        $(document).off(\"mousemove\", this.onMouseMove);\n        $(document).off(\"mouseup\", this.onMouseUp);\n    },\n\n    onMouseDown: function(event) {\n        if (this.props.type !== STATIC) {\n            return;\n        }\n\n        if (\n            !(\n                event.button === 0 ||\n                (event.touches != null && event.touches.length === 1)\n            )\n        ) {\n            return;\n        }\n\n        event.preventDefault();\n        const loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.setState(\n                {\n                    startPosition: $(ReactDOM.findDOMNode(this)).position(),\n                    startMouse: loc,\n                    mouse: loc,\n                },\n                function() {\n                    this.bindMouseMoveUp();\n\n                    // Static -> Dragging\n                    this.props.onMouseDown();\n                }\n            );\n        }\n    },\n\n    onMouseMove: function(event) {\n        if (this.props.type !== DRAGGING) {\n            return;\n        }\n\n        event.preventDefault();\n        const loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.setState(\n                {\n                    mouse: loc,\n                },\n                this.props.onMouseMove\n            );\n        }\n    },\n\n    onMouseUp: function(event) {\n        if (this.props.type !== DRAGGING) {\n            return;\n        }\n\n        event.preventDefault();\n        const loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.unbindMouseMoveUp();\n\n            // Dragging -> Animating\n            this.props.onMouseUp();\n        }\n    },\n});\n\n// The main sortable component.\nconst Sortable = createReactClass({\n    propTypes: {\n        constraints: PropTypes.object,\n        disabled: PropTypes.bool,\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        margin: PropTypes.number,\n        onChange: PropTypes.func,\n        onMeasure: PropTypes.func,\n        options: PropTypes.array.isRequired,\n        padding: PropTypes.bool,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            layout: HORIZONTAL,\n            padding: true,\n            disabled: false,\n            constraints: {},\n            onMeasure: function() {},\n            margin: 5,\n            onChange: function() {},\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            items: this.itemsFromProps(this.props),\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        const prevProps = this.props;\n\n        if (!_.isEqual(nextProps.options, prevProps.options)) {\n            // Regenerate items\n            this.setState({\n                items: this.itemsFromProps(nextProps),\n            });\n        } else if (\n            nextProps.layout !== prevProps.layout ||\n            nextProps.padding !== prevProps.padding ||\n            nextProps.disabled !== prevProps.disabled ||\n            !_.isEqual(nextProps.constraints, prevProps.constraints)\n        ) {\n            // Clear item measurements\n            this.setState({\n                items: this.clearItemMeasurements(this.state.items),\n            });\n        }\n    },\n\n    componentDidUpdate: function(prevProps) {\n        // Measure items if their dimensions have been reset\n        if (this.state.items.length && !this.state.items[0].width) {\n            this.measureItems();\n        }\n    },\n\n    itemsFromProps: function(props) {\n        const type = props.disabled ? DISABLED : STATIC;\n        return _.map(props.options, function(option, i) {\n            return {\n                option: option,\n                key: i,\n                type: type,\n                endPosition: {},\n                width: 0,\n                height: 0,\n            };\n        });\n    },\n\n    clearItemMeasurements: function(items) {\n        return _.map(items, function(item) {\n            return _.extend(item, {\n                width: 0,\n                height: 0,\n            });\n        });\n    },\n\n    measureItems: function() {\n        // Measure all items and cache what their dimensions should be, taking\n        // into account constraints and the current layout. This allows syncing\n        // widths and heights for pretty rows/columns. Note that dimensions are\n        // explictly set on Draggables - this prevents them from changing size\n        // or shape while being dragged.\n\n        let items = _.clone(this.state.items);\n        const $items = _.map(\n            items,\n            function(item) {\n                return $(ReactDOM.findDOMNode(this.refs[item.key]));\n            },\n            this\n        );\n\n        const widths = _.invoke($items, \"outerWidth\");\n        const heights = _.invoke($items, \"outerHeight\");\n\n        const constraints = this.props.constraints;\n        const layout = this.props.layout;\n\n        let syncWidth;\n        if (constraints.width) {\n            // Items must be at least as wide as the specified constraint\n            syncWidth = _.max(widths.concat(constraints.width));\n        } else if (layout === VERTICAL) {\n            // Sync widths to get a clean column\n            syncWidth = _.max(widths);\n        }\n\n        let syncHeight;\n        if (constraints.height) {\n            // Items must be at least as high as the specified constraint\n            syncHeight = _.max(heights.concat(constraints.height));\n        } else if (layout === HORIZONTAL) {\n            // Sync widths to get a clean row\n            syncHeight = _.max(heights);\n        }\n\n        items = _.map(items, function(item, i) {\n            item.width = syncWidth || widths[i];\n            item.height = syncHeight || heights[i];\n            return item;\n        });\n\n        this.setState({items: items}, () => {\n            this.props.onMeasure({widths: widths, heights: heights});\n        });\n    },\n\n    remeasureItems: _.debounce(function() {\n        this.setState({\n            // Clear item measurements\n            items: this.clearItemMeasurements(this.state.items),\n        });\n    }, 20),\n\n    render: function() {\n        const cards = [];\n\n        const {layout} = this.props;\n        // We need to keep backwards compatbility with rules specified directly\n        // in CSS. See sortable.less for details.\n        const className = css(styles.sortable) + \" perseus-sortable\";\n\n        _.each(\n            this.state.items,\n            function(item, i, items) {\n                const isLast = i === items.length - 1;\n                const isStatic = item.type === STATIC || item.type === DISABLED;\n                let margin;\n\n                if (this.props.layout === HORIZONTAL) {\n                    margin = \"0 \" + this.props.margin + \"px 0 0\"; // right\n                } else if (this.props.layout === VERTICAL) {\n                    margin = \"0 0 \" + this.props.margin + \"px 0\"; // bottom\n                }\n\n                cards.push(\n                    <Draggable\n                        content={item.option}\n                        key={item.key}\n                        type={item.type}\n                        ref={item.key}\n                        width={item.width}\n                        height={item.height}\n                        layout={layout}\n                        includePadding={this.props.padding}\n                        margin={isLast && isStatic ? 0 : margin}\n                        endPosition={item.endPosition}\n                        linterContext={\n                            Gorgon.pushContextStack(\n                                this.props.linterContext, 'sortable'\n                            )\n                        }\n                        onRender={this.remeasureItems}\n                        onMouseDown={this.onMouseDown.bind(this, item.key)}\n                        onMouseMove={this.onMouseMove.bind(this, item.key)}\n                        onMouseUp={this.onMouseUp.bind(this, item.key)}\n                        onTouchMove={this.onMouseMove.bind(this, item.key)}\n                        onTouchEnd={this.onMouseUp.bind(this, item.key)}\n                        onTouchCancel={this.onMouseUp.bind(this, item.key)}\n                        onAnimationEnd={this.onAnimationEnd.bind(\n                            this,\n                            item.key\n                        )}\n                    />\n                );\n\n                if (item.type === DRAGGING || item.type === ANIMATING) {\n                    cards.push(\n                        <Placeholder\n                            key={\"placeholder_\" + item.key}\n                            ref={\"placeholder_\" + item.key}\n                            width={item.width}\n                            height={item.height}\n                            layout={layout}\n                            margin={isLast ? 0 : margin}\n                        />\n                    );\n                }\n            },\n            this\n        );\n\n        return (\n            <ul className={className}>\n                {cards}\n            </ul>\n        );\n    },\n\n    onMouseDown: function(key) {\n        // Static -> Dragging\n        const items = _.map(this.state.items, function(item) {\n            if (item.key === key) {\n                item.type = DRAGGING;\n            }\n            return item;\n        });\n\n        this.setState({items: items});\n    },\n\n    onMouseMove: function(key) {\n        // Dragging: Rearrange items based on draggable's position\n        const $draggable = $(ReactDOM.findDOMNode(this.refs[key]));\n        const $sortable = $(ReactDOM.findDOMNode(this));\n        const items = _.clone(this.state.items);\n        const item = _.findWhere(this.state.items, {key: key});\n        const margin = this.props.margin;\n        const currentIndex = _.indexOf(items, item);\n        let newIndex = 0;\n\n        items.splice(currentIndex, 1);\n\n        if (this.props.layout === HORIZONTAL) {\n            const midWidth = $draggable.offset().left - $sortable.offset().left;\n            let sumWidth = 0;\n            let cardWidth;\n\n            _.each(items, function(item) {\n                cardWidth = item.width;\n                if (midWidth > sumWidth + cardWidth / 2) {\n                    newIndex += 1;\n                }\n                sumWidth += cardWidth + margin;\n            });\n        } else {\n            const midHeight = $draggable.offset().top - $sortable.offset().top;\n            let sumHeight = 0;\n            let cardHeight;\n\n            _.each(items, function(item) {\n                cardHeight = item.height;\n                if (midHeight > sumHeight + cardHeight / 2) {\n                    newIndex += 1;\n                }\n                sumHeight += cardHeight + margin;\n            });\n        }\n\n        if (newIndex !== currentIndex) {\n            items.splice(newIndex, 0, item);\n            this.setState({items: items});\n        }\n    },\n\n    onMouseUp: function(key) {\n        // Dragging -> Animating\n        const items = _.map(\n            this.state.items,\n            function(item) {\n                if (item.key === key) {\n                    item.type = ANIMATING;\n                    item.endPosition = $(\n                        ReactDOM.findDOMNode(this.refs[\"placeholder_\" + key])\n                    ).position();\n                }\n                return item;\n            },\n            this\n        );\n\n        this.setState({items: items});\n        // HACK: We need to know *that* the widget changed, but currently it's\n        // not set up in a nice way to tell us *how* it changed, since the\n        // permutation of the items is stored in state.\n        this.props.onChange({});\n    },\n\n    onAnimationEnd: function(key) {\n        // Animating -> Static\n        const items = _.map(this.state.items, function(item) {\n            if (item.key === key) {\n                item.type = STATIC;\n            }\n            return item;\n        });\n\n        this.setState({items: items});\n    },\n\n    getOptions: function() {\n        return _.pluck(this.state.items, \"option\");\n    },\n});\n\nconst styles = StyleSheet.create({\n    sortable: {\n        boxSizing: \"border-box\",\n        float: \"left\",\n\n        padding: 0,\n        margin: 0,\n    },\n\n    card: {\n        boxSizing: \"border-box\",\n        background: \"#fff\",\n        border: \"1px solid #ddd\",\n        borderRadius: 4,\n        cursor: \"pointer\",\n        minWidth: 25,\n        minHeight: 44,\n        padding: 10,\n\n        listStyleType: \"none\",\n\n        userSelect: \"none\",\n        touchAction: \"none\",\n    },\n\n    placeholder: {\n        background: \"#ddd\",\n        border: \"1px solid #ccc\",\n    },\n\n    draggable: {\n        textAlign: \"center\",\n    },\n\n    horizontalCard: {\n        float: \"left\",\n        cursor: \"ew-resize\",\n    },\n\n    verticalCard: {\n        maxWidth: \"100%\",\n        cursor: \"ns-resize\",\n    },\n\n    unpaddedCard: {\n        padding: 0,\n    },\n\n    dragging: {\n        background: \"#ffedcd\",\n        opacity: \"0.8\",\n    },\n\n    disabled: {\n        backgroundColor: \"inherit\",\n        border: \"1px solid transparent\",\n        cursor: \"default\",\n    },\n});\n\n_module_.exports = Sortable;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _utilJs from \"../util.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsSortableJsx from \"../components/sortable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, one-var, react/forbid-prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Sortable = _componentsSortableJsx;\n\nconst ApiOptions = _perseusApiJsx.Options;\nvar shuffle = _utilJs.shuffle;\n\nvar HORIZONTAL = \"horizontal\",\n    VERTICAL = \"vertical\";\n\nvar Sorter = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        correct: PropTypes.array,\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        onChange: PropTypes.func,\n        padding: PropTypes.bool,\n        problemNum: PropTypes.number,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correct: [],\n            layout: HORIZONTAL,\n            padding: true,\n            problemNum: 0,\n            onChange: function() {},\n            linterContext: linterContextDefault,\n        };\n    },\n\n    render: function() {\n        var options = shuffle(\n            this.props.correct,\n            this.props.problemNum,\n            /* ensurePermuted */ true\n        );\n\n        const marginPx = this.props.apiOptions.isMobile ? 8 : 5;\n\n        return (\n            <div className=\"perseus-widget-sorter perseus-clearfix\">\n                <Sortable\n                    options={options}\n                    layout={this.props.layout}\n                    margin={marginPx}\n                    padding={this.props.padding}\n                    onChange={this.handleChange}\n                    linterContext={this.props.linterContext}\n                    ref=\"sortable\"\n                />\n            </div>\n        );\n    },\n\n    handleChange: function(e) {\n        this.props.onChange(e);\n        this.props.trackInteraction();\n    },\n\n    getUserInput: function() {\n        return {options: this.refs.sortable.getOptions()};\n    },\n\n    simpleValidate: function(rubric) {\n        return Sorter.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Sorter, {\n    validate: function(state, rubric) {\n        var correct = _.isEqual(state.options, rubric.correct);\n\n        return {\n            type: \"points\",\n            earned: correct ? 1 : 0,\n            total: 1,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"sorter\",\n    displayName: \"Sorter\",\n    widget: Sorter,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals i18n */\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst NumberInput = _componentsNumberInputJsx;\n\nconst maxTrials = 5000;\n\nconst SimulatorEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        xAxisLabel: PropTypes.string,\n        yAxisLabel: PropTypes.string,\n        numTrials: PropTypes.number,\n        proportionLabel: PropTypes.string,\n        proportionOrPercentage: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            xAxisLabel: \"Proportion (%)\",\n            yAxisLabel: \"Number of times seen\",\n            numTrials: 100,\n            proportionLabel: \"Underlying proportion\",\n            proportionOrPercentage: \"proportion\",\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-widget-simulator\">\n                <div>\n                    {i18n._(\"X-Axis Label\")}:\n                    <input\n                        type=\"text\"\n                        className=\"graph-settings-axis-label\"\n                        value={this.props.xAxisLabel}\n                        onChange={_.partial(\n                            this.handleTargetValueChange,\n                            \"xAxisLabel\"\n                        )}\n                    />\n                </div>\n                <div>\n                    {i18n._(\"Y-Axis Label\")}:\n                    <input\n                        type=\"text\"\n                        className=\"graph-settings-axis-label\"\n                        value={this.props.yAxisLabel}\n                        onChange={_.partial(\n                            this.handleTargetValueChange,\n                            \"yAxisLabel\"\n                        )}\n                    />\n                </div>\n                <div>\n                    {i18n._('\"True Proportion\" Label')}:\n                    <input\n                        type=\"text\"\n                        className=\"graph-settings-axis-label\"\n                        value={this.props.proportionLabel}\n                        onChange={_.partial(\n                            this.handleTargetValueChange,\n                            \"proportionLabel\"\n                        )}\n                    />\n                    <InfoTip>\n                        <p>\n                            This text will be displayed next to the box in which\n                            the user enters the sample proportion for their\n                            simulation. For example, if your question is about\n                            surveying for approval ratings, you might want this\n                            to say \"Sample approval rating\".\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    {i18n._(\"Proportion or Percentage\")}:\n                    <select\n                        className=\"perseus-widget-dropdown\"\n                        value={this.props.proportionOrPercentage}\n                        onChange={_.partial(\n                            this.handleTargetValueChange,\n                            \"proportionOrPercentage\"\n                        )}\n                    >\n                        <option key=\"proportion\" value=\"proportion\">\n                            Proportion\n                        </option>\n                        <option key=\"percentage\" value=\"percentage\">\n                            Percentage\n                        </option>\n                    </select>\n                    <InfoTip>\n                        <p>\n                            Do you want the user to describe their simulation in\n                            terms of a proportion or a percentage?\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    {i18n._(\"Number of trials\")}:\n                    <NumberInput\n                        value={this.props.numTrials}\n                        checkValidity={val => {\n                            return val >= 0 && val <= maxTrials;\n                        }}\n                        onChange={this.change(\"numTrials\")}\n                    />\n                    <InfoTip>\n                        <p>\n                            This controls the number of trials used in the\n                            simulation. For example, if you set this to 50, then\n                            the survey will be conducted 50 times. Warning:\n                            setting this too high (i.e., greater than 5000 or\n                            so) will freeze the page.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handleTargetValueChange: function(propName, e) {\n        this.change(propName, e.target.value);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = SimulatorEditor;\nexport default _module_.exports;\n","import _utilMathJs from \"../util/math.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _kmath from \"kmath\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, no-unused-vars, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp, space-unary-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals $_, i18n */\nvar InfoTip = _componentsInfoTipJsx;\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar assert = _interactive2InteractiveUtilJs.assert;\n\nvar Graphie = _componentsGraphieJsx;\nvar {Path, Arc, Circle, Label, Line, MovablePoint, MovableLine} = Graphie;\nvar NumberInput = _componentsNumberInputJsx;\nvar MathOutput = _componentsMathOutputJsx;\nvar seededRNG = _utilJs.seededRNG;\nvar Util = _utilJs2;\nvar knumber = _kmath.number;\nconst KhanColors = _utilColorsJs;\nconst KhanMath = _utilMathJs;\n\nvar defaultBoxSize = 400;\nvar maxSampleSize = 1000;\nvar maxTrials = 5000;\n\nvar Histogram = createReactClass({\n    propTypes: {\n        data: PropTypes.arrayOf(PropTypes.number),\n        xAxisLabel: PropTypes.string,\n        yAxisLabel: PropTypes.string,\n        box: PropTypes.arrayOf(PropTypes.number),\n    },\n\n    getDefaultProps: function() {\n        return {\n            data: null,\n            xAxisLabel: \"Proportion (%)\",\n            yAxisLabel: \"Number of times seen\",\n            box: [defaultBoxSize, defaultBoxSize],\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            threshold: this._getInitialThreshold(this._range()),\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        // Reset the threshold if the range has changed\n        var oldRange = this._range();\n        var nextRange = this._range(nextProps);\n        if (!Util.deepEq(oldRange, nextRange)) {\n            this.setState({\n                threshold: this._getInitialThreshold(nextRange),\n            });\n        }\n    },\n\n    /* Renders the vertical line that users can drag across the histogram. */\n    _renderThresholdLine: function() {\n        // Recall the the y-range goes from [-1, yMax] to allow for ticks on\n        // the x-axis.\n        var yRange = [0, this._range()[1][1]];\n        var coords = _.map(yRange, y => [this.state.threshold, y]);\n\n        // Returns an inivisble, placeholder coord that anchors the line\n        var invisiblePointForCoord = (coord, i) => {\n            return (\n                <MovablePoint\n                    key={i}\n                    static={true}\n                    coord={coord}\n                    normalStyle={{stroke: \"none\", fill: \"none\"}}\n                />\n            );\n        };\n\n        return (\n            <MovableLine onMove={this.handleMouseInteraction}>\n                {_.map(coords, invisiblePointForCoord)}\n            </MovableLine>\n        );\n    },\n\n    /* Renders the shaded circle in the top right. */\n    _renderCircle: function() {\n        var data = this.props.data;\n\n        // Get proportion of results below threshold\n        var total = _.reduce(\n            data,\n            (sum, next) => {\n                return sum + next;\n            },\n            0\n        );\n        var numBelow = _.reduce(\n            data,\n            (sum, next, i) => {\n                if (this.state.threshold != null && i <= this.state.threshold) {\n                    return sum + next;\n                } else {\n                    return sum;\n                }\n            },\n            0\n        );\n        var proportionBelow = numBelow / total;\n\n        // This is a hack around the arc taking angles modulo 360.\n        // TODO(charlie): Find a better way around this.\n        var epsilon = 1e-5;\n        var radius = 20;\n        var center = [this.props.box[0] - 1.5 * radius, 1.5 * radius];\n\n        // Plot little circle\n        var plotBelowCircle = () => {\n            var options = {\n                key: \"below\",\n                center: center,\n                radius: radius,\n                startAngle: 0,\n                endAngle:\n                    proportionBelow < 1 ? 360 * proportionBelow : 360 - epsilon,\n                sector: proportionBelow !== 1,\n                unscaled: true,\n                style: {\n                    fill: KhanColors.LIGHT_RED,\n                    stroke: KhanColors.RED,\n                },\n            };\n\n            return <Arc {...options} />;\n        };\n        var plotAboveCircle = () => {\n            var options = {\n                key: \"above\",\n                center: center,\n                radius: radius,\n                startAngle:\n                    proportionBelow > 0 ? 360 * proportionBelow : epsilon,\n                endAngle: 360,\n                sector: proportionBelow !== 0,\n                unscaled: true,\n                style: {\n                    fill: KhanColors.LIGHT_BLUE,\n                    stroke: KhanColors.BLUE,\n                },\n            };\n\n            return <Arc {...options} />;\n        };\n\n        // Plot the label below the circle\n        var xRange = this._range()[0];\n        var formattedThreshold = Math.min(\n            Math.max(this.state.threshold, xRange[0]),\n            xRange[1]\n        ).toFixed(2);\n        var plotLabel = () => {\n            var options = {\n                key: \"label\",\n                coord: [center[0], center[1] + 1.5 * radius],\n                text:\n                    numBelow +\n                    \" of \" +\n                    total +\n                    \" results below \" +\n                    formattedThreshold +\n                    \"%\",\n                direction: \"center\",\n                tex: false,\n                unscaled: true,\n                style: {\n                    fontSize: \"12px\",\n                },\n            };\n            return <Label {...options} />;\n        };\n\n        return [\n            proportionBelow > 0 && plotBelowCircle(),\n            proportionBelow < 1 && plotAboveCircle(),\n            plotLabel(),\n        ];\n    },\n\n    /* Renders the actual bars of the histogram. */\n    _renderData: function() {\n        var data = this.props.data;\n        var range = this._range();\n\n        // Plot bars\n        var barWidth = 1;\n        var pathForData = (count, i) => {\n            // Avoid plotting bars of height 0, else you get a thick blue line\n            // over the x-axis. We don't filter these out of the data passed in\n            // to this function, however, to preserve absolute indices.\n            if (!count) {\n                return;\n            }\n\n            var isBelow =\n                this.state.threshold != null && i <= this.state.threshold;\n            var style = {\n                fill: isBelow ? KhanColors.LIGHT_RED : KhanColors.LIGHT_BLUE,\n                stroke: isBelow ? KhanColors.RED : KhanColors.BLUE,\n            };\n            var coords = [\n                [i, 0],\n                [i, count],\n                [i + barWidth, count],\n                [i + barWidth, 0],\n            ];\n            return <Path key={i} coords={coords} style={style} />;\n        };\n\n        return _.map(data, pathForData);\n    },\n\n    render: function() {\n        var data = this.props.data;\n        var range = this._range();\n\n        var options = {\n            xAxisLabel: this.props.xAxisLabel,\n            yAxisLabel: this.props.yAxisLabel,\n            box: this.props.box,\n            range: range,\n            data: data,\n            scale: [\n                Util.scaleFromExtent(range[0], this.props.box[0]),\n                Util.scaleFromExtent(range[1], this.props.box[1]),\n            ],\n        };\n\n        var axisStyle = {\n            stroke: \"#000\",\n            strokeWidth: 1,\n            opacity: 1.0,\n        };\n        var origin = [range[0][0], 0];\n        var bottomRight = [range[0][1], 0];\n\n        return (\n            <Graphie\n                box={options.box}\n                range={options.range}\n                options={options}\n                setup={this._setupGraphie}\n                onMouseMove={this.handleMouseInteraction}\n                onMouseDown={this.handleMouseInteraction}\n                setDrawingAreaAvailable={this.props.setDrawingAreaAvailable}\n            >\n                <Line start={origin} end={bottomRight} style={axisStyle} />\n                {/* Only plot these cool extra features if there's data */}\n                {data && this._renderData()}\n                {data && this._renderCircle()}\n                {data && this._renderThresholdLine()}\n            </Graphie>\n        );\n    },\n\n    _setupGraphie: function(graphie, options) {\n        var data = options.data;\n        var range = options.range;\n        var scale = options.scale;\n\n        /* Plot the bars that run parallel to the x-axis. */\n        var xWidth = range[0][1] - range[0][0];\n        var yWidth = range[1][1] - 0;\n\n        var maxYAxisEntities = 20;\n        var ySkip = Math.ceil(yWidth / maxYAxisEntities);\n        _.each(_.range(0, range[1][1], ySkip), y => {\n            // If there's no data, we don't label the axes\n            if (data) {\n                graphie.label(\n                    [range[0][0], y],\n                    KhanMath.roundToApprox(y, 2),\n                    \"left\",\n                    /* isTeX */ true /* for the \\approx symbol */\n                );\n            }\n\n            graphie.line([range[0][0], y], [range[0][1], y], {\n                stroke: \"#000\",\n                strokeWidth: 1,\n                opacity: 0.3,\n            });\n        });\n\n        // If there's no data, we don't label the x-axis at all\n        if (data) {\n            // Plot the labels below the bars\n            var maxXAxisEntities = 15;\n            var xSkip = Math.ceil(xWidth / maxXAxisEntities);\n            _.each(_.range(range[0][0], range[0][1], xSkip), x => {\n                graphie.label([x, 0], knumber.round(x, 2), \"below\", true);\n\n                var tickHeight = 8;\n                graphie.line([x, 0], [x, -tickHeight / scale[1]], {\n                    stroke: \"#000\",\n                    strokeWidth: 1,\n                });\n            });\n        }\n\n        // Add y axis (x axis is added later to overlap the bars)\n        var axisStyle = {\n            stroke: \"#000\",\n            strokeWidth: 2,\n            opacity: 1.0,\n        };\n        var origin = [range[0][0], 0];\n        var topLeft = [range[0][0], range[1][1]];\n        graphie.line(origin, topLeft, axisStyle);\n\n        // Add axis labels\n        var xMid = range[0][0] + xWidth / 2;\n        var xOffset = data ? 25 : 0;\n        graphie\n            .label(\n                [xMid, -xOffset / scale[1]],\n                options.xAxisLabel,\n                \"below\",\n                false\n            )\n            .css(\"font-weight\", \"bold\");\n\n        var yMid = 0 + yWidth / 2;\n        var yOffset = data ? 55 : 28;\n        graphie\n            .label(\n                [range[0][0] - yOffset / scale[0], yMid],\n                options.yAxisLabel,\n                \"center\",\n                false\n            )\n            .css(\"font-weight\", \"bold\")\n            .css(\"-webkit-transform\", \"rotate(-90deg)\");\n    },\n\n    handleMouseInteraction: function(point) {\n        this.setState({\n            threshold: point[0],\n        });\n    },\n\n    /* Convenience functions that help calculate props based on other props. */\n    _range: function(props) {\n        var defaultRange = [[0, 100], [-1, 10]];\n        props = props || this.props;\n        return props.data ? this._getRangeForData(props.data) : defaultRange;\n    },\n\n    _getRangeForData: function(data) {\n        // Find first/last non-zero entry and add some padding\n        var padding = 10;\n        var firstIndex = _.indexOf(data, _.find(data, n => n > 0));\n        var xMin = Math.max(0, firstIndex - padding);\n        var lastIndex = _.lastIndexOf(data, _.last(_.filter(data, n => n > 0)));\n        var xMax = Math.min(100 + 1, lastIndex + 1 + padding);\n\n        // The y-axis is bounded above by largest value, and below by 0.\n        // However, the 'range' of the y-axis goes as low as -1 to allow\n        // Graphie to draw ticks on the x-Axis that extend vertically below\n        // y = 0.\n        var yMin = -1;\n        var yMax = _.max(data);\n\n        return [[xMin, xMax], [yMin, yMax]];\n    },\n\n    _getInitialThreshold: function(range) {\n        // We pick a pretty-looking threshold, 1/3 of the way along the axis\n        var xRange = range[0];\n        return xRange[0] + (xRange[1] - xRange[0]) / 3;\n    },\n});\n\nvar Simulator = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        data: PropTypes.arrayOf(PropTypes.number),\n        numTrials: PropTypes.number,\n        proportionLabel: PropTypes.string,\n        proportionOrPercentage: PropTypes.string,\n        randomSeed: PropTypes.number,\n        sampleSize: PropTypes.number,\n        trackInteraction: PropTypes.func.isRequired,\n        userProportion: PropTypes.number,\n        xAxisLabel: PropTypes.string,\n        yAxisLabel: PropTypes.string,\n    },\n\n    getInitialState: function() {\n        return {\n            invalidInput: false,\n        };\n    },\n\n    getDefaultProps: function() {\n        return {\n            data: null,\n            userProportion: null,\n            sampleSize: null,\n            numTrials: null,\n            randomSeed: 0,\n            xAxisLabel: \"Proportion (%)\",\n            yAxisLabel: \"Number of times seen\",\n            proportionLabel: \"Underlying proportion\",\n            proportionOrPercentage: \"proportion\",\n            apiOptions: ApiOptions.defaults,\n        };\n    },\n\n    componentWillMount: function() {\n        if (this.props.randomSeed != null) {\n            this.generateNumber = Util.seededRNG(this.props.randomSeed);\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (nextProps.randomSeed !== this.props.randomSeed) {\n            this.generateNumber = Util.seededRNG(nextProps.randomSeed);\n        }\n    },\n\n    render: function() {\n        var inputStyle = {\n            marginLeft: \"5px\",\n        };\n\n        var highlight = \"0px 0px 0px 2px rgba(255, 165, 0, 1)\";\n        var highlightStyle = _.extend({}, inputStyle, {\n            WebkitBoxShadow: highlight,\n            MozBoxShadow: highlight,\n            boxShadow: highlight,\n            transition: \"all 0.15s\",\n        });\n        var unhighlightStyle = _.extend({}, inputStyle, {\n            transition: \"all 0.15s\",\n        });\n        var style = this.state.invalidInput ? highlightStyle : unhighlightStyle;\n\n        var InputComponent = this.props.apiOptions.staticRender\n            ? MathOutput\n            : NumberInput;\n\n        var proportionInput = (\n            <div>\n                <InputComponent\n                    ref=\"userProportion\"\n                    style={style}\n                    value={this.calculateDisplayProportion()}\n                    checkValidity={this.checkProportionValidity}\n                    disabled={this.props.apiOptions.readOnly}\n                    onChange={this.handleUserProportionChange}\n                    onFocus={() => this.props.onFocus([\"userProportion\"])}\n                    onBlur={() => this.props.onBlur([\"userProportion\"])}\n                />\n                <InfoTip>\n                    <p>\n                        This controls the proportion or percentage that will be\n                        used in your simulation.\n                    </p>\n                </InfoTip>\n            </div>\n        );\n\n        var sampleSizeInput = (\n            <div>\n                <InputComponent\n                    ref=\"sampleSize\"\n                    style={style}\n                    value={this.props.sampleSize}\n                    checkValidity={val => val >= 0}\n                    disabled={this.props.apiOptions.readOnly}\n                    onChange={this.handleSampleSizeChange}\n                    onFocus={() => this.props.onFocus([\"sampleSize\"])}\n                    onBlur={() => this.props.onBlur([\"sampleSize\"])}\n                />\n                <InfoTip>\n                    <p>\n                        This controls the sample size that will be used in your\n                        simulation. For example, if you set this to 100, then\n                        for each trial, responses from 100 participants will be\n                        simulated.\n                    </p>\n                </InfoTip>\n            </div>\n        );\n\n        var numTrialsDisplay = (\n            <div style={{textAlign: \"right\"}}>\n                <b>\n                    {this.props.numTrials}\n                </b>\n                <InfoTip>\n                    <p>\n                        This is the number of trials used in the simulation. For\n                        example, if set to 50, then the survey will be conducted\n                        50 times.\n                    </p>\n                </InfoTip>\n            </div>\n        );\n\n        // Generates a table from a set of titles and values.\n        var generateTable = contents => {\n            var header = (\n                <thead>\n                    <tr>\n                        <th>Parameter</th>\n                        <th>Value</th>\n                    </tr>\n                </thead>\n            );\n\n            var body = (\n                <tbody>\n                    {_.map(contents, (row, i) => {\n                        return (\n                            <tr key={i}>\n                                <td>\n                                    {row.title}\n                                </td>\n                                <td>\n                                    {row.value}\n                                </td>\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            );\n\n            return (\n                <table>\n                    {header}\n                    {body}\n                </table>\n            );\n        };\n\n        // Contents for the table to-be generated\n        var contents = [\n            {\n                title: this.props.proportionLabel + \":\",\n                value: proportionInput,\n            },\n            {\n                title: \"Sample size:\",\n                value: sampleSizeInput,\n            },\n            {\n                title: \"Number of trials:\",\n                value: numTrialsDisplay,\n            },\n        ];\n\n        // The 'Run Simulation' button\n        var buttonStyle = {\n            margin: \"20px 0\",\n        };\n        var startButton = (\n            <button\n                className=\"simple-button\"\n                style={buttonStyle}\n                disabled={this.props.apiOptions.readOnly}\n                onClick={this.handleRunSimulation}\n            >\n                {i18n._(\"Run simulation\")}\n            </button>\n        );\n\n        // When we plot data, ticks on the x-axis require some vertical padding\n        var histogramStyle = {\n            paddingBottom: this.props.data ? 40 : 0,\n        };\n        var histogram = (\n            <div style={histogramStyle}>\n                <Histogram\n                    data={this.props.data}\n                    xAxisLabel={this.props.xAxisLabel}\n                    yAxisLabel={this.props.yAxisLabel}\n                    setDrawingAreaAvailable={\n                        this.props.apiOptions.setDrawingAreaAvailable\n                    }\n                />\n            </div>\n        );\n\n        return (\n            <div>\n                {generateTable(contents)}\n                {startButton}\n                {histogram}\n            </div>\n        );\n    },\n\n    calculateDisplayProportion: function() {\n        var userProportion = this.props.userProportion;\n\n        // If we want to display as a percentage, multiply proportion by 100.0.\n        if (this.props.proportionOrPercentage === \"percentage\") {\n            return Math.round(100 * userProportion);\n        } else {\n            return userProportion;\n        }\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    checkProportionValidity: function(value) {\n        return (\n            (value >= 0.0 &&\n                (this.props.proportionOrPercentage === \"proportion\" &&\n                    value <= 1.0)) ||\n            (this.props.proportionOrPercentage === \"percentage\" &&\n                value <= 100.0)\n        );\n    },\n\n    handleUserProportionChange: function(value, cb) {\n        var userProportion;\n\n        // If \"percentage\" mode is enabled, user will have entered value as\n        // a percentage. However, we always store as a proportion, so we cast.\n        if (this.props.proportionOrPercentage === \"percentage\") {\n            userProportion = value / 100.0;\n        } else {\n            userProportion = value;\n        }\n\n        // If they entered a number, we may need to cap it\n        if (userProportion != null) {\n            userProportion = Math.min(1.0, Math.max(0.0, userProportion));\n        }\n        this.props.onChange(\n            {\n                userProportion: userProportion,\n            },\n            cb\n        );\n    },\n\n    handleSampleSizeChange: function(sampleSize, cb) {\n        if (sampleSize != null) {\n            sampleSize = Math.min(\n                maxSampleSize,\n                Math.max(0, Math.floor(sampleSize))\n            );\n        }\n        this.props.onChange(\n            {\n                sampleSize: sampleSize,\n            },\n            cb\n        );\n    },\n\n    handleRunSimulation: function() {\n        // If they haven't filled out a parameter field, highlight it.\n        if (\n            this.props.numTrials == null ||\n            this.props.userProportion == null ||\n            this.props.sampleSize == null\n        ) {\n            this.setState({\n                invalidInput: true,\n            });\n            return;\n        } else {\n            this.setState({\n                invalidInput: false,\n            });\n        }\n        this.props.onChange({\n            data: this.generateData(),\n        });\n        this.props.trackInteraction();\n    },\n\n    generateData: function(props) {\n        props = props || this.props;\n        var getSampleDistribution = (sampleSize, numTrials, proportion) => {\n            var draw = () => {\n                return this.generateNumber() < proportion;\n            };\n            var sampleDistribution = _.times(100 + 1, () => 0);\n            _.times(numTrials, () => {\n                var results = _.times(sampleSize, draw);\n                var count = _.filter(results, _.identity).length;\n                var normalizedCount = Math.floor(100 * count / sampleSize);\n                sampleDistribution[normalizedCount]++;\n            });\n            return sampleDistribution;\n        };\n        return getSampleDistribution(\n            props.sampleSize,\n            props.numTrials,\n            props.userProportion\n        );\n    },\n\n    /* InputPath API */\n    getInputPaths: function() {\n        return [[\"userProportion\"], [\"sampleSize\"]];\n    },\n\n    focus: function() {\n        var path = _.head(this.getInputPaths());\n        this.focusInputPath(path);\n        return true;\n    },\n\n    focusInputPath: function(path) {\n        assert(path.length > 0);\n        var inputID = _.head(path);\n        var inputComponent = this.refs[inputID];\n        inputComponent.focus();\n    },\n\n    blurInputPath: function(path) {\n        assert(path.length > 0);\n        var inputID = _.head(path);\n        var inputComponent = this.refs[inputID];\n        inputComponent.blur();\n    },\n\n    getDOMNodeForPath: function(path) {\n        assert(path.length > 0);\n        var inputID = _.head(path);\n        return ReactDOM.findDOMNode(this.refs[inputID]);\n    },\n\n    getGrammarTypeForPath: function(path) {\n        assert(path.length > 0);\n        return \"number\";\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        assert(path.length > 0);\n        var inputID = _.head(path);\n        var capitalizedID = inputID.charAt(0).toUpperCase() + inputID.slice(1);\n        var functionName = \"handle\" + capitalizedID + \"Change\";\n        this[functionName](newValue, cb);\n    },\n\n    getUserInput: function() {\n        return null;\n    },\n\n    simpleValidate: function(rubric) {\n        return Simulator.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Simulator, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\nvar propTransform = editorProps => {\n    var widgetProps = _.clone(editorProps);\n    widgetProps.randomSeed = editorProps.problemNum;\n    return widgetProps;\n};\n\n_module_.exports = {\n    name: \"simulator\",\n    displayName: \"Simulator\",\n    widget: Simulator,\n    transform: propTransform,\n    hidden: true,\n};\nexport default _module_.exports;\n","import _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport { iconCircleArrowDown, iconCircleArrowUp, iconPlus, iconTrash } from \"../icon-paths.js\";\nimport _editorJsx from \"../editor.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-alert, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Editor = _editorJsx;\nconst InlineIcon = _componentsInlineIconJsx;\n\nvar StepControlButton = createReactClass({\n    render: function() {\n        return (\n            <a\n                href=\"#\"\n                className={\n                    \"step-control-button \" +\n                    \"simple-button \" +\n                    \"simple-button--small \" +\n                    \"orange\"\n                }\n                onClick={e => {\n                    e.preventDefault();\n                    this.props.onClick();\n                }}\n            >\n                <InlineIcon {...this.props.icon} />\n            </a>\n        );\n    },\n});\n\nconst SequenceEditor = createReactClass({\n    propTypes: {\n        json: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string,\n                widgets: PropTypes.object,\n                images: PropTypes.object,\n            })\n        ),\n        apiOptions: ApiOptions.propTypes,\n        onChange: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            json: [\n                {\n                    content: \"\",\n                    widgets: {},\n                    images: {},\n                },\n            ],\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-sequence-editor\">\n                {_.map(this.props.json, (json, i) => {\n                    return (\n                        <div key={i}>\n                            Step {i + 1}\n                            <div\n                                style={{\n                                    display: \"inline-block\",\n                                    float: \"right\",\n                                }}\n                            >\n                                {i + 1 < this.props.json.length &&\n                                    <StepControlButton\n                                        icon={iconCircleArrowDown}\n                                        onClick={() => {\n                                            this._handleMoveStepLater(i);\n                                        }}\n                                    />}\n                                {i > 0 &&\n                                    <StepControlButton\n                                        icon={iconCircleArrowUp}\n                                        onClick={() => {\n                                            this._handleMoveStepEarlier(i);\n                                        }}\n                                    />}\n                                <StepControlButton\n                                    icon={iconTrash}\n                                    onClick={() => {\n                                        var msg =\n                                            \"Are you sure you \" +\n                                            \"want to remove step \" +\n                                            (i + 1) +\n                                            \"?\";\n                                        if (confirm(msg)) {\n                                            this._handleRemoveStep(i);\n                                        }\n                                    }}\n                                />\n                                <StepControlButton\n                                    icon={iconPlus}\n                                    onClick={() => {\n                                        this._handleAddStepAfter(i);\n                                    }}\n                                />\n                            </div>\n                            <Editor\n                                ref={\"editor\" + i}\n                                apiOptions={this.props.apiOptions}\n                                content={json.content}\n                                widgets={json.widgets}\n                                images={json.images}\n                                widgetEnabled={true}\n                                immutableWidgets={false}\n                                onChange={_.partial(\n                                    this._handleEditorChange,\n                                    i\n                                )}\n                            />\n                        </div>\n                    );\n                })}\n            </div>\n        );\n    },\n\n    _handleEditorChange: function(i, newProps) {\n        var steps = _.clone(this.props.json);\n        steps[i] = _.extend({}, steps[i], newProps);\n        this.props.onChange({json: steps});\n    },\n\n    serialize: function() {\n        return {\n            json: _.times(this.props.json.length, i => {\n                return this.refs[\"editor\" + i].serialize();\n            }),\n        };\n    },\n\n    _handleMoveStepEarlier: function(i) {\n        if (i === 0) {\n            return;\n        }\n        var steps = _.clone(this.props.json);\n        var step = steps[i];\n        steps.splice(i, 1);\n        steps.splice(i - 1, 0, step);\n        this.props.onChange({\n            json: steps,\n        });\n    },\n\n    _handleMoveStepLater: function(i) {\n        var steps = _.clone(this.props.json);\n        if (i + 1 === steps.length) {\n            return;\n        }\n        var step = steps[i];\n        steps.splice(i, 1);\n        steps.splice(i + 1, 0, step);\n        this.props.onChange({\n            json: steps,\n        });\n    },\n\n    _handleAddStepAfter: function(i) {\n        // We do a full serialization here because we\n        // might be copying widgets:\n        var steps = _.clone(this.props.json);\n        // Here we do magic to allow you to copy-paste\n        // things from the previous section into the new\n        // section while preserving widgets.\n        // To enable this, we preserve the widgets\n        // object for the new section, but wipe out\n        // the content.\n        var newStep =\n            i >= 0\n                ? {\n                    widgets: steps[i].widgets,\n                }\n                : {};\n        steps.splice(i + 1, 0, newStep);\n        this.props.onChange({\n            json: steps,\n        });\n    },\n\n    _handleRemoveStep: function(i) {\n        var steps = _.clone(this.props.json);\n        steps.splice(i, 1);\n        this.props.onChange({\n            json: steps,\n        });\n    },\n});\n\n_module_.exports = SequenceEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _utilJs from \"../util.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport { iconOk } from \"../icon-paths.js\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar Changeable = _mixinsChangeableJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nvar Renderer = _rendererJsx;\nvar Util = _utilJs;\n\nvar Sequence = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        json: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string,\n                images: PropTypes.object,\n                widgets: PropTypes.object,\n            })\n        ),\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            json: [\n                {\n                    content: \"\",\n                    widgets: {},\n                    images: {},\n                },\n            ],\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            visible: 1,\n        };\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        return nextProps !== this.props || nextState !== this.state;\n    },\n\n    render: function() {\n        var icon = <InlineIcon {...iconOk} style={{color: \"green\"}} />;\n\n        var content = _.chain(this.props.json)\n            .first(this.state.visible)\n            .map((step, i) => `[[${Util.snowman} group ${i}]]`)\n            .join(\"\\n\\n\")\n            .value();\n\n        var widgets = {};\n        _.each(this.props.json, (step, i) => {\n            var widgetId = `group ${i}`;\n            widgets[widgetId] = {\n                type: \"group\",\n                graded: true,\n                version: {major: 0, minor: 0},\n                options: _.extend({}, step, {\n                    icon: i < this.state.visible - 1 ? icon : null,\n                }),\n            };\n        });\n\n        return (\n            <div className=\"perseus-sequence\">\n                <Renderer\n                    ref=\"renderer\"\n                    content={content}\n                    widgets={widgets}\n                    onInteractWithWidget={this._handleInteraction}\n                    apiOptions={this.props.apiOptions}\n                    linterContext={this.props.linterContext}\n                />\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    _handleInteraction: function(groupWidgetId) {\n        var step = parseInt(groupWidgetId.split(\" \")[1]);\n        if (step === this.state.visible - 1) {\n            var widget = this.refs.renderer.getWidgetInstance(\"group \" + step);\n\n            widget.showRationalesForCurrentlySelectedChoices();\n            var score = widget.simpleValidate();\n\n            if (score.type === \"points\" && score.total === score.earned) {\n                this.setState({\n                    visible: this.state.visible + 1,\n                });\n                this.props.trackInteraction({\n                    visible: this.state.visible + 1,\n                });\n            }\n        }\n    },\n});\n\nvar traverseChildWidgets = function(props, traverseRenderer) {\n    var oldJson = props.json;\n    if (!_.isArray(oldJson)) {\n        oldJson = [oldJson];\n    }\n    var json = _.map(oldJson, rendererOptions => {\n        return traverseRenderer(rendererOptions);\n    });\n\n    return _.extend({}, props, {json: json});\n};\n\n_module_.exports = {\n    name: \"sequence\",\n    displayName: \"Graded Sequence\",\n    widget: Sequence,\n    traverseChildWidgets: traverseChildWidgets,\n    tracking: \"all\",\n    hidden: true,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n\nconst React = _react;\n\nconst ReactDOM = _reactDom;\n\nconst TextInput = createReactClass({\n    propTypes: {\n        value: PropTypes.string,\n        onChange: PropTypes.func.isRequired,\n        className: PropTypes.string,\n        labelText: PropTypes.string,\n        onFocus: PropTypes.func,\n        onBlur: PropTypes.func,\n        disabled: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n            disabled: false,\n        };\n    },\n\n    render: function() {\n        const {labelText, ...props} = this.props;\n        return (\n            <input\n                {...props}\n                type=\"text\"\n                aria-label={labelText}\n                onChange={e => this.props.onChange(e.target.value)}\n            />\n        );\n    },\n\n    focus: function() {\n        ReactDOM.findDOMNode(this).focus();\n    },\n\n    blur: function() {\n        ReactDOM.findDOMNode(this).blur();\n    },\n\n    getValue: function() {\n        return ReactDOM.findDOMNode(this).value;\n    },\n\n    getStringValue: function() {\n        return ReactDOM.findDOMNode(this).value.toString();\n    },\n\n    setSelectionRange: function(selectionStart, selectionEnd) {\n        ReactDOM.findDOMNode(this).setSelectionRange(\n            selectionStart,\n            selectionEnd\n        );\n    },\n\n    getSelectionStart: function() {\n        return ReactDOM.findDOMNode(this).selectionStart;\n    },\n\n    getSelectionEnd: function() {\n        return ReactDOM.findDOMNode(this).selectionEnd;\n    },\n});\n\n_module_.exports = TextInput;\nexport default _module_.exports;\n","import _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst NumberInput = _componentsNumberInputJsx;\nconst TextInput = _componentsTextInputJsx;\n\nvar ReactionDiagramWidgetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        rotationAngle: PropTypes.arrayOf(PropTypes.number),\n        separators: PropTypes.arrayOf(PropTypes.object),\n        smiles: PropTypes.arrayOf(PropTypes.string),\n    },\n\n    getDefaultProps: function() {\n        return {\n            smiles: [\"\", \"\"],\n            rotationAngle: [0, 0],\n            separators: [{type: \"right\", topText: \"\", bottomText: \"\"}],\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    updateMolecule: function(idx) {\n        return function(newValue) {\n            const newSmiles = [...this.props.smiles];\n            newSmiles[idx] = newValue;\n            this.change({smiles: newSmiles});\n        }.bind(this);\n    },\n\n    updateRotation: function(idx) {\n        return function(newValue) {\n            const newRot = [...this.props.rotationAngle];\n            newRot[idx] = newValue;\n            this.change({rotationAngle: newRot});\n        }.bind(this);\n    },\n\n    updateSeparators: function(idx, propName) {\n        return newValue => {\n            const newSep = this.props.separators.map(sep => {\n                return {...sep};\n            });\n            newSep[idx][propName] = newValue;\n            this.change({separators: newSep});\n        };\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n\n    render: function() {\n        // TODO(colin): use styling instead of &nbsp hacks.\n        return (\n            <div>\n                <div>\n                    <label>\n                        LHS SMILES:&nbsp;\n                        <TextInput\n                            onChange={this.updateMolecule(0)}\n                            value={this.props.smiles[0]}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        LHS Rotation (deg):&nbsp;\n                        <NumberInput\n                            onChange={this.updateRotation(0)}\n                            value={this.props.rotationAngle[0]}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        RHS SMILES:&nbsp;\n                        <TextInput\n                            onChange={this.updateMolecule(1)}\n                            value={this.props.smiles[1]}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        RHS Rotation (deg):&nbsp;\n                        <NumberInput\n                            onChange={this.updateRotation(1)}\n                            value={this.props.rotationAngle[1]}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Top of arrow text:&nbsp;\n                        <TextInput\n                            onChange={this.updateSeparators(0, \"topText\")}\n                            value={this.props.separators[0].topText}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Bottom of arrow text:&nbsp;\n                        <TextInput\n                            onChange={this.updateSeparators(0, \"bottomText\")}\n                            value={this.props.separators[0].bottomText}\n                        />\n                    </label>\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = ReactionDiagramWidgetEditor;\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n// Regexp defining characters that are valid SMILES characters that this parser\n// can parse.  In addition to serving as a sort of validation, this also keeps\n// out unimplemented features (like cycles and stereochemistry), which use\n// additional characters.\nconst smilesRe = new RegExp(\"^[A-Za-z\\\\[\\\\]()=#+-]*$\");\n\n// Regexp defining what characters are valid as atom names.  This includes\n// common 1-character elements, Cl and Br for convenience, and the open\n// bracket, which can be used to include anything as an atom name.\nconst atomRe = new RegExp(\"^(Cl|Br|[CONPSFBI]|\\\\[)\");\n\nfunction ParseError(message) {\n    this.message = message;\n}\n\n/**\n * Perform a functional update of a possibly nested object.\n *\n * Args:\n *     obj: an object, will not be modified\n *     keylist: a list of keys whose values will be updated in the object.\n *         This represents a path to a value inside nested objects.  For\n *         example, if keylist == [\"a\", \"b\", \"c\"], then a new object is\n *         returned with obj[\"a\"][\"b\"][\"c\"] updated.  Note that if any of the\n *         keys is not already present, this will insert {} as a default value\n *         for that key.\n *     val: the new value to associate with the keypath\n *\n * Return: a new object, which is a shallow copy of the original with the value\n *     at the specified keypath replaced.\n */\nfunction _mset(obj, keylist, val) {\n    const k0 = keylist[0];\n    const rest = keylist.slice(1);\n    let newObj;\n    if (Array.isArray(obj)) {\n        newObj = [...obj];\n    } else {\n        newObj = {...(obj || {})};\n    }\n    let newVal = val;\n    if (rest.length > 0) {\n        newVal = _mset(newObj[k0], rest, val);\n    }\n    newObj[k0] = newVal;\n    return newObj;\n}\n\n/**\n * Perform a functional increment of a value in a nested object.\n *\n * Args:\n *     obj: an object; this will not be modified\n *     keylist: a list of keys representing a path into a nested object.  (See\n *         `_mset` for examples.)\n *\n * Return:\n *     an object that is a shallow copy of obj, with the value at the specified\n *     path incremeneted.\n */\nfunction _inc(obj, keylist) {\n    const val = keylist.reduce(function(acc, elt) {\n        return acc[elt];\n    }, obj);\n\n    return _mset(obj, keylist, val + 1);\n}\n\nfunction validate(smiles) {\n    return smilesRe.test(smiles);\n}\n\n/**\n * Parse a bond modifier character, updating the context object so that the\n * next bond created has this modifier.\n */\nfunction parseBondModifier(smiles, ctx) {\n    const firstChar = smiles[0];\n    const rest = smiles.slice(1);\n    if (firstChar === \"=\") {\n        return parse(rest, _mset(ctx, [\"bond\", \"bondType\"], \"double\"));\n    } else if (firstChar === \"#\") {\n        return parse(rest, _mset(ctx, [\"bond\", \"bondType\"], \"triple\"));\n    }\n    throw new ParseError(\"Invalid character: \" + firstChar);\n}\n\n/**\n * Slice the input string, removing a parenthesized expression.\n * (Will handle nested parentheses.)\n *\n * parenStack should be a list containing any open parentheses already\n * encountered.  (Usually, this will be [\"(\"])\n */\nfunction sliceFromMatchingCloseParen(smiles, parenStack) {\n    if (parenStack.length === 0) {\n        return smiles;\n    }\n\n    if (smiles === \"\") {\n        throw new ParseError(\"Mismatched parentheses\");\n    }\n\n    const firstChar = smiles[0];\n    const rest = smiles.slice(1);\n\n    if (firstChar === \"(\") {\n        return sliceFromMatchingCloseParen(rest, parenStack.concat(firstChar));\n    }\n\n    if (firstChar === \")\") {\n        return sliceFromMatchingCloseParen(rest, parenStack.slice(1));\n    }\n\n    return sliceFromMatchingCloseParen(rest, parenStack);\n}\n\n/**\n * Parse a branch, as indicated by the presence of a parenthesized experession.\n *\n * This returns a list of all branches (including the continuation of the\n * backbone) that should be added to the previous atom's bond list.\n */\nfunction parseParenthesizedExpression(smiles, ctx) {\n    const firstChar = smiles[0];\n    const rest = smiles.slice(1);\n    if (firstChar === \"(\") {\n        let newCtx = {...ctx, parens: ctx.parens + \"(\"};\n        // increment the branch index\n        newCtx = _inc(ctx, [\"idx\", ctx.idx.length - 1, 1]);\n\n        let inBranchIdx = -1;\n        if (ctx.idx[ctx.idx.length - 1][0] % 2 === 0) {\n            // HACK(colin): this is so that we preserve the odd/even series in\n            // indices in branches; the layout engine uses this to select\n            // angles, and if we don't do this, editing one part of a molecule\n            // can cause another to flop around oddly.\n            // TODO(colin): this should just start at 0 all the time, and the\n            // layout engine should figure out continuity.\n            inBranchIdx = 0;\n        }\n        const parenCtx = {\n            ...newCtx,\n            idx: newCtx.idx.concat([[inBranchIdx, 0]]),\n            parens: newCtx.parens.concat(\"(\"),\n        };\n        const parenExpr = parse(rest, parenCtx);\n        const remainder = parse(\n            sliceFromMatchingCloseParen(rest, [\"(\"]),\n            newCtx\n        );\n        return [parenExpr].concat(remainder);\n    } else if (firstChar === \")\") {\n        if (ctx.parens[ctx.parens.length - 1] !== \"(\") {\n            throw new ParseError(\"Mismatched parentheses\");\n        }\n        return null;\n    } else {\n        throw new ParseError(\"Invalid bare character: \" + firstChar);\n    }\n}\n\n/**\n * Get the symbol of the next atom in the molecule.\n *\n * Return a 2-element list containing that symbol and the remainder of the\n * molecule.\n */\nfunction readAtomSymbol(smiles, _ctx) {\n    let sym = null;\n    let rest = null;\n    if (smiles[0] === \"[\") {\n        const closingIdx = smiles.indexOf(\"]\");\n        if (closingIdx === -1) {\n            return [\"\", smiles];\n        }\n        sym = smiles.slice(1, closingIdx);\n        rest = smiles.slice(closingIdx + 1);\n    } else {\n        const match = atomRe.exec(smiles);\n        sym = match[1];\n        rest = smiles.slice(sym.length);\n    }\n\n    return [sym, rest];\n}\n\n/**\n * Parse the next atom in the molecule, returning an atom object if this is the\n * first atom in the molecule, or a bond object with this atom as the\n * destination of the bond if this is not the first atom.\n */\nfunction parseAtom(smiles, ctx) {\n    const symbolInfo = readAtomSymbol(smiles, ctx);\n    const atom = symbolInfo[0];\n    if (atom === \"\") {\n        return [\"error\", \"Unable to parse bracketed atom.\"];\n    }\n    const rest = symbolInfo[1];\n\n    // Atoms are indexed by a list of two-element lists.  In each two-element\n    // list, the first element is the atom counter, and the second element is\n    // the branch counter.  Branches are 1-indexed so that the main chain of\n    // the molecule can be indicated by 0.  Atoms may be either 0- or\n    // 1-indexed, defaulting to 1, to maintain a alternating pattern of\n    // odd/even indices. So, for example, if an atom has a branch off the main\n    // chain, and its atom index is x, then the indices of atoms are:\n    //     Atom where branch occurs: [[x, 0]]\n    //     First atom in the branch: [[x, 1], [1, 0]]  (assuming x is even)\n    //     Next atom in the main chain: [[x + 1, 0]]\n\n    // increment the atom counter and reset the branch counter\n    const newCtx = _mset(\n        ctx,\n        [\"idx\", ctx.idx.length - 1],\n        [1 + ctx.idx[ctx.idx.length - 1][0], 0]\n    );\n    let restOfMolecule = parse(\n        rest,\n        _mset(newCtx, [\"bond\", \"bondType\"], \"single\")\n    );\n    if (!Array.isArray(restOfMolecule) && !!restOfMolecule) {\n        //TODO(colin): fix this awkwardness.\n        restOfMolecule = [restOfMolecule];\n    }\n    const atomObj = {\n        type: \"atom\",\n        symbol: atom,\n        bonds: restOfMolecule,\n        idx: newCtx.idx,\n    };\n    if (ctx.bond) {\n        return {\n            type: \"bond\",\n            bondType: ctx.bond.bondType,\n            to: atomObj,\n        };\n    }\n    return atomObj;\n}\n\nfunction startsWithAtom(s) {\n    return atomRe.test(s);\n}\n\nfunction isModifierChar(s) {\n    return s === \"=\" || s === \"#\";\n}\n\n/**\n * Parse a SMILES string to an internal tree representation.\n *\n * Args:\n *   smiles [string]: a string representing the molecule.\n *\n * Returns: the parse tree (see top-of file docstring for details).\n *\n * Throws:\n *     ParseError: if the input is not valid SMILES or contains features not\n *         yet implemented.\n */\nfunction parse(smiles, ctx) {\n    if (!validate(smiles)) {\n        throw new ParseError(\"Invalid input.\");\n    }\n\n    if (!smiles || smiles.length === 0) {\n        return null;\n    }\n\n    if (startsWithAtom(smiles)) {\n        return parseAtom(\n            smiles,\n            ctx || {\n                idx: [[0, 0]],\n                parens: [],\n                stack: [],\n                bondModifiers: [],\n            }\n        );\n    } else if (isModifierChar(smiles[0])) {\n        // TODO(colin): add a better error message in the case where the input\n        // is invalid and starts with a modifier character?\n        return parseBondModifier(smiles, ctx);\n    } else {\n        // TODO(colin): add additional cases for unimplemented bits of SMILES\n        // syntax.\n        return parseParenthesizedExpression(smiles, ctx);\n    }\n}\n\n_module_.exports = {parse: parse, ParseError: ParseError};\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * A molecule layout engine.\n *\n * This _module_ transforms the SMILES syntax tree into a set of rendering\n * instructions.  A rendering instruction is an object indicating what type of\n * thing to render (e.g. text or line), where to render it, and any other style\n * properties needed.\n *\n * For instance, an oxygen atom might be rendered as\n * {type: \"text\", value: \"O\", pos: [0, 0], idx: \"1,0\"}\n */\n\n// Default length of the bond.  This currently corresponds directly to pixels\n// in the renderer, but we may want this just to be arbitrary in the future.\nconst bondLength = 30;\n\n/**\n * Compute a coordinate by moving an angle and length from an origin point.\n *\n * Args:\n *     origin: a list of the [x, y] coordinates of the origin\n *     angle: an angle in degrees from the origin, following the typical\n *         convention of +x axis = 0 degrees, +y axis = 90 degrees.\n *     length: the distance to the new point\n * Return:\n *     a two-element list containing the [x, y] coordinates of the point.\n */\nfunction polarAdd(origin, angle, length) {\n    const x = origin[0];\n    const y = origin[1];\n    return [\n        x + Math.cos(angle * 2 * Math.PI / 360) * length,\n        y + -1.0 * Math.sin(angle * 2 * Math.PI / 360) * length,\n    ];\n}\n\n/**\n * Compute the layout for a single atom.\n *\n * Args:\n *     atom: the atom node for which layout is being created, as returned from\n *         convertTree; the computed position of this atom is added to this\n *         object in place, in addition to being returned in the layout\n *         instruction.\n *         TODO(colin): refactor so that we don't need to modify this in place\n *     atoms: the list of all atoms, as returned from convertTree, used to\n *         position this atom appropriately relative to its neighbors\n *     bonds: the list of all bonds, as returned from convertTree, used to\n *         determine the geometry based on bond type\n *     rotationAngle: a constant rotation for the whole molecule (in degrees)\n *\n * Return:\n *     a rendering instruction for the atom, containing a type (text), the text\n *     to render, the position, and the atom index\n */\nfunction atomLayout(atom, atoms, bonds, rotationAngle) {\n    let textValue = atom.symbol;\n    if (textValue === \"C\" && Object.keys(atoms).length !== 1) {\n        // By convention, don't render the C for carbon in a chain.\n        textValue = null;\n    }\n\n    if (atom.idx === \"1,0\") {\n        // The first atom is special-cased because there are no neighbors for\n        // relative positioning.\n        const pos = [0, 0];\n        atom.pos = pos;\n        // Conventionally, molecules are rendered where the first bond is not\n        // horizontal, but at a 30 degree angle, so subtract 30 degrees for the\n        // first atom's direction.\n        atom.baseAngle = -30 + rotationAngle;\n        return {type: \"text\", value: textValue, pos: pos, idx: atom.idx};\n    }\n    // If we're an atom with any other index than the case just handled, we're\n    // guaranteed to have a neighbor who has a defined position.\n    const prevPositionedAtom =\n        atoms[\n            atom.connections.find(function(c) {\n                return atoms[c].pos;\n            })\n        ];\n\n    // Find this atom's index in the previous atom's connections\n    const myIndex = prevPositionedAtom.connections.indexOf(atom.idx);\n\n    let baseAngleIncrement = 60;\n    let angleIncrement = 120;\n    if (prevPositionedAtom.connections.length === 4) {\n        // By convention, if an atom has 4 bonds, we represent it with 90\n        // degree angles in 2D, even though it would have tetrahedral geometry\n        // with ~110 degree angles in 3D.\n        angleIncrement = 90;\n        baseAngleIncrement = 90;\n    } else if (\n        bonds.find(\n            bond => bond.bondType === \"triple\" && bond.to === atom.idx\n        ) ||\n        bonds.find(\n            bond => bond.bondType === \"triple\" && bond.to === prevPositionedAtom.idx\n        )\n    ) {\n        // Triple bonds have a bond angle of 180 degrees, so don't change the\n        // direction in which we made the previous bond.\n        angleIncrement = 0;\n        baseAngleIncrement = 0;\n    }\n\n    let angle = 0;\n    const idxPath = prevPositionedAtom.idx.split(\":\");\n    const lastAtomIdx = idxPath[idxPath.length - 1].split(\",\")[0];\n\n    // Conventionally, a single chain of atoms is rendered as a zig-zag pattern\n    // with 120 degree angles.  This means we need to flip the angle every\n    // other atom.  The parser ensures that indices always alternate odd-even,\n    // including taking into account branch points.\n    // TODO(colin): don't depend on the parser's indexing scheme and just track\n    // this entirely in the layout engine.\n    if (parseInt(lastAtomIdx) % 2 !== 0) {\n        angle =\n            prevPositionedAtom.baseAngle -\n            (baseAngleIncrement - angleIncrement * myIndex);\n    } else {\n        angle =\n            prevPositionedAtom.baseAngle +\n            (baseAngleIncrement - angleIncrement * myIndex);\n    }\n\n    const pos = polarAdd(prevPositionedAtom.pos, angle, bondLength);\n\n    atom.pos = pos;\n    atom.baseAngle = angle;\n\n    return {type: \"text\", value: textValue, pos: pos, idx: atom.idx};\n}\n\n/**\n * Get the start and end position for a bond connecting two atoms.\n *\n * If we have non-carbon atoms that render with explicit letters connected by a\n * bond, we don't want the line for the bond to extend into the lettering for\n * the atom.\n *\n * This function returns the start and end positions of the bond's line, taking\n * into account that one or both end points might need to be moved to make room\n * for text.\n *\n * TODO(colin): this makes assumptions about the relative sizes of the length\n * of a bond and the text.  Think about alternate ways to represent this that\n * might not have that problem.\n */\nfunction maybeShrinkLines(fromAtom, toAtom) {\n    const shrinkFactor = 0.25;\n    let fromPos = [fromAtom.pos[0], fromAtom.pos[1]];\n    let toPos = [toAtom.pos[0], toAtom.pos[1]];\n    if (fromAtom.symbol !== \"C\") {\n        fromPos = [\n            toAtom.pos[0] -\n                (1 - shrinkFactor) * (toAtom.pos[0] - fromAtom.pos[0]),\n            toAtom.pos[1] -\n                (1 - shrinkFactor) * (toAtom.pos[1] - fromAtom.pos[1]),\n        ];\n    }\n    if (toAtom.symbol !== \"C\") {\n        // For carbon atoms, conventionally we don't draw any letter, so this\n        // special cases drawing the bond lines all the way to the point where\n        // they meet.\n        toPos = [\n            fromAtom.pos[0] -\n                (1 - shrinkFactor) * (fromAtom.pos[0] - toAtom.pos[0]),\n            fromAtom.pos[1] -\n                (1 - shrinkFactor) * (fromAtom.pos[1] - toAtom.pos[1]),\n        ];\n    }\n    return [fromPos, toPos];\n}\n\n/**\n * Compute the layout for a bond between two atoms.\n *\n * Args:\n *     bond: the bond node for which the layout is being computed, as returned\n *         by convertTree\n *     atoms: the list of all atoms returned by convertTree, which should\n *         already have been processed for layout and thus have positions set\n *\n * Return:\n *     a rendering instruction for the bond containing a type\n *     (line:{single,double,triple}) and the line's endpoints\n */\nfunction bondLayout(bond, atoms) {\n    const fromAtom = atoms[bond.from];\n    const toAtom = atoms[bond.to];\n    const startAndEndPos = maybeShrinkLines(fromAtom, toAtom);\n    return {\n        type: \"line:\" + bond.bondType,\n        startPos: startAndEndPos[0],\n        endPos: startAndEndPos[1],\n    };\n}\n\n/**\n * Convert an array of atom indices to a single string unique identifier.\n *\n * For linear molecules, or for atoms in the main chain, this will just be the\n * atom index, something like \"0,1\".  For branched molecules, however, we\n * uniquely identify atoms by an array of atoms where the branching happened,\n * followed by the index in the current branch (like [\"0,1\", \"1,2\", \"1,1\"]).\n * This function just joins the parts with a colon so that we can have nice\n * object keys that still track the series of branches to get to an atom, which\n * is guaranteed to be a unique identifier.\n *\n */\nfunction idxString(idx) {\n    return idx.join(\":\");\n}\n\n/**\n * Convert the parse tree output by the parser into an ordered list of atoms\n * and bonds to render.\n *\n * Args:\n *     atoms: the output list of atoms that we're in the process of building.\n *         This should be the empty list if not being called recursively.\n *     bonds: the output list of bonds that we're in the process of building.\n *         This should be the empty list if not being called recursively.\n *     tree: the parse tree generated by the SMILES parser _module_.\n *\n * Return:\n *     the final value of atoms and bonds, which are lists of all the atom\n *     nodes and bond nodes, respectively, that need to be rendered.\n */\nfunction convertTree(atoms, bonds, tree) {\n    if (tree === null) {\n        return [atoms, bonds];\n    }\n    if (tree.type === \"atom\") {\n        const treeIdx = idxString(tree.idx);\n        atoms[treeIdx] = {idx: treeIdx, symbol: tree.symbol, connections: []};\n        if (tree.bonds) {\n            tree.bonds.forEach(function(b) {\n                const toIdx = idxString(b.to.idx);\n                atoms[treeIdx].connections.push(toIdx);\n                bonds.push({from: treeIdx, to: toIdx, bondType: b.bondType});\n                convertTree(atoms, bonds, b.to);\n                atoms[toIdx].connections.push(treeIdx);\n            });\n        }\n    }\n    return [atoms, bonds];\n}\n\n/**\n * Recursively process the queue of atoms that need to have layout computed.\n *\n * Args:\n *     outputs: the array of atom rendering instructions we're in the process\n *         of building.  This should be the empty array if not being called\n *         recursively.\n *     atomProcessingQueue: the array of unique identifier strings (see the\n *         comment for idxString for more information about these) of atoms\n *         currently in line to be processed.  When not being called\n *         recursively, this should be a array with a single element, the\n *         unique identifier of the first atom in the structure (\"1,0\" in the\n *         current scheme).\n *     atoms: the array of all atom nodes to be rendered, as returned by\n *         convertTree\n *     bonds: the array of all bond nodes to be rendered, as returned by\n *         convertTree\n *\n * Return:\n *     an array of rendering instructions for all the atoms in the molecule\n */\nfunction atomLayoutHelper(outputs, atomProcessingQueue, atoms, bonds, rotationAngle) {\n    if (atomProcessingQueue.length === 0) {\n        return outputs;\n    }\n\n    const queuedAtomIdx = atomProcessingQueue.shift();\n    const atom = atoms[queuedAtomIdx];\n    atom.connections.forEach(function(c) {\n        if (!atoms[c].pos) {\n            atomProcessingQueue.push(c);\n        }\n    });\n    return atomLayoutHelper(\n        outputs.concat(atomLayout(atom, atoms, bonds, rotationAngle)),\n        atomProcessingQueue,\n        atoms,\n        bonds,\n        rotationAngle\n    );\n}\n\n/**\n * Recursively process the queue of bonds that need to have layout computed.\n *\n * Args:\n *     outputs: the array of bond rendering instructions we're in the process\n *         of building.  This should be the empty array or the array of all\n *         atom rendering instructions if not being called recursively.\n *     atoms: the array of all atom nodes to be rendered, as returned by\n *         convertTree\n *     bonds: the array of all bond nodes to be rendered, as returned by\n *         convertTree\n *\n * Return:\n *     an array of rendering instructions for all the bonds in the molecule\n *     concatenated to the initial value of outputs\n */\nfunction bondLayoutHelper(outputs, atoms, bonds) {\n    if (bonds.length === 0) {\n        return outputs;\n    }\n    return bondLayoutHelper(\n        outputs.concat(bondLayout(bonds[0], atoms)),\n        atoms,\n        bonds.slice(1)\n    );\n}\n\n/**\n * Compute an array of rendering instructions from the parse tree of a molecule.\n *\n * Args:\n *     tree: the parse tree as returned by the SMILES parser _module_\n *     rotationAngle: a global rotation (in degrees) to be applied to the whole\n *         molecule; this is manually adjustable in the widget.\n *\n * Return:\n *     an array of rendering instructions for all the atoms and bonds in the\n *     molecule suitable for processing by the renderer\n */\nexport function layout(tree, rotationAngle) {\n    const converted = convertTree({}, [], tree);\n    const atoms = converted[0];\n    const bonds = converted[1];\n    const outputs = atomLayoutHelper([], [\"1,0\"], atoms, bonds, rotationAngle);\n    return bondLayoutHelper(outputs, atoms, bonds);\n}\n\n_module_.exports = {\n    layout: layout,\n    // The remainder are exported for testing and are not intended for external\n    // use.\n    _atomLayout: atomLayout,\n    _bondLayout: bondLayout,\n    _bondLength: bondLength,\n    _convertTree: convertTree,\n};\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * Draw some text into a 2D canvas drawing context.\n *\n * Args:\n *     ctx: the 2D drawing context\n *     item: the rendering instruction for the text.  Must look like: {\n *         type: \"text\",\n *         pos: [x, y],\n *         value: \"some text to draw\",\n *     }\n *\n */\nfunction drawText(ctx, item) {\n    if (item.value === null) {\n        return;\n    }\n    ctx.fillStyle = styles.fgColor;\n    ctx.font = styles.font;\n    ctx.fillText(\n        item.value,\n        item.pos[0] - styles.fontSizePx / 2 + 1,\n        item.pos[1] + styles.fontSizePx / 2\n    );\n}\n\n/**\n * Draw a double line into a 2D canvas drawing context.\n *\n * Apparently the way you do this is to stroke an extra-wide line in the\n * foreground color and then a smaller line in the background color. 5:3\n * foreground:background width looks reasonable for drawing chemical bonds.\n *\n * Args:\n *     ctx: the 2D drawing context\n *     item: the rendering instruction for the line.  Must look like: {\n *         type: \"line:double\",\n *         startPos: [x, y],\n *         endPos: [x, y],\n *     }\n */\nfunction drawDoubleLine(ctx, item) {\n    // Outer line that forms both of the bond lines.\n    let path = new Path2D();\n    ctx.lineWidth = 5 * styles.lineWidth;\n    ctx.strokeStyle = styles.fgColor;\n    path.moveTo(item.startPos[0], item.startPos[1]);\n    path.lineTo(item.endPos[0], item.endPos[1]);\n    ctx.stroke(path);\n\n    // Inner white line that separates the two bond lines.\n    path = new Path2D();\n    ctx.lineWidth = 3 * styles.lineWidth;\n    ctx.strokeStyle = styles.bgColor;\n    path.moveTo(item.startPos[0], item.startPos[1]);\n    path.lineTo(item.endPos[0], item.endPos[1]);\n    ctx.stroke(path);\n}\n\n/**\n * Draw a triple line into a 2D canvas drawing context.\n *\n * Following the strategy for the double line, we stroke a very wide\n * foreground-color line, then a medium background-color line, then a narrow\n * foreground-color line.\n *\n * Args:\n *     ctx: the 2D drawing context\n *     item: the rendering instruction for the line.  Must look like: {\n *         type: \"line:triple\",\n *         startPos: [x, y],\n *         endPos: [x, y],\n *     }\n */\nfunction drawTripleLine(ctx, item) {\n    // TODO(colin): consolidate duplicated code from the three line drawing\n    // functions.\n\n    // Outer line that will form the two outer bond lines.\n    let path = new Path2D();\n    ctx.lineWidth = 7 * styles.lineWidth;\n    ctx.strokeStyle = styles.fgColor;\n    path.moveTo(item.startPos[0], item.startPos[1]);\n    path.lineTo(item.endPos[0], item.endPos[1]);\n    ctx.stroke(path);\n\n    // Middle white line that separates the bonds\n    path = new Path2D();\n    ctx.lineWidth = 5 * styles.lineWidth;\n    ctx.strokeStyle = styles.bgColor;\n    path.moveTo(item.startPos[0], item.startPos[1]);\n    path.lineTo(item.endPos[0], item.endPos[1]);\n    ctx.stroke(path);\n\n    // Inner line that forms the middle bond line.\n    drawLine(ctx, item);\n}\n\n/**\n * Draw a single line into a 2D canvas drawing context\n *\n * Args:\n *     ctx: the 2D drawing context\n *     item: the rendering instruction for the line.  Must look like: {\n *         type: \"line:single\",\n *         startPos: [x, y],\n *         endPos: [x, y],\n *     }\n */\nfunction drawLine(ctx, item) {\n    const path = new Path2D();\n    ctx.lineWidth = styles.lineWidth;\n    ctx.strokeStyle = styles.fgColor;\n    path.moveTo(item.startPos[0], item.startPos[1]);\n    path.lineTo(item.endPos[0], item.endPos[1]);\n    ctx.stroke(path);\n}\n\n/**\n * Lookup table that maps drawing instruction types to the functions that\n * render them.\n */\nconst drawingFuncs = {\n    text: drawText,\n    \"line:single\": drawLine,\n    \"line:double\": drawDoubleLine,\n    \"line:triple\": drawTripleLine,\n};\n\n/**\n * Draw a single rendering instruction into a 2D canvas drawing context.\n */\nfunction drawItem(ctx) {\n    return function(item) {\n        drawingFuncs[item.type](ctx, item);\n    };\n}\n\n/**\n * Lookup table for drawing priorities.\n *\n * Types with lower priorities are drawn first.\n */\nconst ordering = {\n    \"line:single\": 0,\n    \"line:double\": 0,\n    \"line:triple\": 0,\n    text: 1,\n};\n\n/**\n * Sorting comparison function that orders rendering instructions according to\n * their type's priority.\n */\nfunction compareElements(item0, item1) {\n    return ordering[item0.type] - ordering[item1.type];\n}\n\n/**\n * Draw an array of rendering instructions into a 2D canvas drawing context.\n */\nfunction draw(ctx, items) {\n    items.sort(compareElements).forEach(drawItem(ctx));\n}\n\nconst styles = {\n    bgColor: \"rgb(255, 255, 255)\",\n    fgColor: \"rgb(0, 0, 0)\",\n    fontSizePx: 12,\n    lineWidth: 1,\n};\n\nstyles.font = styles.fontSizePx + \"px sans\";\n\n_module_.exports = draw;\nexport default _module_.exports;\n","import _moleculeSmilesParserJsx from \"./molecule/smiles-parser.jsx\";\nimport { layout } from \"./molecule/molecule-layout.jsx\";\nimport _moleculeMoleculeDrawingJsx from \"./molecule/molecule-drawing.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\n\nconst draw = _moleculeMoleculeDrawingJsx;\nconst SmilesParser = _moleculeSmilesParserJsx;\n\nconst parse = SmilesParser.parse;\nconst ParseError = SmilesParser.ParseError;\n\nconst borderSize = 30;\n\nconst Molecule = createReactClass({\n    propTypes: {\n        id: PropTypes.string.isRequired,\n        rotationAngle: PropTypes.number,\n        smiles: PropTypes.string,\n    },\n\n    getInitialState: function() {\n        return {parsedSmiles: null, error: null};\n    },\n\n    componentWillMount: function() {\n        this.stateFromSmiles(this.props.smiles);\n    },\n\n    componentDidMount: function() {\n        this.canvasRender();\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.stateFromSmiles(nextProps.smiles);\n    },\n\n    componentDidUpdate: function() {\n        this.canvasRender();\n    },\n\n    stateFromSmiles: function(smiles) {\n        try {\n            this.setState({\n                parsedSmiles: parse(smiles),\n                error: null,\n            });\n        } catch (e) {\n            if (e instanceof ParseError) {\n                this.setState({error: e.message});\n            } else {\n                throw e;\n            }\n        }\n    },\n\n    setCanvasBounds: function(canvas, items) {\n        const xmax = Math.max(\n            ...items.map(item => item.pos ? item.pos[0] : -Infinity)\n        );\n        const ymax = Math.max(\n            ...items.map(item => item.pos ? item.pos[1] : -Infinity)\n        );\n        const xmin = Math.min(\n            ...items.map(item => item.pos ? item.pos[0] : Infinity)\n        );\n        const ymin = Math.min(\n            ...items.map(item => item.pos ? item.pos[1] : Infinity)\n        );\n        const width = xmax - xmin + 2 * borderSize;\n        const height = ymax - ymin + 2 * borderSize;\n        canvas.width = width;\n        canvas.height = height;\n        return [borderSize - xmin, borderSize - ymin];\n    },\n\n    canvasRender: function() {\n        // Since canvas drawing happens only through an imperative API, we sync\n        // up the component with the canvas here, which happens when the\n        // component mounts or updates.\n        if (!!this.state.error || !this.state.parsedSmiles) {\n            return;\n        }\n        const items = layout(this.state.parsedSmiles, this.props.rotationAngle);\n        const canvas = this.refs.canvas;\n        const translation = this.setCanvasBounds(canvas, items);\n        const ctx = canvas.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.save();\n        ctx.translate(translation[0], translation[1]);\n        draw(ctx, items);\n        ctx.restore();\n    },\n    render: function() {\n        // TODO(colin): escape the punctuation in the SMILES alt text for\n        // screen readers?\n        let content = (\n            <canvas\n                className=\"molecule-canvas\"\n                id={this.props.id + \"-molecule\"}\n                ref=\"canvas\"\n            >\n                A molecular structure drawing. SMILES notation:\n                {this.props.smiles}.\n            </canvas>\n        );\n        if (this.state.error) {\n            content = (\n                <div className=\"error\">\n                    {this.state.error}\n                </div>\n            );\n        }\n        return (\n            <div className=\"molecule-canvas\">\n                {content}\n            </div>\n        );\n    },\n});\n\nconst MoleculeWidget = createReactClass({\n    propTypes: {\n        rotationAngle: PropTypes.number,\n        smiles: PropTypes.string,\n        widgetId: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {rotationAngle: 0};\n    },\n\n    simpleValidate: function() {\n        return {type: \"points\", earned: 0, total: 0, message: null};\n    },\n\n    getUserInput: function() {\n        return [];\n    },\n\n    validate: function(state, rubric) {\n        // TODO(colin): this is here as part of the interface for a component.\n        // Figure out if there is something more appropriate that this should\n        // return.\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n\n    render: function() {\n        return (\n            <Molecule\n                id={this.props.widgetId}\n                smiles={this.props.smiles}\n                rotationAngle={this.props.rotationAngle}\n            />\n        );\n    },\n});\n\n_module_.exports = {\n    name: \"molecule-renderer\",\n    displayName: \"Molecule renderer\",\n    hidden: true,\n    widget: MoleculeWidget,\n    molecule: Molecule,\n};\nexport default _module_.exports;\n","import _moleculeJsx from \"./molecule.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\n\nconst Molecule = _moleculeJsx.molecule;\n\nconst Separator = createReactClass({\n    propTypes: {\n        // TODO(colin): figure out and add shape.\n        data: PropTypes.any,\n        index: PropTypes.number,\n    },\n\n    componentDidMount: function() {\n        this.drawArrow();\n    },\n\n    componentDidUpdate: function() {\n        this.drawArrow();\n    },\n\n    arrowLength: 100,\n\n    drawArrow: function() {\n        const canvas = this.refs[\"arrowCanvas\" + this.props.index];\n        const ctx = canvas.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        const path = new Path2D();\n        ctx.strokeStyle = \"rgb(0,0,0)\";\n        ctx.lineWidth = 1.2;\n        ctx.lineCap = \"round\";\n        const offset = 5;\n        path.moveTo(offset, canvas.height / 2);\n        path.lineTo(canvas.width - offset, canvas.height / 2);\n        path.moveTo(canvas.width - 2 * offset, canvas.height / 2 - offset);\n        path.lineTo(canvas.width - offset, canvas.height / 2);\n        path.moveTo(canvas.width - 2 * offset, canvas.height / 2 + offset);\n        path.lineTo(canvas.width - offset, canvas.height / 2);\n        ctx.stroke(path);\n    },\n\n    render: function() {\n        return (\n            <div className=\"arrow-container\">\n                <div className=\"above-text\">\n                    {this.props.data.topText}\n                </div>\n                <canvas\n                    height=\"30\"\n                    id={\"arrowCanvas\" + this.props.index}\n                    ref={\"arrowCanvas\" + this.props.index}\n                    width={this.arrowLength}\n                >\n                    Reaction arrow pointing to the right.\n                </canvas>\n                <div className=\"below-text\">\n                    {this.props.data.bottomText}\n                </div>\n            </div>\n        );\n    },\n});\n\nconst ReactionDiagramWidget = createReactClass({\n    propTypes: {\n        // TODO(colin): at the moment, these must be arrays of two elements;\n        // we're limited to a single reaction step.  At some point, add support\n        // for more steps in the reaction.\n        rotationAngle: PropTypes.arrayOf(PropTypes.number),\n        separators: PropTypes.arrayOf(PropTypes.object),\n        smiles: PropTypes.arrayOf(PropTypes.string),\n        widgetId: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {smiles: [], rotationAngle: [], separators: []};\n    },\n\n    simpleValidate: function() {\n        return {type: \"points\", earned: 0, total: 0, message: null};\n    },\n\n    getUserInput: function() {\n        return [];\n    },\n\n    validate: function(state, rubric) {\n        // TODO(colin): this appears to be part of the perseus interface.\n        // Figure out if there's a more appropriate value to return.\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n\n    focus: function() {\n        return true;\n    },\n\n    render: function() {\n        return (\n            <div className=\"reaction\" ref=\"reaction\">\n                {this.props.smiles.map((s, i) => {\n                    const id = this.props.widgetId + \"-\" + i;\n                    return (\n                        <div key={id} className=\"molecule-container\">\n                            <Molecule\n                                id={id}\n                                rotationAngle={this.props.rotationAngle[i]}\n                                smiles={s}\n                            />\n                            {i === this.props.smiles.length - 1\n                                ? null\n                                : <Separator\n                                    data={this.props.separators[i]}\n                                    index={i}\n                                />}\n                        </div>\n                    );\n                })}\n            </div>\n        );\n    },\n});\n\n_module_.exports = {\n    name: \"reaction-diagram\",\n    displayName: \"Chemical reaction\",\n    hidden: true,\n    widget: ReactionDiagramWidget,\n};\nexport default _module_.exports;\n","import _interactive2WrappedLineJs from \"../interactive2/wrapped-line.js\";\nimport _interactive2Js from \"../interactive2.js\";\nimport _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _utilMathJs from \"../util/math.js\";\nimport _utilJs from \"../util.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, max-lines, no-redeclare, no-unused-vars, no-var, object-curly-spacing, one-var, react/prop-types, react/sort-comp, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar ApiClassNames = _perseusApiJsx.ClassNames;\n\nvar deepEq = _utilJs.deepEq;\nconst KhanMath = _utilMathJs;\nconst KhanColors = _utilColorsJs;\nconst GraphUtils = _utilGraphUtilsJs;\nconst Interactive2 = _interactive2Js;\nconst WrappedLine = _interactive2WrappedLineJs;\n\nvar BAR = \"bar\",\n    LINE = \"line\",\n    PIC = \"pic\",\n    HISTOGRAM = \"histogram\",\n    DOTPLOT = \"dotplot\";\n\nconst widgetPropTypes = {\n    type: PropTypes.oneOf([BAR, LINE, PIC, HISTOGRAM, DOTPLOT]),\n    labels: PropTypes.arrayOf(PropTypes.string),\n    categories: PropTypes.arrayOf(\n        PropTypes.oneOfType([\n            PropTypes.number,\n            PropTypes.string,\n        ])\n    ),\n\n    scaleY: PropTypes.number,\n    maxY: PropTypes.number,\n    snapsPerLine: PropTypes.number,\n\n    picSize: PropTypes.number,\n    pixBoxHeight: PropTypes.number,\n    picUrl: PropTypes.string,\n\n    plotDimensions: PropTypes.arrayOf(PropTypes.number),\n    labelInterval: PropTypes.number,\n    starting: PropTypes.arrayOf(PropTypes.number),\n    static: PropTypes.bool,\n};\n\nvar Plotter = createReactClass({\n    propTypes: {\n        onChange: PropTypes.func.isRequired,\n        trackInteraction: PropTypes.func.isRequired,\n        // TODO(alex): Figure out why lint chokes on this line\n        // ...widgetPropTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            type: BAR,\n            labels: [\"\", \"\"],\n            categories: [\"\"],\n\n            scaleY: 1,\n            maxY: 10,\n            snapsPerLine: 2,\n\n            picSize: 40,\n            picBoxHeight: 48,\n            picUrl: \"\",\n\n            plotDimensions: [380, 300],\n            labelInterval: 1,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            values: this.props.starting || [1],\n        };\n    },\n\n    DOT_PLOT_POINT_SIZE: function() {\n        return this.props.apiOptions.isMobile ? 6 : 4;\n    },\n    DOT_PLOT_POINT_PADDING: function() {\n        return 8;\n    },\n    DOT_TICK_POINT_SIZE: function() {\n        return 2;\n    },\n\n    render: function() {\n        // TODO(kevinb) actually compute the size of the graphie correctly and\n        // make it that size so we don't have to add extra padding.  The value\n        // was determined by eye-balling the layout.  :(\n        const paddingForBottomLabel = 75;\n        const style = {\n            marginBottom: this.props.labels[0] ? paddingForBottomLabel : 0,\n        };\n\n        return (\n            <div\n                className={\n                    \"perseus-widget-plotter graphie \" +\n                    ApiClassNames.INTERACTIVE\n                }\n                ref=\"graphieDiv\"\n                style={style}\n            />\n        );\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        if (this.shouldSetupGraphie) {\n            this.setupGraphie(prevState);\n        }\n    },\n\n    componentDidMount: function() {\n        this.setupGraphie(this.state);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        var props = [\n            \"type\",\n            \"labels\",\n            \"categories\",\n            \"scaleY\",\n            \"maxY\",\n            \"snapsPerLine\",\n            \"picUrl\",\n            \"labelInterval\",\n            \"static\",\n        ];\n\n        this.shouldSetupGraphie = _.any(\n            props,\n            function(prop) {\n                return !_.isEqual(this.props[prop], nextProps[prop]);\n            },\n            this\n        );\n\n        if (\n            !_.isEqual(this.props.starting, nextProps.starting) &&\n            !_.isEqual(this.state.values, nextProps.starting)\n        ) {\n            this.shouldSetupGraphie = true;\n            this.setState({values: nextProps.starting});\n        }\n    },\n\n    setupGraphie: function(prevState) {\n        var self = this;\n        self.shouldSetupGraphie = false;\n        var graphieDiv = ReactDOM.findDOMNode(self.refs.graphieDiv);\n        $(graphieDiv).empty();\n        var graphie = GraphUtils.createGraphie(graphieDiv);\n\n        // TODO(jakesandlund): It's not the react way to hang\n        // something off the component object, but since graphie\n        // is outside React, it makes it easier to do this.\n        self.graphie = graphie;\n        self.graphie.pics = [];\n        self.graphie.dotTicks = [];\n\n        var isBar = self.props.type === BAR,\n            isLine = self.props.type === LINE,\n            isPic = self.props.type === PIC,\n            isHistogram = self.props.type === HISTOGRAM,\n            isDotplot = self.props.type === DOTPLOT;\n\n        var isTiledPlot = isPic || isDotplot;\n\n        var config = {};\n        var c = config; // c for short\n\n        const isMobile = this.props.apiOptions.isMobile;\n\n        c.graph = {\n            lines: [],\n            bars: [],\n            points: [],\n            dividers: [],\n        };\n        c.scaleY = self.props.scaleY;\n        c.dimX = self.props.categories.length;\n        var plotDimensions = isMobile ? [288, 336] : self.props.plotDimensions;\n        if (isLine) {\n            // Subtracting 0.2 makes line have equal padding on each side\n            c.dimX += isMobile ? -0.2 : 1;\n        } else if (isHistogram) {\n            c.barPad = 0;\n            c.barWidth = 1;\n        } else if (isBar) {\n            c.barPad = isMobile ? 0.08 : 0.15;\n            c.barWidth = 1 - 2 * c.barPad;\n            c.dimX += (isMobile ? -2 : 2) * c.barPad;\n        } else if (isTiledPlot) {\n            c.picBoxHeight = self.props.picBoxHeight;\n            c.picBoxWidthPx = plotDimensions[0] / self.props.categories.length;\n            var picPadAllWidth = plotDimensions[0] - c.dimX * c.picBoxWidthPx;\n            c.picPad = picPadAllWidth / (2 * c.dimX + 2);\n            var picFullWidth = c.picBoxWidthPx + 2 * c.picPad;\n\n            // Convert from px to \"unscaled\"\n            c.picPad = c.picPad / picFullWidth;\n            c.picBoxWidth = c.picBoxWidthPx / picFullWidth;\n            c.dimX += 2 * c.picPad;\n        }\n\n        if (isDotplot) {\n            c.picBoxHeight =\n                this.DOT_PLOT_POINT_SIZE() * 2 + this.DOT_PLOT_POINT_PADDING();\n        }\n\n        c.dimY = Math.ceil(self.props.maxY / c.scaleY) * c.scaleY;\n\n        var padX = 25;\n        var padY = 25;\n\n        if ((isBar || isLine) && isMobile) {\n            padX = self.props.labels[1].length !== 0 ? 17 : 11;\n        }\n\n        // Since dotplot doesn't have an axis along the left it looks weird\n        // with the same padding as the others\n        if (isDotplot) {\n            padX /= 2;\n        }\n\n        if (isMobile && isTiledPlot && self.props.labels[1].length === 0) {\n            padX = 0;\n        }\n\n        if (isMobile) {\n            c.scale = _.map(\n                [[c.dimX, padX], [c.dimY, padY]],\n                // We multiply pad by 4 because we add 3*pad padding on the left\n                // and 1*pad on the right\n                ([dim, pad], i) => (plotDimensions[i] - pad * 4) / dim\n            );\n        } else {\n            c.scale = _.map([c.dimX, c.dimY], function(dim, i) {\n                return plotDimensions[i] / dim;\n            });\n        }\n\n        padX /= c.scale[0];\n        padY /= c.scale[1];\n\n        if (isTiledPlot) {\n            c.scale[1] = c.picBoxHeight / c.scaleY;\n        }\n\n        graphie.init({\n            range: [[-3 * padX, c.dimX + padX], [-3 * padY, c.dimY + padY]],\n            scale: c.scale,\n            isMobile: this.props.apiOptions.isMobile,\n        });\n        graphie.addMouseLayer({\n            allowScratchpad: true,\n            setDrawingAreaAvailable: this.props.apiOptions\n                .setDrawingAreaAvailable,\n        });\n\n        if (!isTiledPlot) {\n            // If we have isMobile, we skip the 0 label.\n            const initialY = isMobile ? c.scaleY : 0;\n            for (var y = initialY; y <= c.dimY; y += c.scaleY) {\n                graphie.label(\n                    [0, y],\n                    KhanMath.roundToApprox(y, 2),\n                    \"left\",\n                    /* isTeX */ true /* for the \\approx symbol */\n                );\n                graphie.style(\n                    {\n                        stroke: isMobile ? \"#e9ebec\" : \"#000\",\n                        strokeWidth: 1,\n                        opacity: isMobile ? 1 : 0.3,\n                    },\n                    function() {\n                        graphie.line([0, y], [c.dimX, y]);\n                    }\n                );\n            }\n        }\n\n        if ((isBar || isLine) && isMobile) {\n            self.graphie.dragPrompt = graphie\n                .label(\n                    [c.dimX / 2, c.dimY / 2],\n                    \"Drag handles to make graph\",\n                    \"center\",\n                    false\n                )\n                .css(\"font-weight\", \"bold\")\n                .css(\"color\", KhanColors.KA_GREEN)\n                .css(\"display\", \"none\");\n        }\n\n        self.setupCategories(config);\n\n        if (isTiledPlot && isMobile) {\n            self.graphie.dotPrompt = graphie\n                .label(\n                    [c.dimX / 2, c.dimY / 2],\n                    \"Tap to add points\",\n                    \"center\",\n                    false\n                )\n                .css(\"font-weight\", \"bold\")\n                .css(\"color\", KhanColors.KA_GREEN)\n                .css(\"display\", \"none\");\n        }\n\n        if (isTiledPlot) {\n            self.drawPicHeights(self.state.values, prevState.values);\n        }\n\n        graphie.style(\n            {stroke: \"#000\", strokeWidth: 2, opacity: 1.0},\n            function() {\n                if (isTiledPlot) {\n                    if (isDotplot) {\n                        // Dotplot is a subtype of tiled plot, here we only draw\n                        // the x-axis\n                        graphie.style(\n                            {\n                                stroke: isMobile ? KhanColors.GRAY_G : \"#000\",\n                                strokeWidth: isMobile ? 1 : 2,\n                            },\n                            () => graphie.line(\n                                [isMobile ? 0 : 0.5, 0],\n                                [c.dimX - (isMobile ? 0 : 0.5), 0]\n                            )\n                        );\n                    } else {\n                        graphie.line([0, 0], [c.dimX, 0]);\n\n                        // Draw the left axis for non-dotplots\n                        if (self.props.labels[1].length !== 0 || !isMobile) {\n                            graphie.style(\n                                {\n                                    stroke: isMobile\n                                        ? KhanColors.GRAY_G\n                                        : \"#000\",\n                                    strokeWidth: isMobile ? 1 : 2,\n                                },\n                                () => graphie.line([0, 0], [0, c.dimY])\n                            );\n                        }\n                    }\n                } else {\n                    // Draw normal axes\n                    graphie.style(\n                        {\n                            stroke: isMobile ? KhanColors.GRAY_G : \"#000\",\n                            strokeWidth: isMobile ? 1 : 2,\n                        },\n                        () => graphie.line(\n                            [isMobile ? -padX * 3 : 0, 0],\n                            [c.dimX + (isMobile ? padX : 0), 0]\n                        )\n                    );\n\n                    if (!((isBar || isLine) && isMobile)) {\n                        graphie.style(\n                            {\n                                stroke: isMobile ? KhanColors.GRAY_G : \"#000\",\n                                strokeWidth: isMobile ? 1 : 2,\n                            },\n                            () => graphie.line([0, 0], [0, c.dimY])\n                        );\n                    }\n                }\n            }\n        );\n\n        graphie\n            .label(\n                [c.dimX / 2, isMobile ? -padY * 3 : -35 / c.scale[1]],\n                self.props.labels[0],\n                isMobile ? \"above\" : \"below\",\n                false\n            )\n            .css(\"font-weight\", \"bold\")\n            .css(\"color\", isMobile && KhanColors.GRAY_F);\n\n        graphie\n            .label(\n                [(isMobile ? -35 : -60) / c.scale[0], c.dimY / 2],\n                self.props.labels[1],\n                \"center\",\n                false\n            )\n            .css(\"font-weight\", \"bold\")\n            .css(\"color\", isMobile && KhanColors.GRAY_F)\n            .addClass(\"rotate\");\n\n        if (this.props.apiOptions.isMobile) {\n            this.horizHairline = new WrappedLine(this.graphie, [0, 0], [0, 0], {\n                normalStyle: {\n                    strokeWidth: 1,\n                },\n            });\n\n            this.horizHairline.attr({\n                stroke: KhanColors.INTERACTIVE,\n            });\n            this.horizHairline.hide();\n\n            this.hairlineRange = [[0, c.dimX], [0, c.dimY]];\n        }\n    },\n\n    showHairlines: function(point) {\n        if (this.props.apiOptions.isMobile && this.props.markings !== \"none\") {\n            // Hairlines are already initialized when the graph is loaded, so\n            // here we just move them to the updated location and make them\n            // visible.\n            this.horizHairline.moveTo(\n                [this.hairlineRange[0][0], point[1]],\n                [this.hairlineRange[0][1], point[1]]\n            );\n\n            this.horizHairline.show();\n        }\n    },\n\n    hideHairlines: function() {\n        if (this.props.apiOptions.isMobile) {\n            this.horizHairline.hide();\n        }\n    },\n\n    labelCategory: function(x, category) {\n        const isMobile = this.props.apiOptions.isMobile;\n\n        var graphie = this.graphie;\n        category = category + \"\";\n        var isTeX = false;\n        var mathyCategory = category.match(/^\\$(.*)\\$$/);\n        if (mathyCategory) {\n            category = mathyCategory[1];\n            isTeX = true;\n        }\n\n        const hasXLabel = this.props.labels[0].length !== 0;\n\n        const labelRotation =\n            \"translateX(-50%) translateX(5px) \" +\n            \"translateY(-50%) rotate(-45deg)\";\n        graphie.style(\n            {\n                color: isMobile ? KhanColors.GRAY_G : \"inherit\",\n                transform: isMobile && !mathyCategory ? labelRotation : \"none\",\n                transformOrigin: \"100%\",\n            },\n            () => graphie.label(\n                [x, isMobile ? -0.5 : 0],\n                category,\n                \"below\",\n                isTeX\n            )\n        );\n    },\n\n    setupCategories: function(config) {\n        var self = this;\n        var c = config;\n        var graphie = self.graphie;\n\n        const isMobile = this.props.apiOptions.isMobile;\n\n        if (self.props.type === HISTOGRAM) {\n            // Histograms with n labels/categories have n - 1 buckets\n            _.times(self.props.categories.length - 1, function(i) {\n                self.setupBar({\n                    index: i,\n                    startHeight: self.state.values[i],\n                    config: config,\n                    isHistogram: true,\n                });\n            });\n\n            // Label categories\n            _.each(self.props.categories, function(category, i) {\n                var x = 0.5 + i * c.barWidth;\n\n                self.labelCategory(x, category);\n                var tickHeight = 6 / c.scale[1];\n                graphie.style(\n                    {\n                        stroke: \"#000\",\n                        strokeWidth: isMobile ? 1 : 2,\n                        opacity: 1.0,\n                    },\n                    function() {\n                        graphie.line([x, -tickHeight], [x, 0]);\n                    }\n                );\n            });\n        } else {\n            _.each(self.props.categories, function(category, i) {\n                var startHeight = self.state.values[i];\n                var x;\n\n                if (self.props.type === BAR) {\n                    x = self.setupBar({\n                        index: i,\n                        startHeight: startHeight,\n                        config: config,\n                        isHistogram: false,\n                    });\n                } else if (self.props.type === LINE) {\n                    x = self.setupLine(i, startHeight, config);\n                } else if (self.props.type === PIC) {\n                    x = self.setupPic(i, config);\n                } else if (self.props.type === DOTPLOT) {\n                    x = self.setupDotplot(i, config);\n                }\n\n                var tickStart = 0;\n                var tickEnd = -6 / c.scale[1];\n\n                if (self.props.type === DOTPLOT && !isMobile) {\n                    tickStart = -tickEnd;\n                }\n\n                if (self.props.type === DOTPLOT) {\n                    // Dotplot lets you specify to only show labels every 'n'\n                    // ticks. It also looks nicer if it makes the labelled\n                    // ticks a bit bigger.\n                    if (\n                        i % self.props.labelInterval === 0 ||\n                        i === self.props.categories.length - 1\n                    ) {\n                        self.labelCategory(x, category);\n                        tickStart *= 1.5;\n                        tickEnd *= 1.5;\n                    }\n                } else {\n                    self.labelCategory(x, category);\n                }\n\n                graphie.style(\n                    {\n                        stroke: isMobile ? KhanColors.GRAY_G : \"#000\",\n                        strokeWidth: isMobile ? 1 : 2,\n                        opacity: 1.0,\n                    },\n                    function() {\n                        graphie.line([x, tickStart], [x, tickEnd]);\n                    }\n                );\n            });\n        }\n    },\n\n    _clampValue: function(v, min, max) {\n        return Math.max(Math.min(v, max), min);\n    },\n\n    _maybeShowDragPrompt: function() {\n        // The drag prompt is only added on certain types of plots.\n        if (this.graphie.dragPrompt != null) {\n            this.graphie.dragPrompt[0].style.display = \"inline\";\n        }\n    },\n\n    _maybeHideDragPrompt: function() {\n        // The drag prompt is only added on certain types of plots.\n        if (this.graphie.dragPrompt != null) {\n            this.graphie.dragPrompt[0].style.display = \"none\";\n        }\n    },\n\n    setupBar: function(args) {\n        const isMobile = this.props.apiOptions.isMobile;\n\n        var i = args.index;\n        var startHeight = args.startHeight;\n        var config = args.config;\n        var isHistogram = args.isHistogram;\n\n        var self = this;\n        var graphie = self.graphie;\n        var barHalfWidth = config.barWidth / 2;\n        var x;\n        if (isHistogram) {\n            x = 0.5 + i * config.barWidth + barHalfWidth;\n        } else {\n            x = (isMobile ? barHalfWidth : 0.5 + config.barPad) + i;\n        }\n\n        /**\n         * Updates the bar with given index to the given height\n         * @param i the index of the bar to update\n         * @param height the new height of the bar\n         */\n        var scaleBar = function(i, height) {\n            var center = graphie.scalePoint(0);\n\n            // Scale filled bucket (bar)\n            config.graph.bars[i].scale(\n                1,\n                Math.max(isMobile ? 0.2 : 0.01, height / config.scaleY),\n                center[0],\n                center[1]\n            );\n\n            if (isHistogram) {\n                // Scale dividers between buckets\n                var leftDivider = config.graph.dividers[i - 1],\n                    rightDivider = config.graph.dividers[i];\n\n                if (leftDivider) {\n                    var divHeight = Math.min(self.state.values[i - 1], height);\n                    leftDivider.scale(\n                        1,\n                        Math.max(0.01, divHeight / config.scaleY),\n                        center[0],\n                        center[1]\n                    );\n                }\n\n                if (rightDivider) {\n                    var divHeight = Math.min(self.state.values[i + 1], height);\n                    rightDivider.scale(\n                        1,\n                        Math.max(0.01, divHeight / config.scaleY),\n                        center[0],\n                        center[1]\n                    );\n                }\n            }\n        };\n\n        graphie.style(\n            {\n                stroke: \"none\",\n                fill: isMobile ? KhanColors.BLUE_C : KhanColors.LIGHT_BLUE,\n                opacity: 1.0,\n            },\n            function() {\n                config.graph.bars[i] = graphie.path([\n                    [x - barHalfWidth, 0],\n                    [x - barHalfWidth, config.scaleY],\n                    [x + barHalfWidth, config.scaleY],\n                    [x + barHalfWidth, 0],\n                    [x - barHalfWidth, 0],\n                ]);\n            }\n        );\n\n        if (isHistogram) {\n            if (i > 0) {\n                // Don't draw a divider to the left of the first bucket\n                graphie.style(\n                    {\n                        stroke: \"#000\",\n                        strokeWidth: 1,\n                        opacity: 0.3,\n                    },\n                    function() {\n                        config.graph.dividers.push(\n                            graphie.path([\n                                [x - barHalfWidth, 0],\n                                [x - barHalfWidth, config.scaleY],\n                            ])\n                        );\n                    }\n                );\n            }\n        }\n\n        if (isMobile) {\n            const snap = config.scaleY / self.props.snapsPerLine;\n            config.graph.lines[\n                i\n            ] = Interactive2.addMaybeMobileMovablePoint(this, {\n                coord: [x, startHeight],\n                constraints: [\n                    (coord, prev, options) => {\n                        return [\n                            x,\n                            this._clampValue(\n                                Math.round(coord[1] / snap) * snap,\n                                0,\n                                config.dimY\n                            ),\n                        ];\n                    },\n                ],\n                onMoveStart: function() {\n                    config.graph.bars[i].attr({\n                        fill: KhanColors.INTERACTIVE,\n                    });\n                },\n                onMove: function() {\n                    const y = config.graph.lines[i].coord()[1];\n\n                    var values = _.clone(self.state.values);\n                    values[i] = y;\n                    self.setState({values: values});\n                    self.changeAndTrack({values: values});\n\n                    self._maybeHideDragPrompt();\n\n                    scaleBar(i, y);\n                },\n                onMoveEnd: function() {\n                    config.graph.bars[i].attr({\n                        fill: KhanColors.BLUE_C,\n                    });\n                },\n            });\n\n            // We set the z-index to 1 here so that the hairlines cover up the\n            // points\n            config.graph.lines[i].state.visibleShape.wrapper.style.zIndex = \"1\";\n\n            self._maybeShowDragPrompt();\n        } else {\n            config.graph.lines[i] = graphie.addMovableLineSegment({\n                coordA: [x - barHalfWidth, startHeight],\n                coordZ: [x + barHalfWidth, startHeight],\n                snapY: config.scaleY / self.props.snapsPerLine,\n                constraints: {\n                    constrainX: true,\n                },\n                normalStyle: {\n                    stroke: KhanColors.INTERACTIVE,\n                    // Don't display graph handles in static mode\n                    \"stroke-width\": this.props.static ? 0 : 4,\n                },\n            });\n\n            config.graph.lines[i].onMove = function(dx, dy) {\n                var y = this.coordA[1];\n                if (y < 0 || y > config.dimY) {\n                    y = Math.min(Math.max(y, 0), config.dimY);\n                    this.coordA[1] = this.coordZ[1] = y;\n\n                    // Snap the line back into range.\n                    this.transform();\n                }\n\n                var values = _.clone(self.state.values);\n                values[i] = y;\n                self.setState({values: values});\n                self.changeAndTrack({values: values});\n\n                scaleBar(i, y);\n            };\n        }\n\n        scaleBar(i, startHeight);\n        return x;\n    },\n\n    /**\n     * Renders a segment of an interactive line to the plotter graph\n     * @param i the index of the point to render\n     * @param startHeight the initial height of the given point\n     * @param config the graph setup, such as scale and dimensions\n     */\n    setupLine: function(i, startHeight, config) {\n        const isMobile = this.props.apiOptions.isMobile;\n\n        var self = this;\n        var c = config;\n        var graphie = self.graphie;\n        var x = i + (isMobile ? 0.4 : 1);\n\n        if (isMobile) {\n            const snap = config.scaleY / self.props.snapsPerLine;\n            c.graph.points[i] = Interactive2.addMaybeMobileMovablePoint(this, {\n                coord: [x, startHeight],\n                constraints: [\n                    (coord, prev, options) => {\n                        return [\n                            x,\n                            this._clampValue(\n                                Math.round(coord[1] / snap) * snap,\n                                0,\n                                config.dimY\n                            ),\n                        ];\n                    },\n                ],\n                onMove: function() {\n                    const y = c.graph.points[i].coord()[1];\n\n                    var values = _.clone(self.state.values);\n                    values[i] = y;\n                    self.setState({values: values});\n                    self.changeAndTrack({values: values});\n\n                    self._maybeHideDragPrompt();\n                },\n            });\n\n            self._maybeShowDragPrompt();\n\n            if (i > 0) {\n                c.graph.lines[i] = Interactive2.addMovableLine(graphie, {\n                    points: [c.graph.points[i - 1], c.graph.points[i]],\n                    constraints: Interactive2.MovablePoint.constraints.fixed(),\n                    normalStyle: {\n                        stroke: KhanColors.BLUE_C,\n                        \"stroke-width\": 2,\n                    },\n                    highlightStyle: {\n                        stroke: KhanColors.BLUE_C,\n                        \"stroke-width\": 2,\n                    },\n                });\n            }\n        } else {\n            c.graph.points[i] = graphie.addMovablePoint({\n                coord: [x, startHeight],\n                constraints: {\n                    constrainX: true,\n                },\n                normalStyle: {\n                    fill: KhanColors.INTERACTIVE,\n                    stroke: KhanColors.INTERACTIVE,\n                },\n                snapY: c.scaleY / self.props.snapsPerLine,\n            });\n            c.graph.points[i].onMove = function(x, y) {\n                y = Math.min(Math.max(y, 0), c.dimY);\n                var values = _.clone(self.state.values);\n                values[i] = y;\n                self.setState({values: values});\n                self.changeAndTrack({values: values});\n                return [x, y];\n            };\n\n            if (i > 0) {\n                c.graph.lines[i] = graphie.addMovableLineSegment({\n                    pointA: c.graph.points[i - 1],\n                    pointZ: c.graph.points[i],\n                    constraints: {\n                        fixed: true,\n                    },\n                    normalStyle: {\n                        stroke: \"#9ab8ed\",\n                        \"stroke-width\": 2,\n                    },\n                });\n            }\n        }\n\n        return x;\n    },\n\n    setupDotplot: function(i, config) {\n        var graphie = this.graphie;\n        const isMobile = this.props.apiOptions.isMobile;\n\n        return this.setupTiledPlot(i, isMobile ? 0.5 : 1, config, (x, y) => {\n            return graphie.ellipse(\n                [x, y],\n                [\n                    this.DOT_PLOT_POINT_SIZE() / graphie.scale[0],\n                    this.DOT_PLOT_POINT_SIZE() / graphie.scale[1],\n                ],\n                {\n                    fill: KhanColors.INTERACTIVE,\n                    stroke: KhanColors.INTERACTIVE,\n                }\n            );\n        });\n    },\n\n    setupPic: function(i, config) {\n        var graphie = this.graphie;\n        return this.setupTiledPlot(i, 0, config, (x, y) => {\n            var scaledCenter = graphie.scalePoint([x, y]);\n            var size = this.props.picSize;\n            return graphie.raphael.image(\n                this.props.picUrl,\n                scaledCenter[0] - size / 2,\n                scaledCenter[1] - size / 2,\n                size,\n                size\n            );\n        });\n    },\n\n    setupTiledPlot: function(i, bottomMargin, config, createImage) {\n        var self = this;\n        var c = config;\n        var graphie = self.graphie;\n        var pics = graphie.pics;\n        var dotTicks = graphie.dotTicks;\n        var x = i + 0.5 + c.picPad;\n\n        // In order to make sure that manipulating the graph doesn't cause\n        // dragging, we disable touch actions for the whole mouselayer.\n        // TODO(emily): Figure out a way to turn of touch actions for only the\n        // part of the widget that can be manipulated. Putting this style\n        // directly on the rects below doesn't work.\n        graphie.mouselayer.canvas.style.touchAction = \"none\";\n\n        pics[i] = [];\n        dotTicks[i] = [];\n        var n = Math.round(c.dimY / c.scaleY) + 1;\n        _.times(n, function(j) {\n            j -= 1;\n            var midY = (j + 0.5) * c.scaleY;\n            var leftX = x - c.picBoxWidth / 2;\n            var topY = midY + 0.5 * c.scaleY;\n            var coord = graphie.scalePoint([leftX, topY + bottomMargin]);\n            var mouseRect = graphie.mouselayer.rect(\n                coord[0],\n                coord[1],\n                c.picBoxWidthPx,\n                c.picBoxHeight\n            );\n            $(mouseRect[0])\n                .css({fill: \"#000\", opacity: 0.0, cursor: \"pointer\"})\n                .on(\"vmousedown\", function(e) {\n                    e.preventDefault();\n                    self.whichPicClicked = i;\n                    self.setPicHeight(i, topY);\n\n                    $(document).on(\"vmouseup.plotTile\", function(e) {\n                        $(document).unbind(\".plotTile\");\n                    });\n\n                    $(document).on(\"vmousemove.plotTile\", function(e) {\n                        e.preventDefault();\n\n                        // Reverse-engineer the initial calculation\n                        var yCoord = graphie.getMouseCoord(e)[1];\n                        var adjustedCoord = Math.floor(yCoord - bottomMargin);\n\n                        // Calculate top coord from j value, but don't let them\n                        // go below j = -1, which is equivalent to having '0'\n                        // on the dot plot (due to weird indexing).\n                        var newJ = Math.max(\n                            -1,\n                            Math.floor(adjustedCoord / c.scaleY)\n                        );\n                        var newMidY = (newJ + 0.5) * c.scaleY;\n                        var newTopY = newMidY + 0.5 * c.scaleY;\n                        self.setPicHeight(self.whichPicClicked, newTopY);\n                    });\n                });\n\n            if (j < 0) {\n                // Don't show a pic underneath the axis!\n                return;\n            }\n            pics[i][j] = createImage(x, midY + bottomMargin);\n            dotTicks[i][j] = graphie.ellipse(\n                [x, midY + bottomMargin],\n                [\n                    self.DOT_TICK_POINT_SIZE() / graphie.scale[0],\n                    self.DOT_TICK_POINT_SIZE() / graphie.scale[1],\n                ],\n                {\n                    fill: \"#dee1e3\",\n                    stroke: \"#dee1e3\",\n                }\n            );\n        });\n        return x;\n    },\n\n    setPicHeight: function(i, y) {\n        var values = _.clone(this.state.values);\n        values[i] = y;\n        this.drawPicHeights(values, this.state.values);\n        this.setState({values: values});\n        this.changeAndTrack({values: values});\n    },\n\n    changeAndTrack: function(data) {\n        this.props.onChange(data);\n        this.props.trackInteraction();\n    },\n\n    drawPicHeights: function(values, prevValues) {\n        var self = this;\n        var graphie = self.graphie;\n        var pics = graphie.pics;\n\n        const isMobile = this.props.apiOptions.isMobile;\n\n        if (isMobile) {\n            const shouldDisplay = values.every(v => v === 0);\n            graphie.dotPrompt[0].style.display = shouldDisplay\n                ? \"inline\"\n                : \"none\";\n        }\n\n        _.each(pics, function(ps, i) {\n            _.each(ps, function(pic, j) {\n                var y = (j + 1) * self.props.scaleY;\n                var show = y <= values[i];\n\n                if (self.props.type === DOTPLOT) {\n                    var wasShown = y <= prevValues[i];\n                    var wasJustShown = show && !wasShown;\n                    if (wasJustShown) {\n                        pic.animate(\n                            {\n                                \"stroke-width\": 8,\n                            },\n                            75,\n                            () => pic.animate(\n                                {\n                                    \"stroke-width\": 2,\n                                },\n                                75\n                            )\n                        );\n                    }\n                }\n                $(pic[0]).css({display: show ? \"inline\" : \"none\"});\n\n                graphie.dotTicks[i][j][0].style.display =\n                    show || !isMobile ? \"none\" : \"inline\";\n            });\n        });\n    },\n\n    getUserInput: function() {\n        return this.state.values;\n    },\n\n    simpleValidate: function(rubric) {\n        return Plotter.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Plotter, {\n    validate: function(guess, rubric) {\n        if (deepEq(guess, rubric.starting)) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: deepEq(guess, rubric.correct) ? 1 : 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n// We don't need to change any of the original props for static mode\nvar staticTransform = _.identity;\n\n_module_.exports = {\n    name: \"plotter\",\n    displayName: \"Plotter\",\n    widget: Plotter,\n    staticTransform: staticTransform,\n};\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _plotterJsx from \"./plotter.jsx\";\nimport _componentsTextListEditorJsx from \"../components/text-list-editor.jsx\";\nimport _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, max-len, no-var, one-var, react/jsx-closing-bracket-location, react/sort-comp, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst BlurInput = _reactComponentsBlurInputJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst RangeInput = _componentsRangeInputJsx;\nconst SvgImage = _componentsSvgImageJsx;\nconst TextListEditor = _componentsTextListEditorJsx;\n\nconst Plotter = _plotterJsx.widget;\n\nconst knumber = _kmath.number;\n\nconst BAR = \"bar\",\n    LINE = \"line\",\n    PIC = \"pic\",\n    HISTOGRAM = \"histogram\",\n    DOTPLOT = \"dotplot\";\n\n// Return a copy of array with length n, padded with given value\nfunction padArray(array, n, value) {\n    var copy = _.clone(array);\n    copy.length = n;\n    for (var i = array.length; i < n; i++) {\n        copy[i] = value;\n    }\n    return copy;\n}\n\nconst editorDefaults = {\n    scaleY: 1,\n    maxY: 10,\n    snapsPerLine: 2,\n};\n\nconst widgetPropTypes = {\n    type: PropTypes.oneOf([BAR, LINE, PIC, HISTOGRAM, DOTPLOT]),\n    labels: PropTypes.arrayOf(PropTypes.string),\n    categories: PropTypes.arrayOf(\n        PropTypes.oneOfType([\n            PropTypes.number,\n            PropTypes.string,\n        ])\n    ),\n\n    scaleY: PropTypes.number,\n    maxY: PropTypes.number,\n    snapsPerLine: PropTypes.number,\n\n    picSize: PropTypes.number,\n    pixBoxHeight: PropTypes.number,\n    picUrl: PropTypes.string,\n\n    plotDimensions: PropTypes.arrayOf(PropTypes.number),\n    labelInterval: PropTypes.number,\n    starting: PropTypes.arrayOf(PropTypes.number),\n    correct: PropTypes.arrayOf(PropTypes.number),\n    static: PropTypes.bool,\n    onChange: PropTypes.func,\n};\n\nvar formatNumber = num => \"$\" + knumber.round(num, 2) + \"$\";\n\nconst PlotterEditor = createReactClass({\n    propTypes: widgetPropTypes,\n\n    getDefaultProps: function() {\n        return _.extend({}, editorDefaults, {\n            correct: [1],\n            starting: [1],\n\n            type: BAR,\n            labels: [\"\", \"\"],\n            categories: [\"\"],\n\n            picSize: 30,\n            picBoxHeight: 36,\n            picUrl: Khan.imageBase + \"badges/earth-small.png\",\n\n            plotDimensions: [275, 200],\n            labelInterval: 1,\n        });\n    },\n\n    getInitialState: function() {\n        return {\n            editing: \"correct\",\n            pic: null,\n            loadedUrl: null,\n            minX: null,\n            maxX: null,\n            tickStep: null,\n        };\n    },\n\n    componentWillMount: function() {\n        this.fetchPic(this.props.picUrl);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.fetchPic(nextProps.picUrl);\n    },\n\n    fetchPic: function(url) {\n        if (this.state.loadedUrl !== url) {\n            var pic = new Image();\n            pic.src = url;\n            pic.onload = () => {\n                this.setState({\n                    pic: pic,\n                    loadedUrl: url,\n                });\n            };\n        }\n    },\n\n    render: function() {\n        var setFromScale = _.contains(\n            [LINE, HISTOGRAM, DOTPLOT],\n            this.props.type\n        );\n        var canChangeSnaps = !_.contains([PIC, DOTPLOT], this.props.type);\n        var props = {\n            trackInteraction: () => {},\n            ...this.props,\n        };\n\n        return (\n            <div className=\"perseus-widget-plotter-editor\">\n                <div>\n                    Chart type:{\" \"}\n                    {_.map(\n                        [BAR, LINE, PIC, HISTOGRAM, DOTPLOT],\n                        function(type) {\n                            return (\n                                <label key={type}>\n                                    <input\n                                        type=\"radio\"\n                                        name=\"chart-type\"\n                                        checked={this.props.type === type}\n                                        onChange={_.partial(\n                                            this.changeType,\n                                            type\n                                        )}\n                                    />\n                                    {type}\n                                </label>\n                            );\n                        },\n                        this\n                    )}\n                </div>\n                <div>\n                    Labels:{\" \"}\n                    {_.map(\n                        [\"x\", \"y\"],\n                        function(axis, i) {\n                            return (\n                                <label key={axis}>\n                                    {axis + \":\"}\n                                    <input\n                                        type=\"text\"\n                                        onChange={_.partial(\n                                            this.changeLabel,\n                                            i\n                                        )}\n                                        defaultValue={this.props.labels[i]}\n                                    />\n                                </label>\n                            );\n                        },\n                        this\n                    )}\n                </div>\n\n                {setFromScale &&\n                    <div className=\"set-from-scale-box\">\n                        <span className=\"categories-title\">\n                            Set Categories From Scale\n                        </span>\n                        <div>\n                            <label>\n                                Tick Step:{\" \"}\n                                <NumberInput\n                                    placeholder={1}\n                                    useArrowKeys={true}\n                                    value={this.state.tickStep}\n                                    onChange={this.handleChangeTickStep}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>The difference between adjacent ticks.</p>\n                            </InfoTip>\n                        </div>\n                        <div>\n                            <label>\n                                Range:{\" \"}\n                                <RangeInput\n                                    placeholder={[0, 10]}\n                                    useArrowKeys={true}\n                                    value={[this.state.minX, this.state.maxX]}\n                                    onChange={this.handleChangeRange}\n                                />\n                            </label>\n                        </div>\n                        <div>\n                            <button onClick={this.setCategoriesFromScale}>\n                                Set Categories{\" \"}\n                            </button>\n                        </div>\n                    </div>}\n                <div>\n                    <label>\n                        Label Interval:{\" \"}\n                        <NumberInput\n                            useArrowKeys={true}\n                            value={this.props.labelInterval}\n                            onChange={this.changeLabelInterval}\n                        />\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Which ticks to display the labels for. For instance,\n                            setting this to \"4\" will only show every 4th label\n                            (plus the last one)\n                        </p>\n                    </InfoTip>\n                </div>\n                {this.props.type === PIC &&\n                    <div>\n                        <label>\n                            Picture:{\" \"}\n                            <BlurInput\n                                className=\"pic-url\"\n                                value={this.props.picUrl}\n                                onChange={this.changePicUrl}\n                            />\n                            <InfoTip>\n                                <p>\n                                    Use the default picture of Earth, or insert\n                                    the URL for a different picture using the\n                                    \"Add image\" function.\n                                </p>\n                            </InfoTip>\n                        </label>\n                        {this.state.pic &&\n                            this.state.pic.width !== this.state.pic.height &&\n                            <p className=\"warning\">\n                                <b>Warning</b>: You are using a picture which is\n                                not square. This means the image will get\n                                distorted. You should probably crop it to be\n                                square.\n                            </p>}\n                    </div>}\n                <div>\n                    <label>\n                        Categories:{\" \"}\n                        <TextListEditor\n                            ref=\"categories\"\n                            layout=\"horizontal\"\n                            options={this.props.categories}\n                            onChange={this.changeCategories}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Scale (y):{\" \"}\n                        <input\n                            type=\"text\"\n                            onChange={this.changeScale}\n                            defaultValue={this.props.scaleY}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Max y:{\" \"}\n                        <input\n                            type=\"text\"\n                            ref=\"maxY\"\n                            onChange={this.changeMax}\n                            defaultValue={this.props.maxY}\n                        />\n                    </label>\n                </div>\n                {canChangeSnaps &&\n                    <div>\n                        <label>\n                            Snaps per line:{\" \"}\n                            <input\n                                type=\"text\"\n                                onChange={this.changeSnaps}\n                                defaultValue={this.props.snapsPerLine}\n                            />\n                        </label>\n                        <InfoTip>\n                            <p>\n                                Creates the specified number of divisions\n                                between the horizontal lines. Fewer snaps\n                                between lines makes the graph easier for the\n                                student to create correctly.\n                            </p>\n                        </InfoTip>\n                    </div>}\n                <div>\n                    Editing values:{\" \"}\n                    {_.map(\n                        [\"correct\", \"starting\"],\n                        function(editing) {\n                            return (\n                                <label key={editing}>\n                                    <input\n                                        type=\"radio\"\n                                        name=\"editing\"\n                                        checked={this.state.editing === editing}\n                                        onChange={_.partial(\n                                            this.changeEditing,\n                                            editing\n                                        )}\n                                    />\n                                    {editing}\n                                </label>\n                            );\n                        },\n                        this\n                    )}\n                    <InfoTip>\n                        <p>\n                            Use this toggle to switch between editing the\n                            correct answer (what the student will be graded on)\n                            and the starting values (what the student will see\n                            plotted when they start the problem). Note: These\n                            cannot be the same.\n                        </p>\n                        <p>\n                            In static mode, the starting values are rendered out\n                            to the displayed widget.\n                        </p>\n                    </InfoTip>\n                </div>\n                <Plotter\n                    {...props}\n                    starting={this.props[this.state.editing]}\n                    onChange={this.handlePlotterChange}\n                />\n            </div>\n        );\n    },\n\n    handleChangeTickStep: function(value) {\n        this.setState({\n            tickStep: value,\n        });\n    },\n\n    handleChangeRange: function(newValue) {\n        this.setState({\n            minX: newValue[0],\n            maxX: newValue[1],\n        });\n    },\n\n    changeLabelInterval: function(value) {\n        this.props.onChange({\n            labelInterval: value,\n        });\n    },\n\n    handlePlotterChange: function(newProps) {\n        var props = {};\n        props[this.state.editing] = newProps.values;\n        this.props.onChange(props);\n    },\n\n    changeType: function(type) {\n        var categories;\n        if (type === HISTOGRAM) {\n            // Switching to histogram, add a label (0) to the left\n            categories = [formatNumber(0)].concat(this.props.categories);\n            this.props.onChange({type: type, categories: categories});\n        } else if (this.props.type === HISTOGRAM) {\n            // Switching from histogram, remove a label from the left\n            categories = this.props.categories.slice(1);\n            this.props.onChange({type: type, categories: categories});\n        } else {\n            this.props.onChange({type: type});\n        }\n\n        if (categories) {\n            ReactDOM.findDOMNode(this.refs.categories).value = categories.join(\n                \", \"\n            );\n        }\n    },\n\n    changeLabel: function(i, e) {\n        var labels = _.clone(this.props.labels);\n        labels[i] = e.target.value;\n        this.props.onChange({labels: labels});\n    },\n\n    changePicUrl: function(value) {\n        // We don't need the labels and other data in the plotter, so just\n        // extract the raw image and use that.\n        // TODO(emily): Maybe indicate that such a change has happened?\n        var url = SvgImage.getRealImageUrl(value);\n\n        this.props.onChange({picUrl: url});\n    },\n\n    changeCategories: function(categories) {\n        var n = categories.length;\n        if (this.props.type === HISTOGRAM) {\n            // Histograms with n labels/categories have n - 1 buckets\n            n--;\n        }\n        var value = this.props.scaleY;\n\n        this.props.onChange({\n            categories: categories,\n            correct: padArray(this.props.correct, n, value),\n            starting: padArray(this.props.starting, n, value),\n        });\n    },\n\n    changeScale: function(e) {\n        var oldScale = this.props.scaleY;\n        var newScale = +e.target.value || editorDefaults.scaleY;\n\n        var scale = function(value) {\n            return value * newScale / oldScale;\n        };\n\n        var maxY = scale(this.props.maxY);\n\n        this.props.onChange({\n            scaleY: newScale,\n            maxY: maxY,\n            correct: _.map(this.props.correct, scale),\n            starting: _.map(this.props.starting, scale),\n        });\n\n        ReactDOM.findDOMNode(this.refs.maxY).value = maxY;\n    },\n\n    changeMax: function(e) {\n        this.props.onChange({\n            maxY: +e.target.value || editorDefaults.maxY,\n        });\n    },\n\n    changeSnaps: function(e) {\n        this.props.onChange({\n            snapsPerLine: +e.target.value || editorDefaults.snapsPerLine,\n        });\n    },\n\n    changeEditing: function(editing) {\n        this.setState({editing: editing});\n    },\n\n    setCategoriesFromScale: function() {\n        var scale = this.state.tickStep || 1;\n        var min = this.state.minX || 0;\n        var max = this.state.maxX || 0;\n        var length = Math.floor((max - min) / scale) * scale;\n\n        var categories;\n        if (this.props.type === HISTOGRAM || this.props.type === DOTPLOT) {\n            // Ranges for histogram and dotplot labels should start at zero\n            categories = _.range(0, length + scale, scale);\n        } else {\n            categories = _.range(scale, length + scale, scale);\n        }\n\n        categories = _.map(categories, num => num + min);\n        categories = _.map(categories, formatNumber);\n\n        this.changeCategories(categories);\n\n        ReactDOM.findDOMNode(this.refs.categories).value = categories.join(\n            \", \"\n        );\n    },\n\n    serialize: function() {\n        var json = _.pick(\n            this.props,\n            \"correct\",\n            \"starting\",\n            \"type\",\n            \"labels\",\n            \"categories\",\n            \"scaleY\",\n            \"maxY\",\n            \"snapsPerLine\",\n            \"labelInterval\"\n        );\n\n        if (this.props.type === PIC) {\n            json.picUrl = this.props.picUrl;\n        }\n\n        return json;\n    },\n});\n\n_module_.exports = PlotterEditor;\nexport default _module_.exports;\n","import _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst PassageRefTargetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        content: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div>\n                Content:\n                <input\n                    type=\"text\"\n                    value={this.props.content}\n                    onChange={this.handleContentChange}\n                />\n            </div>\n        );\n    },\n\n    handleContentChange: function(e) {\n        this.change({content: e.target.value});\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = PassageRefTargetEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\nvar Renderer = _rendererJsx;\n\nvar PassageRefTarget = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        content: PropTypes.string,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    render: function() {\n        return (\n            <Renderer\n                content={this.props.content}\n                inline={true}\n                apiOptions={this.props.apiOptions}\n                linterContext={this.props.linterContext}\n            />\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    simpleValidate: function(rubric) {\n        return PassageRefTarget.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(PassageRefTarget, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"passage-ref-target\",\n    displayName: \"PassageRefTarget\",\n    defaultAlignment: \"inline\",\n    widget: PassageRefTarget,\n    hidden: true,\n    transform: editorProps => {\n        return _.pick(editorProps, \"content\");\n    },\n    version: {major: 0, minor: 0},\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst TextInput = _componentsTextInputJsx;\n\nconst PassageRefEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        passageNumber: PropTypes.number,\n        referenceNumber: PropTypes.number,\n        summaryText: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            passageNumber: 1,\n            referenceNumber: 1,\n            summaryText: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <div>\n                    <label>\n                        {\"Passage Number: \"}\n                        <NumberInput\n                            value={this.props.passageNumber}\n                            onChange={this.change(\"passageNumber\")}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        {\"Reference Number: \"}\n                        <NumberInput\n                            value={this.props.referenceNumber}\n                            onChange={this.change(\"referenceNumber\")}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        {\"Summary Text: \"}\n                        <TextInput\n                            value={this.props.summaryText}\n                            onChange={this.change(\"summaryText\")}\n                        />\n                        <InfoTip>\n                            <p>\n                                Short summary of the referenced section. This\n                                will be included in parentheses and quotes\n                                automatically.\n                            </p>\n                            <p>Ex: The start ... the end</p>\n                        </InfoTip>\n                    </label>\n                </div>\n            </div>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = PassageRefEditor;\nexport default _module_.exports;\n","import _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _perseusMarkdownJsx from \"../perseus-markdown.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals $_ */\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar PerseusMarkdown = _perseusMarkdownJsx;\nvar WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\n\nvar EN_DASH = \"\\u2013\";\n\nvar PassageRef = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        passageNumber: PropTypes.number,\n        referenceNumber: PropTypes.number,\n        summaryText: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            passageNumber: 1,\n            referenceNumber: 1,\n            summaryText: \"\",\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            lineRange: null,\n            content: null,\n        };\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        return (\n            !_.isEqual(this.props, nextProps) ||\n            !_.isEqual(this.state, nextState)\n        );\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    render: function() {\n        var lineRange = this.state.lineRange;\n        var lineRangeOutput;\n        if (!lineRange) {\n            lineRangeOutput = $_(\n                {lineRange: `?${EN_DASH}?`},\n                \"lines %(lineRange)s\"\n            );\n        } else if (lineRange[0] === lineRange[1]) {\n            lineRangeOutput = $_(\n                {lineNumber: lineRange[0]},\n                \"line %(lineNumber)s\"\n            );\n        } else {\n            lineRangeOutput = $_(\n                {\n                    lineRange: lineRange[0] + EN_DASH + lineRange[1],\n                },\n                \"lines %(lineRange)s\"\n            );\n        }\n\n        var summaryOutput;\n        if (this.props.summaryText) {\n            var summaryTree = PerseusMarkdown.parseInline(\n                this.props.summaryText\n            );\n            summaryOutput = (\n                <span aria-hidden={true}>\n                    {\" \"}{/* curly quotes */}\n                    (&ldquo;\n                    {PerseusMarkdown.basicOutput(summaryTree)}\n                    &rdquo;)\n                </span>\n            );\n        } else {\n            summaryOutput = null;\n        }\n\n        return (\n            <span>\n                {lineRangeOutput}\n                {summaryOutput}\n                {lineRange &&\n                    <div className=\"perseus-sr-only\">\n                        {this.state.content}\n                    </div>}\n            </span>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    componentDidMount: function() {\n        this._deferredUpdateRange();\n\n        this._throttledUpdateRange = _.throttle(this._deferredUpdateRange, 500);\n        window.addEventListener(\"resize\", this._throttledUpdateRange);\n    },\n\n    componentDidUpdate: function() {\n        this._deferredUpdateRange();\n    },\n\n    componentWillUnmount: function() {\n        window.removeEventListener(\"resize\", this._throttledUpdateRange);\n    },\n\n    _deferredUpdateRange: function() {\n        _.defer(this._updateRange);\n    },\n\n    _updateRange: function() {\n        var passage = this.props.findWidgets(\n            \"passage \" + this.props.passageNumber\n        )[0];\n\n        var refInfo = null;\n        if (passage) {\n            refInfo = passage.getReference(this.props.referenceNumber);\n        }\n\n        if (this.isMounted()) {\n            if (refInfo) {\n                this.setState({\n                    lineRange: [refInfo.startLine, refInfo.endLine],\n                    content: refInfo.content,\n                });\n            } else {\n                this.setState({\n                    lineRange: null,\n                    content: null,\n                });\n            }\n        }\n    },\n\n    simpleValidate: function(rubric) {\n        return PassageRef.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(PassageRef, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"passage-ref\",\n    displayName: \"PassageRef (SAT only)\",\n    defaultAlignment: \"inline\",\n    widget: PassageRef,\n    transform: editorProps => {\n        return _.pick(\n            editorProps,\n            \"passageNumber\",\n            \"referenceNumber\",\n            \"summaryText\"\n        );\n    },\n    version: {major: 0, minor: 1},\n};\nexport default _module_.exports;\n","import _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst Editor = _editorJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\n\nconst PassageEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        passageTitle: PropTypes.string,\n        passageText: PropTypes.string,\n        footnotes: PropTypes.string,\n        showLineNumbers: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            passageTitle: \"\",\n            passageText: \"\",\n            footnotes: \"\",\n            showLineNumbers: true,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        var passageEditor = (\n            <Editor\n                ref=\"passage-editor\"\n                apiOptions={this.props.apiOptions}\n                content={this.props.passageText}\n                widgetEnabled={false}\n                placeholder=\"Type passage here...\"\n                onChange={newProps => {\n                    this.change({passageText: newProps.content});\n                }}\n                showWordCount={true}\n            />\n        );\n        var footnotesEditor = (\n            <Editor\n                ref=\"passage-footnotes-editor\"\n                apiOptions={this.props.apiOptions}\n                content={this.props.footnotes}\n                widgetEnabled={false}\n                placeholder=\"Type footnotes here...\"\n                onChange={newProps => {\n                    this.change({footnotes: newProps.content});\n                }}\n            />\n        );\n        return (\n            <div className=\"perseus-widget-passage-editor\">\n                <div className=\"perseus-widget-row\">\n                    <PropCheckBox\n                        label=\"Show line numbers\"\n                        labelAlignment=\"right\"\n                        showLineNumbers={this.props.showLineNumbers}\n                        onChange={this.props.onChange}\n                    />\n                </div>\n                <div>\n                    Passage title:\n                    <InfoTip>\n                        <p>\n                            An optional title that will appear directly above\n                            the passage in the same font style. (E.g. Passage 1)\n                        </p>\n                    </InfoTip>\n                    <div>\n                        <input\n                            type=\"text\"\n                            defaultValue={this.props.passageTitle}\n                            onChange={e => {\n                                this.change({passageTitle: e.target.value});\n                            }}\n                        />\n                    </div>\n                </div>\n                <div>\n                    Passage Text:\n                    {passageEditor}\n                </div>\n                <div>\n                    Footnotes:\n                    <InfoTip>\n                        <p>\n                            To add footnotes, add ^ characters where they belong\n                            in the passage. Then, add ^ in the footnotes area to\n                            reference the footnotes in the passage.\n                        </p>\n                    </InfoTip>\n                    {footnotesEditor}\n                </div>\n            </div>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = PassageEditor;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _simpleMarkdown from \"simple-markdown\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals $_ */\nvar React = _react;\nvar SimpleMarkdown = _simpleMarkdown;\nvar _ = _underscore;\n\nvar START_REF_PREFIX = \"start-ref-\";\nvar END_REF_PREFIX = \"end-ref-\";\nvar REF_STYLE = {\n    display: \"inline-block\",\n    width: 0,\n    visibility: \"hidden\",\n};\n\nvar LABEL_OUTER_STYLE = {\n    // for some reason we need these to keep the nbsp from wrapping when the\n    // inner circle/square is display: inline-block\n    display: \"inline\",\n    whiteSpace: \"nowrap\",\n};\n\nvar SQUARE_LABEL_STYLE = {\n    display: \"inline-block\",\n    color: \"rgb(255, 255, 255)\",\n    backgroundColor: \"rgb(90, 90, 90)\",\n    paddingLeft: 10,\n    paddingRight: 10,\n    userSelect: \"none\",\n    WebkitUserSelect: \"none\",\n};\n\nvar CIRCLE_LABEL_STYLE = {\n    display: \"inline-block\",\n    color: \"rgb(255, 255, 255)\",\n    backgroundColor: \"rgb(90, 90, 90)\",\n    userSelect: \"none\",\n    WebkitUserSelect: \"none\",\n    width: 22,\n    height: 22,\n    borderRadius: \"50%\",\n    textAlign: \"center\",\n};\n\nvar RefStart = createReactClass({\n    propTypes: {\n        refContent: PropTypes.node.isRequired,\n    },\n\n    render: function() {\n        return <span style={REF_STYLE}>_</span>;\n    },\n\n    getRefContent: function() {\n        return this.props.refContent;\n    },\n});\n\nvar RefEnd = createReactClass({\n    render: function() {\n        return <span style={REF_STYLE}>_</span>;\n    },\n});\n\nvar rules = {\n    newline: SimpleMarkdown.defaultRules.newline,\n    paragraph: SimpleMarkdown.defaultRules.paragraph,\n    escape: SimpleMarkdown.defaultRules.escape,\n    passageFootnote: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.1,\n        match: SimpleMarkdown.inlineRegex(/^\\^/),\n        parse: (capture, parse, state) => {\n            // if no footnotes have been seen, we're id 1. otherwise,\n            // we're the next subsequent id\n            var id = state.lastFootnote.id + 1;\n            var footnote = {\n                id: id,\n                // our text is what to output. if there is only one footnote,\n                // it's a *; otherwise it's a superscript number\n                text: id === 1 ? \"*\" : \"\" + id,\n            };\n\n            // If the previous footnote was a *, we need to adjust it to be\n            // a number, since now we know there is more than one footnote\n            if (state.lastFootnote.text === \"*\") {\n                state.lastFootnote.text = \"\" + state.lastFootnote.id;\n            }\n\n            // and update our last footnote, + return.\n            state.lastFootnote = footnote;\n            return footnote;\n        },\n        react: (node, output, state) => {\n            return (\n                <sup key={state.key}>\n                    {node.text}\n                </sup>\n            );\n        },\n    },\n    refStart: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.2,\n        match: function(source, state) {\n            var capture = /^\\{\\{/.exec(source);\n            if (capture) {\n                // We need to do extra processing here to capture the\n                // full text of the reference, which we include so that\n                // we can use that information as a screenreader\n                var closeIndex = 2; // start looking after the opening \"{{\"\n                var refNestingLevel = 0;\n\n                // Find the closing \"}}\" for our opening \"{{\"\n                while (closeIndex < source.length) {\n                    var token = source.slice(closeIndex, closeIndex + 2);\n                    if (token === \"{{\") {\n                        refNestingLevel++;\n                        // increment an extra character so we get the\n                        // full 2-char token\n                        closeIndex++;\n                    } else if (token === \"}}\") {\n                        if (refNestingLevel > 0) {\n                            refNestingLevel--;\n                            // increment an extra character so we get the\n                            // full 2-char token\n                            closeIndex++;\n                        } else {\n                            break;\n                        }\n                    }\n                    closeIndex++;\n                }\n\n                var refText = source.slice(2, closeIndex);\n\n                // A \"magic\" capture that matches the opening {{\n                // but captures the full ref text internally :D\n                return [capture[0], refText];\n            } else {\n                return null;\n            }\n        },\n        parse: (capture, parse, state) => {\n            if (!state.useRefs) {\n                return {\n                    ref: null,\n                    refContent: null,\n                };\n            }\n\n            var ref = state.lastRef + 1;\n            state.lastRef = ref;\n            state.currentRef.push(ref);\n\n            var refContent = parse(\n                // Curly quotes\n                \"(\\u201C\" + capture[1] + \"\\u201D)\\n\\n\",\n                _.defaults(\n                    {\n                        // We don't want to parse refs while looking through\n                        // this refs contents. We definitely don't want\n                        // to make those refs into react refs on the\n                        // passage, for instance!\n                        useRefs: false,\n                    },\n                    INITIAL_PARSE_STATE\n                )\n            );\n\n            return {\n                ref: ref,\n                refContent: refContent,\n            };\n        },\n        react: (node, output, state) => {\n            if (node.ref == null) {\n                return null;\n            }\n\n            // We don't pass state here because this is parsed\n            // and output out-of-band. We don't want to affect\n            // our state by the double-output here :).\n            var refContent = output(node.refContent, {});\n            return (\n                <RefStart\n                    ref={START_REF_PREFIX + node.ref}\n                    key={START_REF_PREFIX + node.ref}\n                    refContent={refContent}\n                />\n            );\n        },\n    },\n    refEnd: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.3,\n        match: SimpleMarkdown.inlineRegex(/^\\}\\}/),\n        parse: (capture, parse, state) => {\n            if (!state.useRefs) {\n                return {\n                    ref: null,\n                };\n            }\n\n            var ref = state.currentRef.pop() || null;\n            return {\n                ref: ref,\n            };\n        },\n        react: (node, output, state) => {\n            if (node.ref != null) {\n                return (\n                    <RefEnd\n                        ref={END_REF_PREFIX + node.ref}\n                        key={END_REF_PREFIX + node.ref}\n                    />\n                );\n            } else {\n                // if we didn't have a matching start reference, or\n                // we aren't parsing refs for this pass (we do this\n                // inside of refContent), don't output a ref\n                return null;\n            }\n        },\n    },\n    squareLabel: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.4,\n        match: SimpleMarkdown.inlineRegex(/^\\[\\[(\\w+)\\]\\]( *)/),\n        parse: (capture, parse, state) => {\n            if (!state.firstQuestionRef) {\n                state.firstQuestionRef = capture[1];\n            }\n            return {\n                content: capture[1],\n                space: capture[2].length > 0,\n            };\n        },\n        react: (node, output, state) => {\n            return [\n                <span\n                    key=\"visual-square\"\n                    className=\"perseus-passage-square-label\"\n                    style={LABEL_OUTER_STYLE}\n                    aria-hidden=\"true\"\n                >\n                    <span style={SQUARE_LABEL_STYLE}>\n                        {node.content}\n                    </span>\n                </span>,\n                <span key=\"alt-text\" className=\"perseus-sr-only\">\n                    {$_(\n                        {number: node.content},\n                        \"[Marker for question %(number)s]\"\n                    )}\n                </span>,\n                node.space ? \"\\u00A0\" : null,\n            ];\n        },\n    },\n    circleLabel: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.5,\n        match: SimpleMarkdown.inlineRegex(/^\\(\\((\\w+)\\)\\)( *)/),\n        parse: (capture, parse, state) => {\n            return {\n                content: capture[1],\n                space: capture[2].length > 0,\n            };\n        },\n        react: (node, output, state) => {\n            return [\n                <span\n                    key=\"visual-circle\"\n                    className=\"perseus-passage-circle-label\"\n                    style={LABEL_OUTER_STYLE}\n                    aria-hidden={true}\n                >\n                    <span style={CIRCLE_LABEL_STYLE}>\n                        {node.content}\n                    </span>\n                </span>,\n                <span key=\"alt-text\" className=\"perseus-sr-only\">\n                    {$_({number: node.content}, \"[Circle marker %(number)s]\")}\n                </span>,\n                node.space ? \"\\u00A0\" : null,\n            ];\n        },\n    },\n    squareBracketRef: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.6,\n        match: SimpleMarkdown.inlineRegex(/^\\[(\\d+)\\]( *)/),\n        parse: (capture, parse, state) => {\n            if (!state.firstSentenceRef) {\n                state.firstSentenceRef = capture[1];\n            }\n            return {\n                content: capture[1],\n                space: capture[2].length > 0,\n            };\n        },\n        react: (node, output, state) => {\n            return [\n                <span\n                    key=\"visual-brackets\"\n                    className=\"perseus-passage-bracket-label\"\n                    aria-hidden=\"true\"\n                >\n                    [{node.content}]\n                </span>,\n                <span key=\"alt-text\" className=\"perseus-sr-only\">\n                    {$_({number: node.content}, \"[Sentence %(number)s]\")}\n                </span>,\n                node.space ? \"\\u00A0\" : null,\n            ];\n        },\n    },\n    highlight: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.7,\n        match: SimpleMarkdown.inlineRegex(\n            /^{highlighting.start}(.+?){highlighting.end}/\n        ),\n        parse: (capture, parse, state) => {\n            return {\n                content: capture[1],\n            };\n        },\n        react: (node, output, state) => {\n            return [\n                <span className=\"perseus-highlight\">\n                    {node.content}\n                </span>,\n            ];\n        },\n    },\n    reviewHighlight: {\n        order: SimpleMarkdown.defaultRules.escape.order + 0.7,\n        match: SimpleMarkdown.inlineRegex(\n            /^{review-highlighting.start}(.+?){review-highlighting.end}/\n        ),\n        parse: (capture, parse, state) => {\n            return {\n                content: capture[1],\n            };\n        },\n        react: (node, output, state) => {\n            return [\n                <span className=\"perseus-review-highlight\">\n                    {node.content}\n                </span>,\n            ];\n        },\n    },\n    strong: SimpleMarkdown.defaultRules.strong,\n    u: SimpleMarkdown.defaultRules.u,\n    em: SimpleMarkdown.defaultRules.em,\n    del: SimpleMarkdown.defaultRules.del,\n    text: {\n        ...SimpleMarkdown.defaultRules.text,\n        react(node, output, state) {\n            return (\n                <span key={state.key}>\n                    {node.content}\n                </span>\n            );\n        },\n    },\n};\n\nvar INITIAL_PARSE_STATE = {\n    currentRef: [],\n    useRefs: true,\n    lastRef: 0,\n    lastFootnote: {id: 0, text: \"\"},\n};\nvar builtParser = SimpleMarkdown.parserFor(rules);\nvar parse = (source, state) => {\n    state = state || {};\n    var paragraphedSource = source + \"\\n\\n\";\n    return builtParser(paragraphedSource, _.extend(state, INITIAL_PARSE_STATE));\n};\n\n_module_.exports = {\n    parse: parse,\n    output: SimpleMarkdown.reactFor(SimpleMarkdown.ruleOutput(rules, \"react\")),\n    START_REF_PREFIX: START_REF_PREFIX,\n    END_REF_PREFIX: END_REF_PREFIX,\n    _rulesForTesting: rules,\n};\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Given two DOMRange objects, and a choice of start/end point for each, compare\n * the two chosen points. Return -1 if a's comes first in the document, return\n * 1 if b's comes first in the document, or 0 if they represent the same point\n * in the document.\n *\n * NOTE(mdr): This function exists primarily to cover over some confusing parts\n *     of the DOM's `compareBoundaryPoints` API, and to cover over a Flow bug\n *     documented here: https://github.com/facebook/flow/issues/3734.\n */\nfunction compareRangeBoundaryPoints(a, whichA, b, whichB) {\n    let mode;\n    if (whichA === \"start\" && whichB === \"start\") {\n        // $FlowFixMe(mdr)\n        mode = Range.START_TO_START;\n    } else if (whichA === \"start\" && whichB === \"end\") {\n        // NOTE(mdr): Confusingly, the correct constant here is actually\n        //     `END_TO_START`, which is the reverse of what you'd expect.\n        // $FlowFixMe(mdr)\n        mode = Range.END_TO_START;\n    } else if (whichA === \"end\" && whichB === \"start\") {\n        // NOTE(mdr): Confusingly, the correct constant here is actually\n        //     `START_TO_END`, which is the reverse of what you'd expect.\n        // $FlowFixMe(mdr)\n        mode = Range.START_TO_END;\n    } else {\n        // $FlowFixMe(mdr)\n        mode = Range.END_TO_END;\n    }\n    return a.compareBoundaryPoints(mode, b);\n}\n\n/**\n * Given two DOMRanges, return a DOMRange whose start point comes from A, and\n * whose end point comes from B.\n */\nfunction spanRanges(a, b) {\n    const range = a.cloneRange();\n    range.setEnd(b.endContainer, b.endOffset);\n    return range;\n}\n\n/**\n * Given two DOMRanges, return whether they overlap.\n *\n * We here treat ranges like closed intervals: the boundary points are\n * considered to be included in the range, and, if a ends exactly where b\n * starts, they are considered to overlap.\n */\nfunction rangesOverlap(a, b) {\n    // Two ranges do *not* overlap iff one ends before the other begins.\n    const rangesDoNotOverlap =\n        compareRangeBoundaryPoints(a, \"end\", b, \"start\") < 0 ||\n        compareRangeBoundaryPoints(b, \"end\", a, \"start\") < 0;\n    return !rangesDoNotOverlap;\n}\n\n/**\n * Given two DOMRanges, return whether the first includes the second: whether\n * all points that B contains are also contained by A.\n */\nfunction rangeIncludes(a, b) {\n    const rangeIsIncluded =\n        compareRangeBoundaryPoints(a, \"start\", b, \"start\") <= 0 &&\n        compareRangeBoundaryPoints(a, \"end\", b, \"end\") >= 0;\n    return rangeIsIncluded;\n}\n\n/**\n * Given two DOMRanges, intersect them: return a range that contains all points\n * that both A contains and B contains, and contains no other points.\n *\n * If A and B do not overlap, no intersection exists; return null.\n */\nfunction intersectRanges(a, b) {\n    if (!rangesOverlap(a, b)) {\n        return null;\n    }\n\n    // Find the range with the latest start point, and the range with the\n    // earliest end point.\n    const starter =\n        compareRangeBoundaryPoints(a, \"start\", b, \"start\") > 0 ? a : b;\n    const ender =\n        compareRangeBoundaryPoints(a, \"end\", b, \"end\") < 0 ? a : b;\n\n    return spanRanges(starter, ender);\n}\n\n/**\n * Given two DOMRanges, union them: return a range that contains all points\n * that either A contains or B contains, and contains no other points.\n *\n * If A and B do not overlap, no union exists; return null.\n */\nfunction unionRanges(a, b) {\n    if (!rangesOverlap(a, b)) {\n        return null;\n    }\n\n    // Find the range with the earliest start point, and the range with the\n    // latest end point.\n    const starter =\n        compareRangeBoundaryPoints(a, \"start\", b, \"start\") < 0 ? a : b;\n    const ender =\n        compareRangeBoundaryPoints(a, \"end\", b, \"end\") > 0 ? a : b;\n\n    return spanRanges(starter, ender);\n}\n\n/**\n * Given a list of word ranges, and a selection range, binary search the list\n * and return the index of the goal word, or -1 if no satisfactory goal word\n * exists in the list.\n *\n * If `goal` is \"first\", return the index of the first word whose end point is\n * after the selection's start point.\n *\n * If `goal` is \"last\", return the index of the last word whose start point is\n * before the selection's end point.\n */\nfunction findBoundaryWordIndex(selectionRange, wordRanges, goal, initialLowerBound, initialUpperBound) {\n    let bestValidWordIndex = -1;\n    let lowerBound = initialLowerBound;\n    let upperBound = initialUpperBound;\n    let iterationCount = 0;\n    while (lowerBound <= upperBound) {\n        iterationCount++;\n        if (iterationCount > (wordRanges.length * 2)) {\n            throw new Error(\n                `Assertion error: Binary search isn't terminating? ` +\n                `lower=${lowerBound}, upper=${upperBound}`);\n        }\n\n        const mid = Math.floor((lowerBound + upperBound) / 2);\n\n        if (goal === \"first\") {\n            const rangeComparison = compareRangeBoundaryPoints(\n                wordRanges[mid], \"end\", selectionRange, \"start\");\n            if (rangeComparison <= 0) {\n                // If this word's end point is before or equal to the\n                // selection's start point, then this word is not a valid\n                // candidate, nor are any of the words before it.\n                //\n                // Update our bounds to look for a valid word after this one.\n                lowerBound = mid + 1;\n            } else {\n                // If this word's end point is after the selection's start\n                // point, then this word is valid, and is, by nature of the\n                // search, the earliest valid word we're aware of.\n                //\n                // Update our bounds to look for a better valid word before\n                // this one.\n                bestValidWordIndex = mid;\n                upperBound = mid - 1;\n            }\n        } else {\n            const rangeComparison = compareRangeBoundaryPoints(\n                wordRanges[mid], \"start\", selectionRange, \"end\");\n            if (rangeComparison >= 0) {\n                // If this word's start point is after or equal to the\n                // selection's end point, then this word is not a valid\n                // candidate, nor are any of the words after it.\n                //\n                // Update our bounds to look for a valid word before this one.\n                upperBound = mid - 1;\n            } else {\n                // If this word's start point is before the selection's end\n                // point, then this word is valid, and is, by nature of the\n                // search, the latest valid word we're aware of.\n                //\n                // Update our bounds to look for a better valid word after\n                // this one.\n                bestValidWordIndex = mid;\n                lowerBound = mid + 1;\n            }\n        }\n    }\n\n    return bestValidWordIndex;\n}\n\n/**\n * Given a list of word ranges, and a selection range, binary search the list\n * and return the indexes of the first and last words that the selection\n * intersects, or `null` if the range includes no words.\n */\nfunction findFirstAndLastWordIndexes(selectionRange, wordRanges) {\n    // Find the first word whose end point is after the selection's start\n    // point.\n    //\n    // Note that this does *not* alone prove that this word is *intersected* by\n    // the current range; to intersect, the first word's start point must also\n    // be before the selection's end point. This is proven by the success of\n    // the second search.\n    //\n    // (For example, imagine highlighting the space between two words. This\n    // search would return the first word after the selection, despite not\n    // intersecting the selection.)\n    const firstWordIndex = findBoundaryWordIndex(\n        selectionRange, wordRanges, \"first\", 0, wordRanges.length - 1);\n    if (firstWordIndex < 0) {\n        return null;\n    }\n\n    // Find the last word whose start point is before the selection's end\n    // point.\n    //\n    // Start the search with our candidate first word, because, while we don't\n    // know whether our candidate first word intersects the selection, we *do*\n    // know that no *earlier* word intersects the selection, or else it would\n    // have been yielded as the candidate first word instead.\n    const lastWordIndex = findBoundaryWordIndex(selectionRange, wordRanges,\n        \"last\", firstWordIndex, wordRanges.length - 1);\n    if (lastWordIndex < 0) {\n        return null;\n    }\n\n    // Now, we have discovered a candidate first word F, and a candidate last\n    // word L. Let's prove that these are indeed the first and last intersected\n    // words of the selection S.\n    //\n    // Syntax: Let A1 and A2 represent the start and end point of range A.\n    //\n    // Definition: A1 <= A2 for any range A.\n    //\n    // Theorem 1: Two ranges A and B intersect iff A1 <= B2 and B1 <= A2.\n    // Proof: See http://www.rgrjr.com/emacs/overlap.html, and extend the\n    //     result to closed intervals by also accepting equality.\n    //\n    // Given 1: F1 <= L1 and F2 <= L2. That is, either the first and last word\n    //     are the same, or the last word comes after, because we provided\n    //     `firstWordIndex` as the lower bound when search for L.\n    // Given 2: S1 <= F2, and no earlier word's end point is >= S1, because\n    //     F was returned by `findBoundaryWordIndex` with goal \"first\".\n    // Given 3: L1 <= S2, and no later word's start point is <= S2, because\n    //     L was returned by `findBoundaryWordIndex` with goal \"last\".\n    //\n    // Conclusion 1: F intersects S.\n    // Proof: By Theorem 1, we must show that F1 <= S2 and S1 <= F2.\n    //     F1 <= L1 <= S2, by Given 1 and Given 3.\n    //     S1 <= F2, by Given 2. QED.\n    //\n    // Conclusion 2: L intersects S.\n    // Proof: By Theorem 1, we must show that L1 <= S2 and S1 <= L2.\n    //     L1 <= S2 by Given 3.\n    //     S1 <= F2 <= L2, by Given 1 and Given 2. QED.\n    //\n    // Conclusion 3: No word earlier than F intersects S.\n    // Proof: Consider some word W earlier than F.\n    //     W2 < S1, by Given 2. Therefore, it's false that S1 <= W2.\n    //     Therefore, W and S do not intersect, by Theorem 1. QED.\n    //\n    // Conclusion 4: No word later than L intersects S.\n    // Proof: Consider some word W later than L.\n    //     W1 > S2, by Given 2. Therefore, it's false that W1 <= S2.\n    //     Therefore, W and S do not intersect, by Theorem 1, QED.\n    //\n    // Therefore, while neither of these two searches alone proves that F is\n    // the first intersected word of S, or that L is the last intersected word\n    // of S, the implications of the two searches are sufficient proof when\n    // combined. Return these two indexes with confidence, hooray!\n\n    return [firstWordIndex, lastWordIndex];\n}\n\nexport {\n    findFirstAndLastWordIndexes,\n    rangesOverlap,\n    rangeIncludes,\n    intersectRanges,\n    unionRanges,\n    spanRanges,\n};\nexport default {\n    findFirstAndLastWordIndexes,\n    rangesOverlap,\n    rangeIncludes,\n    intersectRanges,\n    unionRanges,\n    spanRanges,\n};\n","import { findFirstAndLastWordIndexes, unionRanges, spanRanges, rangeIncludes } from \"./ranges.js\";\n\n/**\n * Given a list of DOMHighlights, return a new list that also includes the\n * given DOMRange as a new DOMHighlight. If the DOMHighlight intersects\n * existing DOMHighlights, the other Highlights are removed and their ranges\n * are merged into the new DOMHighlight.\n */\nfunction addHighlight(existingHighlights, newHighlight) {\n    const newHighlights = {};\n\n    // Merge the new highlight with any existing highlights that intersect it.\n    let mergedDomRange = newHighlight.domRange;\n    let mergedFirstWordIndex = newHighlight.firstWordIndex;\n    let mergedLastWordIndex = newHighlight.lastWordIndex;\n    for (const key of Object.keys(existingHighlights)) {\n        const h = existingHighlights[key];\n        const newMergedDomRange = unionRanges(h.domRange, mergedDomRange);\n        if (newMergedDomRange) {\n            // This highlight's range was successfully merged into the new\n            // highlight. Update `mergedDomRange`, and *don't* add it to the\n            // new set of highlights.\n            mergedDomRange = newMergedDomRange;\n            mergedFirstWordIndex =\n                Math.min(h.firstWordIndex, mergedFirstWordIndex);\n            mergedLastWordIndex =\n                Math.max(h.lastWordIndex, mergedLastWordIndex);\n        } else {\n            // This highlight's range can't be merged into the new highlight.\n            // Add it to the new set of highlights.\n            newHighlights[key] = h;\n        }\n    }\n\n    const newMergedHighlight = {\n        firstWordIndex: mergedFirstWordIndex,\n        lastWordIndex: mergedLastWordIndex,\n        domRange: mergedDomRange,\n    };\n\n    // Add the newly-merged highlight to the set of highlights, under a new,\n    // unique key.\n    const existingKeys = Object.keys(newHighlights);\n    const newKey = createNewUniqueKey(existingKeys);\n    newHighlights[newKey] = newMergedHighlight;\n\n    return newHighlights;\n}\n\n/**\n * Given a DOMRange and a list of word ranges, build a corresponding\n * DOMHighlight.\n *\n * If the DOMRange is not a valid highlight given the word ranges, return null.\n */\nfunction buildHighlight(existingHighlights, wordRanges, newHighlightRange) {\n    // If any existing highlight fully contains the new highlight range, it's\n    // redundant and therefore not valid to build this as a highlight.\n    // Return null.\n    //\n    // NOTE(mdr): Really, our goal is to determine whether the new range's\n    //     content is already fully highlighted, so you could imagine this\n    //     logic not catching the case where a range's contents are fully\n    //     highlighted, but by multiple ranges.\n    //\n    //     However, words aren't actually adjacent; they have spaces between\n    //     them. So, even if each word in the range is currently highlighted,\n    //     the space between a pair of words will only be highlighted if\n    //     they're included in the same highlight range.\n    //\n    //     Therefore, if this new range isn't fully contained by an existing\n    //     highlight, then there's at *least* an unhighlighted space within the\n    //     range. In that case, it makes sense to offer this as a new highlight\n    //     that, when added, will merge with the highlights that it intersects.\n    for (const key of Object.keys(existingHighlights)) {\n        const existingHighlightRange = existingHighlights[key].domRange;\n        if (rangeIncludes(existingHighlightRange, newHighlightRange)) {\n            return null;\n        }\n    }\n\n    // If the new highlight range doesn't span two words from the content, it's\n    // not valid to build this as a highlight. Return null.\n    const indexes = findFirstAndLastWordIndexes(newHighlightRange, wordRanges);\n    if (!indexes) {\n        return null;\n    }\n\n    const [firstWordIndex, lastWordIndex] = indexes;\n    const firstWord = wordRanges[firstWordIndex];\n    const lastWord = wordRanges[lastWordIndex];\n    return {\n        firstWordIndex,\n        lastWordIndex,\n        domRange: spanRanges(firstWord, lastWord),\n    };\n}\n\n/**\n * Given a list of keys, return a new unique key that is not in the list.\n */\nfunction createNewUniqueKey(existingKeys) {\n    // The base of the key is the current time, in milliseconds since epoch.\n    const base = `${new Date().getTime()}`;\n    if (!existingKeys.includes(base)) {\n        return base;\n    }\n\n    // But, if the user is a fast-clicker or time-traveler or something, and\n    // already has a highlight from this millisecond, then let's attach a\n    // suffix and keep incrementing it until we find an unused suffix.\n    let suffix = 0;\n    let key;\n    do {\n        key = `${base}-${suffix}`;\n        suffix++;\n    } while (existingKeys.includes(key));\n\n    return key;\n}\n\n/**\n * Given a SerializedHightlight and the current set of word ranges, return a\n * DOMHighlight representing the SerializedHighlight.\n *\n * If the SerializedHighlight is not valid given the list of word ranges, throw\n * an error.\n */\nfunction deserializeHighlight(serializedHighlight, wordRanges) {\n    const {firstWordIndex, lastWordIndex} = serializedHighlight.range;\n\n    const firstWord = wordRanges[firstWordIndex];\n    if (!firstWord) {\n        throw new Error(\n            `first word index ${firstWord} is out of bounds: ` +\n            `must be 0${wordRanges.length - 1} inclusive`);\n    }\n\n    const lastWord = wordRanges[lastWordIndex];\n    if (!lastWord) {\n        throw new Error(\n            `last word index ${lastWord} is out of bounds: ` +\n            `must be 0${wordRanges.length - 1} inclusive`);\n    }\n\n    return {\n        firstWordIndex,\n        lastWordIndex,\n        domRange: spanRanges(firstWord, lastWord),\n    };\n}\n\n/**\n * Return a SerializedHighlight representing the given DOMHighlight.\n */\nfunction serializeHighlight(highlight) {\n    const {firstWordIndex, lastWordIndex} = highlight;\n\n    return {\n        range: {\n            type: \"word-indexes\",\n            firstWordIndex,\n            lastWordIndex,\n        },\n    };\n}\n\nexport {\n    addHighlight,\n    buildHighlight,\n    deserializeHighlight,\n    serializeHighlight,\n};\nexport default {\n    addHighlight,\n    buildHighlight,\n    deserializeHighlight,\n    serializeHighlight,\n};\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * This component, whenever its content updates, traverses the DOM to find\n * semantic words and send the corresponding DOMRanges to the caller via a\n * callback.\n *\n * A \"word\" here is a sequence of non-whitespace text characters, uninterrupted\n * by the start/end of a non-inline element. That is, a word can span across\n * text nodes and inline tags like <b>, but cannot span across block\n * paragraphs.\n *\n * The words yielded by WordIndexer are sorted in document order, which makes\n * them amenable to binary search - see `findBoundaryWordIndex` in ranges.js.\n */\nconst React = _react;\n\nclass WordIndexer extends React.PureComponent {\n    /* eslint-enable react/sort-comp */\n\n    componentDidMount() {\n        this._sendWordsUpdate();\n    }\n\n    componentDidUpdate() {\n        this._sendWordsUpdate();\n    }\n\n    _sendWordsUpdate() {\n        this.props.onWordsUpdate(this._getWordRanges());\n    }\n\n    _getWordRanges() {\n        const container = this._container;\n\n        if (!container) {\n            throw new Error(\n                \"invariant violation: `this._container` is not defined, but \" +\n                \"this method is only called after mount/update\");\n        }\n\n        // Create a TreeWalker that visits text nodes and element nodes.\n        // We select the types of nodes we're interested in by bitwise-ORing\n        // the desired filters together.\n        const treeWalker = container.ownerDocument.createTreeWalker(\n            container,\n            NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,\n            () => NodeFilter.FILTER_ACCEPT,\n            false,\n        );\n\n        // Traverse the container's descendant text nodes in DOM order,\n        // indexing the words we find.\n        const index = [];\n        let trailingWordRange = null;\n        while (treeWalker.nextNode()) {\n            const node = treeWalker.currentNode;\n\n            if (node.nodeType === Node.ELEMENT_NODE) {\n                const element = (node);\n                if (getComputedStyle(element).display !== \"inline\") {\n                    // Block-level elements interrupt text words, so set the\n                    // current trailing word to `null`.\n                    //\n                    // This includes exiting one paragraph to visit another,\n                    // but also includes text interrupted by inline-block\n                    // elements.\n                    //\n                    // TODO(mdr): Is this behavior *generalizably* correct?\n                    // TODO(mdr): I don't *fully* understand the performance\n                    //     implications of `getComputedStyle`, but I think it's\n                    //     gonna be nbd at the current call sites. If we try to\n                    //     generalize to frequently-updating content, we might\n                    //     want to watch this as a potential performance\n                    //     bottleneck.\n                    trailingWordRange = null;\n                }\n            } else if (node.nodeType === Node.TEXT_NODE) {\n                const text = node.nodeValue;\n\n                // A \"word\" is here simply defined as a maximal-length\n                // substring of non-space characters.\n                //\n                // Loop over all the words in the string, by repeatedly calling\n                // `wordPattern.exec(text)`.\n                const wordPattern = /\\S+/g;\n                let wordMatch;\n                let newTrailingWordRange = null;\n                while ((wordMatch = wordPattern.exec(text)) !== null) {\n                    const startOffset = wordMatch.index;\n                    const endOffset = wordMatch.index + wordMatch[0].length;\n\n                    let range;\n                    if (startOffset === 0 && trailingWordRange) {\n                        // This word is at the start of this text node, and\n                        // there's a trailing word from the previous text node,\n                        // and there was no non-inline element between them.\n                        // This word and the trailing word are probably\n                        // intended to be two parts of the same word.\n                        //\n                        // So, instead of creating a new word range, we add\n                        // this word to the previous range by extending it.\n                        range = trailingWordRange;\n                        range.setEnd(node, endOffset);\n                    } else {\n                        // Otherwise, start a new word range here, and add it\n                        // to the list.\n                        range = node.ownerDocument.createRange();\n                        range.setStart(node, startOffset);\n                        range.setEnd(node, endOffset);\n                        index.push(range);\n                    }\n\n                    if (endOffset === text.length) {\n                        newTrailingWordRange = range;\n                    }\n                }\n                trailingWordRange = newTrailingWordRange;\n            }\n        }\n\n        return index;\n    }\n\n    render() {\n        return (\n            <div ref={container => this._container = container}>\n                {this.props.children}\n            </div>\n        );\n    }\n}\n\n_module_.exports = WordIndexer;\nexport default _module_.exports;\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * Tracks the user's current selection, and exposes it to the subtree using the\n * function-as-children pattern.\n */\nconst React = _react;\n\nclass SelectionTracker extends React.PureComponent {\n    state = {\n        mouseState: \"up\",\n        trackedSelection: null,\n    };\n\n    componentDidMount() {\n        this._updateListeners(false, this.props.enabled);\n    }\n\n    componentWillReceiveProps(nextProps) {\n        if (this.props.buildHighlight !== nextProps.buildHighlight) {\n            // The highlight-building function changed, so the\n            // proposedHighlight we built with it might be different, or no\n            // longer be valid. Update accordingly.\n            this._updateTrackedSelection(nextProps.buildHighlight);\n        }\n\n        this._updateListeners(this.props.enabled, nextProps.enabled);\n    }\n\n    componentWillUnmount() {\n        this._updateListeners(this.props.enabled, false);\n    }\n\n    _updateListeners(wasListening, willListen) {\n        if (!wasListening && willListen) {\n            window.addEventListener(\"mousedown\", this._handleMouseDown);\n            window.addEventListener(\"mouseup\", this._handleMouseUp);\n            document.addEventListener(\"selectionchange\",\n                this._handleSelectionChange);\n        } else if (wasListening && !willListen) {\n            window.removeEventListener(\"mousedown\", this._handleMouseDown);\n            window.removeEventListener(\"mouseup\", this._handleMouseUp);\n            document.removeEventListener(\"selectionchange\",\n                this._handleSelectionChange);\n\n            // Additionally, reset the state, to guard against errors where we\n            // re-enter listening mode and have stale values stored.\n            this.setState({\n                mouseState: \"up\",\n                trackedSelection: null,\n            });\n        }\n    }\n\n    /**\n     * Get the current selection focus and range, if present and non-collapsed.\n     *\n     * Otherwise, if there is no current selection or it's collapsed, return\n     * null.\n     */\n    _computeFocusAndRange() {\n        const selection = document.getSelection();\n        if (!selection || selection.rangeCount === 0) {\n            return null;\n        }\n\n        const range = selection.getRangeAt(0);\n        if (range.collapsed) {\n            return null;\n        }\n\n        // NOTE(mdr): The focus node is guaranteed to exist, because\n        //     there's a range, but the Flow type annotations for\n        //     Selection don't know that. Cast it ourselves.\n        const focusNode = (selection.focusNode);\n        const focusOffset = selection.focusOffset;\n        return {focusNode, focusOffset, range};\n    }\n\n    /**\n     * Compute the current TrackedSelection from the document state.\n     */\n    _computeTrackedSelection(buildHighlight) {\n        const focusAndRange = this._computeFocusAndRange();\n        if (!focusAndRange) {\n            return null;\n        }\n\n        const {focusNode, focusOffset, range} = focusAndRange;\n        const proposedHighlight = buildHighlight(range);\n        if (!proposedHighlight) {\n            return null;\n        }\n\n        return {focusNode, focusOffset, proposedHighlight};\n    }\n\n    /**\n     * Update the TrackedSelection to reflect the document state.\n     */\n    _updateTrackedSelection(buildHighlight) {\n        const trackedSelection = this._computeTrackedSelection(buildHighlight);\n        this.setState({trackedSelection});\n    }\n\n    _handleSelectionChange = () => {\n        this._updateTrackedSelection(this.props.buildHighlight);\n\n        if (this.state.mouseState === \"down\") {\n            this.setState({\n                mouseState: \"down-and-selecting\",\n            });\n        }\n    }\n\n    _handleMouseDown = () => {\n        this.setState({mouseState: \"down\"});\n    }\n\n    _handleMouseUp = () => {\n        this.setState({mouseState: \"up\"});\n    }\n\n    render() {\n        const {mouseState, trackedSelection} = this.state;\n        const userIsMouseSelecting = mouseState === \"down-and-selecting\";\n\n        return this.props.children && <div>\n            {this.props.children(trackedSelection, userIsMouseSelecting)}\n        </div>;\n    }\n}\n\n_module_.exports = SelectionTracker;\nexport default _module_.exports;\n","import { rangesOverlap, intersectRanges } from \"../ranges.js\";\n\n/**\n * Given two positions relative to the same origin, return `child`'s position\n * relative to `parent`'s position.\n */\nexport function getRelativePosition(child, parent) {\n    return {\n        left: child.left - parent.left,\n        top: child.top - parent.top,\n    };\n}\n\n/**\n * `getRelativePosition`, but for Rects.\n *\n * Given a rectangle and a position relative to the same origin, return a new\n * rectangle of the same size, whose position is relative to the given\n * position.\n */\nexport function getRelativeRect(child, parent) {\n    return {\n        ...getRelativePosition(child, parent),\n        width: child.width,\n        height: child.height,\n    };\n}\n\n/**\n * Given a DOMRange, return a list of client-relative rects that cover the text\n * inside the DOMRange.\n *\n * This behaves differently than the browser's built-in `getClientRects` method\n * for DOMRanges, because this method only gets rects for the *text* nodes,\n * whereas the browser's method will also return rects for any fully-contained\n * *element* nodes.\n *\n * For example, if an entire paragraph is selected, then `getClientRects` will\n * return a rectangle that covers the entire paragraph block, whereas this\n * method will only return rectangles for the text inside the paragraph.\n */\nexport function getClientRectsForTextInRange(range) {\n    const mutableRects = [];\n    addClientRectsForTextInNodeAndRange(\n        range.commonAncestorContainer, range, mutableRects);\n    return mutableRects;\n}\n\n/**\n * A helper method for getClientRectsForTextInRange.\n *\n * Given a node and a range, find text that is contained within both the node\n * and the range by recursing down the node's subtree, and push the text's\n * client rects onto the given `mutableRects` array.\n */\nexport function addClientRectsForTextInNodeAndRange(node, range, mutableRects) {\n    const nodeContentsRange = new Range();\n    nodeContentsRange.selectNodeContents(node);\n\n    if (node.nodeType === Node.TEXT_NODE) {\n        // Get the text that appears both in this text node and in the range\n        // we're searching.\n        const intersectedRange = intersectRanges(range, nodeContentsRange);\n        if (intersectedRange) {\n            addClientRectsForText(node, intersectedRange, mutableRects);\n        }\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\n        // Don't bother deep-traversing a node that doesn't even overlap the\n        // range we're searching.\n        if (!rangesOverlap(range, nodeContentsRange)) {\n            return;\n        }\n\n        // NOTE(mdr): Safari returns a non-iterable `childNodes` object, so\n        //     convert it to an array.\n        for (const child of Array.from(node.childNodes)) {\n            // TODO(mdr): If this parent has overflow: hidden, bound the child\n            //     rects accordingly. This would allow us to remove the hack\n            //     we added to .perseus-sr-only.\n            addClientRectsForTextInNodeAndRange(child, range, mutableRects);\n        }\n    }\n}\n\n/**\n * Given a DOMRange of text fully contained by the given `textNode`, compute\n * rectangles that visually cover the range, and push them onto the given\n * `mutableRects` array.\n *\n * This function adjusts the rectangles to the line height of the text, to\n * match the visual behavior of native text selection, and remove annoying gaps\n * between lines that disrupt hover behavior.\n */\nexport function addClientRectsForText(textNode, textRange, mutableRects) {\n  const parentElement = textNode.parentElement;\n    const computedStyle = window.getComputedStyle(parentElement);\n\n    // NOTE(mdr): I'm not sure how computed line height works in all contexts\n    //     in all browsers. It's valid to specify line height as a ratio,\n    //     relative to font size. Latest Chrome seems to transform this into a\n    //     px value, but maybe some browsers don't, so I'm being defensive here\n    //     and only using the computed line height if it's explicitly a px\n    //     value. We could also handle other browsers by computing font size\n    //     and doing the math ourselves, but let's punt that until we need it.\n    let lineHeight = null;\n    if (\n        typeof computedStyle.lineHeight === \"string\" &&\n        computedStyle.lineHeight.endsWith(\"px\")\n    ) {\n        const parsedLineHeight = parseFloat(computedStyle.lineHeight);\n        if (!isNaN(parsedLineHeight)) {\n            lineHeight = parsedLineHeight;\n        }\n    }\n\n    // NOTE(mdr): Safari returns a non-iterable `getClientRects` object, so\n    //     convert it to an array.\n    const boundingRects = Array.from(textRange.getClientRects());\n\n    for (const boundingRect of boundingRects) {\n        const rect = {\n            left: boundingRect.left,\n            top: boundingRect.top,\n            height: boundingRect.height,\n            width: boundingRect.width,\n        };\n\n        // Adjust the rectangle according to the text's line height. It should\n        // keep the same bottom coordinate, so the top coordinate will move\n        // accordingly.\n        if (lineHeight !== null) {\n            const heightIncrease = lineHeight - rect.height;\n            rect.top -= heightIncrease;\n            rect.height = lineHeight;\n        }\n\n        mutableRects.push(rect);\n    }\n}\n\nexport default {\n    getClientRectsForTextInRange,\n    getRelativePosition,\n    getRelativeRect,\n}\n","import { getRelativePosition } from \"./util.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * A tooltip to point to the focus of a highlight.\n */\nconst React = _react;\n\nclass HighlightTooltip extends React.PureComponent {\n    _getPosition() {\n        const {focusNode, focusOffset, offsetParent} = this.props;\n\n        // Get a range of *just* the focus point of the selection.\n        const focusRange = document.createRange();\n        focusRange.setStart(focusNode, focusOffset);\n        focusRange.setEnd(focusNode, focusOffset);\n\n        // Then, get the bounding box of the collapsed range. This will be a\n        // zero-width rectangle, but still have positioning information, which\n        // we can use the position the tooltip.\n        //\n        // NOTE(mdr): If we used getClientBoundingRect here instead, Safari\n        //     would return an unpositioned rect. But all tested browsers at\n        //     time of writing (latest Chrome, Firefox, Safari) return at least\n        //     one rectangle from getClientRects, and it's well-positioned.\n        const focusRect = focusRange.getClientRects()[0];\n\n        // NOTE(mdr): ...except in the case where the focus is between two\n        //     paragraphs, in which case the focus range has no client rects?\n        //     Not sure why, or in what browsers (only noticed in Chrome 60),\n        //     but let's catch that case and bail out.\n        // TODO(mdr): Instead, we should somehow walk back the range until we\n        //     find an appropriate position for the tooltip. Sounds tricky!\n        if (!focusRect) {\n            // eslint-disable-next-line no-console\n            console.warn(\n                \"[Highlighting] Known bug: Could not determine the focus \" +\n                \"position, so did not show an \\\"Add Highlight\\\" tooltip. \" +\n                \"https://app.asana.com/0/329800276300868/413878480039713\");\n            return null;\n        }\n\n        // Compute the desired position of the tooltip relative to the offset\n        // parent.\n        const offsetParentRect = offsetParent.getBoundingClientRect();\n        const focusPosition =\n            getRelativePosition(focusRect, offsetParentRect);\n\n        return focusPosition;\n    }\n\n    render() {\n        const position = this._getPosition();\n        if (!position) {\n            return null;\n        }\n\n        return <div\n            className={css(styles.tooltip)}\n            onClick={this.props.onClick}\n            onMouseEnter={this.props.onMouseEnter}\n            onMouseLeave={this.props.onMouseLeave}\n            style={{\n                left: position.left,\n                top: position.top,\n                zIndex: this.props.zIndex,\n            }}\n        >\n            <div className={css(styles.label)}>\n                {this.props.label}\n            </div>\n            <div className={css(styles.arrow)} />\n        </div>;\n    }\n}\n\nconst styles = StyleSheet.create({\n    tooltip: {\n        // Positioning.\n        //\n        // Position the tooltip's *center-bottom* point at the left/top\n        // coordinates, instead of the tooltip's top-left point, by translating\n        // left by half the tooltip's width and up by the tooltip's full\n        // height.\n        //\n        // `left`, `top`, and `zIndex` are specified via the `style` attribute.\n        position: \"absolute\",\n        transform: \"translate(-50%, -100%)\",\n\n        // Cursor interaction.\n        cursor: \"pointer\",\n        userSelect: \"none\",\n    },\n\n    label: {\n        // Box appearance.\n        background: \"#314453\",\n        borderRadius: 2,\n        boxShadow: \"0 1px 4px 0 rgba(97, 101, 105, 0.42)\",\n        padding: \"8px 11px\",\n\n        // Text appearance.\n        color: \"white\",\n        fontSize: 12,\n        lineHeight: 1.5,\n        textAlign: \"center\",\n    },\n\n    // A 12px-width, 6px-height downward-facing arrow.\n    //\n    // Implemented by creating a box whose only content is its top, left, and\n    // right borders. The joints between two borders are a diagonal line, so\n    // the arrow element renders divided into these three areas:\n    //\n    // +-------+\n    // |\\ top /|\n    // | \\   / |\n    // |  \\ /  |\n    // |L  v  R|\n    // +-------+\n    //\n    // Therefore, if we color the top border, and make the left and right\n    // borders transparent, we end up with a triangle!\n    //\n    // https://css-tricks.com/snippets/css/css-triangle/\n    arrow: {\n        // Make the inner dimensions of the box 0x0, so that its only content\n        // is its top, left, and right borders.\n        height: 0,\n        width: 0,\n\n        // The sum of our left and right border widths will be the width of our\n        // triangle, so set them to 6px + 6px = 12px.\n        borderLeft: \"6px solid transparent\",\n        borderRight: \"6px solid transparent\",\n\n        // The top border height will be the height of our triangle, so set it\n        // to 6px.\n        borderTop: \"6px solid #314453\",\n\n        // Center the arrow within the tooltip container.\n        margin: \"0 auto\",\n    },\n});\n\n_module_.exports = HighlightTooltip;\nexport default _module_.exports;\n","import { getClientRectsForTextInRange, getRelativePosition, getRelativeRect } from \"./util.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n(function() {\n    \n    /**\n     * This component, given a single DOMHighlight, draws highlight rectangles in\n     * the same absolute position as the highlighted content, as computed via\n     * `getClientRects`.\n     *\n     * TODO(mdr): Many things can affect the correct positioning of highlighting,\n     *     and this component does not attempt to anticipate them. If we start\n     *     using this highlighting library on content with a more dynamic layout,\n     *     we should add a hook to allow the parent to `forceUpdate` the\n     *     `HighlightRenderer`.\n     */\n    const React = _react;\n\n    class HighlightRenderer extends React.PureComponent {\n        state = {\n            cachedHighlightRects: this._computeRects(this.props),\n            tooltipIsHovered: false,\n        };\n\n        componentWillReceiveProps(nextProps) {\n            if (\n                this.props.highlight !== nextProps.highlight ||\n                this.props.offsetParent !== nextProps.offsetParent\n            ) {\n                this.setState({\n                    cachedHighlightRects: this._computeRects(nextProps),\n                });\n            }\n        }\n\n        /**\n         * Compute the set of rectangles that cover the highlighted content, with\n         * coordinates relative to the offset parent. That way, we can use them\n         * for CSS positioning.\n         */\n        _computeRects(props) {\n            const {highlight, offsetParent} = props;\n\n            // Get the set of rectangles that covers the range's text, relative to\n            // the offset parent.\n            const clientRects = getClientRectsForTextInRange(highlight.domRange);\n            const offsetParentRect = offsetParent.getBoundingClientRect();\n            const relativeRects =\n                clientRects.map(rect => getRelativeRect(rect, offsetParentRect));\n\n            return relativeRects;\n        }\n\n        /**\n         * Return whether the given mouse position (coordinates relative to this\n         * component's offset parent) is hovering over the given rectangle\n         * (coordinates also relative to this component's offset parent).\n         */\n        _rectIsHovered(rect, mouseOffsetPosition) {\n            const positionWithinRect =\n                getRelativePosition(mouseOffsetPosition, rect);\n\n            return 0 <= positionWithinRect.left &&\n                positionWithinRect.left < rect.width &&\n                0 <= positionWithinRect.top &&\n                positionWithinRect.top < rect.height;\n        }\n\n        /**\n         * Return whether the given mouse position (coordinates relative to the\n         * viewport) is hovering over this highlight.\n         */\n        isHovered(mouseClientPosition) {\n            if (!mouseClientPosition) {\n                return false;\n            }\n\n            const {offsetParent} = this.props;\n            const {cachedHighlightRects} = this.state;\n\n            // Convert the client-relative mouse coordinates to be relative to the\n            // offset parent. That way, we can compare them to the cached highlight\n            // rectangles.\n            const offsetParentRect = offsetParent.getBoundingClientRect();\n            const mouseOffsetPosition =\n                getRelativePosition(mouseClientPosition, offsetParentRect);\n\n            return cachedHighlightRects.some(rect => this._rectIsHovered(rect, mouseOffsetPosition));\n        }\n\n        render() {\n            const rects = this.state.cachedHighlightRects;\n\n            return (\n                <div>\n                    {rects.map((rect, index) => <div\n                        key={index}\n                        className={css(styles.highlightRect)}\n                        style={{\n                            // NOTE(mdr): We apply `position: absolute` here\n                            //     rather than in Aphrodite styles, because\n                            //     Aphrodite styles are delayed. If this\n                            //     element temporarily has `position: static`,\n                            //     then it'll displace the content, and other\n                            //     highlights rendering during this update will\n                            //     measure the displaced content instead, oops!\n                            position: \"absolute\",\n                            width: rect.width,\n                            height: rect.height,\n                            top: rect.top,\n                            left: rect.left,\n                            zIndex: this.props.zIndexes.belowContent,\n                        }}\n                    />\n                    )}\n                </div>\n            );\n        }\n    }\n\n    const styles = StyleSheet.create({\n        highlightRect: {\n            background: \"#fffabe\", // highlighter yellow :)\n        },\n    });\n\n    _module_.exports = HighlightRenderer;\n}).call(_module_.exports);\n\nexport default _module_.exports;\n","import _highlightTooltipJsx from \"./highlight-tooltip.jsx\";\nimport _highlightRendererJsx from \"./highlight-renderer.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * Render a set of highlights. See HighlightRenderer for more details about how\n * each highlight is rendered.\n *\n * This component manages the state of the \"Remove highlight\" tooltip. To\n * determine the currently-hovered highlight, it calls the `isHovered` method\n * on each HighlightRenderer.\n */\nconst React = _react;\n\nconst HighlightRenderer = _highlightRendererJsx;\nconst HighlightTooltip = _highlightTooltipJsx;\n\nclass HighlightSetRenderer extends React.PureComponent {\n    state = {\n        mouseClientPosition: null,\n        hoveringTooltipFor: null,\n    };\n\n    // eslint-disable-next-line react/sort-comp\n    _highlightRenderers = {};\n\n    componentDidMount() {\n        this._updateEditListeners(false, this.props.editable);\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this._updateEditListeners(this.props.editable, nextProps.editable);\n\n        // If we were previously hovering over the tooltip for a highlight that\n        // has since been removed, reset the hover state accordingly.\n        if (\n            typeof this.state.hoveringTooltipFor === \"string\" &&\n            !(this.state.hoveringTooltipFor in nextProps.highlights)\n        ) {\n            this.setState({hoveringTooltipFor: null});\n        }\n    }\n\n    componentWillUnmount() {\n        this._updateEditListeners(this.props.editable, false);\n    }\n\n    /**\n     * Given whether we were previously listening to mousemove events, and\n     * whether we will now listen to mousemove events, add or remove the\n     * listener accordingly.\n     */\n    _updateEditListeners(wasListening, willListen) {\n        if (!wasListening && willListen) {\n            window.addEventListener(\"mousemove\", this._handleMouseMove);\n        } else if (wasListening && !willListen) {\n            window.removeEventListener(\"mousemove\", this._handleMouseMove);\n\n            // Additionally, reset the mouse position. Our child components\n            // won't be checking `mouseClientPosition` when we're not\n            // listening, anyway, but this guards against errors where we\n            // re-enter listening mode and have stale coordinates stored in\n            // state.\n            this.setState({\n                mouseClientPosition: null,\n            });\n        }\n    }\n\n    _handleMouseMove = e => {\n        this.setState({\n            mouseClientPosition: {\n                left: e.clientX,\n                top: e.clientY,\n            },\n        });\n    }\n\n    _getHoveredHighlightKey() {\n        // If we're hovering over the tooltip, the hovered highlight is the\n        // highlight that the tooltip is pointing to.\n        const {hoveringTooltipFor} = this.state;\n        if (typeof hoveringTooltipFor === \"string\") {\n            return hoveringTooltipFor;\n        }\n\n        // Otherwise, check each highlight renderer to see whether the current\n        // mouse position intersects any of the highlight rectangles.\n        const highlightKeys = Object.keys(this.props.highlights);\n        return highlightKeys.find(key => {\n            const highlightRenderer = this._highlightRenderers[key];\n            return highlightRenderer &&\n                highlightRenderer.isHovered(this.state.mouseClientPosition);\n        });\n    }\n\n    _renderTooltip() {\n        const hoveredHighlightKey = this._getHoveredHighlightKey();\n        if (typeof hoveredHighlightKey !== \"string\") {\n            return null;\n        }\n\n        const hoveredHighlight = this.props.highlights[hoveredHighlightKey];\n\n        return (\n            <HighlightTooltip\n                label={i18n._(\"Remove highlight\")}\n\n                focusNode={hoveredHighlight.domRange.endContainer}\n                focusOffset={hoveredHighlight.domRange.endOffset}\n                offsetParent={this.props.offsetParent}\n                zIndex={this.props.zIndexes.aboveContent}\n\n                onClick={\n                    () => this.props.onRemoveHighlight(hoveredHighlightKey)}\n                onMouseEnter={\n                    () => this.setState({hoveringTooltipFor: hoveredHighlightKey})}\n                onMouseLeave={\n                    () => this.setState({hoveringTooltipFor: null})}\n            />\n        );\n    }\n\n    render() {\n        return (\n            <div>\n                {Object.keys(this.props.highlights).map(key => <HighlightRenderer\n                    ref={r => {\n                        if (r) {\n                            this._highlightRenderers[key] = r;\n                        } else {\n                            delete this._highlightRenderers[key];\n                        }\n                    }}\n                    editable={this.props.editable}\n                    key={key}\n                    highlight={this.props.highlights[key]}\n                    highlightKey={key}\n                    mouseClientPosition={this.state.mouseClientPosition}\n                    offsetParent={this.props.offsetParent}\n                    onRemoveHighlight={this.props.onRemoveHighlight}\n                    zIndexes={this.props.zIndexes}\n                />\n                )}\n                {this.props.editable && this._renderTooltip()}\n            </div>\n        );\n    }\n}\n\n_module_.exports = HighlightSetRenderer;\nexport default _module_.exports;\n","import _selectionTrackerJsx from \"./selection-tracker.jsx\";\nimport { rangesOverlap } from \"../ranges.js\";\nimport _highlightTooltipJsx from \"./highlight-tooltip.jsx\";\nimport _highlightSetRendererJsx from \"./highlight-set-renderer.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * This component, given a set of DOMHighlights, draws highlight rectangles in\n * the same absolute position as the highlighted content, as computed by the\n * range's `getClientRects` method.\n *\n * TODO(mdr): Many things can affect the correct positioning of highlighting,\n *     and this component does not attempt to anticipate them. If we start\n *     using this highlighting library on content with a more dynamic layout,\n *     we should add a hook to allow the parent to `forceUpdate` the\n *     `HighlightingUI`.\n */\nconst React = _react;\n\nconst HighlightSetRenderer = _highlightSetRendererJsx;\nconst HighlightTooltip = _highlightTooltipJsx;\nconst SelectionTracker = _selectionTrackerJsx;\n\nclass HighlightingUI extends React.PureComponent {\n    _handleAddHighlight(highlightToAdd) {\n        this.props.onAddHighlight(highlightToAdd);\n\n        // Deselect the newly-highlighted text, by collapsing the selection\n        // to the end of the range.\n        const selection = document.getSelection();\n        if (selection) {\n            selection.collapseToEnd();\n        }\n    }\n\n    _selectionIsValid(trackedSelection) {\n        if (!trackedSelection) {\n            return false;\n        }\n\n        const {contentNode} = this.props;\n\n        // Create a range over the content node.\n        const contentRange = new Range();\n        contentRange.selectNodeContents(contentNode);\n\n        // Create a range over the focus position.\n        const focusRange = new Range();\n        focusRange.setStart(\n            trackedSelection.focusNode, trackedSelection.focusOffset);\n        focusRange.collapse(true /* to start */);\n\n        // Determine whether the content range contains the focus, by checking\n        // whether they intersect. Because the focus range is a single point,\n        // intersection is equivalent to being fully contained.\n        const contentContainsFocus = rangesOverlap(contentRange, focusRange);\n\n        // If the content contains the focus, this is a valid selection. Some\n        // parts of the range might go beyond the content, but that's okay; the\n        // corresponding DOMHighlight is already trimmed to only contain valid\n        // words. We're just checking that the tooltip we render will be inside\n        // the content, because rendering a tooltip outside the content would\n        // be weird.\n        const selectionIsValid = contentContainsFocus;\n\n        return selectionIsValid;\n    }\n\n    render() {\n        return (\n            <SelectionTracker\n                buildHighlight={this.props.buildHighlight}\n                enabled={this.props.editable}\n            >\n                {(trackedSelection, userIsMouseSelecting) => <div>\n                    <HighlightSetRenderer\n                        editable={\n                            /* An existing highlight is editable when the\n                             * component is in editable mode, and there's no\n                             * selection in progress. */\n                            this.props.editable &&\n                                !this._selectionIsValid(trackedSelection)}\n                        highlights={this.props.highlights}\n                        offsetParent={this.props.offsetParent}\n                        onRemoveHighlight={this.props.onRemoveHighlight}\n                        zIndexes={this.props.zIndexes}\n                    />\n                    {this._selectionIsValid(trackedSelection) &&\n                        !userIsMouseSelecting &&\n                        <HighlightTooltip\n                            label={i18n._(\"Add highlight\")}\n                            onClick={() => this._handleAddHighlight(\n                                trackedSelection.proposedHighlight)}\n\n                            focusNode={trackedSelection.focusNode}\n                            focusOffset={trackedSelection.focusOffset}\n                            offsetParent={this.props.offsetParent}\n                            zIndex={this.props.zIndexes.aboveContent}\n                        />\n                    }\n                </div>\n                }\n            </SelectionTracker>\n        );\n    }\n}\n\n_module_.exports = HighlightingUI;\nexport default _module_.exports;\n","import { addHighlight, buildHighlight, deserializeHighlight, serializeHighlight } from \"./highlights.js\";\nimport _wordIndexerJsx from \"./word-indexer.jsx\";\nimport _uiHighlightingUiJsx from \"./ui/highlighting-ui.jsx\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * The entry point for highlighting!\n *\n * Given a content node and a set of serialized highlights, this component\n * renders the content with the given highlights applied. The content's DOM is\n * not modified by this process, so any content should be safe to pass to this\n * component.\n *\n * This component also renders controls for the user to add/remove/update\n * highlights. When the user does so, this component will update the full set\n * of highlights, serialize them, and call `onSerializedHighlightsUpdate` with\n * new set of serialized highlights, which you can then persist and send back\n * down to this component. Easy peasy!\n */\nconst React = _react;\n\nconst HighlightingUI = _uiHighlightingUiJsx;\nconst WordIndexer = _wordIndexerJsx;\n\nclass HighlightableContent extends React.PureComponent {\n    state = {\n        wordRanges: [],\n    };\n\n    _buildHighlight(highlightRange) {\n        // TODO(mdr): If _buildHighlight starts getting called more often, we\n        //     might want to cache the DOMHighlightSet instead of recomputing\n        //     it here.\n        return buildHighlight(\n            this._getDOMHighlights(), this.state.wordRanges, highlightRange);\n    }\n\n    /**\n     * Take the highlights from props, and deserialize them into DOMHighlights,\n     * according to the latest cache of word ranges.\n     */\n    _getDOMHighlights() {\n        const {serializedHighlights} = this.props;\n        const {wordRanges} = this.state;\n\n        const domHighlights = {};\n        for (const key of Object.keys(serializedHighlights)) {\n            domHighlights[key] =\n                deserializeHighlight(serializedHighlights[key], wordRanges);\n        }\n        return domHighlights;\n    }\n\n    /**\n     * Add the given DOMHighlight to the current set.\n     */\n    _handleAddHighlight = highlight => {\n        const newDomHighlights =\n            addHighlight(this._getDOMHighlights(), highlight);\n\n        const newSerializedHighlights = {};\n        for (const key of Object.keys(newDomHighlights)) {\n            newSerializedHighlights[key] =\n                serializeHighlight(newDomHighlights[key]);\n        }\n\n        this.props.onSerializedHighlightsUpdate(newSerializedHighlights);\n    }\n\n    /**\n     * Remove the given highlight from the list, and call our callback with the\n     * new set of highlights.\n     */\n    _handleRemoveHighlight = keyToRemove => {\n        const {serializedHighlights} = this.props;\n        const newSerializedHighlights = {...serializedHighlights};\n        delete newSerializedHighlights[keyToRemove];\n        this.props.onSerializedHighlightsUpdate(newSerializedHighlights);\n    }\n\n    /**\n     * When our WordIndexer sends us a new cache of word ranges, store it in\n     * our component state.\n     */\n    _handleWordsUpdate = wordRanges => {\n        this.setState({wordRanges});\n    }\n\n    render() {\n        const highlights = this._getDOMHighlights();\n\n        // NOTE(mdr): This lambda is rebuilt every time this component updates,\n        //     so every update to HighlightableContent triggers an update in\n        //     the child HighlightingUI and SelectionTracker, even if the\n        //     behavior hasn't changed.\n        //\n        //     Over-updating is preferable to under-updating here, because some\n        //     updates in this component's props/state *do* affect\n        //     `buildHighlight`'s behavior, and *should* trigger an update.\n        //\n        //     A more performant approach would be to cache this function\n        //     object until its implicitly-bound inputs change. If profiling\n        //     leads us to implement such caching, this draft might be a good\n        //     starting point: https://phabricator.khanacademy.org/D35623?id=170698\n        const buildHighlight = r => this._buildHighlight(r);\n\n        return (\n            <div\n                className={css(styles.container)}\n                ref={container => this._container = container}\n            >\n                <div>\n                    {this.props.enabled && this._container && this._content &&\n                        <HighlightingUI\n                            buildHighlight={buildHighlight}\n                            contentNode={this._content}\n                            editable={this.props.editable}\n                            highlights={highlights}\n                            offsetParent={this._container}\n                            zIndexes={{\n                                // The content has a z-index of 1, so, to be above\n                                // or below the content, use z-index of 2 or 0,\n                                // respectively.\n                                aboveContent: 2,\n                                belowContent: 0,\n                            }}\n\n                            onAddHighlight={this._handleAddHighlight}\n                            onRemoveHighlight={this._handleRemoveHighlight}\n                        />\n                    }\n                </div>\n                <div\n                    className={css(styles.content)}\n                    ref={content => this._content = content}\n                >\n                    <WordIndexer onWordsUpdate={this._handleWordsUpdate}>\n                        {this.props.children}\n                    </WordIndexer>\n                </div>\n            </div>\n        );\n    }\n}\n\nconst styles = StyleSheet.create({\n    // We render content with z-index 1, and highlights with z-index 0, so that\n    // content will receive the browser's native pointer events. (Highlights\n    // have their own magic code to manage hover detection, despite being\n    // behind the content.)\n\n    container: {\n        // Position the container and give it a z-index, to scope the z-indexes\n        // inside by creating a stacking context.\n        // https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context\n        //\n        // This way, content's z-index of 1, and highlights' z-index of 0, and\n        // tooltips' z-index of 2 don't interact with anything external;\n        // external UI will see `HighlightableContent` as a single flat layer\n        // with a z-index of 0. This removes the need for us to coordinate our\n        // choices of z-index with external UI.\n        position: \"relative\",\n        zIndex: 0,\n    },\n\n    content: {\n        // NOTE(mdr): Creating a stacking context for content of z-index 1 may\n        //    be problematic if the content and external page want to\n        //    interleave layers between each other, e.g., if the application UI\n        //    wants to render something above some parts of our content, but\n        //    below other parts. It's not relevant for the current Passage-only\n        //    call site, but could be relevant someday\n        position: \"relative\",\n        zIndex: 1,\n    },\n});\n\n_module_.exports = HighlightableContent;\nexport default _module_.exports;\n","import { linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _passagePassageMarkdownJsx from \"./passage/passage-markdown.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsHighlightingHighlightableContentJsx from \"../components/highlighting/highlightable-content.jsx\";\nimport _jquery from \"jquery\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\nconst $ = _jquery;\n\nconst HighlightableContent = _componentsHighlightingHighlightableContentJsx;\nconst Renderer = _rendererJsx;\nconst PassageMarkdown = _passagePassageMarkdownJsx;\n\n// A fake paragraph to measure the line height of the passage. In CSS we always\n// set the line height to 22 pixels, but when using the browser zoom feature,\n// the line height often ends up being a fractional number of pixels close to\n// 22 pixels.\nclass LineHeightMeasurer extends React.Component {\n    measureLineHeight() {\n        if (typeof this._cachedLineHeight !== \"number\") {\n            this.forceMeasureLineHeight();\n        }\n\n        return this._cachedLineHeight;\n    }\n\n    forceMeasureLineHeight() {\n        // Add some text which magically fills an entire line.\n        this.$body.text(\" \\u0080\");\n\n        // Now, the line height is the difference between the top of the\n        // second line and the top of the first line.\n        this._cachedLineHeight =\n            this.$end.offset().top - this.$body.offset().top;\n\n        // Clear out the first line so it doesn't overlap the passage.\n        this.$body.text(\"\");\n    }\n\n    render() {\n        return (\n            <div className={css(styles.measurer)}>\n                <div>\n                    <div ref={e => this.$body = $(e)} className=\"paragraph\" />\n                    <div ref={e => this.$end = $(e)} />\n                </div>\n            </div>\n        );\n    }\n}\n\nconst styles = StyleSheet.create({\n    measurer: {\n        position: \"absolute\",\n        width: \"100%\",\n        top: 0,\n        left: 0,\n    },\n});\n\nclass Passage extends React.Component {\n    static defaultProps = {\n        passageTitle: \"\",\n        passageText: \"\",\n        footnotes: \"\",\n        showLineNumbers: true,\n        highlights: {},\n        linterContext: linterContextDefault,\n    };\n\n    state = {\n        nLines: null,\n        startLineNumbersAfter: 0,\n        stylesAreApplied: false,\n    };\n\n    componentDidMount() {\n        this._updateState();\n\n        this._onResize = _.throttle(() => {\n            // If we're rendering JIPT text, we won't have line numbers or a\n            // line height measurer, so skip handling this resize.\n            if (this.shouldRenderJipt()) {\n                return;\n            }\n\n            // Remeasure the line height on resize, because the only line\n            // height changes we expect are subpixel changes when the user\n            // zooms in/out, and the only way to listen for zoom events is to\n            // listen for resize events.\n            this._lineHeightMeasurer.forceMeasureLineHeight();\n            this._updateState();\n        }, 500);\n        window.addEventListener(\"resize\", this._onResize);\n\n        // Wait for Aphrodite styles (which are guaranteed to apply after one\n        // tick), then set state.\n        //\n        // This flag is used to set the `enabled` prop of the\n        // `HighlightableContent` component. That way, we only show highlights\n        // once styles are ready, and they're measured with the correct\n        // position.\n        //\n        // HACK(mdr): It's not really the Passage's Aphrodite styles that are\n        //     causing bad measures, but more so the Khan Academy Test Prep\n        //     app's Aphrodite styles. We would ideally instead offer the\n        //     embedding application an API to signal that the app's layout has\n        //     changed in a way that affects the Renderer... but, for now, just\n        //     hardcode this hack into here.\n        window.setTimeout(() => {\n            this.setState({stylesAreApplied: true});\n        }, 0);\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return (\n            !_.isEqual(this.props, nextProps) ||\n            !_.isEqual(this.state, nextState)\n        );\n    }\n\n    componentDidUpdate() {\n        this._updateState();\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"resize\", this._onResize);\n    }\n\n    _handleSerializedHighlightsUpdate = serializedHighlights => {\n        this.props.onChange({highlights: serializedHighlights});\n    };\n\n    /**\n     * Line numbering\n     *\n     * These functions support passage line numbering, which is non-trivial\n     * because we manually measure lines to support resizing as well as\n     * continuing line numbers from previous passages.\n     */\n\n    _updateState() {\n        // If we're rendering JIPT text, we're not rendering line numbers so we\n        // don't need to update this state.\n        if (this.shouldRenderJipt()) {\n            return;\n        }\n\n        this.setState({\n            nLines: this._measureLines(),\n            startLineNumbersAfter: this._getInitialLineNumber(),\n        });\n    }\n\n    _measureLines() {\n        const $renderer = $(ReactDOM.findDOMNode(this.refs.content));\n        const contentsHeight = $renderer.height();\n        const lineHeight = this._getLineHeight();\n        const nLines = Math.round(contentsHeight / lineHeight);\n        return nLines;\n    }\n\n    _getInitialLineNumber() {\n        let isPassageBeforeThisPassage = true;\n        const passagesBeforeUs = this.props.findWidgets((id, widgetInfo) => {\n            if (widgetInfo.type !== \"passage\") {\n                return false;\n            }\n            if (id === this.props.widgetId) {\n                isPassageBeforeThisPassage = false;\n            }\n            return isPassageBeforeThisPassage;\n        });\n\n        return passagesBeforeUs\n            .map(passageWidget => {\n                return passageWidget.getLineCount();\n            })\n            .reduce((a, b) => a + b, 0);\n    }\n\n    _getLineHeight() {\n        return this._lineHeightMeasurer.measureLineHeight();\n    }\n\n    getLineCount() {\n        if (this.state.nLines != null) {\n            return this.state.nLines;\n        } else {\n            return this._measureLines();\n        }\n    }\n\n    /**\n     * Passage refs\n     *\n     * These are functions to support the passage refs inter-widgets feature\n     * where other widgets can fetch the line numbers of a reference inside of\n     * a passage.\n     */\n\n    _getStartRefLineNumber(referenceNumber) {\n        const refRef = PassageMarkdown.START_REF_PREFIX + referenceNumber;\n        const ref = this.refs[refRef];\n        if (!ref) {\n            return null;\n        }\n\n        const $ref = $(ReactDOM.findDOMNode(ref));\n        // We really care about the first text after the ref, not the\n        // ref element itself:\n        let $refText = $ref.next();\n        if ($refText.length === 0) {\n            // But if there are no elements after the ref, just\n            // use the ref itself.\n            $refText = $ref;\n        }\n        const vPos = $refText.offset().top;\n\n        return (\n            this.state.startLineNumbersAfter +\n            1 +\n            this._convertPosToLineNumber(vPos)\n        );\n    }\n\n    _getEndRefLineNumber(referenceNumber) {\n        const refRef = PassageMarkdown.END_REF_PREFIX + referenceNumber;\n        const ref = this.refs[refRef];\n        if (!ref) {\n            return null;\n        }\n\n        const $ref = $(ReactDOM.findDOMNode(ref));\n        // We really care about the last text before the ref, not the\n        // ref element itself:\n        let $refText = $ref.prev();\n        if ($refText.length === 0) {\n            // But if there are no elements before the ref, just\n            // use the ref itself.\n            $refText = $ref;\n        }\n        const height = $refText.height();\n        const vPos = $refText.offset().top;\n\n        let line = this._convertPosToLineNumber(vPos + height);\n        if (height === 0) {\n            // If the element before the end ref span was the start\n            // ref span, it might have 0 height. This is obviously not\n            // the intended use case, but we should handle it gracefully.\n            // If this is the case, then the \"bottom\" of our element is\n            // actually the top of the line we're on, so we need to add\n            // one to the line number.\n            line += 1;\n        }\n\n        return this.state.startLineNumbersAfter + line;\n    }\n\n    _convertPosToLineNumber(absoluteVPos) {\n        const $content = $(ReactDOM.findDOMNode(this.refs.content));\n        const relativeVPos = absoluteVPos - $content.offset().top;\n        const lineHeight = this._getLineHeight();\n\n        const line = Math.round(relativeVPos / lineHeight);\n        return line;\n    }\n\n    _getRefContent(referenceNumber) {\n        const refRef = PassageMarkdown.START_REF_PREFIX + referenceNumber;\n        const ref = this.refs[refRef];\n        if (!ref) {\n            return null;\n        }\n        return ref.getRefContent();\n    }\n\n    getReference(referenceNumber) {\n        const refStartLine = this._getStartRefLineNumber(referenceNumber);\n        const refEndLine = this._getEndRefLineNumber(referenceNumber);\n        if (refStartLine == null || refEndLine == null) {\n            return null;\n        }\n        const refContent = this._getRefContent(referenceNumber);\n\n        return {\n            startLine: refStartLine,\n            endLine: refEndLine,\n            content: refContent,\n        };\n    }\n\n    /**\n     * Misc functions\n     *\n     * These are misc widget functions used for the widget API\n     */\n\n    getUserInput() {\n        return null;\n    }\n\n    simpleValidate(rubric) {\n        return Passage.validate(this.getUserInput(), rubric);\n    }\n\n    /* eslint-disable react/sort-comp */\n    static validate(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    }\n    /* eslint-enable react/sort-comp */\n\n    /**\n     * Rendering\n     *\n     * Functions to render the passage widget.\n     */\n\n    _renderInstructions(parseState) {\n        const firstQuestionNumber = parseState.firstQuestionRef;\n        const firstSentenceRef = parseState.firstSentenceRef;\n\n        let instructions = \"\";\n        if (firstQuestionNumber) {\n            instructions += i18n._(\n                \"The symbol %(questionSymbol)s indicates that question \" +\n                    \"%(questionNumber)s references this portion of the \" +\n                    \"passage.\",\n                {\n                    questionSymbol: \"[[\" + firstQuestionNumber + \"]]\",\n                    questionNumber: firstQuestionNumber,\n                }\n            );\n        }\n        if (firstSentenceRef) {\n            instructions += i18n._(\n                \" The symbol %(sentenceSymbol)s indicates that the \" +\n                    \"following sentence is referenced in a question.\",\n                {\n                    sentenceSymbol: \"[\" + firstSentenceRef + \"]\",\n                }\n            );\n        }\n        const parsedInstructions = PassageMarkdown.parse(instructions);\n        return (\n            <div className=\"perseus-widget-passage-instructions\">\n                {PassageMarkdown.output(parsedInstructions)}\n            </div>\n        );\n    }\n\n    shouldRenderJipt() {\n        // Mostly copied from `renderer.jsx`. If we're doing JIPT, we want to\n        // render our content differently.\n        return (\n            // $FlowFixMe KA is a global\n            typeof KA !== \"undefined\" &&\n            KA.language === \"en-pt\" &&\n            this.props.passageText.indexOf(\"crwdns\") !== -1\n        );\n    }\n\n    _renderContent(parsed) {\n        // Wait until Aphrodite styles are applied before enabling highlights,\n        // so that we measure the correct positions.\n        const enabled = this.state.stylesAreApplied;\n\n        // Highlights are read-only in review mode.\n        const editable = !this.props.reviewModeRubric;\n\n        return (\n            <HighlightableContent\n                editable={editable}\n                enabled={enabled}\n                onSerializedHighlightsUpdate={\n                    this._handleSerializedHighlightsUpdate\n                }\n                serializedHighlights={this.props.highlights}\n            >\n                <div ref=\"content\">\n                    <LineHeightMeasurer\n                        ref={e => this._lineHeightMeasurer = e}\n                    />\n                    {PassageMarkdown.output(parsed)}\n                </div>\n            </HighlightableContent>\n        );\n    }\n\n    _hasFootnotes() {\n        const rawContent = this.props.footnotes;\n        const isEmpty = /^\\s*$/.test(rawContent);\n        return !isEmpty;\n    }\n\n    _renderFootnotes() {\n        const rawContent = this.props.footnotes;\n        const parsed = PassageMarkdown.parse(rawContent);\n        return PassageMarkdown.output(parsed);\n    }\n\n    render() {\n        let lineNumbers;\n        const nLines = this.state.nLines;\n        if (this.props.showLineNumbers && nLines) {\n            // lineN is the line number in the current passage;\n            // the displayed line number is\n            // lineN + this.state.startLineNumbersAfter, where\n            // startLineNumbersAfter is the sum of all line numbers\n            // in earlier passages.\n            lineNumbers = _.range(1, nLines + 1).map(lineN => {\n                if (lineN === 4 && nLines > 4) {\n                    return (\n                        <span key=\"line-marker\" className=\"line-marker\">\n                            Line\n                        </span>\n                    );\n                } else {\n                    return (\n                        <span key={lineN}>\n                            {lineN + this.state.startLineNumbersAfter}\n                        </span>\n                    );\n                }\n            });\n        }\n\n        const parseState = {\n            firstSentenceRef: null,\n            firstQuestionRef: null,\n        };\n        const parsedContent = PassageMarkdown.parse(\n            this.props.passageText,\n            parseState\n        );\n\n        // Check if the title has any non-empty text in it.\n        const hasTitle = /\\S/.test(this.props.passageTitle);\n\n        return (\n            <div>\n                <div className=\"perseus-widget-passage-container\">\n                    {this._renderInstructions(parseState)}\n                    <div className=\"perseus-widget-passage\">\n                        {hasTitle &&\n                            <h3 className=\"passage-title\">\n                                <Renderer\n                                    content={this.props.passageTitle}\n                                    linterContext={this.props.linterContext}\n                                />\n                            </h3>}\n                        {lineNumbers &&\n                            <div className=\"line-numbers\" aria-hidden={true}>\n                                {lineNumbers}\n                            </div>}\n                        {!hasTitle &&\n                            <h3 className=\"perseus-sr-only\">\n                                {i18n._(\"Beginning of reading passage.\")}\n                            </h3>}\n                        <div className=\"passage-text\">\n                            {this.shouldRenderJipt()\n                                ? // If we're in JIPT mode, just pass off our\n                                  // content to a <Renderer /> which knows how\n                                  // to handle rendering JIPT text.\n                                  <Renderer content={this.props.passageText} />\n                                : this._renderContent(parsedContent)}\n                        </div>\n                        {this._hasFootnotes() && [\n                            <h4\n                                key=\"footnote-start\"\n                                className=\"perseus-sr-only\"\n                            >\n                                {i18n._(\n                                    \"Beginning of reading passage footnotes.\"\n                                )}\n                            </h4>,\n                            <div key=\"footnotes\" className=\"footnotes\">\n                                {this._renderFootnotes()}\n                            </div>,\n                        ]}\n                        <div className=\"perseus-sr-only\">\n                            {i18n._(\"End of reading passage.\")}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\n_module_.exports = {\n    name: \"passage\",\n    displayName: \"Passage (SAT only)\",\n    widget: Passage,\n    transform: editorProps => {\n        return _.pick(\n            editorProps,\n            \"passageTitle\",\n            \"passageText\",\n            \"footnotes\",\n            \"showLineNumbers\"\n        );\n    },\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _componentsTextListEditorJsx from \"../components/text-list-editor.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, max-len, no-var, object-curly-spacing, one-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst TextListEditor = _componentsTextListEditorJsx;\n\nvar NORMAL = \"normal\",\n    AUTO = \"auto\",\n    HORIZONTAL = \"horizontal\",\n    VERTICAL = \"vertical\";\n\nconst OrdererEditor = createReactClass({\n    propTypes: {\n        correctOptions: PropTypes.array,\n        otherOptions: PropTypes.array,\n        height: PropTypes.oneOf([NORMAL, AUTO]),\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        onChange: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correctOptions: [{content: \"$x$\"}],\n            otherOptions: [{content: \"$y$\"}],\n            height: NORMAL,\n            layout: HORIZONTAL,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-widget-orderer\">\n                <div>\n                    {\" \"}Correct answer:{\" \"}\n                    <InfoTip>\n                        <p>\n                            Place the cards in the correct order. The same card\n                            can be used more than once in the answer but will\n                            only be displayed once at the top of a stack of\n                            identical cards.\n                        </p>\n                    </InfoTip>\n                </div>\n                <TextListEditor\n                    options={_.pluck(this.props.correctOptions, \"content\")}\n                    onChange={this.onOptionsChange.bind(this, \"correctOptions\")}\n                    layout={this.props.layout}\n                />\n\n                <div>\n                    {\" \"}Other cards:{\" \"}\n                    <InfoTip>\n                        <p>Create cards that are not part of the answer.</p>\n                    </InfoTip>\n                </div>\n                <TextListEditor\n                    options={_.pluck(this.props.otherOptions, \"content\")}\n                    onChange={this.onOptionsChange.bind(this, \"otherOptions\")}\n                    layout={this.props.layout}\n                />\n\n                <div>\n                    <label>\n                        {\" \"}Layout:{\" \"}\n                        <select\n                            value={this.props.layout}\n                            onChange={this.onLayoutChange}\n                        >\n                            <option value={HORIZONTAL}>Horizontal</option>\n                            <option value={VERTICAL}>Vertical</option>\n                        </select>\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Use the horizontal layout for short text and small\n                            images. The vertical layout is best for longer text\n                            (e.g. proofs).\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    <label>\n                        {\" \"}Height:{\" \"}\n                        <select\n                            value={this.props.height}\n                            onChange={this.onHeightChange}\n                        >\n                            <option value={NORMAL}>Normal</option>\n                            <option value={AUTO}>Automatic</option>\n                        </select>\n                    </label>\n                    <InfoTip>\n                        <p>Use \"Normal\" for text, \"Automatic\" for images.</p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n\n    onOptionsChange: function(whichOptions, options, cb) {\n        var props = {};\n        props[whichOptions] = _.map(options, function(option) {\n            return {content: option};\n        });\n        this.props.onChange(props, cb);\n    },\n\n    onLayoutChange: function(e) {\n        this.props.onChange({layout: e.target.value});\n    },\n\n    onHeightChange: function(e) {\n        this.props.onChange({height: e.target.value});\n    },\n\n    serialize: function() {\n        // We combine the correct answer and the other cards by merging them,\n        // removing duplicates and empty cards, and sorting them into\n        // categories based on their content\n        var options = _.chain(_.pluck(this.props.correctOptions, \"content\"))\n            .union(_.pluck(this.props.otherOptions, \"content\"))\n            .uniq()\n            .reject(function(content) {\n                return content === \"\";\n            })\n            .sort()\n            .sortBy(function(content) {\n                if (/\\d/.test(content)) {\n                    return 0;\n                } else if (/^\\$?[a-zA-Z]+\\$?$/.test(content)) {\n                    return 2;\n                } else {\n                    return 1;\n                }\n            })\n            .map(function(content) {\n                return {content: content};\n            })\n            .value();\n\n        return {\n            options: options,\n            correctOptions: this.props.correctOptions,\n            otherOptions: this.props.otherOptions,\n            height: this.props.height,\n            layout: this.props.layout,\n        };\n    },\n});\n\n_module_.exports = OrdererEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _utilJs from \"../util.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, max-len, no-console, no-unused-vars, no-var, one-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar Renderer = _rendererJsx;\nvar Util = _utilJs;\n\nvar ApiClassNames = _perseusApiJsx.ClassNames;\n\nvar PlaceholderCard = createReactClass({\n    propTypes: {\n        width: PropTypes.number.isRequired,\n        height: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        return (\n            <div\n                className={\"card-wrap \" + ApiClassNames.INTERACTIVE}\n                style={{width: this.props.width}}\n            >\n                <div\n                    className=\"card placeholder\"\n                    style={{height: this.props.height}}\n                />\n            </div>\n        );\n    },\n});\n\nvar DragHintCard = createReactClass({\n    render: function() {\n        return (\n            <div className={\"card-wrap \" + ApiClassNames.INTERACTIVE}>\n                <div className=\"card drag-hint\" />\n            </div>\n        );\n    },\n});\n\nvar PropTypes_position = PropTypes.shape({\n        left: PropTypes.number,\n        top: PropTypes.number,\n    });\n\nvar Card = createReactClass({\n    propTypes: {\n        floating: PropTypes.bool.isRequired,\n        animating: PropTypes.bool,\n        width: PropTypes.number,\n        stack: PropTypes.bool,\n\n        onMouseDown: PropTypes.func,\n        onMouseMove: PropTypes.func,\n        onMouseUp: PropTypes.func,\n\n        // Used only for floating/animating cards\n        startMouse: PropTypes_position,\n        startOffset: PropTypes_position,\n        animateTo: PropTypes_position,\n        onAnimationEnd: PropTypes.func,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            stack: false,\n            animating: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    render: function() {\n        var style = {};\n\n        if (this.props.floating) {\n            style = {\n                position: \"absolute\",\n                left: this.props.startOffset.left,\n                top: this.props.startOffset.top,\n            };\n        }\n\n        if (this.props.width) {\n            style.width = this.props.width;\n        }\n\n        var className = [\"card\"];\n        if (this.props.stack) {\n            className.push(\"stack\");\n        }\n        if (this.props.floating && !this.props.animating) {\n            className.push(\"dragging\");\n            style.left += this.props.mouse.left - this.props.startMouse.left;\n            style.top += this.props.mouse.top - this.props.startMouse.top;\n        }\n\n        // Pull out the content to get rendered\n        var rendererProps = _.pick(this.props, \"content\");\n\n        var onMouseDown = this.props.animating ? $.noop : this.onMouseDown;\n\n        return (\n            <div\n                className={\"card-wrap \" + ApiClassNames.INTERACTIVE}\n                style={style}\n                onMouseDown={onMouseDown}\n                onTouchStart={onMouseDown}\n                onTouchMove={this.onMouseMove}\n                onTouchEnd={this.onMouseUp}\n                onTouchCancel={this.onMouseUp}\n            >\n                <div className={className.join(\" \")}>\n                    <Renderer\n                        {...rendererProps}\n                        linterContext={this.props.linterContext}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        // Cards in the bank or drag list don't usually change -- they only\n        // reorder themselves -- so we want to skip the update to things a\n        // little faster. We also need to re-render if the content changes,\n        // which happens only in the editor. (We do want to update the floating\n        // card on mouse move to update its position.)\n        return (\n            this.props.floating ||\n            nextProps.floating ||\n            this.props.content !== nextProps.content ||\n            // TODO(alpert): Remove ref here after fixing facebook/react#1392.\n            this.props.fakeRef !== nextProps.fakeRef\n        );\n    },\n\n    componentDidMount: function() {\n        this.mouseMoveUpBound = false;\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        if (this.props.animating && !prevProps.animating) {\n            // If we just were changed into animating, start the animation.\n            // We pick the animation speed based on the distance that the card\n            // needs to travel. (Why sqrt? Just because it looks nice -- with a\n            // linear scale, far things take too long to come back.)\n            var ms =\n                15 *\n                Math.sqrt(\n                    Math.sqrt(\n                        Math.pow(\n                            this.props.animateTo.left -\n                                this.props.startOffset.left,\n                            2\n                        ) +\n                            Math.pow(\n                                this.props.animateTo.top -\n                                    this.props.startOffset.top,\n                                2\n                            )\n                    )\n                );\n            $(ReactDOM.findDOMNode(this)).animate(\n                this.props.animateTo,\n                Math.max(ms, 1),\n                this.props.onAnimationEnd\n            );\n        }\n    },\n\n    componentWillUnmount: function() {\n        // Event handlers should be unbound before component unmounting, but\n        // just in case...\n        if (this.mouseMoveUpBound) {\n            console.warn(\"Removing an element with bound event handlers.\");\n\n            this.unbindMouseMoveUp();\n            Util.resetTouchHandlers();\n        }\n    },\n\n    bindMouseMoveUp: function() {\n        this.mouseMoveUpBound = true;\n        $(document).on(\"mousemove\", this.onMouseMove);\n        $(document).on(\"mouseup\", this.onMouseUp);\n    },\n\n    unbindMouseMoveUp: function() {\n        this.mouseMoveUpBound = false;\n        $(document).off(\"mousemove\", this.onMouseMove);\n        $(document).off(\"mouseup\", this.onMouseUp);\n    },\n\n    onMouseDown: function(event) {\n        event.preventDefault();\n        var loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.bindMouseMoveUp();\n            this.props.onMouseDown && this.props.onMouseDown(loc, this);\n        }\n    },\n\n    onMouseMove: function(event) {\n        event.preventDefault();\n        var loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.props.onMouseMove && this.props.onMouseMove(loc);\n        }\n    },\n\n    onMouseUp: function(event) {\n        event.preventDefault();\n        var loc = Util.extractPointerLocation(event);\n        if (loc) {\n            this.unbindMouseMoveUp();\n            this.props.onMouseUp && this.props.onMouseUp(loc);\n        }\n    },\n});\n\nvar NORMAL = \"normal\",\n    AUTO = \"auto\",\n    HORIZONTAL = \"horizontal\",\n    VERTICAL = \"vertical\";\n\nvar Orderer = createReactClass({\n    propTypes: {\n        correctOptions: PropTypes.array,\n        current: PropTypes.array,\n        height: PropTypes.oneOf([NORMAL, AUTO]),\n        layout: PropTypes.oneOf([HORIZONTAL, VERTICAL]),\n        options: PropTypes.array,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            current: [],\n            options: [],\n            correctOptions: [],\n            height: NORMAL,\n            layout: HORIZONTAL,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            current: [],\n            dragging: false,\n            placeholderIndex: null,\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (!_.isEqual(this.props.current, nextProps.current)) {\n            this.setState({current: nextProps.current});\n        }\n    },\n\n    render: function() {\n        // This is the card we are currently dragging\n        var dragging =\n            this.state.dragging &&\n            <Card\n                ref=\"dragging\"\n                floating={true}\n                content={this.state.dragContent}\n                startOffset={this.state.offsetPos}\n                startMouse={this.state.grabPos}\n                mouse={this.state.mousePos}\n                width={this.state.dragWidth}\n                onMouseUp={this.onRelease}\n                onMouseMove={this.onMouseMove}\n                key={this.state.dragKey || \"draggingCard\"}\n                linterContext={this.props.linterContext}\n            />;\n\n        // This is the card that is currently animating\n        var animating =\n            this.state.animating &&\n            <Card\n                floating={true}\n                animating={true}\n                content={this.state.dragContent}\n                startOffset={this.state.offsetPos}\n                width={this.state.dragWidth}\n                animateTo={this.state.animateTo}\n                onAnimationEnd={this.state.onAnimationEnd}\n                key={this.state.dragKey || \"draggingCard\"}\n                linterContext={this.props.linterContext}\n            />;\n\n        // This is the list of draggable, rearrangable cards\n        var sortableCards = _.map(\n            this.state.current,\n            function(opt, i) {\n                return (\n                    <Card\n                        ref={\"sortable\" + i}\n                        fakeRef={\"sortable\" + i}\n                        floating={false}\n                        content={opt.content}\n                        width={opt.width}\n                        key={opt.key}\n                        linterContext={this.props.linterContext}\n                        onMouseDown={\n                            this.state.animating\n                                ? $.noop\n                                : this.onClick.bind(null, \"current\", i)\n                        }\n                    />\n                );\n            },\n            this\n        );\n\n        if (this.state.placeholderIndex != null) {\n            var placeholder = (\n                <PlaceholderCard\n                    ref=\"placeholder\"\n                    width={this.state.dragWidth}\n                    height={this.state.dragHeight}\n                    key=\"placeholder\"\n                />\n            );\n            sortableCards.splice(this.state.placeholderIndex, 0, placeholder);\n        }\n\n        var anySortableCards = sortableCards.length > 0;\n        sortableCards.push(dragging, animating);\n\n        // If there are no cards in the list, then add a \"hint\" card\n        var sortable = (\n            <div className=\"perseus-clearfix draggable-box\">\n                {!anySortableCards && <DragHintCard />}\n                <div ref=\"dragList\">\n                    {sortableCards}\n                </div>\n            </div>\n        );\n\n        // This is the bank of stacks of cards\n        var bank = (\n            <div ref=\"bank\" className=\"bank perseus-clearfix\">\n                {_.map(\n                    this.props.options,\n                    (opt, i) => {\n                        return (\n                            <Card\n                                ref={\"bank\" + i}\n                                floating={false}\n                                content={opt.content}\n                                stack={true}\n                                key={i}\n                                linterContext={this.props.linterContext}\n                                onMouseDown={\n                                    this.state.animating\n                                        ? $.noop\n                                        : this.onClick.bind(null, \"bank\", i)\n                                }\n                                onMouseMove={this.onMouseMove}\n                                onMouseUp={this.onRelease}\n                            />\n                        );\n                    },\n                    this\n                )}\n            </div>\n        );\n\n        return (\n            <div\n                className={\n                    \"draggy-boxy-thing orderer \" +\n                    \"height-\" +\n                    this.props.height +\n                    \" \" +\n                    \"layout-\" +\n                    this.props.layout +\n                    \" \" +\n                    \"above-scratchpad blank-background \" +\n                    \"perseus-clearfix \" +\n                    ApiClassNames.INTERACTIVE\n                }\n                ref=\"orderer\"\n            >\n                {bank}\n                {sortable}\n            </div>\n        );\n    },\n\n    onClick: function(type, index, loc, draggable) {\n        var $draggable = $(ReactDOM.findDOMNode(draggable));\n        var list = this.state.current.slice();\n\n        var opt;\n        var placeholderIndex = null;\n\n        if (type === \"current\") {\n            // If this is coming from the original list, remove the original\n            // card from the list\n            list.splice(index, 1);\n            opt = this.state.current[index];\n            placeholderIndex = index;\n        } else if (type === \"bank\") {\n            opt = this.props.options[index];\n        }\n\n        this.setState({\n            current: list,\n            dragging: true,\n            placeholderIndex: placeholderIndex,\n            dragKey: opt.key,\n            dragContent: opt.content,\n            dragWidth: $draggable.width(),\n            dragHeight: $draggable.height(),\n            grabPos: loc,\n            mousePos: loc,\n            offsetPos: $draggable.position(),\n        });\n    },\n\n    onRelease: function(loc) {\n        var draggable = this.refs.dragging;\n        if (draggable == null) {\n            return;\n        }\n        var inCardBank = this.isCardInBank(draggable);\n        var index = this.state.placeholderIndex;\n\n        // Here, we build a callback function for the card to call when it is\n        // done animating\n        var onAnimationEnd = () => {\n            var list = this.state.current.slice();\n\n            if (!inCardBank) {\n                // Insert the new card into the position\n                var newCard = {\n                    content: this.state.dragContent,\n                    key: _.uniqueId(\"perseus_draggable_card_\"),\n                    width: this.state.dragWidth,\n                };\n\n                list.splice(index, 0, newCard);\n            }\n\n            this.props.onChange({\n                current: list,\n            });\n            this.setState({\n                current: list,\n                dragging: false,\n                placeholderIndex: null,\n                animating: false,\n            });\n            this.props.trackInteraction();\n        };\n\n        // Find the position of the card we should animate to\n        // TODO(alpert): Update mouse position once more before animating?\n        var offset = $(ReactDOM.findDOMNode(draggable)).position();\n        var finalOffset = null;\n        if (inCardBank) {\n            // If we're in the card bank, go through the options to find the\n            // one with the same content\n            _.each(\n                this.props.options,\n                function(opt, i) {\n                    if (opt.content === this.state.dragContent) {\n                        var card = ReactDOM.findDOMNode(this.refs[\"bank\" + i]);\n                        finalOffset = $(card).position();\n                    }\n                },\n                this\n            );\n        } else if (this.refs.placeholder != null) {\n            // Otherwise, go to the position that the placeholder is at\n            finalOffset = $(\n                ReactDOM.findDOMNode(this.refs.placeholder)\n            ).position();\n        }\n\n        if (finalOffset == null) {\n            // If we didn't find a card to go to, simply make the changes we\n            // would have made at the end. (should only happen if we are\n            // messing around with card contents, and not on the real site)\n            onAnimationEnd();\n        } else {\n            this.setState({\n                offsetPos: offset,\n                animateTo: finalOffset,\n                onAnimationEnd: onAnimationEnd,\n                animating: true,\n                dragging: false,\n            });\n        }\n    },\n\n    onMouseMove: function(loc) {\n        var draggable = this.refs.dragging;\n        if (draggable == null) {\n            return;\n        }\n\n        var index;\n        if (this.isCardInBank(draggable)) {\n            index = null;\n        } else {\n            index = this.findCorrectIndex(draggable, this.state.current);\n        }\n\n        this.setState({\n            mousePos: loc,\n            placeholderIndex: index,\n        });\n    },\n\n    findCorrectIndex: function(draggable, list) {\n        // Find the correct index for a card given the current cards.\n        var isHorizontal = this.props.layout === HORIZONTAL,\n            $dragList = $(ReactDOM.findDOMNode(this.refs.dragList)),\n            leftEdge = $dragList.offset().left,\n            topEdge = $dragList.offset().top,\n            midWidth =\n                $(ReactDOM.findDOMNode(draggable)).offset().left - leftEdge,\n            midHeight =\n                $(ReactDOM.findDOMNode(draggable)).offset().top - topEdge,\n            index = 0,\n            sumWidth = 0,\n            sumHeight = 0;\n\n        if (isHorizontal) {\n            _.each(\n                list,\n                function(opt, i) {\n                    var card = ReactDOM.findDOMNode(this.refs[\"sortable\" + i]);\n                    var outerWidth = $(card).outerWidth(true);\n                    if (midWidth > sumWidth + outerWidth / 2) {\n                        index += 1;\n                    }\n                    sumWidth += outerWidth;\n                },\n                this\n            );\n        } else {\n            _.each(\n                list,\n                function(opt, i) {\n                    var card = ReactDOM.findDOMNode(this.refs[\"sortable\" + i]);\n                    var outerHeight = $(card).outerHeight(true);\n                    if (midHeight > sumHeight + outerHeight / 2) {\n                        index += 1;\n                    }\n                    sumHeight += outerHeight;\n                },\n                this\n            );\n        }\n\n        return index;\n    },\n\n    isCardInBank: function(draggable) {\n        if (draggable == null) {\n            return false;\n        }\n\n        var isHorizontal = this.props.layout === HORIZONTAL,\n            $draggable = $(ReactDOM.findDOMNode(draggable)),\n            $bank = $(ReactDOM.findDOMNode(this.refs.bank)),\n            draggableOffset = $draggable.offset(),\n            bankOffset = $bank.offset(),\n            draggableHeight = $draggable.outerHeight(true),\n            bankHeight = $bank.outerHeight(true),\n            bankWidth = $bank.outerWidth(true),\n            dragList = ReactDOM.findDOMNode(this.refs.dragList),\n            dragListWidth = $(dragList).width(),\n            draggableWidth = $draggable.outerWidth(true);\n\n        if (isHorizontal) {\n            return (\n                draggableOffset.top + draggableHeight / 2 <\n                bankOffset.top + bankHeight\n            );\n        } else {\n            return (\n                draggableOffset.left + draggableWidth / 2 <\n                bankOffset.left + bankWidth\n            );\n        }\n    },\n\n    getUserInput: function() {\n        return {\n            current: _.map(this.props.current, function(v) {\n                return v.content;\n            }),\n        };\n    },\n\n    simpleValidate: function(rubric) {\n        return Orderer.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Orderer, {\n    validate: function(state, rubric) {\n        if (state.current.length === 0) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        }\n\n        var correct = _.isEqual(\n            state.current,\n            _.pluck(rubric.correctOptions, \"content\")\n        );\n\n        return {\n            type: \"points\",\n            earned: correct ? 1 : 0,\n            total: 1,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"orderer\",\n    displayName: \"Orderer\",\n    widget: Orderer,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar ButtonGroup = _reactComponentsButtonGroupJsx;\nvar InfoTip = _componentsInfoTipJsx;\nvar NumberInput = _componentsNumberInputJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\nvar RangeInput = _componentsRangeInputJsx;\n\nvar knumber = _kmath.number;\nvar bound = (x, gt, lt) => Math.min(Math.max(x, gt), lt);\n\nvar EN_DASH = \"\\u2013\";\n\nvar NumberLineEditor = createReactClass({\n    propTypes: {\n        range: PropTypes.arrayOf(PropTypes.number).isRequired,\n\n        labelRange: PropTypes.arrayOf(PropTypes.number).isRequired,\n        labelStyle: PropTypes.string.isRequired,\n        labelTicks: PropTypes.bool,\n\n        divisionRange: PropTypes.arrayOf(PropTypes.number)\n            .isRequired,\n        numDivisions: PropTypes.number.isRequired,\n        snapDivisions: PropTypes.number,\n\n        tickStep: PropTypes.number,\n        correctRel: PropTypes.oneOf([\"lt\", \"gt\", \"le\", \"ge\", \"eq\"]),\n        correctX: PropTypes.number,\n        initialX: PropTypes.number,\n        isTickCtrl: PropTypes.bool,\n\n        onChange: PropTypes.func.isRequired,\n\n        static: PropTypes.bool,\n        showTooltips: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            range: [0, 10],\n\n            labelRange: [null, null],\n            labelStyle: \"decimal\",\n            labelTicks: true,\n\n            divisionRange: [1, 12],\n            numDivisions: 5,\n            snapDivisions: 2,\n\n            tickStep: null,\n            correctRel: \"eq\",\n            correctX: null,\n            initialX: null,\n\n            showTooltips: false,\n        };\n    },\n\n    onRangeChange: function(range) {\n        // Changing the range constrains the initial position, as well as the\n        // position of the answer and labels. Atm, it just marks them as\n        // invalid and prevents the number line from showing; it was annoying\n        // to change it for them, because if they're typing in fractions,\n        // it registers one-at-a-time and messes things up.\n        this.props.onChange({range: range});\n    },\n\n    onLabelRangeChange: function(i, num) {\n        var labelRange = this.props.labelRange.slice();\n        var otherNum = labelRange[1 - i];\n\n        if (num == null || otherNum == null) {\n            labelRange[i] = num;\n        } else {\n            // If both labels have values, this updates the \"appropriate\" one.\n            // It enforces that the position of the left label <= right label.\n            // If left otherwise, it makes certain aspects of validation hard.\n            labelRange = [Math.min(num, otherNum), Math.max(num, otherNum)];\n        }\n\n        this.props.onChange({labelRange: labelRange});\n    },\n\n    onDivisionRangeChange: function(divisionRange) {\n        var numDivisions = this.props.numDivisions;\n        numDivisions = bound(numDivisions, divisionRange[0], divisionRange[1]);\n        this.props.onChange({\n            divisionRange: divisionRange,\n            numDivisions: numDivisions,\n        });\n    },\n\n    onNumChange: function(key, value) {\n        var opts = {};\n        opts[key] = value;\n        this.props.onChange(opts);\n    },\n\n    onNumDivisionsChange: function(numDivisions) {\n        var divRange = this.props.divisionRange.slice();\n\n        if (!_.isFinite(numDivisions)) {\n            numDivisions = null;\n        }\n\n        // Don't allow a fraction for the number of divisions\n        numDivisions = Math.round(numDivisions);\n\n        // Don't allow negative numbers for the number of divisions\n        numDivisions = numDivisions < 0 ? numDivisions * -1 : numDivisions;\n\n        // If the number of divisions isn't blank, update the number line\n        if (numDivisions) {\n            // Constrain numDivisions to be within the allowed range\n            numDivisions = Math.min(\n                divRange[1],\n                Math.max(divRange[0], numDivisions)\n            );\n\n            this.props.onChange({\n                tickStep: null,\n                divisionRange: divRange,\n                numDivisions: numDivisions,\n            });\n        }\n    },\n\n    onTickStepChange: function(tickStep) {\n        this.props.onChange({\n            numDivisions: null,\n            tickStep: tickStep,\n        });\n    },\n\n    onChangeRelation: function(e) {\n        const value = e.target.value;\n        this.props.onChange({\n            correctRel: value,\n            isInequality: value !== \"eq\",\n        });\n    },\n\n    onLabelStyleChange: function(labelStyle) {\n        this.props.onChange({\n            labelStyle: labelStyle,\n        });\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n\n    render: function() {\n        var range = this.props.range;\n        var labelRange = this.props.labelRange;\n        var divisionRange = this.props.divisionRange;\n\n        range[0] = +range[0];\n        range[1] = +range[1];\n\n        var width = range[1] - range[0];\n        var numDivisions = this.props.numDivisions;\n        var snapDivisions = this.props.snapDivisions;\n        var tickStep = this.props.tickStep;\n        var isTickCtrl = this.props.isTickCtrl;\n\n        let step;\n        if (!isTickCtrl) {\n            // this will help constrain the answer to what is reachable\n            step = tickStep\n                ? tickStep / snapDivisions\n                : width / numDivisions / snapDivisions;\n        } else {\n            // but if tickCtrl is on, the range of what is reachable is\n            // rather large, and it becomes obnoxious to check for this\n            step = null;\n        }\n\n        var labelStyleEditorButtons = [\n            {\n                value: \"decimal\",\n                content: \"0.75\",\n                title: \"Decimals\",\n            },\n            {\n                value: \"improper\",\n                content: \"\\u2077\\u2044\\u2084\",\n                title: \"Improper fractions\",\n            },\n            {\n                value: \"mixed\",\n                content: \"1\\u00BE\",\n                title: \"Mixed numbers\",\n            },\n            {\n                value: \"non-reduced\",\n                content: \"\\u2078\\u2044\\u2084\",\n                title: \"Non-reduced\",\n            },\n        ];\n\n        return (\n            <div className=\"perseus-widget-number-line-editor\">\n                <div className=\"perseus-widget-row\">\n                    Correct x{\" \"}\n                    <select\n                        value={this.props.correctRel}\n                        onChange={this.onChangeRelation}\n                    >\n                        <option value=\"eq\"> = </option>\n                        <option value=\"lt\"> &lt; </option>\n                        <option value=\"gt\"> &gt; </option>\n                        <option value=\"le\"> &le; </option>\n                        <option value=\"ge\"> &ge; </option>\n                    </select>{\" \"}\n                    <NumberInput\n                        value={this.props.correctX}\n                        format={this.props.labelStyle}\n                        onChange={this.onNumChange.bind(this, \"correctX\")}\n                        checkValidity={val => val >= range[0] &&\n                        val <= range[1] &&\n                        (!step ||\n                            knumber.isInteger((val - range[0]) / step))}\n                        placeholder=\"answer\"\n                        size=\"normal\"\n                        useArrowKeys={true}\n                    />\n                    <InfoTip>\n                        <p>\n                            This is the correct answer. The answer is validated\n                            (as right or wrong) by using only the end position\n                            of the point and the relation (=, &lt;, &gt;, &le;,\n                            &ge;).\n                        </p>\n                    </InfoTip>\n                </div>\n\n                <div className=\"perseus-widget-row\">\n                    {this.props.static\n                        ? <label>\n                              {/* Don't display initial position input in\n                            static mode since it isn't used. */}\n                              Range:\n                          </label>\n                        : <label>\n                              Position:{\" \"}\n                              <NumberInput\n                                  value={this.props.initialX}\n                                  format={this.props.labelStyle}\n                                  onChange={this.onNumChange.bind(\n                                      this,\n                                      \"initialX\"\n                                  )}\n                                  placeholder={range[0]}\n                                  checkValidity={val => {\n                                      return val >= range[0] && val <= range[1];\n                                  }}\n                                  useArrowKeys={true}\n                              />\n                              {\n                                  \" \\u2208 \" /* element of (little E) symbol @Nolint */\n                              }\n                          </label>}\n\n                    <RangeInput\n                        value={range}\n                        onChange={this.onRangeChange}\n                        format={this.props.labelStyle}\n                        useArrowKeys={true}\n                    />\n                    <InfoTip>\n                        <p>\n                            This controls the initial position of the point\n                            along the number line and the\n                            <strong>range</strong>, the position of the\n                            endpoints of the number line.\n                            Setting the range constrains the position of the\n                            answer and the labels.\n                        </p>\n                        <p>\n                            In static mode, the initial position of the point\n                            is determined by Correct x instead of position.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-left-col\">\n                        Labels:{\" \"}\n                        <NumberInput\n                            value={labelRange[0]}\n                            placeholder={range[0]}\n                            format={this.props.labelStyle}\n                            checkValidity={val => val >= range[0] && val <= range[1]}\n                            onChange={this.onLabelRangeChange.bind(this, 0)}\n                            useArrowKeys={true}\n                        />\n                        <span> &amp; </span>\n                        <NumberInput\n                            value={labelRange[1]}\n                            placeholder={range[1]}\n                            format={this.props.labelStyle}\n                            checkValidity={val => val >= range[0] && val <= range[1]}\n                            onChange={this.onLabelRangeChange.bind(this, 1)}\n                            useArrowKeys={true}\n                        />\n                        <InfoTip>\n                            <p>\n                                This controls the position of the left / right\n                                labels. By default, the labels are set by the\n                                range <br />\n                                <strong>Note:</strong> Ensure that the labels\n                                line up with the tick marks, or it may be\n                                confusing for users.\n                            </p>\n                        </InfoTip>\n                    </div>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Style:{\" \"}\n                    <ButtonGroup\n                        allowEmpty={false}\n                        value={this.props.labelStyle}\n                        buttons={labelStyleEditorButtons}\n                        onChange={this.onLabelStyleChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            This controls the styling of the labels for the two\n                            main labels as well as all the tick mark labels, if\n                            applicable. Your choices are decimal, improper\n                            fractions, mixed fractions, and non-reduced\n                            fractions.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    {!this.props.static &&\n                        <div className=\"perseus-widget-left-col\">\n                            <PropCheckBox\n                                label=\"Show tick controller\"\n                                isTickCtrl={this.props.isTickCtrl}\n                                onChange={this.props.onChange}\n                            />\n                        </div>}\n                    <div className=\"perseus-widget-right-col\">\n                        <PropCheckBox\n                            label=\"Show label ticks\"\n                            labelTicks={this.props.labelTicks}\n                            onChange={this.props.onChange}\n                        />\n                    </div>\n                </div>\n\n                <div className=\"perseus-widget-row\">\n                    {!this.props.static &&\n                        <PropCheckBox\n                            label=\"Show tooltips\"\n                            showTooltips={this.props.showTooltips}\n                            onChange={this.props.onChange}\n                        />}\n                </div>\n                <div className=\"perseus-widget-row\">\n                    {isTickCtrl &&\n                        <span>\n                            <label>\n                                Start num divisions at{\" \"}\n                                <NumberInput\n                                    value={this.props.numDivisions || null}\n                                    format={\"decimal\"}\n                                    onChange={this.onNumDivisionsChange}\n                                    checkValidity={val => {\n                                        return (\n                                            val >= divisionRange[0] &&\n                                            val <= divisionRange[1]\n                                        );\n                                    }}\n                                    placeholder={width / this.props.tickStep}\n                                    useArrowKeys={true}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>\n                                    This controls the number (and position) of\n                                    the tick marks. The number of divisions is\n                                    constrained to\n                                    {\" \" +\n                                        divisionRange[0] +\n                                        EN_DASH +\n                                        divisionRange[1]}.\n                                    <br />\n                                    <strong>Note:</strong> The user will be able\n                                    to specify the number of divisions in a\n                                    number input.\n                                </p>\n                            </InfoTip>\n                        </span>}\n                    {!isTickCtrl &&\n                        <span>\n                            <label>\n                                Num divisions:{\" \"}\n                                <NumberInput\n                                    value={this.props.numDivisions || null}\n                                    format={\"decimal\"}\n                                    onChange={this.onNumDivisionsChange}\n                                    checkValidity={val => {\n                                        return (\n                                            val >= divisionRange[0] &&\n                                            val <= divisionRange[1]\n                                        );\n                                    }}\n                                    placeholder={width / this.props.tickStep}\n                                    useArrowKeys={true}\n                                />\n                            </label>{\" \"}\n                            <label>\n                                or tick step:{\" \"}\n                                <NumberInput\n                                    value={this.props.tickStep || null}\n                                    format={this.props.labelStyle}\n                                    onChange={this.onTickStepChange}\n                                    checkValidity={val => {\n                                        return val > 0 && val <= width;\n                                    }}\n                                    placeholder={\n                                        width / this.props.numDivisions\n                                    }\n                                    useArrowKeys={true}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>\n                                    This controls the number (and position) of\n                                    the tick marks; you can either set the\n                                    number of divisions (2 divisions would split\n                                    the entire range in two halves), or the tick\n                                    step (the distance between ticks) and the\n                                    other value will be updated\n                                    accordingly.{\" \"}\n                                    <br />\n                                    <strong>Note:</strong> There is no check to\n                                    see if labels coordinate with the tick\n                                    marks, which may be confusing for users if\n                                    the blue labels and black ticks are\n                                    off-step.\n                                </p>\n                            </InfoTip>\n                        </span>}\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Snap increments per tick:{\" \"}\n                        <NumberInput\n                            value={snapDivisions}\n                            checkValidity={val => val > 0}\n                            format={this.props.labelStyle}\n                            onChange={this.onNumChange.bind(\n                                this,\n                                \"snapDivisions\"\n                            )}\n                            useArrowKeys={true}\n                        />\n                    </label>\n                    <InfoTip>\n                        <p>\n                            This determines the number of different places the\n                            point will snap between two adjacent tick\n                            marks.{\" \"}\n                            <br />\n                            <strong>Note:</strong>Ensure the required number of\n                            snap increments is provided to answer the question.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = NumberLineEditor;\nexport default _module_.exports;\n","import _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _utilMathJs from \"../util/math.js\";\nimport _kmath from \"kmath\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* globals i18n, $_ */\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\n\nvar NumberInput = _componentsNumberInputJsx;\nvar MathOutput = _componentsMathOutputJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\n\nvar ApiOptions = _perseusApiJsx.Options;\nconst {keypadElementPropType} = _mathInput.propTypes;\n\nvar Graphie = _componentsGraphieJsx;\nvar MovablePoint = Graphie.MovablePoint;\nvar Line = Graphie.Line;\n\nvar knumber = _kmath.number;\nconst KhanMath = _utilMathJs;\nconst KhanColors = _utilColorsJs;\n\nvar bound = (x, gt, lt) => Math.min(Math.max(x, gt), lt);\nvar assert = _interactive2InteractiveUtilJs.assert;\n\nvar EN_DASH = \"\\u2013\";\nconst horizontalPadding = 30;\n\nvar reverseRel = {\n    ge: \"le\",\n    gt: \"lt\",\n    le: \"ge\",\n    lt: \"gt\",\n};\n\nvar toggleStrictRel = {\n    ge: \"gt\",\n    gt: \"ge\",\n    le: \"lt\",\n    lt: \"le\",\n};\n\nfunction formatImproper(n, d) {\n    if (d === 1) {\n        return \"\" + n;\n    } else {\n        return `\\\\dfrac{${n}}{${d}}`;\n    }\n}\n\nfunction formatMixed(n, d) {\n    if (n < 0) {\n        return \"-\" + formatMixed(-n, d);\n    }\n    var w = Math.floor(n / d);\n    if (w === 0) {\n        return formatImproper(n, d);\n    } else if (n - w * d === 0) {\n        return \"\" + w;\n    } else {\n        return w + formatImproper(n - w * d, d);\n    }\n}\n\nfunction formatNonReduced(n, d, base) {\n    var factor = Math.floor(base / d);\n    return formatImproper(n * factor, base);\n}\n\nvar _label = (graphie, labelStyle, pos, value, base) => {\n    value = value || pos;\n\n    // TODO(jack): Find out if any exercises have \"decimal ticks\" set,\n    // and if so, re-save them and remove this check.\n    if (labelStyle === \"decimal\" || labelStyle === \"decimal ticks\") {\n        return graphie.label(\n            [pos, -0.53],\n            Math.round(value * 100) / 100,\n            \"center\"\n        );\n    } else if (labelStyle === \"improper\") {\n        const frac = KhanMath.toFraction(value);\n        return graphie.label(\n            [pos, -0.17],\n            formatImproper(frac[0], frac[1]),\n            \"below\"\n        );\n    } else if (labelStyle === \"mixed\") {\n        const frac = KhanMath.toFraction(value);\n        return graphie.label(\n            [pos, -0.17],\n            formatMixed(frac[0], frac[1]),\n            \"below\"\n        );\n    } else if (labelStyle === \"non-reduced\") {\n        const frac = KhanMath.toFraction(value);\n        return graphie.label(\n            [pos, -0.17],\n            formatNonReduced(frac[0], frac[1], base),\n            \"below\"\n        );\n    }\n};\n\nvar TickMarks = Graphie.createSimpleClass((graphie, props) => {\n    // Avoid infinite loop\n    if (!_.isFinite(props.tickStep) || props.tickStep <= 0) {\n        return []; // this has screwed me for the last time!\n    }\n\n    var results = [];\n\n    // For convenience, extract some props into separate variables\n    var range = props.range;\n    var labelRange = props.labelRange;\n    var leftLabel = labelRange[0] == null ? range[0] : labelRange[0];\n    var rightLabel = labelRange[1] == null ? range[1] : labelRange[1];\n\n    // Find base via GCD for non-reduced fractions\n    var base;\n    if (props.labelStyle === \"non-reduced\") {\n        var fractions = [leftLabel, rightLabel];\n        for (let i = 0; i <= props.numDivisions; i++) {\n            const x = range[0] + i * props.tickStep;\n            fractions.push(x);\n        }\n        var getDenom = x => knumber.toFraction(x)[1];\n        var denoms = _.map(fractions, getDenom);\n        base = _.reduce(denoms, (x, y) => KhanMath.getLCM(x, y));\n    } else {\n        base = undefined;\n    }\n\n    // Draw and save the tick marks and tick labels\n    for (let i = 0; i <= props.numDivisions; i++) {\n        const x = range[0] + i * props.tickStep;\n        results.push(graphie.line([x, -0.2], [x, 0.2]));\n\n        var labelTicks = props.labelTicks;\n        if (labelTicks || props.labelStyle === \"decimal ticks\") {\n            results.push(_label(graphie, props.labelStyle, x, x, base));\n        }\n    }\n\n    // Render the text labels\n    results.push(\n        graphie.style(\n            props.isMobile\n                ? {\n                    color: KhanColors.BLUE_D,\n                }\n                : {},\n            () => _label(graphie, props.labelStyle, leftLabel, leftLabel, base)\n        )\n    );\n\n    results.push(\n        graphie.style(\n            props.isMobile\n                ? {\n                    color: KhanColors.BLUE_D,\n                }\n                : {},\n            () => _label(graphie, props.labelStyle, rightLabel, rightLabel, base)\n        )\n    );\n\n    // Render the labels' lines\n    graphie.style(\n        {\n            stroke: props.isMobile ? KhanColors.BLUE_D : KhanColors.DYNAMIC,\n            strokeWidth: 3.5,\n        },\n        () => {\n            results.push(graphie.line([leftLabel, -0.2], [leftLabel, 0.2]));\n            results.push(graphie.line([rightLabel, -0.2], [rightLabel, 0.2]));\n        }\n    );\n\n    return results;\n});\n\nvar NumberLine = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        range: PropTypes.arrayOf(PropTypes.number).isRequired,\n\n        labelRange: PropTypes.arrayOf(PropTypes.number).isRequired,\n        labelStyle: PropTypes.string.isRequired,\n        labelTicks: PropTypes.bool.isRequired,\n\n        divisionRange: PropTypes.arrayOf(PropTypes.number)\n            .isRequired,\n        numDivisions: PropTypes.number.isRequired,\n        snapDivisions: PropTypes.number.isRequired,\n\n        isTickCtrl: PropTypes.bool.isRequired,\n        isInequality: PropTypes.bool.isRequired,\n\n        numLinePosition: PropTypes.number.isRequired,\n        rel: PropTypes.oneOf([\"lt\", \"gt\", \"le\", \"ge\"]),\n\n        onFocus: PropTypes.func.isRequired,\n        onBlur: PropTypes.func.isRequired,\n        onChange: PropTypes.func.isRequired,\n\n        apiOptions: ApiOptions.propTypes,\n        keypadElement: keypadElementPropType,\n        static: PropTypes.bool,\n        showTooltips: PropTypes.bool,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            range: [0, 10],\n            labelStyle: \"decimal\",\n            labelRange: [null, null],\n            divisionRange: [1, 12],\n            labelTicks: true,\n            isTickCtrl: false,\n            isInequality: false,\n            numLinePosition: 0,\n            snapDivisions: 2,\n            showTooltips: false,\n            rel: \"ge\",\n            apiOptions: ApiOptions.defaults,\n        };\n    },\n\n    getInitialState() {\n        return {\n            numDivisionsEmpty: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    isValid: function() {\n        var range = this.props.range;\n        var initialX = this.props.numLinePosition;\n        var divisionRange = this.props.divisionRange;\n\n        initialX = initialX == null ? range[0] : initialX;\n\n        return (\n            range[0] < range[1] &&\n            knumber.sign(initialX - range[0]) >= 0 &&\n            knumber.sign(initialX - range[1]) <= 0 &&\n            divisionRange[0] < divisionRange[1] &&\n            0 < this.props.numDivisions &&\n            0 < this.props.snapDivisions\n        );\n    },\n\n    onNumDivisionsChange: function(numDivisions, cb) {\n        var divRange = this.props.divisionRange.slice();\n        var width = this.props.range[1] - this.props.range[0];\n\n        // Don't allow a fraction for the number of divisions\n        numDivisions = Math.round(numDivisions);\n\n        // Don't allow negative numbers for the number of divisions\n        numDivisions = numDivisions < 0 ? numDivisions * -1 : numDivisions;\n\n        // If the number of divisions isn't blank, update the number line\n        if (numDivisions) {\n            var nextProps = _.extend({}, this.props, {\n                tickStep: width / numDivisions,\n            });\n\n            var newNumLinePosition = this.snapNumLinePosition(\n                nextProps,\n                this.props.numLinePosition\n            );\n\n            this.setState(\n                {\n                    numDivisionsEmpty: false,\n                },\n                () => {\n                    this.props.onChange(\n                        {\n                            divisionRange: divRange,\n                            numDivisions: numDivisions,\n                            numLinePosition: newNumLinePosition,\n                        },\n                        cb\n                    );\n                }\n            );\n        } else {\n            this.setState(\n                {\n                    numDivisionsEmpty: true,\n                },\n                cb\n            );\n        }\n    },\n\n    _handleTickCtrlFocus: function() {\n        this.props.onFocus([\"tick-ctrl\"]);\n    },\n\n    _handleTickCtrlBlur: function() {\n        this.props.onBlur([\"tick-ctrl\"]);\n    },\n\n    focus: function() {\n        if (this.props.isTickCtrl) {\n            this.refs[\"tick-ctrl\"].focus();\n            return true;\n        }\n    },\n\n    focusInputPath: function(path) {\n        if (path.length === 1) {\n            this.refs[path[0]].focus();\n        }\n    },\n\n    blurInputPath: function(path) {\n        if (path.length === 1) {\n            this.refs[path[0]].blur();\n        }\n    },\n\n    getInputPaths: function() {\n        if (this.props.isTickCtrl) {\n            return [[\"tick-ctrl\"]];\n        } else {\n            return [];\n        }\n    },\n\n    getDOMNodeForPath: function(inputPath) {\n        if (inputPath.length === 1) {\n            return ReactDOM.findDOMNode(this.refs[inputPath[0]]);\n        }\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        if (inputPath.length === 1 && inputPath[0] === \"tick-ctrl\") {\n            return \"number\";\n        }\n    },\n\n    setInputValue: function(inputPath, value, callback) {\n        if (inputPath.length === 1 && inputPath[0] === \"tick-ctrl\") {\n            this.onNumDivisionsChange(value, callback);\n        }\n    },\n\n    _renderGraphie: function() {\n        // Position variables\n        var range = this.props.range;\n        var width = range[1] - range[0];\n\n        var options = _.pick(this.props, [\"range\", \"isTickCtrl\"]);\n\n        // TODO(aria): Maybe save this as `this.calculatedProps`?\n        var props = _.extend({}, this.props, {\n            tickStep: width / this.props.numDivisions,\n        });\n\n        return (\n            <Graphie\n                ref=\"graphie\"\n                // HACK(emily): We key this graphie on the label style because\n                // when the label style changes we want to resize the graphie,\n                // which isn't doable without throwing away the graphie and\n                // making a new one.\n                key={this.props.labelStyle}\n                box={[this.props.apiOptions.isMobile ? 288 : 460, 80]}\n                options={options}\n                onMouseDown={coord => {\n                    this.refs.graphie.movables.numberLinePoint.grab(coord);\n                }}\n                setup={this._setupGraphie}\n                setDrawingAreaAvailable={\n                    this.props.apiOptions.setDrawingAreaAvailable\n                }\n                isMobile={this.props.apiOptions.isMobile}\n            >\n                <TickMarks\n                    {..._.pick(props, [\n                        \"range\",\n                        \"numDivisions\",\n                        \"labelTicks\",\n                        \"labelStyle\",\n                        \"labelRange\",\n                        \"tickStep\",\n                    ])}\n                    isMobile={this.props.apiOptions.isMobile}\n                />\n                {this._renderInequality(props)}\n                {this._renderNumberLinePoint(props)}\n            </Graphie>\n        );\n    },\n\n    snapNumLinePosition: function(props, numLinePosition) {\n        var left = props.range[0];\n        var right = props.range[1];\n        var snapX = props.tickStep / props.snapDivisions;\n\n        let x = bound(numLinePosition, left, right);\n        x = left + knumber.roundTo(x - left, snapX);\n        assert(_.isFinite(x));\n        return x;\n    },\n\n    _renderNumberLinePoint: function(props) {\n        var isOpen = [\"lt\", \"gt\"].includes(props.rel);\n\n        // In static mode the point's fill and stroke is blue to signify that\n        // it can't be interacted with.\n        var fill;\n        if (isOpen) {\n            fill = KhanColors._BACKGROUND;\n        } else if (props.static) {\n            fill = KhanColors.DYNAMIC;\n        } else {\n            fill = KhanColors.INTERACTIVE;\n        }\n        var normalStyle = {\n            fill: fill,\n            stroke: props.static ? KhanColors.DYNAMIC : KhanColors.INTERACTIVE,\n            \"stroke-width\": isOpen ? 3 : 1,\n        };\n        var highlightStyle = {\n            fill: isOpen ? KhanColors._BACKGROUND : KhanColors.INTERACTING,\n            \"stroke-width\": isOpen ? 3 : 1,\n        };\n\n        const mobileDotStyle = props.isInequality\n            ? {\n                stroke: KhanColors.INTERACTIVE,\n                \"fill-opacity\": isOpen ? 0 : 1,\n            }\n            : {};\n\n        return (\n            <MovablePoint\n                ref=\"numberLinePoint\"\n                pointSize={6}\n                coord={[props.numLinePosition, 0]}\n                constraints={[\n                    (coord, prevCoord) => {\n                        // constrain-y\n                        return [coord[0], prevCoord[1]];\n                    },\n                    (coord, prevCoord) => {\n                        // snap X\n                        var x = this.snapNumLinePosition(props, coord[0]);\n                        return [x, coord[1]];\n                    },\n                ]}\n                normalStyle={normalStyle}\n                highlightStyle={highlightStyle}\n                onMove={coord => {\n                    this.change({numLinePosition: coord[0]});\n                    this.props.trackInteraction();\n                }}\n                isMobile={this.props.apiOptions.isMobile}\n                mobileStyleOverride={mobileDotStyle}\n                showTooltips={this.props.showTooltips}\n                xOnlyTooltip={true}\n            />\n        );\n    },\n\n    handleReverse: function() {\n        var newRel = reverseRel[this.props.rel];\n        this.props.onChange({rel: newRel});\n    },\n\n    handleToggleStrict: function() {\n        var newRel = toggleStrictRel[this.props.rel];\n        this.props.onChange({rel: newRel});\n    },\n\n    _getInequalityEndpoint: function(props) {\n        var isGreater = [\"ge\", \"gt\"].includes(props.rel);\n        var widthInPixels = 400;\n        var range = props.range;\n        var scale = (range[1] - range[0]) / widthInPixels;\n        var buffer = horizontalPadding * scale;\n        var left = range[0] - buffer;\n        var right = range[1] + buffer;\n        var end = isGreater ? [right, 0] : [left, 0];\n        return end;\n    },\n\n    _renderInequality: function(props) {\n        if (props.isInequality) {\n            var end = this._getInequalityEndpoint(props);\n            var style = {\n                arrows: \"->\",\n                stroke: this.props.apiOptions.isMobile\n                    ? KhanColors.INTERACTIVE\n                    : KhanColors.DYNAMIC,\n                strokeWidth: 3.5,\n            };\n\n            const isGreater = [\"ge\", \"gt\"].includes(props.rel);\n\n            return (\n                <Line\n                    // We shift the line to either side of the dot so they don't\n                    // intersect\n                    start={[\n                        (isGreater ? 0.4 : -0.4) + props.numLinePosition,\n                        0,\n                    ]}\n                    end={end}\n                    style={style}\n                />\n            );\n        } else {\n            return null;\n        }\n    },\n\n    _setupGraphie: function(graphie, options) {\n        // Ensure a sane configuration to avoid infinite loops\n        if (!this.isValid()) {\n            return;\n        }\n\n        // Position variables\n        var widthInPixels = this.props.apiOptions.isMobile\n            ? 288 - horizontalPadding * 2\n            : 400;\n        var range = options.range;\n        var scale = (range[1] - range[0]) / widthInPixels;\n        var buffer = horizontalPadding * scale;\n\n        // Initiate the graphie without actually drawing anything\n        var left = range[0] - buffer;\n        var right = range[1] + buffer;\n\n        const hasFractionalLabels =\n            this.props.labelStyle === \"improper\" ||\n            this.props.labelStyle === \"mixed\" ||\n            this.props.labelStyle === \"non-reduced\";\n        var bottom = hasFractionalLabels ? -1.5 : -1;\n        var top = 1;\n\n        graphie.init({\n            range: [[left, right], [bottom, top]],\n            scale: [1 / scale, 40],\n            isMobile: this.props.apiOptions.isMobile,\n        });\n\n        // Draw the number line\n        var center = (range[0] + range[1]) / 2;\n        graphie.line([center, 0], [right, 0], {arrows: \"->\"});\n        graphie.line([center, 0], [left, 0], {arrows: \"->\"});\n    },\n\n    getUserInput: function() {\n        return {\n            numLinePosition: this.props.numLinePosition,\n            rel: this.props.isInequality ? this.props.rel : \"eq\",\n            numDivisions: this.props.numDivisions,\n            divisionRange: this.props.divisionRange,\n        };\n    },\n\n    simpleValidate: function(rubric) {\n        return NumberLine.validate(this.getUserInput(), rubric);\n    },\n\n    render: function() {\n        var divisionRange = this.props.divisionRange;\n        var divRangeString = divisionRange[0] + EN_DASH + divisionRange[1];\n        var invalidNumDivisions =\n            this.props.numDivisions < divisionRange[0] ||\n            this.props.numDivisions > divisionRange[1];\n\n        var inequalityControls = (\n            <div>\n                <input\n                    type=\"button\"\n                    className=\"simple-button\"\n                    value={i18n._(\"Switch direction\")}\n                    onClick={this.handleReverse}\n                />\n                <input\n                    type=\"button\"\n                    className=\"simple-button\"\n                    value={\n                        [\"le\", \"ge\"].includes(this.props.rel)\n                            ? i18n._(\"Make circle open\")\n                            : i18n._(\"Make circle filled\")\n                    }\n                    onClick={this.handleToggleStrict}\n                />\n            </div>\n        );\n\n        var tickCtrl;\n        if (this.props.isTickCtrl) {\n            var Input;\n            if (this.props.apiOptions.customKeypad) {\n                Input = SimpleKeypadInput;\n            } else if (this.props.apiOptions.staticRender) {\n                Input = MathOutput;\n            } else {\n                Input = NumberInput;\n            }\n            tickCtrl = (\n                <label>\n                    {i18n._(\"Number of divisions:\")}{\" \"}\n                    <Input\n                        ref={\"tick-ctrl\"}\n                        value={\n                            this.state.numDivisionsEmpty\n                                ? null\n                                : this.props.numDivisions || divisionRange[0]\n                        }\n                        checkValidity={val => val >= divisionRange[0] && val <= divisionRange[1]}\n                        onChange={this.onNumDivisionsChange}\n                        onFocus={this._handleTickCtrlFocus}\n                        onBlur={this._handleTickCtrlBlur}\n                        useArrowKeys={true}\n                        keypadElement={this.props.keypadElement}\n                    />\n                </label>\n            );\n        }\n\n        return (\n            <div\n                className={\n                    \"perseus-widget \" + \"perseus-widget-interactive-number-line\"\n                }\n            >\n                {tickCtrl}\n                {!this.isValid()\n                    ? <div className=\"perseus-error\">\n                          Invalid number line configuration.\n                      </div>\n                    : this.props.isTickCtrl && invalidNumDivisions\n                      ? <div className=\"perseus-error\">\n                            {$_(\n                                {divRangeString: divRangeString},\n                                \"Please make sure the number of divisions is \" +\n                                    \"in the range %(divRangeString)s.\"\n                            )}\n                        </div>\n                      : this._renderGraphie()}\n                {!this.props.static &&\n                    this.props.isInequality &&\n                    inequalityControls}\n            </div>\n        );\n    },\n});\n\n_.extend(NumberLine, {\n    validate: function(state, rubric) {\n        var range = rubric.range;\n        var divisionRange = state.divisionRange;\n        var start = rubric.initialX != null ? rubric.initialX : range[0];\n        var startRel = rubric.isInequality ? \"ge\" : \"eq\";\n        var correctRel = rubric.correctRel || \"eq\";\n        var correctPos = knumber.equal(\n            state.numLinePosition,\n            rubric.correctX || 0\n        );\n        var outsideAllowedRange =\n            state.numDivisions > divisionRange[1] ||\n            state.numDivisions < divisionRange[0];\n\n        if (state.isTickCrtl && outsideAllowedRange) {\n            return {\n                type: \"invalid\",\n                message: \"Number of divisions is outside the allowed range.\",\n            };\n        } else if (correctPos && correctRel === state.rel) {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: null,\n            };\n        } else if (state.numLinePosition === start && state.rel === startRel) {\n            // We're where we started.\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\nvar numberLineTransform = editorProps => {\n    var props = _.pick(editorProps, [\n        \"range\",\n\n        \"labelRange\",\n        \"labelStyle\",\n        \"labelTicks\",\n\n        \"divisionRange\",\n        \"snapDivisions\",\n\n        \"isTickCtrl\",\n        \"isInequality\",\n\n        \"showTooltips\",\n    ]);\n\n    var numLinePosition =\n        editorProps.initialX != null\n            ? editorProps.initialX\n            : editorProps.range[0];\n\n    var width = editorProps.range[1] - editorProps.range[0];\n\n    var numDivisions;\n    if (editorProps.numDivisions != null) {\n        numDivisions = editorProps.numDivisions;\n    } else if (editorProps.tickStep != null) {\n        numDivisions = width / editorProps.tickStep;\n    } else {\n        numDivisions = undefined; // send to getDefaultProps()\n    }\n\n    _.extend(props, {\n        numLinePosition: numLinePosition,\n        numDivisions: numDivisions,\n        // Use getDefaultProps value if null\n        snapDivisions: props.snapDivisions || undefined,\n    });\n\n    return props;\n};\n\nvar staticTransform = editorProps => {\n    var props = _.pick(editorProps, [\n        \"range\",\n\n        \"labelRange\",\n        \"labelStyle\",\n        \"labelTicks\",\n\n        \"divisionRange\",\n        \"snapDivisions\",\n\n        // isTickCtrl is ignored since users can't interact with it anyway\n        \"isInequality\",\n    ]);\n\n    // The correct x is the initial position of the point\n    var numLinePosition =\n        editorProps.correctX != null\n            ? editorProps.correctX\n            : editorProps.range[0];\n\n    var width = editorProps.range[1] - editorProps.range[0];\n\n    var numDivisions;\n    if (editorProps.numDivisions != null) {\n        numDivisions = editorProps.numDivisions;\n    } else if (editorProps.tickStep != null) {\n        numDivisions = width / editorProps.tickStep;\n    } else {\n        numDivisions = undefined; // send to getDefaultProps()\n    }\n\n    _.extend(props, {\n        numLinePosition: numLinePosition,\n        numDivisions: numDivisions,\n        // Render the relation in the correct answer\n        rel: editorProps.isInequality ? editorProps.correctRel : null,\n        // Use getDefaultProps value if null\n        snapDivisions: props.snapDivisions || undefined,\n    });\n\n    return props;\n};\n\n_module_.exports = {\n    name: \"number-line\",\n    displayName: \"Number line\",\n    widget: NumberLine,\n    transform: numberLineTransform,\n    staticTransform: staticTransform,\n};\nexport default _module_.exports;\n","import _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\n\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\nconst Changeable = _mixinsChangeableJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst TextInput = _componentsTextInputJsx;\n\nconst MoleculeWidgetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        rotationAngle: PropTypes.number,\n        smiles: PropTypes.string,\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    updateMolecule: function(newValue) {\n        this.change({smiles: newValue});\n    },\n\n    updateRotation: function(newValue) {\n        this.change({rotationAngle: newValue});\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <div>\n                    {/* TODO(colin): instead of nbsp hacks, use styles to get\n                    the spacing right. */}\n                    <label>\n                        SMILES:&nbsp;\n                        <TextInput\n                            onChange={this.updateMolecule}\n                            value={this.props.smiles}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Rotation (deg):&nbsp;\n                        <NumberInput\n                            onChange={this.updateRotation}\n                            value={this.props.rotationAngle}\n                        />\n                    </label>\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = MoleculeWidgetEditor;\nexport default _module_.exports;\n","import _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst InfoTip = _componentsInfoTipJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst RangeInput = _componentsRangeInputJsx;\n\nconst defaultImage = {\n    url: null,\n    top: 0,\n    left: 0,\n};\n\nconst MeasurerEditor = createReactClass({\n    className: \"perseus-widget-measurer\",\n\n    propTypes: {\n        ...Changeable.propTypes,\n        box: PropTypes.arrayOf(PropTypes.number),\n        image: PropTypes.shape({\n            url: PropTypes.string,\n            top: PropTypes.number,\n            left: PropTypes.number,\n        }),\n        showProtractor: PropTypes.bool,\n        showRuler: PropTypes.bool,\n        rulerLabel: PropTypes.string,\n        rulerTicks: PropTypes.number,\n        rulerPixels: PropTypes.number,\n        rulerLength: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            box: [480, 480],\n            image: {},\n            showProtractor: true,\n            showRuler: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n            rulerPixels: 40,\n            rulerLength: 10,\n        };\n    },\n\n    render: function() {\n        var image = _.extend({}, defaultImage, this.props.image);\n\n        return (\n            <div className=\"perseus-widget-measurer\">\n                <div>Image displayed under protractor and/or ruler:</div>\n                <div>\n                    URL:{\" \"}\n                    <input\n                        type=\"text\"\n                        className=\"perseus-widget-measurer-url\"\n                        ref=\"image-url\"\n                        defaultValue={image.url}\n                        onChange={this._changeUrl}\n                    />\n                    <InfoTip>\n                        <p>\n                            Create an image in graphie, or use the \"Add image\"\n                            function to create a background.\n                        </p>\n                    </InfoTip>\n                </div>\n                {image.url &&\n                    <div className=\"perseus-widget-row\">\n                        <label className=\"perseus-widget-left-col\">\n                            Pixels from top:{\" \"}\n                            <NumberInput\n                                placeholder={0}\n                                onChange={this._changeTop}\n                                value={image.top}\n                                useArrowKeys={true}\n                            />\n                        </label>\n                        <label className=\"perseus-widget-right-col\">\n                            Pixels from left:{\" \"}\n                            <NumberInput\n                                placeholder={0}\n                                onChange={this._changeLeft}\n                                value={image.left}\n                                useArrowKeys={true}\n                            />\n                        </label>\n                    </div>}\n                <div>\n                    Containing area [width, height]:{\" \"}\n                    <RangeInput\n                        onChange={this.change(\"box\")}\n                        value={this.props.box}\n                        useArrowKeys={true}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-left-col\">\n                        <PropCheckBox\n                            label=\"Show ruler\"\n                            showRuler={this.props.showRuler}\n                            onChange={this.props.onChange}\n                        />\n                    </div>\n                    <div className=\"perseus-widget-right-col\">\n                        <PropCheckBox\n                            label=\"Show protractor\"\n                            showProtractor={this.props.showProtractor}\n                            onChange={this.props.onChange}\n                        />\n                    </div>\n                </div>\n                {this.props.showRuler &&\n                    <div>\n                        <div>\n                            <label>\n                                {\" \"}Ruler label:{\" \"}\n                                <select\n                                    onChange={e => this.change(\n                                        \"rulerLabel\",\n                                        e.target.value\n                                    )}\n                                    value={this.props.rulerLabel}\n                                >\n                                    <option value=\"\">None</option>\n                                    <optgroup label=\"Metric\">\n                                        {this.renderLabelChoices([\n                                            [\"milimeters\", \"mm\"],\n                                            [\"centimeters\", \"cm\"],\n                                            [\"meters\", \"m\"],\n                                            [\"kilometers\", \"km\"],\n                                        ])}\n                                    </optgroup>\n                                    <optgroup label=\"Imperial\">\n                                        {this.renderLabelChoices([\n                                            [\"inches\", \"in\"],\n                                            [\"feet\", \"ft\"],\n                                            [\"yards\", \"yd\"],\n                                            [\"miles\", \"mi\"],\n                                        ])}\n                                    </optgroup>\n                                </select>\n                            </label>\n                        </div>\n                        <div>\n                            <label>\n                                {\" \"}Ruler ticks:{\" \"}\n                                <select\n                                    onChange={e => this.change(\n                                        \"rulerTicks\",\n                                        +e.target.value\n                                    )}\n                                    value={this.props.rulerTicks}\n                                >\n                                    {_.map([1, 2, 4, 8, 10, 16], function(n) {\n                                        return (\n                                            <option key={n} value={n}>\n                                                {n}\n                                            </option>\n                                        );\n                                    })}\n                                </select>\n                            </label>\n                        </div>\n                        <div>\n                            <label>\n                                Ruler pixels per unit:{\" \"}\n                                <NumberInput\n                                    placeholder={40}\n                                    onChange={this.change(\"rulerPixels\")}\n                                    value={this.props.rulerPixels}\n                                    useArrowKeys={true}\n                                />\n                            </label>\n                        </div>\n                        <div>\n                            <label>\n                                Ruler length in units:{\" \"}\n                                <NumberInput\n                                    placeholder={10}\n                                    onChange={this.change(\"rulerLength\")}\n                                    value={this.props.rulerLength}\n                                    useArrowKeys={true}\n                                />\n                            </label>\n                        </div>\n                    </div>}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    _changeUrl: function(e) {\n        this._changeImage(\"url\", e.target.value);\n    },\n\n    _changeTop: function(newTop) {\n        this._changeImage(\"top\", newTop);\n    },\n\n    _changeLeft: function(newLeft) {\n        this._changeImage(\"left\", newLeft);\n    },\n\n    _changeImage: function(subProp, newValue) {\n        var image = _.clone(this.props.image);\n        image[subProp] = newValue;\n        this.change(\"image\", image);\n    },\n\n    renderLabelChoices: function(choices) {\n        return _.map(choices, function(nameAndValue) {\n            var [name, value] = nameAndValue;\n            return (\n                <option key={value} value={value}>\n                    {name}\n                </option>\n            );\n        });\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = MeasurerEditor;\nexport default _module_.exports;\n","import _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nconst GraphUtils = _utilGraphUtilsJs;\n\nvar defaultImage = {\n    url: null,\n    top: 0,\n    left: 0,\n};\n\nvar Measurer = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        box: PropTypes.arrayOf(PropTypes.number),\n        image: PropTypes.shape({\n            url: PropTypes.string,\n            top: PropTypes.number,\n            left: PropTypes.number,\n        }),\n        showProtractor: PropTypes.bool,\n        protractorX: PropTypes.number,\n        protractorY: PropTypes.number,\n        showRuler: PropTypes.bool,\n        rulerLabel: PropTypes.string,\n        rulerTicks: PropTypes.number,\n        rulerPixels: PropTypes.number,\n        rulerLength: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            box: [480, 480],\n            image: {},\n            showProtractor: true,\n            protractorX: 7.5,\n            protractorY: 0.5,\n            showRuler: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n            rulerPixels: 40,\n            rulerLength: 10,\n        };\n    },\n\n    getInitialState: function() {\n        return {};\n    },\n\n    render: function() {\n        var image = _.extend({}, defaultImage, this.props.image);\n        return (\n            <div\n                className={\n                    \"perseus-widget perseus-widget-measurer \" +\n                    \"graphie-container above-scratchpad\"\n                }\n                style={{width: this.props.box[0], height: this.props.box[1]}}\n            >\n                {image.url &&\n                    <img\n                        src={image.url}\n                        style={{\n                            top: image.top,\n                            left: image.left,\n                        }}\n                    />}\n                <div className=\"graphie\" ref=\"graphieDiv\" />\n            </div>\n        );\n    },\n\n    componentDidMount: function() {\n        this.setupGraphie();\n    },\n\n    componentDidUpdate: function(prevProps) {\n        var shouldSetupGraphie = _.any(\n            [\n                \"box\",\n                \"showProtractor\",\n                \"showRuler\",\n                \"rulerLabel\",\n                \"rulerTicks\",\n                \"rulerPixels\",\n                \"rulerLength\",\n            ],\n            function(prop) {\n                return prevProps[prop] !== this.props[prop];\n            },\n            this\n        );\n\n        if (shouldSetupGraphie) {\n            this.setupGraphie();\n        }\n    },\n\n    setupGraphie: function() {\n        var graphieDiv = ReactDOM.findDOMNode(this.refs.graphieDiv);\n        $(graphieDiv).empty();\n        var graphie = (this.graphie = GraphUtils.createGraphie(graphieDiv));\n\n        var scale = [40, 40];\n        var range = [\n            [0, this.props.box[0] / scale[0]],\n            [0, this.props.box[1] / scale[1]],\n        ];\n        graphie.init({\n            range: range,\n            scale: scale,\n        });\n        graphie.addMouseLayer({\n            allowScratchpad: true,\n            setDrawingAreaAvailable: this.props.apiOptions\n                .setDrawingAreaAvailable,\n        });\n\n        if (this.protractor) {\n            this.protractor.remove();\n        }\n\n        if (this.props.showProtractor) {\n            this.protractor = graphie.protractor([\n                this.props.protractorX,\n                this.props.protractorY,\n            ]);\n        }\n\n        if (this.ruler) {\n            this.ruler.remove();\n        }\n\n        if (this.props.showRuler) {\n            this.ruler = graphie.ruler({\n                center: [\n                    (range[0][0] + range[0][1]) / 2,\n                    (range[1][0] + range[1][1]) / 2,\n                ],\n                label: this.props.rulerLabel,\n                pixelsPerUnit: this.props.rulerPixels,\n                ticksPerUnit: this.props.rulerTicks,\n                units: this.props.rulerLength,\n            });\n        }\n    },\n\n    getUserInput: function() {\n        return {};\n    },\n\n    simpleValidate: function(rubric) {\n        // TODO(joel) - I don't understand how this is useful!\n        return Measurer.validate(this.getUserInput(), rubric);\n    },\n\n    focus: $.noop,\n});\n\n_.extend(Measurer, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 1,\n            total: 1,\n            message: null,\n        };\n    },\n});\n\nvar propUpgrades = {\n    1: v0props => {\n        var v1props = _.chain(v0props)\n            .omit(\"imageUrl\", \"imageTop\", \"imageLeft\")\n            .extend({\n                image: {\n                    url: v0props.imageUrl,\n                    top: v0props.imageTop,\n                    left: v0props.imageLeft,\n                },\n            })\n            .value();\n        return v1props;\n    },\n};\n\n_module_.exports = {\n    name: \"measurer\",\n    displayName: \"Measurer\",\n    widget: Measurer,\n    version: {major: 1, minor: 0},\n    propUpgrades: propUpgrades,\n};\nexport default _module_.exports;\n","import _componentsTextListEditorJsx from \"../components/text-list-editor.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar InfoTip = _componentsInfoTipJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\nvar TextListEditor = _componentsTextListEditorJsx;\n\nvar MatcherEditor = createReactClass({\n    propTypes: {\n        left: PropTypes.array,\n        right: PropTypes.array,\n        labels: PropTypes.array,\n        orderMatters: PropTypes.bool,\n        padding: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            left: [\"$x$\", \"$y$\", \"$z$\"],\n            right: [\"$1$\", \"$2$\", \"$3$\"],\n            labels: [\"test\", \"label\"],\n            orderMatters: false,\n            padding: true,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-matcher-editor\">\n                <div>\n                    {\" \"}Correct answer:{\" \"}\n                    <InfoTip>\n                        <p>\n                            Enter the correct answers here. The preview on the\n                            right will show the cards in a randomized order,\n                            which is how the student will see them.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div className=\"perseus-clearfix\">\n                    <TextListEditor\n                        options={this.props.left}\n                        onChange={(options, cb) => {\n                            this.props.onChange({left: options}, cb);\n                        }}\n                        layout=\"vertical\"\n                    />\n                    <TextListEditor\n                        options={this.props.right}\n                        onChange={(options, cb) => {\n                            this.props.onChange({right: options}, cb);\n                        }}\n                        layout=\"vertical\"\n                    />\n                </div>\n                <span>\n                    {\" \"}Labels:{\" \"}\n                    <InfoTip>\n                        <p>These are entirely optional.</p>\n                    </InfoTip>\n                </span>\n                <div>\n                    <input\n                        type=\"text\"\n                        defaultValue={this.props.labels[0]}\n                        onChange={this.onLabelChange.bind(this, 0)}\n                    />\n                    <input\n                        type=\"text\"\n                        defaultValue={this.props.labels[1]}\n                        onChange={this.onLabelChange.bind(this, 1)}\n                    />\n                </div>\n                <div>\n                    <PropCheckBox\n                        label=\"Order of the matched pairs matters:\"\n                        orderMatters={this.props.orderMatters}\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            With this option enabled, only the order provided\n                            above will be treated as correct. This is useful\n                            when ordering is significant, such as in the context\n                            of a proof.\n                        </p>\n                        <p>\n                            If disabled, pairwise matching is sufficient. To\n                            make this clear, the left column becomes fixed in\n                            the provided order and only the cards in the right\n                            column can be moved.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div>\n                    <PropCheckBox\n                        label=\"Padding:\"\n                        padding={this.props.padding}\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            Padding is good for text, but not needed for images.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n\n    onLabelChange: function(index, e) {\n        var labels = _.clone(this.props.labels);\n        labels[index] = e.target.value;\n        this.props.onChange({labels: labels});\n    },\n\n    getSaveWarnings: function() {\n        if (this.props.left.length !== this.props.right.length) {\n            return [\n                \"The two halves of the matcher have different numbers\" +\n                    \" of cards.\",\n            ];\n        }\n        return [];\n    },\n\n    serialize: function() {\n        return _.pick(\n            this.props,\n            \"left\",\n            \"right\",\n            \"labels\",\n            \"orderMatters\",\n            \"padding\"\n        );\n    },\n});\n\n_module_.exports = MatcherEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _utilJs2 from \"../util.js\";\nimport _utilJs from \"../util.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsSortableJsx from \"../components/sortable.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _underscore from \"underscore\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Renderer = _rendererJsx;\nconst Sortable = _componentsSortableJsx;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst shuffle = _utilJs.shuffle;\nconst seededRNG = _utilJs2.seededRNG;\n\nconst HACKY_CSS_CLASSNAME = \"perseus-widget-matcher\";\n\nconst Matcher = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        labels: PropTypes.array,\n        left: PropTypes.array,\n        onChange: PropTypes.func,\n        orderMatters: PropTypes.bool,\n        padding: PropTypes.bool,\n        problemNum: PropTypes.number,\n        right: PropTypes.array,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            left: [],\n            right: [],\n            labels: [\"\", \"\"],\n            orderMatters: false,\n            padding: true,\n            problemNum: 0,\n            onChange: function() {},\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            leftHeight: 0,\n            rightHeight: 0,\n        };\n    },\n\n    render: function() {\n        // Use the same random() function to shuffle both columns sequentially\n        var rng = seededRNG(this.props.problemNum);\n\n        var left;\n        if (!this.props.orderMatters) {\n            // If the order doesn't matter, don't shuffle the left column\n            left = this.props.left;\n        } else {\n            left = shuffle(this.props.left, rng, /* ensurePermuted */ true);\n        }\n\n        var right = shuffle(this.props.right, rng, /* ensurePermuted */ true);\n\n        var showLabels = _.any(this.props.labels);\n        var constraints = {\n            height: _.max([this.state.leftHeight, this.state.rightHeight]),\n        };\n\n        const cellMarginPx = this.props.apiOptions.isMobile ? 8 : 5;\n\n        return (\n            <table className={css(styles.widget) + \" \" + HACKY_CSS_CLASSNAME}>\n                <tbody>\n                    {showLabels &&\n                        <tr className={css(styles.row)}>\n                            <th\n                                className={css(\n                                    styles.column,\n                                    styles.columnLabel\n                                )}\n                            >\n                                <Renderer\n                                    content={this.props.labels[0] || \"...\"}\n                                    linterContext={this.props.linterContext}\n                                />\n                            </th>\n                            <th\n                                className={css(\n                                    styles.column,\n                                    styles.columnRight,\n                                    styles.columnLabel\n                                )}\n                            >\n                                <Renderer\n                                    content={this.props.labels[1] || \"...\"}\n                                    linterContext={this.props.linterContext}\n                                />\n                            </th>\n                        </tr>}\n                    <tr className={css(styles.row)}>\n                        <td className={css(styles.column)}>\n                            <Sortable\n                                options={left}\n                                layout=\"vertical\"\n                                padding={this.props.padding}\n                                disabled={!this.props.orderMatters}\n                                constraints={constraints}\n                                onMeasure={this.onMeasureLeft}\n                                onChange={this.changeAndTrack}\n                                margin={cellMarginPx}\n                                linterContext={this.props.linterContext}\n                                ref=\"left\"\n                            />\n                        </td>\n                        <td className={css(styles.column, styles.columnRight)}>\n                            <Sortable\n                                options={right}\n                                layout=\"vertical\"\n                                padding={this.props.padding}\n                                constraints={constraints}\n                                onMeasure={this.onMeasureRight}\n                                onChange={this.changeAndTrack}\n                                margin={cellMarginPx}\n                                linterContext={this.props.linterContext}\n                                ref=\"right\"\n                            />\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        );\n    },\n\n    changeAndTrack: function(e) {\n        this.props.onChange(e);\n        this.props.trackInteraction();\n    },\n\n    onMeasureLeft: function(dimensions) {\n        var height = _.max(dimensions.heights);\n        this.setState({leftHeight: height});\n    },\n\n    onMeasureRight: function(dimensions) {\n        var height = _.max(dimensions.heights);\n        this.setState({rightHeight: height});\n    },\n\n    getUserInput: function() {\n        return {\n            left: this.refs.left.getOptions(),\n            right: this.refs.right.getOptions(),\n        };\n    },\n\n    simpleValidate: function(rubric) {\n        return Matcher.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Matcher, {\n    validate: function(state, rubric) {\n        var correct =\n            _.isEqual(state.left, rubric.left) &&\n            _.isEqual(state.right, rubric.right);\n\n        return {\n            type: \"points\",\n            earned: correct ? 1 : 0,\n            total: 1,\n            message: null,\n        };\n    },\n});\n\nconst padding = 5;\nconst border = \"1px solid #444\";\n\nconst styles = StyleSheet.create({\n    widget: {\n        paddingTop: padding,\n        maxWidth: \"100%\",\n\n        // Need to override minWidth in CSS :(\n        minWidth: \"auto\",\n    },\n\n    row: {\n        // Need to override global rules in CSS :(\n        border: 0,\n    },\n\n    column: {\n        // TODO(benkomalo): constraint to half width?\n        padding: 0,\n        border: 0,\n    },\n\n    columnRight: {\n        borderLeft: border,\n    },\n\n    columnLabel: {\n        fontWeight: \"inherit\",\n        borderBottom: border,\n        padding: `0 ${padding}px ${padding}px ${padding}px`,\n        textAlign: \"center\",\n    },\n});\n\n_module_.exports = {\n    name: \"matcher\",\n    displayName: \"Two column matcher\",\n    widget: Matcher,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _utilJs from \"../util.js\";\nimport _interactive2InteractiveUtilJs from \"../interactive2/interactive-util.js\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _utilAnswerTypesJs from \"../util/answer-types.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, max-len, no-undef, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar classNames = _classnames;\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar NumberInput = _componentsNumberInputJsx;\nvar Renderer = _rendererJsx;\nvar TextInput = _componentsTextInputJsx;\nvar MathOutput = _componentsMathOutputJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\n\nvar ApiOptions = _perseusApiJsx.Options;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\nconst {keypadElementPropType} = _mathInput.propTypes;\n\nvar assert = _interactive2InteractiveUtilJs.assert;\nvar stringArrayOfSize = _utilJs.stringArrayOfSize;\n\n// We store three sets of dimensions for the brackets, for our three types of\n// inputs, which vary in formatting: (1) the \"static\" inputs rendered for the\n// mobile apps (that are being deprecated), (2) the normal inputs rendered on\n// desktop, and (3) the keypad-based inputs newly rendered for the mobile apps\n// and mobile web. The first two sets of dimensions come from `matrix.less`;\n// the keypad-based input's dimensions are provided to the component itself,\n// below.\nvar STATIC_INPUT_DIMENSIONS = {\n    INPUT_MARGIN: 4,\n    INPUT_HEIGHT: 38,\n    INPUT_WIDTH: 82,\n};\n\nvar NORMAL_DIMENSIONS = {\n    INPUT_MARGIN: 3,\n    INPUT_HEIGHT: 30,\n    INPUT_WIDTH: 40,\n};\n\nconst KEYPAD_INPUT_DIMENSIONS = {\n    INPUT_MARGIN: 4,\n    INPUT_HEIGHT: 36,\n    INPUT_WIDTH: 64,\n};\n\n/* Input handling: Maps a (row, column) pair to a unique ref used by React,\n * and extracts (row, column) pairs from input paths, used to allow outsiders\n * to focus, blur, set input values, etc. */\nvar getInputPath = function(row, column) {\n    return [\"\" + row, \"\" + column];\n};\n\nvar getDefaultPath = function() {\n    return getInputPath(0, 0);\n};\n\nvar getRowFromPath = function(path) {\n    // 'path' should be a (row, column) pair\n    assert(_.isArray(path) && path.length === 2);\n    return +path[0];\n};\n\nvar getColumnFromPath = function(path) {\n    // 'path' should be a (row, column) pair\n    assert(_.isArray(path) && path.length === 2);\n    return +path[1];\n};\n\nvar getRefForPath = function(path) {\n    var row = getRowFromPath(path);\n    var column = getColumnFromPath(path);\n    return \"answer\" + row + \",\" + column;\n};\n\nvar getMatrixSize = function(matrix) {\n    var matrixSize = [1, 1];\n\n    // We need to find the widest row and tallest column to get the correct\n    // matrix size.\n    _.each(matrix, (matrixRow, row) => {\n        var rowWidth = 0;\n        _.each(matrixRow, (matrixCol, col) => {\n            if (matrixCol != null && matrixCol.toString().length) {\n                rowWidth = col + 1;\n            }\n        });\n\n        // Matrix width:\n        matrixSize[1] = Math.max(matrixSize[1], rowWidth);\n\n        // Matrix height:\n        if (rowWidth > 0) {\n            matrixSize[0] = Math.max(matrixSize[0], row + 1);\n        }\n    });\n    return matrixSize;\n};\n\nvar Matrix = createReactClass({\n    propTypes: {\n        answers: PropTypes.arrayOf(\n            PropTypes.arrayOf(\n                PropTypes.oneOfType([\n                    PropTypes.string,\n                    PropTypes.number,\n                ])\n            )\n        ),\n        apiOptions: ApiOptions.propTypes,\n        cursorPosition: PropTypes.arrayOf(PropTypes.number),\n        keypadElement: keypadElementPropType,\n        matrixBoardSize: PropTypes.arrayOf(PropTypes.number)\n            .isRequired,\n        prefix: PropTypes.string,\n        suffix: PropTypes.string,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            matrixBoardSize: [3, 3],\n            answers: [[]],\n            prefix: \"\",\n            suffix: \"\",\n            cursorPosition: [0, 0],\n            apiOptions: ApiOptions.defaults,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            enterTheMatrix: 0,\n        };\n    },\n\n    componentDidMount: function() {\n        // Used in the `onBlur` and `onFocus` handlers\n        this.cursorPosition = [0, 0];\n    },\n\n    render: function() {\n        // Set the input sizes through JS so we can control the size of the\n        // brackets. (If we set them in CSS we won't know values until the\n        // inputs are rendered.)\n        let dimensions;\n        if (this.props.apiOptions.customKeypad) {\n            dimensions = KEYPAD_INPUT_DIMENSIONS;\n        } else if (this.props.apiOptions.staticRender) {\n            dimensions = STATIC_INPUT_DIMENSIONS;\n        } else {\n            dimensions = NORMAL_DIMENSIONS;\n        }\n        const {INPUT_MARGIN, INPUT_HEIGHT, INPUT_WIDTH} = dimensions;\n\n        var matrixSize = getMatrixSize(this.props.answers);\n        var maxRows = this.props.matrixBoardSize[0];\n        var maxCols = this.props.matrixBoardSize[1];\n        var cursorRow = this.props.cursorPosition[0];\n        var cursorCol = this.props.cursorPosition[1];\n\n        var highlightedRow = Math.max(cursorRow, matrixSize[0] - 1);\n        var highlightedCol = Math.max(cursorCol, matrixSize[1] - 1);\n        var bracketHeight =\n            (highlightedRow + 1) * (INPUT_HEIGHT + 2 * INPUT_MARGIN);\n        var bracketOffset =\n            (highlightedCol + 1) * (INPUT_WIDTH + 2 * INPUT_MARGIN);\n\n        var className = classNames({\n            \"perseus-matrix\": true,\n            \"static-mode\": this.props.static,\n            \"the-matrix\": this.state.enterTheMatrix >= 5,\n        });\n\n        return (\n            <div className={className}>\n                {this.props.prefix &&\n                    <div className=\"matrix-prefix\">\n                        <Renderer\n                            content={this.props.prefix}\n                            linterContext={this.props.linterContext}\n                        />\n                    </div>}\n                <div className=\"matrix-input\">\n                    <div\n                        className={\"matrix-bracket bracket-left\"}\n                        style={{\n                            height: bracketHeight,\n                        }}\n                    />\n                    <div\n                        className={\"matrix-bracket bracket-right\"}\n                        style={{\n                            height: bracketHeight,\n                            left: bracketOffset,\n                        }}\n                    />\n                    {_.times(maxRows, row => {\n                        var rowVals = this.props.answers[row];\n                        return (\n                            <div className=\"matrix-row\" key={row}>\n                                {_.times(maxCols, col => {\n                                    var outside =\n                                        row > highlightedRow ||\n                                        col > highlightedCol;\n                                    var inputProps = {\n                                        className: outside\n                                            ? \"outside\"\n                                            : \"inside\",\n                                        ref: getRefForPath(\n                                            getInputPath(row, col)\n                                        ),\n                                        value: rowVals ? rowVals[col] : null,\n                                        style: {\n                                            height: INPUT_HEIGHT,\n                                            width: INPUT_WIDTH,\n                                            margin: INPUT_MARGIN,\n                                        },\n                                        disabled: this.props.apiOptions\n                                            .readOnly,\n                                        onFocus: () => {\n                                            // We store this locally so that we can use\n                                            // the new information in the `onBlur`\n                                            // handler, which happens before the props\n                                            // change has time to propagate.\n                                            // TODO(emily): Try to fix `MathOutput` so\n                                            // it correctly sends blur events before\n                                            // focus events.\n                                            this.cursorPosition = [row, col];\n                                            this.props.onChange(\n                                                {\n                                                    cursorPosition: [row, col],\n                                                },\n                                                () => {\n                                                    // This isn't a user interaction, so\n                                                    // return false to signal that the\n                                                    // matrix shouldn't be focused\n                                                    return false;\n                                                }\n                                            );\n                                            this._handleFocus(row, col);\n                                        },\n                                        onBlur: () => {\n                                            if (\n                                                row ===\n                                                    this.cursorPosition[0] &&\n                                                col === this.cursorPosition[1]\n                                            ) {\n                                                this.props.onChange(\n                                                    {\n                                                        cursorPosition: [0, 0],\n                                                    },\n                                                    () => {\n                                                        // This isn't a user interaction,\n                                                        // so return false to signal that\n                                                        // the matrix shouldn't be focused\n                                                        return false;\n                                                    }\n                                                );\n                                            }\n                                            this._handleBlur(row, col);\n                                        },\n                                        onKeyDown: e => {\n                                            this.handleKeyDown(row, col, e);\n                                        },\n                                        onChange: (value, cb) => {\n                                            this.onValueChange(\n                                                row,\n                                                col,\n                                                value,\n                                                cb\n                                            );\n                                        },\n                                    };\n\n                                    let MatrixInput;\n                                    if (this.props.apiOptions.customKeypad) {\n                                        const style = {\n                                            margin: INPUT_MARGIN,\n                                            minWidth: INPUT_WIDTH,\n                                            minHeight: INPUT_HEIGHT,\n                                            // Ensure that any borders are included in\n                                            // the provided width.\n                                            boxSizing: \"border-box\",\n                                            backgroundColor: outside\n                                                ? \"#f3f3f3\"\n                                                : \"#fff\",\n                                        };\n\n                                        MatrixInput = (\n                                            <SimpleKeypadInput\n                                                {...inputProps}\n                                                style={style}\n                                                scrollable={true}\n                                                keypadElement={\n                                                    this.props.keypadElement\n                                                }\n                                            />\n                                        );\n                                    } else if (\n                                        this.props.apiOptions.staticRender\n                                    ) {\n                                        MatrixInput = (\n                                            <MathOutput {...inputProps} />\n                                        );\n                                    } else if (this.props.numericInput) {\n                                        MatrixInput = (\n                                            <NumberInput {...inputProps} />\n                                        );\n                                    } else {\n                                        MatrixInput = (\n                                            <TextInput {...inputProps} />\n                                        );\n                                    }\n                                    return (\n                                        <span\n                                            key={col}\n                                            className=\"matrix-input-field\"\n                                        >\n                                            {MatrixInput}\n                                        </span>\n                                    );\n                                })}\n                            </div>\n                        );\n                    })}\n                </div>\n                {this.props.suffix &&\n                    <div className=\"matrix-suffix\">\n                        <Renderer\n                            content={this.props.suffix}\n                            linterContext={this.props.linterContext}\n                        />\n                    </div>}\n            </div>\n        );\n    },\n\n    getInputPaths: function() {\n        var inputPaths = [];\n        var maxRows = this.props.matrixBoardSize[0];\n        var maxCols = this.props.matrixBoardSize[1];\n\n        _.times(maxRows, row => {\n            _.times(maxCols, col => {\n                var inputPath = getInputPath(row, col);\n                inputPaths.push(inputPath);\n            });\n        });\n\n        return inputPaths;\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        return \"number\";\n    },\n\n    _handleFocus: function(row, col) {\n        this.props.onFocus(getInputPath(row, col));\n    },\n\n    _handleBlur: function(row, col) {\n        this.props.onBlur(getInputPath(row, col));\n    },\n\n    focus: function() {\n        this.focusInputPath(getDefaultPath());\n        return true;\n    },\n\n    focusInputPath: function(path) {\n        var inputID = getRefForPath(path);\n        this.refs[inputID].focus();\n    },\n\n    blurInputPath: function(path) {\n        if (path.length === 0) {\n            path = getDefaultPath();\n        }\n\n        var inputID = getRefForPath(path);\n        this.refs[inputID].blur();\n    },\n\n    getDOMNodeForPath: function(inputPath) {\n        var inputID = getRefForPath(inputPath);\n        return ReactDOM.findDOMNode(this.refs[inputID]);\n    },\n\n    setInputValue: function(inputPath, value, callback) {\n        var row = getRowFromPath(inputPath);\n        var col = getColumnFromPath(inputPath);\n        this.onValueChange(row, col, value, callback);\n    },\n\n    handleKeyDown: function(row, col, e) {\n        var maxRow = this.props.matrixBoardSize[0];\n        var maxCol = this.props.matrixBoardSize[1];\n        var enterTheMatrix = null;\n\n        var curInput = this.refs[getRefForPath(getInputPath(row, col))];\n        var curValueString = curInput.getStringValue();\n        var cursorStartPosition = curInput.getSelectionStart();\n        var cursorEndPosition = curInput.getSelectionEnd();\n\n        var nextPath = null;\n        if (e.key === \"ArrowUp\" && row > 0) {\n            nextPath = getInputPath(row - 1, col);\n        } else if (e.key === \"ArrowDown\" && row + 1 < maxRow) {\n            nextPath = getInputPath(row + 1, col);\n        } else if (e.key === \"ArrowLeft\" && col > 0) {\n            if (cursorStartPosition === 0 && cursorEndPosition === 0) {\n                // Only go to next input if we're at the *start* of the content\n                nextPath = getInputPath(row, col - 1);\n            }\n        } else if (e.key === \"ArrowRight\" && col + 1 < maxCol) {\n            if (cursorStartPosition === curValueString.length) {\n                // Only go to next input if we're at the *end* of the content\n                nextPath = getInputPath(row, col + 1);\n            }\n        } else if (e.key === \"Enter\") {\n            enterTheMatrix = this.state.enterTheMatrix + 1;\n        } else if (e.key === \"Escape\") {\n            enterTheMatrix = 0;\n        }\n\n        if (nextPath) {\n            // Prevent the cursor from jumping again inside the next input\n            e.preventDefault();\n\n            // Focus the input and move the cursor to the end of it.\n            var input = this.refs[getRefForPath(nextPath)];\n\n            // Multiply by 2 to ensure the cursor always ends up at the end;\n            // Opera sometimes sees a carriage return as 2 characters.\n            var inputValString = input.getStringValue();\n            var valueLength = inputValString.length * 2;\n\n            input.focus();\n            if (e.key === \"ArrowRight\") {\n                input.setSelectionRange(0, 0);\n            } else {\n                input.setSelectionRange(valueLength, valueLength);\n            }\n        }\n\n        if (enterTheMatrix != null) {\n            this.setState({\n                enterTheMatrix: enterTheMatrix,\n            });\n        }\n    },\n\n    onValueChange: function(row, column, value, cb) {\n        var answers = _.map(this.props.answers, _.clone);\n        if (!answers[row]) {\n            answers[row] = [];\n        }\n        answers[row][column] = value;\n        this.props.onChange(\n            {\n                answers: answers,\n            },\n            cb\n        );\n        this.props.trackInteraction();\n    },\n\n    getUserInput: function() {\n        return {\n            answers: this.props.answers,\n        };\n    },\n\n    simpleValidate: function(rubric) {\n        return Matrix.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Matrix, {\n    validate: function(state, rubric) {\n        var solution = rubric.answers;\n        var supplied = state.answers;\n        var solutionSize = getMatrixSize(solution);\n        var suppliedSize = getMatrixSize(supplied);\n\n        var incorrectSize =\n            solutionSize[0] !== suppliedSize[0] ||\n            solutionSize[1] !== suppliedSize[1];\n\n        var createValidator = KhanAnswerTypes.number.createValidatorFunctional;\n        var message = null;\n        var hasEmptyCell = false;\n        var incorrect = false;\n        _.times(suppliedSize[0], row => {\n            _.times(suppliedSize[1], col => {\n                if (\n                    supplied[row][col] == null ||\n                    supplied[row][col].toString().length === 0\n                ) {\n                    hasEmptyCell = true;\n                }\n                var validator = createValidator(solution[row][col], {\n                    simplify: true,\n                });\n                var result = validator(supplied[row][col]);\n                if (result.message) {\n                    message = result.message;\n                }\n                if (!result.correct) {\n                    incorrect = true;\n                }\n            });\n        });\n\n        if (hasEmptyCell) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\n                    \"Make sure you fill in all cells in the matrix.\"\n                ),\n            };\n        }\n\n        if (incorrectSize) {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n\n        return {\n            type: \"points\",\n            earned: incorrect ? 0 : 1,\n            total: 1,\n            message: message,\n        };\n    },\n});\n\nvar propTransform = editorProps => {\n    // Remove answers before passing to widget\n    var blankAnswers = _.times(editorProps.matrixBoardSize[0], function() {\n        return stringArrayOfSize(editorProps.matrixBoardSize[1]);\n    });\n    editorProps = _.pick(editorProps, \"matrixBoardSize\", \"prefix\", \"suffix\");\n    return _.extend(editorProps, {\n        answers: blankAnswers,\n    });\n};\n\nvar staticTransform = editorProps => {\n    var widgetProps = _.pick(\n        editorProps,\n        \"matrixBoardSize\",\n        \"prefix\",\n        \"suffix\"\n    );\n    // We convert matrix cells from numbers to string to match the expected\n    // input into the rendered widget.\n    widgetProps.answers = _.map(editorProps.answers, row => {\n        // Replace null values with empty string\n        return _.map(row, cell => cell != null ? String(cell) : \"\");\n    });\n    return widgetProps;\n};\n\n_module_.exports = {\n    name: \"matrix\",\n    displayName: \"Matrix\",\n    widget: Matrix,\n    transform: propTransform,\n    staticTransform: staticTransform,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _matrixJsx from \"./matrix.jsx\";\nimport _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/sort-comp, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar Editor = _editorJsx;\nvar RangeInput = _componentsRangeInputJsx;\n\nvar Matrix = _matrixJsx.widget;\n\n// Really large matrices will cause issues with question formatting, so we\n// have to cap it at some point.\nvar MAX_BOARD_SIZE = 6;\n\nvar getMatrixSize = function(matrix) {\n    var matrixSize = [1, 1];\n\n    // We need to find the widest row and tallest column to get the correct\n    // matrix size.\n    _.each(matrix, (matrixRow, row) => {\n        var rowWidth = 0;\n        _.each(matrixRow, (matrixCol, col) => {\n            if (matrixCol != null && matrixCol.toString().length) {\n                rowWidth = col + 1;\n            }\n        });\n\n        // Matrix width:\n        matrixSize[1] = Math.max(matrixSize[1], rowWidth);\n\n        // Matrix height:\n        if (rowWidth > 0) {\n            matrixSize[0] = Math.max(matrixSize[0], row + 1);\n        }\n    });\n    return matrixSize;\n};\n\nvar MatrixEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        matrixBoardSize: PropTypes.arrayOf(PropTypes.number)\n            .isRequired,\n        answers: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.number)\n        ),\n        prefix: PropTypes.string,\n        suffix: PropTypes.string,\n        cursorPosition: PropTypes.arrayOf(PropTypes.number),\n    },\n\n    getDefaultProps: function() {\n        return {\n            matrixBoardSize: [3, 3],\n            answers: [[]],\n            prefix: \"\",\n            suffix: \"\",\n            cursorPosition: [0, 0],\n        };\n    },\n\n    render: function() {\n        var matrixProps = _.extend(\n            {\n                numericInput: true,\n                onBlur: () => {},\n                onFocus: () => {},\n                trackInteraction: () => {},\n            },\n            this.props\n        );\n        return (\n            <div className=\"perseus-matrix-editor\">\n                <div className=\"perseus-widget-row\">\n                    {\" \"}Max matrix size:{\" \"}\n                    <RangeInput\n                        value={this.props.matrixBoardSize}\n                        onChange={this.onMatrixBoardSizeChange}\n                        format={this.props.labelStyle}\n                        useArrowKeys={true}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <Matrix {...matrixProps} />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    {\" \"}Matrix prefix:{\" \"}\n                    <Editor\n                        ref={\"prefix\"}\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.prefix}\n                        widgetEnabled={false}\n                        onChange={newProps => {\n                            this.change({prefix: newProps.content});\n                        }}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    {\" \"}Matrix suffix:{\" \"}\n                    <Editor\n                        ref={\"suffix\"}\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.suffix}\n                        widgetEnabled={false}\n                        onChange={newProps => {\n                            this.change({suffix: newProps.content});\n                        }}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    onMatrixBoardSizeChange: function(range) {\n        var matrixSize = getMatrixSize(this.props.answers);\n        if (range[0] !== null && range[1] !== null) {\n            range = [\n                Math.round(Math.min(Math.max(range[0], 1), MAX_BOARD_SIZE)),\n                Math.round(Math.min(Math.max(range[1], 1), MAX_BOARD_SIZE)),\n            ];\n            var answers = _.times(Math.min(range[0], matrixSize[0]), row => {\n                return _.times(Math.min(range[1], matrixSize[1]), col => {\n                    return this.props.answers[row][col];\n                });\n            });\n            this.props.onChange({\n                matrixBoardSize: range,\n                answers: answers,\n            });\n        }\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = MatrixEditor;\nexport default _module_.exports;\n","import _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable array-bracket-spacing, comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst NumberInput = _componentsNumberInputJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst InfoTip = _componentsInfoTipJsx;\n\nconst MAX_SIZE = 8;\n\n// styling\nvar CELL_PADDING = 5;\n\nvar TABLE_STYLE = {\n    display: \"table\",\n    tableLayout: \"fixed\",\n};\n\nvar ROW_STYLE = {\n    display: \"table-row\",\n};\n\nvar CELL_STYLE = {\n    display: \"table-cell\",\n    padding: CELL_PADDING,\n};\n\nvar BASE_TILE_STYLE = {\n    borderRadius: 10,\n    cursor: \"pointer\",\n};\n\nvar PATTERNS = {\n    plus: () => [\n        [false, true, false],\n        [true, true, true],\n        [false, true, false],\n    ],\n    x: () => [[true, false, true], [false, true, false], [true, false, true]],\n    \"plus/x\": iter => {\n        return iter % 2 ? PATTERNS.x() : PATTERNS.plus();\n    },\n};\n\n/**\n * Clamps value to an integer in the range [min, max]\n */\nvar clampToInt = function(value, min, max) {\n    value = Math.floor(value);\n    value = Math.max(value, min);\n    value = Math.min(value, max);\n    return value;\n};\n\n// Returns a copy of the tiles, with tiles flipped according to\n// whether or not their y, x position satisfies the predicate\nvar flipTilesPredicate = (oldCells, predicate) => {\n    return _.map(oldCells, (row, y) => {\n        return _.map(row, (cell, x) => {\n            return predicate(y, x) ? !cell : cell;\n        });\n    });\n};\n\n// A single glowy cell\nvar Tile = createReactClass({\n    propTypes: {\n        value: PropTypes.bool.isRequired,\n        size: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        var color = this.props.value ? \"#55dd55\" : \"#115511\";\n        var style = _.extend({}, BASE_TILE_STYLE, {\n            width: this.props.size,\n            height: this.props.size,\n            backgroundColor: color,\n        });\n        return <div style={style} onClick={this._flip} />;\n    },\n\n    _flip: function() {\n        this.props.onChange(!this.props.value);\n    },\n});\n\n// A grid of glowy cells\nvar TileGrid = createReactClass({\n    propTypes: {\n        cells: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.bool)\n        ).isRequired,\n        size: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        return (\n            <div style={TABLE_STYLE} className=\"no-select\">\n                {_.map(this.props.cells, (row, y) => {\n                    return (\n                        <div key={y} style={ROW_STYLE}>\n                            {_.map(row, (cell, x) => {\n                                return (\n                                    <div key={x} style={CELL_STYLE}>\n                                        <Tile\n                                            value={cell}\n                                            size={this.props.size}\n                                            onChange={_.partial(\n                                                this.props.onChange,\n                                                y,\n                                                x\n                                            )}\n                                        />\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    );\n                })}\n            </div>\n        );\n    },\n});\n\n// The widget editor\nconst LightsPuzzleEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        startCells: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.bool)\n        ),\n        flipPattern: PropTypes.string.isRequired,\n        gradeIncompleteAsWrong: PropTypes.bool.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            startCells: [\n                [false, false, false],\n                [false, false, false],\n                [false, false, false],\n            ],\n            flipPattern: \"plus\",\n            gradeIncompleteAsWrong: false,\n        };\n    },\n\n    _height: function() {\n        return this.props.startCells.length;\n    },\n\n    _width: function() {\n        if (this.props.startCells.length !== 0) {\n            return this.props.startCells[0].length;\n        } else {\n            return 0; // default to 0\n        }\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <div>\n                    Width:\n                    <NumberInput\n                        value={this._width()}\n                        placeholder={5}\n                        onChange={this._changeWidth}\n                    />\n                    {\", \"}\n                    Height:\n                    <NumberInput\n                        value={this._height()}\n                        placeholder={5}\n                        onChange={this._changeHeight}\n                    />\n                </div>\n                <div>\n                    Flip pattern:\n                    <select\n                        value={this.props.flipPattern}\n                        onChange={this._handlePatternChange}\n                    >\n                        {_.map(_.keys(PATTERNS), (pattern, i) => {\n                            return (\n                                <option value={pattern} key={i}>\n                                    {pattern}\n                                </option>\n                            );\n                        })}\n                    </select>\n                </div>\n                <div>\n                    Grade incomplete puzzles as wrong:{\" \"}\n                    <PropCheckBox\n                        gradeIncompleteAsWrong={\n                            this.props.gradeIncompleteAsWrong\n                        }\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        By default, incomplete puzzles are graded as empty.\n                    </InfoTip>\n                </div>\n                <div>Starting configuration:</div>\n                <div style={{overflowX: \"auto\"}}>\n                    <TileGrid\n                        cells={this.props.startCells}\n                        size={50}\n                        onChange={this._switchTile}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    _handlePatternChange: function(e) {\n        this.change(\"flipPattern\", e.target.value);\n    },\n\n    _changeWidth: function(newWidth) {\n        newWidth = clampToInt(newWidth, 1, MAX_SIZE);\n        this._truncateCells(newWidth, this._height());\n    },\n\n    _changeHeight: function(newHeight) {\n        newHeight = clampToInt(newHeight, 1, MAX_SIZE);\n        this._truncateCells(this._width(), newHeight);\n    },\n\n    _truncateCells: function(newWidth, newHeight) {\n        var newCells = _.times(newHeight, y => {\n            return _.times(newWidth, x => {\n                // explicitly cast the result to a boolean with !!\n                return !!(\n                    this.props.startCells[y] && this.props.startCells[y][x]\n                );\n            });\n        });\n\n        this.change({startCells: newCells});\n    },\n\n    _switchTile: function(tileY, tileX) {\n        var newCells = flipTilesPredicate(this.props.startCells, (y, x) => {\n            return y === tileY && x === tileX;\n        });\n\n        this.change({startCells: newCells});\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = LightsPuzzleEditor;\nexport default _module_.exports;\n","import _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable array-bracket-spacing, comma-dangle, no-undef, no-unused-vars, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\n\nvar MAX_SIZE = 8;\n\n// Styling\nvar CELL_PADDING = 5;\n\nvar TABLE_STYLE = {\n    display: \"table\",\n    tableLayout: \"fixed\",\n};\n\nvar ROW_STYLE = {\n    display: \"table-row\",\n};\n\nvar CELL_STYLE = {\n    display: \"table-cell\",\n    padding: CELL_PADDING,\n};\n\nvar BASE_TILE_STYLE = {\n    borderRadius: 10,\n    cursor: \"pointer\",\n};\n\nvar MOVE_COUNT_STYLE = {\n    padding: CELL_PADDING,\n    display: \"inline-block\",\n};\n\nvar RESET_BUTTON_STYLE = {\n    float: \"right\",\n    paddingRight: CELL_PADDING,\n};\n\nvar MAIN_TILE_SIZE = 50;\n\nvar mapCells = (cells, func) => {\n    return _.map(cells, (row, y) => {\n        return _.map(row, (value, x) => {\n            return func(value, y, x);\n        });\n    });\n};\n\nvar genCells = (height, width, func) => {\n    return _.times(height, y => {\n        return _.times(width, x => {\n            return func(y, x);\n        });\n    });\n};\n\nvar PATTERNS = {\n    plus: () => [\n        [false, true, false],\n        [true, true, true],\n        [false, true, false],\n    ],\n    x: () => [[true, false, true], [false, true, false], [true, false, true]],\n    \"plus/x\": iter => {\n        return iter % 2 ? PATTERNS.x() : PATTERNS.plus();\n    },\n};\n\n/**\n * Clamps value to an integer in the range [min, max]\n */\nvar clampToInt = function(value, min, max) {\n    value = Math.floor(value);\n    value = Math.max(value, min);\n    value = Math.min(value, max);\n    return value;\n};\n\n// A single glowy cell\nvar Tile = createReactClass({\n    propTypes: {\n        value: PropTypes.bool.isRequired,\n        size: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        var color = this.props.value ? \"#55dd55\" : \"#115511\";\n        var style = _.extend({}, BASE_TILE_STYLE, {\n            width: this.props.size,\n            height: this.props.size,\n            backgroundColor: color,\n        });\n        return <div style={style} onClick={this._flip} />;\n    },\n\n    _flip: function() {\n        this.props.onChange(!this.props.value);\n    },\n});\n\n// A grid of glowy cells\nvar TileGrid = createReactClass({\n    propTypes: {\n        cells: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.bool)\n        ).isRequired,\n        size: PropTypes.number.isRequired,\n    },\n\n    render: function() {\n        return (\n            <div style={TABLE_STYLE} className=\"no-select\">\n                {_.map(this.props.cells, (row, y) => {\n                    return (\n                        <div key={y} style={ROW_STYLE}>\n                            {_.map(row, (cell, x) => {\n                                return (\n                                    <div key={x} style={CELL_STYLE}>\n                                        <Tile\n                                            value={cell}\n                                            size={this.props.size}\n                                            onChange={_.partial(\n                                                this.props.onChange,\n                                                y,\n                                                x\n                                            )}\n                                        />\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    );\n                })}\n            </div>\n        );\n    },\n});\n\n// Returns a copy of the tiles, with tiles flipped according to\n// whether or not their y, x position satisfies the predicate\nvar flipTilesPredicate = (oldCells, predicate) => {\n    return _.map(oldCells, (row, y) => {\n        return _.map(row, (cell, x) => {\n            return predicate(y, x) ? !cell : cell;\n        });\n    });\n};\n\nvar flipTilesPattern = (oldCells, tileY, tileX, pattern) => {\n    return flipTilesPredicate(oldCells, (y, x) => {\n        var offsetY = y - tileY;\n        var offsetX = x - tileX;\n        if (Math.abs(offsetY) <= 1 && Math.abs(offsetX) <= 1) {\n            return pattern[offsetY + 1][offsetX + 1];\n        } else {\n            return false;\n        }\n    });\n};\n\n// The lights puzzle widget\nvar LightsPuzzle = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        cells: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.bool)\n        ),\n        startCells: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.bool)\n        ),\n        flipPattern: PropTypes.string.isRequired,\n        moveCount: PropTypes.number.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            cells: [\n                [false, false, false],\n                [false, false, false],\n                [false, false, false],\n            ],\n            startCells: [\n                [false, false, false],\n                [false, false, false],\n                [false, false, false],\n            ],\n            flipPattern: \"plus\",\n            moveCount: 0,\n        };\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    render: function() {\n        var width = this._width();\n        var tileSize = MAIN_TILE_SIZE;\n        var pxWidth = width * (tileSize + 2 * CELL_PADDING);\n        return (\n            <div>\n                <TileGrid\n                    cells={this.props.cells}\n                    size={tileSize}\n                    onChange={this._flipTile}\n                />\n                <div style={{width: pxWidth}}>\n                    <div style={MOVE_COUNT_STYLE}>\n                        Moves: {this.props.moveCount}\n                    </div>\n                    <div style={RESET_BUTTON_STYLE}>\n                        <input\n                            type=\"button\"\n                            value=\"Reset\"\n                            onClick={this._reset}\n                            className=\"simple-button\"\n                        />\n                    </div>\n                </div>\n                <div className=\"clearfix\" />\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    _width: function() {\n        if (this.props.cells.length !== 0) {\n            return this.props.cells[0].length;\n        } else {\n            return 0; // default to 0\n        }\n    },\n\n    componentDidMount: function() {\n        this._initNextPatterns();\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (prevProps.flipPattern !== this.props.flipPattern) {\n            this._initNextPatterns();\n        }\n    },\n\n    _initNextPatterns: function() {\n        this._currPattern = PATTERNS[this.props.flipPattern](0);\n        this._nextPattern = PATTERNS[this.props.flipPattern](1);\n        this._patternIndex = 2;\n    },\n\n    _shiftPatterns: function() {\n        this._currPattern = this._nextPattern;\n        this._nextPattern = PATTERNS[this.props.flipPattern](\n            this._patternIndex\n        );\n        this._patternIndex++;\n    },\n\n    _flipTile: function(tileY, tileX) {\n        var newCells = flipTilesPattern(\n            this.props.cells,\n            tileY,\n            tileX,\n            this._currPattern\n        );\n        this._shiftPatterns();\n\n        this.change({\n            cells: newCells,\n            moveCount: this.props.moveCount + 1,\n        });\n    },\n\n    _reset: function() {\n        this.change({\n            cells: this.props.startCells,\n            moveCount: 0,\n        });\n    },\n\n    simpleValidate: function(rubric) {\n        return validate(rubric, this.getUserInput());\n    },\n});\n\n// grading function\nvar validate = function(rubric, state) {\n    var empty = _.all(state.cells, (row, y) => {\n        return _.all(row, (cell, x) => {\n            return cell === rubric.startCells[y][x];\n        });\n    });\n    if (empty) {\n        return {\n            type: \"invalid\",\n            message: i18n._(\"Click on the tiles to change the lights.\"),\n        };\n    }\n\n    var correct = _.all(state.cells, row => {\n        return _.all(row, cell => {\n            return cell;\n        });\n    });\n\n    if (correct) {\n        return {\n            type: \"points\",\n            earned: 1,\n            total: 1,\n            message: null,\n        };\n    } else if (rubric.gradeIncompleteAsWrong) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 1,\n            message: null,\n        };\n    } else {\n        return {\n            type: \"invalid\",\n            message: i18n._(\"You must turn on all of the lights to continue.\"),\n        };\n    }\n};\n\n// The function run on the editor props to create the widget props\nvar transformProps = function(editorProps) {\n    return {\n        cells: editorProps.startCells,\n        startCells: editorProps.startCells,\n        flipPattern: editorProps.flipPattern,\n    };\n};\n\n_module_.exports = {\n    name: \"lights-puzzle\",\n    displayName: \"Lights Puzzle\",\n    hidden: true,\n    widget: LightsPuzzle,\n    transform: transformProps,\n};\nexport default _module_.exports;\n","import _interactive2WrappedLineJs from \"../interactive2/wrapped-line.js\";\nimport { containerSizeClassPropType, getInteractiveBoxFromSizeClass } from \"../util/sizing-utils.js\";\nimport { interactiveSizes } from \"../styles/constants.js\";\nimport _utilGraphUtilsJs from \"../util/graph-utils.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _utilJs from \"../util.js\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _interactive2Js from \"../interactive2.js\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _componentsGraphJsx from \"../components/graph.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, indent, max-lines, no-redeclare, no-undef, no-unused-vars, no-var, object-curly-spacing, one-var, prefer-spread, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Graph = _componentsGraphJsx;\nvar InfoTip = _componentsInfoTipJsx;\nvar Interactive2 = _interactive2Js;\nvar NumberInput = _componentsNumberInputJsx;\nvar Util = _utilJs;\n\nvar knumber = _kmath.number;\nvar kpoint = _kmath2.point;\nconst KhanColors = _utilColorsJs;\nconst GraphUtils = _utilGraphUtilsJs;\nconst WrappedLine = _interactive2WrappedLineJs;\n\nvar DeprecationMixin = Util.DeprecationMixin;\n\nvar TRASH_ICON_URI =\n    \"https://ka-perseus-graphie.s3.amazonaws.com/b1452c0d79fd0f7ff4c3af9488474a0a0decb361.png\";\n\nvar defaultBackgroundImage = {\n    url: null,\n};\n\nvar eq = Util.eq;\nvar deepEq = Util.deepEq;\n\nvar UNLIMITED = \"unlimited\";\n\n// Sample background image:\n// https://ka-perseus-graphie.s3.amazonaws.com/29c1b0fcd17fe63df0f148fe357044d5d5c7d0bb.png\n\nfunction ccw(a, b, c) {\n    return (b[0] - a[0]) * (c[1] - a[1]) - (c[0] - a[0]) * (b[1] - a[1]);\n}\n\nfunction collinear(a, b, c) {\n    return eq(ccw(a, b, c), 0);\n}\n\nfunction sign(val) {\n    if (eq(val, 0)) {\n        return 0;\n    } else {\n        return val > 0 ? 1 : -1;\n    }\n}\n\n// default to defaultValue if actual is null or undefined\nfunction defaultVal(actual, defaultValue) {\n    return actual == null ? defaultValue : actual;\n}\n\n// Given rect bounding points A and B, whether point C is inside the rect\nfunction pointInRect(a, b, c) {\n    return (\n        c[0] <= Math.max(a[0], b[0]) &&\n        c[0] >= Math.min(a[0], b[0]) &&\n        c[1] <= Math.max(a[1], b[1]) &&\n        c[1] >= Math.min(a[1], b[1])\n    );\n}\n\n// Whether line segment AB intersects line segment CD\n// http://www.geeksforgeeks.org/check-if-two-given-line-segments-intersect/\nfunction intersects(ab, cd) {\n    var triplets = [\n        [ab[0], ab[1], cd[0]],\n        [ab[0], ab[1], cd[1]],\n        [cd[0], cd[1], ab[0]],\n        [cd[0], cd[1], ab[1]],\n    ];\n\n    var orientations = _.map(triplets, function(triplet) {\n        return sign(ccw.apply(null, triplet));\n    });\n\n    if (\n        orientations[0] !== orientations[1] &&\n        orientations[2] !== orientations[3]\n    ) {\n        return true;\n    }\n\n    for (var i = 0; i < 4; i++) {\n        if (orientations[i] === 0 && pointInRect.apply(null, triplets[i])) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction vector(a, b) {\n    return _.map(_.zip(a, b), function(pair) {\n        return pair[0] - pair[1];\n    });\n}\n\nfunction magnitude(v) {\n    return Math.sqrt(\n        _.reduce(\n            v,\n            function(memo, el) {\n                return memo + Math.pow(el, 2);\n            },\n            0\n        )\n    );\n}\n\nfunction dotProduct(a, b) {\n    return _.reduce(\n        _.zip(a, b),\n        function(memo, pair) {\n            return memo + pair[0] * pair[1];\n        },\n        0\n    );\n}\n\nfunction sideLengths(coords) {\n    var segments = _.zip(coords, rotate(coords));\n    return _.map(segments, function(segment) {\n        return magnitude(vector.apply(null, segment));\n    });\n}\n\n// Based on http://math.stackexchange.com/a/151149\nfunction angleMeasures(coords) {\n    var triplets = _.zip(rotate(coords, -1), coords, rotate(coords, 1));\n\n    var offsets = _.map(triplets, function(triplet) {\n        var p = vector(triplet[1], triplet[0]);\n        var q = vector(triplet[2], triplet[1]);\n        var raw = Math.acos(dotProduct(p, q) / (magnitude(p) * magnitude(q)));\n        return sign(ccw.apply(null, triplet)) > 0 ? raw : -raw;\n    });\n\n    var sum = _.reduce(\n        offsets,\n        function(memo, arg) {\n            return memo + arg;\n        },\n        0\n    );\n\n    return _.map(offsets, function(offset) {\n        return sum > 0 ? Math.PI - offset : Math.PI + offset;\n    });\n}\n\n// Whether two polygons are similar (or if specified, congruent)\nfunction similar(coords1, coords2, tolerance) {\n    if (coords1.length !== coords2.length) {\n        return false;\n    }\n\n    var n = coords1.length;\n\n    var angles1 = angleMeasures(coords1);\n    var angles2 = angleMeasures(coords2);\n\n    var sides1 = sideLengths(coords1);\n    var sides2 = sideLengths(coords2);\n\n    for (var i = 0; i < 2 * n; i++) {\n        var angles = angles2.slice();\n        var sides = sides2.slice();\n\n        // Reverse angles and sides to allow matching reflected polygons\n        if (i >= n) {\n            angles.reverse();\n            sides.reverse();\n            // Since sides are calculated from two coordinates,\n            // simply reversing results in an off by one error\n            sides = rotate(sides, 1);\n        }\n\n        angles = rotate(angles, i);\n        sides = rotate(sides, i);\n\n        if (deepEq(angles1, angles)) {\n            var sidePairs = _.zip(sides1, sides);\n\n            var factors = _.map(sidePairs, function(pair) {\n                return pair[0] / pair[1];\n            });\n\n            var same = _.all(factors, function(factor) {\n                return eq(factors[0], factor);\n            });\n\n            var congruentEnough = _.all(sidePairs, function(pair) {\n                return knumber.equal(pair[0], pair[1], tolerance);\n            });\n\n            if (same && congruentEnough) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\n// Less than or approximately equal\nfunction leq(a, b) {\n    return a < b || eq(a, b);\n}\n\n// Given triangle with sides ABC return angle opposite side C in degrees\nfunction lawOfCosines(a, b, c) {\n    return Math.acos((a * a + b * b - c * c) / (2 * a * b)) * 180 / Math.PI;\n}\n\nfunction canonicalSineCoefficients(coeffs) {\n    // For a curve of the form f(x) = a * Sin(b * x - c) + d,\n    // this function ensures that a, b > 0, and c is its\n    // smallest possible positive value.\n    var amplitude = coeffs[0];\n    var angularFrequency = coeffs[1];\n    var phase = coeffs[2];\n    var verticalOffset = coeffs[3];\n\n    // Guarantee a > 0\n    if (amplitude < 0) {\n        amplitude *= -1;\n        angularFrequency *= -1;\n        phase *= -1;\n    }\n\n    var period = 2 * Math.PI;\n    // Guarantee b > 0\n    if (angularFrequency < 0) {\n        angularFrequency *= -1;\n        phase *= -1;\n        phase += period / 2;\n    }\n\n    // Guarantee c is smallest possible positive value\n    while (phase > 0) {\n        phase -= period;\n    }\n    while (phase < 0) {\n        phase += period;\n    }\n\n    return [amplitude, angularFrequency, phase, verticalOffset];\n}\n\n// e.g. rotate([1, 2, 3]) -> [2, 3, 1]\nfunction rotate(array, n) {\n    n = typeof n === \"undefined\" ? 1 : n % array.length;\n    return array.slice(n).concat(array.slice(0, n));\n}\n\nfunction capitalize(str) {\n    return str.replace(/(?:^|-)(.)/g, function(match, letter) {\n        return letter.toUpperCase();\n    });\n}\n\nfunction getLineEquation(first, second) {\n    if (eq(first[0], second[0])) {\n        return \"x = \" + first[0].toFixed(3);\n    } else {\n        var m = (second[1] - first[1]) / (second[0] - first[0]);\n        var b = first[1] - m * first[0];\n        return \"y = \" + m.toFixed(3) + \"x + \" + b.toFixed(3);\n    }\n}\n\n// Stolen from the wikipedia article\n// http://en.wikipedia.org/wiki/Line-line_intersection\nfunction getLineIntersection(firstPoints, secondPoints) {\n    var x1 = firstPoints[0][0],\n        y1 = firstPoints[0][1],\n        x2 = firstPoints[1][0],\n        y2 = firstPoints[1][1],\n        x3 = secondPoints[0][0],\n        y3 = secondPoints[0][1],\n        x4 = secondPoints[1][0],\n        y4 = secondPoints[1][1];\n\n    var determinant = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n    if (Math.abs(determinant) < 1e-9) {\n        return \"Lines are parallel\";\n    } else {\n        var x =\n            ((x1 * y2 - y1 * x2) * (x3 - x4) -\n                (x1 - x2) * (x3 * y4 - y3 * x4)) /\n            determinant;\n        var y =\n            ((x1 * y2 - y1 * x2) * (y3 - y4) -\n                (y1 - y2) * (x3 * y4 - y3 * x4)) /\n            determinant;\n        return \"Intersection: (\" + x.toFixed(3) + \", \" + y.toFixed(3) + \")\";\n    }\n}\n\nfunction numSteps(range, step) {\n    return Math.floor((range[1] - range[0]) / step);\n}\n\nvar deprecatedProps = {\n    showGraph: function(props) {\n        return {markings: props.showGraph ? \"graph\" : \"none\"};\n    },\n};\n\nvar InteractiveGraph = createReactClass({\n    propTypes: {\n        containerSizeClass: containerSizeClassPropType.isRequired,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getInitialState: function() {\n        return {\n            shouldShowInstructions: this._getShouldShowInstructions(),\n        };\n    },\n\n    getDefaultProps: function() {\n        return {\n            labels: [\"x\", \"y\"],\n            range: [[-10, 10], [-10, 10]],\n            step: [1, 1],\n            backgroundImage: defaultBackgroundImage,\n            markings: \"graph\",\n            showTooltips: false,\n            showProtractor: false,\n            showRuler: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n            graph: {\n                type: \"linear\",\n            },\n        };\n    },\n\n    deprecatedProps: deprecatedProps,\n\n    componentWillMount() {\n        DeprecationMixin.componentWillMount.call(this);\n    },\n\n    _getShouldShowInstructions: function(props) {\n        props = props || this.props;\n        return (\n            this.isClickToAddPoints(props) &&\n            (props.graph.coords == null || props.graph.coords.length === 0)\n        );\n    },\n\n    componentDidUpdate: function(prevProps, prevState) {\n        var oldType = prevProps.graph.type;\n        var newType = this.props.graph.type;\n        if (\n            oldType !== newType ||\n            prevProps.graph.allowReflexAngles !==\n                this.props.graph.allowReflexAngles ||\n            prevProps.graph.angleOffsetDeg !==\n                this.props.graph.angleOffsetDeg ||\n            prevProps.graph.numPoints !== this.props.graph.numPoints ||\n            prevProps.graph.numSides !== this.props.graph.numSides ||\n            prevProps.graph.numSegments !== this.props.graph.numSegments ||\n            prevProps.graph.showAngles !== this.props.graph.showAngles ||\n            prevProps.graph.showSides !== this.props.graph.showSides ||\n            prevProps.graph.snapTo !== this.props.graph.snapTo ||\n            prevProps.graph.snapDegrees !== this.props.graph.snapDegrees\n        ) {\n            this[\"remove\" + capitalize(oldType) + \"Controls\"]();\n            this[\"add\" + capitalize(newType) + \"Controls\"]();\n        }\n        if (this.shouldResetGraphie) {\n            this.resetGraphie();\n        }\n    },\n\n    render: function() {\n        var typeSelect;\n        var extraOptions;\n        if (this.props.flexibleType) {\n            typeSelect = (\n                <select\n                    value={this.props.graph.type}\n                    onChange={e => {\n                        var type = e.target.value;\n                        this.onChange({\n                            graph: {type: type},\n                        });\n                    }}\n                >\n                    <option value=\"linear\">Linear function</option>\n                    <option value=\"quadratic\">Quadratic function</option>\n                    <option value=\"sinusoid\">Sinusoid function</option>\n                    <option value=\"circle\">Circle</option>\n                    <option value=\"point\">Point(s)</option>\n                    <option value=\"linear-system\">Linear System</option>\n                    <option value=\"polygon\">Polygon</option>\n                    <option value=\"segment\">Line Segment(s)</option>\n                    <option value=\"ray\">Ray</option>\n                    <option value=\"angle\">Angle</option>\n                </select>\n            );\n\n            if (this.props.graph.type === \"point\") {\n                extraOptions = (\n                    <select\n                        key=\"point-select\"\n                        value={this.props.graph.numPoints || 1}\n                        onChange={e => {\n                            // Convert numbers, leave UNLIMITED intact:\n                            var num = +e.target.value || e.target.value;\n                            this.onChange({\n                                graph: {\n                                    type: \"point\",\n                                    numPoints: num,\n                                    coords: null,\n                                },\n                            });\n                        }}\n                    >\n                        {_.map(_.range(1, 7), function(n) {\n                            return (\n                                <option value={n}>\n                                    {n} point{n > 1 && \"s\"}\n                                </option>\n                            );\n                        })}\n                        <option value={UNLIMITED}>unlimited</option>\n                    </select>\n                );\n            } else if (this.props.graph.type === \"polygon\") {\n                extraOptions = (\n                    <div>\n                        <div>\n                            <select\n                                key=\"polygon-select\"\n                                value={this.props.graph.numSides || 3}\n                                onChange={e => {\n                                    // Convert numbers, leave UNLIMITED intact:\n                                    var num = +e.target.value || e.target.value;\n                                    var graph = _.extend({}, this.props.graph, {\n                                        numSides: num,\n                                        coords: null,\n                                        snapTo: \"grid\", // reset the snap for\n                                        // UNLIMITED, which only\n                                        // supports \"grid\"\n                                    });\n                                    this.onChange({graph: graph});\n                                }}\n                            >\n                                {_.map(_.range(3, 13), function(n) {\n                                    return (\n                                        <option value={n}>\n                                            {n} sides\n                                        </option>\n                                    );\n                                })}\n                                <option value={UNLIMITED}>\n                                    unlimited sides\n                                </option>\n                            </select>\n                        </div>\n                        <div>\n                            <label>\n                                {\" \"}Snap to{\" \"}\n                                <select\n                                    key=\"polygon-snap\"\n                                    value={this.props.graph.snapTo}\n                                    onChange={e => {\n                                        var graph = _.extend(\n                                            {},\n                                            this.props.graph,\n                                            {\n                                                snapTo: e.target.value,\n                                                coords: null,\n                                            }\n                                        );\n                                        this.onChange({graph: graph});\n                                    }}\n                                >\n                                    <option value=\"grid\">grid</option>\n                                    {this.props.graph.numSides !==\n                                        UNLIMITED && [\n                                        <option value=\"angles\">\n                                            {\" \"}interior angles{\" \"}\n                                        </option>,\n                                        <option value=\"sides\">\n                                            {\" \"}side measures{\" \"}\n                                        </option>,\n                                    ]}\n                                </select>\n                            </label>\n                            <InfoTip>\n                                <p>\n                                    These options affect the movement of the\n                                    vertex points. The grid option will guide\n                                    the points to the nearest half step along\n                                    the grid.\n                                </p>\n                                <p>\n                                    The interior angle and side measure options\n                                    guide the points to the nearest whole angle\n                                    or side\n                                </p>{\" \"}\n                                measure respectively.{\" \"}\n                            </InfoTip>\n                        </div>\n                        <div>\n                            <label>\n                                Show angle measures:{\" \"}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={this.props.graph.showAngles}\n                                    onChange={this.toggleShowAngles}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>Displays the interior angle measures.</p>\n                            </InfoTip>\n                        </div>\n                        <div>\n                            <label>\n                                Show side measures:{\" \"}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={this.props.graph.showSides}\n                                    onChange={this.toggleShowSides}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>Displays the side lengths.</p>\n                            </InfoTip>\n                        </div>\n                    </div>\n                );\n            } else if (this.props.graph.type === \"segment\") {\n                extraOptions = (\n                    <select\n                        key=\"segment-select\"\n                        value={this.props.graph.numSegments || 1}\n                        onChange={e => {\n                            var num = +e.target.value;\n                            this.onChange({\n                                graph: {\n                                    type: \"segment\",\n                                    numSegments: num,\n                                    coords: null,\n                                },\n                            });\n                        }}\n                    >\n                        {_.map(_.range(1, 7), function(n) {\n                            return (\n                                <option value={n}>\n                                    {n} segment{n > 1 && \"s\"}\n                                </option>\n                            );\n                        })}\n                    </select>\n                );\n            } else if (this.props.graph.type === \"angle\") {\n                var allowReflexAngles = defaultVal(\n                    this.props.graph.allowReflexAngles,\n                    true\n                );\n                extraOptions = (\n                    <div>\n                        <div>\n                            <label>\n                                Show angle measure:{\" \"}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={this.props.graph.showAngles}\n                                    onChange={this.toggleShowAngles}\n                                />\n                            </label>\n                        </div>\n                        <div>\n                            <label>\n                                Allow reflex angles:{\" \"}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={allowReflexAngles}\n                                    onChange={newVal => {\n                                        this.onChange({\n                                            graph: _.extend(\n                                                {},\n                                                this.props.graph,\n                                                {\n                                                    allowReflexAngles: !allowReflexAngles, // eslint-disable-line max-len\n                                                    coords: null,\n                                                }\n                                            ),\n                                        });\n                                    }}\n                                />\n                            </label>\n                            <InfoTip>\n                                <p>\n                                    Reflex angles are angles with a measure\n                                    greater than 180 degrees.\n                                </p>\n                                <p>By default, these should remain enabled.</p>\n                            </InfoTip>\n                        </div>\n                        <div>\n                            <label>\n                                Snap to increments of{\" \"}\n                                <NumberInput\n                                    key=\"degree-snap\"\n                                    placeholder={1}\n                                    value={this.props.graph.snapDegrees}\n                                    onChange={newVal => {\n                                        this.onChange({\n                                            graph: _.extend(\n                                                {},\n                                                this.props.graph,\n                                                {\n                                                    snapDegrees: Math.abs(\n                                                        newVal\n                                                    ),\n                                                    coords: null,\n                                                }\n                                            ),\n                                        });\n                                    }}\n                                />{\" \"}\n                                degrees{\" \"}\n                            </label>\n                        </div>\n                        <div>\n                            <label>\n                                {\" \"}With an offset of{\" \"}\n                                <NumberInput\n                                    key=\"angle-offset\"\n                                    placeholder={0}\n                                    value={this.props.graph.angleOffsetDeg}\n                                    onChange={newVal => {\n                                        this.onChange({\n                                            graph: _.extend(\n                                                {},\n                                                this.props.graph,\n                                                {\n                                                    angleOffsetDeg: newVal,\n                                                    coords: null,\n                                                }\n                                            ),\n                                        });\n                                    }}\n                                />{\" \"}\n                                degrees{\" \"}\n                            </label>\n                        </div>\n                    </div>\n                );\n            }\n        }\n\n        const box = getInteractiveBoxFromSizeClass(\n            this.props.containerSizeClass\n        );\n\n        var instructions;\n        if (this.isClickToAddPoints() && this.state.shouldShowInstructions) {\n            if (this.props.graph.type === \"point\") {\n                instructions = i18n._(\"Click to add points\");\n            } else if (this.props.graph.type === \"polygon\") {\n                instructions = i18n._(\"Click to add vertices\");\n            }\n        } else {\n            instructions = undefined;\n        }\n\n        var onMouseDown = this.isClickToAddPoints()\n            ? this.handleAddPointsMouseDown\n            : null;\n\n        var gridStep =\n            this.props.gridStep ||\n            Util.getGridStep(this.props.range, this.props.step, box[0]);\n        var snapStep =\n            this.props.snapStep || Util.snapStepFromGridStep(gridStep);\n\n        const isMobile = this.props.apiOptions.isMobile;\n        return (\n            <div\n                className={\n                    \"perseus-widget \" + \"perseus-widget-interactive-graph\"\n                }\n                style={{\n                    width: box[0],\n                    height: this.props.flexibleType ? \"auto\" : box[1],\n                }}\n            >\n                <Graph\n                    instructions={instructions}\n                    ref=\"graph\"\n                    box={box}\n                    labels={this.props.labels}\n                    range={this.props.range}\n                    step={\n                        isMobile\n                            ? Util.constrainedTickStepsFromTickSteps(\n                                  this.props.step,\n                                  this.props.range\n                              )\n                            : this.props.step\n                    }\n                    gridStep={gridStep}\n                    snapStep={snapStep}\n                    markings={this.props.markings}\n                    backgroundImage={this.props.backgroundImage}\n                    showProtractor={this.props.showProtractor}\n                    showRuler={this.props.showRuler}\n                    rulerLabel={this.props.rulerLabel}\n                    rulerTicks={this.props.rulerTicks}\n                    onMouseDown={onMouseDown}\n                    onGraphieUpdated={this.setGraphie}\n                    setDrawingAreaAvailable={\n                        this.props.apiOptions.setDrawingAreaAvailable\n                    }\n                    isMobile={isMobile}\n                />\n                {typeSelect}\n                {extraOptions}\n            </div>\n        );\n    },\n\n    componentDidMount: function() {\n        this.setGraphie(this.refs.graph.graphie());\n    },\n\n    setGraphie: function(newGraphie) {\n        this.graphie = newGraphie;\n        this.setupGraphie();\n    },\n\n    handleAddPointsMouseDown: function(coord) {\n        // This function should only be called when this.isClickToAddPoints()\n        // is true\n        if (!this.isClickToAddPoints()) {\n            throw new Error(\n                \"handleAddPointsClick should not be registered\" +\n                    \"when isClickToAddPoints() is false\"\n            );\n        }\n        if (!this.isCoordInTrash(coord)) {\n            var point;\n            if (this.props.graph.type === \"point\") {\n                point = this.createPointForPointsType(\n                    coord,\n                    this.points.length\n                );\n                if (!point.constrain()) {\n                    point.remove();\n                    return;\n                }\n                this.points.push(point);\n\n                // interactive2 allows us to grab the point\n                var idx = this.points.length - 1;\n                this.points[idx].grab(coord);\n\n                this.updateCoordsFromPoints();\n            } else if (this.props.graph.type === \"polygon\") {\n                if (this.polygon.closed()) {\n                    return;\n                }\n                point = this.createPointForPolygonType(\n                    coord,\n                    this.points.length\n                );\n                this.points.push(point);\n\n                var idx = this.points.length - 1;\n                this.points[idx].grab(coord);\n\n                // We don't call updateCoordsFromPoints for\n                // polygons, since the polygon won't be\n                // closed yet.\n                this.updatePolygon();\n            }\n\n            this.setState({\n                shouldShowInstructions: false,\n            });\n        }\n    },\n\n    resetGraphie: function() {\n        this.shouldResetGraphie = false;\n        this.parabola = null;\n        this.sinusoid = null;\n        this.refs.graph.reset();\n    },\n\n    setupGraphie: function() {\n        this.setTrashCanVisibility(0);\n        if (this.isClickToAddPoints()) {\n            this.setTrashCanVisibility(0.5);\n        }\n\n        if (this.props.apiOptions.isMobile) {\n            this.horizHairline = new WrappedLine(this.graphie, [0, 0], [0, 0], {\n                normalStyle: {\n                    strokeWidth: 1,\n                },\n            });\n            this.horizHairline.attr({\n                stroke: KhanColors.INTERACTIVE,\n            });\n            this.horizHairline.hide();\n\n            this.vertHairline = new WrappedLine(this.graphie, [0, 0], [0, 0], {\n                normalStyle: {\n                    strokeWidth: 1,\n                },\n            });\n            this.vertHairline.attr({\n                stroke: KhanColors.INTERACTIVE,\n            });\n            this.vertHairline.hide();\n        }\n\n        var type = this.props.graph.type;\n        this[\"add\" + capitalize(type) + \"Controls\"]();\n    },\n\n    showHairlines: function(point) {\n        if (this.props.apiOptions.isMobile && this.props.markings !== \"none\") {\n            // Hairlines are already initialized when the graph is loaded, so\n            // here we just move them to the updated location and make them\n            // visible.\n            this.horizHairline.moveTo(\n                [this.props.range[0][0], point[1]],\n                [this.props.range[0][1], point[1]]\n            );\n\n            this.horizHairline.show();\n\n            this.vertHairline.moveTo(\n                [point[0], this.props.range[1][0]],\n                [point[0], this.props.range[1][1]]\n            );\n\n            this.vertHairline.show();\n        }\n    },\n\n    hideHairlines: function() {\n        if (this.props.apiOptions.isMobile) {\n            this.horizHairline.hide();\n            this.vertHairline.hide();\n        }\n    },\n\n    setTrashCanVisibility: function(opacity) {\n        var graphie = this.graphie;\n\n        if (knumber.equal(opacity, 0)) {\n            if (this.trashCan) {\n                this.trashCan.remove();\n                this.trashCan = null;\n            }\n        } else if (!this.props.apiOptions.isMobile) {\n            // Only if trash tooltips are not being used, we initialize the old\n            // trash can area.\n            if (!this.trashCan) {\n                this.trashCan = graphie.raphael.image(\n                    TRASH_ICON_URI,\n                    graphie.xpixels - 40,\n                    graphie.ypixels - 40,\n                    40,\n                    40\n                );\n            }\n            this.trashCan.attr({\n                opacity: opacity,\n            });\n        }\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        if (this.isClickToAddPoints() !== this.isClickToAddPoints(nextProps)) {\n            this.shouldResetGraphie = true;\n            this.setState({\n                shouldShowInstructions: this._getShouldShowInstructions(\n                    nextProps\n                ),\n            });\n        }\n\n        if (\n            this.props.backgroundImage.url !== nextProps.backgroundImage.url ||\n            this.props.backgroundImage !== nextProps.backgroundImage ||\n            this.props.containerSizeClass !== nextProps.containerSizeClass\n        ) {\n            // @Nolint\n            this.shouldResetGraphie = true;\n        }\n    },\n\n    isClickToAddPoints: function(props) {\n        props = props || this.props;\n        return (\n            (props.graph.type === \"point\" &&\n                props.graph.numPoints === UNLIMITED) ||\n            (props.graph.type === \"polygon\" &&\n                props.graph.numSides === UNLIMITED)\n        );\n    },\n\n    _lineStroke: function() {\n        return this.props.isMobile ? {\"stroke-width\": 3} : {};\n    },\n\n    addLine: function(type) {\n        var self = this;\n        var graphie = self.graphie;\n        var coords = InteractiveGraph.getLineCoords(\n            self.props.graph,\n            self.props\n        );\n\n        var points = (self.points = _.map(coords, coord => {\n            return Interactive2.addMaybeMobileMovablePoint(this, {\n                coord: coord,\n                constraints: [\n                    Interactive2.MovablePoint.constraints.bound(),\n                    Interactive2.MovablePoint.constraints.snap(),\n                ],\n                onMove: () => {\n                    var graph = _.extend({}, self.props.graph, {\n                        coords: _.invoke(points, \"coord\"),\n                    });\n                    self.onChange({graph: graph});\n                },\n            });\n        }));\n\n        var lineConfig = {\n            points: points,\n            static: true,\n            normalStyle: {\n                stroke: this.props.apiOptions.isMobile\n                    ? KhanColors.BLUE_C\n                    : KhanColors.INTERACTIVE,\n                ...this._lineStroke(),\n            },\n        };\n\n        if (type === \"line\") {\n            lineConfig.extendLine = true;\n        } else if (type === \"ray\") {\n            lineConfig.extendRay = true;\n        }\n\n        var line = (self.line = Interactive2.addMovableLine(\n            graphie,\n            lineConfig\n        ));\n\n        // A and B can't be in the same place\n        points[0].listen(\"constraints\", \"isLine\", coord => {\n            return !kpoint.equal(coord, points[1].coord());\n        });\n        points[1].listen(\"constraints\", \"isLine\", coord => {\n            return !kpoint.equal(coord, points[0].coord());\n        });\n    },\n\n    removeLine: function() {\n        _.invoke(this.points, \"remove\");\n        this.line.remove();\n    },\n\n    addLinearControls: function() {\n        this.addLine(\"line\");\n    },\n\n    removeLinearControls: function() {\n        this.removeLine();\n    },\n\n    addQuadraticControls: function() {\n        var graphie = this.graphie;\n        var coords = this.props.graph.coords;\n        if (!coords) {\n            coords = InteractiveGraph.defaultQuadraticCoords(this.props);\n        }\n\n        var pointA;\n        var pointB;\n        var pointC;\n        var onMoveHandler = () => {\n            var graph = _.extend({}, this.props.graph, {\n                coords: [pointA.coord(), pointB.coord(), pointC.coord()],\n            });\n            this.onChange({graph: graph});\n            this.updateQuadratic();\n        };\n\n        pointA = this.pointA = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coords[0],\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                coord => {\n                    return (\n                        !pointA ||\n                        (coord[0] !== pointB.coord()[0] &&\n                            coord[0] !== pointC.coord()[0])\n                    );\n                },\n            ],\n            onMove: onMoveHandler,\n        });\n\n        pointB = this.pointB = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coords[1],\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                coord => {\n                    return (\n                        !pointB ||\n                        (coord[0] !== pointA.coord()[0] &&\n                            coord[0] !== pointC.coord()[0])\n                    );\n                },\n            ],\n            onMove: onMoveHandler,\n        });\n\n        pointC = this.pointC = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coords[2],\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                coord => {\n                    return (\n                        !pointC ||\n                        (coord[0] !== pointA.coord()[0] &&\n                            coord[0] !== pointB.coord()[0])\n                    );\n                },\n            ],\n            onMove: onMoveHandler,\n        });\n\n        this.updateQuadratic();\n    },\n\n    updateQuadratic: function() {\n        var coeffs = InteractiveGraph.getCurrentQuadraticCoefficients(\n            this.props\n        );\n        if (!coeffs) {\n            return;\n        }\n\n        // Extract coefficients the parabola\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n\n        // Plot and style\n        if (this.parabola) {\n            var path = this.graphie.svgParabolaPath(a, b, c);\n            this.parabola.attr({path: path});\n        } else {\n            this.parabola = this.graphie.parabola(a, b, c);\n            this.parabola.attr({\n                stroke: this.props.apiOptions.isMobile\n                    ? KhanColors.BLUE_C\n                    : KhanColors.DYNAMIC,\n                ...this._lineStroke(),\n            });\n            this.parabola.toBack();\n        }\n    },\n\n    removeQuadraticControls: function() {\n        this.pointA.remove();\n        this.pointB.remove();\n        this.pointC.remove();\n        if (this.parabola) {\n            this.parabola.remove();\n            this.parabola = null;\n        }\n    },\n\n    addSinusoidControls: function() {\n        var graphie = this.graphie;\n        var coords = this.props.graph.coords;\n        if (!coords) {\n            coords = InteractiveGraph.defaultSinusoidCoords(this.props);\n        }\n\n        var pointA;\n        var pointB;\n        var onMoveHandler = () => {\n            var graph = _.extend({}, this.props.graph, {\n                coords: [pointA.coord(), pointB.coord()],\n            });\n            this.onChange({graph: graph});\n            this.updateSinusoid();\n        };\n\n        pointA = this.pointA = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coords[0],\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                coord => {\n                    return !pointA || coord[0] !== pointB.coord()[0];\n                },\n            ],\n            onMove: onMoveHandler,\n        });\n\n        pointB = this.pointB = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coords[1],\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                coord => {\n                    return !pointA || coord[0] !== pointA.coord()[0];\n                },\n            ],\n            onMove: onMoveHandler,\n        });\n\n        this.updateSinusoid();\n    },\n\n    updateSinusoid: function() {\n        var coeffs = InteractiveGraph.getCurrentSinusoidCoefficients(\n            this.props\n        );\n        if (!coeffs) {\n            return;\n        }\n\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2],\n            d = coeffs[3];\n\n        // Plot and style\n        if (this.sinusoid) {\n            var path = this.graphie.svgSinusoidPath(a, b, c, d);\n            this.sinusoid.attr({path: path});\n        } else {\n            this.sinusoid = this.graphie.sinusoid(a, b, c, d);\n            this.sinusoid.attr({\n                stroke: this.props.apiOptions.isMobile\n                    ? KhanColors.BLUE_C\n                    : KhanColors.DYNAMIC,\n                ...this._lineStroke(),\n            });\n            this.sinusoid.toBack();\n        }\n    },\n\n    removeSinusoidControls: function() {\n        this.pointA.remove();\n        this.pointB.remove();\n        if (this.sinusoid) {\n            this.sinusoid.remove();\n            this.sinusoid = null;\n        }\n    },\n\n    addCircleControls: function() {\n        var graphie = this.graphie;\n        var minSnap = _.min(graphie.snap);\n\n        var circle = (this.circle = graphie.addCircleGraph({\n            center: this.props.graph.center || [0, 0],\n            radius: this.props.graph.radius || _.min(this.props.step),\n            snapX: graphie.snap[0],\n            snapY: graphie.snap[1],\n            minRadius: minSnap,\n            snapRadius: minSnap,\n        }));\n\n        $(circle).on(\"move\", () => {\n            var graph = _.extend({}, this.props.graph, {\n                center: circle.center,\n                radius: circle.radius,\n            });\n            this.onChange({graph: graph});\n        });\n    },\n\n    removeCircleControls: function() {\n        this.circle.remove();\n    },\n\n    addLinearSystemControls: function() {\n        var graphie = this.graphie;\n        var coords = InteractiveGraph.getLinearSystemCoords(\n            this.props.graph,\n            this.props\n        );\n\n        var segmentColors = [KhanColors.INTERACTIVE, KhanColors.GREEN];\n        var points = (this.points = _.map(\n            coords,\n            (segmentCoords, segmentIndex) => {\n                var segmentPoints = _.map(segmentCoords, (coord, i) => {\n                    return Interactive2.addMaybeMobileMovablePoint(this, {\n                        coord: coord,\n                        constraints: [\n                            Interactive2.MovablePoint.constraints.bound(),\n                            Interactive2.MovablePoint.constraints.snap(),\n                            coord => {\n                                if (!segmentPoints) {\n                                    // points hasn't been defined yet because\n                                    // we're still creating them\n                                    return;\n                                }\n                                return !kpoint.equal(\n                                    coord,\n                                    segmentPoints[1 - i].coord()\n                                );\n                            },\n                        ],\n                        onMove: () => {\n                            var graph = _.extend({}, this.props.graph, {\n                                coords: _.map(this.points, segment => _.invoke(segment, \"coord\")\n                                ),\n                            });\n                            this.onChange({graph: graph});\n                        },\n                        normalStyle: {\n                            fill: segmentColors[segmentIndex],\n                        },\n                        highlightStyle: {\n                            fill: segmentColors[segmentIndex],\n                        },\n                    });\n                });\n                return segmentPoints;\n            }\n        ));\n\n        var lines = (this.lines = _.map(\n            points,\n            (segmentPoints, segmentIndex) => {\n                return Interactive2.addMovableLine(graphie, {\n                    points: segmentPoints,\n                    static: true,\n                    extendLine: true,\n                    normalStyle: {\n                        stroke: segmentColors[segmentIndex],\n                    },\n                });\n            }\n        ));\n    },\n\n    removeLinearSystemControls: function() {\n        _.invoke(this.lines, \"remove\");\n        _.map(this.points, segment => _.invoke(segment, \"remove\"));\n    },\n\n    isCoordInTrash: function(coord) {\n        if (this.props.apiOptions.isMobile) {\n            return false;\n        }\n\n        var graphie = this.graphie;\n        var screenPoint = graphie.scalePoint(coord);\n        return (\n            screenPoint[0] >= graphie.xpixels - 40 &&\n            screenPoint[1] >= graphie.ypixels - 40\n        );\n    },\n\n    createPointForPointsType: function(coord, i) {\n        var self = this;\n        var graphie = self.graphie;\n\n        const remove = () => {\n            self.points = _.filter(self.points, function(pt) {\n                return pt !== point;\n            });\n            // update the correct answer box\n            self.updateCoordsFromPoints();\n\n            // remove this movablePoint from graphie.\n            // we wait to do this until we're not inside of\n            // said point's onMoveEnd method so its state is\n            // consistent throughout this method call\n            setTimeout(point.remove.bind(point), 0);\n        };\n\n        var point = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coord,\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                Interactive2.MovablePoint.constraints.snap(),\n                function(coord) {\n                    // TODO(jack): There ought to be a\n                    // MovablePoint.constraints.avoid\n                    // default that lets you do things like this\n                    return _.all(self.points, function(pt) {\n                        return point === pt || !kpoint.equal(coord, pt.coord());\n                    });\n                },\n            ],\n            onMoveStart: function() {\n                if (self.isClickToAddPoints()) {\n                    self.setTrashCanVisibility(1);\n                }\n            },\n            onMove: self.updateCoordsFromPoints,\n            onMoveEnd: function(coord) {\n                if (self.isClickToAddPoints()) {\n                    if (self.isCoordInTrash(coord)) {\n                        remove();\n                    }\n                    // In case we mouseup'd off the graphie and that\n                    // stopped the move (in which case, we might not\n                    // be in isCoordInTrash()\n                    self.setTrashCanVisibility(0.5);\n                }\n            },\n            ...(this.props.apiOptions.isMobile && self.isClickToAddPoints()\n                ? {onRemove: remove}\n                : {}),\n        });\n\n        return point;\n    },\n\n    removePoint: function(point) {\n        var index = null;\n        this.points = _.filter(this.points, function(pt, i) {\n            if (pt === point) {\n                index = i;\n                return false;\n            } else {\n                return true;\n            }\n        });\n        return index;\n    },\n\n    createPointForPolygonType: function(coord, i) {\n        var graphie = this.graphie;\n\n        // TODO(alex): check against \"grid\" instead, use constants\n        var snapToGrid = !_.contains(\n            [\"angles\", \"sides\"],\n            this.props.graph.snapTo\n        );\n\n        // Index relative to current point -> absolute index\n        // NOTE: This does not work when isClickToAddPoints() == true,\n        // as `i` can be changed by dragging a point to the trash\n        // Currently this function is only called when !isClickToAddPoints()\n        var rel = j => {\n            return (i + j + this.points.length) % this.points.length;\n        };\n\n        const remove = () => {\n            // remove this point from points\n            var index = this.removePoint(point);\n            if (this.polygon.closed()) {\n                this.points = rotate(this.points, index);\n                this.polygon.update({closed: false});\n            }\n            this.updatePolygon();\n            // the polygon is now unclosed, so we need to\n            // remove any points props\n            this.clearCoords();\n\n            // remove this movablePoint from graphie.\n            // wait to do this until we're not inside of\n            // said point's onMoveEnd method so state is\n            // consistent throughout the method call\n            setTimeout(point.remove.bind(point), 0);\n        };\n\n        var onMoveEndHandler = coord => {\n            if (this.isClickToAddPoints()) {\n                if (this.isCoordInTrash(coord)) {\n                    remove();\n                } else if (\n                    this.points.length > 1 &&\n                    ((point === this.points[0] &&\n                        kpoint.equal(coord, _.last(this.points).coord())) ||\n                        (point === _.last(this.points) &&\n                            kpoint.equal(coord, this.points[0].coord())))\n                ) {\n                    // If the user clicked and dragged a point over endpoint,\n                    // join the them\n                    var pointToRemove = this.points.pop();\n                    if (this.points.length > 2) {\n                        this.polygon.update({closed: true});\n                        this.updateCoordsFromPoints();\n                    } else {\n                        this.polygon.update({closed: false});\n                        this.clearCoords();\n                    }\n                    this.updatePolygon();\n                    // remove this movablePoint from graphie.\n                    // wait to do this until we're not inside of\n                    // said point's onMoveEnd method so state is\n                    // consistent throughout the method call\n                    setTimeout(pointToRemove.remove.bind(pointToRemove), 0);\n                } else {\n                    // If the user clicked and dragged a point over any other\n                    // existing point, fix shape\n                    var shouldRemove = _.any(this.points, function(pt) {\n                        return pt !== point && kpoint.equal(pt.coord(), coord);\n                    });\n                    if (shouldRemove) {\n                        this.removePoint(point);\n\n                        if (this.points.length < 3) {\n                            this.polygon.update({closed: false});\n                            this.clearCoords();\n                        } else if (this.polygon.closed()) {\n                            this.updateCoordsFromPoints();\n                        }\n                        this.updatePolygon();\n                        // remove this movablePoint from graphie.\n                        // wait to do this until we're not inside\n                        // said point's onMoveEnd method so state\n                        // is consistent throughout the method call\n                        setTimeout(point.remove.bind(point), 0);\n                    } else {\n                        // If this was\n                        //  * not a deletion\n                        //  * and a click on the first or last point\n                        //  * and not a drag,\n                        //  * and not a creation of a new point\n                        //    (see !point.state.isInitialMove, below),\n                        //  * and our polygon is not closed,\n                        //  * and we can close it (we need at least 3 points),\n                        // then close it\n                        if (\n                            (point === this.points[0] ||\n                                point === _.last(this.points)) &&\n                            !point.hasMoved() &&\n                            !point.state.isInitialMove &&\n                            !this.polygon.closed() &&\n                            this.points.length > 2\n                        ) {\n                            this.polygon.update({closed: true});\n                            this.updatePolygon();\n\n                            // We finally have a closed polygon, so save our\n                            // points to props\n                            this.updateCoordsFromPoints();\n                        }\n                    }\n                }\n\n                // In case we mouseup'd off the graphie and that\n                // stopped the move\n                this.setTrashCanVisibility(0.5);\n            }\n\n            point.state.isInitialMove = false;\n        };\n\n        var graphConstraint = coord => {\n            // These constraints are all relative to the other points, so if\n            // we're creating the initial points and haven't added any others\n            // to the graph, we can't enforce them.\n            if (this.points == null || this.points.length === 0) {\n                return true;\n            }\n\n            var coords = _.invoke(this.points, \"coord\");\n            coords[i] = coord;\n\n            // Check for invalid positioning, but only if we aren't adding\n            // points one click at a time, since those added points could\n            // have already violated these constraints\n            if (!this.isClickToAddPoints()) {\n                // Polygons can't have consecutive collinear points\n                if (\n                    collinear(coords[rel(-2)], coords[rel(-1)], coords[i]) ||\n                    collinear(coords[rel(-1)], coords[i], coords[rel(1)]) ||\n                    collinear(coords[i], coords[rel(1)], coords[rel(2)])\n                ) {\n                    return false;\n                }\n\n                var segments = _.zip(coords, rotate(coords));\n\n                if (this.points.length > 3) {\n                    // Constrain to simple (non self-intersecting) polygon by\n                    // testing whether adjacent segments intersect any others\n                    for (var j = -1; j <= 0; j++) {\n                        var segment = segments[rel(j)];\n                        var others = _.without(\n                            segments,\n                            segment,\n                            segments[rel(j - 1)],\n                            segments[rel(j + 1)]\n                        );\n\n                        for (var k = 0; k < others.length; k++) {\n                            var other = others[k];\n                            if (intersects(segment, other)) {\n                                return false;\n                            }\n                        }\n                    }\n                }\n            }\n\n            if (\n                this.props.graph.snapTo === \"angles\" &&\n                this.points.length > 2\n            ) {\n                // Snap to whole degree interior angles\n\n                var angles = _.map(angleMeasures(coords), function(rad) {\n                    return rad * 180 / Math.PI;\n                });\n\n                _.each([-1, 1], function(j) {\n                    angles[rel(j)] = Math.round(angles[rel(j)]);\n                });\n\n                var getAngle = function(a, vertex, b) {\n                    var angle = GraphUtils.findAngle(\n                        coords[rel(a)],\n                        coords[rel(b)],\n                        coords[rel(vertex)]\n                    );\n                    return (angle + 360) % 360;\n                };\n\n                var innerAngles = [\n                    angles[rel(-1)] - getAngle(-2, -1, 1),\n                    angles[rel(1)] - getAngle(-1, 1, 2),\n                ];\n                innerAngles[2] = 180 - (innerAngles[0] + innerAngles[1]);\n\n                // Avoid degenerate triangles\n                if (\n                    _.any(innerAngles, function(angle) {\n                        return leq(angle, 1);\n                    })\n                ) {\n                    return false;\n                }\n\n                var knownSide = magnitude(\n                    vector(coords[rel(-1)], coords[rel(1)])\n                );\n\n                var onLeft =\n                    sign(ccw(coords[rel(-1)], coords[rel(1)], coords[i])) === 1;\n\n                // Solve for side by using the law of sines\n                var side =\n                    Math.sin(innerAngles[1] * Math.PI / 180) /\n                    Math.sin(innerAngles[2] * Math.PI / 180) *\n                    knownSide;\n\n                var outerAngle = GraphUtils.findAngle(\n                    coords[rel(1)],\n                    coords[rel(-1)]\n                );\n\n                var offset = this.graphie.polar(\n                    side,\n                    outerAngle + (onLeft ? 1 : -1) * innerAngles[0]\n                );\n\n                return this.graphie.addPoints(coords[rel(-1)], offset);\n            } else if (\n                this.props.graph.snapTo === \"sides\" &&\n                this.points.length > 1\n            ) {\n                // Snap to whole unit side measures\n\n                var sides = _.map(\n                    [\n                        [coords[rel(-1)], coords[i]],\n                        [coords[i], coords[rel(1)]],\n                        [coords[rel(-1)], coords[rel(1)]],\n                    ],\n                    function(coords) {\n                        return magnitude(vector.apply(null, coords));\n                    }\n                );\n\n                _.each([0, 1], function(j) {\n                    sides[j] = Math.round(sides[j]);\n                });\n\n                // Avoid degenerate triangles\n                if (\n                    leq(sides[1] + sides[2], sides[0]) ||\n                    leq(sides[0] + sides[2], sides[1]) ||\n                    leq(sides[0] + sides[1], sides[2])\n                ) {\n                    return false;\n                }\n\n                // Solve for angle by using the law of cosines\n                var innerAngle = lawOfCosines(sides[0], sides[2], sides[1]);\n\n                var outerAngle = GraphUtils.findAngle(\n                    coords[rel(1)],\n                    coords[rel(-1)]\n                );\n\n                var onLeft =\n                    sign(ccw(coords[rel(-1)], coords[rel(1)], coords[i])) === 1;\n\n                var offset = this.graphie.polar(\n                    sides[0],\n                    outerAngle + (onLeft ? 1 : -1) * innerAngle\n                );\n\n                return this.graphie.addPoints(coords[rel(-1)], offset);\n            } else {\n                // Snap to grid (already done)\n                return true;\n            }\n        };\n\n        var point = Interactive2.addMaybeMobileMovablePoint(this, {\n            coord: coord,\n            constraints: [\n                Interactive2.MovablePoint.constraints.bound(),\n                snapToGrid\n                    ? Interactive2.MovablePoint.constraints.snap()\n                    : null,\n                graphConstraint,\n            ],\n            onMoveStart: () => {\n                if (this.isClickToAddPoints()) {\n                    this.setTrashCanVisibility(1);\n                }\n            },\n            onMove: () => {\n                if (this.polygon.closed()) {\n                    this.updateCoordsFromPoints();\n                }\n            },\n            onMoveEnd: onMoveEndHandler,\n            ...(this.props.apiOptions.isMobile && this.isClickToAddPoints()\n                ? {onRemove: remove}\n                : {}),\n        });\n        point.state.isInitialMove = true;\n\n        return point;\n    },\n\n    updateCoordsFromPoints: function() {\n        var graph = _.extend({}, this.props.graph, {\n            // Handle old movable points with .coord, or\n            // Interactive2.MovablePoint's with .coord()\n            coords: _.map(this.points, function(point) {\n                return _.result(point, \"coord\");\n            }),\n        });\n        this.onChange({graph: graph});\n    },\n\n    clearCoords: function() {\n        var graph = _.extend({}, this.props.graph, {\n            coords: null,\n        });\n        this.onChange({graph: graph});\n    },\n\n    onChange: function(data) {\n        this.props.onChange(data);\n        this.props.trackInteraction();\n    },\n\n    addPointControls: function() {\n        var coords = InteractiveGraph.getPointCoords(\n            this.props.graph,\n            this.props\n        );\n        // Clear out our old points so that newly added points don't\n        // \"collide\" with them and reposition when being added\n        // Without this, when added, each point checks whether it is on top\n        // of a point in this.points, which (a) shouldn't matter since\n        // we're clearing out this.points anyways, and (b) can cause problems\n        // if each of this.points is a MovablePoint instead of an\n        // Interactive2.MovablePoint, since one has a .coord and the other\n        // has .coord()\n        // TODO(jack): Figure out a better way to do this\n        this.points = [];\n        this.points = _.map(coords, this.createPointForPointsType, this);\n    },\n\n    removePointControls: function() {\n        _.invoke(this.points, \"remove\");\n    },\n\n    addSegmentControls: function() {\n        var self = this;\n        var graphie = this.graphie;\n\n        var coords = InteractiveGraph.getSegmentCoords(\n            this.props.graph,\n            this.props\n        );\n\n        const createPoint = options => Interactive2.addMaybeMobileMovablePoint(this, options);\n\n        this.points = [];\n        this.lines = _.map(\n            coords,\n            function(segment, i) {\n                var updateCoordProps = function() {\n                    var graph = _.extend({}, self.props.graph, {\n                        coords: _.invoke(self.lines, \"coords\"),\n                    });\n                    self.onChange({graph: graph});\n                };\n\n                var points = _.map(segment, function(coord, i) {\n                    return createPoint({\n                        coord: coord,\n                        constraints: [\n                            Interactive2.MovablePoint.constraints.bound(),\n                            Interactive2.MovablePoint.constraints.snap(),\n                            coord => {\n                                if (!points) {\n                                    // points hasn't been defined yet because\n                                    // we're still creating them\n                                    return;\n                                }\n                                return !kpoint.equal(\n                                    coord,\n                                    points[1 - i].coord()\n                                );\n                            },\n                        ],\n                        onMove: updateCoordProps,\n                    });\n                });\n\n                self.points = self.points.concat(points);\n                var line = Interactive2.addMovableLine(graphie, {\n                    points: points,\n                    static: false,\n                    constraints: [\n                        Interactive2.MovableLine.constraints.bound(),\n                        Interactive2.MovableLine.constraints.snap(),\n                    ],\n                    onMove: [\n                        Interactive2.MovableLine.onMove.updatePoints,\n                        updateCoordProps,\n                    ],\n                    normalStyle: {\n                        stroke: this.props.apiOptions.isMobile\n                            ? KhanColors.BLUE_C\n                            : KhanColors.INTERACTIVE,\n                        ...this._lineStroke(),\n                    },\n                    highlightStyle: {\n                        stroke: this.props.apiOptions.isMobile\n                            ? KhanColors.BLUE_C\n                            : KhanColors.INTERACTING,\n                        ...this._lineStroke(),\n                    },\n                });\n                _.invoke(points, \"toFront\");\n\n                return line;\n            },\n            this\n        );\n    },\n\n    removeSegmentControls: function() {\n        _.invoke(this.points, \"remove\");\n        _.invoke(this.lines, \"remove\");\n    },\n\n    addRayControls: function() {\n        this.addLine(\"ray\");\n    },\n\n    removeRayControls: function() {\n        this.removeLine();\n    },\n\n    addPolygonControls: function() {\n        this.polygon = null;\n        var coords = InteractiveGraph.getPolygonCoords(\n            this.props.graph,\n            this.props\n        );\n        // Clear out our old points so that newly added points don't\n        // \"collide\", as in `addPointControls`\n        this.points = [];\n        this.points = _.map(coords, this.createPointForPolygonType, this);\n        this.updatePolygon();\n    },\n\n    updatePolygon: function() {\n        var closed;\n        if (this.polygon) {\n            closed = this.polygon.closed();\n        } else if (this.points.length >= 3) {\n            closed = true;\n        } else {\n            // There will only be fewer than 3 points in click-to-add-vertices\n            // mode, so we don't need to explicitly check for that here.\n            closed = false;\n        }\n\n        var graphie = this.graphie;\n        var n = this.points.length;\n\n        // TODO(alex): check against \"grid\" instead, use constants\n        var snapToGrid = !_.contains(\n            [\"angles\", \"sides\"],\n            this.props.graph.snapTo\n        );\n\n        var angleLabels = _.times(\n            n,\n            function(i) {\n                if (\n                    !this.props.graph.showAngles ||\n                    (!closed && (i === 0 || i === n - 1))\n                ) {\n                    return \"\";\n                } else if (this.props.graph.snapTo === \"angles\") {\n                    return \"$deg0\";\n                } else {\n                    return \"$deg1\";\n                }\n            },\n            this\n        );\n\n        var showRightAngleMarkers = _.times(\n            n,\n            function(i) {\n                return closed || (i !== 0 && i !== n - 1);\n            },\n            this\n        );\n\n        var numArcs = _.times(\n            n,\n            function(i) {\n                if (\n                    this.props.graph.showAngles &&\n                    (closed || (i !== 0 && i !== n - 1))\n                ) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            },\n            this\n        );\n\n        var sideLabels = _.times(\n            n,\n            function(i) {\n                if (!this.props.graph.showSides || (!closed && i === n - 1)) {\n                    return \"\";\n                } else if (this.props.graph.snapTo === \"sides\") {\n                    return \"$len0\";\n                } else {\n                    return \"$len1\";\n                }\n            },\n            this\n        );\n\n        if (this.polygon == null) {\n            var self = this;\n            self.polygon = Interactive2.addMovablePolygon(graphie, {\n                constraints: [\n                    Interactive2.MovablePolygon.constraints.bound(),\n                    snapToGrid\n                        ? Interactive2.MovablePolygon.constraints.snap()\n                        : null,\n                ],\n                closed: closed,\n                points: self.points,\n                angleLabels: angleLabels,\n                showRightAngleMarkers: showRightAngleMarkers,\n                numArcs: numArcs,\n                sideLabels: sideLabels,\n                onMove: [\n                    Interactive2.MovablePolygon.onMove.updatePoints,\n                    function() {\n                        if (this.closed()) {\n                            self.updateCoordsFromPoints();\n                        }\n                    },\n                ],\n                normalStyle: {\n                    stroke: this.props.apiOptions.isMobile\n                        ? KhanColors.BLUE_C\n                        : KhanColors.INTERACTIVE,\n                    ...this._lineStroke(),\n                },\n            });\n        } else {\n            // We only need to pass in the properties that might've changed\n            this.polygon.update({\n                closed: closed,\n                points: this.points,\n                angleLabels: angleLabels,\n                showRightAngleMarkers: showRightAngleMarkers,\n                numArcs: numArcs,\n                sideLabels: sideLabels,\n            });\n        }\n    },\n\n    removePolygonControls: function() {\n        _.invoke(this.points, \"remove\");\n        this.polygon.remove();\n    },\n\n    addAngleControls: function() {\n        var graphie = this.graphie;\n\n        var coords = InteractiveGraph.getAngleCoords(\n            this.props.graph,\n            this.props\n        );\n\n        // The vertex snaps to the grid, but the rays don't...\n        this.points = _.map(coords, function(coord, i) {\n            return graphie.addMovablePoint(\n                _.extend(\n                    {\n                        coord: coord,\n                        normalStyle: {\n                            stroke: KhanColors.INTERACTIVE,\n                            fill: KhanColors.INTERACTIVE,\n                        },\n                    },\n                    i === 1\n                        ? {\n                              snapX: graphie.snap[0],\n                              snapY: graphie.snap[1],\n                          }\n                        : {}\n                )\n            );\n        });\n\n        // ...they snap to whole-degree angles from the vertex.\n        this.angle = graphie.addMovableAngle({\n            points: this.points,\n            snapDegrees: this.props.graph.snapDegrees || 1,\n            snapOffsetDeg: this.props.graph.angleOffsetDeg || 0,\n            angleLabel: this.props.graph.showAngles ? \"$deg0\" : \"\",\n            pushOut: 2,\n            allowReflex: defaultVal(this.props.graph.allowReflexAngles, true),\n        });\n\n        $(this.angle).on(\"move\", () => {\n            var graph = _.extend({}, this.props.graph, {\n                coords: this.angle.getClockwiseCoords(),\n            });\n            this.onChange({graph: graph});\n        });\n    },\n\n    removeAngleControls: function() {\n        _.invoke(this.points, \"remove\");\n        this.angle.remove();\n    },\n\n    toggleShowAngles: function() {\n        var graph = _.extend({}, this.props.graph, {\n            showAngles: !this.props.graph.showAngles,\n        });\n        this.onChange({graph: graph});\n    },\n\n    toggleShowSides: function() {\n        var graph = _.extend({}, this.props.graph, {\n            showSides: !this.props.graph.showSides,\n        });\n        this.onChange({graph: graph});\n    },\n\n    getUserInput: function() {\n        return this.props.graph;\n    },\n\n    simpleValidate: function(rubric) {\n        return InteractiveGraph.validate(this.getUserInput(), rubric, this);\n    },\n\n    focus: $.noop,\n});\n\n_.extend(InteractiveGraph, {\n    getQuadraticCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n        var p3 = coords[2];\n\n        var denom = (p1[0] - p2[0]) * (p1[0] - p3[0]) * (p2[0] - p3[0]);\n        if (denom === 0) {\n            return;\n        }\n        var a =\n            (p3[0] * (p2[1] - p1[1]) +\n                p2[0] * (p1[1] - p3[1]) +\n                p1[0] * (p3[1] - p2[1])) /\n            denom;\n        var b =\n            (p3[0] * p3[0] * (p1[1] - p2[1]) +\n                p2[0] * p2[0] * (p3[1] - p1[1]) +\n                p1[0] * p1[0] * (p2[1] - p3[1])) /\n            denom;\n        var c =\n            (p2[0] * p3[0] * (p2[0] - p3[0]) * p1[1] +\n                p3[0] * p1[0] * (p3[0] - p1[0]) * p2[1] +\n                p1[0] * p2[0] * (p1[0] - p2[0]) * p3[1]) /\n            denom;\n        return [a, b, c];\n    },\n\n    getSinusoidCoefficients: function(coords) {\n        // It's assumed that p1 is the root and p2 is the first peak\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        // Resulting coefficients are canonical for this sine curve\n        var amplitude = p2[1] - p1[1];\n        var angularFrequency = Math.PI / (2 * (p2[0] - p1[0]));\n        var phase = p1[0] * angularFrequency;\n        var verticalOffset = p1[1];\n\n        return [amplitude, angularFrequency, phase, verticalOffset];\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getLineCoords: function(graph, props) {\n        return (\n            graph.coords ||\n            InteractiveGraph.pointsFromNormalized(props, [\n                [0.25, 0.75],\n                [0.75, 0.75],\n            ])\n        );\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getPointCoords: function(graph, props) {\n        var numPoints = graph.numPoints || 1;\n        var coords = graph.coords;\n\n        if (coords) {\n            return coords;\n        } else {\n            switch (numPoints) {\n                case 1:\n                    // Back in the day, one point's coords were in graph.coord\n                    coords = [graph.coord || [0, 0]];\n                    break;\n                case 2:\n                    coords = [[-5, 0], [5, 0]];\n                    break;\n                case 3:\n                    coords = [[-5, 0], [0, 0], [5, 0]];\n                    break;\n                case 4:\n                    coords = [[-6, 0], [-2, 0], [2, 0], [6, 0]];\n                    break;\n                case 5:\n                    coords = [[-6, 0], [-3, 0], [0, 0], [3, 0], [6, 0]];\n                    break;\n                case 6:\n                    coords = [\n                        [-5, 0],\n                        [-3, 0],\n                        [-1, 0],\n                        [1, 0],\n                        [3, 0],\n                        [5, 0],\n                    ];\n                    break;\n                case UNLIMITED:\n                    coords = [];\n                    break;\n            }\n            // Transform coords from their -10 to 10 space to 0 to 1\n            // because of the old graph.coord, and also it's easier.\n            var range = [[-10, 10], [-10, 10]];\n            coords = InteractiveGraph.normalizeCoords(coords, range);\n\n            var coords = InteractiveGraph.pointsFromNormalized(props, coords);\n            return coords;\n        }\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getLinearSystemCoords: function(graph, props) {\n        return graph.coords ||\n        _.map(\n            [[[0.25, 0.75], [0.75, 0.75]], [[0.25, 0.25], [0.75, 0.25]]],\n            coords => {\n                return InteractiveGraph.pointsFromNormalized(props, coords);\n            }\n        );\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getPolygonCoords: function(graph, props) {\n        var coords = graph.coords;\n        if (coords) {\n            return coords;\n        }\n\n        var n = graph.numSides || 3;\n\n        if (n === UNLIMITED) {\n            coords = [];\n        } else {\n            var angle = 2 * Math.PI / n;\n            var offset = (1 / n - 1 / 2) * Math.PI;\n\n            // TODO(alex): Generalize this to more than just triangles so that\n            // all polygons have whole number side lengths if snapping to sides\n            var radius = graph.snapTo === \"sides\" ? Math.sqrt(3) / 3 * 7 : 4;\n\n            // Generate coords of a regular polygon with n sides\n            coords = _.times(n, function(i) {\n                return [\n                    radius * Math.cos(i * angle + offset),\n                    radius * Math.sin(i * angle + offset),\n                ];\n            });\n        }\n\n        var range = [[-10, 10], [-10, 10]];\n        coords = InteractiveGraph.normalizeCoords(coords, range);\n\n        var snapToGrid = !_.contains([\"angles\", \"sides\"], graph.snapTo);\n        coords = InteractiveGraph.pointsFromNormalized(\n            props,\n            coords,\n            /* noSnap */ !snapToGrid\n        );\n\n        return coords;\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getSegmentCoords: function(graph, props) {\n        var coords = graph.coords;\n        if (coords) {\n            return coords;\n        }\n\n        var n = graph.numSegments || 1;\n        var ys = {\n            1: [5],\n            2: [5, -5],\n            3: [5, 0, -5],\n            4: [6, 2, -2, -6],\n            5: [6, 3, 0, -3, -6],\n            6: [5, 3, 1, -1, -3, -5],\n        }[n];\n        var range = [[-10, 10], [-10, 10]];\n\n        return _.map(ys, function(y) {\n            var segment = [[-5, y], [5, y]];\n            segment = InteractiveGraph.normalizeCoords(segment, range);\n            segment = InteractiveGraph.pointsFromNormalized(props, segment);\n            return segment;\n        });\n    },\n\n    /**\n     * @param {object} graph Like props.graph or props.correct\n     * @param {object} props of an InteractiveGraph instance\n     */\n    getAngleCoords: function(graph, props) {\n        var coords = graph.coords;\n        if (coords) {\n            return coords;\n        }\n\n        var snap = graph.snapDegrees || 1;\n        var angle = snap;\n        while (angle < 20) {\n            angle += snap;\n        }\n        angle = angle * Math.PI / 180;\n        var offset = (graph.angleOffsetDeg || 0) * Math.PI / 180;\n\n        coords = InteractiveGraph.pointsFromNormalized(props, [\n            [0.85, 0.5],\n            [0.5, 0.5],\n        ]);\n\n        var radius = magnitude(vector.apply(null, coords));\n\n        // Adjust the lower point by angleOffsetDeg degrees\n        coords[0] = [\n            coords[1][0] + radius * Math.cos(offset),\n            coords[1][1] + radius * Math.sin(offset),\n        ];\n        // Position the upper point angle radians from the\n        // lower point\n        coords[2] = [\n            coords[1][0] + radius * Math.cos(angle + offset),\n            coords[1][1] + radius * Math.sin(angle + offset),\n        ];\n\n        return coords;\n    },\n\n    normalizeCoords: function(coordsList, range) {\n        return _.map(coordsList, function(coords) {\n            return _.map(coords, function(coord, i) {\n                var extent = range[i][1] - range[i][0];\n                return (coord + range[i][1]) / extent;\n            });\n        });\n    },\n\n    getEquationString: function(props) {\n        var type = props.graph.type;\n        var funcName = \"get\" + capitalize(type) + \"EquationString\";\n        return InteractiveGraph[funcName](props);\n    },\n\n    pointsFromNormalized: function(props, coordsList, noSnap) {\n        return _.map(coordsList, function(coords) {\n            return _.map(coords, function(coord, i) {\n                var range = props.range[i];\n                if (noSnap) {\n                    return range[0] + (range[1] - range[0]) * coord;\n                } else {\n                    var step = props.step[i];\n                    var nSteps = numSteps(range, step);\n                    var tick = Math.round(coord * nSteps);\n                    return range[0] + step * tick;\n                }\n            });\n        });\n    },\n\n    getLinearEquationString: function(props) {\n        var coords = InteractiveGraph.getLineCoords(props.graph, props);\n        if (eq(coords[0][0], coords[1][0])) {\n            return \"x = \" + coords[0][0].toFixed(3);\n        } else {\n            var m =\n                (coords[1][1] - coords[0][1]) / (coords[1][0] - coords[0][0]);\n            var b = coords[0][1] - m * coords[0][0];\n            if (eq(m, 0)) {\n                return \"y = \" + b.toFixed(3);\n            } else {\n                return \"y = \" + m.toFixed(3) + \"x + \" + b.toFixed(3);\n            }\n        }\n    },\n\n    getCurrentQuadraticCoefficients: function(props) {\n        // TODO(alpert): Don't duplicate\n        var coords =\n            props.graph.coords ||\n            InteractiveGraph.defaultQuadraticCoords(props);\n        return InteractiveGraph.getQuadraticCoefficients(coords);\n    },\n\n    defaultQuadraticCoords: function(props) {\n        var coords = [[0.25, 0.75], [0.5, 0.25], [0.75, 0.75]];\n        return InteractiveGraph.pointsFromNormalized(props, coords);\n    },\n\n    getQuadraticEquationString: function(props) {\n        var coeffs = InteractiveGraph.getCurrentQuadraticCoefficients(props);\n        return (\n            \"y = \" +\n            coeffs[0].toFixed(3) +\n            \"x^2 + \" +\n            coeffs[1].toFixed(3) +\n            \"x + \" +\n            coeffs[2].toFixed(3)\n        );\n    },\n\n    getCurrentSinusoidCoefficients: function(props) {\n        var coords =\n            props.graph.coords || InteractiveGraph.defaultSinusoidCoords(props);\n        return InteractiveGraph.getSinusoidCoefficients(coords);\n    },\n\n    defaultSinusoidCoords: function(props) {\n        var coords = [[0.5, 0.5], [0.65, 0.6]];\n        return InteractiveGraph.pointsFromNormalized(props, coords);\n    },\n\n    getSinusoidEquationString: function(props) {\n        var coeffs = InteractiveGraph.getCurrentSinusoidCoefficients(props);\n        return (\n            \"y = \" +\n            coeffs[0].toFixed(3) +\n            \"sin(\" +\n            coeffs[1].toFixed(3) +\n            \"x - \" +\n            coeffs[2].toFixed(3) +\n            \") + \" +\n            coeffs[3].toFixed(3)\n        );\n    },\n\n    getCircleEquationString: function(props) {\n        var graph = props.graph;\n        // TODO(alpert): Don't duplicate\n        var center = graph.center || [0, 0];\n        var radius = graph.radius || 2;\n        return (\n            \"center (\" + center[0] + \", \" + center[1] + \"), radius \" + radius\n        );\n    },\n\n    getLinearSystemEquationString: function(props) {\n        var coords = InteractiveGraph.getLinearSystemCoords(props.graph, props);\n        return (\n            \"\\n\" +\n            getLineEquation(coords[0][0], coords[0][1]) +\n            \"\\n\" +\n            getLineEquation(coords[1][0], coords[1][1]) +\n            \"\\n\" +\n            getLineIntersection(coords[0], coords[1])\n        );\n    },\n\n    getPointEquationString: function(props) {\n        var coords = InteractiveGraph.getPointCoords(props.graph, props);\n        return coords\n            .map(function(coord) {\n                return \"(\" + coord[0] + \", \" + coord[1] + \")\";\n            })\n            .join(\", \");\n    },\n\n    getSegmentEquationString: function(props) {\n        var segments = InteractiveGraph.getSegmentCoords(props.graph, props);\n        return _.map(segments, function(segment) {\n            return \"[\" +\n            _.map(segment, function(coord) {\n                return \"(\" + coord.join(\", \") + \")\";\n            }).join(\" \") +\n            \"]\";\n        }).join(\" \");\n    },\n\n    getRayEquationString: function(props) {\n        var coords = InteractiveGraph.getLineCoords(props.graph, props);\n        var a = coords[0];\n        var b = coords[1];\n        var eq = InteractiveGraph.getLinearEquationString(props);\n\n        if (a[0] > b[0]) {\n            eq += \" (for x <= \" + a[0].toFixed(3) + \")\";\n        } else if (a[0] < b[0]) {\n            eq += \" (for x >= \" + a[0].toFixed(3) + \")\";\n        } else if (a[1] > b[1]) {\n            eq += \" (for y <= \" + a[1].toFixed(3) + \")\";\n        } else {\n            eq += \" (for y >= \" + a[1].toFixed(3) + \")\";\n        }\n\n        return eq;\n    },\n\n    getPolygonEquationString: function(props) {\n        var coords = InteractiveGraph.getPolygonCoords(props.graph, props);\n        return _.map(coords, function(coord) {\n            return \"(\" + coord.join(\", \") + \")\";\n        }).join(\" \");\n    },\n\n    getAngleEquationString: function(props) {\n        var coords = InteractiveGraph.getAngleCoords(props.graph, props);\n        var angle = GraphUtils.findAngle(coords[2], coords[0], coords[1]);\n        return (\n            angle.toFixed(0) +\n            \"\\u00B0 angle\" +\n            \" at (\" +\n            coords[1].join(\", \") +\n            \")\"\n        );\n    },\n\n    validate: function(state, rubric, component) {\n        // When nothing has moved, there will neither be coords nor the\n        // circle's center/radius fields. When those fields are absent, skip\n        // all these checks; just go mark the answer as empty.\n        var hasValue = !!(state.coords || (state.center && state.radius));\n\n        if (state.type === rubric.correct.type && hasValue) {\n            if (state.type === \"linear\") {\n                var guess = state.coords;\n                var correct = rubric.correct.coords;\n                // If both of the guess points are on the correct line, it's\n                // correct.\n                if (\n                    collinear(correct[0], correct[1], guess[0]) &&\n                    collinear(correct[0], correct[1], guess[1])\n                ) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"linear-system\") {\n                var guess = state.coords;\n                var correct = rubric.correct.coords;\n\n                if (\n                    (collinear(correct[0][0], correct[0][1], guess[0][0]) &&\n                        collinear(correct[0][0], correct[0][1], guess[0][1]) &&\n                        collinear(correct[1][0], correct[1][1], guess[1][0]) &&\n                        collinear(correct[1][0], correct[1][1], guess[1][1])) ||\n                    (collinear(correct[0][0], correct[0][1], guess[1][0]) &&\n                        collinear(correct[0][0], correct[0][1], guess[1][1]) &&\n                        collinear(correct[1][0], correct[1][1], guess[0][0]) &&\n                        collinear(correct[1][0], correct[1][1], guess[0][1]))\n                ) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"quadratic\") {\n                // If the parabola coefficients match, it's correct.\n                var guessCoeffs = this.getQuadraticCoefficients(state.coords);\n                var correctCoeffs = this.getQuadraticCoefficients(\n                    rubric.correct.coords\n                );\n                if (deepEq(guessCoeffs, correctCoeffs)) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"sinusoid\") {\n                var guessCoeffs = this.getSinusoidCoefficients(state.coords);\n                var correctCoeffs = this.getSinusoidCoefficients(\n                    rubric.correct.coords\n                );\n\n                var canonicalGuessCoeffs = canonicalSineCoefficients(\n                    guessCoeffs\n                );\n                var canonicalCorrectCoeffs = canonicalSineCoefficients(\n                    correctCoeffs\n                );\n                // If the canonical coefficients match, it's correct.\n                if (deepEq(canonicalGuessCoeffs, canonicalCorrectCoeffs)) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"circle\") {\n                if (\n                    deepEq(state.center, rubric.correct.center) &&\n                    eq(state.radius, rubric.correct.radius)\n                ) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"point\") {\n                var guess = state.coords;\n                var correct = InteractiveGraph.getPointCoords(\n                    rubric.correct,\n                    component\n                );\n                guess = guess.slice();\n                correct = correct.slice();\n                // Everything's already rounded so we shouldn't need to do an\n                // eq() comparison but _.isEqual(0, -0) is false, so we'll use\n                // eq() anyway. The sort should be fine because it'll stringify\n                // it and -0 converted to a string is \"0\"\n                guess.sort();\n                correct.sort();\n                if (deepEq(guess, correct)) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"polygon\") {\n                var guess = state.coords.slice();\n                var correct = rubric.correct.coords.slice();\n\n                var match;\n                if (rubric.correct.match === \"similar\") {\n                    match = similar(guess, correct, Number.POSITIVE_INFINITY);\n                } else if (rubric.correct.match === \"congruent\") {\n                    match = similar(guess, correct, knumber.DEFAULT_TOLERANCE);\n                } else if (rubric.correct.match === \"approx\") {\n                    match = similar(guess, correct, 0.1);\n                } else {\n                    /* exact */\n                    guess.sort();\n                    correct.sort();\n                    match = deepEq(guess, correct);\n                }\n\n                if (match) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"segment\") {\n                var guess = state.coords.slice();\n                var correct = rubric.correct.coords.slice();\n                guess = _.invoke(guess, \"sort\").sort();\n                correct = _.invoke(correct, \"sort\").sort();\n                if (deepEq(guess, correct)) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"ray\") {\n                var guess = state.coords;\n                var correct = rubric.correct.coords;\n                if (\n                    deepEq(guess[0], correct[0]) &&\n                    collinear(correct[0], correct[1], guess[1])\n                ) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            } else if (state.type === \"angle\") {\n                var guess = state.coords;\n                var correct = rubric.correct.coords;\n\n                var match;\n                if (rubric.correct.match === \"congruent\") {\n                    var angles = _.map([guess, correct], function(coords) {\n                        var angle = GraphUtils.findAngle(\n                            coords[2],\n                            coords[0],\n                            coords[1]\n                        );\n                        return (angle + 360) % 360;\n                    });\n                    match = eq.apply(null, angles);\n                } else {\n                    /* exact */\n                    match =\n                        deepEq(guess[1], correct[1]) &&\n                        collinear(correct[1], correct[0], guess[0]) &&\n                        collinear(correct[1], correct[2], guess[2]);\n                }\n\n                if (match) {\n                    return {\n                        type: \"points\",\n                        earned: 1,\n                        total: 1,\n                        message: null,\n                    };\n                }\n            }\n        }\n\n        // The input wasn't correct, so check if it's a blank input or if it's\n        // actually just wrong\n        if (!hasValue || _.isEqual(state, rubric.graph)) {\n            // We're where we started.\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n_module_.exports = {\n    name: \"interactive-graph\",\n    displayName: \"Interactive graph\",\n    widget: InteractiveGraph,\n};\nexport default _module_.exports;\n","import { containerSizeClass, getInteractiveBoxFromSizeClass } from \"../util/sizing-utils.js\";\nimport { interactiveSizes } from \"../styles/constants.js\";\nimport _interactiveGraphJsx from \"./interactive-graph.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _componentsGraphSettingsJsx from \"../components/graph-settings.jsx\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Util = _utilJs;\n\nconst DeprecationMixin = Util.DeprecationMixin;\n\nconst GraphSettings = _componentsGraphSettingsJsx;\nconst InfoTip = _componentsInfoTipJsx;\n\nconst InteractiveGraph = _interactiveGraphJsx.widget;\n\nconst defaultBackgroundImage = {\n    url: null,\n};\n\nvar deprecatedProps = {\n    showGraph: function(props) {\n        return {markings: props.showGraph ? \"graph\" : \"none\"};\n    },\n};\n\nconst InteractiveGraphEditor = createReactClass({\n    className: \"perseus-widget-interactive-graph\",\n\n    getDefaultProps: function() {\n        return {\n            labels: [\"x\", \"y\"],\n            range: [[-10, 10], [-10, 10]],\n            step: [1, 1],\n            valid: true,\n            backgroundImage: defaultBackgroundImage,\n            markings: \"graph\",\n            showProtractor: false,\n            showRuler: false,\n            showTooltips: false,\n            rulerLabel: \"\",\n            rulerTicks: 10,\n            correct: {\n                type: \"linear\",\n                coords: null,\n            },\n        };\n    },\n\n    // TODO(jack): Use versioning instead of DeprecationMixin\n    deprecatedProps: deprecatedProps,\n\n    componentWillMount() {\n        DeprecationMixin.componentWillMount.call(this);\n    },\n\n    render: function() {\n        var graph;\n        var equationString;\n\n        var gridStep =\n            this.props.gridStep ||\n            Util.getGridStep(\n                this.props.range,\n                this.props.step,\n                interactiveSizes.defaultBoxSize\n            );\n        var snapStep =\n            this.props.snapStep || Util.snapStepFromGridStep(gridStep);\n\n        const sizeClass = containerSizeClass.SMALL;\n        if (this.props.valid === true) {\n            // TODO(aria): send these down all at once\n            var graphProps = {\n                ref: \"graph\",\n                box: this.props.box,\n                range: this.props.range,\n                labels: this.props.labels,\n                step: this.props.step,\n                gridStep: gridStep,\n                snapStep: snapStep,\n                graph: this.props.correct,\n                backgroundImage: this.props.backgroundImage,\n                markings: this.props.markings,\n                showProtractor: this.props.showProtractor,\n                showRuler: this.props.showRuler,\n                rulerLabel: this.props.rulerLabel,\n                rulerTicks: this.props.rulerTicks,\n                trackInteraction: function() {},\n                flexibleType: true,\n                onChange: newProps => {\n                    var correct = this.props.correct;\n                    if (correct.type === newProps.graph.type) {\n                        correct = _.extend({}, correct, newProps.graph);\n                    } else {\n                        // Clear options from previous graph\n                        correct = newProps.graph;\n                    }\n                    this.props.onChange({correct: correct});\n                },\n            };\n            graph = (\n                <InteractiveGraph\n                    {...graphProps}\n                    containerSizeClass={sizeClass}\n                    apiOptions={{\n                        ...this.props.apiOptions,\n                        isMobile: false,\n                    }}\n                />\n            );\n            equationString = InteractiveGraph.getEquationString(graphProps);\n        } else {\n            graph = (\n                <div className=\"perseus-error\">\n                    {this.props.valid}\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"perseus-widget-interactive-graph\">\n                <div>\n                    Correct answer{\" \"}\n                    <InfoTip>\n                        <p>\n                            Graph the correct answer in the graph below and\n                            ensure the equation or point coordinates displayed\n                            represent the correct answer.\n                        </p>\n                    </InfoTip>{\" \"}\n                    : {equationString}\n                </div>\n\n                <GraphSettings\n                    box={getInteractiveBoxFromSizeClass(sizeClass)}\n                    range={this.props.range}\n                    labels={this.props.labels}\n                    step={this.props.step}\n                    gridStep={gridStep}\n                    snapStep={snapStep}\n                    valid={this.props.valid}\n                    backgroundImage={this.props.backgroundImage}\n                    markings={this.props.markings}\n                    showProtractor={this.props.showProtractor}\n                    showRuler={this.props.showRuler}\n                    showTooltips={this.props.showTooltips}\n                    rulerLabel={this.props.rulerLabel}\n                    rulerTicks={this.props.rulerTicks}\n                    onChange={this.props.onChange}\n                />\n\n                {this.props.correct.type === \"polygon\" &&\n                    <div className=\"type-settings\">\n                        <label>\n                            {\" \"}Student answer must{\" \"}\n                            <select\n                                value={this.props.correct.match}\n                                onChange={this.changeMatchType}\n                            >\n                                <option value=\"exact\">match exactly</option>\n                                <option value=\"congruent\">be congruent</option>\n                                <option value=\"approx\">\n                                    be approximately congruent\n                                </option>\n                                <option value=\"similar\">be similar</option>\n                            </select>\n                        </label>\n                        <InfoTip>\n                            <ul>\n                                <li>\n                                    <p>\n                                        <b>Match Exactly:</b> Match exactly in\n                                        size, orientation, and location on the\n                                        grid even if it is not shown in the\n                                        background.\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        <b>Be Congruent:</b> Be congruent in\n                                        size and shape, but can be located\n                                        anywhere on the grid.\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        <b>Be Approximately Congruent:</b> Be\n                                        exactly similar, and congruent in size\n                                        and shape to within 0.1 units, but can\n                                        be located anywhere on the grid.{\" \"}\n                                        <em>\n                                            Use this with snapping to angle\n                                            measure.\n                                        </em>\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        <b>Be Similar:</b> Be similar with\n                                        matching interior angles, and side\n                                        measures that are matching or a multiple\n                                        of the correct side measures. The figure\n                                        can be located anywhere on the grid.\n                                    </p>\n                                </li>\n                            </ul>\n                        </InfoTip>\n                    </div>}\n                {this.props.correct.type === \"angle\" &&\n                    <div className=\"type-settings\">\n                        <div>\n                            <label>\n                                {\" \"}Student answer must{\" \"}\n                                <select\n                                    value={this.props.correct.match}\n                                    onChange={this.changeMatchType}\n                                >\n                                    <option value=\"exact\">match exactly</option>\n                                    <option value=\"congruent\">\n                                        be congruent\n                                    </option>\n                                </select>\n                            </label>\n                            <InfoTip>\n                                <p>\n                                    Congruency requires only that the angle\n                                    measures are the same. An exact match\n                                    implies congruency, but also requires that\n                                    the angles have the same orientation and\n                                    that the vertices are in the same position.\n                                </p>\n                            </InfoTip>\n                        </div>\n                    </div>}\n                {graph}\n            </div>\n        );\n    },\n\n    changeMatchType: function(e) {\n        var correct = _.extend({}, this.props.correct, {\n            match: e.target.value,\n        });\n        this.props.onChange({correct: correct});\n    },\n\n    serialize: function() {\n        var json = _.pick(\n            this.props,\n            \"step\",\n            \"backgroundImage\",\n            \"markings\",\n            \"labels\",\n            \"showProtractor\",\n            \"showRuler\",\n            \"showTooltips\",\n            \"rulerLabel\",\n            \"rulerTicks\",\n            \"range\",\n            \"gridStep\",\n            \"snapStep\"\n        );\n\n        var graph = this.refs.graph;\n        if (graph) {\n            var correct = graph && graph.getUserInput();\n            _.extend(json, {\n                // TODO(alpert): Allow specifying flexibleType (whether the\n                // graph type should be a choice or not)\n                graph: {type: correct.type},\n                correct: correct,\n            });\n\n            _.each(\n                [\n                    \"allowReflexAngles\",\n                    \"angleOffsetDeg\",\n                    \"numPoints\",\n                    \"numSides\",\n                    \"numSegments\",\n                    \"showAngles\",\n                    \"showSides\",\n                    \"snapTo\",\n                    \"snapDegrees\",\n                ],\n                function(key) {\n                    if (_.has(correct, key)) {\n                        json.graph[key] = correct[key];\n                    }\n                }\n            );\n        }\n        return json;\n    },\n});\n\n_module_.exports = InteractiveGraphEditor;\nexport default _module_.exports;\n","import _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/prop-types, react/sort-comp */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst TeX = _reactComponentsTexJsx;\n\nconst prettyBig = {fontSize: \"150%\"};\nconst slightlyBig = {fontSize: \"120%\"};\nconst symbStyle = {fontSize: \"130%\"};\n\n// These are functions because we want to generate a new component for each use\n// on the page rather than reusing an instance (which will cause an error).\n// Also, it's useful for things which might look different depending on the\n// props.\n\nconst basic = [\n    () => [\n        <span key=\"plus\" style={slightlyBig}>\n            +\n        </span>,\n        \"+\",\n    ],\n    () => [\n        <span key=\"minus\" style={prettyBig}>\n            -\n        </span>,\n        \"-\",\n    ],\n\n    // TODO(joel) - display as \\cdot when appropriate\n    props => {\n        if (props.convertDotToTimes) {\n            return [\n                <TeX key=\"times\" style={prettyBig}>\n                    \\times\n                </TeX>,\n                \"\\\\times\",\n            ];\n        } else {\n            return [\n                <TeX key=\"times\" style={prettyBig}>\n                    \\cdot\n                </TeX>,\n                \"\\\\cdot\",\n            ];\n        }\n    },\n    () => [\n        <TeX key=\"frac\" style={prettyBig}>\n            {\"\\\\frac{}{}\"}\n        </TeX>,\n\n        // If there's something in the input that can become part of a\n        // fraction, typing \"/\" puts it in the numerator. If not, typing\n        // \"/\" does nothing. In that case, enter a \\frac.\n        input => {\n            const contents = input.latex();\n            input.typedText(\"/\");\n            if (input.latex() === contents) {\n                input.cmd(\"\\\\frac\");\n            }\n        },\n    ],\n];\n\nconst buttonSets = {\n    basic,\n\n    \"basic+div\": basic.concat([() => [<TeX key=\"div\">\\div</TeX>, \"\\\\div\"]]),\n\n    trig: [\n        () => [<TeX key=\"sin\">\\sin</TeX>, \"\\\\sin\"],\n        () => [<TeX key=\"cos\">\\cos</TeX>, \"\\\\cos\"],\n        () => [<TeX key=\"tan\">\\tan</TeX>, \"\\\\tan\"],\n        () => [\n            <TeX key=\"theta\" style={symbStyle}>\n                \\theta\n            </TeX>,\n            \"\\\\theta\",\n        ],\n        () => [\n            <TeX key=\"pi\" style={symbStyle}>\n                \\phi\n            </TeX>,\n            \"\\\\phi\",\n        ],\n    ],\n\n    prealgebra: [\n        () => [\n            <TeX key=\"sqrt\">\n                {\"\\\\sqrt{x}\"}\n            </TeX>,\n            \"\\\\sqrt\",\n        ],\n        // TODO(joel) - how does desmos do this?\n        () => [\n            <TeX key=\"nthroot\">\n                {\"\\\\sqrt[3]{x}\"}\n            </TeX>,\n            input => {\n                input.typedText(\"nthroot3\");\n                input.keystroke(\"Right\");\n            },\n        ],\n        () => [\n            <TeX key=\"pow\" style={slightlyBig}>\n                ^a\n            </TeX>,\n            input => {\n                const contents = input.latex();\n                input.typedText(\"^\");\n\n                // If the input hasn't changed (for example, if we're\n                // attempting to add an exponent on an empty input or an empty\n                // denominator), insert our own \"a^b\"\n                if (input.latex() === contents) {\n                    input.typedText(\"a^b\");\n                }\n            },\n        ],\n        () => [\n            <TeX key=\"pi\" style={slightlyBig}>\n                \\pi\n            </TeX>,\n            \"\\\\pi\",\n        ],\n    ],\n\n    logarithms: [\n        () => [<TeX key=\"log\">\\log</TeX>, \"\\\\log\"],\n        () => [<TeX key=\"ln\">\\ln</TeX>, \"\\\\ln\"],\n        () => [\n            <TeX key=\"log_b\">\\log_b</TeX>,\n            input => {\n                input.typedText(\"log_\");\n                input.keystroke(\"Right\");\n                input.typedText(\"(\");\n                input.keystroke(\"Left\");\n                input.keystroke(\"Left\");\n            },\n        ],\n    ],\n\n    \"basic relations\": [\n        () => [\n            <TeX key=\"eq\">\n                {\"=\"}\n            </TeX>,\n            \"=\",\n        ],\n        () => [<TeX key=\"lt\">\\lt</TeX>, \"\\\\lt\"],\n        () => [<TeX key=\"gt\">\\gt</TeX>, \"\\\\gt\"],\n    ],\n\n    \"advanced relations\": [\n        () => [<TeX key=\"neq\">\\neq</TeX>, \"\\\\neq\"],\n        () => [<TeX key=\"leq\">\\leq</TeX>, \"\\\\leq\"],\n        () => [<TeX key=\"geq\">\\geq</TeX>, \"\\\\geq\"],\n    ],\n};\n\nconst buttonSetsType = PropTypes.arrayOf(\n    PropTypes.oneOf(Object.keys(buttonSets))\n);\n\nconst TexButtons = createReactClass({\n    propTypes: {\n        sets: buttonSetsType.isRequired,\n        onInsert: PropTypes.func.isRequired,\n    },\n\n    render: function() {\n        // Always show buttonSets in the same order. Note: Technically it's ok\n        // for _.keys() to return the keys in an arbitrary order, but in\n        // practice, they will be ordered as listed above.\n        const sortedButtonSets = _.sortBy(this.props.sets, setName => _.keys(buttonSets).indexOf(setName)\n        );\n\n        const buttons = sortedButtonSets.map(setName => buttonSets[setName]);\n\n        const buttonRows = buttons.map(row => row.map(symbGen => {\n            // create a (component, thing we should send to mathquill) pair\n            const symbol = symbGen(this.props);\n            return (\n                <button\n                    onClick={() => this.props.onInsert(symbol[1])}\n                    className=\"tex-button\"\n                    key={symbol[0].key}\n                    tabIndex={-1}\n                    type=\"button\"\n                >\n                    {symbol[0]}\n                </button>\n            );\n        })\n        );\n\n        const buttonPopup = buttonRows.map((row, i) => {\n            return (\n                <div\n                    className=\"clearfix tex-button-row\"\n                    key={this.props.sets[i]}\n                >\n                    {row}\n                </div>\n            );\n        });\n\n        return (\n            <div className={`${this.props.className} preview-measure`}>\n                {buttonPopup}\n            </div>\n        );\n    },\n\n    statics: {\n        buttonSets,\n        buttonSetsType,\n    },\n});\n\n_module_.exports = TexButtons;\nexport default _module_.exports;\n","import _texButtonsJsx from \"./tex-buttons.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\nimport $ from \"jquery\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/prop-types, react/sort-comp */\n\nconst classNames = _classnames;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst TexButtons = _texButtonsJsx;\n\n// TODO(alex): Package MathQuill\nconst MathQuill = window.MathQuill;\nconst PT = PropTypes;\n\n// A WYSIWYG math input that calls `onChange(LaTeX-string)`\nconst MathInput = createReactClass({\n    propTypes: {\n        value: PT.string,\n        onChange: PT.func.isRequired,\n        convertDotToTimes: PT.bool,\n        buttonsVisible: PT.oneOf([\"always\", \"never\", \"focused\"]),\n        buttonSets: TexButtons.buttonSetsType.isRequired,\n        labelText: PropTypes.string,\n        onFocus: PT.func,\n        onBlur: PT.func,\n    },\n\n    render: function() {\n        let className = classNames({\n            \"perseus-math-input\": true,\n\n            // mathquill usually adds these itself but react removes them when\n            // updating the component.\n            \"mq-editable-field\": true,\n            \"mq-math-mode\": true,\n        });\n\n        if (this.props.className) {\n            className = className + \" \" + this.props.className;\n        }\n\n        let buttons = null;\n        if (this._shouldShowButtons()) {\n            buttons = (\n                <TexButtons\n                    sets={this.props.buttonSets}\n                    className=\"math-input-buttons absolute\"\n                    convertDotToTimes={this.props.convertDotToTimes}\n                    onInsert={this.insert}\n                />\n            );\n        }\n\n        return (\n            <div style={{display: \"inline-block\"}}>\n                <div style={{display: \"inline-block\"}}>\n                    <span\n                        className={className}\n                        ref=\"mathinput\"\n                        aria-label={this.props.labelText}\n                        onFocus={this.handleFocus}\n                        onBlur={this.handleBlur}\n                    />\n                </div>\n                <div style={{position: \"relative\"}}>\n                    {buttons}\n                </div>\n            </div>\n        );\n    },\n\n    // handlers:\n    // keep track of two related bits of state:\n    // * this.state.focused - whether the buttons are currently shown\n    // * this.mouseDown - whether a mouse click is active that started in the\n    //   buttons div\n\n    handleFocus: function() {\n        this.setState({focused: true});\n        // TODO(joel) fix properly - we should probably allow onFocus handlers\n        // to this property, but we need to work correctly with them.\n        // if (this.props.onFocus) {\n        //     this.props.onFocus();\n        // }\n    },\n\n    handleMouseDown: function(event) {\n        const focused = ReactDOM.findDOMNode(this).contains(event.target);\n        this.mouseDown = focused;\n        if (!focused) {\n            this.setState({focused: false});\n        }\n    },\n\n    handleMouseUp: function() {\n        // this mouse click started in the buttons div so we should focus the\n        // input\n        if (this.mouseDown) {\n            this.focus();\n        }\n        this.mouseDown = false;\n    },\n\n    handleBlur: function() {\n        if (!this.mouseDown) {\n            this.setState({focused: false});\n        }\n    },\n\n    _shouldShowButtons: function() {\n        if (this.props.buttonsVisible === \"always\") {\n            return true;\n        } else if (this.props.buttonsVisible === \"never\") {\n            return false;\n        } else {\n            return this.state.focused;\n        }\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n            convertDotToTimes: false,\n            buttonsVisible: \"focused\",\n        };\n    },\n\n    getInitialState: function() {\n        return {focused: false};\n    },\n\n    insert: function(value) {\n        const input = this.mathField();\n        if (_.isFunction(value)) {\n            value(input);\n        } else if (value[0] === \"\\\\\") {\n            input.cmd(value).focus();\n        } else {\n            input.write(value).focus();\n        }\n        input.focus();\n    },\n\n    mathField: function(options) {\n        // The MathQuill API is now \"versioned\" through its own \"InterVer\"\n        // system.\n        // See: https://github.com/mathquill/mathquill/pull/459\n        const MQ = MathQuill.getInterface(2);\n\n        // MathQuill.MathField takes a DOM node, MathQuill-ifies it if it's\n        // seeing that node for the first time, then returns the associated\n        // MathQuill object for that node. It is stable - will always return\n        // the same object when called on the same DOM node.\n        return MQ.MathField(ReactDOM.findDOMNode(this.refs.mathinput), options);\n    },\n\n    componentWillUnmount: function() {\n        window.removeEventListener(\"mousedown\", this.handleMouseDown);\n        window.removeEventListener(\"mouseup\", this.handleMouseUp);\n    },\n\n    componentDidMount: function() {\n        window.addEventListener(\"mousedown\", this.handleMouseDown);\n        window.addEventListener(\"mouseup\", this.handleMouseUp);\n\n        let initialized = false;\n\n        // Initialize MathQuill.MathField instance\n        this.mathField({\n            // LaTeX commands that, when typed, are immediately replaced by the\n            // appropriate symbol. This does not include ln, log, or any of the\n            // trig functions; those are always interpreted as commands.\n            autoCommands: \"pi theta phi sqrt nthroot\",\n\n            // Pop the cursor out of super/subscripts on arithmetic operators\n            // or (in)equalities.\n            charsThatBreakOutOfSupSub: \"+-*/=<>\",\n\n            // Prevent excessive super/subscripts or fractions from being\n            // created without operands, e.g. when somebody holds down a key\n            supSubsRequireOperand: true,\n\n            // The name of this option is somewhat misleading, as tabbing in\n            // MathQuill breaks you out of a nested context (fraction/script)\n            // if you're in one, but moves focus to the next input if you're\n            // not. Spaces (with this option enabled) are just ignored in the\n            // latter case.\n            //\n            // TODO(alex): In order to allow inputting mixed numbers, we will\n            // have to accept spaces in certain cases. The desired behavior is\n            // still to escape nested contexts if currently in one, but to\n            // insert a space if not (we don't expect mixed numbers in nested\n            // contexts). We should also limit to one consecutive space.\n            spaceBehavesLikeTab: true,\n\n            handlers: {\n                edited: mathField => {\n                    // This handler is guaranteed to be called on change, but\n                    // unlike React it sometimes generates false positives.\n                    // One of these is on initialization (with an empty string\n                    // value), so we have to guard against that below.\n                    let value = mathField.latex();\n\n                    // Provide a MathQuill-compatible way to generate the\n                    // not-equals sign without pasting unicode or typing TeX\n                    value = value.replace(/<>/g, \"\\\\ne\");\n\n                    // Use the specified symbol to represent multiplication\n                    // TODO(alex): Add an option to disallow variables, in\n                    // which case 'x' should get converted to '\\\\times'\n                    if (this.props.convertDotToTimes) {\n                        value = value.replace(/\\\\cdot/g, \"\\\\times\");\n\n                        // Preserve cursor position in the common case:\n                        // typing '*' to insert a multiplication sign.\n                        // We do this by modifying internal MathQuill state\n                        // directly, instead of waiting for `.latex()` to be\n                        // called in `componentDidUpdate()`.\n                        const left = mathField.__controller.cursor[MathQuill.L];\n                        if (left && left.ctrlSeq === \"\\\\cdot \") {\n                            mathField.__controller.backspace();\n                            mathField.cmd(\"\\\\times\");\n                        }\n                    } else {\n                        value = value.replace(/\\\\times/g, \"\\\\cdot\");\n                    }\n\n                    if (initialized && this.props.value !== value) {\n                        this.props.onChange(value);\n                    }\n                },\n                enter: () => {\n                    // This handler is called when the user presses the enter\n                    // key. Since this isn't an actual <input> element, we have\n                    // to manually trigger the usually automatic form submit.\n                    $(ReactDOM.findDOMNode(this.refs.mathinput)).submit();\n                },\n                upOutOf: mathField => {\n                    // This handler is called when the user presses the up\n                    // arrow key, but there is nowhere in the expression to go\n                    // up to (no numerator or exponent). For ease of use,\n                    // interpret this as an attempt to create an exponent.\n                    mathField.typedText(\"^\");\n                },\n            },\n        });\n\n        // Ideally, we would be able to pass an initial value directly into\n        // the constructor above\n        this.mathField().latex(this.props.value);\n\n        initialized = true;\n    },\n\n    componentDidUpdate: function() {\n        if (!_.isEqual(this.mathField().latex(), this.props.value)) {\n            this.mathField().latex(this.props.value);\n        }\n    },\n\n    focus: function() {\n        this.mathField().focus();\n        this.setState({focused: true});\n    },\n\n    blur: function() {\n        this.mathField().blur();\n        this.setState({focused: false});\n    },\n});\n\n_module_.exports = MathInput;\nexport default _module_.exports;\n","import _componentsInlineIconJsx from \"../../components/inline-icon.jsx\";\n\nimport {\n    iconChevronDown,\n    iconChevronRight,\n    iconCircleArrowDown,\n    iconCircleArrowUp,\n    iconTrash,\n} from \"../../icon-paths.js\";\n\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n\nconst React = _react;\n\nconst InlineIcon = _componentsInlineIconJsx;\n\nclass ElementContainer extends React.Component {\n    static defaultProps = {\n        initiallyVisible: false,\n        title: \"More\",\n    };\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            show: props.initiallyVisible,\n        };\n    }\n\n    toggle = e => {\n        e.preventDefault();\n        this.setState({show: !this.state.show});\n    };\n\n    render() {\n        return (\n            <div className=\"perseus-interaction-element\">\n                <a\n                    href=\"#\"\n                    className={\n                        \"perseus-interaction-element-title \" +\n                        (this.state.show ? \"open\" : \"closed\")\n                    }\n                    onClick={this.toggle}\n                >\n                    {this.state.show\n                        ? <InlineIcon {...iconChevronDown} />\n                        : <InlineIcon {...iconChevronRight} />}\n                    {this.props.title}\n                </a>\n                <div\n                    className={\n                        \"perseus-interaction-element-content \" +\n                        (this.state.show ? \"enter\" : \"leave\")\n                    }\n                >\n                    {this.props.children}\n                    {(this.props.onUp != null ||\n                        this.props.onDown != null ||\n                        this.props.onDelete != null) &&\n                        <div className={\"edit-controls\"}>\n                            {this.props.onUp != null &&\n                                <button onClick={this.props.onUp}>\n                                    <InlineIcon {...iconCircleArrowUp} />\n                                </button>}\n                            {this.props.onDown != null &&\n                                <button onClick={this.props.onDown}>\n                                    <InlineIcon {...iconCircleArrowDown} />\n                                </button>}\n                            {this.props.onDelete != null &&\n                                <button onClick={this.props.onDelete}>\n                                    <InlineIcon {...iconTrash} />\n                                </button>}\n                        </div>}\n                </div>\n            </div>\n        );\n    }\n}\n\n_module_.exports = ElementContainer;\nexport default _module_.exports;\n","import { ChangeableProps } from \"../../mixins/changeable.jsx\";\nimport _react from \"react\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst React = _react;\n\nclass DashPicker extends React.Component {\n    static defaultProps = {\n        value: \"\",\n    };\n\n    render() {\n        return (\n            <ButtonGroup\n                value={this.props.value}\n                allowEmpty={false}\n                buttons={[\n                    {value: \"\", content: <span>&mdash;</span>},\n                    {value: \"-\", content: <span>&ndash;&ndash;&ndash;</span>},\n                    {\n                        value: \"- \",\n                        content: <span>&ndash;&nbsp;&nbsp;&ndash;</span>,\n                    },\n                    {\n                        value: \".\",\n                        content: <span>&middot;&middot;&middot;&middot;</span>,\n                    },\n                    {\n                        value: \". \",\n                        content: <span>&middot; &middot; &middot;</span>,\n                    },\n                ]}\n                onChange={this.props.onChange}\n            />\n        );\n    }\n}\n\n_module_.exports = DashPicker;\nexport default _module_.exports;\n","import _componentsNumberInputJsx from \"../../components/number-input.jsx\";\nimport _componentsMathInputJsx from \"../../components/math-input.jsx\";\nimport { ChangeableProps, change } from \"../../mixins/changeable.jsx\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n\nconst React = _react;\nconst TeX = _reactComponentsTexJsx;\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst MathInput = _componentsMathInputJsx;\nconst NumberInput = _componentsNumberInputJsx;\n\nclass ConstraintEditor extends React.Component {\n    static defaultProps = {\n        constraint: \"none\",\n        snap: 0.5,\n        constraintFn: \"0\",\n        constraintXMin: \"-10\",\n        constraintXMax: \"10\",\n        constraintYMin: \"-10\",\n        constraintYMax: \"10\",\n    };\n\n    change = (...args) => {\n        return change.apply(this, args);\n    };\n\n    render() {\n        return (\n            <div>\n                <div className=\"perseus-widget-row\">\n                    Constraint:{\" \"}\n                    <ButtonGroup\n                        value={this.props.constraint}\n                        allowEmpty={false}\n                        buttons={[\n                            {value: \"none\", content: \"None\"},\n                            {value: \"snap\", content: \"Snap\"},\n                            {value: \"x\", content: \"x=\"},\n                            {value: \"y\", content: \"y=\"},\n                        ]}\n                        onChange={this.change(\"constraint\")}\n                    />\n                </div>\n                {this.props.constraint === \"snap\" &&\n                    <div className=\"perseus-widget-row\">\n                        Snap:{\" \"}\n                        <NumberInput\n                            value={this.props.snap}\n                            placeholder={0}\n                            onChange={this.change(\"snap\")}\n                        />\n                    </div>}\n                {this.props.constraint === \"x\" &&\n                    <div className=\"graph-settings\">\n                        <div className=\"perseus-widget-row\">\n                            <TeX>x=</TeX>{\" \"}\n                            <MathInput\n                                buttonSets={[]}\n                                buttonsVisible={\"never\"}\n                                value={this.props.constraintFn}\n                                onChange={this.change(\"constraintFn\")}\n                            />\n                        </div>\n                    </div>}\n                {this.props.constraint === \"y\" &&\n                    <div className=\"graph-settings\">\n                        <div className=\"perseus-widget-row\">\n                            <TeX>y=</TeX>{\" \"}\n                            <MathInput\n                                buttonSets={[]}\n                                buttonsVisible={\"never\"}\n                                value={this.props.constraintFn}\n                                onChange={this.change(\"constraintFn\")}\n                            />\n                        </div>\n                    </div>}\n                Ensure these are set so nothing can be dragged off the canvas:\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-row\">\n                        <TeX>x \\in \\Large[</TeX>{\" \"}\n                        <MathInput\n                            buttonSets={[]}\n                            buttonsVisible={\"never\"}\n                            value={this.props.constraintXMin}\n                            onChange={this.change(\"constraintXMin\")}\n                        />\n                        <TeX>, </TeX>{\" \"}\n                        <MathInput\n                            buttonSets={[]}\n                            buttonsVisible={\"never\"}\n                            value={this.props.constraintXMax}\n                            onChange={this.change(\"constraintXMax\")}\n                        />{\" \"}\n                        <TeX>\\Large]</TeX>\n                    </div>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-row\">\n                        <TeX>y \\in \\Large[</TeX>{\" \"}\n                        <MathInput\n                            buttonSets={[]}\n                            buttonsVisible={\"never\"}\n                            value={this.props.constraintYMin}\n                            onChange={this.change(\"constraintYMin\")}\n                        />\n                        <TeX>, </TeX>{\" \"}\n                        <MathInput\n                            buttonSets={[]}\n                            buttonsVisible={\"never\"}\n                            value={this.props.constraintYMax}\n                            onChange={this.change(\"constraintYMax\")}\n                        />{\" \"}\n                        <TeX>\\Large]</TeX>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\n_module_.exports = ConstraintEditor;\nexport default _module_.exports;\n","import _utilColorsJs from \"../../util/colors.js\";\nimport { ChangeableProps } from \"../../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst React = _react;\nconst _ = _underscore;\n\nconst KhanColors = _utilColorsJs;\n\nconst COLORS = [\n    KhanColors.BLACK,\n    KhanColors.BLUE,\n    KhanColors.GREEN,\n    KhanColors.PINK,\n    KhanColors.PURPLE,\n    KhanColors.RED,\n    KhanColors.GRAY,\n];\n\nconst LIGHT_COLORS = [\n    KhanColors.LIGHT_BLUE,\n    KhanColors.LIGHT_ORANGE,\n    KhanColors.LIGHT_PINK,\n    KhanColors.LIGHT_GREEN,\n    KhanColors.LIGHT_PURPLE,\n    KhanColors.LIGHT_RED,\n    \"#fff\",\n];\n\nclass ColorPicker extends React.Component {\n    static defaultProps = {\n        value: KhanColors.BLACK,\n        lightColors: false,\n    };\n\n    render() {\n        const colors = this.props.lightColors ? LIGHT_COLORS : COLORS;\n        return (\n            <ButtonGroup\n                value={this.props.value}\n                allowEmpty={false}\n                buttons={_.map(colors, color => {\n                    return {\n                        value: color,\n                        content: (\n                            <span>\n                                <span\n                                    className=\"colorpicker-circle\"\n                                    style={{background: color}}\n                                />\n                                &nbsp;\n                            </span>\n                        ),\n                    };\n                })}\n                onChange={this.props.onChange}\n            />\n        );\n    }\n}\n\n_module_.exports = ColorPicker;\nexport default _module_.exports;\n","import { ChangeableProps } from \"../../mixins/changeable.jsx\";\nimport _react from \"react\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst React = _react;\n\nclass ArrowPicker extends React.Component {\n    static defaultProps = {\n        value: \"\",\n    };\n\n    render() {\n        return (\n            <ButtonGroup\n                value={this.props.value}\n                allowEmpty={false}\n                buttons={[\n                    {value: \"\", content: <span>&mdash;</span>},\n                    {value: \"->\", content: <span>&#x2192;</span>},\n                    /*\n                TODO(eater): fix khan-exercises so these are supported\n                {value: \"<-\", content: <span>&#x2190;</span>},\n                {value: \"<->\", content: <span>&#x2194;</span>}\n                */\n                ]}\n                onChange={this.props.onChange}\n            />\n        );\n    }\n}\n\n_module_.exports = ArrowPicker;\nexport default _module_.exports;\n","import _utilColorsJs from \"../util/colors.js\";\nimport _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _componentsMathInputJsx from \"../components/math-input.jsx\";\nimport _componentsGraphSettingsJsx from \"../components/graph-settings.jsx\";\nimport _interactionElementContainerJsx from \"./interaction/element-container.jsx\";\nimport _interactionDashPickerJsx from \"./interaction/dash-picker.jsx\";\nimport _interactionConstraintEditorJsx from \"./interaction/constraint-editor.jsx\";\nimport _interactionColorPickerJsx from \"./interaction/color-picker.jsx\";\nimport _interactionArrowPickerJsx from \"./interaction/arrow-picker.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable max-lines, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst ArrowPicker = _interactionArrowPickerJsx;\nconst ColorPicker = _interactionColorPickerJsx;\nconst ConstraintEditor = _interactionConstraintEditorJsx;\nconst DashPicker = _interactionDashPickerJsx;\nconst ElementContainer = _interactionElementContainerJsx;\nconst GraphSettings = _componentsGraphSettingsJsx;\nconst MathInput = _componentsMathInputJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst TeX = _reactComponentsTexJsx;\nconst TextInput = _componentsTextInputJsx;\n\nconst KhanColors = _utilColorsJs;\n\nvar defaultInteractionProps = {\n    graph: {\n        box: [400, 400],\n        labels: [\"x\", \"y\"],\n        range: [[-10, 10], [-10, 10]],\n        tickStep: [1, 1],\n        gridStep: [1, 1],\n        markings: \"graph\",\n    },\n    elements: [],\n};\n\n//\n// Editor for non-interactive points\n//\n// TODO(eater): Factor this out\n//\nconst PointEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        coordX: PropTypes.string,\n        coordY: PropTypes.string,\n        color: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            coordX: \"0\",\n            coordY: \"0\",\n            color: KhanColors.BLACK,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    Coordinate: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordX}\n                        onChange={this.change(\"coordX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordY}\n                        onChange={this.change(\"coordY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for non-interactive line segments\n//\n// TODO(eater): Factor this out\n//\nvar LineEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        startX: PropTypes.string,\n        startY: PropTypes.string,\n        endX: PropTypes.string,\n        endY: PropTypes.string,\n        color: PropTypes.string,\n        strokeDasharray: PropTypes.string,\n        arrows: PropTypes.string,\n        strokeWidth: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            startX: \"-5\",\n            startY: \"5\",\n            endX: \"5\",\n            endY: \"5\",\n            color: KhanColors.BLACK,\n            strokeDasharray: \"\",\n            arrows: \"\",\n            strokeWidth: 2,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    Start: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startX}\n                        onChange={this.change(\"startX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startY}\n                        onChange={this.change(\"startY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    End: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.endX}\n                        onChange={this.change(\"endX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.endY}\n                        onChange={this.change(\"endY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <DashPicker\n                        value={this.props.strokeDasharray}\n                        onChange={this.change(\"strokeDasharray\")}\n                    />\n                    &nbsp; &nbsp;\n                    <ArrowPicker\n                        value={this.props.arrows}\n                        onChange={this.change(\"arrows\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-left-col\">\n                        Width:{\" \"}\n                        <NumberInput\n                            value={this.props.strokeWidth}\n                            placeholder={2}\n                            onChange={this.change(\"strokeWidth\")}\n                        />\n                    </div>\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for interactive movable points\n//\n// TODO(eater): Factor this out\n// TODO(eater): Rethink how constraints are represented\n//\nvar MovablePointEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        startX: PropTypes.string,\n        startY: PropTypes.string,\n        constraint: PropTypes.string,\n        snap: PropTypes.number,\n        constraintFn: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            startX: \"0\",\n            startY: \"0\",\n            constraint: \"none\",\n            snap: 0.5,\n            constraintFn: \"0\",\n            constraintXMin: \"-10\",\n            constraintXMax: \"10\",\n            constraintYMin: \"-10\",\n            constraintYMax: \"10\",\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    Start: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startX}\n                        onChange={this.change(\"startX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startY}\n                        onChange={this.change(\"startY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Update <TeX>(x_n, y_n)</TeX> for <TeX>n =</TeX>{\" \"}\n                    <NumberInput\n                        value={this.props.varSubscript}\n                        placeholder={0}\n                        onChange={this.change(\"varSubscript\")}\n                    />\n                </div>\n                <ConstraintEditor {...this.props} />\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for interactive movable line segments\n//\n// TODO(eater): Factor this out\n// TODO(eater): Rethink how constraints are represented\n//\nvar MovableLineEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        startX: PropTypes.string,\n        startY: PropTypes.string,\n        endX: PropTypes.string,\n        endY: PropTypes.string,\n        constraint: PropTypes.string,\n        snap: PropTypes.number,\n        constraintFn: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            startX: \"-5\",\n            startY: \"5\",\n            endX: \"5\",\n            endY: \"5\",\n            constraint: \"none\",\n            snap: 0.5,\n            constraintFn: \"0\",\n            constraintXMin: \"-10\",\n            constraintXMax: \"10\",\n            constraintYMin: \"-10\",\n            constraintYMax: \"10\",\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                Initial position:\n                <div className=\"perseus-widget-row\">\n                    Start: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startX}\n                        onChange={this.change(\"startX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.startY}\n                        onChange={this.change(\"startY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    End: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.endX}\n                        onChange={this.change(\"endX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.endY}\n                        onChange={this.change(\"endY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Start updates <TeX>(x_n, y_n)</TeX> for <TeX>n =</TeX>\n                    <NumberInput\n                        value={this.props.startSubscript}\n                        placeholder={0}\n                        onChange={this.change(\"startSubscript\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    End updates <TeX>(x_m, y_m)</TeX> for <TeX>m =</TeX>\n                    <NumberInput\n                        value={this.props.endSubscript}\n                        placeholder={0}\n                        onChange={this.change(\"endSubscript\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    All constraints are applied to the start point.\n                </div>\n                <ConstraintEditor {...this.props} />\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for function plots\n//\n// TODO(eater): Factor this out\n//\nvar FunctionEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        value: PropTypes.string,\n        rangeMin: PropTypes.string,\n        rangeMax: PropTypes.string,\n        color: PropTypes.string,\n        strokeDashArray: PropTypes.string,\n        strokeWidth: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"x\",\n            rangeMin: \"-10\",\n            rangeMax: \"10\",\n            color: KhanColors.BLUE,\n            strokeDasharray: \"\",\n            strokeWidth: 2,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    <TeX>{this.props.funcName + \"(x)=\"}</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.value}\n                        onChange={this.change(\"value\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Range: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.rangeMin}\n                        onChange={this.change(\"rangeMin\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.rangeMax}\n                        onChange={this.change(\"rangeMax\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <DashPicker\n                        value={this.props.strokeDasharray}\n                        onChange={this.change(\"strokeDasharray\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-left-col\">\n                        Width:{\" \"}\n                        <NumberInput\n                            value={this.props.strokeWidth}\n                            placeholder={2}\n                            onChange={this.change(\"strokeWidth\")}\n                        />\n                    </div>\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for parametric plots\n//\n// TODO(eater): Factor this out\n//\nvar ParametricEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        x: PropTypes.string,\n        y: PropTypes.string,\n        rangeMin: PropTypes.string,\n        rangeMax: PropTypes.string,\n        color: PropTypes.string,\n        strokeDashArray: PropTypes.string,\n        strokeWidth: PropTypes.number,\n    },\n\n    getDefaultProps: function() {\n        return {\n            x: \"cos(t)\",\n            y: \"sin(t)\",\n            rangeMin: \"0\",\n            rangeMax: \"2\\\\pi\",\n            color: KhanColors.BLUE,\n            strokeDasharray: \"\",\n            strokeWidth: 2,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    <TeX>X(t) =</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.x}\n                        onChange={this.change(\"x\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <TeX>Y(t) =</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.y}\n                        onChange={this.change(\"y\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Range: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.rangeMin}\n                        onChange={this.change(\"rangeMin\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.rangeMax}\n                        onChange={this.change(\"rangeMax\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <DashPicker\n                        value={this.props.strokeDasharray}\n                        onChange={this.change(\"strokeDasharray\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <div className=\"perseus-widget-left-col\">\n                        Width:{\" \"}\n                        <NumberInput\n                            value={this.props.strokeWidth}\n                            placeholder={2}\n                            onChange={this.change(\"strokeWidth\")}\n                        />\n                    </div>\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for labels\n//\n// TODO(eater): Factor this out maybe?\n// TODO(eater): Add text direction\n//\nvar LabelEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        color: PropTypes.string,\n        coordX: PropTypes.string,\n        coordY: PropTypes.string,\n        label: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            coordX: \"0\",\n            coordY: \"0\",\n            color: KhanColors.BLACK,\n            label: \"\\\\phi\",\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    <TextInput\n                        value={this.props.label}\n                        onChange={this.change(\"label\")}\n                        style={{\n                            width: \"100%\",\n                        }}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Location: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordX}\n                        onChange={this.change(\"coordX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordY}\n                        onChange={this.change(\"coordY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n//\n// Editor for rectangles\n//\n// TODO(eater): Factor this out maybe?\n//\nvar RectangleEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        color: PropTypes.string,\n        coordX: PropTypes.string,\n        coordY: PropTypes.string,\n        height: PropTypes.string,\n        width: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            coordX: \"-5\",\n            coordY: \"5\",\n            width: \"2\",\n            height: \"3\",\n            color: KhanColors.LIGHT_BLUE,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"graph-settings\">\n                <div className=\"perseus-widget-row\">\n                    Bottom left: <TeX>\\Large(</TeX>\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordX}\n                        onChange={this.change(\"coordX\")}\n                    />\n                    <TeX>,</TeX>{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.coordY}\n                        onChange={this.change(\"coordY\")}\n                    />\n                    <TeX>\\Large)</TeX>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Width:{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.width}\n                        onChange={this.change(\"width\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    Height:{\" \"}\n                    <MathInput\n                        buttonSets={[]}\n                        buttonsVisible={\"never\"}\n                        value={this.props.height}\n                        onChange={this.change(\"height\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <ColorPicker\n                        value={this.props.color}\n                        lightColors={true}\n                        onChange={this.change(\"color\")}\n                    />\n                </div>\n                <div className=\"perseus-widget-row\">\n                    You want a border? Sorry, draw your own.\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\nvar InteractionEditor = createReactClass({\n    // TODO(eater): Make more better\n    propTypes: {\n        ...Changeable.propTypes,\n        elements: PropTypes.arrayOf(PropTypes.object),\n        graph: PropTypes.objectOf(PropTypes.any),\n    },\n\n    getDefaultProps: function() {\n        return defaultInteractionProps;\n    },\n\n    getInitialState: function() {\n        return {\n            usedVarSubscripts: this._getAllVarSubscripts(this.props.elements),\n            usedFunctionNames: this._getAllFunctionNames(this.props.elements),\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            usedVarSubscripts: this._getAllVarSubscripts(nextProps.elements),\n            usedFunctionNames: this._getAllFunctionNames(nextProps.elements),\n        });\n    },\n\n    _getAllVarSubscripts: function(elements) {\n        return _.map(\n            _.where(elements, {type: \"movable-point\"}),\n            element => element.options.varSubscript\n        )\n            .concat(\n                _.map(\n                    _.where(elements, {type: \"movable-line\"}),\n                    element => element.options.startSubscript\n                )\n            )\n            .concat(\n                _.map(\n                    _.where(elements, {type: \"movable-line\"}),\n                    element => element.options.endSubscript\n                )\n            );\n    },\n\n    _getAllFunctionNames: function(elements) {\n        return _.map(\n            _.where(elements, {type: \"function\"}),\n            element => element.options.funcName\n        );\n    },\n\n    _updateGraphProps: function(newProps) {\n        // TODO(eater): GraphSettings should name this tickStep instead\n        // of step. Grr..\n        this.change({\n            graph: _.extend(_.omit(newProps, \"step\"), {\n                tickStep: newProps.step,\n            }),\n        });\n    },\n\n    _addNewElement: function(e) {\n        var elementType = e.target.value;\n        if (elementType === \"\") {\n            return;\n        }\n        e.target.value = \"\";\n        var newElement = {\n            type: elementType,\n            key:\n                elementType +\n                \"-\" +\n                ((Math.random() * 0xffffff) << 0).toString(16),\n            options:\n                elementType === \"point\"\n                    ? _.clone(PointEditor.defaultProps)\n                    : elementType === \"line\"\n                      ? _.clone(LineEditor.defaultProps)\n                      : elementType === \"movable-point\"\n                        ? _.clone(MovablePointEditor.defaultProps)\n                        : elementType === \"movable-line\"\n                          ? _.clone(MovableLineEditor.defaultProps)\n                          : elementType === \"function\"\n                            ? _.clone(FunctionEditor.defaultProps)\n                            : elementType === \"parametric\"\n                              ? _.clone(ParametricEditor.defaultProps)\n                              : elementType === \"label\"\n                                ? _.clone(LabelEditor.defaultProps)\n                                : elementType === \"rectangle\"\n                                  ? _.clone(RectangleEditor.defaultProps)\n                                  : {},\n        };\n\n        var nextSubscript;\n        if (elementType === \"movable-point\") {\n            nextSubscript =\n                _.max([_.max(this.state.usedVarSubscripts), -1]) + 1;\n            newElement.options.varSubscript = nextSubscript;\n        } else if (elementType === \"movable-line\") {\n            nextSubscript =\n                _.max([_.max(this.state.usedVarSubscripts), -1]) + 1;\n            newElement.options.startSubscript = nextSubscript;\n            newElement.options.endSubscript = nextSubscript + 1;\n        } else if (elementType === \"function\") {\n            // TODO(eater): The 22nd function added will be {(x) since '{'\n            // comes after 'z'\n            var nextLetter = String.fromCharCode(\n                _.max([\n                    _.max(\n                        _.map(this.state.usedFunctionNames, function(c) {\n                            return c.charCodeAt(0);\n                        })\n                    ),\n                    \"e\".charCodeAt(0),\n                ]) + 1\n            );\n            newElement.options.funcName = nextLetter;\n        }\n        this.change({\n            elements: this.props.elements.concat(newElement),\n        });\n    },\n\n    _deleteElement: function(index) {\n        var element = this.props.elements[index];\n        this.change({elements: _.without(this.props.elements, element)});\n    },\n\n    _moveElementUp: function(index) {\n        var element = this.props.elements[index];\n        var newElements = _.without(this.props.elements, element);\n        newElements.splice(index - 1, 0, element);\n        this.change({elements: newElements});\n    },\n\n    _moveElementDown: function(index) {\n        var element = this.props.elements[index];\n        var newElements = _.without(this.props.elements, element);\n        newElements.splice(index + 1, 0, element);\n        this.change({elements: newElements});\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        /* eslint-disable max-len */\n        return (\n            <div className=\"perseus-widget-interaction-editor\">\n                <ElementContainer title=\"Grid settings\">\n                    <GraphSettings\n                        editableSettings={[\"canvas\", \"graph\"]}\n                        box={this.props.graph.box}\n                        labels={this.props.graph.labels}\n                        range={this.props.graph.range}\n                        step={this.props.graph.tickStep}\n                        gridStep={this.props.graph.gridStep}\n                        markings={this.props.graph.markings}\n                        onChange={this._updateGraphProps}\n                    />\n                    {this.props.graph.valid !== true &&\n                        <div>\n                            {this.props.graph.valid}\n                        </div>}\n                </ElementContainer>\n                {_.map(\n                    this.props.elements,\n                    function(element, n) {\n                        if (element.type === \"movable-point\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Movable point{\" \"}\n                                            <TeX>\n                                                {\"(x_{\" +\n                                                    element.options\n                                                        .varSubscript +\n                                                    \"}, y_{\" +\n                                                    element.options\n                                                        .varSubscript +\n                                                    \"})\"}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement.bind(this, n)}\n                                    key={element.key}\n                                >\n                                    <MovablePointEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"movable-line\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Movable line{\" \"}\n                                            <TeX>\n                                                {\"(x_{\" +\n                                                    element.options\n                                                        .startSubscript +\n                                                    \"}, y_{\" +\n                                                    element.options\n                                                        .startSubscript +\n                                                    \"})\"}\n                                            </TeX>{\" \"}\n                                            to{\" \"}\n                                            <TeX>\n                                                {\"(x_{\" +\n                                                    element.options\n                                                        .endSubscript +\n                                                    \"}, y_{\" +\n                                                    element.options\n                                                        .endSubscript +\n                                                    \"})\"}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement.bind(this, n)}\n                                    key={element.key}\n                                >\n                                    <MovableLineEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"point\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Point{\" \"}\n                                            <TeX>\n                                                {\"(\" +\n                                                    element.options.coordX +\n                                                    \", \" +\n                                                    element.options.coordY +\n                                                    \")\"}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement.bind(this, n)}\n                                    key={element.key}\n                                >\n                                    <PointEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"line\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Line{\" \"}\n                                            <TeX>\n                                                {\"(\" +\n                                                    element.options.startX +\n                                                    \", \" +\n                                                    element.options.startY +\n                                                    \")\"}\n                                            </TeX>{\" \"}\n                                            to{\" \"}\n                                            <TeX>\n                                                {\"(\" +\n                                                    element.options.endX +\n                                                    \", \" +\n                                                    element.options.endY +\n                                                    \")\"}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement.bind(this, n)}\n                                    key={element.key}\n                                >\n                                    <LineEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"function\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Function{\" \"}\n                                            <TeX>\n                                                {element.options.funcName +\n                                                    \"(x) = \" +\n                                                    element.options.value}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement}\n                                    key={element.key}\n                                >\n                                    <FunctionEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"parametric\") {\n                            return (\n                                <ElementContainer\n                                    title={<span>Parametric</span>}\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement}\n                                    key={element.key}\n                                >\n                                    <ParametricEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"label\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Label{\" \"}\n                                            <TeX>{element.options.label}</TeX>{\" \"}\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement}\n                                    key={element.key}\n                                >\n                                    <LabelEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        } else if (element.type === \"rectangle\") {\n                            return (\n                                <ElementContainer\n                                    title={\n                                        <span>\n                                            Rectangle{\" \"}\n                                            <TeX>\n                                                {\"(\" +\n                                                    element.options.coordX +\n                                                    \", \" +\n                                                    element.options.coordY +\n                                                    \")\"}\n                                            </TeX>\n                                            &nbsp;&mdash;&nbsp;\n                                            <TeX>\n                                                {element.options.width +\n                                                    \" \\\\times \" +\n                                                    element.options.height}\n                                            </TeX>\n                                        </span>\n                                    }\n                                    onUp={\n                                        n === 0\n                                            ? null\n                                            : this._moveElementUp.bind(this, n)\n                                    }\n                                    onDown={\n                                        n === this.props.elements.length - 1\n                                            ? null\n                                            : this._moveElementDown.bind(\n                                                  this,\n                                                  n\n                                              )\n                                    }\n                                    onDelete={this._deleteElement}\n                                    key={element.key}\n                                >\n                                    <RectangleEditor\n                                        {...element.options}\n                                        onChange={newProps => {\n                                            var elements = JSON.parse(\n                                                JSON.stringify(\n                                                    this.props.elements\n                                                )\n                                            );\n                                            _.extend(\n                                                elements[n].options,\n                                                newProps\n                                            );\n                                            this.change({elements: elements});\n                                        }}\n                                    />\n                                </ElementContainer>\n                            );\n                        }\n                    },\n                    this\n                )}\n                <div className=\"perseus-widget-interaction-editor-select-element\">\n                    <select onChange={this._addNewElement}>\n                        <option value=\"\">\n                            Add an element{\"\\u2026\"}\n                        </option>\n                        <option disabled>--</option>\n                        <option value=\"point\">Point</option>\n                        <option value=\"line\">Line segment</option>\n                        <option value=\"function\">Function plot</option>\n                        <option value=\"parametric\">Parametric plot</option>\n                        <option value=\"label\">Label</option>\n                        <option value=\"rectangle\">Rectangle</option>\n                        <option value=\"movable-point\">\n                            &#x2605; Movable point\n                        </option>\n                        <option value=\"movable-line\">\n                            &#x2605; Movable line segment\n                        </option>\n                    </select>\n                </div>\n            </div>\n        );\n        /* eslint-enable max-len */\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = InteractionEditor;\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport _kmath from \"kmath\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, no-redeclare, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\n\nvar Graphie = _componentsGraphieJsx;\n\nvar Label = Graphie.Label;\nvar Line = Graphie.Line;\nvar MovablePoint = Graphie.MovablePoint;\nvar MovableLine = Graphie.MovableLine;\nvar Plot = Graphie.Plot;\nvar PlotParametric = Graphie.PlotParametric;\nvar Point = Graphie.Point;\nvar Rect = Graphie.Rect;\n\nvar kvector = _kmath.vector;\n\n// Memoize KAS parsing\nvar KAShashFunc = (expr, options) => {\n    options = options || {};\n    var result = expr + \"||\" + options.decimal_separatpr + \"||\";\n    var functions = options.functions;\n    var functionsLength = functions ? functions.length : 0;\n    for (var i = 0; i < functionsLength; i++) {\n        result += functions[i] + \"|\";\n    }\n    return result;\n};\n\nvar _parseCache = Object.create(null);\nvar KASparse = (expr, options) => {\n    var hash = KAShashFunc(expr, options);\n    var cached = _parseCache[hash];\n    if (cached) {\n        return cached;\n    }\n    cached = KAS.parse(expr, options);\n    _parseCache[hash] = cached;\n    return cached;\n};\n\nvar _compileCache = Object.create(null);\nvar KAScompile = (expr, options) => {\n    var hash = KAShashFunc(expr, options);\n    var cached = _compileCache[hash];\n    if (cached) {\n        return cached;\n    }\n    var parsed = KAS.parse(expr, options).expr;\n    cached = parsed\n        ? parsed.compile()\n        : function() {\n            return 0;\n        };\n    _compileCache[hash] = cached;\n    return cached;\n};\n\nvar defaultInteractionProps = {\n    graph: {\n        box: [400, 400],\n        labels: [\"x\", \"y\"],\n        range: [[-10, 10], [-10, 10]],\n        tickStep: [1, 1],\n        gridStep: [1, 1],\n        markings: \"graph\",\n    },\n    elements: [],\n};\n\nvar Interaction = createReactClass({\n    // TODO(eater): Make more better\n    propTypes: {\n        ...Changeable.propTypes,\n        graph: PropTypes.object,\n        elements: PropTypes.arrayOf(PropTypes.object),\n    },\n\n    getDefaultProps: function() {\n        return defaultInteractionProps;\n    },\n\n    getInitialState: function() {\n        return {\n            variables: this._getInitialVariables(this.props.elements),\n            functions: this._getInitialFunctions(this.props.elements),\n        };\n    },\n\n    _getInitialVariables: function(elements) {\n        var variables = {};\n        // TODO(eater): look at all this copypasta! refactor this!\n        _.each(\n            _.where(elements, {type: \"movable-point\"}),\n            function(element) {\n                var subscript = element.options.varSubscript;\n                var startXExpr = KASparse(element.options.startX || \"0\").expr;\n                var startYExpr = KASparse(element.options.startY || \"0\").expr;\n                var startX = 0;\n                var startY = 0;\n                if (startXExpr) {\n                    startX = startXExpr.eval({}) || 0;\n                }\n                if (startYExpr) {\n                    startY = startYExpr.eval({}) || 0;\n                }\n                variables[\"x_\" + subscript] = startX;\n                variables[\"y_\" + subscript] = startY;\n            },\n            this\n        );\n        _.each(\n            _.where(elements, {type: \"movable-line\"}),\n            function(element) {\n                var startSubscript = element.options.startSubscript;\n                var endSubscript = element.options.endSubscript;\n                var startXExpr = KASparse(element.options.startX || \"0\").expr;\n                var startYExpr = KASparse(element.options.startY || \"0\").expr;\n                var endXExpr = KASparse(element.options.endX || \"0\").expr;\n                var endYExpr = KASparse(element.options.endY || \"0\").expr;\n                var startX = 0;\n                var startY = 0;\n                var endX = 0;\n                var endY = 0;\n                if (startXExpr) {\n                    startX = startXExpr.eval({}) || 0;\n                }\n                if (startYExpr) {\n                    startY = startYExpr.eval({}) || 0;\n                }\n                if (endXExpr) {\n                    endX = endXExpr.eval({}) || 0;\n                }\n                if (endYExpr) {\n                    endY = endYExpr.eval({}) || 0;\n                }\n                variables[\"x_\" + startSubscript] = startX;\n                variables[\"y_\" + startSubscript] = startY;\n                variables[\"x_\" + endSubscript] = endX;\n                variables[\"y_\" + endSubscript] = endY;\n            },\n            this\n        );\n        _.each(_.where(elements, {type: \"function\"}), function(element) {\n            variables[element.options.funcName] = element.options.value;\n        });\n        return variables;\n    },\n\n    _getInitialFunctions: function(elements) {\n        return _.map(\n            _.where(elements, {type: \"function\"}),\n            element => element.options.funcName\n        );\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            variables: this._getInitialVariables(nextProps.elements),\n            functions: this._getInitialFunctions(nextProps.elements),\n        });\n    },\n\n    _setupGraphie: function(graphie, options) {\n        graphie.graphInit(\n            _.extend({}, options, {\n                grid: _.contains([\"graph\", \"grid\"], this.props.graph.markings),\n                axes: _.contains([\"graph\"], this.props.graph.markings),\n                ticks: _.contains([\"graph\"], this.props.graph.markings),\n                labels: _.contains([\"graph\"], this.props.graph.markings),\n                labelFormat: function(s) {\n                    return \"\\\\small{\" + s + \"}\";\n                },\n                axisArrows: \"<->\",\n                unityLabels: false,\n            })\n        );\n        if (this.props.graph.markings === \"graph\") {\n            var labels = this.props.graph.labels;\n            var range = this.props.graph.range;\n            graphie.label([0, range[1][1]], labels[1], \"above\");\n            graphie.label([range[0][1], 0], labels[0], \"right\");\n        }\n    },\n\n    _updatePointLocation: function(subscript, coord) {\n        var variables = _.clone(this.state.variables);\n        variables[\"x_\" + subscript] = coord[0];\n        variables[\"y_\" + subscript] = coord[1];\n        this.setState({variables: variables});\n        this.props.trackInteraction();\n    },\n\n    _updateLineLocation: function(options, startCoord) {\n        var xDiff = this._eval(\n            \"(\" + options.endX + \")-(\" + options.startX + \")\"\n        );\n        var yDiff = this._eval(\n            \"(\" + options.endY + \")-(\" + options.startY + \")\"\n        );\n        var endCoord = kvector.add(startCoord, [xDiff, yDiff]);\n        var variables = _.clone(this.state.variables);\n        variables[\"x_\" + options.startSubscript] = startCoord[0];\n        variables[\"y_\" + options.startSubscript] = startCoord[1];\n        variables[\"x_\" + options.endSubscript] = endCoord[0];\n        variables[\"y_\" + options.endSubscript] = endCoord[1];\n        this.setState({variables: variables});\n        this.props.trackInteraction();\n    },\n\n    _eval: function(expression, variables) {\n        var func = KAScompile(expression, {functions: this.state.functions});\n        var compiledVars = _.extend({}, this.state.variables, variables);\n        _.each(_.keys(compiledVars), name => {\n            if (_.isString(compiledVars[name])) {\n                var func = KAScompile(compiledVars[name], {\n                    functions: this.state.functions,\n                });\n                compiledVars[name] = function(x) {\n                    return func(\n                        _.extend({}, compiledVars, {\n                            x: x,\n                        })\n                    );\n                };\n            }\n        });\n        // Default to 0 if the expression couldn't be parsed\n        return func(compiledVars) || 0;\n    },\n\n    // Return an array of all the variables in an expression\n    _extractVars: function(expr) {\n        if (expr == null) {\n            return [];\n        }\n        var vars = [];\n        _.each(\n            expr.args(),\n            function(arg) {\n                if (arg && arg.constructor.name === \"Expr\") {\n                    vars = vars.concat(this._extractVars(arg));\n                }\n            },\n            this\n        );\n\n        if (expr.name() === \"Var\") {\n            vars.push(expr.prettyPrint());\n        }\n        return vars;\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <Graphie\n                box={this.props.graph.box}\n                range={this.props.graph.range}\n                options={this.props.graph}\n                setup={this._setupGraphie}\n                setDrawingAreaAvailable={\n                    this.props.apiOptions.setDrawingAreaAvailable\n                }\n            >\n                {_.map(\n                    this.props.elements,\n                    function(element, n) {\n                        if (element.type === \"point\") {\n                            return (\n                                <Point\n                                    key={element.key}\n                                    coord={[\n                                        this._eval(element.options.coordX),\n                                        this._eval(element.options.coordY),\n                                    ]}\n                                    color={element.options.color}\n                                />\n                            );\n                        } else if (element.type === \"line\") {\n                            var start = [\n                                this._eval(element.options.startX),\n                                this._eval(element.options.startY),\n                            ];\n                            var end = [\n                                this._eval(element.options.endX),\n                                this._eval(element.options.endY),\n                            ];\n                            return (\n                                <Line\n                                    key={element.key}\n                                    start={start}\n                                    end={end}\n                                    style={{\n                                        stroke: element.options.color,\n                                        strokeWidth:\n                                            element.options.strokeWidth,\n                                        strokeDasharray:\n                                            element.options.strokeDasharray,\n                                        arrows: element.options.arrows,\n                                    }}\n                                />\n                            );\n                        } else if (element.type === \"movable-point\") {\n                            // TODO(eater): Would be nice if the constraint\n                            // system were more flexible.\n                            var constraints = [\n                                coord => {\n                                    var coordX = Math.max(\n                                        this._eval(\n                                            element.options.constraintXMin\n                                        ),\n                                        Math.min(\n                                            this._eval(\n                                                element.options.constraintXMax\n                                            ),\n                                            coord[0]\n                                        )\n                                    );\n                                    var coordY = Math.max(\n                                        this._eval(\n                                            element.options.constraintYMin\n                                        ),\n                                        Math.min(\n                                            this._eval(\n                                                element.options.constraintYMax\n                                            ),\n                                            coord[1]\n                                        )\n                                    );\n                                    return [coordX, coordY];\n                                },\n                            ];\n                            if (element.options.constraint === \"snap\") {\n                                constraints.push(\n                                    MovablePoint.constraints.snap(\n                                        element.options.snap\n                                    )\n                                );\n                            } else if (element.options.constraint === \"x\") {\n                                constraints.push(coord => {\n                                    return [\n                                        this._eval(\n                                            element.options.constraintFn,\n                                            {y: coord[1]}\n                                        ),\n                                        coord[1],\n                                    ];\n                                });\n                            } else if (element.options.constraint === \"y\") {\n                                constraints.push(coord => {\n                                    return [\n                                        coord[0],\n                                        this._eval(\n                                            element.options.constraintFn,\n                                            {x: coord[0]}\n                                        ),\n                                    ];\n                                });\n                            }\n\n                            // TODO(eater): foo_[xyz] are hacky non-props to\n                            // get the component to update when constraints\n                            // change\n                            return (\n                                <MovablePoint\n                                    key={element.key}\n                                    coord={[\n                                        this.state.variables[\n                                            \"x_\" + element.options.varSubscript\n                                        ],\n                                        this.state.variables[\n                                            \"y_\" + element.options.varSubscript\n                                        ],\n                                    ]}\n                                    constraints={constraints}\n                                    foo_x={element.options.constraint}\n                                    foo_y={element.options.constraintFn}\n                                    foo_z={element.options.snap}\n                                    onMove={_.partial(\n                                        this._updatePointLocation,\n                                        element.options.varSubscript\n                                    )}\n                                />\n                            );\n                        } else if (element.type === \"movable-line\") {\n                            // TODO(eater): Would be nice if the constraint\n                            // system were more flexible.\n                            // TODO(eater): Don't duplicate this code from\n                            // movable-point above\n                            var constraints = [\n                                coord => {\n                                    var coordX = Math.max(\n                                        this._eval(\n                                            element.options.constraintXMin\n                                        ),\n                                        Math.min(\n                                            this._eval(\n                                                element.options.constraintXMax\n                                            ),\n                                            coord[0]\n                                        )\n                                    );\n                                    var coordY = Math.max(\n                                        this._eval(\n                                            element.options.constraintYMin\n                                        ),\n                                        Math.min(\n                                            this._eval(\n                                                element.options.constraintYMax\n                                            ),\n                                            coord[1]\n                                        )\n                                    );\n                                    return [coordX, coordY];\n                                },\n                            ];\n                            if (element.options.constraint === \"snap\") {\n                                constraints.push(\n                                    MovablePoint.constraints.snap(\n                                        element.options.snap\n                                    )\n                                );\n                            } else if (element.options.constraint === \"x\") {\n                                constraints.push(coord => {\n                                    return [\n                                        this._eval(\n                                            element.options.constraintFn,\n                                            {y: coord[1]}\n                                        ),\n                                        coord[1],\n                                    ];\n                                });\n                            } else if (element.options.constraint === \"y\") {\n                                constraints.push(coord => {\n                                    return [\n                                        coord[0],\n                                        this._eval(\n                                            element.options.constraintFn,\n                                            {x: coord[0]}\n                                        ),\n                                    ];\n                                });\n                            }\n                            var start = [\n                                this.state.variables[\n                                    \"x_\" + element.options.startSubscript\n                                ],\n                                this.state.variables[\n                                    \"y_\" + element.options.startSubscript\n                                ],\n                            ];\n                            var end = [\n                                this.state.variables[\n                                    \"x_\" + element.options.endSubscript\n                                ],\n                                this.state.variables[\n                                    \"y_\" + element.options.endSubscript\n                                ],\n                            ];\n                            return (\n                                <MovableLine\n                                    key={element.key}\n                                    constraints={constraints}\n                                    onMove={_.bind(\n                                        this._updateLineLocation,\n                                        this,\n                                        element.options\n                                    )}\n                                    foo_x={element.options.constraint}\n                                    foo_y={element.options.constraintFn}\n                                    foo_z={element.options.snap}\n                                >\n                                    <MovablePoint\n                                        coord={start}\n                                        static={true}\n                                        normalStyle={{\n                                            stroke: \"none\",\n                                            fill: \"none\",\n                                        }}\n                                    />\n                                    <MovablePoint\n                                        coord={end}\n                                        static={true}\n                                        normalStyle={{\n                                            stroke: \"none\",\n                                            fill: \"none\",\n                                        }}\n                                    />\n                                </MovableLine>\n                            );\n                        } else if (element.type === \"function\") {\n                            var fn = x => {\n                                return this._eval(element.options.value, {\n                                    x: x,\n                                });\n                            };\n                            // find all the variables referenced by this\n                            // function\n                            var vars = _.without(\n                                this._extractVars(\n                                    KASparse(element.options.value).expr\n                                ),\n                                \"x\"\n                            );\n                            // and find their values, so we redraw if any\n                            // change\n                            var varValues = _.object(\n                                vars,\n                                _.map(vars, v => this.state.variables[v])\n                            );\n\n                            var range = [\n                                this._eval(\n                                    element.options.rangeMin,\n                                    this.state.variables\n                                ),\n                                this._eval(\n                                    element.options.rangeMax,\n                                    this.state.variables\n                                ),\n                            ];\n\n                            return (\n                                <Plot\n                                    key={element.key}\n                                    fn={fn}\n                                    foo_fn={element.options.value}\n                                    foo_varvalues={varValues}\n                                    range={range}\n                                    style={{\n                                        stroke: element.options.color,\n                                        strokeWidth:\n                                            element.options.strokeWidth,\n                                        strokeDasharray:\n                                            element.options.strokeDasharray,\n                                        plotPoints: 100, // TODO(eater): why\n                                                         // so slow?\n                                    }}\n                                />\n                            );\n                        } else if (element.type === \"parametric\") {\n                            var fn = t => {\n                                return [\n                                    this._eval(element.options.x, {t: t}),\n                                    this._eval(element.options.y, {t: t}),\n                                ];\n                            };\n                            // find all the variables referenced by this\n                            // function\n                            var vars = _.without(\n                                this._extractVars(\n                                    KASparse(element.options.x).expr\n                                ).concat(\n                                    this._extractVars(\n                                        KASparse(element.options.y).expr\n                                    )\n                                ),\n                                \"t\"\n                            );\n                            // and find their values, so we redraw if any change\n                            var varValues = _.object(\n                                vars,\n                                _.map(vars, v => this.state.variables[v])\n                            );\n\n                            var range = [\n                                this._eval(\n                                    element.options.rangeMin,\n                                    this.state.variables\n                                ),\n                                this._eval(\n                                    element.options.rangeMax,\n                                    this.state.variables\n                                ),\n                            ];\n\n                            return (\n                                <PlotParametric\n                                    key={element.key}\n                                    fn={fn}\n                                    foo_fnx={element.options.x}\n                                    foo_fny={element.options.y}\n                                    foo_varvalues={varValues}\n                                    range={range}\n                                    style={{\n                                        stroke: element.options.color,\n                                        strokeWidth:\n                                            element.options.strokeWidth,\n                                        strokeDasharray:\n                                            element.options.strokeDasharray,\n                                        plotPoints: 100, // TODO(eater): why\n                                                         // so slow?\n                                    }}\n                                />\n                            );\n                        } else if (element.type === \"label\") {\n                            var coord = [\n                                this._eval(element.options.coordX),\n                                this._eval(element.options.coordY),\n                            ];\n                            return (\n                                <Label\n                                    key={n + 1}\n                                    coord={coord}\n                                    text={element.options.label}\n                                    style={{\n                                        color: element.options.color,\n                                    }}\n                                />\n                            );\n                        } else if (element.type === \"rectangle\") {\n                            return (\n                                <Rect\n                                    key={n + 1}\n                                    x={this._eval(element.options.coordX)}\n                                    y={this._eval(element.options.coordY)}\n                                    width={_.max([\n                                        this._eval(element.options.width),\n                                        0,\n                                    ])}\n                                    height={_.max([\n                                        this._eval(element.options.height),\n                                        0,\n                                    ])}\n                                    style={{\n                                        stroke: \"none\",\n                                        fill: element.options.color,\n                                    }}\n                                />\n                            );\n                        }\n                    },\n                    this\n                )}\n            </Graphie>\n        );\n    },\n\n    getUserInput: function() {\n        // TODO(eater): Perhaps we want to be able to record the state of the\n        // user's interaction. Unfortunately sending all the props will\n        // probably make the attempt payload too large. So for now, don't send\n        // anything.\n        return {};\n    },\n\n    simpleValidate: function(rubric) {\n        return Interaction.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Interaction, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"interaction\",\n    displayName: \"Interaction\",\n    widget: Interaction,\n    transform: _.identity,\n    hidden: true,\n};\nexport default _module_.exports;\n","import _componentsRangeInputJsx from \"../components/range-input.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _utilJs from \"../util.js\";\nimport { iconTrash } from \"../icon-paths.js\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Util = _utilJs;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst BlurInput = _reactComponentsBlurInputJsx;\nconst Editor = _editorJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nconst RangeInput = _componentsRangeInputJsx;\n\nconst defaultBoxSize = 400;\nconst defaultRange = [0, 10];\nconst defaultBackgroundImage = {\n    url: null,\n    width: 0,\n    height: 0,\n};\n\n// Match any image URL (including \"web+graphie\" links) that is hosted by KA.\n// We're somewhat generous in our AWS URL matching\n// (\"ka-<something>.s3.amazonaws.com\") so that we don't have to update Perseus\n// every time we add a new proxied AWS bucket.\nconst INTERNALLY_HOSTED_DOMAINS =\n    \"(\" +\n    \"ka-.*.s3.amazonaws.com|\" +\n    \"(fastly|cdn).kastatic.org|\" +\n    \"khanacademy.org|\" +\n    \"kasandbox.org\" +\n    \")\";\nconst INTERNALLY_HOSTED_URL_RE = new RegExp(\n    \"^(https?|web\\\\+graphie)://[^/]*\" + INTERNALLY_HOSTED_DOMAINS\n);\n\n/**\n * Alignment option for captions, relative to specified coordinates.\n */\nvar captionAlignments = [\n    \"center\",\n    \"above\",\n    \"above right\",\n    \"right\",\n    \"below right\",\n    \"below\",\n    \"below left\",\n    \"left\",\n    \"above left\",\n];\n\nconst ImageEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    componentDidMount: function() {\n        // defer this because it can call a change handler synchronously\n        _.defer(() => {\n            var url = this.props.backgroundImage.url;\n            this.onUrlChange(url, true);\n        });\n    },\n\n    getDefaultProps: function() {\n        return {\n            title: \"\",\n            range: [defaultRange, defaultRange],\n            box: [defaultBoxSize, defaultBoxSize],\n            backgroundImage: defaultBackgroundImage,\n            labels: [],\n            alt: \"\",\n            caption: \"\",\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            backgroundImageError: \"\",\n        };\n    },\n\n    render: function() {\n        var backgroundImage = this.props.backgroundImage;\n\n        var imageSettings = (\n            <div className=\"image-settings\">\n                <div>\n                    <label>\n                        <div>\n                            Alt text:\n                            <InfoTip>\n                                This is important for screenreaders. The content\n                                of this alt text will be formatted as markdown\n                                (tables, emphasis, etc. are supported).\n                            </InfoTip>\n                        </div>\n                        <Editor\n                            apiOptions={this.props.apiOptions}\n                            content={this.props.alt}\n                            onChange={props => {\n                                if (props.content != null) {\n                                    this.change(\"alt\", props.content);\n                                }\n                            }}\n                            widgetEnabled={false}\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        <div>Caption:</div>\n                        <Editor\n                            apiOptions={this.props.apiOptions}\n                            content={this.props.caption}\n                            onChange={props => {\n                                if (props.content != null) {\n                                    this.change(\"caption\", props.content);\n                                }\n                            }}\n                            widgetEnabled={false}\n                        />\n                    </label>\n                </div>\n            </div>\n        );\n\n        var backgroundImageErrorText = (\n            <div className=\"renderer-widget-error\">\n                {this.state.backgroundImageError}\n            </div>\n        );\n\n        return (\n            <div className=\"perseus-image-editor\">\n                <label>\n                    Image url:\n                    <InfoTip>Paste an image or graphie image URL.</InfoTip>\n                    {this.state.backgroundImageError &&\n                        backgroundImageErrorText}\n                    <BlurInput\n                        value={backgroundImage.url || \"\"}\n                        style={{width: 332}}\n                        onChange={url => this.onUrlChange(url, false)}\n                    />\n                </label>\n\n                {backgroundImage.url && imageSettings}\n            </div>\n        );\n    },\n\n    _renderRowForLabel: function(label, i) {\n        return (\n            <tr key={i}>\n                <td>\n                    <RangeInput\n                        value={label.coordinates}\n                        onChange={this.onCoordinateChange.bind(this, i)}\n                    />\n                </td>\n                <td style={{verticalAlign: \"bottom\", width: \"5px\"}}>\n                    <input\n                        type=\"text\"\n                        className=\"graph-settings-axis-label\"\n                        value={label.content}\n                        onChange={this.onContentChange.bind(this, i)}\n                    />\n                </td>\n                <td>\n                    <select\n                        className=\"perseus-widget-dropdown\"\n                        value={label.alignment}\n                        onChange={this.onAlignmentChange.bind(this, i)}\n                    >\n                        {captionAlignments.map(function(alignment, i) {\n                            return (\n                                <option key={\"\" + i} value={alignment}>\n                                    {alignment}\n                                </option>\n                            );\n                        }, this)}\n                    </select>\n                </td>\n                <td>\n                    <a\n                        href=\"#\"\n                        className=\"simple-button orange delete-label\"\n                        title=\"Remove this label\"\n                        onClick={this.removeLabel.bind(this, i)}\n                    >\n                        <InlineIcon {...iconTrash} />\n                    </a>\n                </td>\n            </tr>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    removeLabel: function(labelIndex, e) {\n        e.preventDefault();\n        var labels = _.clone(this.props.labels);\n        labels.splice(labelIndex, 1);\n        this.props.onChange({labels: labels});\n    },\n\n    onCoordinateChange: function(labelIndex, newCoordinates) {\n        var labels = this.props.labels.slice();\n        labels[labelIndex] = _.extend({}, labels[labelIndex], {\n            coordinates: newCoordinates,\n        });\n        this.props.onChange({labels: labels});\n    },\n\n    onContentChange: function(labelIndex, e) {\n        var newContent = e.target.value;\n        var labels = this.props.labels.slice();\n        labels[labelIndex] = _.extend({}, labels[labelIndex], {\n            content: newContent,\n        });\n        this.props.onChange({labels: labels});\n    },\n\n    onAlignmentChange: function(labelIndex, e) {\n        var newAlignment = e.target.value;\n        var labels = this.props.labels.slice();\n        labels[labelIndex] = _.extend({}, labels[labelIndex], {\n            alignment: newAlignment,\n        });\n        this.props.onChange({labels: labels});\n    },\n\n    setUrl: function(url, width, height, silent) {\n        // Because this calls into WidgetEditor._handleWidgetChange, which\n        // checks for this widget's ref to serialize it.\n        //\n        // Errors if you switch items before the `Image` from `onUrlChange`\n        // loads.\n        if (!this.isMounted()) {\n            return;\n        }\n\n        var image = _.clone(this.props.backgroundImage);\n        image.url = url;\n        image.width = width;\n        image.height = height;\n        var box = [image.width, image.height];\n        this.props.onChange(\n            {\n                backgroundImage: image,\n                box: box,\n            },\n            null,\n            silent\n        );\n    },\n\n    // silently load the image when the component mounts\n    // silently update url and sizes when the image loads\n    // noisily load the image in response to the author changing it\n    onUrlChange: function(url, silent) {\n        // All article content must be KA-owned!\n        if (!INTERNALLY_HOSTED_URL_RE.test(url)) {\n            this.setState({\n                backgroundImageError:\n                    \"Images must be from sites hosted by Khan Academy. \" +\n                    \"Please input a Khan Academy-owned address, or use the \" +\n                    \"Add Image tool to rehost an existing image\",\n            });\n            return;\n        } else {\n            this.setState({backgroundImageError: \"\"});\n        }\n\n        // We update our background image prop after the image loads below. To\n        // avoid weirdness when we change to a very slow URL, then a much\n        // faster URL, we keep track of the URL we're trying to change to.\n        this._leadingUrl = url;\n\n        if (!url) {\n            this.setUrl(url, 0, 0, silent);\n            return;\n        }\n\n        Util.getImageSize(url, (width, height) => {\n            if (this._leadingUrl !== url) {\n                return;\n            }\n\n            this.setUrl(url, width, height, true);\n        });\n    },\n\n    onRangeChange: function(type, newRange) {\n        var range = this.props.range.slice();\n        range[type] = newRange;\n        this.props.onChange({range: range});\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = ImageEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _stylesMediaQueriesJs from \"../styles/media-queries.js\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport { baseUnitPx } from \"../styles/constants.js\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n// TODO(kevindangoor) fix these lint errors\n/*eslint-disable react/sort-comp, react/jsx-indent-props, react/prop-types,\n    react/jsx-closing-bracket-location\n*/\n\nvar classNames = _classnames;\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar Changeable = _mixinsChangeableJsx;\nconst mediaQueries = _stylesMediaQueriesJs;\nvar Renderer = _rendererJsx;\nvar SvgImage = _componentsSvgImageJsx;\n\nvar defaultBoxSize = 400;\nvar defaultRange = [0, 10];\nvar defaultBackgroundImage = {\n    url: null,\n    width: 0,\n    height: 0,\n};\n\n// NOTE(david): 2016-07-20: This widget supports the 4 alignments specified\n//     below, but we want to phase out the floating alignments in the next few\n//     weeks. So, we remove the float options from the editor interface.\nconst supportedAlignments = [\n    \"block\",\n    \"float-left\",\n    \"float-right\",\n    \"full-width\",\n];\nconst editorAlignments = [\"block\", \"full-width\"];\n\nconst DEFAULT_ALIGNMENT = \"block\";\n\nvar ImageWidget = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        alignment: PropTypes.oneOf(supportedAlignments),\n        alt: PropTypes.string,\n        apiOptions: ApiOptions.propTypes,\n        // TODO(alex): Rename to something else, e.g. \"image\", perhaps flatten\n        backgroundImage: PropTypes.shape({\n            url: PropTypes.string,\n            width: PropTypes.number,\n            height: PropTypes.number,\n        }),\n\n        box: PropTypes.arrayOf(PropTypes.number),\n\n        caption: PropTypes.string,\n\n        // TODO(alex): Convert uses of this widget's labeling functionality to\n        // SvgImage wherever possible (almost certainly requires a backfill)\n        labels: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string,\n                coordinates: PropTypes.arrayOf(PropTypes.number),\n                alignment: PropTypes.string,\n            })\n        ),\n\n        range: PropTypes.arrayOf(\n            PropTypes.arrayOf(PropTypes.number)\n        ),\n\n        title: PropTypes.string,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    statics: {\n        styles: StyleSheet.create({\n            caption: {\n                display: \"inline-block\",\n                marginTop: baseUnitPx,\n                maxWidth: 640,\n\n                [mediaQueries.lgOrSmaller]: {\n                    // TODO(david): This maxWidth is not being used because\n                    //     it's overriden by the 512px max-width we have on\n                    //     paragraphs.\n                    maxWidth: 540,\n                },\n\n                [mediaQueries.smOrSmaller]: {\n                    maxWidth: 450,\n                },\n            },\n        }),\n    },\n\n    getDefaultProps: function() {\n        return {\n            alignment: DEFAULT_ALIGNMENT,\n            title: \"\",\n            range: [defaultRange, defaultRange],\n            box: [defaultBoxSize, defaultBoxSize],\n            backgroundImage: defaultBackgroundImage,\n            labels: [],\n            alt: \"\",\n            caption: \"\",\n            linterContext: linterContextDefault,\n        };\n    },\n\n    render: function() {\n        var image;\n        var alt;\n        var {apiOptions} = this.props;\n\n        var backgroundImage = this.props.backgroundImage;\n\n        if (backgroundImage.url) {\n            image = (\n                <SvgImage\n                    src={backgroundImage.url}\n                    alt={\n                        /* alt text is formatted in a sr-only\n                               div next to the image, so we make\n                               this empty here.\n                               If there is no alt text at all,\n                               we don't put an alt attribute on\n                               the image, so that screen readers\n                               know there's something they can't\n                               read there :(.\n                               NOTE: React <=0.13 (maybe later)\n                               has a bug where it won't ever\n                               remove an attribute, so if this\n                               alt node is ever defined it's\n                               not removed. This is sort of\n                               dangerous, but we usually re-key\n                               new renderers so that they're\n                               rendered from scratch anyways,\n                               so this shouldn't be a problem\n                               in practice right now, although\n                               it will exhibit weird behaviour\n                               while editing. */\n                        this.props.alt ? \"\" : undefined\n                    }\n                    width={backgroundImage.width}\n                    height={backgroundImage.height}\n                    preloader={apiOptions.imagePreloader}\n                    extraGraphie={{\n                        box: this.props.box,\n                        range: this.props.range,\n                        labels: this.props.labels,\n                    }}\n                    trackInteraction={this.props.trackInteraction}\n                    zoomToFullSizeOnMobile={apiOptions.isMobile}\n                    constrainHeight={apiOptions.isMobile}\n                    allowFullBleed={apiOptions.isMobile}\n                />\n            );\n        }\n\n        if (this.props.alt) {\n            alt = (\n                <span className=\"perseus-sr-only\">\n                    <Renderer\n                        content={this.props.alt}\n                        apiOptions={apiOptions}\n                        linterContext={this.props.linterContext}\n                    />\n                </span>\n            );\n        }\n\n        // For mobile we combine an image's title and caption.\n        if (apiOptions.isMobile) {\n            var titleAndCaption;\n\n            if (this.props.title || this.props.caption) {\n                let title = this.props.title;\n\n                // Bold the title, and make it the first sentence of the\n                // caption.\n                if (title) {\n                    // We add a period to separate the title from the caption\n                    // (if it exists), unless the title already ends with a\n                    // punctuation symbol (whitespace ignored). Copied from\n                    // webapp: https://github.com/Khan/webapp/blob/6e930637edb65696d0749ea0f7558214aee32b4e/javascript/tutorial-shared-package/components/content-description.jsx#L80\n                    // TODO(charlie): Internationalize this check, and the\n                    // delimiter that is being inserted.\n                    if (this.props.caption && !/[.?!\"']\\s*$/.test(title)) {\n                        title += \".\";\n                    }\n\n                    title = `**${title}** `;\n                }\n\n                const className = classNames({\n                    \"perseus-image-caption\": true,\n                    \"has-title\": !!title,\n                });\n\n                // Caption is left-aligned within a container that's centered\n                // below the image, with these width constraints:\n                //\n                // 1. Size caption to width of the image on-screen.\n                // 2. ... but constrain its width to a range based on the\n                //    device to optimize readability - e.g. [320px, 450px] for\n                //    phones.\n                // 3. ... unless the image is floated, in which case we don't\n                //    want the caption to overflow the image size.\n                //\n                // TODO(david): If caption is only 1 line long, center-align\n                //     the text.\n                const alignment = this.props.alignment;\n                const isImageFullWidth =\n                    alignment === \"block\" || alignment === \"full-width\";\n\n                // This minWidth takes precedence over minWidth applied via\n                // Aphrodite.\n                const minWidth = isImageFullWidth ? null : \"0 !important\";\n\n                titleAndCaption = (\n                    <div className={className}>\n                        <div\n                            className={css(ImageWidget.styles.caption)}\n                            style={{\n                                minWidth: minWidth,\n                            }}\n                        >\n                            <Renderer\n                                content={title + this.props.caption}\n                                apiOptions={apiOptions}\n                                linterContext={this.props.linterContext}\n                            />\n                        </div>\n                    </div>\n                );\n            }\n\n            return (\n                <div className=\"perseus-image-widget\">\n                    {image}\n                    {alt}\n                    {titleAndCaption}\n                </div>\n            );\n        } else {\n            var title;\n            var caption;\n\n            if (this.props.title) {\n                title = (\n                    <div className=\"perseus-image-title\">\n                        <Renderer\n                            content={this.props.title}\n                            apiOptions={apiOptions}\n                            linterContext={this.props.linterContext}\n                        />\n                    </div>\n                );\n            }\n\n            if (this.props.caption) {\n                caption = (\n                    <div className=\"perseus-image-caption\">\n                        <Renderer\n                            content={this.props.caption}\n                            apiOptions={apiOptions}\n                            linterContext={this.props.linterContext}\n                        />\n                    </div>\n                );\n            }\n\n            return (\n                <div className=\"perseus-image-widget\">\n                    {title}\n                    {image}\n                    {alt}\n                    {caption}\n                </div>\n            );\n        }\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    getUserInput: function() {\n        return null;\n    },\n\n    simpleValidate: function(rubric) {\n        return ImageWidget.validate(this.getUserInput(), rubric);\n    },\n\n    focus: $.noop,\n});\n\n_.extend(ImageWidget, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"image\",\n    // This widget's accessibility depends on its contents: if the image has\n    // has a background but no alt text, it is not accessible\n    accessible: props => {\n        var bgImage = props.backgroundImage;\n        return !(bgImage && bgImage.url && !props.alt);\n    },\n    defaultAlignment: DEFAULT_ALIGNMENT,\n    supportedAlignments: editorAlignments,\n    displayName: \"Image\",\n    widget: ImageWidget,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst BlurInput = _reactComponentsBlurInputJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\n\n/**\n * This is used for editing a name/value pair.\n */\nconst PairEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        name: PropTypes.string,\n        value: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            name: \"\",\n            value: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <fieldset>\n                <label>\n                    Name:\n                    <BlurInput\n                        value={this.props.name}\n                        onChange={this.change(\"name\")}\n                    />\n                </label>\n                <label>\n                    Value:\n                    <BlurInput\n                        value={this.props.value}\n                        onChange={this.change(\"value\")}\n                    />\n                </label>\n            </fieldset>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n/**\n * This is used for editing a set of name/value pairs.\n */\nvar PairsEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        pairs: PropTypes.arrayOf(\n            PropTypes.shape({\n                name: PropTypes.string,\n                value: PropTypes.string,\n            })\n        ).isRequired,\n    },\n\n    render: function() {\n        var editors = _.map(this.props.pairs, (pair, i) => {\n            return (\n                <PairEditor\n                    key={i}\n                    name={pair.name}\n                    value={pair.value}\n                    onChange={this.handlePairChange.bind(this, i)}\n                />\n            );\n        });\n        return (\n            <div>\n                {editors}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handlePairChange: function(pairIndex, pair) {\n        // If they're both non empty, add a new one\n        var pairs = this.props.pairs.slice();\n        pairs[pairIndex] = pair;\n\n        var lastPair = pairs[pairs.length - 1];\n        if (lastPair.name && lastPair.value) {\n            pairs.push({name: \"\", value: \"\"});\n        }\n        this.change(\"pairs\", pairs);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n/**\n * This is the main editor for this widget, to specify all the options.\n */\nvar IframeEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            url: \"\",\n            settings: [{name: \"\", value: \"\"}],\n            width: \"400\",\n            height: \"400\",\n            allowFullScreen: false,\n            allowTopNavigation: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <div style={{fontWeight: \"bold\", textAlign: \"center\"}}>\n                    This widget is deprecated! <br />\n                    Try using the Video or CS Program widgets instead.\n                </div>\n                <label>\n                    Url or Program ID:\n                    <BlurInput\n                        name=\"url\"\n                        value={this.props.url}\n                        onChange={this.change(\"url\")}\n                    />\n                </label>\n                <br />\n                <label>\n                    Settings:\n                    <PairsEditor\n                        name=\"settings\"\n                        pairs={this.props.settings}\n                        onChange={this.handleSettingsChange}\n                    />\n                </label>\n                <br />\n                <label>\n                    Width:\n                    <BlurInput\n                        name=\"width\"\n                        value={this.props.width}\n                        onChange={this.change(\"width\")}\n                    />\n                </label>\n                <label>\n                    Height:\n                    <BlurInput\n                        name=\"height\"\n                        value={this.props.height}\n                        onChange={this.change(\"height\")}\n                    />\n                </label>\n                <PropCheckBox\n                    label=\"Allow full screen\"\n                    allowFullScreen={this.props.allowFullScreen}\n                    onChange={this.props.onChange}\n                />\n                <br />\n                <PropCheckBox\n                    label=\"Allow iframe content to redirect the page\"\n                    allowTopNavigation={this.props.allowTopNavigation}\n                    onChange={this.props.onChange}\n                />\n            </div>\n        );\n    },\n\n    handleSettingsChange: function(settings) {\n        this.change({settings: settings.pairs});\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = IframeEditor;\nexport default _module_.exports;\n","import _utilJs from \"../util.js\";\nimport _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This is an iframe widget. It is used for rendering an iframe that\n *  then communicates its state via window.postMessage\n * This is useful for embedding arbitrary visualizations/simulations with\n *  completed conditions, such as the mazes and games in Algorithms.\n * It's particularly well suited for embedding our ProcessingJS programs,\n *  but could also be used for embedding viz's hosted elsewhere.\n */\n\n/* globals KA */\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\nvar updateQueryString = _utilJs.updateQueryString;\n\n/* This renders the iframe and handles validation via window.postMessage */\nvar Iframe = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        width: PropTypes.string,\n        height: PropTypes.string,\n        url: PropTypes.string,\n        settings: PropTypes.array,\n        status: PropTypes.oneOf([\"incomplete\", \"incorrect\", \"correct\"]),\n        message: PropTypes.string,\n        allowFullScreen: PropTypes.bool,\n        allowTopNavigation: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            status: \"incomplete\",\n            // optional message\n            message: null,\n            allowFullScreen: false,\n            allowTopNavigation: false,\n        };\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    handleMessageEvent: function(e) {\n        // We receive data from the iframe that contains {passed: true/false}\n        //  and use that to set the status\n        // It could also contain an optional message\n        var data = {};\n        try {\n            data = JSON.parse(e.originalEvent.data);\n        } catch (err) {\n            return;\n        }\n\n        if (_.isUndefined(data.testsPassed)) {\n            return;\n        }\n\n        var status = data.testsPassed ? \"correct\" : \"incorrect\";\n        this.change({\n            status: status,\n            message: data.message,\n        });\n    },\n    componentDidMount: function() {\n        $(window).on(\"message\", this.handleMessageEvent);\n    },\n\n    componentWillUnmount: function() {\n        $(window).off(\"message\", this.handleMessageEvent);\n    },\n\n    render: function() {\n        var style = {\n            width: this.props.width,\n            height: this.props.height,\n        };\n        var url = this.props.url;\n\n        // If the URL doesnt start with http, it must be a program ID\n        if (url && url.length && url.indexOf(\"http\") !== 0) {\n            url =\n                \"https://www.khanacademy.org/computer-programming/program/\" +\n                url +\n                \"/embedded?buttons=no&embed=yes&editor=no&author=no\";\n            url = updateQueryString(url, \"width\", this.props.width);\n            url = updateQueryString(url, \"height\", this.props.height);\n            // Origin is used by output.js in deciding to send messages\n            url = updateQueryString(url, \"origin\", window.location.origin);\n        }\n\n        // Zero-rated users may incur data charges for viewing non-zero.ka.org\n        // resources, so we need to warn them first.\n        if (typeof KA !== \"undefined\" && KA.isZeroRated) {\n            if (url.match(/https?:\\/\\/[^\\/]*khanacademy.org/)) {\n                // Internal URLs should be rewritten to point at zero.ka.org,\n                // unless they already do so\n                if (!url.match(/zero.khanacademy.org/)) {\n                    url = url.replace(\n                        \"khanacademy.org\",\n                        \"zero.khanacademy.org\"\n                    );\n                }\n            } else {\n                // External URLs should be rewritten to point at a warning\n                // interstitial\n                url =\n                    \"/zero/external-link?context=iframe&url=\" +\n                    encodeURIComponent(url);\n            }\n        }\n\n        // Turn array of [{name: \"\", value: \"\"}] into object\n        if (this.props.settings) {\n            var settings = {};\n            _.each(this.props.settings, function(setting) {\n                if (setting.name && setting.value) {\n                    settings[setting.name] = setting.value;\n                }\n            });\n            // This becomes available to programs as Program.settings()\n            url = updateQueryString(url, \"settings\", JSON.stringify(settings));\n        }\n\n        let sandboxProperties = \"allow-same-origin allow-scripts\";\n        // TODO(scottgrant): This line is an intentional hack to retain the\n        // allow-top-navigation sandbox property. Once our LearnStorm articles\n        // have this value checked and published, this line should be removed\n        // and replaced with the conditional check below that is commented out.\n        // We don't want to break LearnStorm badges, so this will be a two-part\n        // deploy.\n        sandboxProperties += \" allow-top-navigation\";\n        // if (this.props.allowTopNavigation === true) {\n        //     sandboxProperties += \" allow-top-navigation\";\n        // }\n\n        // We sandbox the iframe so that we whitelist only the functionality\n        //  that we need. This makes it a bit safer in case some content\n        //  creator \"went wild\".\n        // http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/\n        return (\n            <iframe\n                sandbox={sandboxProperties}\n                style={style}\n                src={url}\n                allowFullScreen={this.props.allowFullScreen}\n            />\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    simpleValidate: function(rubric) {\n        return Iframe.validate(this.getUserInput(), rubric);\n    },\n});\n\n/**\n * This is the widget's grading function\n */\n_.extend(Iframe, {\n    validate: function(state, rubric) {\n        // The iframe can tell us whether it's correct or incorrect,\n        //  and pass an optional message\n        if (state.status === \"correct\") {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: state.message || null,\n            };\n        } else if (state.status === \"incorrect\") {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: state.message || null,\n            };\n        } else {\n            return {\n                type: \"invalid\",\n                message: \"Keep going, you're not there yet!\",\n            };\n        }\n    },\n});\n\n_module_.exports = {\n    name: \"iframe\",\n    displayName: \"Iframe\",\n    widget: Iframe,\n    // Let's not expose it to all content creators yet\n    hidden: true,\n};\nexport default _module_.exports;\n","import _editorJsx from \"../editor.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Changeable = _mixinsChangeableJsx;\n\nconst Editor = _editorJsx;\n\nconst GroupEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        content: PropTypes.string,\n        widgets: PropTypes.object,\n        images: PropTypes.object,\n        metadata: PropTypes.any,\n        apiOptions: ApiOptions.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            widgets: {},\n            images: {},\n            // `undefined` instead of `null` so that getDefaultProps works for\n            // `the GroupMetadataEditor`\n            metadata: undefined,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-group-editor\">\n                <div>\n                    {/* the metadata editor; used for tags on\n                    khanacademy.org */}\n                    {this._renderMetadataEditor()}\n                </div>\n                <Editor\n                    ref=\"editor\"\n                    content={this.props.content}\n                    widgets={this.props.widgets}\n                    apiOptions={this.props.apiOptions}\n                    images={this.props.images}\n                    widgetEnabled={true}\n                    immutableWidgets={false}\n                    onChange={this.props.onChange}\n                />\n            </div>\n        );\n    },\n\n    _renderMetadataEditor: function() {\n        var GroupMetadataEditor = this.props.apiOptions.GroupMetadataEditor;\n        return (\n            <GroupMetadataEditor\n                value={this.props.metadata}\n                onChange={this.change(\"metadata\")}\n            />\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function() {\n        return _.extend({}, this.refs.editor.serialize(), {\n            metadata: this.props.metadata,\n        });\n    },\n});\n\n_module_.exports = GroupEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar classNames = _classnames;\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar Changeable = _mixinsChangeableJsx;\nvar Renderer = _rendererJsx;\n\nvar Group = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        content: PropTypes.string,\n        widgets: PropTypes.object,\n        images: PropTypes.object,\n        icon: PropTypes.object,\n        reviewModeRubric: PropTypes.object,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            widgets: {},\n            images: {},\n            icon: null,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    componentDidMount: function() {\n        // TODO(marcia): See comment in render method about our cyclical\n        // numbering scheme. We force another render so that we can annotate\n        // the group with the correct number.\n        this.forceUpdate();\n    },\n\n    render: function() {\n        var apiOptions = _.extend(\n            {},\n            ApiOptions.defaults,\n            this.props.apiOptions,\n            {\n                // Api Rewriting to support correct onFocus/onBlur\n                // events for the mobile API\n                onFocusChange: (newFocus, oldFocus) => {\n                    if (oldFocus) {\n                        this.props.onBlur(oldFocus);\n                    }\n                    if (newFocus) {\n                        this.props.onFocus(newFocus);\n                    }\n                },\n            }\n        );\n\n        // Allow a problem number annotation to be added.\n        // This is cyclical and should probably be reconsidered. In order to\n        // render the annotation (\"Question 3 of 10\"), we call findWidgets to\n        // figure out our index in the list of all fellow group widgets. On\n        // first render, though, we don't exist yet in this list, and so we\n        // give ourselves number -1. To combat this, we forceUpdate in\n        // componentDidMount so that we can number ourselves properly. But,\n        // really we should have a more unidirectional flow. TODO(marcia): fix.\n        var number = _.indexOf(this.props.findWidgets(\"group\"), this);\n        var problemNumComponent = this.props.apiOptions.groupAnnotator(\n            number,\n            this.props.widgetId\n        );\n\n        // This is a little strange because the id of the widget that actually\n        // changed is going to be lost in favor of the group widget's id. The\n        // widgets prop also wasn't actually changed, and this only serves to\n        // alert our renderer (our parent) of the fact that some interaction\n        // has occurred.\n        var onInteractWithWidget = id => {\n            if (this.refs.renderer) {\n                this.change(\"widgets\", this.refs.renderer.props.widgets);\n            }\n        };\n\n        var score = this.refs.renderer && this.refs.renderer.score();\n        var isValid = score && score.type !== \"invalid\";\n        var isInvalid = score && score.type === \"invalid\";\n\n        // TODO(mdr): Widgets inside this Renderer are not discoverable through\n        //     the parent Renderer's `findWidgets` function.\n        return (\n            <div\n                className={classNames({\n                    \"perseus-group\": true,\n                    \"perseus-group-valid-answer\": isValid,\n                    \"perseus-group-invalid-answer\": isInvalid,\n                })}\n            >\n                {problemNumComponent}\n                <Renderer\n                    {...this.props}\n                    ref=\"renderer\"\n                    apiOptions={apiOptions}\n                    findExternalWidgets={this.props.findWidgets}\n                    reviewMode={!!this.props.reviewModeRubric}\n                    onInteractWithWidget={onInteractWithWidget}\n                    linterContext={this.props.linterContext}\n                />\n                {this.props.icon &&\n                    <div className=\"group-icon\">\n                        {this.props.icon}\n                    </div>}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    getUserInput: function() {\n        return this.refs.renderer.getUserInput();\n    },\n\n    getSerializedState: function() {\n        return this.refs.renderer.getSerializedState();\n    },\n\n    restoreSerializedState: function(state, callback) {\n        this.refs.renderer.restoreSerializedState(state, callback);\n        // Tell our renderer that we have no props to change\n        // (all our changes were in state):\n        return null;\n    },\n\n    simpleValidate: function(rubric) {\n        return this.refs.renderer.score();\n    },\n\n    // Mobile API:\n    getInputPaths: function() {\n        return this.refs.renderer.getInputPaths();\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        return this.refs.renderer.setInputValue(path, newValue, cb);\n    },\n\n    getAcceptableFormatsForInputPath: function(path) {\n        return this.refs.renderer.getAcceptableFormatsForInputPath(path);\n    },\n\n    /**\n     * WARNING: This is an experimental/temporary API and should not be relied\n     *     upon in production code. This function may change its behavior or\n     *     disappear without notice.\n     *\n     * This function was created to allow Renderer.getAllWidgetIds to descend\n     * into our renderer.\n     */\n    getRenderer: function() {\n        return this.refs.renderer;\n    },\n\n    focus: function() {\n        return this.refs.renderer.focus();\n    },\n\n    focusInputPath: function(path) {\n        this.refs.renderer.focusPath(path);\n    },\n\n    blurInputPath: function(path) {\n        this.refs.renderer.blurPath(path);\n    },\n\n    showRationalesForCurrentlySelectedChoices() {\n        this.refs.renderer.showRationalesForCurrentlySelectedChoices();\n    },\n});\n\nvar traverseChildWidgets = function(props, traverseRenderer) {\n    return _.extend({}, props, traverseRenderer(props));\n};\n\n_module_.exports = {\n    name: \"group\",\n    displayName: \"Group (SAT only)\",\n    widget: Group,\n    traverseChildWidgets: traverseChildWidgets,\n    hidden: false,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import { iconPlus, iconTrash } from \"../icon-paths.js\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Changeable = _mixinsChangeableJsx;\nconst Editor = _editorJsx;\nconst TextInput = _componentsTextInputJsx;\nconst InlineIcon = _componentsInlineIconJsx;\n\nconst GradedGroupEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        title: PropTypes.string,\n        content: PropTypes.string,\n        widgets: PropTypes.object,\n        images: PropTypes.object,\n        apiOptions: ApiOptions.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            title: \"\",\n            content: \"\",\n            widgets: {},\n            images: {},\n            hint: null,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handleAddHint: function() {\n        const hint = {content: \"\"};\n        this.props.onChange({hint}, () => {\n            this.refs[\"hint-editor\"].focus();\n        });\n    },\n\n    handleRemoveHint: function(i) {\n        this.props.onChange({hint: null});\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-group-editor\">\n                <div className=\"perseus-widget-row\">\n                    <label className={css(styles.title)}>\n                        Title:{\" \"}\n                        <TextInput\n                            value={this.props.title}\n                            className={css(styles.input)}\n                            onChange={this.change(\"title\")}\n                        />\n                    </label>\n                </div>\n                <Editor\n                    ref=\"editor\"\n                    content={this.props.content}\n                    widgets={this.props.widgets}\n                    apiOptions={this.props.apiOptions}\n                    images={this.props.images}\n                    widgetEnabled={true}\n                    immutableWidgets={false}\n                    onChange={this.props.onChange}\n                    warnNoPrompt={true}\n                    warnNoWidgets={true}\n                />\n                {!this.props.hint &&\n                    <button\n                        type=\"button\"\n                        style={{marginTop: 10}}\n                        className=\"add-hint simple-button orange\"\n                        onClick={this.handleAddHint}\n                    >\n                        <InlineIcon {...iconPlus} /> Add a hint\n                    </button>}\n                {this.props.hint &&\n                    <div className=\"perseus-hint-editor\">\n                        <div className={css(styles.hintsTitle)}>Hint</div>\n                        <Editor\n                            ref=\"hint-editor\"\n                            content={\n                                this.props.hint ? this.props.hint.content : \"\"\n                            }\n                            widgets={\n                                this.props.hint ? this.props.hint.widgets : {}\n                            }\n                            apiOptions={this.props.apiOptions}\n                            images={this.props.hint && this.props.hint.images}\n                            widgetEnabled={true}\n                            immutableWidgets={false}\n                            onChange={props => {\n                                // Copy all props over from the existing hint\n                                // and then add new props.\n                                this.change(\n                                    \"hint\",\n                                    Object.assign({}, this.props.hint, props)\n                                );\n                            }}\n                        />\n                        <button\n                            type=\"button\"\n                            className=\"remove-hint simple-button orange\"\n                            onClick={this.handleRemoveHint}\n                        >\n                            <InlineIcon {...iconTrash} /> Remove this hint\n                        </button>\n                    </div>}\n            </div>\n        );\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function() {\n        return {\n            title: this.props.title,\n            ...this.refs.editor.serialize(),\n            hint:\n                this.refs[\"hint-editor\"] &&\n                this.refs[\"hint-editor\"].serialize(),\n        };\n    },\n});\n\nconst styles = StyleSheet.create({\n    title: {\n        fontSize: 18,\n        fontWeight: \"bold\",\n    },\n\n    input: {\n        fontSize: 18,\n    },\n\n    hintsTitle: {\n        marginTop: 10,\n        fontSize: \"110%\",\n        fontWeight: \"bold\",\n    },\n});\n\n_module_.exports = GradedGroupEditor;\nexport default _module_.exports;\n","import _gradedGroupEditorJsx from \"./graded-group-editor.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Changeable = _mixinsChangeableJsx;\nconst GradedGroupEditor = _gradedGroupEditorJsx;\n\nconst GradedGroupSetEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        gradedGroups: PropTypes.array,\n        onChange: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps() {\n        return {\n            gradedGroups: [],\n        };\n    },\n\n    componentWillMount() {\n        this._editors = [];\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    getSaveWarnings() {\n        return [].concat(\n            ...this._editors.map(editor => editor.getSaveWarnings())\n        );\n    },\n\n    serialize() {\n        return {\n            gradedGroups: this.props.gradedGroups,\n        };\n    },\n\n    renderGroups() {\n        if (!this.props.gradedGroups) {\n            return null;\n        }\n        return this.props.gradedGroups.map((group, i) => <GradedGroupEditor\n            key={i}\n            ref={el => this._editors[i] = el}\n            {...group}\n            apiOptions={this.props.apiOptions}\n            widgetEnabled={true}\n            immutableWidgets={false}\n            onChange={data => this.change(\n                \"gradedGroups\",\n                setArrayItem(this.props.gradedGroups, i, {\n                    ...this.props.gradedGroups[i],\n                    ...data,\n                })\n            )}\n        />\n        );\n    },\n\n    addGroup() {\n        const groups = this.props.gradedGroups || [];\n        this.change(\n            \"gradedGroups\",\n            groups.concat([GradedGroupEditor.getDefaultProps()])\n        );\n    },\n\n    render() {\n        return (\n            <div className=\"perseus-group-editor\">\n                {this.renderGroups()}\n                <button onClick={this.addGroup}>Add group</button>\n            </div>\n        );\n    },\n});\n\nconst setArrayItem = (list, i, value) => [\n    ...list.slice(0, i),\n    value,\n    ...list.slice(i + 1),\n];\n\n_module_.exports = GradedGroupSetEditor;\nexport default _module_.exports;\n","import {\n    boldFontFamily,\n    gray68,\n    gray76,\n    gray85,\n    gray95,\n    kaGreen,\n    phoneMargin,\n    negativePhoneMargin,\n} from \"../styles/constants.js\";\n\nimport { iconStar, iconTryAgain } from \"../icon-paths.js\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* globals i18n */\n/**\n * Renders answer bar for mobile graded groups. [STATELESS]\n */\nconst React = _react;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst InlineIcon = _componentsInlineIconJsx;\n\nconst ANSWER_BAR_STATES = {\n    // Initial state before the question is answerable.  The user must complete\n    // each of the widgets before the answer bar becomes visible.\n    HIDDEN: Symbol(\"HIDDEN\"),\n\n    // The 'Check' button is active whenever the question is answerable or any\n    // of the input widgets have been modified after getting the answer wrong.\n    ACTIVE: Symbol(\"ACTIVE\"),\n\n    // The 'Check' button is disabled and there is no message.  This occurs when\n    // some of the widgets haven't been filled in after the has already become\n    // visible.\n    INACTIVE: Symbol(\"INACTIVE\"),\n\n    // This happens immediately after clicking 'Check' with a wrong answer.\n    // The 'Check' button is disabled and the 'Try Again' message is displayed.\n    INCORRECT: Symbol(\"INCORRECT\"),\n\n    // Final state.  This occurs after the user submits the correct answer.\n    // The widgets in this grade-group are disabled.\n    CORRECT: Symbol(\"CORRECT\"),\n};\n\nconst GradedGroupAnswerBar = createReactClass({\n    propTypes: {\n        // TODO(kevinb) update to oneOf once we update to 15.2\n        answerBarState: PropTypes.any.isRequired,\n        apiOptions: ApiOptions.propTypes,\n        onCheckAnswer: PropTypes.func.isRequired,\n\n        // The function to call when clicking \"Next question\" after correctly\n        // answering one graded group out of a set. If this is null, the\n        // \"Next question\" button will not appear.\n        onNextQuestion: PropTypes.func,\n    },\n\n    render() {\n        const {\n            apiOptions,\n            answerBarState,\n            onCheckAnswer,\n            onNextQuestion,\n        } = this.props;\n\n        const answerBarStyle = {\n            ...styles.answerBar,\n            backgroundColor:\n                answerBarState === ANSWER_BAR_STATES.CORRECT ? gray95 : \"white\",\n            // Center the \"Correct!\" message only when there's no next question\n            justifyContent:\n                answerBarState === ANSWER_BAR_STATES.CORRECT && !onNextQuestion\n                    ? \"center\"\n                    : \"space-between\",\n        };\n\n        const buttonStyle = {\n            ...styles.button,\n            // \"Check\" and \"Next question\" buttons should both be green\n            backgroundColor:\n                answerBarState === ANSWER_BAR_STATES.ACTIVE ||\n                answerBarState === ANSWER_BAR_STATES.CORRECT\n                    ? kaGreen\n                    : gray85,\n        };\n\n        const textStyle = {\n            ...styles.text,\n            color:\n                answerBarState === ANSWER_BAR_STATES.CORRECT ? kaGreen : gray68,\n        };\n\n        const message =\n            answerBarState === ANSWER_BAR_STATES.INCORRECT\n                ? <span style={textStyle}>\n                      <span style={styles.tryAgainIcon}>\n                          <InlineIcon {...iconTryAgain} />\n                      </span>\n                      <span style={{marginLeft: 8}}>\n                          {i18n._(\"Keep trying\")}\n                      </span>\n                  </span>\n                : <span />; // empty span keeps the button on the right side\n\n        if (answerBarState !== ANSWER_BAR_STATES.CORRECT) {\n            const buttonLabel =\n                answerBarState === ANSWER_BAR_STATES.INCORRECT\n                    ? i18n._(\"Try again\")\n                    : i18n._(\"Check\");\n\n            // Use <button> instead of <input> b/c iOS 9.3 on iPhone 6 renders\n            // the <input> as a faded out green button instead of using our\n            // styles.\n            return (\n                <div style={answerBarStyle}>\n                    {message}\n                    <button\n                        style={buttonStyle}\n                        disabled={\n                            apiOptions.readOnly ||\n                            answerBarState !== ANSWER_BAR_STATES.ACTIVE\n                        }\n                        onClick={onCheckAnswer}\n                    >\n                        {buttonLabel}\n                    </button>\n                </div>\n            );\n        } else {\n            return (\n                <div style={answerBarStyle}>\n                    <span style={textStyle}>\n                        <span style={{fontSize: 28, color: \"#FFB300\"}}>\n                            <InlineIcon\n                                {...iconStar}\n                                style={{marginBottom: 5}}\n                            />\n                        </span>\n                        <span style={{marginLeft: 8}}>\n                            {i18n._(\"Correct!\")}\n                        </span>\n                    </span>\n                    {onNextQuestion &&\n                        <button style={buttonStyle} onClick={onNextQuestion}>\n                            {i18n._(\"Next question\")}\n                        </button>}\n                </div>\n            );\n        }\n    },\n});\n\nconst fontSize = 17;\n\nconst styles = {\n    answerBar: {\n        display: \"flex\",\n        alignItems: \"center\",\n        height: 68, // so that we don't have calculate the vertical padding\n        marginLeft: negativePhoneMargin,\n        marginRight: negativePhoneMargin,\n        marginBottom: negativePhoneMargin,\n        marginTop: phoneMargin,\n        paddingLeft: phoneMargin,\n        paddingRight: 10,\n        borderTop: `1px solid ${gray76}`,\n    },\n\n    // TODO(kevinb) figure out a way inject styles/components from webapp\n    button: {\n        height: 48,\n        width: 143,\n        borderRadius: 4,\n        color: \"white\",\n        fontFamily: boldFontFamily,\n        fontSize: fontSize,\n        border: \"none\",\n    },\n\n    tryAgainIcon: {\n        fontSize: 28,\n        color: \"#63D9EA\",\n        transform: \"scale(-1,1) rotate(-268deg)\",\n    },\n\n    text: {\n        display: \"flex\",\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        fontFamily: boldFontFamily,\n        fontSize: fontSize,\n    },\n};\n\nGradedGroupAnswerBar.ANSWER_BAR_STATES = ANSWER_BAR_STATES;\n\n_module_.exports = GradedGroupAnswerBar;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport { gray76, phoneMargin, negativePhoneMargin, tableBackgroundAccent, kaGreen } from \"../styles/constants.js\";\nimport _gradedGroupAnswerBarJsx from \"./graded-group-answer-bar.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport { iconOk, iconRemove } from \"../icon-paths.js\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n/* globals i18n */\nconst classNames = _classnames;\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Changeable = _mixinsChangeableJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nconst Renderer = _rendererJsx;\nconst GradedGroupAnswerBar = _gradedGroupAnswerBarJsx;\n\n// A Graded Group is more or less a Group widget that displays a check\n// answer button below the rendered content. When clicked, the widget grades\n// the stuff inside and displays feedback about whether the inputted answer was\n// correct or not.\n\nconst GRADING_STATUSES = {\n    ungraded: \"ungraded\",\n    correct: \"correct\",\n    incorrect: \"incorrect\",\n    invalid: \"invalid\",\n};\n\nconst ANSWER_BAR_STATES = GradedGroupAnswerBar.ANSWER_BAR_STATES;\n\n// Update answer bar state based on current state and whether the question is\n// answerable (all parts have been filled out) or not.\nconst getNextState = (currentState, answerable) => {\n    switch (currentState) {\n        case ANSWER_BAR_STATES.HIDDEN:\n            return answerable ? ANSWER_BAR_STATES.ACTIVE : currentState;\n        case ANSWER_BAR_STATES.ACTIVE:\n            return !answerable ? ANSWER_BAR_STATES.INACTIVE : currentState;\n        case ANSWER_BAR_STATES.INACTIVE:\n            return answerable ? ANSWER_BAR_STATES.ACTIVE : currentState;\n        case ANSWER_BAR_STATES.INCORRECT:\n            return answerable\n                ? ANSWER_BAR_STATES.ACTIVE\n                : ANSWER_BAR_STATES.INACTIVE;\n        default:\n            return currentState;\n    }\n};\n\n// Prepended to all invalid messages to make the widget messages a bit clearer\nconst INVALID_MESSAGE_PREFIX = \"We couldn't grade your answer.\";\nconst DEFAULT_INVALID_MESSAGE =\n    \"It looks like you left something blank or \" +\n    \"entered in an invalid answer.\";\n\nconst GradedGroup = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        content: PropTypes.string,\n        hasHint: PropTypes.bool,\n        hint: PropTypes.object,\n        images: PropTypes.object,\n        inGradedGroupSet: PropTypes.bool,\n        onBlur: PropTypes.func,\n        onFocus: PropTypes.func,\n\n        // The function to call when clicking \"Next question\" after correctly\n        // answering one graded group out of a set. If this is null, the\n        // \"Next question\" button will not appear.\n        onNextQuestion: PropTypes.func,\n\n        title: PropTypes.string,\n        trackInteraction: PropTypes.func.isRequired,\n        widgets: PropTypes.object,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            title: \"\",\n            content: \"\",\n            widgets: {},\n            images: {},\n            hint: null,\n            hasHint: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            status: GRADING_STATUSES.ungraded,\n            showHint: false,\n            message: \"\",\n            answerBarState: ANSWER_BAR_STATES.HIDDEN,\n        };\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n        return nextProps !== this.props || nextState !== this.state;\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    // This is a little strange because the id of the widget that actually\n    // changed is going to be lost in favor of the group widget's id. The\n    // widgets prop also wasn't actually changed, and this only serves to\n    // alert our renderer (our parent) of the fact that some interaction\n    // has occurred.\n    _onInteractWithWidget: function(id) {\n        // Reset grading display when user changes answer\n        this.setState({\n            status: GRADING_STATUSES.ungraded,\n            message: \"\",\n        });\n\n        if (this.refs.renderer) {\n            this.change(\"widgets\", this.props.widgets);\n            const emptyWidgets = this.refs.renderer.emptyWidgets();\n            const answerable = emptyWidgets.length === 0;\n            const answerBarState = this.state.answerBarState;\n            this.setState({\n                answerBarState: getNextState(answerBarState, answerable),\n            });\n        }\n    },\n\n    _checkAnswer: function() {\n        this.refs.renderer.showRationalesForCurrentlySelectedChoices();\n        const score = this.refs.renderer.score();\n\n        let status;\n        let message;\n        if (score.type === \"points\") {\n            status =\n                score.total === score.earned\n                    ? GRADING_STATUSES.correct\n                    : GRADING_STATUSES.incorrect;\n            message = score.message || \"\";\n        } else {\n            // score.type is \"invalid\"\n            status = GRADING_STATUSES.invalid;\n            message = score.message\n                ? `${INVALID_MESSAGE_PREFIX} ${score.message}`\n                : `${INVALID_MESSAGE_PREFIX} ${DEFAULT_INVALID_MESSAGE}`;\n        }\n\n        this.setState({\n            status: status,\n            message: message,\n            // TODO(kevinb) handle 'invalid' status\n            answerBarState:\n                status === \"correct\"\n                    ? ANSWER_BAR_STATES.CORRECT\n                    : ANSWER_BAR_STATES.INCORRECT,\n        });\n\n        this.props.trackInteraction({\n            status: status,\n        });\n    },\n\n    // Mobile API\n    getInputPaths: function() {\n        return this.refs.renderer.getInputPaths();\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        return this.refs.renderer.setInputValue(path, newValue, cb);\n    },\n\n    getAcceptableFormatsForInputPath: function(path) {\n        return this.refs.renderer.getAcceptableFormatsForInputPath(path);\n    },\n\n    focus: function() {\n        return this.refs.renderer.focus();\n    },\n\n    focusInputPath: function(path) {\n        this.refs.renderer.focusPath(path);\n    },\n\n    blurInputPath: function(path) {\n        this.refs.renderer.blurPath(path);\n    },\n\n    render: function() {\n        const apiOptions = _.extend(\n            {},\n            ApiOptions.defaults,\n            this.props.apiOptions,\n            {\n                // Api Rewriting to support correct onFocus/onBlur\n                // events for the mobile API\n                onFocusChange: (newFocus, oldFocus) => {\n                    if (oldFocus) {\n                        this.props.onBlur(oldFocus);\n                    }\n                    if (newFocus) {\n                        this.props.onFocus(newFocus);\n                    }\n                },\n            }\n        );\n\n        let icon = null;\n        // Colors are 10% darker than the colors in graded-group.less\n        if (this.state.status === GRADING_STATUSES.correct) {\n            icon = <InlineIcon {...iconOk} style={{color: \"#526f03\"}} />;\n        } else if (this.state.status === GRADING_STATUSES.incorrect) {\n            icon = <InlineIcon {...iconRemove} style={{color: \"#ff5454\"}} />;\n        }\n\n        const mobileClass = this.props.inGradedGroupSet\n            ? css(styles.gradedGroupInSet)\n            : css(styles.gradedGroup);\n\n        const classes = classNames({\n            [mobileClass]: apiOptions.isMobile,\n            \"perseus-graded-group\": true,\n            \"answer-correct\": apiOptions.isMobile\n                ? false\n                : this.state.status === GRADING_STATUSES.correct,\n            \"answer-incorrect\": apiOptions.isMobile\n                ? false\n                : this.state.status === GRADING_STATUSES.incorrect,\n        });\n\n        const {answerBarState} = this.state;\n\n        // Disabled widgets after the answer has been answered correctly to\n        // prevent a situation where the answer has been marked correct but\n        // looks incorrect because a user has modified it afterwards.\n        const isCorrect = answerBarState === ANSWER_BAR_STATES.CORRECT;\n        const readOnly =\n            apiOptions.readOnly || (apiOptions.isMobile && isCorrect);\n\n        return (\n            <div className={classes}>\n                {!!this.props.title &&\n                    <div className={css(styles.title)}>\n                        {this.props.title}\n                    </div>}\n                <Renderer\n                    {...this.props}\n                    ref=\"renderer\"\n                    apiOptions={{...apiOptions, readOnly}}\n                    onInteractWithWidget={this._onInteractWithWidget}\n                    linterContext={this.props.linterContext}\n                />\n                {!apiOptions.isMobile &&\n                    icon &&\n                    <div className=\"group-icon\">\n                        {icon}\n                    </div>}\n                {!apiOptions.isMobile &&\n                    <p>\n                        {this.state.message}\n                    </p>}\n                {!apiOptions.isMobile &&\n                    <input\n                        type=\"button\"\n                        value={i18n._(\"Check\")}\n                        className=\"simple-button\"\n                        disabled={this.props.apiOptions.readOnly}\n                        onClick={this._checkAnswer}\n                    />}\n                {!apiOptions.isMobile &&\n                    isCorrect &&\n                    this.props.onNextQuestion &&\n                    <input\n                        type=\"button\"\n                        value={i18n._(\"Next question\")}\n                        className=\"simple-button\"\n                        disabled={this.props.apiOptions.readOnly}\n                        onClick={this.props.onNextQuestion}\n                        style={{marginLeft: 5}}\n                    />}\n\n                {this.props.hint &&\n                    this.props.hint.content &&\n                    (this.state.showHint\n                        ? <div>\n                              <div\n                                  className={css(styles.explanationTitle)}\n                                  onClick={() => this.setState({showHint: false})}\n                              >\n                                  {i18n._(\"Hide explanation\")}\n                              </div>\n                              <Renderer\n                                  {...this.props.hint}\n                                  ref=\"hints-renderer\"\n                                  apiOptions={apiOptions}\n                                  linterContext={this.props.linterContext}\n                              />\n                          </div>\n                        : <div\n                            onClick={() => this.setState({showHint: true})}\n                            className={css(styles.showHintLink)}\n                        >\n                            {i18n._(\"Explain\")}\n                        </div>)}\n                {apiOptions.isMobile &&\n                    answerBarState !== ANSWER_BAR_STATES.HIDDEN &&\n                    <GradedGroupAnswerBar\n                        apiOptions={apiOptions}\n                        answerBarState={answerBarState}\n                        onCheckAnswer={this._checkAnswer}\n                        onNextQuestion={this.props.onNextQuestion}\n                    />}\n            </div>\n        );\n    },\n});\n\nconst traverseChildWidgets = function(props, traverseRenderer) {\n    return _.extend({}, props, traverseRenderer(props));\n};\n\n_module_.exports = {\n    name: \"graded-group\",\n    displayName: \"Graded group (articles only)\",\n    widget: GradedGroup,\n    traverseChildWidgets: traverseChildWidgets,\n    // TODO(aasmund): This widget should be available for articles only\n    hidden: false,\n    tracking: \"all\",\n    isLintable: true,\n};\n\nconst styles = StyleSheet.create({\n    gradedGroupInSet: {\n        // Reset a few desktop-only styles that come from graded-group.less\n        marginLeft: 0,\n        paddingLeft: 0,\n    },\n\n    gradedGroup: {\n        borderTop: `1px solid ${gray76}`,\n        borderBottom: `1px solid ${gray76}`,\n        backgroundColor: tableBackgroundAccent,\n        marginLeft: negativePhoneMargin,\n        marginRight: negativePhoneMargin,\n        paddingBottom: phoneMargin,\n        paddingLeft: phoneMargin,\n        paddingRight: phoneMargin,\n        paddingTop: 10,\n        width: \"auto\",\n    },\n\n    showHintLink: {\n        marginTop: 20,\n        color: kaGreen,\n        cursor: \"pointer\",\n    },\n\n    explanationTitle: {\n        marginTop: 20,\n        color: kaGreen,\n        marginBottom: 10,\n        cursor: \"pointer\",\n    },\n\n    title: {\n        fontSize: 12,\n        color: gray76,\n        textTransform: \"uppercase\",\n        marginBottom: 11,\n        letterSpacing: 0.8,\n    },\n});\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\n\nimport {\n    grayLight,\n    gray76,\n    tableBackgroundAccent,\n    kaGreen,\n    phoneMargin,\n    negativePhoneMargin,\n} from \"../styles/constants.js\";\n\nimport _gradedGroupJsx from \"./graded-group.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/forbid-prop-types */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Changeable = _mixinsChangeableJsx;\nconst GradedGroup = _gradedGroupJsx.widget;\n\nconst Indicators = createReactClass({\n    propTypes: {\n        currentGroup: PropTypes.number.isRequired,\n        numGroups: PropTypes.number.isRequired,\n        onChangeCurrentGroup: PropTypes.func.isRequired,\n    },\n    render() {\n        const items = [];\n        for (let i = 0; i < this.props.numGroups; i++) {\n            items.push(\n                <div\n                    key={i}\n                    className={css(\n                        styles.indicator,\n                        i === this.props.currentGroup &&\n                            styles.selectedIndicator\n                    )}\n                    onClick={() => this.props.onChangeCurrentGroup(i)}\n                />\n            );\n        }\n        return (\n            <div className={css(styles.indicatorContainer)}>\n                {items}\n            </div>\n        );\n    },\n});\n\n// TODO(jared): find a better name for this :) and for GradedGroup; the names\n// are currently a little confusing.\nconst GradedGroupSet = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        gradedGroups: PropTypes.array,\n        trackInteraction: PropTypes.func.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps() {\n        return {\n            gradedGroups: [],\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState() {\n        return {\n            currentGroup: 0,\n        };\n    },\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return nextProps !== this.props || nextState !== this.state;\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    // Mobile API\n    getInputPaths() {\n        return this._childGroup.getInputPaths();\n    },\n\n    setInputValue(path, newValue, cb) {\n        return this._childGroup.setInputValue(path, newValue, cb);\n    },\n\n    getAcceptableFormatsForInputPath(path) {\n        return this._childGroup.getAcceptableFormatsForInputPath(path);\n    },\n\n    focus() {\n        return this._childGroup.focus();\n    },\n\n    focusInputPath(path) {\n        this._childGroup.focusInputPath(path);\n    },\n\n    blurInputPath(path) {\n        this._childGroup.blurInputPath(path);\n    },\n\n    handleNextQuestion() {\n        const {currentGroup} = this.state;\n        const numGroups = this.props.gradedGroups.length;\n\n        if (currentGroup < numGroups - 1) {\n            this.setState({currentGroup: currentGroup + 1});\n        }\n    },\n\n    render() {\n        const currentGroup = this.props.gradedGroups[this.state.currentGroup];\n        if (!currentGroup) {\n            return <span>No current group...</span>;\n        }\n\n        const numGroups = this.props.gradedGroups.length;\n        const handleNextQuestion =\n            this.state.currentGroup < numGroups - 1\n                ? this.handleNextQuestion\n                : null;\n\n        return (\n            <div className={css(styles.container)}>\n                <div className={css(styles.top)}>\n                    <div className={css(styles.title)}>\n                        {currentGroup.title}\n                    </div>\n                    <div className={css(styles.spacer)} />\n                    <Indicators\n                        numGroups={numGroups}\n                        currentGroup={this.state.currentGroup}\n                        onChangeCurrentGroup={currentGroup => this.setState({currentGroup})}\n                    />\n                </div>\n                <GradedGroup\n                    key={this.state.currentGroup}\n                    ref={comp => this._childGroup = comp}\n                    {...this.props}\n                    {...currentGroup}\n                    inGradedGroupSet={true}\n                    title={null}\n                    onNextQuestion={handleNextQuestion}\n                    linterContext={this.props.linterContext}\n                />\n            </div>\n        );\n    },\n});\n\nconst traverseChildWidgets = function(props, traverseRenderer) {\n    // NOTE(jared): I have no idea how this works\n    return {\n        groups: props.gradedGroups.map(traverseRenderer),\n    };\n};\n\n_module_.exports = {\n    name: \"graded-group-set\",\n    displayName: \"Graded group set (articles only)\",\n    widget: GradedGroupSet,\n    traverseChildWidgets: traverseChildWidgets,\n    // TODO(michaelpolyak): This widget should be available for articles only\n    hidden: false,\n    tracking: \"all\",\n    isLintable: true,\n};\n\nconst styles = StyleSheet.create({\n    top: {\n        display: \"flex\",\n        flexDirection: \"row\",\n    },\n    spacer: {\n        flex: 1,\n    },\n\n    title: {\n        fontSize: 12,\n        color: gray76,\n        textTransform: \"uppercase\",\n        marginBottom: 11,\n        letterSpacing: 0.8,\n    },\n\n    indicatorContainer: {\n        display: \"flex\",\n        flexDirection: \"row\",\n    },\n\n    indicator: {\n        width: 10,\n        height: 10,\n        borderRadius: 5,\n        backgroundColor: grayLight,\n        marginLeft: 5,\n        cursor: \"pointer\",\n    },\n\n    selectedIndicator: {\n        backgroundColor: kaGreen,\n    },\n\n    container: {\n        borderTop: `1px solid ${gray76}`,\n        borderBottom: `1px solid ${gray76}`,\n        backgroundColor: tableBackgroundAccent,\n        marginLeft: negativePhoneMargin,\n        marginRight: negativePhoneMargin,\n        paddingBottom: phoneMargin,\n        paddingLeft: phoneMargin,\n        paddingRight: phoneMargin,\n        paddingTop: 10,\n        width: \"auto\",\n    },\n});\nexport default _module_.exports;\n","import _kmath from \"kmath\";\nimport _componentsGraphieJsx from \"../../components/graphie.jsx\";\nimport _utilJs from \"../../util.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, no-var, one-var, space-unary-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst _ = _underscore;\n\nconst Util = _utilJs;\nconst Graphie = _componentsGraphieJsx;\nconst Plot = Graphie.Plot;\nconst kpoint = _kmath.point;\n\nconst DEFAULT_BACKGROUND_IMAGE = {\n    url: null,\n};\n\n// TODO(charlie): These really need to go into a utility file as they're being\n// used by both interactive-graph and now grapher.\nfunction canonicalSineCoefficients(coeffs) {\n    // For a curve of the form f(x) = a * Sin(b * x - c) + d,\n    // this function ensures that a, b > 0, and c is its\n    // smallest possible positive value.\n    var amplitude = coeffs[0];\n    var angularFrequency = coeffs[1];\n    var phase = coeffs[2];\n    var verticalOffset = coeffs[3];\n\n    // Guarantee a > 0\n    if (amplitude < 0) {\n        amplitude *= -1;\n        angularFrequency *= -1;\n        phase *= -1;\n    }\n\n    var period = 2 * Math.PI;\n    // Guarantee b > 0\n    if (angularFrequency < 0) {\n        angularFrequency *= -1;\n        phase *= -1;\n        phase += period / 2;\n    }\n\n    // Guarantee c is smallest possible positive value\n    while (phase > 0) {\n        phase -= period;\n    }\n    while (phase < 0) {\n        phase += period;\n    }\n\n    return [amplitude, angularFrequency, phase, verticalOffset];\n}\n\nfunction canonicalTangentCoefficients(coeffs) {\n    // For a curve of the form f(x) = a * Tan(b * x - c) + d,\n    // this function ensures that a, b > 0, and c is its\n    // smallest possible positive value.\n    var amplitude = coeffs[0];\n    var angularFrequency = coeffs[1];\n    var phase = coeffs[2];\n    var verticalOffset = coeffs[3];\n\n    // Guarantee a > 0\n    if (amplitude < 0) {\n        amplitude *= -1;\n        angularFrequency *= -1;\n        phase *= -1;\n    }\n\n    var period = Math.PI;\n    // Guarantee b > 0\n    if (angularFrequency < 0) {\n        angularFrequency *= -1;\n        phase *= -1;\n        phase += period / 2;\n    }\n\n    // Guarantee c is smallest possible positive value\n    while (phase > 0) {\n        phase -= period;\n    }\n    while (phase < 0) {\n        phase += period;\n    }\n\n    return [amplitude, angularFrequency, phase, verticalOffset];\n}\n\nvar PlotDefaults = {\n    areEqual: function(coeffs1, coeffs2) {\n        return Util.deepEq(coeffs1, coeffs2);\n    },\n\n    Movable: Plot,\n\n    getPropsForCoeffs: function(coeffs) {\n        return {\n            fn: _.partial(this.getFunctionForCoeffs, coeffs),\n        };\n    },\n};\n\nvar Linear = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/67aaf581e6d9ef9038c10558a1f70ac21c11c9f8.png\",\n\n    defaultCoords: [[0.25, 0.75], [0.75, 0.75]],\n\n    getCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        var denom = p2[0] - p1[0];\n        var num = p2[1] - p1[1];\n\n        if (denom === 0) {\n            return;\n        }\n\n        var m = num / denom;\n        var b = p2[1] - m * p2[0];\n        return [m, b];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var m = coeffs[0],\n            b = coeffs[1];\n        return m * x + b;\n    },\n\n    getEquationString: function(coords) {\n        var coeffs = this.getCoefficients(coords);\n        var m = coeffs[0],\n            b = coeffs[1];\n        return \"y = \" + m.toFixed(3) + \"x + \" + b.toFixed(3);\n    },\n});\n\nvar Quadratic = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/e23d36e6fc29ee37174e92c9daba2a66677128ab.png\",\n\n    defaultCoords: [[0.5, 0.5], [0.75, 0.75]],\n\n    Movable: Graphie.Parabola,\n\n    getCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        // Parabola with vertex (h, k) has form: y = a * (h - k)^2 + k\n        var h = p1[0];\n        var k = p1[1];\n\n        // Use these to calculate familiar a, b, c\n        var a = (p2[1] - k) / ((p2[0] - h) * (p2[0] - h));\n        var b = -2 * h * a;\n        var c = a * h * h + k;\n\n        return [a, b, c];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return (a * x + b) * x + c;\n    },\n\n    getPropsForCoeffs: function(coeffs) {\n        return {\n            a: coeffs[0],\n            b: coeffs[1],\n            c: coeffs[2],\n        };\n    },\n\n    getEquationString: function(coords) {\n        var coeffs = this.getCoefficients(coords);\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return (\n            \"y = \" +\n            a.toFixed(3) +\n            \"x^2 + \" +\n            b.toFixed(3) +\n            \"x + \" +\n            c.toFixed(3)\n        );\n    },\n});\n\nvar Sinusoid = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/3d68e7718498475f53b206c2ab285626baf8857e.png\",\n\n    defaultCoords: [[0.5, 0.5], [0.6, 0.6]],\n\n    Movable: Graphie.Sinusoid,\n\n    getCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        var a = p2[1] - p1[1];\n        var b = Math.PI / (2 * (p2[0] - p1[0]));\n        var c = p1[0] * b;\n        var d = p1[1];\n\n        return [a, b, c, d];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2],\n            d = coeffs[3];\n        return a * Math.sin(b * x - c) + d;\n    },\n\n    getPropsForCoeffs: function(coeffs) {\n        return {\n            a: coeffs[0],\n            b: coeffs[1],\n            c: coeffs[2],\n            d: coeffs[3],\n        };\n    },\n\n    getEquationString: function(coords) {\n        var coeffs = this.getCoefficients(coords);\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2],\n            d = coeffs[3];\n        return (\n            \"y = \" +\n            a.toFixed(3) +\n            \" sin(\" +\n            b.toFixed(3) +\n            \"x - \" +\n            c.toFixed(3) +\n            \") + \" +\n            d.toFixed(3)\n        );\n    },\n\n    areEqual: function(coeffs1, coeffs2) {\n        return Util.deepEq(\n            canonicalSineCoefficients(coeffs1),\n            canonicalSineCoefficients(coeffs2)\n        );\n    },\n});\n\nvar Tangent = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/7db80d23c35214f98659fe1cf0765811c1bbfbba.png\",\n\n    defaultCoords: [[0.5, 0.5], [0.75, 0.75]],\n\n    getCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        var a = p2[1] - p1[1];\n        var b = Math.PI / (4 * (p2[0] - p1[0]));\n        var c = p1[0] * b;\n        var d = p1[1];\n\n        return [a, b, c, d];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2],\n            d = coeffs[3];\n        return a * Math.tan(b * x - c) + d;\n    },\n\n    getEquationString: function(coords) {\n        var coeffs = this.getCoefficients(coords);\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2],\n            d = coeffs[3];\n        return (\n            \"y = \" +\n            a.toFixed(3) +\n            \" sin(\" +\n            b.toFixed(3) +\n            \"x - \" +\n            c.toFixed(3) +\n            \") + \" +\n            d.toFixed(3)\n        );\n    },\n\n    areEqual: function(coeffs1, coeffs2) {\n        return Util.deepEq(\n            canonicalTangentCoefficients(coeffs1),\n            canonicalTangentCoefficients(coeffs2)\n        );\n    },\n});\n\nvar Exponential = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/9cbfad55525e3ce755a31a631b074670a5dad611.png\",\n\n    defaultCoords: [[0.5, 0.55], [0.75, 0.75]],\n\n    defaultAsymptote: [[0, 0.5], [1.0, 0.5]],\n\n    /**\n     * Add extra constraints for movement of the points or asymptote (below):\n     *   newCoord: [x, y]\n     *     The end position of the point or asymptote endpoint\n     *   oldCoord: [x, y]\n     *     The old position of the point or asymptote endpoint\n     *   coords:\n     *     An array of coordinates representing the proposed end configuration\n     *     of the plot coordinates.\n     *   asymptote:\n     *     An array of coordinates representing the proposed end configuration\n     *     of the asymptote.\n     *\n     * Return: either a coordinate (to be used as the resulting coordinate of\n     * the move) or a boolean, where `true` uses newCoord as the resulting\n     * coordinate, and `false` uses oldCoord as the resulting coordinate.\n     */\n    extraCoordConstraint: function(newCoord, oldCoord, coords, asymptote, graph) {\n        var y = _.head(asymptote)[1];\n        return _.all(coords, coord => coord[1] !== y);\n    },\n\n    extraAsymptoteConstraint: function(newCoord, oldCoord, coords, asymptote, graph) {\n        var y = newCoord[1];\n        var isValid =\n            _.all(coords, coord => coord[1] > y) ||\n            _.all(coords, coord => coord[1] < y);\n\n        if (isValid) {\n            return [oldCoord[0], y];\n        } else {\n            // Snap the asymptote as close as possible, i.e., if the user moves\n            // the mouse really quickly into an invalid region\n            var oldY = oldCoord[1];\n            var wasBelow = _.all(coords, coord => coord[1] > oldY);\n            if (wasBelow) {\n                var bottomMost = _.min(_.map(coords, coord => coord[1]));\n                return [oldCoord[0], bottomMost - graph.snapStep[1]];\n            } else {\n                var topMost = _.max(_.map(coords, coord => coord[1]));\n                return [oldCoord[0], topMost + graph.snapStep[1]];\n            }\n        }\n    },\n\n    allowReflectOverAsymptote: true,\n\n    getCoefficients: function(coords, asymptote) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        var c = _.head(asymptote)[1];\n        var b = Math.log((p1[1] - c) / (p2[1] - c)) / (p1[0] - p2[0]);\n        var a = (p1[1] - c) / Math.exp(b * p1[0]);\n        return [a, b, c];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return a * Math.exp(b * x) + c;\n    },\n\n    getEquationString: function(coords, asymptote) {\n        if (!asymptote) {\n            return null;\n        }\n        var coeffs = this.getCoefficients(coords, asymptote);\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return (\n            \"y = \" +\n            a.toFixed(3) +\n            \"e^(\" +\n            b.toFixed(3) +\n            \"x) + \" +\n            c.toFixed(3)\n        );\n    },\n});\n\nvar Logarithm = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/f6491e99d34af34d924bfe0231728ad912068dc3.png\",\n\n    defaultCoords: [[0.55, 0.5], [0.75, 0.75]],\n\n    defaultAsymptote: [[0.5, 0], [0.5, 1.0]],\n\n    extraCoordConstraint: function(newCoord, oldCoord, coords, asymptote, graph) {\n        var x = _.head(asymptote)[0];\n        return _.all(coords, coord => coord[0] !== x) &&\n        coords[0][1] !== coords[1][1];\n    },\n\n    extraAsymptoteConstraint: function(newCoord, oldCoord, coords, asymptote, graph) {\n        var x = newCoord[0];\n        var isValid =\n            _.all(coords, coord => coord[0] > x) ||\n            _.all(coords, coord => coord[0] < x);\n\n        if (isValid) {\n            return [x, oldCoord[1]];\n        } else {\n            // Snap the asymptote as close as possible, i.e., if the user moves\n            // the mouse really quickly into an invalid region\n            var oldX = oldCoord[0];\n            var wasLeft = _.all(coords, coord => coord[0] > oldX);\n            if (wasLeft) {\n                var leftMost = _.min(_.map(coords, coord => coord[0]));\n                return [leftMost - graph.snapStep[0], oldCoord[1]];\n            } else {\n                var rightMost = _.max(_.map(coords, coord => coord[0]));\n                return [rightMost + graph.snapStep[0], oldCoord[1]];\n            }\n        }\n    },\n\n    allowReflectOverAsymptote: true,\n\n    getCoefficients: function(coords, asymptote) {\n        // It's easiest to calculate the logarithm's coefficients by thinking\n        // about it as the inverse of the exponential, so we flip x and y and\n        // perform some algebra on the coefficients. This also unifies the\n        // logic between the two 'models'.\n        var flip = coord => [coord[1], coord[0]];\n        var inverseCoeffs = Exponential.getCoefficients(\n            _.map(coords, flip),\n            _.map(asymptote, flip)\n        );\n        var c = -inverseCoeffs[2] / inverseCoeffs[0];\n        var b = 1 / inverseCoeffs[0];\n        var a = 1 / inverseCoeffs[1];\n        return [a, b, c];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x, asymptote) {\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return a * Math.log(b * x + c);\n    },\n\n    getEquationString: function(coords, asymptote) {\n        if (!asymptote) {\n            return null;\n        }\n        var coeffs = this.getCoefficients(coords, asymptote);\n        var a = coeffs[0],\n            b = coeffs[1],\n            c = coeffs[2];\n        return (\n            \"y = ln(\" +\n            a.toFixed(3) +\n            \"x + \" +\n            b.toFixed(3) +\n            \") + \" +\n            c.toFixed(3)\n        );\n    },\n});\n\nvar AbsoluteValue = _.extend({}, PlotDefaults, {\n    url:\n        \"https://ka-perseus-graphie.s3.amazonaws.com/8256a630175a0cb1d11de223d6de0266daf98721.png\",\n\n    defaultCoords: [[0.5, 0.5], [0.75, 0.75]],\n\n    getCoefficients: function(coords) {\n        var p1 = coords[0];\n        var p2 = coords[1];\n\n        var denom = p2[0] - p1[0];\n        var num = p2[1] - p1[1];\n\n        if (denom === 0) {\n            return;\n        }\n\n        var m = Math.abs(num / denom);\n        if (p2[1] < p1[1]) {\n            m *= -1;\n        }\n        var horizontalOffset = p1[0];\n        var verticalOffset = p1[1];\n\n        return [m, horizontalOffset, verticalOffset];\n    },\n\n    getFunctionForCoeffs: function(coeffs, x) {\n        var m = coeffs[0],\n            horizontalOffset = coeffs[1],\n            verticalOffset = coeffs[2];\n        return m * Math.abs(x - horizontalOffset) + verticalOffset;\n    },\n\n    getEquationString: function(coords) {\n        var coeffs = this.getCoefficients(coords);\n        var m = coeffs[0],\n            horizontalOffset = coeffs[1],\n            verticalOffset = coeffs[2];\n        return (\n            \"y = \" +\n            m.toFixed(3) +\n            \"| x - \" +\n            horizontalOffset.toFixed(3) +\n            \"| + \" +\n            verticalOffset.toFixed(3)\n        );\n    },\n});\n\n/* Utility functions for dealing with graphing interfaces. */\nvar functionTypeMapping = {\n    linear: Linear,\n    quadratic: Quadratic,\n    sinusoid: Sinusoid,\n    tangent: Tangent,\n    exponential: Exponential,\n    logarithm: Logarithm,\n    absolute_value: AbsoluteValue,\n};\n\nvar allTypes = _.keys(functionTypeMapping);\n\nfunction functionForType(type) {\n    return functionTypeMapping[type];\n}\n\nvar GrapherUtil = {\n    validate: function(state, rubric) {\n        if (state.type !== rubric.correct.type) {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n\n        // We haven't moved the coords\n        if (state.coords == null) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        }\n\n        // Get new function handler for grading\n        var grader = functionForType(state.type);\n        var guessCoeffs = grader.getCoefficients(state.coords, state.asymptote);\n        var correctCoeffs = grader.getCoefficients(\n            rubric.correct.coords,\n            rubric.correct.asymptote\n        );\n\n        if (guessCoeffs == null || correctCoeffs == null) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else if (grader.areEqual(guessCoeffs, correctCoeffs)) {\n            return {\n                type: \"points\",\n                earned: 1,\n                total: 1,\n                message: null,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n\n    getEquationString: function(props) {\n        var plot = props.plot;\n        if (plot.type && plot.coords) {\n            var handler = functionForType(plot.type);\n            var result = handler.getEquationString(plot.coords, plot.asymptote);\n            return result || \"\";\n        } else {\n            return \"\";\n        }\n    },\n\n    pointsFromNormalized: function(coordsList, range, step, snapStep) {\n        var numSteps = function(range, step) {\n            return Math.floor((range[1] - range[0]) / step);\n        };\n\n        return _.map(coordsList, function(coords) {\n            var unsnappedPoint = _.map(coords, function(coord, i) {\n                var currRange = range[i];\n                var currStep = step[i];\n                var nSteps = numSteps(currRange, currStep);\n                var tick = Math.round(coord * nSteps);\n                return currRange[0] + currStep * tick;\n            });\n            // In some graphing widgets, e.g. interactive-graph, you can rely\n            // on the Graphie to handle snapping. Here, we need the points\n            // returned to already be snapped so that the plot that goes\n            // through them is correct.\n            return kpoint.roundTo(unsnappedPoint, snapStep);\n        });\n    },\n\n    maybePointsFromNormalized: function(coordsList, range, step, snapStep) {\n        if (coordsList) {\n            return this.pointsFromNormalized(coordsList, range, step, snapStep);\n        } else {\n            return coordsList;\n        }\n    },\n\n    /* Given a plot type, return the appropriate default value for a grapher\n     * widget's plot props: type, default coords, default asymptote. */\n    defaultPlotProps: function(type, graph) {\n        // The coords are null by default, to indicate that the user has not\n        // moved them from the default position, and that this widget should\n        // therefore be considered empty and ineligible for grading. The user\n        // *can* move the coords from the default position and then back if\n        // they really want to submit the default coords as their answer, but\n        // we currently don't write questions that require this.\n        //\n        // We *do* write questions in which the asymptote should be left in\n        // the default position. For this reason, we fill in the default\n        // asymptote rather than leaving it null; if the user moves the coords\n        // but not the asymptote, the widget is non-empty and eligible for\n        // grading.\n        //\n        // TODO(mattdr): Consider an updated scoring function that marks the\n        // default coords as empty *unless* they're the correct coords. This\n        // would remove this default-coords-are-always-wrong constraints on\n        // the questions we write, while still maintaining our kind behavior\n        // when users forget to update a widget... but we'd also be revealing\n        // extra information. It would be valid to always submit the default\n        // widget before even reading the question; you can't lose, but you\n        // might get a free win.\n        var model = functionForType(type);\n        var gridStep = [1, 1];\n        var snapStep = Util.snapStepFromGridStep(gridStep);\n        return {\n            type,\n            asymptote: this.maybePointsFromNormalized(\n                model.defaultAsymptote,\n                graph.range,\n                graph.step,\n                snapStep\n            ),\n            coords: null,\n        };\n    },\n\n    /* Given a list of available types, choose which to use. */\n    chooseType: _.first,\n\n    getGridAndSnapSteps: function(options, boxSize) {\n        var gridStep =\n            options.gridStep ||\n            Util.getGridStep(options.range, options.step, boxSize);\n        var snapStep = options.snapStep || Util.snapStepFromGridStep(gridStep);\n        return {\n            gridStep: gridStep,\n            snapStep: snapStep,\n        };\n    },\n};\n\nvar DEFAULT_GRAPHER_PROPS = {};\n\nDEFAULT_GRAPHER_PROPS.graph = {\n    labels: [\"x\", \"y\"],\n    range: [[-10, 10], [-10, 10]],\n    step: [1, 1],\n    backgroundImage: DEFAULT_BACKGROUND_IMAGE,\n    markings: \"graph\",\n    rulerLabel: \"\",\n    rulerTicks: 10,\n    valid: true,\n    showTooltips: false,\n};\n\nDEFAULT_GRAPHER_PROPS.plot = GrapherUtil.defaultPlotProps(\n    \"linear\",\n    DEFAULT_GRAPHER_PROPS.graph\n);\n\nDEFAULT_GRAPHER_PROPS.availableTypes = [DEFAULT_GRAPHER_PROPS.plot.type];\n\nfunction typeToButton(type) {\n    var capitalized = type.charAt(0).toUpperCase() + type.substring(1);\n    return {\n        value: type,\n        title: capitalized,\n        content: <img src={functionForType(type).url} alt={capitalized} />,\n    };\n}\n\nexport {\n    GrapherUtil,\n    allTypes,\n    typeToButton,\n    functionForType,\n    DEFAULT_GRAPHER_PROPS,\n    DEFAULT_BACKGROUND_IMAGE,\n}\nexport default {\n    GrapherUtil,\n    allTypes,\n    typeToButton,\n    functionForType,\n    DEFAULT_GRAPHER_PROPS,\n    DEFAULT_BACKGROUND_IMAGE,\n}\n","import { GrapherUtil, typeToButton, functionForType, DEFAULT_GRAPHER_PROPS } from \"./grapher/util.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport { getInteractiveBoxFromSizeClass } from \"../util/sizing-utils.js\";\nimport { interactiveSizes } from \"../styles/constants.js\";\nimport { containerSizeClassPropType } from \"../util/sizing-utils.js\";\nimport _utilColorsJs from \"../util/colors.js\";\nimport _kmath3 from \"kmath\";\nimport _kmath2 from \"kmath\";\nimport _kmath from \"kmath\";\nimport _interactive2WrappedLineJs from \"../interactive2/wrapped-line.js\";\nimport _componentsGraphieJsx from \"../components/graphie.jsx\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _utilJs from \"../util.js\";\nimport _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport _interactive2Js from \"../interactive2.js\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, indent, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Interactive2 = _interactive2Js;\nvar SvgImage = _componentsSvgImageJsx;\nvar Util = _utilJs;\nvar ButtonGroup = _reactComponentsButtonGroupJsx;\n\n/* Graphie and relevant components. */\nvar Graphie = _componentsGraphieJsx;\nvar MovablePoint = Graphie.MovablePoint;\nvar MovableLine = Graphie.MovableLine;\nconst WrappedLine = _interactive2WrappedLineJs;\n\nvar knumber = _kmath.number;\nvar kvector = _kmath2.vector;\nvar kpoint = _kmath3.point;\nconst KhanColors = _utilColorsJs;\n\n/* Mixins. */\nvar Changeable = _mixinsChangeableJsx;\n\nfunction isFlipped(newCoord, oldCoord, line) {\n    var CCW = (a, b, c) => {\n        return (b[0] - a[0]) * (c[1] - a[1]) - (c[0] - a[0]) * (b[1] - a[1]);\n    };\n    return (\n        CCW(line[0], line[1], oldCoord) > 0 !==\n        CCW(line[0], line[1], newCoord) > 0\n    );\n}\n\n/* Styles */\nvar typeSelectorStyle = {\n    padding: \"5px 5px\",\n};\n\n/* Graphing interface. */\nvar FunctionGrapher = createReactClass({\n    _coords: function(props) {\n        // Coords are usually based on props, but should fall back to the\n        // model's default whenever they're not provided (if there's a model)\n        props = props || this.props;\n        var graph = props.graph;\n        var defaultModelCoords =\n            props.model &&\n            GrapherUtil.maybePointsFromNormalized(\n                props.model.defaultCoords,\n                graph.range,\n                graph.step,\n                graph.snapStep\n            );\n        return props.coords || defaultModelCoords || null;\n    },\n\n    _asymptote: function(props) {\n        // Unlike coords, asymptotes are never null; see defaultPlotProps.\n        props = props || this.props;\n        return props.asymptote;\n    },\n\n    propTypes: {\n        ...Changeable.propTypes,\n        flexibleType: PropTypes.bool,\n        graph: PropTypes.any,\n        hideHairlines: PropTypes.func,\n        isMobile: PropTypes.bool,\n        model: PropTypes.any,\n        onChange: PropTypes.func,\n        setDrawingAreaAvailable: PropTypes.func,\n        showHairlines: PropTypes.func,\n        showTooltips: PropTypes.bool,\n        static: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            graph: {\n                range: [[-10, 10], [-10, 10]],\n                step: [1, 1],\n            },\n            coords: null,\n            asymptote: null,\n            isMobile: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        var pointForCoord = (coord, i) => {\n            return (\n                <MovablePoint\n                    key={i}\n                    coord={coord}\n                    static={this.props.static}\n                    constraints={[\n                        Interactive2.MovablePoint.constraints.bound(),\n                        Interactive2.MovablePoint.constraints.snap(),\n                        coord => {\n                            // Always enforce that this is a function\n                            var isFunction = _.all(\n                                this._coords(),\n                                (otherCoord, j) => {\n                                    return (\n                                        i === j ||\n                                        !otherCoord ||\n                                        !knumber.equal(coord[0], otherCoord[0])\n                                    );\n                                }\n                            );\n\n                            // Evaluate this criteria before per-point\n                            // constraints\n                            if (!isFunction) {\n                                return false;\n                            }\n\n                            // Specific functions have extra per-point\n                            // constraints\n                            if (\n                                this.props.model &&\n                                this.props.model.extraCoordConstraint\n                            ) {\n                                var extraConstraint = this.props.model\n                                    .extraCoordConstraint;\n                                // Calculat resulting coords and verify that\n                                // they're valid for this graph\n                                var proposedCoords = _.clone(this._coords());\n                                var oldCoord = _.clone(proposedCoords[i]);\n                                proposedCoords[i] = coord;\n                                return extraConstraint(\n                                    coord,\n                                    oldCoord,\n                                    proposedCoords,\n                                    this._asymptote(),\n                                    this.props.graph\n                                );\n                            }\n\n                            return isFunction;\n                        },\n                    ]}\n                    onMove={(newCoord, oldCoord) => {\n                        var coords;\n                        // Reflect over asymptote, if allowed\n                        var asymptote = this._asymptote();\n                        if (\n                            asymptote &&\n                            this.props.model.allowReflectOverAsymptote &&\n                            isFlipped(newCoord, oldCoord, asymptote)\n                        ) {\n                            coords = _.map(this._coords(), coord => {\n                                return kpoint.reflectOverLine(coord, asymptote);\n                            });\n                        } else {\n                            coords = _.clone(this._coords());\n                        }\n                        coords[i] = newCoord;\n                        this.props.onChange({\n                            coords: coords,\n                        });\n                    }}\n                    showHairlines={this.props.showHairlines}\n                    hideHairlines={this.props.hideHairlines}\n                    showTooltips={this.props.showTooltips}\n                    isMobile={this.props.isMobile}\n                />\n            );\n        };\n        var points = _.map(this._coords(), pointForCoord);\n        var box = this.props.graph.box;\n\n        var imageDescription = this.props.graph.backgroundImage;\n        var image = null;\n        if (imageDescription.url) {\n            var scale = box[0] / interactiveSizes.defaultBoxSize;\n            image = (\n                <SvgImage\n                    src={imageDescription.url}\n                    width={imageDescription.width}\n                    height={imageDescription.height}\n                    scale={scale}\n                />\n            );\n        }\n\n        return (\n            <div\n                className={\"perseus-widget \" + \"perseus-widget-grapher\"}\n                style={{\n                    width: box[0],\n                    height: this.props.flexibleType ? \"auto\" : box[1],\n                    boxSizing: \"initial\",\n                }}\n            >\n                <div\n                    className=\"graphie-container above-scratchpad\"\n                    style={{\n                        width: box[0],\n                        height: box[1],\n                    }}\n                >\n                    {image}\n                    <Graphie\n                        {...this.props.graph}\n                        setDrawingAreaAvailable={\n                            this.props.setDrawingAreaAvailable\n                        }\n                    >\n                        {this.props.model && this.renderPlot()}\n                        {this.props.model && this.renderAsymptote()}\n                        {this.props.model && points}\n                    </Graphie>\n                </div>\n            </div>\n        );\n    },\n\n    renderPlot: function() {\n        var model = this.props.model;\n        var xRange = this.props.graph.range[0];\n        var style = {\n            stroke: this.props.isMobile\n                ? KhanColors.BLUE_C\n                : KhanColors.DYNAMIC,\n            ...(this.props.isMobile ? {\"stroke-width\": 3} : {}),\n        };\n\n        var coeffs = model.getCoefficients(this._coords(), this._asymptote());\n        if (!coeffs) {\n            return;\n        }\n\n        var functionProps = model.getPropsForCoeffs(coeffs, xRange);\n        return (\n            <model.Movable\n                {...functionProps}\n                key={this.props.model.url}\n                range={xRange}\n                style={style}\n            />\n        );\n    },\n\n    renderAsymptote: function() {\n        var model = this.props.model;\n        var graph = this.props.graph;\n        var asymptote = this._asymptote();\n        var dashed = {\n            strokeDasharray: \"- \",\n        };\n        return asymptote &&\n        <MovableLine\n            onMove={(newCoord, oldCoord) => {\n                // Calculate and apply displacement\n                var delta = kvector.subtract(newCoord, oldCoord);\n                var newAsymptote = _.map(this._asymptote(), coord => kvector.add(coord, delta)\n                );\n                this.props.onChange({\n                    asymptote: newAsymptote,\n                });\n            }}\n            constraints={[\n                Interactive2.MovableLine.constraints.bound(),\n                Interactive2.MovableLine.constraints.snap(),\n                (newCoord, oldCoord) => {\n                    // Calculate and apply proposed displacement\n                    var delta = kvector.subtract(newCoord, oldCoord);\n                    var proposedAsymptote = _.map(\n                        this._asymptote(),\n                        coord => kvector.add(coord, delta)\n                    );\n                    // Verify that resulting asymptote is valid for graph\n                    if (model.extraAsymptoteConstraint) {\n                        return model.extraAsymptoteConstraint(\n                            newCoord,\n                            oldCoord,\n                            this._coords(),\n                            proposedAsymptote,\n                            graph\n                        );\n                    }\n                    return true;\n                },\n            ]}\n            normalStyle={dashed}\n            highlightStyle={dashed}\n        >\n            {_.map(asymptote, (coord, i) => <MovablePoint\n                key={`asymptoteCoord-${i}`}\n                coord={coord}\n                static={true}\n                draw={null}\n                extendLine={true}\n                showHairlines={this.props.showHairlines}\n                hideHairlines={this.props.hideHairlines}\n                showTooltips={this.props.showTooltips}\n                isMobile={this.props.isMobile}\n            />\n            )}\n        </MovableLine>;\n    },\n});\n\n/* Widget and editor. */\nvar Grapher = createReactClass({\n    propTypes: {\n        apiOptions: PropTypes.any,\n        availableTypes: PropTypes.arrayOf(PropTypes.any),\n        containerSizeClass: containerSizeClassPropType.isRequired,\n        graph: PropTypes.any,\n        markings: PropTypes.string,\n        onChange: PropTypes.func,\n        plot: PropTypes.any,\n        static: PropTypes.bool,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return DEFAULT_GRAPHER_PROPS;\n    },\n\n    render: function() {\n        var type = this.props.plot.type;\n        var coords = this.props.plot.coords;\n        var asymptote = this.props.plot.asymptote;\n\n        var typeSelector = (\n            <div style={typeSelectorStyle} className=\"above-scratchpad\">\n                <ButtonGroup\n                    value={type}\n                    allowEmpty={true}\n                    buttons={_.map(this.props.availableTypes, typeToButton)}\n                    onChange={this.handleActiveTypeChange}\n                />\n            </div>\n        );\n\n        const box = getInteractiveBoxFromSizeClass(\n            this.props.containerSizeClass\n        );\n\n        // Calculate additional graph properties so that the same values are\n        // passed in to both FunctionGrapher and Graphie.\n        const options = {\n            ...this.props.graph,\n            ...GrapherUtil.getGridAndSnapSteps(this.props.graph, box[0]),\n            gridConfig: this._getGridConfig({\n                ...this.props.graph,\n                box: box,\n                ...GrapherUtil.getGridAndSnapSteps(this.props.graph, box[0]),\n            }),\n        };\n\n        // The `graph` prop will eventually be passed to the <Graphie>\n        // component. In fact, if model is `null`, this is functionalliy\n        // identical to a <Graphie>. Otherwise, some points and a plot will be\n        // overlayed.\n        var grapherProps = {\n            graph: {\n                box: box,\n                range: options.range,\n                step: options.step,\n                snapStep: options.snapStep,\n                backgroundImage: options.backgroundImage,\n                options: options,\n                setup: this._setupGraphie,\n            },\n            onChange: this.handlePlotChanges,\n            model: type && functionForType(type),\n            coords: coords,\n            asymptote: asymptote,\n            static: this.props.static,\n            setDrawingAreaAvailable: this.props.apiOptions\n                .setDrawingAreaAvailable,\n            isMobile: this.props.apiOptions.isMobile,\n            showTooltips: this.props.graph.showTooltips,\n            showHairlines: this.showHairlines,\n            hideHairlines: this.hideHairlines,\n        };\n\n        return (\n            <div>\n                <FunctionGrapher {...grapherProps} />\n                {this.props.availableTypes.length > 1 && typeSelector}\n            </div>\n        );\n    },\n\n    handlePlotChanges: function(newPlot) {\n        var plot = _.extend({}, this.props.plot, newPlot);\n        this.props.onChange({\n            plot: plot,\n        });\n        this.props.trackInteraction();\n    },\n\n    handleActiveTypeChange: function(newType) {\n        var graph = this.props.graph;\n        var plot = _.extend(\n            {},\n            this.props.plot,\n            GrapherUtil.defaultPlotProps(newType, graph)\n        );\n        this.props.onChange({\n            plot: plot,\n        });\n    },\n\n    _getGridConfig: function(options) {\n        return _.map(options.step, function(step, i) {\n            return Util.gridDimensionConfig(\n                step,\n                options.range[i],\n                options.box[i],\n                options.gridStep[i]\n            );\n        });\n    },\n\n    _calculateMobileTickStep(gridStep, step, ranges) {\n        const tickStep = Util.constrainedTickStepsFromTickSteps(step, ranges);\n\n        // According to the graphInit documentation in graphie.js, tickStep is\n        // relative to the grid units so we need to adjust all values by the\n        // grid step.\n        tickStep[0] = tickStep[0] / gridStep[0];\n        tickStep[1] = tickStep[1] / gridStep[1];\n\n        return tickStep;\n    },\n\n    _setupGraphie: function(graphie, options) {\n        const isMobile = this.props.apiOptions.isMobile;\n\n        if (options.markings === \"graph\") {\n            graphie.graphInit({\n                range: options.range,\n                scale: _.pluck(options.gridConfig, \"scale\"),\n                axisArrows: \"<->\",\n                labelFormat: function(s) {\n                    return \"\\\\small{\" + s + \"}\";\n                },\n                gridStep: options.gridStep,\n                snapStep: options.snapStep,\n                tickStep: isMobile\n                    ? this._calculateMobileTickStep(\n                          options.gridStep,\n                          options.step,\n                          options.range\n                      )\n                    : _.pluck(options.gridConfig, \"tickStep\"),\n                labelStep: 1,\n                unityLabels: _.pluck(options.gridConfig, \"unityLabel\"),\n                isMobile: isMobile,\n            });\n            graphie.label(\n                [0, options.range[1][1]],\n                options.labels[1],\n                isMobile ? \"below right\" : \"above\"\n            );\n            graphie.label(\n                [options.range[0][1], 0],\n                options.labels[0],\n                isMobile ? \"above left\" : \"right\"\n            );\n        } else if (options.markings === \"grid\") {\n            graphie.graphInit({\n                range: options.range,\n                scale: _.pluck(options.gridConfig, \"scale\"),\n                gridStep: options.gridStep,\n                axes: false,\n                ticks: false,\n                labels: false,\n                isMobile: isMobile,\n            });\n        } else if (options.markings === \"none\") {\n            graphie.init({\n                range: options.range,\n                scale: _.pluck(options.gridConfig, \"scale\"),\n            });\n        }\n\n        if (this.props.apiOptions.isMobile) {\n            const hairlineStyle = {\n                normalStyle: {\n                    strokeWidth: 1,\n                },\n            };\n\n            this.horizHairline = new WrappedLine(\n                graphie,\n                [0, 0],\n                [0, 0],\n                hairlineStyle\n            );\n            this.horizHairline.attr({\n                stroke: KhanColors.INTERACTIVE,\n            });\n            this.horizHairline.hide();\n\n            this.vertHairline = new WrappedLine(\n                graphie,\n                [0, 0],\n                [0, 0],\n                hairlineStyle\n            );\n            this.vertHairline.attr({\n                stroke: KhanColors.INTERACTIVE,\n            });\n            this.vertHairline.hide();\n        }\n    },\n\n    showHairlines: function(point) {\n        if (this.props.apiOptions.isMobile && this.props.markings !== \"none\") {\n            // Hairlines are already initialized when the graph is loaded, so\n            // here we just move them to the updated location and make them\n            // visible.\n            this.horizHairline.moveTo(\n                [this.props.graph.range[0][0], point[1]],\n                [this.props.graph.range[0][1], point[1]]\n            );\n\n            this.horizHairline.show();\n\n            this.vertHairline.moveTo(\n                [point[0], this.props.graph.range[1][0]],\n                [point[0], this.props.graph.range[1][1]]\n            );\n\n            this.vertHairline.show();\n        }\n    },\n\n    hideHairlines: function() {\n        if (this.props.apiOptions.isMobile) {\n            this.horizHairline.hide();\n            this.vertHairline.hide();\n        }\n    },\n\n    simpleValidate: function(rubric) {\n        return GrapherUtil.validate(this.getUserInput(), rubric);\n    },\n\n    getUserInput: function() {\n        return this.props.plot;\n    },\n\n    focus: $.noop,\n});\n\nvar propTransform = editorProps => {\n    var widgetProps = {\n        availableTypes: editorProps.availableTypes,\n        graph: editorProps.graph,\n    };\n\n    // If there's only one type, the graph type is deterministic\n    if (widgetProps.availableTypes.length === 1) {\n        var graph = widgetProps.graph;\n        var type = GrapherUtil.chooseType(widgetProps.availableTypes);\n        widgetProps.plot = GrapherUtil.defaultPlotProps(type, graph);\n    }\n\n    return widgetProps;\n};\n\n// Note that in addition to the standard staticTransform, in static\n// mode we set static=true for the graph's handles in FunctionGrapher.\nvar staticTransform = editorProps => {\n    return _.extend({}, propTransform(editorProps), {\n        // Don't display graph type choices if we're in static mode\n        availableTypes: [editorProps.correct.type],\n        // Display the same graph marked as correct in the widget editor.\n        plot: editorProps.correct,\n    });\n};\n\n_module_.exports = {\n    name: \"grapher\",\n    displayName: \"Grapher\",\n    widget: Grapher,\n    transform: propTransform,\n    staticTransform: staticTransform,\n};\nexport default _module_.exports;\n","import { containerSizeClass, getInteractiveBoxFromSizeClass } from \"../util/sizing-utils.js\";\nimport { GrapherUtil, allTypes, typeToButton, DEFAULT_GRAPHER_PROPS } from \"./grapher/util.jsx\";\nimport _grapherJsx from \"./grapher.jsx\";\nimport _reactComponentsMultiButtonGroupJsx from \"react-components/multi-button-group.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _componentsGraphSettingsJsx from \"../components/graph-settings.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-redeclare, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\n\nconst GraphSettings = _componentsGraphSettingsJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst MultiButtonGroup = _reactComponentsMultiButtonGroupJsx;\n\nconst Grapher = _grapherJsx.widget;\n\nconst GrapherEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            correct: DEFAULT_GRAPHER_PROPS.plot,\n            graph: DEFAULT_GRAPHER_PROPS.graph,\n            availableTypes: DEFAULT_GRAPHER_PROPS.availableTypes,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        const sizeClass = containerSizeClass.SMALL;\n        let equationString;\n        let graph;\n        if (this.props.graph.valid === true) {\n            var graphProps = {\n                graph: this.props.graph,\n                plot: this.props.correct,\n                availableTypes: this.props.availableTypes,\n                onChange: (newProps, cb) => {\n                    var correct = this.props.correct;\n                    if (correct.type === newProps.plot.type) {\n                        correct = _.extend({}, correct, newProps.plot);\n                    } else {\n                        // Clear options from previous graph\n                        correct = newProps.plot;\n                    }\n                    this.props.onChange({correct: correct}, cb);\n                },\n                trackInteraction: function() {},\n            };\n\n            graph = (\n                <Grapher\n                    {...graphProps}\n                    apiOptions={this.props.apiOptions}\n                    containerSizeClass={sizeClass}\n                />\n            );\n            equationString = GrapherUtil.getEquationString(graphProps);\n        } else {\n            graph = (\n                <div className=\"perseus-error\">\n                    {this.props.graph.valid}\n                </div>\n            );\n        }\n\n        return (\n            <div>\n                <div>\n                    Correct answer{\" \"}\n                    <InfoTip>\n                        <p>\n                            Graph the correct answer in the graph below and\n                            ensure the equation or point coordinates displayed\n                            represent the correct answer.\n                        </p>\n                    </InfoTip>{\" \"}\n                    : {equationString}\n                </div>\n\n                <GraphSettings\n                    editableSettings={[\"graph\", \"snap\", \"image\"]}\n                    box={getInteractiveBoxFromSizeClass(sizeClass)}\n                    range={this.props.graph.range}\n                    labels={this.props.graph.labels}\n                    step={this.props.graph.step}\n                    gridStep={this.props.graph.gridStep}\n                    snapStep={this.props.graph.snapStep}\n                    valid={this.props.graph.valid}\n                    backgroundImage={this.props.graph.backgroundImage}\n                    markings={this.props.graph.markings}\n                    rulerLabel={this.props.graph.rulerLabel}\n                    rulerTicks={this.props.graph.rulerTicks}\n                    showTooltips={this.props.graph.showTooltips}\n                    onChange={this.change(\"graph\")}\n                />\n                <div className=\"perseus-widget-row\">\n                    <label>Available functions:  </label>\n                    <MultiButtonGroup\n                        allowEmpty={false}\n                        values={this.props.availableTypes}\n                        buttons={_.map(allTypes, typeToButton)}\n                        onChange={this.handleAvailableTypesChange}\n                    />\n                </div>\n                {graph}\n            </div>\n        );\n    },\n\n    handleAvailableTypesChange: function(newAvailableTypes) {\n        var correct = this.props.correct;\n\n        // If the currently 'correct' type is removed from the list of types,\n        // we need to change it to avoid impossible questions.\n        if (!_.contains(newAvailableTypes, this.props.correct.type)) {\n            var graph = this.props.graph;\n            var newType = GrapherUtil.chooseType(newAvailableTypes);\n            var correct = GrapherUtil.defaultPlotProps(newType, graph);\n        }\n        this.props.onChange({\n            availableTypes: newAvailableTypes,\n            correct: correct,\n        });\n    },\n\n    serialize: function() {\n        return _.chain(this.props)\n            .pick(\"correct\", \"availableTypes\")\n            .extend({graph: _.omit(this.props.graph, \"box\")})\n            .value();\n    },\n});\n\n_module_.exports = GrapherEditor;\nexport default _module_.exports;\n","import _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst Editor = _editorJsx;\nconst TextInput = _componentsTextInputJsx;\n\nconst DefinitionEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        togglePrompt: PropTypes.string,\n        definition: PropTypes.string,\n        apiOptions: PropTypes.any,\n    },\n\n    getDefaultProps: function() {\n        return {\n            togglePrompt: \"\",\n            definition: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-widget-definition-editor\">\n                <a\n                    href=\"https://docs.google.com/document/d/1udaPef4imOfTMhmLDlWq4SM0mxL0r3YHFZE-5J1uGfo\"\n                    target=\"_blank\"\n                >\n                    Definition style guide\n                </a>\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Word to be defined:{\" \"}\n                        <TextInput\n                            value={this.props.togglePrompt}\n                            onChange={this.change(\"togglePrompt\")}\n                            placeholder=\"define me\"\n                        />\n                    </label>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <Editor\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.definition}\n                        widgetEnabled={false}\n                        placeholder=\"definition goes here\"\n                        onChange={props => {\n                            const newProps = {};\n                            if (_.has(props, \"content\")) {\n                                newProps.definition = props.content;\n                            }\n                            this.change(newProps);\n                        }}\n                    />\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = DefinitionEditor;\nexport default _module_.exports;\n","import * as styleConstants from \"../styles/constants.js\";\nimport _stylesMediaQueriesJs from \"../styles/media-queries.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst PerseusApi = _perseusApiJsx;\nconst Renderer = _rendererJsx;\nconst mediaQueries = _stylesMediaQueriesJs;\n\nconst Definition = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: PerseusApi.Options.propTypes,\n        definition: PropTypes.string,\n        togglePrompt: PropTypes.string,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            togglePrompt: \"define me\",\n            definition: \"definition goes here\",\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            expanded: false,\n            belowScreen: false,\n            contentOffsetLeft: 0,\n            contentOffsetLeftMobile: 0,\n            contentWidth: 0,\n            contentWidthMobile: 0,\n            contentMarginTop: arrowHeight,\n        };\n    },\n\n    componentDidMount: function() {\n        document.addEventListener(\"click\", this.handleClick);\n    },\n\n    componentWillUnmount: function() {\n        document.removeEventListener(\"click\", this.handleClick);\n    },\n\n    handleClick: function(event) {\n        let elem = event.target;\n        let shouldClose = true;\n        while (elem) {\n            // If the clicked element is outside the definition box\n            // close the definition box\n            if (elem === this.content || elem === this.container) {\n                shouldClose = false;\n                break;\n            }\n            elem = elem.parentNode;\n        }\n\n        if (shouldClose) {\n            this.close();\n        }\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    close: function() {\n        this.setState({\n            expanded: false,\n        });\n    },\n\n    getUserInput: function() {\n        return {};\n    },\n\n    simpleValidate: function(rubric) {\n        return Definition.validate(this.getUserInput(), rubric);\n    },\n\n    // check if the definition is fully visible on the bottom\n    _definitionBelowScreen: function() {\n        const windowBottom = window.innerHeight;\n        const bottom = this.container.getBoundingClientRect().bottom;\n        return bottom > windowBottom - this.content.offsetHeight;\n    },\n\n    // TODO(audrey): think of a better way to have the definition always appear\n    // on screen. Currently, the marginTop and absolute positions of the arrow\n    // and the definition div are adjusted. Could also consider having\n    // dynamic flipping.\n    _checkDefinitionPosition: function() {\n        // need to wait for aphrodite styles to be rendered\n        // so they can accessed for measurements in positionContent\n        setTimeout(() => {\n            this._positionContentHorizontally();\n            if (this._definitionBelowScreen()) {\n                this.setState(\n                    {\n                        belowScreen: true,\n                    },\n                    this._positionContentVertically\n                );\n            } else {\n                this.setState(\n                    {\n                        belowScreen: false,\n                    },\n                    this._positionContentVertically\n                );\n            }\n        }, 0);\n    },\n\n    /**\n    * This function sets the definition boxes' vertical positions depending\n    * on whether the definition should appear above or below. The positions\n    * are affected by how long the definition is.\n    */\n    _positionContentVertically: function() {\n        if (this.state.belowScreen) {\n            const contentHeight = this.content.offsetHeight;\n            // slight hack to better align the bottom of the arrow\n            // with the rest of the definition box\n            const contentMarginTop = -contentHeight - 2 * arrowHeight - 4;\n            this.setState({\n                contentMarginTop: contentMarginTop,\n            });\n        } else {\n            this.setState({\n                contentMarginTop: arrowHeight,\n            });\n        }\n    },\n\n    _onClick: function() {\n        // close all other open definitions if opening definition\n        if (!this.state.expanded) {\n            const definitionWidgets = this.props.findWidgets(\"definition\");\n            for (const widget of definitionWidgets) {\n                if (widget !== this) {\n                    widget.close();\n                }\n            }\n        }\n\n        this.setState(\n            {\n                expanded: !this.state.expanded,\n            },\n            this._checkDefinitionPosition\n        );\n        this.props.trackInteraction();\n    },\n\n    _onMouseOver: function() {\n        this.setState(\n            {\n                expanded: true,\n            },\n            this._checkDefinitionPosition\n        );\n        this.props.trackInteraction();\n    },\n\n    _onMouseOut: function() {\n        this.setState({\n            expanded: false,\n        });\n        this.props.trackInteraction();\n    },\n\n    /**\n    * This function sets the definition boxes' widths so that the complete box\n    * is visible on the screen and spans the entire width. It also makes sure\n    * the content is centered correctly.\n    */\n    _positionContentHorizontally: function() {\n        // container is the word to be defined\n        // content is the actual definition\n        const documentWidth = document.body.clientWidth;\n        const marginWidth = this.container.parentElement.parentElement\n            .offsetLeft;\n        const contentWidth = documentWidth - 2 * marginWidth;\n        const contentWidthMobile = documentWidth - marginWidth;\n        const contentOffsetLeft = this.container.offsetLeft - marginWidth;\n        const contentOffsetLeftMobile = this.container.offsetLeft;\n\n        this.setState({\n            contentWidth: contentWidth,\n            contentWidthMobile: contentWidthMobile,\n            contentOffsetLeft: -contentOffsetLeft,\n            contentOffsetLeftMobile: -contentOffsetLeftMobile,\n        });\n    },\n\n    render: function() {\n        const {readOnly, isMobile} = this.props.apiOptions;\n\n        const linkAnchor = this.props.togglePrompt;\n\n        let link;\n\n        const href = readOnly ? null : \"javascript:void(0)\";\n        const onClick = readOnly ? null : this._onClick;\n        const onMouseOver = this._onMouseOver;\n        const onMouseOut = this._onMouseOut;\n\n        if (isMobile) {\n            link = (\n                <a\n                    className={css(styles.mobileDefinitionLink)}\n                    href={href}\n                    onClick={onClick}\n                >\n                    {linkAnchor}\n                </a>\n            );\n        } else {\n            link = (\n                <a\n                    className={css(styles.definitionLink)}\n                    href={href}\n                    onMouseOver={onMouseOver}\n                    onMouseOut={onMouseOut}\n                >\n                    {linkAnchor}\n                </a>\n            );\n        }\n\n        const expandedStyle = isMobile\n            ? styles.contentExpandedMobile\n            : styles.contentExpanded;\n\n        const arrowTransform = this.state.belowScreen\n            ? \"scale(1, -1)\"\n            : \"scale(1, 1)\";\n\n        return (\n            <div\n                className={css(styles.container)}\n                ref={e => this.container = e}\n            >\n                <div className={css(styles.linkContainer)}>\n                    {link}\n                    {this.state.expanded &&\n                        <svg\n                            className={css(styles.disclosureArrow)}\n                            ref={e => this.arrow = e}\n                            transform={arrowTransform}\n                            style={{\n                                bottom:\n                                    this.state.expanded &&\n                                    this.state.belowScreen\n                                        ? \"18px\"\n                                        : \"-18px\",\n                            }}\n                        >\n                            <filter\n                                id=\"definition-widget-dropshadow\"\n                                height=\"150%\"\n                            >\n                                <feOffset\n                                    dx={dropShadowXOffset}\n                                    dy={dropShadowYOffset}\n                                    result=\"offsetblur\"\n                                />\n                                <feGaussianBlur\n                                    in=\"SourceAlpha\"\n                                    stdDeviation={dropShadowRadius / 2}\n                                />\n                                <feComponentTransfer>\n                                    <feFuncA\n                                        type=\"linear\"\n                                        slope={dropShadowOpacity}\n                                    />\n                                </feComponentTransfer>\n                                <feMerge>\n                                    <feMergeNode />\n                                    <feMergeNode in=\"SourceGraphic\" />\n                                </feMerge>\n                            </filter>\n                            <polyline\n                                fill=\"white\"\n                                filter=\"url(#definition-widget-dropshadow)\"\n                                points={\n                                    `0,${arrowHeight} ` +\n                                    `${arrowWidth},${arrowHeight} ` +\n                                    `${arrowWidth / 2},0`\n                                }\n                            />\n                        </svg>}\n                </div>\n                <div\n                    className={css(\n                        styles.content,\n                        isMobile && styles.contentMobile,\n                        this.state.expanded && expandedStyle\n                    )}\n                    style={{\n                        height: this.state.expanded ? \"auto\" : 0,\n                        overflow: this.state.expanded ? \"visible\" : \"hidden\",\n                        left: isMobile\n                            ? this.state.contentOffsetLeftMobile\n                            : this.state.contentOffsetLeft,\n                        width: isMobile\n                            ? this.state.contentWidthMobile\n                            : this.state.contentWidth,\n                        marginTop: this.state.contentMarginTop,\n                    }}\n                    ref={e => this.content = e}\n                >\n                    <Renderer\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.definition}\n                        widgets={this.props.widgets}\n                    />\n                </div>\n            </div>\n        );\n    },\n});\n\nconst dropShadowXOffset = 0;\nconst dropShadowYOffset = 1;\nconst dropShadowOpacity = 0.35;\nconst dropShadowRadius = 4;\n\nconst arrowWidth = 20;\nconst arrowHeight = 14;\nconst backgroundColor = styleConstants.white;\n\nconst styles = StyleSheet.create({\n    container: {\n        display: \"inline\",\n        position: \"relative\",\n    },\n\n    linkContainer: {\n        display: \"inline-block\",\n    },\n\n    definitionLink: {\n        color: styleConstants.blue,\n        borderBottom: `dashed 1px ${styleConstants.blue}`,\n        textDecoration: \"none\",\n    },\n\n    mobileDefinitionLink: {\n        color: styleConstants.kaGreen,\n        borderBottom: `dashed 1px ${styleConstants.kaGreen}`,\n        textDecoration: \"none\",\n\n        // TODO(benkomalo): these should be pulled in from common typography\n        // shared files so we have a single place where the type hierarchy is\n        // defined; one off font sizes for individual components should be\n        // avoided.\n        [mediaQueries.xl]: {\n            fontSize: 22,\n            lineHeight: 1.4,\n        },\n        [mediaQueries.lgOrSmaller]: {\n            fontSize: 20,\n            lineHeight: 1.5,\n        },\n        [mediaQueries.smOrSmaller]: {\n            fontSize: 18,\n            lineHeight: 1.2,\n        },\n    },\n\n    content: {\n        background: backgroundColor,\n        opacity: 0.95,\n        borderRadius: 1,\n        position: \"absolute\",\n        transition: \"margin-top 0.1s\",\n        paddingLeft: styleConstants.phoneMargin,\n        paddingRight: styleConstants.phoneMargin,\n        zIndex: 2,\n    },\n\n    contentExpanded: {\n        boxShadow: `0px 0px 4px ${styleConstants.gray85}`,\n        border: `solid 0.5px ${styleConstants.gray85}`,\n    },\n\n    contentExpandedMobile: {\n        paddingTop: 32,\n        paddingBottom: 32,\n        boxShadow: `0px 0px 4px ${styleConstants.gray85}`,\n        border: `solid 0.5px ${styleConstants.gray85}`,\n    },\n\n    disclosureArrow: {\n        // HACK - positioning at \"bottom: 0\", doesn't actually position it to\n        // the real bottom, because the container is `inline-block`, and it\n        // seems to position it to the baseline? We put in a generous\n        // fudge factor to position it down to be flush with the content box\n        // below it.\n        height: arrowHeight,\n        left: \"50%\",\n        marginLeft: -(arrowWidth / 2),\n        position: \"absolute\",\n        width: arrowWidth,\n        zIndex: 4, // so popovers appear on top\n    },\n});\n\n_.extend(Definition, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"definition\",\n    displayName: \"Definition\",\n    defaultAlignment: \"inline\",\n    widget: Definition,\n    transform: _.identity,\n};\nexport default _module_.exports;\n","import _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _editorJsx from \"../editor.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar Editor = _editorJsx;\nvar TextInput = _componentsTextInputJsx;\n\nvar defaultExplanationProps = {\n    showPrompt: \"Explain\",\n    hidePrompt: \"Hide explanation\",\n    explanation: \"explanation goes here\\n\\nmore explanation\",\n    widgets: {},\n};\n\nvar ExplanationEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        showPrompt: PropTypes.string,\n        hidePrompt: PropTypes.string,\n        explanation: PropTypes.string,\n        widgets: PropTypes.object,\n        apiOptions: PropTypes.any,\n    },\n\n    getDefaultProps: function() {\n        return defaultExplanationProps;\n    },\n\n    getInitialState: function() {\n        return {};\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-widget-explanation-editor\">\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Prompt to show explanation:{\" \"}\n                        <TextInput\n                            value={this.props.showPrompt}\n                            onChange={this.change(\"showPrompt\")}\n                        />\n                    </label>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <label>\n                        Prompt to hide explanation:{\" \"}\n                        <TextInput\n                            value={this.props.hidePrompt}\n                            onChange={this.change(\"hidePrompt\")}\n                        />\n                    </label>\n                </div>\n                <div className=\"perseus-widget-row\">\n                    <Editor\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.explanation}\n                        widgets={this.props.widgets}\n                        widgetEnabled={true}\n                        immutableWidgets={false}\n                        onChange={props => {\n                            var newProps = {};\n                            if (_.has(props, \"content\")) {\n                                newProps.explanation = props.content;\n                            }\n                            if (_.has(props, \"widgets\")) {\n                                newProps.widgets = props.widgets;\n                            }\n                            this.change(newProps);\n                        }}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = ExplanationEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport * as styleConstants from \"../styles/constants.js\";\nimport _stylesMediaQueriesJs from \"../styles/media-queries.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst PerseusApi = _perseusApiJsx;\nconst Renderer = _rendererJsx;\nconst mediaQueries = _stylesMediaQueriesJs;\n\nconst defaultExplanationProps = {\n    showPrompt: \"Explain\",\n    hidePrompt: \"Hide explanation\",\n    explanation: \"explanation goes here\\n\\nmore explanation\",\n    widgets: {},\n    linterContext: linterContextDefault,\n};\n\nconst Explanation = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: PerseusApi.Options.propTypes,\n        explanation: PropTypes.string,\n        hidePrompt: PropTypes.string,\n        showPrompt: PropTypes.string,\n        trackInteraction: PropTypes.func.isRequired,\n        widgets: PropTypes.object,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return defaultExplanationProps;\n    },\n\n    getInitialState: function() {\n        return {\n            expanded: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    _onClick: function() {\n        this.setState({\n            expanded: !this.state.expanded,\n        });\n        this.props.trackInteraction();\n    },\n\n    render: function() {\n        const {Link} = this.props.apiOptions.baseElements;\n        const {readOnly, isMobile} = this.props.apiOptions;\n\n        const linkAnchor = this.state.expanded\n            ? this.props.hidePrompt\n            : this.props.showPrompt;\n\n        let linkContainer;\n\n        const href = readOnly ? null : \"javascript:void(0)\";\n        const onClick = readOnly ? null : this._onClick;\n\n        if (isMobile) {\n            linkContainer = (\n                <div className={css(styles.linkContainer)}>\n                    <a\n                        className={css(styles.mobileExplanationLink)}\n                        href={href}\n                        onClick={onClick}\n                    >\n                        {linkAnchor}\n                    </a>\n                    {this.state.expanded &&\n                        <svg className={css(styles.disclosureArrow)}>\n                            <polygon\n                                style={{fill: backgroundColor}}\n                                points={\n                                    `0,${arrowHeight} ` +\n                                    `${arrowWidth},${arrowHeight} ` +\n                                    `${arrowWidth / 2},0`\n                                }\n                            />\n                        </svg>}\n                </div>\n            );\n        } else {\n            linkContainer = (\n                <div className={css(styles.linkContainer)}>\n                    <Link\n                        className={css(styles.explanationLink)}\n                        href={href}\n                        onClick={onClick}\n                    >\n                        {`[${linkAnchor}]`}\n                    </Link>\n                </div>\n            );\n        }\n\n        const expandedStyle = isMobile\n            ? styles.contentExpandedMobile\n            : styles.contentExpanded;\n\n        return (\n            <div className={css(styles.container)}>\n                {linkContainer}\n                <div\n                    className={css(\n                        styles.content,\n                        isMobile && styles.contentMobile,\n                        this.state.expanded && expandedStyle\n                    )}\n                    style={{\n                        height: this.state.expanded ? \"auto\" : 0,\n                        overflow: this.state.expanded ? \"visible\" : \"hidden\",\n                    }}\n                    ref=\"content\"\n                >\n                    <Renderer\n                        apiOptions={this.props.apiOptions}\n                        content={this.props.explanation}\n                        widgets={this.props.widgets}\n                        linterContext={this.props.linterContext}\n                    />\n                </div>\n            </div>\n        );\n    },\n\n    getUserInput: function() {\n        return {};\n    },\n\n    simpleValidate: function(rubric) {\n        return Explanation.validate(this.getUserInput(), rubric);\n    },\n});\n\nconst leftBorderSpacing = 23;\nconst verticalContentPadding = 10;\n\nconst arrowWidth = 30;\nconst arrowHeight = 14;\nconst backgroundColor = styleConstants.gray95;\n\nconst styles = StyleSheet.create({\n    container: {\n        display: \"inline\",\n        position: \"relative\",\n    },\n\n    linkContainer: {\n        display: \"inline-block\",\n    },\n\n    explanationLink: {\n        fontStyle: \"italic\",\n        color: \"#007d96\",\n\n        [mediaQueries.xl]: {\n            fontSize: 20,\n            lineHeight: 1.1,\n        },\n        [mediaQueries.lgOrSmaller]: {\n            fontSize: 17,\n            lineHeight: 1.4,\n        },\n        [mediaQueries.smOrSmaller]: {\n            fontSize: 14,\n            lineHeight: 1.3,\n        },\n    },\n\n    mobileExplanationLink: {\n        color: styleConstants.kaGreen,\n        borderBottom: `dashed 1px ${styleConstants.kaGreen}`,\n        textDecoration: \"none\",\n\n        // TODO(benkomalo): these should be pulled in from common typography\n        // shared files so we have a single place where the type hierarchy is\n        // defined; one off font sizes for individual components should be\n        // avoided.\n        [mediaQueries.xl]: {\n            fontSize: 22,\n            lineHeight: 1.4,\n        },\n        [mediaQueries.lgOrSmaller]: {\n            fontSize: 20,\n            lineHeight: 1.5,\n        },\n        [mediaQueries.smOrSmaller]: {\n            fontSize: 18,\n            lineHeight: 1.2,\n        },\n    },\n\n    content: {\n        position: \"relative\",\n        transition: \"margin-top 0.1s\",\n    },\n\n    contentExpanded: {\n        borderLeft: \"5px solid #ccc\",\n        marginLeft: -leftBorderSpacing,\n        paddingLeft: leftBorderSpacing,\n\n        paddingBottom: verticalContentPadding,\n\n        // Note: we still use arrow height as the vertical margin, even on\n        // desktop when there is no arrow, but it's good enough.\n        marginBottom: arrowHeight,\n        marginTop: arrowHeight,\n    },\n\n    contentExpandedMobile: {\n        boxSizing: \"content-box\",\n        paddingTop: 32,\n        paddingBottom: 32,\n        marginTop: arrowHeight,\n    },\n\n    contentMobile: {\n        background: backgroundColor,\n\n        // TODO(benkomalo): this is to \"full bleed\" the background.\n        // The actual content padding differs depending on the host\n        // container, so this needs to be fixed eventually.\n        marginLeft: styleConstants.negativePhoneMargin,\n        marginRight: styleConstants.negativePhoneMargin,\n        paddingLeft: styleConstants.phoneMargin,\n        paddingRight: styleConstants.phoneMargin,\n    },\n\n    disclosureArrow: {\n        // HACK - positioning at \"bottom: 0\", doesn't actually position it to\n        // the real bottom, because the container is `inline-block`, and it\n        // seems to position it to the baseline? We put in a generous\n        // fudge factor to position it down to be flush with the content box\n        // below it.\n        bottom: -(arrowHeight + 5),\n        height: arrowHeight,\n        left: \"50%\",\n        marginLeft: -(arrowWidth / 2),\n        position: \"absolute\",\n        width: arrowWidth,\n    },\n});\n\n_.extend(Explanation, {\n    validate: function(state, rubric) {\n        return {\n            type: \"points\",\n            earned: 0,\n            total: 0,\n            message: null,\n        };\n    },\n});\n\n_module_.exports = {\n    name: \"explanation\",\n    displayName: \"Explanation\",\n    defaultAlignment: \"inline\",\n    widget: Explanation,\n    transform: _.identity,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport { iconPlus, iconTrash } from \"../icon-paths.js\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, max-len, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp, semi, space-before-function-paren */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar _ = _underscore;\n\nvar InfoTip = _componentsInfoTipJsx;\nvar InlineIcon = _componentsInlineIconJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar DropdownEditor = createReactClass({\n    propTypes: {\n        choices: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string,\n                correct: PropTypes.bool,\n            })\n        ),\n        placeholder: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            placeholder: \"\",\n            choices: [\n                {\n                    content: \"\",\n                    correct: false,\n                },\n            ],\n        };\n    },\n\n    render: function() {\n        var dropdownGroupName = _.uniqueId(\"perseus_dropdown_\");\n        return (\n            <div className=\"perseus-widget-dropdown\">\n                <div className=\"dropdown-info\">\n                    Dropdown\n                    <InfoTip>\n                        <p>\n                            The drop down is useful for making inequalities in a\n                            custom format. We normally use the symbols {\"<\"},{\" \"}\n                            {\">\"}, ,  (in that order) which you can copy into\n                            the choices. When possible, use the \"multiple\n                            choice\" answer type instead.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div className=\"dropdown-placeholder\">\n                    <input\n                        type=\"text\"\n                        placeholder=\"Placeholder value\"\n                        value={this.props.placeholder}\n                        onChange={this.onPlaceholderChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            This value will appear as the drop down default. It\n                            should give the user some indication of the values\n                            available in the drop down itself, e.g.,\n                            Yes/No/Maybe.\n                        </p>\n                    </InfoTip>\n                </div>\n                <div className=\"clearfix\" />\n                <ul className=\"dropdown-choices\">\n                    {this.props.choices.map(function(choice, i) {\n                        var checkedClass = choice.correct\n                            ? \"correct\"\n                            : \"incorrect\";\n\n                        return (\n                            <li key={\"\" + i}>\n                                <div>\n                                    <input\n                                        ref={\"radio\" + i}\n                                        type=\"radio\"\n                                        name={dropdownGroupName}\n                                        checked={\n                                            choice.correct ? \"checked\" : \"\"\n                                        }\n                                        onChange={this.onCorrectChange.bind(\n                                            this,\n                                            i\n                                        )}\n                                        value={i}\n                                    />\n                                    <input\n                                        type=\"text\"\n                                        ref={\"editor\" + i}\n                                        onChange={this.onContentChange.bind(\n                                            this,\n                                            i\n                                        )}\n                                        className={checkedClass}\n                                        value={choice.content}\n                                    />\n                                    <a\n                                        href=\"#\"\n                                        className=\"simple-button orange\"\n                                        onClick={this.removeChoice.bind(\n                                            this,\n                                            i\n                                        )}\n                                    >\n                                        <span className=\"remove-choice\">\n                                            <InlineIcon {...iconTrash} />\n                                        </span>\n                                    </a>\n                                </div>\n                            </li>\n                        );\n                    }, this)}\n                </ul>\n\n                <div className=\"add-choice-container\">\n                    <a\n                        href=\"#\"\n                        className=\"simple-button orange\"\n                        onClick={this.addChoice}\n                    >\n                        <InlineIcon {...iconPlus} /> Add a choice{\" \"}\n                    </a>\n                </div>\n            </div>\n        );\n    },\n\n    onPlaceholderChange: function(e) {\n        var placeholder = e.target.value;\n        this.props.onChange({placeholder: placeholder});\n    },\n\n    onCorrectChange: function(choiceIndex) {\n        var choices = _.map(this.props.choices, function(choice, i) {\n            return _.extend({}, choice, {\n                correct: i === choiceIndex,\n            });\n        });\n        this.props.onChange({choices: choices});\n    },\n\n    onContentChange: function(choiceIndex, e) {\n        var choices = this.props.choices.slice();\n        var choice = _.clone(choices[choiceIndex]);\n        choice.content = e.target.value;\n        choices[choiceIndex] = choice;\n        this.props.onChange({choices: choices});\n    },\n\n    addChoice: function(e) {\n        e.preventDefault();\n\n        var choices = this.props.choices;\n        var blankChoice = {content: \"\", correct: false};\n        this.props.onChange(\n            {\n                choices: choices.concat([blankChoice]),\n            },\n            this.focus.bind(this, choices.length)\n        );\n    },\n\n    removeChoice: function(choiceIndex, e) {\n        e.preventDefault();\n        var choices = _.clone(this.props.choices);\n        choices.splice(choiceIndex, 1);\n        this.props.onChange({\n            choices: choices,\n        });\n    },\n\n    focus: function(i) {\n        ReactDOM.findDOMNode(this.refs[\"editor\" + i]).focus();\n        return true;\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = DropdownEditor;\nexport default _module_.exports;\n","import { iconDropdownArrow } from \"../icon-paths.js\";\nimport * as styleConstants from \"../styles/constants.js\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst classNames = _classnames;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst ApiOptions = _perseusApiJsx2.Options;\nconst InlineIcon = _componentsInlineIconJsx;\n\nconst dropdownArrowSize = 24;\n\nconst Dropdown = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        choices: PropTypes.arrayOf(PropTypes.string),\n        onChange: PropTypes.func.isRequired,\n        placeholder: PropTypes.string,\n        selected: PropTypes.number,\n        trackInteraction: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            choices: [],\n            selected: 0,\n            placeholder: \"\",\n            apiOptions: ApiOptions.defaults,\n        };\n    },\n\n    render: function() {\n        var choices = this.props.choices.slice();\n\n        var selectClasses = classNames({\n            \"perseus-widget-dropdown\": true,\n        });\n\n        return (\n            <div>\n                <select\n                    onChange={this._handleChangeEvent}\n                    onClick={e => {\n                        e.stopPropagation();\n                        e.target.focus();\n                    }}\n                    onTouchStart={e => {\n                        e.stopPropagation();\n                        e.target.focus();\n                    }}\n                    className={\n                        selectClasses +\n                        // This makes it so that mobile's fastclick doesn't\n                        // interfere & call `.focus` when we're inside of a\n                        // zoomable table.\n                        \" nofastclick \" +\n                        css(styles.dropdown) +\n                        \" \" +\n                        ApiClassNames.INTERACTIVE\n                    }\n                    disabled={this.props.apiOptions.readOnly}\n                    value={this.props.selected}\n                >\n                    <option value={0} disabled>\n                        {this.props.placeholder}\n                    </option>\n                    {choices.map((choice, i) => {\n                        return (\n                            <option key={\"\" + (i + 1)} value={i + 1}>\n                                {choice}\n                            </option>\n                        );\n                    })}\n                </select>\n                <InlineIcon\n                    {...iconDropdownArrow}\n                    style={{\n                        marginLeft: `-${dropdownArrowSize}px`,\n                        height: dropdownArrowSize,\n                        width: dropdownArrowSize,\n                    }}\n                />\n            </div>\n        );\n    },\n\n    focus: function() {\n        ReactDOM.findDOMNode(this).focus();\n        return true;\n    },\n\n    _handleChangeEvent: function(e) {\n        this._handleChange(parseInt(e.target.value));\n    },\n\n    _handleChange: function(selected) {\n        this.props.trackInteraction();\n        this.props.onChange({selected: selected});\n    },\n\n    getUserInput: function() {\n        return {value: this.props.selected};\n    },\n\n    simpleValidate: function(rubric) {\n        return Dropdown.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Dropdown, {\n    validate: function(state, rubric) {\n        var selected = state.value;\n        if (selected === 0) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else {\n            var correct = rubric.choices[selected - 1].correct;\n            return {\n                type: \"points\",\n                earned: correct ? 1 : 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\nvar propTransform = editorProps => {\n    return {\n        placeholder: editorProps.placeholder,\n        choices: _.map(editorProps.choices, choice => choice.content),\n    };\n};\n\nconst styles = StyleSheet.create({\n    dropdown: {\n        appearance: \"none\",\n        backgroundColor: \"transparent\",\n        border: `1px solid ${styleConstants.gray76}`,\n        borderRadius: 4,\n        boxShadow: \"none\",\n        fontFamily: styleConstants.baseFontFamily,\n        padding: `9px ${dropdownArrowSize + 1}px 9px 9px`,\n\n        \":focus\": {\n            outline: \"none\",\n            border: `2px solid ${styleConstants.kaGreen}`,\n            padding: `8px ${dropdownArrowSize}px 8px 8px`,\n        },\n\n        \":focus + svg\": {\n            color: `${styleConstants.kaGreen}`,\n        },\n\n        \":disabled\": {\n            color: styleConstants.gray68,\n        },\n\n        \":disabled + svg\": {\n            color: styleConstants.gray68,\n        },\n    },\n});\n\n_module_.exports = {\n    name: \"dropdown\",\n    displayName: \"Drop down\",\n    defaultAlignment: \"inline-block\",\n    accessible: true,\n    widget: Dropdown,\n    transform: propTransform,\n};\nexport default _module_.exports;\n","import _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-console, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp, space-before-function-paren, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar EditorJsonify = _mixinsEditorJsonifyJsx;\n\nvar BlurInput = _reactComponentsBlurInputJsx;\nvar InfoTip = _componentsInfoTipJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\n\nvar DEFAULT_WIDTH = 400;\nvar DEFAULT_HEIGHT = 400;\n\n/**\n * This is used for editing a name/value pair.\n */\nvar PairEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        name: PropTypes.string,\n        value: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            name: \"\",\n            value: \"\",\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <fieldset className=\"pair-editor\">\n                <label>\n                    Name:{\" \"}\n                    <BlurInput\n                        value={this.props.name}\n                        onChange={this.change(\"name\")}\n                    />\n                </label>\n                <label>\n                    {\" \"}Value:{\" \"}\n                    <BlurInput\n                        value={this.props.value}\n                        onChange={this.change(\"value\")}\n                    />\n                </label>\n            </fieldset>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n/**\n * This is used for editing a set of name/value pairs.\n */\nvar PairsEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        pairs: PropTypes.arrayOf(\n            PropTypes.shape({\n                name: PropTypes.string,\n                value: PropTypes.string,\n            })\n        ).isRequired,\n    },\n\n    render: function() {\n        var editors = _.map(this.props.pairs, (pair, i) => {\n            return (\n                <PairEditor\n                    key={i}\n                    name={pair.name}\n                    value={pair.value}\n                    onChange={this.handlePairChange.bind(this, i)}\n                />\n            );\n        });\n        return (\n            <div>\n                {editors}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    handlePairChange: function(pairIndex, pair) {\n        // If they're both non empty, add a new one\n        var pairs = this.props.pairs.slice();\n        pairs[pairIndex] = pair;\n\n        var lastPair = pairs[pairs.length - 1];\n        if (lastPair.name && lastPair.value) {\n            pairs.push({name: \"\", value: \"\"});\n        }\n        this.change(\"pairs\", pairs);\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\nvar KA_PROGRAM_URL = /khanacademy\\.org\\/computer-programming\\/[^\\/]+\\/(\\d+)/;\n\n/**\n * Given a program URL from the site, extract its program ID.\n * If the input does not match the known URL patterns, it is assumed to be\n * a program ID.\n */\nfunction isolateProgramID(programUrl) {\n    var match = KA_PROGRAM_URL.exec(programUrl);\n    if (match) {\n        programUrl = match[1];\n    }\n\n    return programUrl;\n}\n\n/**\n * This is the main editor for this widget, to specify all the options.\n */\nvar CSProgramEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            programID: \"\",\n            settings: [{name: \"\", value: \"\"}],\n            showEditor: false,\n            showButtons: false,\n            width: DEFAULT_WIDTH,\n            height: DEFAULT_HEIGHT,\n        };\n    },\n\n    render: function() {\n        return (\n            <div>\n                <label>\n                    Url or Program ID:{\" \"}\n                    <BlurInput\n                        name=\"programID\"\n                        value={this.props.programID}\n                        onChange={this._handleProgramIDChange}\n                    />\n                </label>\n                <br />\n                <PropCheckBox\n                    label=\"Show Editor\"\n                    showEditor={this.props.showEditor}\n                    onChange={this.props.onChange}\n                />\n                <InfoTip>\n                    If you show the editor, you should use the \"full-width\"\n                    alignment to make room for the width of the editor.\n                </InfoTip>\n                <br />\n                <PropCheckBox\n                    label=\"Show Buttons\"\n                    showButtons={this.props.showButtons}\n                    onChange={this.props.onChange}\n                />\n                <br />\n                <label>\n                    Settings:\n                    <PairsEditor\n                        name=\"settings\"\n                        pairs={this.props.settings}\n                        onChange={this._handleSettingsChange}\n                    />\n                    <InfoTip>\n                        Settings that you add here are available to the program\n                        as an object returned by <code>Program.settings()</code>\n                    </InfoTip>\n                </label>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    _handleSettingsChange: function(settings) {\n        this.change({settings: settings.pairs});\n    },\n\n    _handleProgramIDChange: function(programID) {\n        programID = isolateProgramID(programID);\n\n        $.getJSON(\n            \"https://www.khanacademy.org/api/internal/scratchpads/\" + programID\n        )\n            .done(programInfo => {\n                this.change({\n                    width: programInfo.width,\n                    height: programInfo.height,\n                    programID: programID,\n                });\n            })\n            .fail((jqxhr, textStatus, error) => {\n                console.error(\n                    \"Error retrieving scratchpad info for \" + \"program ID \",\n                    programID\n                );\n                console.error(textStatus + \", \" + error);\n                this.change({\n                    width: DEFAULT_WIDTH,\n                    height: DEFAULT_HEIGHT,\n                    programID: programID,\n                });\n            });\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = CSProgramEditor;\nexport default _module_.exports;\n","import _utilJs from \"../util.js\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * This widget is for embedding Khan Academy CS programs.\n */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar Changeable = _mixinsChangeableJsx;\nvar updateQueryString = _utilJs.updateQueryString;\n\nvar PADDING_WIDTH = 2;\n\nvar IS_KA_SITE = /khanacademy\\.org/;\nvar KA_EMBED_URL =\n    \"https://{hostname}/computer-programming/program/\" +\n    \"{programID}/embedded?embed=yes&author=no\";\n\nfunction getUrlFromProgramID(programID) {\n    var url = KA_EMBED_URL.replace(\"{programID}\", programID);\n    var currentHostname = document.location.hostname;\n    var embedHostname = \"www.khanacademy.org\";\n    if (IS_KA_SITE.test(currentHostname)) {\n        embedHostname = currentHostname;\n    }\n    return url.replace(\"{hostname}\", embedHostname);\n}\n\n/* This renders the scratchpad in an iframe and handles validation via\n * window.postMessage */\nvar CSProgram = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        programID: PropTypes.string,\n        width: PropTypes.number,\n        height: PropTypes.number,\n        settings: PropTypes.array,\n        showEditor: PropTypes.bool,\n        showButtons: PropTypes.bool,\n        status: PropTypes.oneOf([\"incomplete\", \"incorrect\", \"correct\"]),\n        message: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            showEditor: false,\n            showButtons: false,\n            status: \"incomplete\",\n            // optional message\n            message: null,\n        };\n    },\n\n    handleMessageEvent: function(e) {\n        // We receive data from the iframe that contains {passed: true/false}\n        //  and use that to set the status\n        // It could also contain an optional message\n        var data = {};\n        try {\n            data = JSON.parse(e.originalEvent.data);\n        } catch (err) {\n            return;\n        }\n\n        if (_.isUndefined(data.testsPassed)) {\n            return;\n        }\n\n        var status = data.testsPassed ? \"correct\" : \"incorrect\";\n        this.change({\n            status: status,\n            message: data.message,\n        });\n    },\n\n    componentDidMount: function() {\n        $(window).on(\"message\", this.handleMessageEvent);\n    },\n\n    componentWillUnmount: function() {\n        $(window).off(\"message\", this.handleMessageEvent);\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        if (!this.props.programID) {\n            return <div />;\n        }\n\n        var url = getUrlFromProgramID(this.props.programID);\n        var className;\n        var style = {\n            height: this.props.height,\n        };\n\n        if (this.props.showEditor) {\n            url += \"&editor=yes\";\n            style.width = \"100%\";\n            className = \"perseus-scratchpad-editor\";\n        } else {\n            url += \"&editor=no\";\n            style.width = this.props.width + PADDING_WIDTH;\n            className = \"perseus-scratchpad\";\n        }\n\n        if (this.props.showButtons) {\n            url += \"&buttons=yes\";\n            style.height += 50;\n        } else {\n            url += \"&buttons=no\";\n        }\n\n        // Turn array of [{name: \"\", value: \"\"}] into object\n        if (this.props.settings) {\n            var settings = {};\n            _.each(this.props.settings, function(setting) {\n                if (setting.name && setting.value) {\n                    settings[setting.name] = setting.value;\n                }\n            });\n            // This becomes available to programs as Program.settings()\n            url = updateQueryString(url, \"settings\", JSON.stringify(settings));\n        }\n\n        var sandboxOptions = [\n            \"allow-popups\",\n            \"allow-same-origin\",\n            \"allow-scripts\",\n            \"allow-top-navigation\",\n        ].join(' ');\n\n        // We sandbox the iframe so that we whitelist only the functionality\n        //  that we need. This makes it a bit safer in case some content\n        //  creator \"went wild\".\n        // http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/\n        return (\n            <iframe\n                sandbox={sandboxOptions}\n                src={url}\n                style={style}\n                className={className}\n                allowFullScreen={true}\n            />\n        );\n    },\n\n    simpleValidate: function(rubric) {\n        return CSProgram.validate(\n            {\n                status: this.props.status,\n                message: this.props.message,\n            },\n            rubric\n        );\n    },\n\n    statics: {\n        // The widget's grading function\n        validate: function(state, rubric) {\n            // The iframe can tell us whether it's correct or incorrect,\n            //  and pass an optional message\n            if (state.status === \"correct\") {\n                return {\n                    type: \"points\",\n                    earned: 1,\n                    total: 1,\n                    message: state.message || null,\n                };\n            } else if (state.status === \"incorrect\") {\n                return {\n                    type: \"points\",\n                    earned: 0,\n                    total: 1,\n                    message: state.message || null,\n                };\n            } else {\n                return {\n                    type: \"invalid\",\n                    message: \"Keep going, you're not there yet!\",\n                };\n            }\n        },\n    },\n});\n\n_module_.exports = {\n    name: \"cs-program\",\n    displayName: \"CS Program\",\n    supportedAlignments: [\"block\", \"full-width\"],\n    widget: CSProgram,\n    hidden: true,\n};\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _stylesSharedJs from \"../styles/shared.js\";\nimport _stylesMediaQueriesJs from \"../styles/media-queries.js\";\nimport _utilJs from \"../util.js\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport { iconCircle, iconCircleThin } from \"../icon-paths.js\";\nimport _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _mixinsWidgetJsonifyDeprecatedJsx from \"../mixins/widget-jsonify-deprecated.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _classnames from \"classnames\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst classNames = _classnames;\nconst Changeable = _mixinsChangeableJsx;\nconst WidgetJsonifyDeprecated = _mixinsWidgetJsonifyDeprecatedJsx;\nconst _ = _underscore;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst ApiOptions = _perseusApiJsx2.Options;\nconst InlineIcon = _componentsInlineIconJsx;\nconst Renderer = _rendererJsx;\nconst Util = _utilJs;\nconst mediaQueries = _stylesMediaQueriesJs;\nconst sharedStyles = _stylesSharedJs;\n\nconst Categorizer = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n\n        // List of categories (across the top)\n        categories: PropTypes.arrayOf(PropTypes.string),\n        // List of items that are being categorized (along the left side)\n        items: PropTypes.arrayOf(PropTypes.string),\n        trackInteraction: PropTypes.func.isRequired,\n        // Ordered list of correct answers, mapping items to categories thusly:\n        //   values[<items_index>] == <categories_index>\n        values: PropTypes.arrayOf(PropTypes.number),\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            items: [],\n            categories: [],\n            values: [],\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            uniqueId: _.uniqueId(\"perseus_radio_\"),\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    getUserInput: function() {\n        return WidgetJsonifyDeprecated.getUserInput.call(this);\n    },\n\n    render: function() {\n        const self = this;\n\n        // In this context, isMobile is used to differentiate mobile from\n        // desktop.\n        const isMobile = this.props.apiOptions.isMobile;\n        let indexedItems = this.props.items.map((item, n) => [item, n]);\n        if (this.props.randomizeItems) {\n            indexedItems = Util.shuffle(indexedItems, this.props.problemNum);\n        }\n\n        const table = (\n            <table className=\"categorizer-table\">\n                <thead>\n                    <tr>\n                        <th>&nbsp;</th>\n                        {this.props.categories.map((category, i) => {\n                            // Array index is the correct key here, as that's\n                            // how category grading actually works -- no way\n                            // to add or remove categories or items in the\n                            // middle. (If we later add that, this should be\n                            // fixed.)\n                            return (\n                                <th className={css(styles.header)} key={i}>\n                                    <Renderer\n                                        content={category}\n                                        linterContext={this.props.linterContext}\n                                    />\n                                </th>\n                            );\n                        })}\n                    </tr>\n                </thead>\n                <tbody>\n                    {indexedItems.map(indexedItem => {\n                        var item = indexedItem[0];\n                        var itemNum = indexedItem[1];\n                        var uniqueId = self.state.uniqueId + \"_\" + itemNum;\n                        /* eslint-disable max-len */\n                        return (\n                            <tr key={itemNum}>\n                                <td>\n                                    <Renderer\n                                        content={item}\n                                        linterContext={this.props.linterContext}\n                                    />\n                                </td>\n                                {_.range(\n                                    self.props.categories.length\n                                ).map(catNum => {\n                                    const selected =\n                                        self.props.values[itemNum] === catNum;\n                                    return (\n                                        <td\n                                            className={\n                                                \"category \" +\n                                                css(\n                                                    styles.cell,\n                                                    styles.responsiveCell\n                                                )\n                                            }\n                                            key={catNum}\n                                        >\n                                            {/* a pseudo-label: toggle the\n                                value of the checkbox when this div or the\n                                checkbox is clicked */}\n                                            <div\n                                                className={\n                                                    ApiClassNames.INTERACTIVE\n                                                }\n                                                onClick={this.onChange.bind(\n                                                    this,\n                                                    itemNum,\n                                                    catNum\n                                                )}\n                                            >\n                                                {isMobile &&\n                                                    <input\n                                                        type=\"radio\"\n                                                        name={uniqueId}\n                                                        className={css(\n                                                            sharedStyles.responsiveInput,\n                                                            sharedStyles.responsiveRadioInput\n                                                        )}\n                                                        checked={selected}\n                                                        onChange={this.onChange.bind(\n                                                            this,\n                                                            itemNum,\n                                                            catNum\n                                                        )}\n                                                        onClick={e => e.stopPropagation()}\n                                                    />}\n                                                {!isMobile &&\n                                                    <span\n                                                        className={css(\n                                                            styles.responsiveSpan,\n                                                            styles.radioSpan,\n                                                            selected &&\n                                                                styles.checkedRadioSpan,\n                                                            this.props.static &&\n                                                                selected &&\n                                                                styles.staticCheckedRadioSpan\n                                                        )}\n                                                    >\n                                                        {selected\n                                                            ? <InlineIcon\n                                                                  {...iconCircle}\n                                                              />\n                                                            : <InlineIcon\n                                                                  {...iconCircleThin}\n                                                              />}\n                                                    </span>}\n                                            </div>\n                                        </td>\n                                    );\n                                })}\n                            </tr>\n                        );\n                        /* eslint-enable max-len */\n                    })}\n                </tbody>\n            </table>\n        );\n\n        // TODO(benkomalo): kill CSS-based styling and move everything to\n        // aphrodite.\n        const extraClassNames = classNames({\n            \"categorizer-container\": true,\n            \"static-mode\": this.props.static,\n        });\n        const inlineStyles = this.props.apiOptions.isMobile\n            ? [styles.fullBleedContainer]\n            : [];\n\n        return (\n            <div className={extraClassNames + \" \" + css(...inlineStyles)}>\n                {table}\n            </div>\n        );\n    },\n\n    onChange: function(itemNum, catNum) {\n        var values = _.clone(this.props.values);\n        values[itemNum] = catNum;\n        this.change(\"values\", values);\n        this.props.trackInteraction();\n    },\n\n    simpleValidate: function(rubric) {\n        return Categorizer.validate(this.getUserInput(), rubric);\n    },\n});\n\n_.extend(Categorizer, {\n    validate: function(state, rubric) {\n        var completed = true;\n        var allCorrect = true;\n        _.each(rubric.values, function(value, i) {\n            if (state.values[i] == null) {\n                completed = false;\n            }\n            if (state.values[i] !== value) {\n                allCorrect = false;\n            }\n        });\n        if (!completed) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\n                    \"Make sure you select something for every row.\"\n                ),\n            };\n        }\n        return {\n            type: \"points\",\n            earned: allCorrect ? 1 : 0,\n            total: 1,\n            message: null,\n        };\n    },\n});\n\n// TODO(benkomalo): inject page-margin into Perseus instead of hardcoding.\nconst pageMargin = 16;\nconst styles = StyleSheet.create({\n    fullBleedContainer: {\n        [mediaQueries.mdOrSmaller]: {\n            marginLeft: -pageMargin,\n            marginRight: -pageMargin,\n            overflowX: \"auto\",\n        },\n    },\n\n    header: {\n        textAlign: \"center\",\n        verticalAlign: \"bottom\",\n    },\n\n    cell: {\n        textAlign: \"center\",\n        padding: 0,\n        color: \"#ccc\",\n        verticalAlign: \"middle\",\n    },\n\n    radioSpan: {\n        fontSize: 30,\n        paddingRight: 3,\n\n        \":hover\": {\n            color: \"#999\",\n        },\n    },\n\n    checkedRadioSpan: {\n        color: \"#333\",\n    },\n\n    // .static-mode is applied by the Categorizer when the rendered\n    // widget is static; in this case we gray out the choices to show\n    // the user that the widget can't be interacted with.\n    staticCheckedRadioSpan: {\n        color: \"#888\",\n    },\n});\n\n_module_.exports = {\n    name: \"categorizer\",\n    displayName: \"Categorizer\",\n    widget: Categorizer,\n    transform: editorProps => {\n        return _.pick(editorProps, \"items\", \"categories\", \"randomizeItems\");\n    },\n    staticTransform: editorProps => {\n        return _.pick(\n            editorProps,\n            \"items\",\n            \"categories\",\n            \"values\",\n            \"randomizeItems\"\n        );\n    },\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _categorizerJsx from \"./categorizer.jsx\";\nimport _componentsTextListEditorJsx from \"../components/text-list-editor.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, indent, react/jsx-closing-bracket-location, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst Changeable = _mixinsChangeableJsx;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst TextListEditor = _componentsTextListEditorJsx;\n\nconst Categorizer = _categorizerJsx.widget;\n\nconst CategorizerEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        items: PropTypes.arrayOf(PropTypes.string),\n        categories: PropTypes.arrayOf(PropTypes.string),\n        values: PropTypes.arrayOf(PropTypes.number),\n        randomizeItems: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            items: [],\n            categories: [],\n            values: [],\n            randomizeItems: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        return (\n            <div>\n                <div className=\"perseus-widget-row\">\n                    <PropCheckBox\n                        label=\"Randomize item order\"\n                        labelAlignment=\"right\"\n                        randomizeItems={this.props.randomizeItems}\n                        onChange={this.props.onChange}\n                    />\n                </div>\n                Categories:\n                <TextListEditor\n                    options={this.props.categories}\n                    onChange={cat => {\n                        this.change(\"categories\", cat);\n                    }}\n                    layout=\"horizontal\"\n                />\n                Items:\n                <TextListEditor\n                    options={this.props.items}\n                    onChange={items => {\n                        this.change({\n                            items: items,\n                            // TODO(eater): This truncates props.values so there\n                            // are never more correct answers than items,\n                            // ensuring the widget is possible to answer\n                            // correctly. It doesn't necessarly keep each\n                            // answer with its corresponding item if an item\n                            // is deleted from the middle. Inconvenient, but\n                            // it's at least possible for content creators to\n                            // catch and fix.\n                            values: _.first(this.props.values, items.length),\n                        });\n                    }}\n                    layout=\"vertical\"\n                />\n                <Categorizer\n                    apiOptions={this.props.apiOptions}\n                    items={this.props.items}\n                    categories={this.props.categories}\n                    values={this.props.values}\n                    onChange={newProps => {\n                        this.props.onChange(newProps);\n                    }}\n                    trackInteraction={function() {}}\n                />\n            </div>\n        );\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = CategorizerEditor;\nexport default _module_.exports;\n","import * as React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport Likert1 from \"./likert-scale/likert-face-1.svg\";\nimport Likert2 from \"./likert-scale/likert-face-2.svg\";\nimport Likert3 from \"./likert-scale/likert-face-3.svg\";\nimport Likert4 from \"./likert-scale/likert-face-4.svg\";\nimport Likert5 from \"./likert-scale/likert-face-5.svg\";\n\nexport const LikertFaces = [Likert1, Likert2, Likert3, Likert4, Likert5];\n\nconst styles = StyleSheet.create({\n    container: {\n        // create a new stacking context:\n        position: 'relative',\n        // TODO(aria): better approach to scratchpad z-indexing\n        zIndex: 3, // to match #problemaria > button\n        userSelect: 'none',\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'stretch',\n    },\n    choice: {\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'start',\n        alignItems: 'center',\n        zIndex: 0,\n        borderWidth: 1,\n        borderRadius: 0,\n        marginRight: -1,\n        borderColor: 'gray',\n        backgroundColor: '#eee',\n        padding: 15,\n        ':hover': {\n            zIndex: 1,\n            outline: '2px solid aqua',\n        },\n        ':focus-visible': {\n            zIndex: 1,\n            outline: '2px solid aqua',\n        },\n        ':active': {\n            backgroundColor: 'deepskyblue',\n        },\n    },\n    first: {\n        borderTopLeftRadius: 5,\n        borderBottomLeftRadius: 5,\n    },\n    last: {\n        borderTopRightRadius: 5,\n        borderBottomRightRadius: 5,\n        marginRight: 0,\n    },\n    selectedChoice: {\n        backgroundColor: 'deepskyblue',\n    },\n    face: {\n        display: 'block',\n        height: 50,\n        width: 50,\n        marginBottom: 5,\n    },\n});\n\nclass LikertChoice extends React.PureComponent {\n    static propTypes = {\n        value: PropTypes.number.isRequired,\n        onSelect: PropTypes.func.isRequired,\n        image: PropTypes.string.isRequired,\n        label: PropTypes.string.isRequired,\n    };\n\n    render = () => {\n        const isSelected = this.props.selected === this.props.value;\n        return <button\n            type=\"button\"\n            role=\"radio\"\n            aria-checked={isSelected}\n            className={css(styles.choice, this.props.value === 1 && styles.first, this.props.value === 5 && styles.last, isSelected && styles.selectedChoice)}\n            onClick={this._handleSelect}\n        >\n            <img className={css(styles.face)} src={this.props.image} alt={this.props.alt} title={this.props.alt} />\n            {this.props.label}\n        </button>;\n    }\n\n    _handleSelect = () => {\n        this.props.onSelect(this.props.value);\n    }\n}\n\nclass LikertScale extends React.PureComponent {\n    static propTypes = {\n        labels: PropTypes.arrayOf(PropTypes.string).isRequired,\n        selected: PropTypes.oneOf([null, 1, 2, 3, 4, 5]),\n        onChange: PropTypes.func.isRequired,\n    };\n\n    static defaultProps = {\n        selected: null,\n    };\n\n    constructor(props) {\n        super(props)\n    }\n\n    render = () => {\n        return <div role=\"radiogroup\" className={css(styles.container)}>\n            {this.props.labels.map((label, index) => (\n                <LikertChoice\n                    value={index + 1}\n                    image={LikertFaces[index]}\n                    label={label}\n                    selected={this.props.selected}\n                    onSelect={this._handleChoice}\n                />\n            ))}\n        </div>;\n    };\n\n    _handleChoice = (selected) => {\n        this.props.onChange({selected: selected});\n    };\n\n    getUserInput = () => {\n        return {\n            selected: this.props.selected,\n            label: this.props.selected == null ? null :\n                this.props.labels[this.props.selected - 1],\n        };\n    };\n\n    simpleValidate = (rubric, onInputError) => {\n        if (this.props.selected == null) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        }\n        return {\n            type: \"points\",\n            earned: 1,\n            total: 1,\n        };\n    };\n}\n\nconst editorPropsToWidgetProps = (editorProps) => {\n    return {\n        labels: editorProps.labels\n    };\n};\n\n\nconst LikertScaleInfo = {\n    name: \"likert-scale\",\n    displayName: \"Likert Scale\",\n\n    // Tell the renderer what type of `display:` style we would like\n    // for the component wrapping this one.\n    defaultAlignment: \"block\",\n\n    widget: LikertScale,\n\n    transform: editorPropsToWidgetProps,\n};\n\nexport default LikertScaleInfo;\n","export default __webpack_public_path__ + \"static/media/likert-face-1.e2a4a672.svg\";","export default __webpack_public_path__ + \"static/media/likert-face-2.3b5ea4d5.svg\";","export default __webpack_public_path__ + \"static/media/likert-face-3.d234c14a.svg\";","export default __webpack_public_path__ + \"static/media/likert-face-4.59b6a841.svg\";","export default __webpack_public_path__ + \"static/media/likert-face-5.a3c5de77.svg\";","import * as React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport { LikertFaces } from './likert-scale.jsx';\n\nconst styles = StyleSheet.create({\n    face: {\n        display: 'inline-block',\n        width: 30,\n        height: 30,\n        margin: 5,\n        verticalAlign: 'middle',\n    },\n});\n\nclass LikertScaleEditor extends React.Component {\n    static propTypes = {\n        labels: PropTypes.arrayOf(PropTypes.string),\n        onChange: PropTypes.func.isRequired,\n    };\n\n    static defaultProps = {\n        labels: [\"\", \"\", \"\", \"\", \"\"],\n    };\n\n    constructor(props) {\n        super(props)\n    }\n\n    render() {\n        return <div>\n            Choice Labels:\n            {this.props.labels.map((label, i) => (\n                <div>\n                    <img className={css(styles.face)} src={LikertFaces[i]} alt=\"\" />\n                    <input type=\"text\" className={css(styles.labelInput)} value={label} onChange={(e) => this._changeLabel(i, e.target.value)} />\n                </div>\n            ))}\n        </div>\n    }\n\n    _changeLabel = (index, newLabel) => {\n        this.props.onChange({\n            labels: this.props.labels.map((label, i) => i === index ? newLabel : label),\n        });\n    };\n\n    serialize() {\n        return {\n            labels: this.props.labels,\n        };\n    }\n}\n\nexport default LikertScaleEditor;\n","import _widgetsSimpleMarkdownTesterEditorJsx from \"./widgets/simple-markdown-tester-editor.jsx\";\nimport _widgetsSimpleMarkdownTesterJsx from \"./widgets/simple-markdown-tester.jsx\";\nimport _widgetsExampleWidgetEditorJsx from \"./widgets/example-widget-editor.jsx\";\nimport _widgetsExampleWidgetJsx from \"./widgets/example-widget.jsx\";\nimport _widgetsExampleGraphieWidgetEditorJsx from \"./widgets/example-graphie-widget-editor.jsx\";\nimport _widgetsExampleGraphieWidgetJsx from \"./widgets/example-graphie-widget.jsx\";\nimport _widgetsVideoEditorJsx from \"./widgets/video-editor.jsx\";\nimport _widgetsVideoJsx from \"./widgets/video.jsx\";\nimport _widgetsUnitEditorJsx from \"./widgets/unit-editor.jsx\";\nimport _widgetsUnitJsx from \"./widgets/unit.jsx\";\nimport _widgetsTransformerEditorJsx from \"./widgets/transformer-editor.jsx\";\nimport _widgetsTransformerJsx from \"./widgets/transformer.jsx\";\nimport _widgetsTableEditorJsx from \"./widgets/table-editor.jsx\";\nimport _widgetsTableJsx from \"./widgets/table.jsx\";\nimport _widgetsSorterEditorJsx from \"./widgets/sorter-editor.jsx\";\nimport _widgetsSorterJsx from \"./widgets/sorter.jsx\";\nimport _widgetsSimulatorEditorJsx from \"./widgets/simulator-editor.jsx\";\nimport _widgetsSimulatorJsx from \"./widgets/simulator.jsx\";\nimport _widgetsSequenceEditorJsx from \"./widgets/sequence-editor.jsx\";\nimport _widgetsSequenceJsx from \"./widgets/sequence.jsx\";\nimport _widgetsReactionDiagramEditorJsx from \"./widgets/reaction-diagram-editor.jsx\";\nimport _widgetsReactionDiagramJsx from \"./widgets/reaction-diagram.jsx\";\nimport _widgetsPlotterEditorJsx from \"./widgets/plotter-editor.jsx\";\nimport _widgetsPlotterJsx from \"./widgets/plotter.jsx\";\nimport _widgetsPassageRefTargetEditorJsx from \"./widgets/passage-ref-target-editor.jsx\";\nimport _widgetsPassageRefTargetJsx from \"./widgets/passage-ref-target.jsx\";\nimport _widgetsPassageRefEditorJsx from \"./widgets/passage-ref-editor.jsx\";\nimport _widgetsPassageRefJsx from \"./widgets/passage-ref.jsx\";\nimport _widgetsPassageEditorJsx from \"./widgets/passage-editor.jsx\";\nimport _widgetsPassageJsx from \"./widgets/passage.jsx\";\nimport _widgetsOrdererEditorJsx from \"./widgets/orderer-editor.jsx\";\nimport _widgetsOrdererJsx from \"./widgets/orderer.jsx\";\nimport _widgetsNumberLineEditorJsx from \"./widgets/number-line-editor.jsx\";\nimport _widgetsNumberLineJsx from \"./widgets/number-line.jsx\";\nimport _widgetsMoleculeEditorJsx from \"./widgets/molecule-editor.jsx\";\nimport _widgetsMoleculeJsx from \"./widgets/molecule.jsx\";\nimport _widgetsMeasurerEditorJsx from \"./widgets/measurer-editor.jsx\";\nimport _widgetsMeasurerJsx from \"./widgets/measurer.jsx\";\nimport _widgetsMatcherEditorJsx from \"./widgets/matcher-editor.jsx\";\nimport _widgetsMatcherJsx from \"./widgets/matcher.jsx\";\nimport _widgetsMatrixEditorJsx from \"./widgets/matrix-editor.jsx\";\nimport _widgetsMatrixJsx from \"./widgets/matrix.jsx\";\nimport _widgetsLightsPuzzleEditorJsx from \"./widgets/lights-puzzle-editor.jsx\";\nimport _widgetsLightsPuzzleJsx from \"./widgets/lights-puzzle.jsx\";\nimport _widgetsInteractiveGraphEditorJsx from \"./widgets/interactive-graph-editor.jsx\";\nimport _widgetsInteractiveGraphJsx from \"./widgets/interactive-graph.jsx\";\nimport _widgetsInteractionEditorJsx from \"./widgets/interaction-editor.jsx\";\nimport _widgetsInteractionJsx from \"./widgets/interaction.jsx\";\nimport _widgetsImageEditorJsx from \"./widgets/image-editor.jsx\";\nimport _widgetsImageJsx from \"./widgets/image.jsx\";\nimport _widgetsIframeEditorJsx from \"./widgets/iframe-editor.jsx\";\nimport _widgetsIframeJsx from \"./widgets/iframe.jsx\";\nimport _widgetsGroupEditorJsx from \"./widgets/group-editor.jsx\";\nimport _widgetsGroupJsx from \"./widgets/group.jsx\";\nimport _widgetsGradedGroupSetEditorJsx from \"./widgets/graded-group-set-editor.jsx\";\nimport _widgetsGradedGroupSetJsx from \"./widgets/graded-group-set.jsx\";\nimport _widgetsGradedGroupEditorJsx from \"./widgets/graded-group-editor.jsx\";\nimport _widgetsGradedGroupJsx from \"./widgets/graded-group.jsx\";\nimport _widgetsGrapherEditorJsx from \"./widgets/grapher-editor.jsx\";\nimport _widgetsGrapherJsx from \"./widgets/grapher.jsx\";\nimport _widgetsDefinitionEditorJsx from \"./widgets/definition-editor.jsx\";\nimport _widgetsDefinitionJsx from \"./widgets/definition.jsx\";\nimport _widgetsExplanationEditorJsx from \"./widgets/explanation-editor.jsx\";\nimport _widgetsExplanationJsx from \"./widgets/explanation.jsx\";\nimport _widgetsDropdownEditorJsx from \"./widgets/dropdown-editor.jsx\";\nimport _widgetsDropdownJsx from \"./widgets/dropdown.jsx\";\nimport _widgetsCsProgramEditorJsx from \"./widgets/cs-program-editor.jsx\";\nimport _widgetsCsProgramJsx from \"./widgets/cs-program.jsx\";\nimport _widgetsCategorizerEditorJsx from \"./widgets/categorizer-editor.jsx\";\nimport _widgetsCategorizerJsx from \"./widgets/categorizer.jsx\";\nimport LikertScaleEditor from \"./widgets/likert-scale-editor.jsx\";\nimport LikertScale from \"./widgets/likert-scale.jsx\";\n\n// TODO(aria): Env variable & bundling magic?\nconst __EDITOR__ = true;\n\n// As new widgets get added here, please also make sure they get added in\n// webapp perseus/traversal.py so they can be properly translated.\nconst allWidgets = [\n    [_widgetsCategorizerJsx, __EDITOR__ && _widgetsCategorizerEditorJsx],\n    [_widgetsCsProgramJsx, __EDITOR__ && _widgetsCsProgramEditorJsx],\n    [_widgetsDropdownJsx, __EDITOR__ && _widgetsDropdownEditorJsx],\n    [_widgetsExplanationJsx, __EDITOR__ && _widgetsExplanationEditorJsx],\n    [_widgetsDefinitionJsx, __EDITOR__ && _widgetsDefinitionEditorJsx],\n    [_widgetsGrapherJsx, __EDITOR__ && _widgetsGrapherEditorJsx],\n    [_widgetsGradedGroupJsx, __EDITOR__ && _widgetsGradedGroupEditorJsx],\n    [_widgetsGradedGroupSetJsx, __EDITOR__ && _widgetsGradedGroupSetEditorJsx],\n    [_widgetsGroupJsx, __EDITOR__ && _widgetsGroupEditorJsx],\n    [_widgetsIframeJsx, __EDITOR__ && _widgetsIframeEditorJsx],\n    [_widgetsImageJsx, __EDITOR__ && _widgetsImageEditorJsx],\n    [_widgetsInteractionJsx, __EDITOR__ && _widgetsInteractionEditorJsx],\n    [_widgetsInteractiveGraphJsx, __EDITOR__ && _widgetsInteractiveGraphEditorJsx],\n    [_widgetsLightsPuzzleJsx, __EDITOR__ && _widgetsLightsPuzzleEditorJsx],\n    [_widgetsMatrixJsx, __EDITOR__ && _widgetsMatrixEditorJsx],\n    [_widgetsMatcherJsx, __EDITOR__ && _widgetsMatcherEditorJsx],\n    [_widgetsMeasurerJsx, __EDITOR__ && _widgetsMeasurerEditorJsx],\n    [_widgetsMoleculeJsx, __EDITOR__ && _widgetsMoleculeEditorJsx],\n    [_widgetsNumberLineJsx, __EDITOR__ && _widgetsNumberLineEditorJsx],\n    [_widgetsOrdererJsx, __EDITOR__ && _widgetsOrdererEditorJsx],\n    [_widgetsPassageJsx, __EDITOR__ && _widgetsPassageEditorJsx],\n    [_widgetsPassageRefJsx, __EDITOR__ && _widgetsPassageRefEditorJsx],\n    [_widgetsPassageRefTargetJsx, __EDITOR__ && _widgetsPassageRefTargetEditorJsx],\n    [_widgetsPlotterJsx, __EDITOR__ && _widgetsPlotterEditorJsx],\n    [_widgetsReactionDiagramJsx, __EDITOR__ && _widgetsReactionDiagramEditorJsx],\n    [_widgetsSequenceJsx, __EDITOR__ && _widgetsSequenceEditorJsx],\n    [_widgetsSimulatorJsx, __EDITOR__ && _widgetsSimulatorEditorJsx],\n    [_widgetsSorterJsx, __EDITOR__ && _widgetsSorterEditorJsx],\n    [_widgetsTableJsx, __EDITOR__ && _widgetsTableEditorJsx],\n    [_widgetsTransformerJsx, __EDITOR__ && _widgetsTransformerEditorJsx],\n    [_widgetsUnitJsx, __EDITOR__ && _widgetsUnitEditorJsx],\n    [_widgetsVideoJsx, __EDITOR__ && _widgetsVideoEditorJsx],\n    [LikertScale, LikertScaleEditor],\n    // These widgets are only used when testing things, so remove them in the\n    // non-editor bundle.\n    //__EDITOR__ && [\n    //    _widgetsExampleGraphieWidgetJsx,\n    //    _widgetsExampleGraphieWidgetEditorJsx,\n    //],\n    //__EDITOR__ && [\n    //    _widgetsExampleWidgetJsx,\n    //    _widgetsExampleWidgetEditorJsx,\n    //],\n    //__EDITOR__ && [\n    //    _widgetsSimpleMarkdownTesterJsx,\n    //    _widgetsSimpleMarkdownTesterEditorJsx,\n    //],\n];\nexport default allWidgets;\n","import _extraWidgetsJs from \"./extra-widgets.js\";\nimport _widgetsJs from \"./widgets.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * This should be called by all clients, specifying whether extra widgets are\n * needed via `loadExtraWidgets`. It is idempotent, so it's not a problem to\n * call it multiple times.\n *\n * skipMathJax:\n *   if false/undefined, MathJax will be configured, and the\n *   promise will wait for MathJax to load (if it hasn't already).\n * loadExtraWidgets:\n *   if true, `extra-widgets` will be required. The client must have already\n *   loaded the file, either by using the full perseus bundle\n *   `/build/perseus.js`, or by loading `/build/perseus-extras.js` prior to\n *   calling `Perseus.init()`.\n */\n\nconst init = function(options) {\n    // Pass skipMathJax: true if MathJax is already loaded and configured.\n    const skipMathJax = options.skipMathJax;\n\n    const widgetsDeferred = $.Deferred();\n\n    // HACK(charlie): To maintain backwards compatibility, only exclude the\n    // extra widgets if the parameter is explicitly falsey (rather than merely\n    // undefined). We should probably bump the Perseus major version number\n    // (since this is a breaking change in the API) but this is a more\n    // lightweight fix that will get exercises working in our mobile apps\n    // immediately.\n\n    // TODO(aria): Re-enable extra-widgets\n\n    //if (options.loadExtraWidgets === undefined || options.loadExtraWidgets) {\n    //    const Widgets = _widgetsJs;\n    //    require.ensure(\n    //        [],\n    //        require => {\n    //            const extraWidgets = _extraWidgetsJs;\n    //            Widgets.registerMany(extraWidgets);\n    //            widgetsDeferred.resolve();\n    //        },\n    //        \"extra-widgets\"\n    //    );\n    //} else {\n        widgetsDeferred.resolve();\n    //}\n\n    const mathJaxDeferred = $.Deferred();\n\n    if (skipMathJax) {\n        mathJaxDeferred.resolve();\n    } else {\n        MathJax.Hub.Config({\n            messageStyle: \"none\",\n            skipStartupTypeset: \"none\",\n            \"HTML-CSS\": {\n                availableFonts: [\"TeX\"],\n                imageFont: null,\n                scale: 100,\n                showMathMenu: false,\n            },\n        });\n\n        MathJax.Hub.Configured();\n        MathJax.Hub.Queue(mathJaxDeferred.resolve);\n    }\n\n    return widgetsDeferred.then(() => mathJaxDeferred);\n};\n\n_module_.exports = init;\nexport default _module_.exports;\n","import _utilJs from \"../util.js\";\nimport { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _gorgonGorgonJs from \"../gorgon/gorgon.js\";\nimport _componentsMathOutputJsx from \"../components/math-output.jsx\";\nimport _textInputJsx from \"./text-input.jsx\";\nimport _rendererJsx from \"../renderer.jsx\";\nimport _mathInputJsx from \"./math-input.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactComponentsTooltipJsx from \"react-components/tooltip.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable react/sort-comp */\n\nconst React = _react;\nconst Tooltip = _reactComponentsTooltipJsx;\nconst _ = _underscore;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst MathInput = _mathInputJsx;\nconst Renderer = _rendererJsx;\nconst TextInput = _textInputJsx;\nconst MathOutput = _componentsMathOutputJsx;\n\nconst Gorgon = _gorgonGorgonJs;\n\nconst captureScratchpadTouchStart = _utilJs\n    .captureScratchpadTouchStart;\n\nconst MATH = \"math\";\nconst TEXT = \"text\";\nconst TEX = \"tex\";\n\nconst InputWithExamples = createReactClass({\n    propTypes: {\n        type: PropTypes.oneOf([MATH, TEXT, TEX]),\n        value: PropTypes.string,\n        onChange: PropTypes.func.isRequired,\n        className: PropTypes.string,\n        examples: PropTypes.arrayOf(PropTypes.string).isRequired,\n        shouldShowExamples: PropTypes.bool,\n        convertDotToTimes: PropTypes.bool,\n        buttonSet: PropTypes.string,\n        buttonsVisible: PropTypes.oneOf([\"always\", \"never\", \"focused\"]),\n        labelText: PropTypes.string,\n        onFocus: PropTypes.func,\n        onBlur: PropTypes.func,\n        disabled: PropTypes.bool,\n\n        // A unique string identifying this InputWithExamples\n        id: PropTypes.string.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            type: TEXT,\n            shouldShowExamples: true,\n            onFocus: function() {},\n            onBlur: function() {},\n            disabled: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            focused: false,\n            showExamples: false,\n        };\n    },\n\n    _getUniqueId: function() {\n        return `input-with-examples-${btoa(this.props.id).replace(/=/g, \"\")}`;\n    },\n\n    _getInputClassName: function() {\n        // <MathOutput> is a special component that manages its own class and\n        // state, as it's a <span> that wants to act like an <input>.\n        if (this.props.type === TEX) {\n            return this.props.className;\n        }\n\n        // Otherwise, we need to add these INPUT and FOCUSED tags here.\n        let className = ApiClassNames.INPUT + \" \" + ApiClassNames.INTERACTIVE;\n        if (this.state.focused) {\n            className += \" \" + ApiClassNames.FOCUSED;\n        }\n        if (this.props.className) {\n            className += \" \" + this.props.className;\n        }\n        return className;\n    },\n\n    _getPropsForInputType: function() {\n        // Minimal set of props, used by each input type\n        const inputProps = {\n            \"aria-describedby\": this._getUniqueId(),\n            ref: \"input\",\n            className: this._getInputClassName(),\n            labelText: this.props.labelText,\n            value: this.props.value,\n            onFocus: this._handleFocus,\n            onBlur: this._handleBlur,\n            disabled: this.props.disabled,\n        };\n\n        if (this.props.type === TEX) {\n            return inputProps;\n        }\n\n        // Add useful props required for MATH and TEXT modes\n        _.extend(inputProps, {\n            onChange: this.props.onChange,\n            onTouchStart: captureScratchpadTouchStart,\n        });\n\n        // And add final props that are MATH- and TEXT-specific\n        if (this.props.type === MATH) {\n            return _.extend(\n                {\n                    buttonSet: this.props.buttonSet,\n                    buttonsVisible: this.props.buttonsVisible,\n                    convertDotToTimes: this.props.convertDotToTimes,\n                },\n                inputProps\n            );\n        } else if (this.props.type === TEXT) {\n            return _.extend(\n                {\n                    autoCapitalize: \"off\",\n                    autoComplete: \"off\",\n                    autoCorrect: \"off\",\n                    spellCheck: \"false\",\n                },\n                inputProps\n            );\n        }\n    },\n\n    _getComponentForInputType: function() {\n        switch (this.props.type) {\n            case TEX:\n                return MathOutput;\n\n            case MATH:\n                return MathInput;\n\n            case TEXT:\n                return TextInput;\n\n            default:\n                return null;\n        }\n    },\n\n    _renderInput: function() {\n        const inputProps = this._getPropsForInputType();\n        const InputComponent = this._getComponentForInputType();\n        return <InputComponent {...inputProps} />;\n    },\n\n    render: function() {\n        const input = this._renderInput();\n\n        // Static rendering, which doesn't include the 'tooltip' logic that the\n        // other types require, and is hence handled separately.\n        if (this.props.type === TEX) {\n            return input;\n        }\n\n        // Else, we need to be able to show examples\n        const examplesContent = _.map(this.props.examples, example => {\n            return \"- \" + example;\n        }).join(\"\\n\");\n\n        const showExamples =\n            this.props.shouldShowExamples && this.state.showExamples;\n\n        return (\n            <Tooltip\n                ref=\"tooltip\"\n                className=\"perseus-formats-tooltip preview-measure\"\n                horizontalPosition=\"left\"\n                horizontalAlign=\"left\"\n                verticalPosition=\"bottom\"\n                arrowSize={10}\n                borderColor=\"#ccc\"\n                show={showExamples}\n            >\n                {input}\n                <div id={this._getUniqueId()}>\n                    <Renderer\n                        content={examplesContent}\n                        linterContext={\n                            Gorgon.pushContextStack(\n                                this.props.linterContext, 'input-with-examples'\n                            )\n                        }\n                    />\n                </div>\n            </Tooltip>\n        );\n    },\n\n    _handleFocus: function() {\n        this.props.onFocus();\n        this.setState({\n            focused: true,\n            showExamples: true,\n        });\n    },\n\n    show: function() {\n        this.setState({showExamples: true});\n    },\n\n    hide: function() {\n        this.setState({showExamples: false});\n    },\n\n    _handleBlur: function() {\n        this.props.onBlur();\n        this.setState({\n            focused: false,\n            showExamples: false,\n        });\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n    },\n\n    blur: function() {\n        this.refs.input.blur();\n    },\n\n    handleChange: function(e) {\n        this.props.onChange(e.target.value);\n    },\n});\n\n_module_.exports = InputWithExamples;\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport _hubbleIndexJs from \"../hubble/index.js\";\nimport { iconExclamationSign } from \"../icon-paths.js\";\nimport { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _mathInput3 from \"@khanacademy/math-input\";\nimport _mathInput2 from \"@khanacademy/math-input\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _componentsTexButtonsJsx from \"../components/tex-buttons.jsx\";\nimport _componentsMathInputJsx from \"../components/math-input.jsx\";\nimport _componentsInputWithExamplesJsx from \"../components/input-with-examples.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _utilAnswerTypesJs from \"../util/answer-types.js\";\nimport _perseusApiJsx3 from \"../perseus-api.jsx\";\nimport _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactComponentsTooltipJsx from \"react-components/tooltip.jsx\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, no-redeclare, no-undef, no-unused-vars, no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar classNames = _classnames;\nvar React = _react;\nvar ReactDOM = _reactDom;\nvar Tooltip = _reactComponentsTooltipJsx;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar Changeable = _mixinsChangeableJsx;\nvar ApiOptions = _perseusApiJsx2.Options;\nvar ApiClassNames = _perseusApiJsx3.ClassNames;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\n\nconst InlineIcon = _componentsInlineIconJsx;\nvar InputWithExamples = _componentsInputWithExamplesJsx;\nvar MathInput = _componentsMathInputJsx;\nvar TexButtons = _componentsTexButtonsJsx;\nconst {KeypadInput} = _mathInput.components;\nconst {\n    keypadConfigurationPropType,\n    keypadElementPropType,\n} = _mathInput2.propTypes;\nconst {KeypadTypes} = _mathInput3.consts;\n\nvar lens = _hubbleIndexJs;\n\nvar ERROR_MESSAGE = i18n._(\"Sorry, I don't understand that!\");\n\n// TODON'T(emily): Don't delete these.\nvar NO_ANSWERS_WARNING = [\n    \"An expression without an answer\",\n    \"is no expression to me.\",\n    \"Who can learn from an input\",\n    \"like the one that I see?\",\n    \"Put something in there\",\n    \"won't you please?\",\n    \"A few digits will do -\",\n    \"might I suggest some threes?\",\n].join(\"\\n\");\nvar NO_CORRECT_ANSWERS_WARNING =\n    \"This question is probably going to be too \" +\n    \"hard because the expression has no correct answer.\";\nvar SIMPLIFY_WARNING = str => {\n    return (\n        `\"${str}\" is required to be simplified but is not considered ` +\n        \"simplified by our fancy computer algebra system. This will be \" +\n        \"graded as incorrect.\"\n    );\n};\nvar PARSE_WARNING = str => `\"${str}\" <- you sure that's math?`;\nvar NOT_SPECIFIED_WARNING = ix => {\n    return `mind filling in answer ${ix}? (the blank one)`;\n};\n\nvar insertBraces = value => {\n    // HACK(alex): Make sure that all LaTeX super/subscripts are wrapped\n    // in curly braces to avoid the mismatch between KAS and LaTeX sup/sub\n    // parsing.\n    //\n    // What exactly is this mismatch? Due to its heritage of parsing plain\n    // text math from <OldExpression />, KAS parses \"x^12\" as x^(12).\n    // This is both generally what the user expects to happen, and is\n    // consistent with other computer algebra systems. It is NOT\n    // consistent with LaTeX however, where x^12 is equivalent to x^{1}2.\n    //\n    // Since the only LaTeX we parse comes from MathQuill, this wouldn't\n    // be a problem if MathQuill just always gave us the latter version\n    // (with explicit braces). However, instead it always gives the former.\n    // This behavior is baked in pretty deep; my naive attempts at changing\n    // it triggered all sorts of confusing errors. So instead we just make\n    // sure to add in any missing braces before grading MathQuill input.\n    //\n    // TODO(alex): Properly hack MathQuill to always use explicit braces.\n    return value.replace(/([_^])([^{])/g, \"$1{$2}\");\n};\n\n// The new, MathQuill input expression widget\nvar Expression = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        buttonSets: TexButtons.buttonSetsType,\n        buttonsVisible: PropTypes.oneOf([\"always\", \"never\", \"focused\"]),\n        functions: PropTypes.arrayOf(PropTypes.string),\n        keypadConfiguration: keypadConfigurationPropType,\n        keypadElement: keypadElementPropType,\n        times: PropTypes.bool,\n        trackInteraction: PropTypes.func.isRequired,\n        value: PropTypes.string,\n        widgetId: PropTypes.string.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: \"\",\n            times: false,\n            functions: [],\n            buttonSets: [\"basic\", \"trig\", \"prealgebra\", \"logarithms\"],\n            onFocus: function() {},\n            onBlur: function() {},\n            apiOptions: ApiOptions.defaults,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            showErrorTooltip: false,\n            showErrorText: false,\n        };\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    parse: function(value, props) {\n        // TODO(jack): Disable icu for content creators here, or\n        // make it so that solution answers with ','s or '.'s work\n        var options = _.pick(props || this.props, \"functions\");\n        if (window.icu && window.icu.getDecimalFormatSymbols) {\n            _.extend(options, window.icu.getDecimalFormatSymbols());\n        }\n        return KAS.parse(insertBraces(value), options);\n    },\n\n    render: function() {\n        if (this.props.apiOptions.customKeypad) {\n            return (\n                <KeypadInput\n                    ref=\"input\"\n                    value={this.props.value}\n                    keypadElement={this.props.keypadElement}\n                    onChange={this.changeAndTrack}\n                    onFocus={() => {\n                        this.props.keypadElement.configure(\n                            this.props.keypadConfiguration,\n                            () => {\n                                if (this.isMounted()) {\n                                    this._handleFocus();\n                                }\n                            }\n                        );\n                    }}\n                    onBlur={this._handleBlur}\n                />\n            );\n        } else if (this.props.apiOptions.staticRender) {\n            // To make things slightly easier, we just use an InputWithExamples\n            // component to handle the static rendering, which is the same\n            // component used by InputNumber and NumericInput\n            return (\n                <InputWithExamples\n                    ref=\"input\"\n                    value={this.props.value}\n                    type={\"tex\"}\n                    examples={[]}\n                    shouldShowExamples={false}\n                    onChange={this.changeAndTrack}\n                    onFocus={this._handleFocus}\n                    onBlur={this._handleBlur}\n                    id={this.props.widgetId}\n                    linterContext={this.props.linterContext}\n                />\n            );\n        } else {\n            // TODO(alex): Style this tooltip to be more consistent with other\n            // tooltips on the site; align to left middle (once possible)\n            var errorTooltip = (\n                <span className=\"error-tooltip\">\n                    <Tooltip\n                        className=\"error-text-container\"\n                        horizontalPosition=\"right\"\n                        horizontalAlign=\"left\"\n                        verticalPosition=\"top\"\n                        arrowSize={10}\n                        borderColor=\"#fcc335\"\n                        show={this.state.showErrorText}\n                    >\n                        <span\n                            className=\"error-icon\"\n                            onMouseEnter={() => {\n                                this.setState({showErrorText: true});\n                            }}\n                            onMouseLeave={() => {\n                                this.setState({showErrorText: false});\n                            }}\n                            onClick={() => {\n                                // TODO(alex): Better error feedback for mobile\n                                this.setState({\n                                    showErrorText: !this.state.showErrorText,\n                                });\n                            }}\n                        >\n                            <InlineIcon {...iconExclamationSign} />\n                        </span>\n                        <div className=\"error-text\">\n                            {ERROR_MESSAGE}\n                        </div>\n                    </Tooltip>\n                </span>\n            );\n\n            var className = classNames({\n                \"perseus-widget-expression\": true,\n                \"show-error-tooltip\": this.state.showErrorTooltip,\n            });\n\n            return (\n                <span className={className}>\n                    <MathInput\n                        ref=\"input\"\n                        className={ApiClassNames.INTERACTIVE}\n                        value={this.props.value}\n                        onChange={this.changeAndTrack}\n                        convertDotToTimes={this.props.times}\n                        buttonsVisible={this.props.buttonsVisible || \"focused\"}\n                        buttonSets={this.props.buttonSets}\n                        onFocus={this._handleFocus}\n                        onBlur={this._handleBlur}\n                    />\n                    {this.state.showErrorTooltip && errorTooltip}\n                </span>\n            );\n        }\n    },\n\n    changeAndTrack: function(e, cb) {\n        this.change(\"value\", e, cb);\n        this.props.trackInteraction();\n    },\n\n    _handleFocus: function() {\n        this.props.onFocus([]);\n    },\n\n    _handleBlur: function() {\n        this.props.onBlur([]);\n    },\n\n    errorTimeout: null,\n\n    // Whenever the input value changes, attempt to parse it.\n    //\n    // Clear any errors if this parse succeeds, show an error within a second\n    // if it fails.\n    componentWillReceiveProps: function(nextProps) {\n        if (\n            !_.isEqual(this.props.value, nextProps.value) ||\n            !_.isEqual(this.props.functions, nextProps.functions)\n        ) {\n            clearTimeout(this.errorTimeout);\n\n            if (this.parse(nextProps.value, nextProps).parsed) {\n                this.setState({showErrorTooltip: false});\n            } else {\n                // Store timeout ID so that we can clear it above\n                this.errorTimeout = setTimeout(() => {\n                    var apiResult = this.props.apiOptions.onInputError(\n                        null, // reserved for some widget identifier\n                        this.props.value,\n                        ERROR_MESSAGE\n                    );\n                    if (apiResult !== false) {\n                        this.setState({showErrorTooltip: true});\n                    }\n                }, 2000);\n            }\n        }\n    },\n\n    componentWillUnmount: function() {\n        clearTimeout(this.errorTimeout);\n    },\n\n    focus: function() {\n        if (this.props.apiOptions.customKeypad) {\n            this.refs.input.focus();\n        } else {\n            // The buttons are often on top of text you're trying to read, so\n            // don't focus the editor automatically.\n        }\n\n        return true;\n    },\n\n    focusInputPath: function(inputPath) {\n        this.refs.input.focus();\n    },\n\n    blurInputPath: function(inputPath) {\n        this.refs.input.blur();\n    },\n\n    // HACK(joel)\n    insert: function(text) {\n        if (!this.props.apiOptions.staticRender) {\n            this.refs.input.insert(text);\n        }\n    },\n\n    getInputPaths: function() {\n        // The widget itself is an input, so we return a single empty list to\n        // indicate this.\n        return [[]];\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        return \"expression\";\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        this.props.onChange(\n            {\n                value: newValue,\n            },\n            cb\n        );\n    },\n\n    getAcceptableFormatsForInputPath: function() {\n        // TODO(charlie): What format does the mobile team want this in?\n        return null;\n    },\n\n    getUserInput: function() {\n        return insertBraces(this.props.value);\n    },\n\n    simpleValidate: function(rubric, onInputError) {\n        onInputError = onInputError || function() {};\n        return Expression.validate(this.getUserInput(), rubric, onInputError);\n    },\n});\n\n/* Content creators input a list of answers which are matched from top to\n * bottom. The intent is that they can include spcific solutions which should\n * be graded as correct or incorrect (or ungraded!) first, then get more\n * general.\n *\n * We iterate through each answer, trying to match it with the user's input\n * using the following angorithm:\n * - Try to parse the user's input. If it doesn't parse then return \"not\n *   graded\".\n * - For each answer:\n *   ~ Try to validate the user's input against the answer. The answer is\n *     expected to parse.\n *   ~ If the user's input validates (the validator judges it \"correct\"), we've\n *     matched and can stop considering answers.\n * - If there were no matches or the matching answer is considered \"ungraded\",\n *   show the user an error. TODO(joel) - what error?\n * - Otherwise, pass through the resulting points and message.\n */\n_.extend(Expression, {\n    validate: function(state, rubric, onInputError) {\n        var options = _.clone(rubric);\n        if (window.icu && window.icu.getDecimalFormatSymbols) {\n            _.extend(options, window.icu.getDecimalFormatSymbols());\n        }\n\n        var createValidator = answer => {\n            return KhanAnswerTypes.expression.createValidatorFunctional(\n                // We don't give options to KAS.parse here because that is\n                // parsing the solution answer, not the student answer, and we\n                // don't want a solution to work if the student is using a\n                // different language but not in english.\n                KAS.parse(answer.value, rubric).expr,\n                _.extend({}, options, {\n                    simplify: answer.simplify,\n                    form: answer.form,\n                })\n            );\n        };\n\n        // find the first result to match the user's input\n        var result;\n        var matchingAnswer;\n        var allEmpty = true;\n        var foundMatch = !!rubric.answerForms.find(answer => {\n            var validate = createValidator(answer);\n\n            // save these because they'll be needed if this answer matches\n            result = validate(state);\n            matchingAnswer = answer;\n            allEmpty = allEmpty && result.empty;\n\n            // short-circuit as soon as an answer matches\n            return result.correct;\n        });\n\n        var message = \"\" || (result && result.message);\n\n        // now check to see whether it's considered correct, incorrect, or\n        // ungraded\n        if (!foundMatch) {\n            if (allEmpty) {\n                // If everything graded as empty, it's invalid.\n                return {\n                    type: \"invalid\",\n                    message: null,\n                };\n            } else {\n                // We fell through all the possibilities and we're not empty,\n                // so the answer is considered incorrect.\n                return {\n                    type: \"points\",\n                    earned: 0,\n                    total: 1,\n                };\n            }\n\n            // we matched an ungraded answer - return \"invalid\"\n        } else if (matchingAnswer.considered === \"ungraded\") {\n            var apiResult = onInputError(\n                null, // reserved for some widget identifier\n                state,\n                message\n            );\n            return {\n                type: \"invalid\",\n                message: apiResult === false ? null : message,\n            };\n\n            // The user's input matched one of the answers - is it correct or\n            // incorrect?\n        } else {\n            // TODO(eater): Seems silly to translate result to this\n            // invalid/points thing and immediately translate it back in\n            // ItemRenderer.scoreInput()\n            return {\n                type: \"points\",\n                earned: matchingAnswer.considered === \"correct\" ? 1 : 0,\n                total: 1,\n                message: message,\n            };\n        }\n    },\n});\n\n/**\n * Determine the keypad configuration parameters for the input, based on the\n * provided properties.\n *\n * There are two configuration parameters to be passed to the keypad:\n *   (1) The keypad type. For the Expression widget, we always use the\n *       Expression keypad.\n *   (2) The extra keys; namely, any variables or constants (like Pi) that need\n *       to be included as keys on the keypad. These are scraped from the answer\n *       forms.\n */\nconst keypadConfigurationForProps = props => {\n    // Always use the Expression keypad, regardless of the button sets that have\n    // been enabled.\n    const keypadType = KeypadTypes.EXPRESSION;\n\n    // Extract any and all variables and constants from the answer forms.\n    const uniqueExtraVariables = {};\n    const uniqueExtraConstants = {};\n    for (const answerForm of props.answerForms) {\n        const maybeExpr = KAS.parse(answerForm.value, props);\n        if (maybeExpr.parsed) {\n            const expr = maybeExpr.expr;\n\n            // The keypad expects Greek letters to be capitalized (e.g., it\n            // requires `PI` instead of `pi`). Right now, it only supports Pi\n            // and Theta, so we special-case.\n            const isGreek = symbol => symbol === \"pi\" || symbol === \"theta\";\n            const toKey = symbol => isGreek(symbol) ? symbol.toUpperCase() : symbol;\n\n            for (const variable of expr.getVars()) {\n                uniqueExtraVariables[toKey(variable)] = true;\n            }\n            for (const constant of expr.getConsts()) {\n                uniqueExtraConstants[toKey(constant)] = true;\n            }\n        }\n    }\n\n    // TODO(charlie): Alert the keypad as to which of these symbols should be\n    // treated as functions.\n    const extraVariables = Object.keys(uniqueExtraVariables);\n    extraVariables.sort();\n\n    const extraConstants = Object.keys(uniqueExtraConstants);\n    extraConstants.sort();\n\n    const extraKeys = [...extraVariables, ...extraConstants];\n    if (!extraKeys.length) {\n        // If there are no extra symbols available, we include Pi anyway, so\n        // that the \"extra symbols\" button doesn't appear empty.\n        extraKeys.push(\"PI\");\n    }\n\n    return {keypadType, extraKeys};\n};\n\n/*\n * v0 props follow this schema:\n *\n *     times: bool\n *     buttonSets: [string]\n *     functions: [string]\n *     buttonsVisible: \"always\" | \"focused\" | \"never\"\n *\n *     value: string\n *     form: bool\n *     simplify: bool\n *\n * v1 props follow this schema:\n *\n *     times: bool\n *     buttonSets: [string]\n *     functions: [string]\n *     buttonsVisible: \"always\" | \"focused\" | \"never\"\n *\n *     answerForms: [{\n *         considered: \"correct\" | \"ungraded\" | \"incorrect\"\n *         form: bool\n *         simplify: bool\n *         value: string\n *     }]\n */\n\nvar propUpgrades = {\n    1: v0props => ({\n        times: v0props.times,\n        buttonSets: v0props.buttonSets,\n        functions: v0props.functions,\n        buttonsVisible: v0props.buttonsVisible,\n\n        answerForms: [\n            {\n                considered: \"correct\",\n                form: v0props.form,\n                simplify: v0props.simplify,\n                value: v0props.value,\n                key: 0,\n            },\n        ]\n    }),\n};\n\n_module_.exports = {\n    name: \"expression\",\n    displayName: \"Expression / Equation\",\n    defaultAlignment: \"inline-block\",\n    widget: Expression,\n    transform: editorProps => {\n        const {times, functions, buttonSets, buttonsVisible} = editorProps;\n        return {\n            keypadConfiguration: keypadConfigurationForProps(editorProps),\n            times,\n            functions,\n            buttonSets,\n            buttonsVisible,\n        };\n    },\n    version: {major: 1, minor: 0},\n    propUpgrades: propUpgrades,\n\n    // For use by the editor\n    Expression,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import KAS from \"../lib/kas\";\nimport _expressionJsx from \"./expression.jsx\";\nimport _componentsTexButtonsJsx from \"../components/tex-buttons.jsx\";\nimport _reactComponentsTexJsx from \"react-components/tex.jsx\";\nimport _reactComponentsSortableJsx from \"react-components/sortable.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _hubbleIndexJs from \"../hubble/index.js\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, no-var, object-curly-spacing, one-var, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar lens = _hubbleIndexJs;\n\nvar Changeable = _mixinsChangeableJsx;\n\nvar InfoTip = _componentsInfoTipJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\nvar SortableArea = _reactComponentsSortableJsx;\nvar TeX = _reactComponentsTexJsx; // OldExpression only\nvar TexButtons = _componentsTexButtonsJsx;\n\nvar Expression = _expressionJsx.Expression;\n\n// An answer can be considered correct, wrong, or ungraded.\nvar CONSIDERED = [\"correct\", \"wrong\", \"ungraded\"];\n\nvar answerFormType = PropTypes.shape({\n    considered: PropTypes.oneOf(CONSIDERED).isRequired,\n    value: PropTypes.string.isRequired,\n    form: PropTypes.bool.isRequired,\n    simplify: PropTypes.bool.isRequired,\n});\n\n// Pick a key that isn't currently used by an answer in answerForms\nvar _makeNewKey = answerForms => {\n  // first note all the currently used keys in an array, used like a map :3\n  // note that this automatically updates the array's length property to\n  // be one past the largest key.\n  var usedKeys = [];\n  answerForms.forEach(ans => {\n    usedKeys[ans.key] = true;\n  });\n\n  // then scan through the array to find the first unused (undefined) key\n  for (var i = 0; i < usedKeys.length; i++) {\n    if (!usedKeys[i]) {\n      return i;\n    }\n  }\n\n  // if we didn't find a key, make one bigger than all the other keys,\n  // since that's how the length property is defined to work on arrays\n  return usedKeys.length;\n};\n\nvar ExpressionEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        answerForms: PropTypes.arrayOf(answerFormType),\n        times: PropTypes.bool,\n        buttonSets: TexButtons.buttonSetsType,\n        functions: PropTypes.arrayOf(PropTypes.string),\n    },\n\n    getDefaultProps: function() {\n        return {\n            answerForms: [],\n            times: false,\n            buttonSets: [\"basic\"],\n            functions: [\"f\", \"g\", \"h\"],\n        };\n    },\n\n    getInitialState: function() {\n        // Is the format of `value` TeX or plain text?\n        // TODO(alex): Remove after backfilling everything to TeX\n        // TODO(joel) - sucks if you edit some expression without\n        // backslashes or curly braces, then come back to the question and\n        // it's surprisingly not TeX anymore.\n\n        var isTex;\n        // default to TeX if new;\n        if (this.props.answerForms.length === 0) {\n            isTex = true;\n        } else {\n            isTex = this.props.answerForms.some(form => {\n                var {value} = form;\n                // only TeX has backslashes and curly braces\n                return (\n                    _.indexOf(value, \"\\\\\") !== -1 ||\n                    _.indexOf(value, \"{\") !== -1\n                );\n            });\n        }\n\n        return {isTex};\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        var answerOptions = this.props.answerForms\n            .map((obj, ix) => {\n                var expressionProps = {\n                    // note we're using\n                    // *this.props*.{times,functions,buttonSets} since each\n                    // answer area has the same settings for those\n                    times: this.props.times,\n                    functions: this.props.functions,\n                    buttonSets: this.props.buttonSets,\n\n                    buttonsVisible: \"focused\",\n                    form: obj.form,\n                    simplify: obj.simplify,\n                    value: obj.value,\n\n                    onChange: props => this.updateForm(ix, props),\n                    trackInteraction: () => {},\n\n                    widgetId: this.props.widgetId + \"-\" + ix,\n                };\n\n                return lens(obj)\n                    .merge([], {\n                        draggable: true,\n                        onChange: props => this.updateForm(ix, props),\n                        onDelete: () => this.handleRemoveForm(ix),\n                        expressionProps: expressionProps,\n                    })\n                    .freeze();\n            })\n            .map(obj => <AnswerOption {...obj} />);\n\n        var sortable = (\n            <SortableArea\n                components={answerOptions}\n                onReorder={this.handleReorder}\n                className=\"answer-options-list\"\n            />\n        );\n\n        // checkboxes to choose which sets of input buttons are shown\n        var buttonSetChoices = TexButtons.buttonSets.map((set, name) => {\n            // The first one gets special cased to always be checked, disabled,\n            // and float left.\n            var isFirst = name === \"basic\";\n            var checked = _.contains(this.props.buttonSets, name) || isFirst;\n            var className = isFirst\n                ? \"button-set-label-float\"\n                : \"button-set-label\";\n            return (\n                <label className={className} key={name}>\n                    <input\n                        type=\"checkbox\"\n                        checked={checked}\n                        disabled={isFirst}\n                        onChange={() => this.handleButtonSet(name)}\n                    />\n                    {name}\n                </label>\n            );\n        });\n\n        buttonSetChoices.splice(\n            1,\n            1,\n            <label key=\"show-div\">\n                <input type=\"checkbox\" onChange={this.handleToggleDiv} />\n                <span className=\"show-div-button\">\n                    show <TeX>\\div</TeX> button\n                </span>\n            </label>\n        );\n\n        return (\n            <div className=\"perseus-widget-expression-editor\">\n                <h3 className=\"expression-editor-h3\">Global Options</h3>\n\n                <div>\n                    <PropCheckBox\n                        times={this.props.times}\n                        onChange={this.props.onChange}\n                        labelAlignment=\"right\"\n                        label=\"Use  for rendering multiplication instead of a\n                        center dot.\"\n                    />\n                    <InfoTip>\n                        <p>\n                            For pre-algebra problems this option displays\n                            multiplication as \\times instead of \\cdot in both\n                            the rendered output and the acceptable formats\n                            examples.\n                        </p>\n                    </InfoTip>\n                </div>\n\n                <div>\n                    <label>\n                        {\"Function variables: \"}\n                        <input\n                            type=\"text\"\n                            defaultValue={this.props.functions.join(\" \")}\n                            onChange={this.handleFunctions}\n                        />\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Single-letter variables listed here will be\n                            interpreted as functions. This let us know that f(x)\n                            means \"f of x\" and not \"f times x\".\n                        </p>\n                    </InfoTip>\n                </div>\n\n                <div>\n                    <div>Button sets:</div>\n                    {buttonSetChoices}\n                </div>\n\n                {this.state.isTex &&\n                    <TexButtons\n                        className=\"math-input-buttons\"\n                        sets={this.props.buttonSets}\n                        convertDotToTimes={this.props.times}\n                        onInsert={this.handleTexInsert}\n                    />}\n\n                <h3 className=\"expression-editor-h3\">Answers</h3>\n\n                <p style={{margin: \"4px 0\"}}>\n                    student responses area matched against these from top to\n                    bottom\n                </p>\n\n                {sortable}\n\n                <div>\n                    <button\n                        className=\"simple-button orange\"\n                        style={{fontSize: 13}}\n                        onClick={this.newAnswer}\n                        type=\"button\"\n                    >\n                        Add new answer\n                    </button>\n                </div>\n            </div>\n        );\n    },\n\n    serialize: function() {\n        var formSerializables = [\n            \"value\",\n            \"form\",\n            \"simplify\",\n            \"considered\",\n            // it's a little weird to serialize the react key, but saves some\n            // effort reconstructing them when this item is loaded later.\n            \"key\",\n        ];\n        var serializables = [\"answerForms\", \"buttonSets\", \"functions\", \"times\"];\n\n        var answerForms = this.props.answerForms.map(form => {\n            return _.pick(form, formSerializables);\n        });\n\n        return lens(this.props)\n            .set([\"answerForms\"], answerForms)\n            .mod([], props => _.pick(props, serializables))\n            .freeze();\n    },\n\n    getSaveWarnings: function() {\n        var issues = [];\n\n        if (this.props.answerForms.length === 0) {\n            issues.push(\"No answers specified\");\n        } else {\n            var hasCorrect = !!this.props.answerForms.find(form => {\n                return form.considered === \"correct\";\n            });\n            if (!hasCorrect) {\n                issues.push(\"No correct answer specified\");\n            }\n\n            this.props.answerForms.forEach((form, ix) => {\n                if (this.props.value === \"\") {\n                    issues.push(`Answer ${ix + 1} is empty`);\n                } else {\n                    // note we're not using icu for content creators\n                    var expression = KAS.parse(form.value);\n                    if (!expression.parsed) {\n                        issues.push(`Couldn't parse ${form.value}`);\n                    } else if (\n                        form.simplify &&\n                        !expression.expr.isSimplified()\n                    ) {\n                        issues.push(\n                            `${form.value} isn't simplified, but is required\" +\n                            \" to be`\n                        );\n                    }\n                }\n            });\n\n            // TODO(joel) - warn about:\n            //   - unreachable answers (how??)\n            //   - specific answers following unspecific answers\n            //   - incorrect answers as the final form\n        }\n\n        return issues;\n    },\n\n    _newEmptyAnswerForm: function() {\n        return {\n            considered: \"correct\",\n            form: false,\n\n            // note: the key means \"n-th form created\" - not \"form in\n            // position n\" and will stay the same for the life of this form\n            key: _makeNewKey(this.props.answerForms),\n\n            simplify: false,\n            value: \"\",\n        };\n    },\n\n    newAnswer: function() {\n        var answerForms = this.props.answerForms.slice();\n        answerForms.push(this._newEmptyAnswerForm());\n        this.change({answerForms});\n    },\n\n    handleRemoveForm: function(i) {\n        var answerForms = this.props.answerForms.slice();\n        answerForms.splice(i, 1);\n        this.change({answerForms});\n    },\n\n    // called when the options (including the expression itself) to an answer\n    // form change\n    updateForm: function(i, props) {\n        var answerForms = lens(this.props.answerForms)\n            .merge([i], props)\n            .freeze();\n\n        this.change({answerForms});\n    },\n\n    handleReorder: function(components) {\n        var answerForms = components.map(component => {\n            var form = _.pick(component.props,\n                \"considered\",\n                \"form\",\n                \"simplify\",\n                \"value\"\n            );\n            form.key = component.key;\n            return form;\n        });\n\n        this.change({answerForms});\n    },\n\n    // called when the selected buttonset changes\n    handleButtonSet: function(changingName) {\n        var buttonSetNames = Object.keys(TexButtons.buttonSets);\n\n        // Filter to preserve order - using .union and .difference would always\n        // move the last added button set to the end.\n        var buttonSets = buttonSetNames.filter(set => {\n            return (\n                _.contains(this.props.buttonSets, set) !==\n                (set === changingName)\n            );\n        });\n\n        this.props.onChange({buttonSets});\n    },\n\n    handleToggleDiv: function() {\n        // We always want buttonSets to contain exactly one of \"basic\" and\n        // \"basic+div\". Toggle between the two of them.\n        // If someone can think of a more elegant formulation of this (there\n        // must be one!) feel free to change it.\n        var keep, remove;\n        if (_.contains(this.props.buttonSets, \"basic+div\")) {\n            keep = \"basic\";\n            remove = \"basic+div\";\n        } else {\n            keep = \"basic+div\";\n            remove = \"basic\";\n        }\n\n        var buttonSets = _.reject(this.props.buttonSets, set => set === remove)\n            .concat(keep);\n\n        this.change(\"buttonSets\", buttonSets);\n    },\n\n    // called when the correct answer changes\n    handleTexInsert: function(str) {\n        this.refs.expression.insert(str);\n    },\n\n    // called when the function variables change\n    handleFunctions: function(e) {\n        var newProps = {};\n        newProps.functions = _.compact(e.target.value.split(/[ ,]+/));\n        this.props.onChange(newProps);\n    },\n});\n\n// Find the next element in arr after val, wrapping around to the first.\nvar findNextIn = function(arr, val) {\n    var ix = arr.indexOf(val);\n    ix = (ix + 1) % arr.length;\n    return arr[ix];\n};\n\nvar AnswerOption = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        considered: PropTypes.oneOf(CONSIDERED).isRequired,\n        expressionProps: PropTypes.object.isRequired,\n\n        // Must the answer have the same form as this answer.\n        form: PropTypes.bool.isRequired,\n\n        // Must the answer be simplified.\n        simplify: PropTypes.bool.isRequired,\n\n        onChange: PropTypes.func.isRequired,\n        onDelete: PropTypes.func.isRequired,\n    },\n\n    getInitialState: function() {\n        return {deleteFocused: false};\n    },\n\n    handleDeleteBlur: function() {\n        this.setState({deleteFocused: false});\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    render: function() {\n        var removeButton = null;\n        if (this.state.deleteFocused) {\n            removeButton = (\n                <button\n                    type=\"button\"\n                    className=\"simple-button orange\"\n                    onClick={this.handleImSure}\n                    onBlur={this.handleDeleteBlur}\n                >\n                    I'm sure!\n                </button>\n            );\n        } else {\n            removeButton = (\n                <button\n                    type=\"button\"\n                    className=\"simple-button orange\"\n                    onClick={this.handleDelete}\n                >\n                    Delete\n                </button>\n            );\n        }\n\n        return (\n            <div className=\"expression-answer-option\">\n                <div className=\"answer-handle\" />\n\n                <div className=\"answer-body\">\n                    <div className=\"answer-considered\">\n                        <div\n                            onClick={this.toggleConsidered}\n                            className={\"answer-status \" + this.props.considered}\n                        >\n                            {this.props.considered}\n                        </div>\n\n                        <div className=\"answer-expression\">\n                            <Expression {...this.props.expressionProps} />\n                        </div>\n                    </div>\n\n                    <div className=\"answer-option\">\n                        <PropCheckBox\n                            form={this.props.form}\n                            onChange={this.props.onChange}\n                            labelAlignment=\"right\"\n                            label=\"Answer expression must have the same form.\"\n                        />\n                        <InfoTip>\n                            <p>\n                                The student's answer must be in the same form.\n                                Commutativity and excess negative signs are\n                                ignored.\n                            </p>\n                        </InfoTip>\n                    </div>\n\n                    <div className=\"answer-option\">\n                        <PropCheckBox\n                            simplify={this.props.simplify}\n                            onChange={this.props.onChange}\n                            labelAlignment=\"right\"\n                            label=\"Answer expression must be fully expanded and\n                            simplified.\"\n                        />\n                        <InfoTip>\n                            <p>\n                                The student's answer must be fully expanded and\n                                simplified. Answering this equation (x^2+2x+1)\n                                with this factored equation (x+1)^2 will render\n                                this response \"Your answer is not fully expanded\n                                and simplified.\"\n                            </p>\n                        </InfoTip>\n                    </div>\n\n                    <div className=\"remove-container\">\n                        {removeButton}\n                    </div>\n                </div>\n            </div>\n        );\n    },\n\n    handleImSure: function() {\n        this.props.onDelete();\n    },\n\n    handleDelete: function() {\n        this.setState({deleteFocused: true});\n    },\n\n    toggleConsidered: function() {\n        var newVal = findNextIn(CONSIDERED, this.props.considered);\n        this.change({considered: newVal});\n    },\n});\n\n_module_.exports = ExpressionEditor;\nexport default _module_.exports;\n","import _utilJs from \"../util.js\";\nimport _componentsTextInputJsx from \"../components/text-input.jsx\";\nimport _componentsPropCheckBoxJsx from \"../components/prop-check-box.jsx\";\nimport _componentsNumberInputJsx from \"../components/number-input.jsx\";\nimport _reactComponentsMultiButtonGroupJsx from \"react-components/multi-button-group.jsx\";\nimport _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport { iconGear, iconTrash } from \"../icon-paths.js\";\nimport _editorJsx from \"../editor.jsx\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _mixinsEditorJsonifyJsx from \"../mixins/editor-jsonify.jsx\";\nimport _mixinsChangeableJsx from \"../mixins/changeable.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-redeclare, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Changeable = _mixinsChangeableJsx;\nconst EditorJsonify = _mixinsEditorJsonifyJsx;\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\nconst Editor = _editorJsx;\nconst InfoTip = _componentsInfoTipJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nconst MultiButtonGroup = _reactComponentsMultiButtonGroupJsx;\nconst NumberInput = _componentsNumberInputJsx;\nconst PropCheckBox = _componentsPropCheckBoxJsx;\nconst TextInput = _componentsTextInputJsx;\n\nconst firstNumericalParse = _utilJs.firstNumericalParse;\n\nconst answerFormButtons = [\n    {title: \"Integers\", value: \"integer\", content: \"6\"},\n    {title: \"Decimals\", value: \"decimal\", content: \"0.75\"},\n    {title: \"Proper fractions\", value: \"proper\", content: \"\\u2157\"},\n    {\n        title: \"Improper fractions\",\n        value: \"improper\",\n        content: \"\\u2077\\u2044\\u2084\",\n    },\n    {title: \"Mixed numbers\", value: \"mixed\", content: \"1\\u00BE\"},\n    {title: \"Numbers with \\u03C0\", value: \"pi\", content: \"\\u03C0\"},\n];\n\nconst initAnswer = status => {\n    return {\n        value: null,\n        status: status,\n        message: \"\",\n        simplify: \"required\",\n        answerForms: [],\n        strict: false,\n        maxError: null,\n    };\n};\n\nconst NumericInputEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n    },\n\n    getDefaultProps: function() {\n        return {\n            answers: [initAnswer(\"correct\")],\n            size: \"normal\",\n            coefficient: false,\n            labelText: \"\",\n            multipleNumberInput: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            lastStatus: \"wrong\",\n            showOptions: _.map(this.props.answers, () => false),\n        };\n    },\n\n    render: function() {\n        var answers = this.props.answers;\n\n        var unsimplifiedAnswers = i => <div className=\"perseus-widget-row\">\n            <label>Unsimplified answers are</label>\n            <ButtonGroup\n                value={answers[i][\"simplify\"]}\n                allowEmpty={false}\n                buttons={[\n                    {value: \"required\", content: \"ungraded\"},\n                    {value: \"optional\", content: \"accepted\"},\n                    {value: \"enforced\", content: \"wrong\"},\n                ]}\n                onChange={this.updateAnswer(i, \"simplify\")}\n            />\n            <InfoTip>\n                <p>\n                    Normally select \"ungraded\". This will give the user a\n                    message saying the answer is correct but not simplified.\n                    The user will then have to simplify it and re-enter, but\n                    will not be penalized. (5th grade and after)\n                </p>\n                <p>\n                    Select \"accepted\" only if the user is not expected to\n                    know how to simplify fractions yet. (Anything prior to\n                    5th grade)\n                </p>\n                <p>\n                    Select \"wrong\" <em>only</em> if we are specifically\n                    assessing the ability to simplify.\n                </p>\n            </InfoTip>\n        </div>;\n\n        var suggestedAnswerTypes = i => <div>\n            <div className=\"perseus-widget-row\">\n                <label>Choose the suggested answer formats</label>\n                <MultiButtonGroup\n                    buttons={answerFormButtons}\n                    values={answers[i][\"answerForms\"]}\n                    onChange={this.updateAnswer(i, \"answerForms\")}\n                />\n                <InfoTip>\n                    <p>\n                        Formats will be autoselected for you based on the\n                        given answer; to show no suggested formats and\n                        accept all types, simply have a decimal/integer be\n                        the answer. Values with &pi; will have format \"pi\",\n                        and values that are fractions will have some subset\n                        (mixed will be \"mixed\" and \"proper\"; improper/proper\n                        will both be \"improper\" and \"proper\"). If you would\n                        like to specify that it is only a proper fraction\n                        (or only a mixed/improper fraction), deselect the\n                        other format. Except for specific cases, you should\n                        not need to change the autoselected formats.\n                    </p>\n                    <p>\n                        To restrict the answer to <em>only</em> an improper\n                        fraction (i.e. 7/4), select the improper fraction\n                        and toggle \"strict\" to true. This <b>will\n                        not</b>{\" \"} accept 1.75 as an answer.{\" \"}\n                    </p>\n                    <p>\n                        Unless you are testing that specific skill, please\n                        do not restrict the answer format.\n                    </p>\n                </InfoTip>\n            </div>\n            <div className=\"perseus-widget-row\">\n                <PropCheckBox\n                    label=\"Strictly match only these formats\"\n                    strict={answers[i][\"strict\"]}\n                    onChange={this.updateAnswer.bind(this, i)}\n                />\n            </div>\n        </div>;\n\n        var maxError = i => <div className=\"perseus-widget-row\">\n            <label>\n                Max error{\" \"}\n                <NumberInput\n                    className=\"max-error\"\n                    value={answers[i][\"maxError\"]}\n                    onChange={this.updateAnswer(i, \"maxError\")}\n                    placeholder=\"0\"\n                />\n            </label>\n        </div>;\n\n        var inputSize = (\n            <div className=\"perseus-widget-row\">\n                <label>Width:  </label>\n                <ButtonGroup\n                    value={this.props.size}\n                    allowEmpty={false}\n                    buttons={[\n                        {value: \"normal\", content: \"Normal (80px)\"},\n                        {value: \"small\", content: \"Small (40px)\"},\n                    ]}\n                    onChange={this.change(\"size\")}\n                />\n                <InfoTip>\n                    <p>\n                        Use size \"Normal\" for all text boxes, unless there are\n                        multiple text boxes in one line and the answer area is\n                        too narrow to fit them.\n                    </p>\n                </InfoTip>\n            </div>\n        );\n\n        var labelText = (\n            <div className=\"perseus-widget-row\">\n                <label>\n                    Label text:{\" \"}\n                    <TextInput\n                        value={this.props.labelText}\n                        onChange={this.change(\"labelText\")}\n                    />\n                </label>\n                <InfoTip>\n                    <p>\n                        Text to describe this input. This will be shown to users\n                        using screenreaders.\n                    </p>\n                </InfoTip>\n            </div>\n        );\n\n        var coefficientCheck = (\n            <div>\n                <div className=\"perseus-widget-row\">\n                    <PropCheckBox\n                        label=\"Coefficient\"\n                        coefficient={this.props.coefficient}\n                        onChange={this.props.onChange}\n                    />\n                    <InfoTip>\n                        <p>\n                            A coefficient style number allows the student to use\n                            - for -1 and an empty string to mean 1.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n\n        var addAnswerButton = (\n            <div>\n                <a\n                    href=\"javascript:void(0)\"\n                    className=\"simple-button orange\"\n                    onClick={() => this.addAnswer()}\n                    onKeyDown={e => this.onSpace(e, this.addAnswer)}\n                >\n                    <span>Add new answer</span>\n                </a>\n            </div>\n        );\n\n        var instructions = {\n            wrong: \"(address the mistake/misconception)\",\n            ungraded: \"(explain in detail to avoid confusion)\",\n            correct: \"(reinforce the user's understanding)\",\n        };\n\n        var generateInputAnswerEditors = () => answers.map((answer, i) => {\n            var editor = (\n                <Editor\n                    apiOptions={this.props.apiOptions}\n                    content={answer.message || \"\"}\n                    placeholder={\n                        \"Why is this answer \" +\n                        answer.status +\n                        \"?\\t\" +\n                        instructions[answer.status]\n                    }\n                    widgetEnabled={false}\n                    onChange={newProps => {\n                        if (\"content\" in newProps) {\n                            this.updateAnswer(i, {\n                                message: newProps.content,\n                            });\n                        }\n                    }}\n                />\n            );\n            return (\n                <div className=\"perseus-widget-row\" key={i}>\n                    <div\n                        className={\n                            \"input-answer-editor-value-container\" +\n                            (answer.maxError ? \" with-max-error\" : \"\")\n                        }\n                    >\n                        <NumberInput\n                            value={answer.value}\n                            className=\"numeric-input-value\"\n                            placeholder=\"answer\"\n                            format={_.last(answer.answerForms)}\n                            onFormatChange={(newValue, format) => {\n                                // NOTE(charlie): The mobile web expression\n                                // editor relies on this automatic answer\n                                // form resolution for determining when to\n                                // show the Pi symbol. If we get rid of it,\n                                // we should also disable Pi for\n                                // NumericInput and require problems that\n                                // use Pi to build on Expression.\n                                // Alternatively, we could store answers\n                                // as plaintext and parse them to determine\n                                // whether or not to reveal Pi on the\n                                // keypad (right now, answers are stored as\n                                // resolved values, like '0.125' rather\n                                // than '1/8').\n                                var forms;\n                                if (format === \"pi\") {\n                                    forms = [\"pi\"];\n                                } else if (format === \"mixed\") {\n                                    forms = [\"proper\", \"mixed\"];\n                                } else if (\n                                    format === \"proper\" ||\n                                    format === \"improper\"\n                                ) {\n                                    forms = [\"proper\", \"improper\"];\n                                }\n                                this.updateAnswer(i, {\n                                    value: firstNumericalParse(newValue),\n                                    answerForms: forms,\n                                });\n                            }}\n                            onChange={newValue => {\n                                this.updateAnswer(i, {\n                                    value: firstNumericalParse(newValue),\n                                });\n                            }}\n                        />\n                        {answer.strict &&\n                            <div\n                                className=\"is-strict-indicator\"\n                                title=\"strictly equivalent to\"\n                            >\n                                &equiv;\n                            </div>}\n                        {answer.simplify !== \"required\" &&\n                            answer.status === \"correct\" &&\n                            <div\n                                className={\n                                    \"simplify-indicator \" + answer.simplify\n                                }\n                                title=\"accepts unsimplified answers\"\n                            >\n                                &permil;\n                            </div>}\n                        {answer.maxError\n                            ? <div className=\"max-error-container\">\n                                  <div className=\"max-error-plusmn\">\n                                      &plusmn;\n                                  </div>\n                                  <NumberInput\n                                      placeholder={0}\n                                      value={answers[i][\"maxError\"]}\n                                      format={_.last(answer.answerForms)}\n                                      onChange={this.updateAnswer(\n                                          i,\n                                          \"maxError\"\n                                      )}\n                                  />\n                              </div>\n                            : null}\n                        <div className=\"value-divider\" />\n                        <a\n                            href=\"javascript:void(0)\"\n                            className={\"answer-status \" + answer.status}\n                            onClick={() => this.onStatusChange(i)}\n                            onKeyDown={e => this.onSpace(e, this.onStatusChange, i)}\n                        >\n                            {answer.status}\n                        </a>\n                        <a\n                            href=\"javascript:void(0)\"\n                            className=\"answer-trash\"\n                            onClick={() => this.onTrashAnswer(i)}\n                            onKeyDown={e => this.onSpace(e, this.onTrashAnswer, i)}\n                        >\n                            <InlineIcon {...iconTrash} />\n                        </a>\n                        <a\n                            href=\"javascript:void(0)\"\n                            className=\"options-toggle\"\n                            onClick={() => this.onToggleOptions(i)}\n                            onKeyDown={e => this.onSpace(e, this.onToggleOptions, i)}\n                        >\n                            <InlineIcon {...iconGear} />\n                        </a>\n                    </div>\n                    <div className=\"input-answer-editor-message\">\n                        {editor}\n                    </div>\n                    {this.state.showOptions[i] &&\n                        <div className=\"options-container\">\n                            {maxError(i)}\n                            {answer.status === \"correct\" &&\n                                unsimplifiedAnswers(i)}\n                            {suggestedAnswerTypes(i)}\n                        </div>}\n                </div>\n            );\n        });\n\n        return (\n            <div className=\"perseus-input-number-editor\">\n                <div ref={e => this.multInputOption = e}>\n                    <select onChange={this.onMultipleInputChange}>\n                        <option value=\"simple-numeric-input\">\n                            Ask for one correct solution\n                        </option>\n                        <option value=\"multiple-numeric-input\">\n                            Ask for all correct solutions\n                        </option>\n                    </select>\n                </div>\n                <div className=\"ui-title\">User input</div>\n                <div className=\"msg-title\">\n                    Message shown to user on attempt\n                </div>\n                {generateInputAnswerEditors()}\n                {addAnswerButton}\n                {inputSize}\n                {coefficientCheck}\n                {labelText}\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    onToggleOptions: function(choiceIndex) {\n        var showOptions = this.state.showOptions.slice();\n        showOptions[choiceIndex] = !showOptions[choiceIndex];\n        this.setState({showOptions: showOptions});\n    },\n\n    onTrashAnswer: function(choiceIndex) {\n        if (choiceIndex >= 0 && choiceIndex < this.props.answers.length) {\n            var answers = this.props.answers.slice(0);\n            answers.splice(choiceIndex, 1);\n            this.props.onChange({answers: answers});\n        }\n    },\n\n    onSpace: function(e, callback) {\n        if (e.key === \" \") {\n            e.preventDefault(); // prevent page shifting\n            var args = _.toArray(arguments).slice(2);\n            callback.apply(this, args);\n        }\n    },\n\n    onStatusChange: function(choiceIndex) {\n        var statuses = [\"wrong\", \"ungraded\", \"correct\"];\n        var answers = this.props.answers;\n        var i = _.indexOf(statuses, answers[choiceIndex].status);\n        var newStatus = statuses[(i + 1) % statuses.length];\n\n        this.updateAnswer(choiceIndex, {\n            status: newStatus,\n            simplify: newStatus === \"correct\" ? \"required\" : \"accepted\",\n        });\n    },\n\n    onMultipleInputChange: function(event) {\n        const newOption = event.target.value;\n        if (newOption === \"multiple-numeric-input\") {\n            this.props.onChange({multipleNumberInput: true});\n        } else {\n            this.props.onChange({multipleNumberInput: false});\n        }\n    },\n\n    updateAnswer: function(choiceIndex, update) {\n        if (!_.isObject(update)) {\n            return _.partial(\n                (choiceIndex, key, value) => {\n                    var update = {};\n                    update[key] = value;\n                    this.updateAnswer(choiceIndex, update);\n                },\n                choiceIndex,\n                update\n            );\n        }\n\n        var answers = _.clone(this.props.answers);\n\n        // Don't bother to make a new answer box unless we are editing the last\n        // one.\n        // TODO(oliver): This might not be necessary anymore.\n        if (choiceIndex === answers.length) {\n            var lastAnswer = initAnswer(this.state.lastStatus);\n            var answers = answers.concat(lastAnswer);\n        }\n\n        answers[choiceIndex] = _.extend({}, answers[choiceIndex], update);\n        this.props.onChange({answers: answers});\n    },\n\n    addAnswer: function() {\n        var lastAnswer = initAnswer(this.state.lastStatus);\n        var answers = this.props.answers.concat(lastAnswer);\n        this.props.onChange({answers: answers});\n    },\n\n    getSaveWarnings: function() {\n        // Filter out all the empty answers\n        var warnings = [];\n        // TODO(emily): This doesn't actually work, because the value is either\n        // null or undefined when undefined, probably.\n        if (_.contains(_.pluck(this.props.answers, \"value\"), \"\")) {\n            warnings.push(\"One or more answers is empty\");\n        }\n        this.props.answers.forEach((answer, i) => {\n            var formatError =\n                answer.strict &&\n                (!answer.answerForms || answer.answerForms.length === 0);\n            if (formatError) {\n                warnings.push(\n                    `Answer ${i + 1} is set to string format ` +\n                        \"matching, but no format was selected\"\n                );\n            }\n        });\n        return warnings;\n    },\n\n    serialize() {\n        return EditorJsonify.serialize.call(this);\n    },\n});\n\n_module_.exports = NumericInputEditor;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * In review mode (currently only visible in the sat-mission), NumericInput and\n * InputNumber use this component to display the set of correct answers.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst PossibleAnswers = createReactClass({\n    propTypes: {\n        answers: PropTypes.arrayOf(PropTypes.string),\n    },\n    render: function() {\n        // It's redundant to show duplicate answers.\n        // So, remove duplicates from the given list of answer strings.\n        const answers = _.uniq(this.props.answers);\n\n        const answerComponents = _.map(answers, answer => {\n            // Plus, now that our answers are distinct, we can safely use the\n            // answer string as a key.\n            return (\n                <dd key={answer}>\n                    {answer}\n                </dd>\n            );\n        });\n        return (\n            <dl className=\"perseus-possible-answers\">\n                <dt>Correct Answer</dt>\n                {answerComponents}\n            </dl>\n        );\n    },\n});\n\n_module_.exports = PossibleAnswers;\nexport default _module_.exports;\n","import _componentsInlineIconJsx from \"../components/inline-icon.jsx\";\nimport { iconDropdownArrow } from \"../icon-paths.js\";\nimport { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _utilMathJs from \"../util/math.js\";\nimport _utilAnswerTypesJs from \"../util/answer-types.js\";\nimport _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport _componentsPossibleAnswersJsx from \"../components/possible-answers.jsx\";\nimport _texWranglerJs from \"../tex-wrangler.js\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _componentsInputWithExamplesJsx from \"../components/input-with-examples.jsx\";\nimport * as styleConstants from \"../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, indent, no-undef, no-var, object-curly-spacing, react/forbid-prop-types, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar classNames = _classnames;\nvar React = _react;\nvar _ = _underscore;\n\nvar InputWithExamples = _componentsInputWithExamplesJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\nvar ParseTex = _texWranglerJs.parseTex;\nvar PossibleAnswers = _componentsPossibleAnswersJsx;\n\nvar ApiClassNames = _perseusApiJsx.ClassNames;\nvar ApiOptions = _perseusApiJsx2.Options;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\nconst KhanMath = _utilMathJs;\nconst {keypadElementPropType} = _mathInput.propTypes;\nconst InlineIcon = _componentsInlineIconJsx;\n\nvar answerFormButtons = [\n    {title: \"Integers\", value: \"integer\", content: \"6\"},\n    {title: \"Decimals\", value: \"decimal\", content: \"0.75\"},\n    {title: \"Proper fractions\", value: \"proper\", content: \"\\u2157\"},\n    {\n        title: \"Improper fractions\",\n        value: \"improper\",\n        content: \"\\u2077\\u2044\\u2084\",\n    },\n    {title: \"Mixed numbers\", value: \"mixed\", content: \"1\\u00BE\"},\n    {title: \"Numbers with \\u03C0\", value: \"pi\", content: \"\\u03C0\"},\n];\n\nvar formExamples = {\n    integer: () => i18n._(\"an integer, like $6$\"),\n    proper: form => form.simplify === \"optional\"\n        ? i18n._(\"a *proper* fraction, like $1/2$ or $6/10$\")\n        : i18n._(\"a *simplified proper* fraction, like $3/5$\"),\n    improper: form => form.simplify === \"optional\"\n        ? i18n._(\"an *improper* fraction, like $10/7$ or $14/8$\")\n        : i18n._(\"a *simplified improper* fraction, like $7/4$\"),\n    mixed: () => i18n._(\"a mixed number, like $1\\\\ 3/4$\"),\n    decimal: () => i18n._(\"an *exact* decimal, like $0.75$\"),\n    pi: () => i18n._(\n        \"a multiple of pi, like $12\\\\ \\\\text{pi}$ or \" +\n            \"$2/3\\\\ \\\\text{pi}$\"\n    ),\n};\n\nvar NumericInput = createReactClass({\n    propTypes: {\n        currentValue: PropTypes.string,\n        currentMultipleValues: PropTypes.arrayOf(PropTypes.string),\n        size: PropTypes.oneOf([\"normal\", \"small\"]),\n        apiOptions: ApiOptions.propTypes,\n        coefficient: PropTypes.bool,\n        answerForms: PropTypes.arrayOf(\n            PropTypes.shape({\n                name: PropTypes.string.isRequired,\n                simplify: PropTypes.oneOf([\"required\", \"optional\"])\n                    .isRequired,\n            })\n        ),\n        keypadElement: keypadElementPropType,\n        labelText: PropTypes.string,\n        reviewModeRubric: PropTypes.object,\n        trackInteraction: PropTypes.func.isRequired,\n        widgetId: PropTypes.string.isRequired,\n        linterContext: linterContextProps,\n        multipleNumberInput: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            currentValue: \"\",\n            // currentMultipleValues has an empty string, because if finite\n            // solutions is chosen, there must be at least 1 answer\n            currentMultipleValues: [\"\"],\n            size: \"normal\",\n            apiOptions: ApiOptions.defaults,\n            coefficient: false,\n            answerForms: [],\n            labelText: \"\",\n            linterContext: linterContextDefault,\n            multipleNumberInput: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            // dropdown option: either no-solutions or finite-solutions\n            numSolutions: \"no-solutions\",\n            // keeps track of the other set of values when switching\n            // between 0 and finite solutions\n            previousValues: [\"\"],\n        };\n    },\n\n    getAnswerBlurb: function(rubric) {\n        var correct;\n        var answerBlurb;\n        if (this.props.apiOptions.satStyling && rubric) {\n            var score = this.simpleValidate(rubric);\n            correct = score.type === \"points\" && score.earned === score.total;\n\n            if (!correct) {\n                var correctAnswers = _.filter(\n                    rubric.answers,\n                    answer => answer.status === \"correct\"\n                );\n                var answerStrings = _.map(correctAnswers, answer => {\n                    // Figure out how this answer is supposed to be\n                    // displayed\n                    var format = \"decimal\";\n                    if (answer.answerForms && answer.answerForms[0]) {\n                        // NOTE(johnsullivan): This isn't exactly ideal, but\n                        // it does behave well for all the currently known\n                        // problems. See D14742 for some discussion on\n                        // alternate strategies.\n                        format = answer.answerForms[0];\n                    }\n\n                    var answerString = KhanMath.toNumericString(\n                        answer.value,\n                        format\n                    );\n                    if (answer.maxError) {\n                        answerString +=\n                            \" \\u00B1 \" +\n                            KhanMath.toNumericString(answer.maxError, format);\n                    }\n                    return answerString;\n                });\n                answerBlurb = <PossibleAnswers answers={answerStrings} />;\n            }\n        }\n        return [answerBlurb, correct];\n    },\n\n    getClasses: function(correct, rubric) {\n        const classes = {};\n        classes[\"perseus-input-size-\" + this.props.size] = true;\n        classes[ApiClassNames.CORRECT] =\n            rubric && correct && this.props.currentValue;\n        classes[ApiClassNames.INCORRECT] =\n            rubric && !correct && this.props.currentValue;\n        classes[ApiClassNames.UNANSWERED] = rubric && !this.props.currentValue;\n        return classes;\n    },\n\n    render: function() {\n        const rubric = this.props.reviewModeRubric;\n        const answers = this.getAnswerBlurb(rubric);\n        const answerBlurb = answers[0];\n        const correct = answers[1];\n        const classes = this.getClasses(correct, rubric);\n\n        var labelText = this.props.labelText;\n        if (labelText == null || labelText === \"\") {\n            labelText = i18n._(\"Your answer:\");\n        }\n\n        var selectClasses = classNames({\n            \"perseus-widget-dropdown\": true,\n        });\n\n        const dropdown = <div>\n            <select\n                onChange={this.handleNumSolutionsChange}\n                className={selectClasses +\n                    \" \" + css(styles.dropdown) +\n                    \" \" + ApiClassNames.INTERACTIVE}\n                value={this.state.numSolutions}\n            >\n                <option value=\"no-solutions\">\n                    {i18n._(\"0 solutions\")}\n                </option>\n                <option value=\"finite-solutions\">\n                    {i18n._(\"Finite solutions\")}\n                </option>\n            </select>\n            <InlineIcon\n                {...iconDropdownArrow}\n                style={{\n                    marginLeft: -24,\n                    height: 24,\n                    width: 24,\n                }}\n            />\n        </div>;\n\n        var input;\n        if (this.props.multipleNumberInput) {\n            if (this.state.numSolutions === \"no-solutions\") {\n                return dropdown;\n            } else {\n                const addInput = (\n                    <div\n                        className={css(styles.addInputButton)}\n                        onClick={this._addInput}\n                    >\n                        +\n                    </div>\n                );\n\n                input = <div>\n                    {this.props.currentMultipleValues.map((item, i) => <div\n                        key={i}\n                        className={css(styles.numberInputContainer)}\n                    >\n                        {i > 0 && <div\n                            className={css(styles.removeInputButton)}\n                            onClick={evt => this._removeInput(i, evt)}\n                            aria-label=\"Remove this answer\"\n                        >\n                                -\n                            </div>\n                        }\n                        {this.props.apiOptions.customKeypad ?\n                        <SimpleKeypadInput\n                            ref=\"input\"\n                            value={this.props.currentMultipleValues[i]}\n                            keypadElement={this.props.keypadElement}\n                            onChange={\n                                e => this.handleMultipleInputChange(i, e)}\n                            onFocus={this._handleFocus}\n                            onBlur={this._handleBlur}\n                        /> :\n                        <InputWithExamples\n                            ref=\"input\"\n                            value={this.props.currentMultipleValues[i]}\n                            onChange={\n                                e => this.handleMultipleInputChange(i, e)}\n                            className={classNames(\n                                classes, css(styles.numberInput))}\n                            labelText={labelText}\n                            type={this._getInputType()}\n                            examples={this.examples()}\n                            shouldShowExamples={this.shouldShowExamples()}\n                            onFocus={this._handleFocus}\n                            onBlur={this._handleBlur}\n                            id={this.props.widgetId}\n                            disabled={this.props.apiOptions.readOnly}\n                            highlightLint={this.props.highlightLint}\n                        />}\n                    </div>)\n                    }\n                    {addInput}\n                    Add answer\n                </div>;\n            }\n        } else {\n            if (this.props.apiOptions.customKeypad) {\n                // TODO(charlie): Support \"Review Mode\".\n                return (\n                    <SimpleKeypadInput\n                        ref=\"input\"\n                        value={this.props.currentValue}\n                        keypadElement={this.props.keypadElement}\n                        onChange={this.handleChange}\n                        onFocus={this._handleFocus}\n                        onBlur={this._handleBlur}\n                    />\n                );\n            } else {\n                input = (\n                    <InputWithExamples\n                        ref=\"input\"\n                        value={this.props.currentValue}\n                        onChange={this.handleChange}\n                        className={classNames(classes)}\n                        labelText={labelText}\n                        type={this._getInputType()}\n                        examples={this.examples()}\n                        shouldShowExamples={this.shouldShowExamples()}\n                        onFocus={this._handleFocus}\n                        onBlur={this._handleBlur}\n                        id={this.props.widgetId}\n                        disabled={this.props.apiOptions.readOnly}\n                        highlightLint={this.props.highlightLint}\n                    />\n                );\n            }\n        }\n\n        if (answerBlurb) {\n            return <span className=\"perseus-input-with-answer-blurb\">\n                {this.props.multipleNumberInput && dropdown}\n                {input}\n                {answerBlurb}\n            </span>;\n        } else if (this.props.apiOptions.satStyling) {\n            // NOTE(amy): the input widgets themselves already have\n            // a default aria label of \"Your Answer\", so we hide this\n            // redundant label from screen-readers.\n            return <label\n                className=\"perseus-input-with-label\"\n                aria-hidden=\"true\"\n            >\n                <span className=\"perseus-input-label\">\n                    {i18n.i18nDoNotTranslate(\"Answer:\")}\n                </span>\n                {this.props.multipleNumberInput && dropdown}\n                {input}\n            </label>;\n        } else {\n            return <div>\n                {this.props.multipleNumberInput && dropdown}\n                {input}\n            </div>;\n        }\n    },\n\n    handleChange: function(newValue, cb) {\n        this.props.onChange({currentValue: newValue}, cb);\n        this.props.trackInteraction();\n    },\n\n    handleMultipleInputChange: function(index, newValue) {\n        const newValues = this.props.currentMultipleValues.slice();\n        newValues[index] = newValue;\n        this.props.onChange({\n            currentMultipleValues: newValues,\n        });\n        this.props.trackInteraction();\n    },\n\n    handleNumSolutionsChange: function(event) {\n        const newValue = event.target.value;\n        this.setState({numSolutions: newValue});\n\n        // Saves the values the user entered when switching between no\n        // solutions and finite solutions, however, we also correctly update\n        // the answer that is to be graded\n        if (newValue === \"no-solutions\") {\n            this.setState({\n                previousValues: this.props.currentMultipleValues,\n            });\n            this.props.onChange({\n                currentMultipleValues: [],\n            });\n\n        } else {\n            this.props.onChange({\n                currentMultipleValues: this.state.previousValues,\n            });\n            this.setState({\n                previousValues: [],\n            });\n        }\n    },\n\n    _getInputType: function() {\n        if (this.props.apiOptions.staticRender) {\n            return \"tex\";\n        } else {\n            return \"text\";\n        }\n    },\n\n    _handleFocus: function() {\n        this.props.onFocus([]);\n        // HACK(kevinb): We want to dismiss the feedback popover that webapp\n        // displays as soon as a user clicks in in the input field so we call\n        // interactionCallback directly.\n        const {interactionCallback} = this.props.apiOptions;\n        if (interactionCallback) {\n            interactionCallback();\n        }\n    },\n\n    _handleBlur: function() {\n        this.props.onBlur([]);\n    },\n\n    _addInput: function() {\n        // Add a new blank value to the list of current values\n        this.props.onChange({\n            currentMultipleValues: this.props.currentMultipleValues.concat([\n                \"\",\n            ]),\n        });\n    },\n\n    _removeInput: function(i, event) {\n        const length = this.props.currentMultipleValues.length;\n        const newValues = this.props.currentMultipleValues.slice(0, i).concat(\n            this.props.currentMultipleValues.slice(i + 1, length));\n        this.props.onChange({\n            currentMultipleValues: newValues,\n        });\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    focusInputPath: function(inputPath) {\n        this.refs.input.focus();\n    },\n\n    blurInputPath: function(inputPath) {\n        this.refs.input.blur();\n    },\n\n    getInputPaths: function() {\n        // The widget itself is an input, so we return a single empty list to\n        // indicate this.\n        return [[]];\n    },\n\n    getGrammarTypeForPath: function(inputPath) {\n        return \"number\";\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        this.props.onChange(\n            {\n                currentValue: newValue,\n            },\n            cb\n        );\n    },\n\n    getUserInput: function() {\n        const multiple = this.props.multipleNumberInput;\n        return {\n            multInput: multiple,\n            currentValue: multiple\n                ? this.props.currentMultipleValues\n                : this.props.currentValue,\n        };\n    },\n\n    simpleValidate: function(rubric) {\n        return NumericInput.validate(this.getUserInput(), rubric);\n    },\n\n    shouldShowExamples: function() {\n        var noFormsAccepted = this.props.answerForms.length === 0;\n        // To check if all answer forms are accepted, we must first\n        // find the *names* of all accepted forms, and see if they are\n        // all present, ignoring duplicates\n        var answerFormNames = _.uniq(\n            this.props.answerForms.map(form => form.name)\n        );\n        var allFormsAccepted = answerFormNames.length >= _.size(formExamples);\n        return !noFormsAccepted && !allFormsAccepted;\n    },\n\n    examples: function() {\n        // if the set of specified forms are empty, allow all forms\n        var forms =\n            this.props.answerForms.length !== 0\n                ? this.props.answerForms\n                : _.map(_.keys(formExamples), name => {\n                      return {\n                          name: name,\n                          simplify: \"required\",\n                      };\n                  });\n\n        var examples = _.map(forms, form => {\n            return formExamples[form.name](form);\n        });\n        // Ensure no duplicate tooltip text from simplified and unsimplified\n        // versions of the same format\n        examples = _.uniq(examples);\n\n        return [i18n._(\"**Your answer should be** \")].concat(examples);\n    },\n});\n\n_.extend(NumericInput, {\n    validate: function(state, rubric) {\n        var allAnswerForms = _.pluck(answerFormButtons, \"value\");\n\n        var createValidator = answer => KhanAnswerTypes.number.createValidatorFunctional(answer.value, {\n            message: answer.message,\n            simplify:\n                answer.status === \"correct\" ? answer.simplify : \"optional\",\n            inexact: true, // TODO(merlob) backfill / delete\n            maxError: answer.maxError,\n            forms:\n                answer.strict &&\n                answer.answerForms &&\n                answer.answerForms.length !== 0\n                    ? answer.answerForms\n                    : allAnswerForms,\n        });\n\n        // We may have received TeX; try to parse it before grading.\n        // If `currentValue` is not TeX, this should be a no-op.\n        var currentValue = ParseTex(state.currentValue);\n        var correctAnswers = _.where(rubric.answers, {status: \"correct\"});\n\n        if (state.multInput) {\n            // sort the answers and the solutions so they can be compared\n            var sortedInputs = currentValue.split(\",\").sort();\n            correctAnswers.sort((a, b) => {\n                return a.value > b.value ? 1 : -1;\n            });\n\n            // If the number of correct answers and user answers do not match\n            // return early that the answer is wrong\n            if (sortedInputs.length !== correctAnswers.length) {\n                return {\n                    type: \"points\",\n                    earned: 0,\n                    total: 1,\n                    message: \"Incorrect number of answers\",\n                };\n            }\n\n            // Look through all correct answers and make sure there is\n            // the correct user answer for each\n            var correct = true;\n            var message;\n            correctAnswers.forEach(function(answer, i) {\n                var localValue = sortedInputs[i];\n                if (rubric.coefficient) {\n                    if (!localValue) {\n                        localValue = 1;\n                    } else if (localValue === \"-\") {\n                        localValue = -1;\n                    }\n                }\n                var validate = createValidator(answer);\n                const status = validate(localValue);\n                correct = correct && status.correct;\n                if (status.message) {\n                    message = status.message;\n                }\n            });\n\n            return {\n                type: \"points\",\n                earned: correct ? 1 : 0,\n                total: 1,\n                message: message,\n            };\n        } else {\n            // Look through all correct answers for one that matches either\n            // precisely or approximately and return the appropriate message:\n            // - if precise, return the message that the answer came with\n            // - if it needs to be simplified, etc., show that message\n            var result = _.find(\n                _.map(correctAnswers, answer => {\n                    // The coefficient is an attribute of the widget\n                    var localValue = currentValue;\n                    if (rubric.coefficient) {\n                        if (!localValue) {\n                            localValue = 1;\n                        } else if (localValue === \"-\") {\n                            localValue = -1;\n                        }\n                    }\n                    var validate = createValidator(answer);\n                    return validate(localValue);\n                }),\n                match => match.correct || match.empty\n            );\n\n            if (!result) {\n                // Otherwise, if the guess is not correct\n                var otherAnswers = [].concat(\n                    _.where(rubric.answers, {status: \"ungraded\"}),\n                    _.where(rubric.answers, {status: \"wrong\"})\n                );\n\n                // Look through all other answers and if one matches either\n                // precisely or approximately return the answer's message\n                const match = _.find(otherAnswers, answer => {\n                    var validate = createValidator(answer);\n                    return validate(currentValue).correct;\n                });\n                result = {\n                    empty: match ? match.status === \"ungraded\" : false,\n                    correct: match ? match.status === \"correct\" : false,\n                    message: match ? match.message : null,\n                    guess: currentValue,\n                };\n            }\n\n            // TODO(eater): Seems silly to translate result to this\n            // invalid/points thing and immediately translate it\n            // back in ItemRenderer.scoreInput()\n            if (result.empty) {\n                return {\n                    type: \"invalid\",\n                    message: result.message,\n                };\n            } else {\n                return {\n                    type: \"points\",\n                    earned: result.correct ? 1 : 0,\n                    total: 1,\n                    message: result.message,\n                };\n            }\n        }\n    },\n});\n\n// TODO(thomas): Currently we receive a list of lists of acceptable answer types\n// and union them down into a single set. It's worth considering whether it\n// wouldn't make more sense to have a single set of acceptable answer types for\n// a given *problem* rather than for each possible [correct/wrong] *answer*.\n// When should two answers to a problem take different answer types?\n// See D27790 for more discussion.\nvar unionAnswerForms = function(answerFormsList) {\n    // Takes a list of lists of answer forms, and returns a list of the forms\n    // in each of these lists in the same order that they're listed in the\n    // `formExamples` forms from above.\n\n    // uniqueBy takes a list of elements and a function which compares whether\n    // two elements are equal, and returns a list of unique elements. This is\n    // just a helper function here, but works generally.\n    var uniqueBy = function(list, iteratee) {\n        return _.reduce(\n            list,\n            (uniqueList, element) => {\n                // For each element, decide whether it's already in the list of\n                // unique items.\n                var inList = _.find(uniqueList, iteratee.bind(null, element));\n                if (inList) {\n                    return uniqueList;\n                } else {\n                    return uniqueList.concat([element]);\n                }\n            },\n            []\n        );\n    };\n\n    // Pull out all of the forms from the different lists.\n    var allForms = _.flatten(answerFormsList);\n    // Pull out the unique forms using uniqueBy.\n    var uniqueForms = uniqueBy(allForms, _.isEqual);\n    // Sort them by the order they appear in the `formExamples` list.\n    return _.sortBy(uniqueForms, form => {\n        return _.keys(formExamples).indexOf(form.name);\n    });\n};\n\nvar propsTransform = function(editorProps) {\n    var rendererProps = _.extend(_.omit(editorProps, \"answers\"), {\n        answerForms: unionAnswerForms(\n            // Pull out the name of each form and whether that form has\n            // required simplification.\n            _.map(editorProps.answers, answer => {\n                return _.map(answer.answerForms, form => {\n                    return {\n                        simplify: answer.simplify,\n                        name: form,\n                    };\n                });\n            })\n        ),\n    });\n\n    return rendererProps;\n};\n\nconst styles = StyleSheet.create({\n    addInputButton: {\n        cursor: \"pointer\",\n        display: \"inline-block\",\n        border: `2px solid ${styleConstants.kaGreen}`,\n        backgroundColor: styleConstants.kaGreen,\n        color: styleConstants.white,\n        fontSize: 20,\n        borderRadius: 15,\n        width: 18,\n        height: 18,\n        marginBottom: 7,\n        marginRight: 8,\n        marginTop: 3,\n        textAlign: \"center\",\n        paddingTop: 1,\n    },\n\n    removeInputButton: {\n        cursor: \"pointer\",\n        display: \"inline-block\",\n        border: `2px solid ${styleConstants.red}`,\n        backgroundColor: styleConstants.red,\n        color: styleConstants.white,\n        fontSize: 20,\n        borderRadius: 15,\n        width: 18,\n        height: 18,\n        marginBottom: 7,\n        marginRight: 8,\n        marginTop: 4,\n        textAlign: \"center\",\n    },\n\n    dropdown: {\n        width: 250,\n        marginBottom: 10,\n        appearance: 'none',\n        backgroundColor: 'transparent',\n        border: `1px solid ${styleConstants.gray76}`,\n        borderRadius: 4,\n        boxShadow: 'none',\n        fontFamily: styleConstants.baseFontFamily,\n        padding: `9px 25px 9px 9px`,\n\n        ':focus': {\n            outline: 'none',\n            border: `2px solid ${styleConstants.kaGreen}`,\n            padding: `8px 25px 8px 8px`,\n        },\n\n        ':focus + svg': {\n            color: `${styleConstants.kaGreen}`,\n        },\n\n        ':disabled': {\n            color: styleConstants.gray68,\n        },\n\n        ':disabled + svg' : {\n            color: styleConstants.gray68,\n        },\n    },\n\n    numberInput: {\n        float: \"right\",\n        width: 170,\n        marginBottom: 10,\n        border: `1px solid ${styleConstants.gray76}`,\n        borderRadius: 4,\n        padding: `9px 25px 9px 9px`,\n\n        ':focus': {\n            outline: 'none',\n            border: `2px solid ${styleConstants.kaGreen}`,\n            padding: `8px 25px 8px 8px`,\n        },\n    },\n\n    numberInputContainer: {\n        display: \"flex\",\n    },\n});\n\n_module_.exports = {\n    name: \"numeric-input\",\n    displayName: \"Number text box\",\n    defaultAlignment: \"inline-block\",\n    accessible: true,\n    widget: NumericInput,\n    transform: propsTransform,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _componentsInfoTipJsx from \"../components/info-tip.jsx\";\nimport _reactComponentsBlurInputJsx from \"react-components/blur-input.jsx\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst Util = _utilJs;\n\nconst BlurInput = _reactComponentsBlurInputJsx;\nconst InfoTip = _componentsInfoTipJsx;\n\nvar answerTypes = {\n    number: {\n        name: \"Numbers\",\n        forms: \"integer, decimal, proper, improper, mixed\",\n    },\n    decimal: {\n        name: \"Decimals\",\n        forms: \"decimal\",\n    },\n    integer: {\n        name: \"Integers\",\n        forms: \"integer\",\n    },\n    rational: {\n        name: \"Fractions and mixed numbers\",\n        forms: \"integer, proper, improper, mixed\",\n    },\n    improper: {\n        name: \"Improper numbers (no mixed)\",\n        forms: \"integer, proper, improper\",\n    },\n    mixed: {\n        name: \"Mixed numbers (no improper)\",\n        forms: \"integer, proper, mixed\",\n    },\n    percent: {\n        name: \"Numbers or percents\",\n        forms: \"integer, decimal, proper, improper, mixed, percent\",\n    },\n    pi: {\n        name: \"Numbers with pi\",\n        forms: \"pi\",\n    },\n};\n\nconst InputNumberEditor = createReactClass({\n    propTypes: {\n        value: PropTypes.number,\n        simplify: PropTypes.oneOf([\"required\", \"optional\", \"enforced\"]),\n        size: PropTypes.oneOf([\"normal\", \"small\"]),\n        inexact: PropTypes.bool,\n        maxError: PropTypes.number,\n        answerType: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            value: 0,\n            simplify: \"required\",\n            size: \"normal\",\n            inexact: false,\n            maxError: 0.1,\n            answerType: \"number\",\n        };\n    },\n\n    handleAnswerChange: function(str) {\n        var value = Util.firstNumericalParse(str) || 0;\n        this.props.onChange({value: value});\n    },\n\n    render: function() {\n        var answerTypeOptions = _.map(\n            answerTypes,\n            function(v, k) {\n                return (\n                    <option value={k} key={k}>\n                        {v.name}\n                    </option>\n                );\n            },\n            this\n        );\n\n        return (\n            <div>\n                <div>\n                    <label>\n                        Correct answer:{\" \"}\n                        <BlurInput\n                            value={\"\" + this.props.value}\n                            onChange={this.handleAnswerChange}\n                            ref=\"input\"\n                        />\n                    </label>\n                </div>\n\n                <div>\n                    <label>\n                        Unsimplified answers{\" \"}\n                        <select\n                            value={this.props.simplify}\n                            onChange={e => {\n                                this.props.onChange({\n                                    simplify: e.target.value,\n                                });\n                            }}\n                        >\n                            <option value=\"required\">will not be graded</option>\n                            <option value=\"optional\">will be accepted</option>\n                            <option value=\"enforced\">\n                                will be marked wrong\n                            </option>\n                        </select>\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Normally select \"will not be graded\". This will give\n                            the user a message saying the answer is correct but\n                            not simplified. The user will then have to simplify\n                            it and re-enter, but will not be penalized. (5th\n                            grade and anything after)\n                        </p>\n                        <p>\n                            Select \"will be accepted\" only if the user is not\n                            expected to know how to simplify fractions yet.\n                            (Anything prior to 5th grade)\n                        </p>\n                        <p>\n                            Select \"will be marked wrong\" only if we are\n                            specifically assessing the ability to simplify.\n                        </p>\n                    </InfoTip>\n                </div>\n\n                <div>\n                    <label>\n                        <input\n                            type=\"checkbox\"\n                            checked={this.props.inexact}\n                            onChange={e => {\n                                this.props.onChange({\n                                    inexact: e.target.checked,\n                                });\n                            }}\n                        />{\" \"}\n                        Allow inexact answers\n                    </label>\n\n                    <label>\n                        <input /* TODO(emily): don't use a hidden checkbox\n                        for alignment */\n                            type=\"checkbox\"\n                            style={{visibility: \"hidden\"}}\n                        />\n                        Max error:{\" \"}\n                        <input\n                            type=\"text\"\n                            disabled={!this.props.inexact}\n                            defaultValue={this.props.maxError}\n                            onBlur={e => {\n                                var ans =\n                                    \"\" +\n                                    (Util.firstNumericalParse(e.target.value) ||\n                                        0);\n                                e.target.value = ans;\n                                this.props.onChange({maxError: ans});\n                            }}\n                        />\n                    </label>\n                </div>\n\n                <div>\n                    Answer type:{\" \"}\n                    <select\n                        value={this.props.answerType}\n                        onChange={e => {\n                            this.props.onChange({answerType: e.target.value});\n                        }}\n                    >\n                        {answerTypeOptions}\n                    </select>\n                    <InfoTip>\n                        <p>\n                            Use the default \"Numbers\" unless the answer must be\n                            in a specific form (e.g., question is about\n                            converting decimals to fractions).\n                        </p>\n                    </InfoTip>\n                </div>\n\n                <div>\n                    <label>\n                        Width{\" \"}\n                        <select\n                            value={this.props.size}\n                            onChange={e => {\n                                this.props.onChange({size: e.target.value});\n                            }}\n                        >\n                            <option value=\"normal\">Normal (80px)</option>\n                            <option value=\"small\">Small (40px)</option>\n                        </select>\n                    </label>\n                    <InfoTip>\n                        <p>\n                            Use size \"Normal\" for all text boxes, unless there\n                            are multiple text boxes in one line and the answer\n                            area is too narrow to fit them.\n                        </p>\n                    </InfoTip>\n                </div>\n            </div>\n        );\n    },\n\n    focus: function() {\n        ReactDOM.findDOMNode(this.refs.input).focus();\n        return true;\n    },\n\n    serialize: function() {\n        return _.pick(\n            this.props,\n            \"value\",\n            \"simplify\",\n            \"size\",\n            \"inexact\",\n            \"maxError\",\n            \"answerType\"\n        );\n    },\n});\n\n_module_.exports = InputNumberEditor;\nexport default _module_.exports;\n","import _perseusApiJsx2 from \"../perseus-api.jsx\";\nimport _perseusApiJsx from \"../perseus-api.jsx\";\nimport { linterContextProps, linterContextDefault } from \"../gorgon/proptypes.js\";\nimport _mathInput from \"@khanacademy/math-input\";\nimport _utilAnswerTypesJs from \"../util/answer-types.js\";\nimport _componentsPossibleAnswersJsx from \"../components/possible-answers.jsx\";\nimport _texWranglerJs from \"../tex-wrangler.js\";\nimport _componentsSimpleKeypadInputJsx from \"../components/simple-keypad-input.jsx\";\nimport _componentsInputWithExamplesJsx from \"../components/input-with-examples.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable brace-style, comma-dangle, no-undef, no-var, object-curly-spacing, react/forbid-prop-types, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar classNames = _classnames;\nvar React = _react;\nvar _ = _underscore;\n\nvar InputWithExamples = _componentsInputWithExamplesJsx;\nconst SimpleKeypadInput = _componentsSimpleKeypadInputJsx;\nvar ParseTex = _texWranglerJs.parseTex;\nvar PossibleAnswers = _componentsPossibleAnswersJsx;\nconst KhanAnswerTypes = _utilAnswerTypesJs;\nconst {keypadElementPropType} = _mathInput.propTypes;\n\nvar ApiClassNames = _perseusApiJsx.ClassNames;\nvar ApiOptions = _perseusApiJsx2.Options;\n\nvar answerTypes = {\n    number: {\n        name: \"Numbers\",\n        forms: \"integer, decimal, proper, improper, mixed\",\n    },\n    decimal: {\n        name: \"Decimals\",\n        forms: \"decimal\",\n    },\n    integer: {\n        name: \"Integers\",\n        forms: \"integer\",\n    },\n    rational: {\n        name: \"Fractions and mixed numbers\",\n        forms: \"integer, proper, improper, mixed\",\n    },\n    improper: {\n        name: \"Improper numbers (no mixed)\",\n        forms: \"integer, proper, improper\",\n    },\n    mixed: {\n        name: \"Mixed numbers (no improper)\",\n        forms: \"integer, proper, mixed\",\n    },\n    percent: {\n        name: \"Numbers or percents\",\n        forms: \"integer, decimal, proper, improper, mixed, percent\",\n    },\n    pi: {\n        name: \"Numbers with pi\",\n        forms: \"pi\",\n    },\n};\n\nvar formExamples = {\n    integer: function(options) {\n        return i18n._(\"an integer, like $6$\");\n    },\n    proper: function(options) {\n        if (options.simplify === \"optional\") {\n            return i18n._(\"a *proper* fraction, like $1/2$ or $6/10$\");\n        } else {\n            return i18n._(\"a *simplified proper* fraction, like $3/5$\");\n        }\n    },\n    improper: function(options) {\n        if (options.simplify === \"optional\") {\n            return i18n._(\"an *improper* fraction, like $10/7$ or $14/8$\");\n        } else {\n            return i18n._(\"a *simplified improper* fraction, like $7/4$\");\n        }\n    },\n    mixed: function(options) {\n        return i18n._(\"a mixed number, like $1\\\\ 3/4$\");\n    },\n    decimal: function(options) {\n        return i18n._(\"an *exact* decimal, like $0.75$\");\n    },\n    percent: function(options) {\n        return i18n._(\"a percent, like $12.34\\\\%$\");\n    },\n    pi: function(options) {\n        return i18n._(\n            \"a multiple of pi, like $12\\\\ \\\\text{pi}$ or \" +\n                \"$2/3\\\\ \\\\text{pi}$\"\n        );\n    },\n};\n\nvar InputNumber = createReactClass({\n    propTypes: {\n        answerType: PropTypes.oneOf(Object.keys(answerTypes)),\n        currentValue: PropTypes.string,\n        keypadElement: keypadElementPropType,\n        reviewModeRubric: PropTypes.object,\n        widgetId: PropTypes.string.isRequired,\n        linterContext: linterContextProps,\n    },\n\n    getDefaultProps: function() {\n        return {\n            currentValue: \"\",\n            size: \"normal\",\n            answerType: \"number\",\n            apiOptions: ApiOptions.defaults,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    shouldShowExamples: function() {\n        return (\n            this.props.answerType !== \"number\" &&\n            !this.props.apiOptions.staticRender\n        );\n    },\n\n    render: function() {\n        if (this.props.apiOptions.customKeypad) {\n            // TODO(charlie): Support \"Review Mode\".\n            return (\n                <SimpleKeypadInput\n                    ref=\"input\"\n                    value={this.props.currentValue}\n                    keypadElement={this.props.keypadElement}\n                    onChange={this.handleChange}\n                    onFocus={this._handleFocus}\n                    onBlur={this._handleBlur}\n                />\n            );\n        } else {\n            // HACK(johnsullivan): Create a function with shared logic between\n            // this and NumericInput.\n            var rubric = this.props.reviewModeRubric;\n            var correct = null;\n            var answerBlurb = null;\n            if (this.props.apiOptions.satStyling && rubric) {\n                var score = this.simpleValidate(rubric);\n                correct =\n                    score.type === \"points\" && score.earned === score.total;\n\n                if (!correct) {\n                    // TODO(johnsullivan): Make this a little more\n                    // human-friendly.\n                    var answerString = String(rubric.value);\n                    if (rubric.inexact && rubric.maxError) {\n                        answerString += \" \\u00B1 \" + rubric.maxError;\n                    }\n                    var answerStrings = [answerString];\n                    answerBlurb = <PossibleAnswers answers={answerStrings} />;\n                }\n            }\n\n            var classes = {};\n            classes[\"perseus-input-size-\" + this.props.size] = true;\n            classes[ApiClassNames.CORRECT] =\n                rubric && correct && this.props.currentValue;\n            classes[ApiClassNames.INCORRECT] =\n                rubric && !correct && this.props.currentValue;\n            classes[ApiClassNames.UNANSWERED] =\n                rubric && !this.props.currentValue;\n\n            var input = (\n                <InputWithExamples\n                    ref=\"input\"\n                    value={this.props.currentValue}\n                    onChange={this.handleChange}\n                    className={classNames(classes)}\n                    type={this._getInputType()}\n                    examples={this.examples()}\n                    shouldShowExamples={this.shouldShowExamples()}\n                    onFocus={this._handleFocus}\n                    onBlur={this._handleBlur}\n                    id={this.props.widgetId}\n                    disabled={this.props.apiOptions.readOnly}\n                    linterContext={this.props.linterContext}\n                />\n            );\n\n            if (answerBlurb) {\n                return (\n                    <span className=\"perseus-input-with-answer-blurb\">\n                        {input}\n                        {answerBlurb}\n                    </span>\n                );\n            } else {\n                return input;\n            }\n        }\n    },\n\n    handleChange: function(newValue, cb) {\n        this.props.onChange({currentValue: newValue}, cb);\n    },\n\n    _getInputType: function() {\n        if (this.props.apiOptions.staticRender) {\n            return \"tex\";\n        } else {\n            return \"text\";\n        }\n    },\n\n    _handleFocus: function() {\n        this.props.onFocus([]);\n        // HACK(kevinb): We want to dismiss the feedback popover that webapp\n        // displays as soon as a user clicks in in the input field so we call\n        // interactionCallback directly.\n        const {interactionCallback} = this.props.apiOptions;\n        if (interactionCallback) {\n            interactionCallback();\n        }\n    },\n\n    _handleBlur: function() {\n        this.props.onBlur([]);\n    },\n\n    focus: function() {\n        this.refs.input.focus();\n        return true;\n    },\n\n    focusInputPath: function(inputPath) {\n        this.refs.input.focus();\n    },\n\n    blurInputPath: function(inputPath) {\n        this.refs.input.blur();\n    },\n\n    getInputPaths: function() {\n        // The widget itself is an input, so we return a single empty list to\n        // indicate this.\n        return [[]];\n    },\n\n    getGrammarTypeForPath: function(path) {\n        return \"number\";\n    },\n\n    setInputValue: function(path, newValue, cb) {\n        this.props.onChange(\n            {\n                currentValue: newValue,\n            },\n            cb\n        );\n    },\n\n    getUserInput: function() {\n        return {\n            currentValue: this.props.currentValue,\n        };\n    },\n\n    simpleValidate: function(rubric, onInputError) {\n        onInputError = onInputError || function() {};\n        return InputNumber.validate(this.getUserInput(), rubric, onInputError);\n    },\n\n    examples: function() {\n        var type = this.props.answerType;\n        var forms = answerTypes[type].forms.split(/\\s*,\\s*/);\n\n        var examples = _.map(\n            forms,\n            function(form) {\n                return formExamples[form](this.props);\n            },\n            this\n        );\n\n        return [i18n._(\"**Your answer should be** \")].concat(examples);\n    },\n});\n\n_.extend(InputNumber, {\n    validate: function(state, rubric, onInputError) {\n        if (rubric.answerType == null) {\n            rubric.answerType = \"number\";\n        }\n        var val = KhanAnswerTypes.number.createValidatorFunctional(\n            rubric.value,\n            {\n                simplify: rubric.simplify,\n                inexact: rubric.inexact || undefined,\n                maxError: rubric.maxError,\n                forms: answerTypes[rubric.answerType].forms,\n            }\n        );\n\n        // We may have received TeX; try to parse it before grading.\n        // If `currentValue` is not TeX, this should be a no-op.\n        var currentValue = ParseTex(state.currentValue);\n\n        var result = val(currentValue);\n\n        // TODO(eater): Seems silly to translate result to this invalid/points\n        // thing and immediately translate it back in ItemRenderer.scoreInput()\n        if (result.empty) {\n            var apiResult = onInputError(\n                null, // reserved for some widget identifier\n                state.currentValue,\n                result.message\n            );\n            return {\n                type: \"invalid\",\n                message: apiResult === false ? null : result.message,\n            };\n        } else {\n            return {\n                type: \"points\",\n                earned: result.correct ? 1 : 0,\n                total: 1,\n                message: result.message,\n            };\n        }\n    },\n});\n\nvar propTransform = editorProps => {\n    const {simplify, size, answerType} = editorProps;\n    return {\n        simplify,\n        size,\n        answerType,\n    };\n};\n\n_module_.exports = {\n    name: \"input-number\",\n    displayName: \"Number text box (old)\",\n    defaultAlignment: \"inline-block\",\n    hidden: true,\n    widget: InputNumber,\n    transform: propTransform,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import * as styleConstants from \"../../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n\n/**\n * Renders text indicating whether the choice was correct or\n * not and whether the choice was selected or not.\n * This information is redundant with that provided in the\n * ChoiceIcon visualizations but is meant to make the distinctions\n * between the states more immediately clear to users.\n */\n\n/* globals i18n */\n\nconst React = _react;\n\nclass OptionStatus extends React.Component {\n    render() {\n        const {checked, correct} = this.props;\n        const correctness = correct ? i18n._(\"correct\") : i18n._(\"incorrect\");\n        const selectedness = checked ? i18n._(\"(selected)\") : \"\";\n        const text = `${correctness} ${selectedness}`;\n        const textStyle = correct ? styles.correct : styles.incorrect;\n        return <div className={css(styles.text, textStyle)}>\n            {text}\n        </div>;\n    }\n}\n\nconst styles = StyleSheet.create({\n    text: {\n        alignItems: \"center\",\n        display: \"flex\",\n        fontSize: 12,\n        height: 32,\n        textTransform: \"uppercase\",\n    },\n    correct: {\n        color: styleConstants.kaGreen,\n    },\n    incorrect: {\n        color: styleConstants.warning1,\n    },\n});\n\n_module_.exports = OptionStatus;\nexport default _module_.exports;\n","import * as styleConstants from \"../../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n\n/**\n * Renders a circular selection ring around the child.\n */\n\nconst React = _react;\n\nclass FocusRing extends React.Component {\n    static defaultProps = {\n        visible: true,\n        color: styleConstants.kaGreen,\n    }\n\n    render() {\n        const borderColor = this.props.visible\n                          ? this.props.color\n                          : \"transparent\";\n        const style = {\n            borderColor: borderColor,\n        };\n        return <span className={css(styles.ring)} style={style}>\n            {this.props.children}\n        </span>;\n    }\n}\n\nconst styles = StyleSheet.create({\n    ring: {\n        margin: \"auto\",\n        display: \"inline-block\",\n        borderRadius: \"50%\",\n        borderWidth: 2,\n        padding: 2,\n        borderStyle: \"solid\",\n    },\n});\n\n_module_.exports = FocusRing;\nexport default _module_.exports;\n","import _focusRingJsx from \"./focus-ring.jsx\";\nimport _componentsInlineIconJsx from \"../../components/inline-icon.jsx\";\nimport { iconCheck, iconMinus } from \"../../icon-paths.js\";\nimport * as styleConstants from \"../../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n\n/* Component for rendering a letter icon in radio choice */\n\n/* global i18n */\n\nconst React = _react;\n\nconst InlineIcon = _componentsInlineIconJsx;\nconst FocusRing = _focusRingJsx;\n\nclass SATChoiceIcon extends React.Component {\n    // TODO(amy): figure out a better scheme for specifying these\n    // styles that isn't such a pain to grok. See some neat ideas\n    // from MDR in https://phabricator.khanacademy.org/D35249.\n    constructStyles(reviewMode, correct, checked) {\n        let backgroundColor;\n        let borderColor = styleConstants.satBlue;\n        let color = styleConstants.satBlue;\n        if (reviewMode) {\n            if (correct) {\n                borderColor = styleConstants.satCorrectColor;\n                color = checked\n                    ? styleConstants.white\n                    : styleConstants.satCorrectColor;\n                backgroundColor = checked\n                    ? styleConstants.satCorrectColor\n                    : styleConstants.white;\n            } else if (checked) {\n                borderColor = styleConstants.satIncorrectColor;\n                color = styleConstants.white;\n                backgroundColor = styleConstants.satIncorrectColor;\n            }\n        } else if (checked) {\n            color = styleConstants.white;\n            backgroundColor = styleConstants.satBlue;\n        }\n        return {color, backgroundColor, borderColor};\n    }\n\n    render() {\n        const {letter, a11yText, reviewMode, checked, correct} = this.props;\n        const {color, backgroundColor, borderColor} = this.constructStyles(\n            reviewMode,\n            correct,\n            checked\n        );\n\n        return (\n            <div>\n                <div\n                    className={css(styles.satCircle)}\n                    style={{backgroundColor, borderColor}}\n                />\n                <div style={{color}} className={css(styles.letter)}>\n                    <span className=\"perseus-sr-only\">\n                        {a11yText}\n                    </span>\n                    <span aria-hidden=\"true\">\n                        {letter}\n                    </span>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass LibraryChoiceIcon extends React.Component {\n    getChoiceInner() {\n        const {letter, showCorrectness, correct} = this.props;\n\n        if (!showCorrectness) {\n            return letter;\n        } else if (correct) {\n            return (\n                <InlineIcon\n                    {...iconCheck}\n                    style={{\n                        position: \"relative\",\n                        top: -1,\n                    }}\n                />\n            );\n        } else {\n            return <InlineIcon {...iconMinus} />;\n        }\n    }\n\n    // Handle dynamic styling of the multiple choice icon. Most\n    // MC icon styles are constant, but we do allow the caller\n    // to specify the selected color, and thus must control styles\n    // related to the selected state dynamically.\n    getDynamicStyles() {\n        const {\n            checked,\n            showCorrectness,\n            pressed,\n            primaryProductColor,\n            correct,\n        } = this.props;\n        if (!showCorrectness && pressed) {\n            return {\n                borderColor: primaryProductColor,\n                color: primaryProductColor,\n                backgroundColor: styleConstants.white,\n            };\n        } else if (checked) {\n            // Note: kaGreen is not only the default product color,\n            // but also the \"correctness\" color\n            const bg =\n                showCorrectness && correct\n                    ? styleConstants.kaGreen\n                    : primaryProductColor;\n            return {\n                color: styleConstants.white,\n                backgroundColor: bg,\n                borderColor: bg,\n            };\n        } else {\n            return {\n                borderColor: styleConstants.gray68,\n                color: styleConstants.gray68,\n            };\n        }\n    }\n\n    render() {\n        const {\n            checked,\n            showCorrectness,\n            correct,\n            focused,\n            primaryProductColor,\n        } = this.props;\n        return (<FocusRing color={primaryProductColor} visible={focused}>\n            <div\n                style={this.getDynamicStyles()}\n                className={css(\n                    styles.libraryCircle,\n                    showCorrectness && correct && styles.libraryCircleCorrect,\n                    showCorrectness &&\n                        !correct &&\n                        styles.libraryCircleIncorrect,\n                    showCorrectness &&\n                        !correct &&\n                        checked &&\n                        styles.libraryCircleIncorrectSelected,\n                )}\n                // used in BaseRadio to check if we actually clicked on the\n                // radio icon\n                data-is-radio-icon={true}\n            >\n                {this.getChoiceInner()}\n            </div>\n        </FocusRing>);\n    }\n}\n\nclass ChoiceIcon extends React.Component {\n    static defaultProps = {\n        primaryProductColor: styleConstants.kaGreen,\n    };\n\n    a11yText(letter) {\n        // If the option was checked we need to reveal more context about\n        // what the result was (correct/incorrect)\n        if (this.props.checked) {\n            if (this.props.showCorrectness) {\n                if (this.props.correct) {\n                    return i18n._(\"(Choice %(letter)s, Checked, Correct)\", {\n                        letter: letter,\n                    });\n                } else {\n                    return i18n._(\"(Choice %(letter)s, Checked, Incorrect)\", {\n                        letter: letter,\n                    });\n                }\n            }\n\n            return i18n._(\"(Choice %(letter)s, Checked)\", {letter: letter});\n\n            // If the option wasn't checked, but was correct, we need to tell\n            // the user that this was, in fact, the correct answer.\n        } else if (this.props.showCorrectness && this.props.correct) {\n            return i18n._(\"(Choice %(letter)s, Correct Answer)\", {\n                letter: letter,\n            });\n        }\n\n        return i18n._(\"(Choice %(letter)s)\", {letter: letter});\n    }\n\n    getLetter() {\n        /* I18N: This is a list of single-character labels that will appear in\n         * front of multiple-choice options. For instance, a multiple-choice\n         * question with three options would display\n         *  (A) first option\n         *  (B) second option\n         *  (C) third option\n         * There must be spaces between each of the different characters. The\n         * characters will show up next to options in the order that they are\n         * listed here. Most multiple choice questions have 5 or fewer options.\n         */\n        const lettersString = i18n._(\n            \"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z\"\n        );\n\n        const letters = lettersString.split(\" \");\n        const pos = this.props.pos;\n\n        if (pos < letters.length) {\n            // If the position we need is listed in the localized string, use\n            // that.\n            return letters[pos];\n        } else {\n            // If we're out of letters, give up and return a space.\n            return \" \";\n        }\n    }\n\n    render() {\n        const {\n            reviewMode,\n            checked,\n            correct,\n            product,\n            showCorrectness,\n            pressed,\n            focused,\n            primaryProductColor,\n        } = this.props;\n\n        const letter = this.getLetter();\n\n        if (product === \"sat\") {\n            return (\n                <SATChoiceIcon\n                    letter={letter}\n                    a11yText={this.a11yText(letter)}\n                    reviewMode={reviewMode}\n                    checked={checked}\n                    correct={correct}\n                />\n            );\n        } else {\n            return (\n                <LibraryChoiceIcon\n                    letter={letter}\n                    a11yText={this.a11yText(letter)}\n                    reviewMode={reviewMode}\n                    checked={checked}\n                    pressed={pressed}\n                    focused={focused}\n                    correct={correct}\n                    showCorrectness={showCorrectness}\n                    primaryProductColor={primaryProductColor}\n                />\n            );\n        }\n    }\n}\n\nconst styles = StyleSheet.create({\n    satCircle: {\n        display: \"block\",\n        borderRadius: 25,\n        borderStyle: \"solid\",\n        borderWidth: 2,\n        content: `''`,\n        height: 25,\n        width: 25,\n        position: \"absolute\",\n        top: 1,\n        left: 1,\n    },\n\n    libraryCircle: {\n        // Make the circle\n        width: 24,\n        height: 24,\n        boxSizing: \"border-box\",\n        borderRadius: 24,\n        borderStyle: \"solid\",\n        borderWidth: 2,\n\n        // The default icons have letters in them. Style those letters.\n        fontFamily: styleConstants.baseFontFamily,\n        // NOTE(emily): We explicitly set the font weight instead of using the\n        // \"bold font family\" so that characters which fall back to the default\n        // font get bolded too.\n        fontWeight: \"bold\",\n        fontSize: 12,\n\n        // Center the contents of the icon.\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        // HACK(emily): I don't know why adding this line height makes the text\n        // appear centered better than any other value, but it does. In\n        // particular, at large zoom levels this line height does almost\n        // nothing, but at the default size this shifts the letter down one\n        // pixel so it is much better centered.\n        lineHeight: \"1px\",\n    },\n\n    libraryCircleCorrect: {\n        fontSize: 24,\n    },\n\n    libraryCircleIncorrect: {\n        fontSize: 24,\n        borderColor: styleConstants.warning1,\n        color: styleConstants.warning1,\n    },\n\n    libraryCircleIncorrectSelected: {\n        backgroundColor: styleConstants.warning1,\n        color: styleConstants.white,\n    },\n\n    letter: {\n        // These properties make sure that this element has the exact\n        // same size as `circle` so that we can center things\n        // inside of it.\n        border: \"2px solid transparent\",\n        width: 25,\n        height: 25,\n        position: \"absolute\",\n        left: 1,\n        top: 1,\n\n        // Center contained items.\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n\n        fontFamily: styleConstants.boldFontFamily,\n        fontSize: 13,\n    },\n});\n\n_module_.exports = ChoiceIcon;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst _ = _underscore;\n\n/**\n * A radio button that can be unchecked by clicking it again.\n *\n * This component behaves much like a checkbox in that when you click it again\n * (or hit space bar or select it in some other way), it will become unchecked.\n * (Hopefully) it behaves exactly like a radio button in every other way though\n * (arrow keys can still be used to select it within a group for example).\n *\n * Here's a summary of which of our event handlers fire for each way to select\n * or deselect the button:\n *\n * - Clicking a button: handleClick, handleChange\n * - Pressing spacebar with button focussed: handleKeyDown, handleKeyUp (we\n *   suppress the default behavior of some browsers to synthesize a click event\n *   here).\n * - When radio button A is selected, pressing down arrow to select B:\n *   handleKeyDown (A), handleClick (B), handleChange (B), handleKeyUp (B)\n * - Clicking with mac screenreader: handleClick, handleChange\n */\nconst ToggleableRadioButton = createReactClass({\n    propTypes: {\n        // Whether the radio button should be checked or unchecked (this is a\n        // controlled component).\n        checked: PropTypes.bool.isRequired,\n\n        // A ref function to attach to the <input> element.\n        inputRef: PropTypes.func,\n\n        // A function that will be called whenever the radio button is checked\n        // or unchecked. It's possible for this to be called twice for a single\n        // checking or unchecking.\n        onChecked: PropTypes.func.isRequired,\n    },\n\n    handleClick: function(event) {\n        this.props.onChecked(!this.props.checked);\n\n        // NOTE(johnsullivan): Preventing default would make sense to do here\n        //     because we're fully controlling the state of the check box and\n        //     don't really want it to be (un)checked accidently. React\n        //     requires that we *don't* call preventDefault from the onClick or\n        //     onChecked handlers of a controlled component though.\n    },\n\n    handleKeyUp: function(event) {\n        // Make hitting the spacebar with the element selected equivalent to\n        // clicking it. Some browsers do this as part of the radio button's\n        // default behavior, but since some browsers don't we normalize the\n        // behavior here.\n        if (event.key === \" \") {\n            this.props.onChecked(!this.props.checked);\n            event.preventDefault();\n        }\n    },\n\n    handleChange: function(event) {\n        // If the checkbox is going from unchecked to checked, we'll handle it\n        // here.\n        // NOTE(johnsullivan): The onClick/onKeyUp handler most likely *also*\n        //     handled this, but we're being defensive against browsers/devices\n        //     that might not call those handlers like we'd expect. It's\n        //     unclear to me whether this is strictly necessary.\n        if (!this.props.checked && event.target.checked) {\n            this.props.onChecked(true);\n        }\n    },\n\n    handleKeyDown: function(event) {\n        // This is necessary in order to prevent IE9 from creating a duplicate\n        // click event on the radio button when the space bar is hit.\n        if (event.key === \" \") {\n            event.preventDefault();\n        }\n    },\n\n    render: function() {\n        const {\n            inputRef, // eslint-disable-line no-unused-vars\n            onChecked, // eslint-disable-line no-unused-vars\n            ...otherProps\n        } = this.props;\n\n        return (\n            <input\n                {...otherProps}\n                type=\"radio\"\n                onChange={this.handleChange}\n                onClick={this.handleClick}\n                onKeyDown={this.handleKeyDown}\n                onKeyUp={this.handleKeyUp}\n                ref={this.props.inputRef}\n            />\n        );\n    },\n});\n\n_module_.exports = ToggleableRadioButton;\nexport default _module_.exports;\n","import _optionStatusJsx from \"./option-status.jsx\";\nimport _choiceIconJsx from \"./choice-icon.jsx\";\nimport _toggleableRadioButtonJsx from \"./toggleable-radio-button.jsx\";\nimport _stylesMediaQueriesJs from \"../../styles/media-queries.js\";\nimport * as styleConstants from \"../../styles/constants.js\";\nimport _stylesSharedJs from \"../../styles/shared.js\";\nimport { ClassNames } from \"../../perseus-api.jsx\";\nimport _classnames from \"classnames\";\nimport _react from \"react\";\nimport _underscore from \"underscore\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\nconst React = _react;\nconst classNames = _classnames;\n\nconst sharedStyles = _stylesSharedJs;\nconst mediaQueries = _stylesMediaQueriesJs;\n\nconst ToggleableRadioButton = _toggleableRadioButtonJsx;\nconst ChoiceIcon = _choiceIconJsx;\nconst OptionStatus = _optionStatusJsx;\n\nconst focusedStyleMixin = {\n    backgroundColor: styleConstants.satSelectedBackgroundColor,\n    outline: `2px solid ${styleConstants.satBlue}`,\n    // Render the outline higher than the next element's border\n    zIndex: 1,\n};\n\nconst intermediateCheckboxPadding = `16px 16px`;\nconst intermediateCheckboxPaddingPhone = `12px 16px`;\n\nconst Choice = createReactClass({\n    propTypes: {\n        // TODO(kevinb) use Options.propTypes from perseus-api.jsx\n        // This change will also require make sure that item-renderer.jsx and\n        // server-item-renderer.jsx have appropriate defaults for apiOptions\n        // because many of the properties on Options.propTypes are required.\n        apiOptions: PropTypes.shape({\n            satStyling: PropTypes.bool,\n            isMobile: PropTypes.bool,\n            styling: PropTypes.shape({\n                radioStyleVersion: PropTypes.oneOf([\n                    \"intermediate\",\n                    \"final\",\n                ]),\n                primaryProductColor: PropTypes.string,\n            }),\n            readOnly: PropTypes.bool,\n        }),\n        checked: PropTypes.bool,\n        className: PropTypes.string,\n        rationale: PropTypes.node,\n        content: PropTypes.node,\n        correct: PropTypes.bool,\n        deselectEnabled: PropTypes.bool,\n        disabled: PropTypes.bool,\n        editMode: PropTypes.bool,\n        groupName: PropTypes.string,\n        isLastChoice: PropTypes.bool, // Needed for border styling\n        // This indicates the position of the choice relative to others\n        // (so that we can display a nice little (A), (B), etc. next to it)\n        // Also used to generate an id for each input.\n        pos: PropTypes.number,\n        reviewMode: PropTypes.bool,\n        showRationale: PropTypes.bool,\n        showCorrectness: PropTypes.bool,\n        type: PropTypes.string,\n\n        // Indicates whether the user has \"crossed out\" this choice, meaning\n        // that they don't think it's correct. This value does not affect\n        // scoring or other behavior; it's just a note for the user's\n        // reference.\n        crossedOut: PropTypes.bool,\n\n        // A callback indicating that this choice has changed. Its argument is\n        // an object with two keys: `checked` and `crossedOut`. Each contains a\n        // boolean value specifying the new checked and crossed-out value of\n        // this choice.\n        onChange: PropTypes.func,\n    },\n\n    statics: {\n        styles: StyleSheet.create({\n            pos: {\n                display: \"none\",\n            },\n\n            description: {\n                display: \"inline-block\",\n                width: \"100%\",\n            },\n\n            satDescription: {\n                display: \"block\",\n                position: \"relative\",\n                boxSizing: \"border-box\",\n                cursor: \"pointer\",\n                marginLeft: 0,\n                padding: \"17px 14px\",\n            },\n\n            satDescriptionInputFocused: {\n                ...focusedStyleMixin,\n            },\n\n            satDescriptionInputActive: {\n                ...focusedStyleMixin,\n                backgroundColor: styleConstants.satActiveBackgroundColor,\n            },\n\n            satDescriptionCorrect: {\n                color: styleConstants.satCorrectColor,\n            },\n\n            satDescriptionCorrectChecked: {\n                backgroundColor: styleConstants.satCorrectBackgroundColor,\n            },\n\n            satDescriptionIncorrectChecked: {\n                color: styleConstants.satIncorrectColor,\n                backgroundColor: styleConstants.satIncorrectBackgroundColor,\n            },\n\n            input: {\n                display: \"inline-block\",\n                width: 20,\n                margin: 3,\n                marginLeft: -20,\n                marginRight: 0,\n                float: \"none\",\n            },\n\n            satReviewInput: {\n                pointerEvents: \"none\",\n            },\n\n            satRadioOptionContent: {\n                userSelect: \"text\",\n                display: \"block\",\n                marginLeft: 45,\n                // Overriding here, not sure why typically set\n                // to \"cursor: default\" in js\n                cursor: \"inherit\",\n            },\n\n            satReviewRadioOptionContent: {\n                fontWeight: \"bold\",\n            },\n\n            satCheckboxOptionContent: {\n                position: \"absolute\",\n                display: \"block\",\n                top: \"50%\",\n                margin: \"-16px 0 0 0\",\n                width: \"auto\",\n            },\n\n            choiceIconWrapper: {\n                display: \"flex\",\n                marginRight: 12,\n\n                // NOTE(mdr): Without this style, the bubbles shrink on iOS\n                //     when answer text gets long.\n                flexShrink: 0,\n            },\n\n            optionStatusContainer: {\n                display: \"block\",\n            },\n\n            rationale: {\n                display: \"block\",\n            },\n\n            nonSatRationale: {\n                padding: intermediateCheckboxPadding,\n                paddingTop: 0,\n                marginLeft: 44,\n                [mediaQueries.smOrSmaller]: {\n                    padding: intermediateCheckboxPaddingPhone,\n                    paddingTop: 0,\n                },\n            },\n\n            satReviewRationale: {\n                marginTop: 13,\n                marginLeft: 45,\n            },\n\n            label: {\n                display: \"block\",\n            },\n\n            responsiveLabel: {\n                WebkitTapHighlightColor: \"transparent\",\n                display: \"flex\",\n            },\n\n            satLabel: {\n                cursor: \"pointer\",\n            },\n\n            intermediateResponsiveCheckbox: {\n                display: \"flex\",\n                alignItems: \"center\",\n\n                padding: intermediateCheckboxPadding,\n                [mediaQueries.smOrSmaller]: {\n                    padding: intermediateCheckboxPaddingPhone,\n                },\n            },\n            intermediateResponsiveCheckboxReview: {\n                alignItems: 'flex-start',\n            },\n\n            crossOutLink: {\n                textAlign: \"right\",\n                alignSelf: \"center\",\n                width: 100,\n            },\n        }),\n    },\n\n    getDefaultProps: function() {\n        return {\n            checked: false,\n            classSet: {},\n            disabled: false,\n            editMode: false,\n            showRationale: false,\n            type: \"radio\",\n            pos: 0,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            isInputFocused: false,\n            isInputActive: false,\n        };\n    },\n\n    componentWillUpdate(nextProps) {\n        if (this.state.isInputFocused && nextProps.disabled) {\n            this.setState({\n                isInputFocused: false,\n            });\n        }\n    },\n\n    onInputFocus: function() {\n        this.setState({isInputFocused: true});\n    },\n\n    onInputBlur: function() {\n        this.setState({isInputFocused: false});\n    },\n\n    onInputMouseDown: function(e) {\n        if (e.type === \"mousedown\" && this.justFinishedTouch) {\n            return;\n        }\n\n        this.setState({isInputActive: true});\n\n        // Simulate Chrome's radio button behavior in all browsers: when the\n        // mouse goes down or up, the radio button should become focused.\n        // That way, the newly-selected answer becomes highlighted after click.\n        if (this.props.apiOptions.satStyling && this._input) {\n            this._input.focus();\n        }\n    },\n\n    onInputMouseUp: function(e) {\n        if (e.type === \"mouseup\" && this.justFinishedTouch) {\n            return;\n        }\n\n        // NOTE(emily): We do some special handling here of touch events to\n        // make the \"active\" effect look better. In particular, when you click\n        // using touch events, we get a series of events going\n        // touchstart -> (delay) -> touchend -> mousedown -> mouseup -> click\n        // In order to make sure that we don't turn the active state of and on\n        // and off again during the touchend -> mousedown -> mouseup series, we\n        // set a flag (this.justFinishedTouch) after the touchend, and ignore\n        // the mousedown and mouseup events. Then, a little while later, we\n        // turn the flag off. Instead of turning the active state off right at\n        // the beginning, we wait for a little bit to sync it up better with\n        // the click event.\n        if (e.type === \"touchend\") {\n            this.justFinishedTouch = true;\n\n            setTimeout(() => {\n                this.setState({isInputActive: false});\n                this.justFinishedTouch = false;\n            }, 10);\n            return;\n        }\n\n        this.setState({isInputActive: false});\n\n        // Simulate Chrome's radio button behavior in all browsers: when the\n        // mouse goes down or up, the radio button should become focused.\n        // That way, the newly-selected answer becomes highlighted after click.\n        if (this.props.apiOptions.satStyling && this._input) {\n            this._input.focus();\n        }\n    },\n\n    onInputMouseOut: function() {\n        this.setState({isInputActive: false});\n    },\n\n    inputRef: function(ref) {\n        this._input = ref;\n    },\n\n    renderOptionStatus() {\n        const {correct, checked, reviewMode} = this.props;\n        // Option status is shown only in review mode, and excluded for SAT\n        if (!reviewMode || this.props.apiOptions.satStyling) {\n            return;\n        }\n        return <OptionStatus\n            checked={checked}\n            correct={correct}\n        />;\n    },\n\n    renderChoiceIcon() {\n        const {\n            radioStyleVersion,\n            primaryProductColor,\n        } = this.props.apiOptions.styling;\n        const finalStyles =\n            typeof radioStyleVersion === \"undefined\"\n                ? false\n                : radioStyleVersion === \"final\";\n\n        if (!finalStyles && !this.props.apiOptions.satStyling) {\n            return null;\n        }\n\n        return (\n            <ChoiceIcon\n                pos={this.props.pos}\n                correct={this.props.correct}\n                pressed={this.state.isInputActive}\n                focused={this.state.isInputFocused}\n                checked={this.props.checked}\n                showCorrectness={this.props.showCorrectness}\n                reviewMode={this.props.reviewMode}\n                product={this.props.apiOptions.satStyling ? \"sat\" : \"library\"}\n                primaryProductColor={primaryProductColor}\n            />\n        );\n    },\n\n    // NOTE(mdr): This method expects to be auto-bound. If this component is\n    //     converted to an ES6 class, take care to auto-bind this method!\n    _toggleCrossOut: function() {\n        const willBeCrossedOut = !this.props.crossedOut;\n\n        if (willBeCrossedOut) {\n            // If we're crossing out a checked option, let's also uncheck it.\n            this._sendChange({checked: false, crossedOut: true});\n        } else {\n            this._sendChange({crossedOut: false});\n        }\n    },\n\n    // Call `this.props.onChange` with the given values. Any keys that are not\n    // specified will be filled in with the current value. (For example, if\n    // `checked` is specified but `crossedOut` is not, then `crossedOut` will\n    // be filled in with `this.props.crossedOut`.)\n    //\n    // This enables us to use shorthand inside this component, while\n    // maintaining a consistent API for the parent.\n    _sendChange: function(newValues) {\n        const checked = newValues.checked != null\n            ? newValues.checked\n            : this.props.checked;\n\n        const crossedOut = newValues.crossedOut != null\n            ? newValues.crossedOut\n            : this.props.crossedOut;\n\n        this.props.onChange({checked, crossedOut});\n    },\n\n    render: function() {\n        const styles = Choice.styles;\n        const sat = this.props.apiOptions.satStyling;\n        const isMobile = this.props.apiOptions.isMobile;\n\n        const {radioStyleVersion} = this.props.apiOptions.styling;\n        const finalStyles =\n            typeof radioStyleVersion === \"undefined\"\n                ? false\n                : radioStyleVersion === \"final\";\n\n        const className = classNames(\n            this.props.className,\n            \"checkbox-label\",\n            css(\n                styles.label,\n                isMobile && sharedStyles.disableTextSelection,\n                !sat && styles.responsiveLabel,\n                sat && styles.satLabel\n            )\n        );\n\n        // There's two different input components we could use (the builtin\n        // input component, or the ToggleableRadioButton component). These are\n        // the props that we will pass to either.\n        const commonInputProps = {\n            type: this.props.type,\n            name: this.props.groupName,\n            id: `${this.props.groupName}-choice-${this.props.pos}`,\n            checked: this.props.checked,\n            disabled: this.props.disabled,\n            onFocus: this.onInputFocus,\n            onBlur: this.onInputBlur,\n            className: css(\n                // intermediate styles are not different for radio and\n                // checkbox, and have a separate active state.\n                !finalStyles && sharedStyles.perseusInteractive,\n                !finalStyles && styles.input,\n                !finalStyles && sharedStyles.responsiveInput,\n                !finalStyles && !sat && sharedStyles.responsiveRadioInput,\n                !finalStyles &&\n                    !sat &&\n                    this.state.isInputActive &&\n                    sharedStyles.responsiveRadioInputActive,\n                finalStyles && sharedStyles.perseusSrOnly,\n                sat && sharedStyles.perseusSrOnly,\n                sat && this.props.reviewMode && styles.satReviewInput\n            ),\n        };\n\n        let input = null;\n        if (this.props.type === \"radio\") {\n            // This is a special radio button that allows a user to deselect\n            // it by merely clicking/selecting it again.\n            input = (\n                <ToggleableRadioButton\n                    onChecked={willBeChecked => {\n                        this._sendChange({checked: willBeChecked});\n                    }}\n                    inputRef={this.inputRef}\n                    {...commonInputProps}\n                />\n            );\n        } else {\n            input = (\n                <input\n                    onChange={event => {\n                        this._sendChange({checked: event.target.checked});\n                    }}\n                    ref={this.inputRef}\n                    {...commonInputProps}\n                />\n            );\n        }\n\n        const {reviewMode, correct, checked, isLastChoice} = this.props;\n        // HACK: while most of the styling for rendering SAT items is handled\n        // via aphrodite, we also need to assign normal CSS classnames here to\n        // special-case the coloring of MathJax formulas (see .MathJax .math in\n        // stylesheets/task-package/tasks.less)\n        const satCorrectChoice = sat && reviewMode && correct;\n        const satIncorrectChecked = sat && reviewMode && !correct && checked;\n        const descriptionClassName = classNames(\n            \"description\",\n            satCorrectChoice && \"sat-correct\",\n            satIncorrectChecked && \"sat-incorrect\",\n            css(\n                !sat && styles.description,\n                sat &&\n                    this.state.isInputFocused &&\n                    styles.satDescriptionInputFocused,\n                sat &&\n                    this.state.isInputActive &&\n                    styles.satDescriptionInputActive,\n                sat && styles.satDescription,\n                satCorrectChoice && styles.satDescriptionCorrect,\n                satCorrectChoice &&\n                    checked &&\n                    styles.satDescriptionCorrectChecked,\n                satIncorrectChecked && styles.satDescriptionIncorrectChecked,\n                sat && isLastChoice && styles.satDescriptionLastChoice\n            )\n        );\n\n        const checkboxContentClassName = classNames(\n            \"checkbox\",\n            css(\n                sharedStyles.perseusInteractive,\n                !sat && styles.choiceIconWrapper,\n                sat && styles.satCheckboxOptionContent\n            )\n        );\n\n        const checkboxAndOptionClassName = classNames(\n            \"checkbox-and-option\",\n            css(!sat && styles.intermediateResponsiveCheckbox,\n                !sat && reviewMode &&\n                styles.intermediateResponsiveCheckboxReview)\n        );\n\n        const rationaleClassName = classNames(\n            \"perseus-radio-rationale-content\",\n            css(\n                styles.rationale,\n                !sat && styles.nonSatRationale,\n                sat && styles.satReviewRationale\n            )\n        );\n\n        // In edit mode, we must allow selection of the contentEditable\n        // element inside, therefore we cannot use a label, which makes\n        // selection of anything inside automatically select the input\n        // element instead\n        const LabelOrDiv = this.props.editMode ? \"div\" : \"label\";\n\n        const showCrossOut =\n            !this.props.showCorrectness && !sat &&\n            // HACK(mdr): This should go behind a real flag; this is just a\n            //     quick hack so I can ship this code for review (and maybe\n            //     land before the Nov 2017 TSM) before overcommitting to arch.\n            //     https://app.asana.com/0/329800276300868/467694510751339\n            document.location.href.indexOf(\"PERSEUS-HACK-SHOW-CROSS-OUT\") >= 0;\n\n        // We want to show the choices as dimmed out when the choices are\n        // disabled. However, we don't want to do this in the SAT product and\n        // we also don't want to do this when we're in review mode in the\n        // content library.\n        const showDimmed =\n            (!sat && !reviewMode && this.props.apiOptions.readOnly) ||\n            // HACK(mdr): This is a temporary way of showing the crossedOut\n            //     state. Eventually, we'll have custom visuals for this state,\n            //     at which point we'll remove this condition.\n            //     https://app.asana.com/0/329800276300868/467694510751336\n            (showCrossOut && this.props.crossedOut);\n\n        return (\n            <LabelOrDiv\n                htmlFor={!this.props.editMode && commonInputProps.id}\n                className={className}\n                style={{opacity: showDimmed ? 0.5 : 1.0}}\n            >\n                <div\n                    className={descriptionClassName}\n                    onMouseDown={this.onInputMouseDown}\n                    onMouseUp={this.onInputMouseUp}\n                    onMouseOut={this.onInputMouseOut}\n                    onTouchStart={this.onInputMouseDown}\n                    onTouchEnd={this.onInputMouseUp}\n                >\n                    <div className={checkboxAndOptionClassName}>\n                        <span className={checkboxContentClassName}>\n                            {input}\n                            {this.renderChoiceIcon()}\n                        </span>\n                        {/* A pseudo-label. <label> is slightly broken on iOS,\n                        so this works around that. Unfortunately, it is\n                        simplest to just work around that everywhere. */}\n                        <span\n                            className={classNames(\n                                ClassNames.RADIO.OPTION_CONTENT,\n                                ClassNames.INTERACTIVE,\n                                css(\n                                    sat && styles.satRadioOptionContent,\n                                    sat &&\n                                        reviewMode &&\n                                        styles.satReviewRadioOptionContent\n                                )\n                            )}\n                            style={{cursor: \"default\"}}\n                        >\n                            <div className={css(styles.optionStatusContainer)}>\n                                {this.renderOptionStatus()}\n                            </div>\n                            <div>\n                                {this.props.content}\n                            </div>\n                        </span>\n                    </div>\n                    {this.props.showRationale &&\n                        <div className={rationaleClassName}>\n                            {this.props.rationale}\n                        </div>}\n                </div>\n                {showCrossOut && <a\n                    href=\"javascript:void 0\"\n                    onClick={this._toggleCrossOut}\n                    className={css(styles.crossOutLink)}\n                >\n                    {this.props.crossedOut\n                        ? i18n.i18nDoNotTranslate(\"Uncross out\")\n                        : i18n.i18nDoNotTranslate(\"Cross out\")}\n                </a>}\n            </LabelOrDiv>\n        );\n    },\n});\n\n_module_.exports = Choice;\nexport default _module_.exports;\n","import _choiceJsx from \"./choice.jsx\";\nimport _utilJs from \"../../util.js\";\nimport _stylesMediaQueriesJs from \"../../styles/media-queries.js\";\nimport * as styleConstants from \"../../styles/constants.js\";\nimport _stylesSharedJs from \"../../styles/shared.js\";\nimport _rendererJsx from \"../../renderer.jsx\";\nimport _perseusApiJsx from \"../../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst classNames = _classnames;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst _ = _underscore;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst Renderer = _rendererJsx;\nconst sharedStyles = _stylesSharedJs;\nconst mediaQueries = _stylesMediaQueriesJs;\n\nconst captureScratchpadTouchStart = _utilJs\n    .captureScratchpadTouchStart;\n\nconst Choice = _choiceJsx;\n\nconst ChoiceNoneAbove = createReactClass({\n    propTypes: {\n        className: PropTypes.string,\n        content: PropTypes.node,\n        showContent: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            showContent: true,\n        };\n    },\n\n    render: function() {\n        const choiceProps = _.extend({}, this.props, {\n            className: classNames(this.props.className, \"none-of-above\"),\n            content: this.props.showContent\n                ? this.props.content\n                : // We use a Renderer here because that is how\n                  // `this.props.content` is wrapped otherwise.\n                  // We pass in a key here so that we avoid a semi-spurious\n                  // react warning when we render this in the same place\n                  // as the previous choice content renderer.\n                  // Note this destroys state, but since all we're doing\n                  // is outputting \"None of the above\", that is okay.\n                  <Renderer\n                      key=\"noneOfTheAboveRenderer\"\n                      content={i18n._(\"None of the above\")}\n                  />,\n        });\n\n        return <Choice {...choiceProps} />;\n    },\n});\n\nconst ChoicesType = PropTypes.arrayOf(\n    PropTypes.shape({\n        // Indicates whether this choice is checked.\n        checked: PropTypes.bool,\n\n        // Indicates whether the user has \"crossed out\" this choice, meaning\n        // that they don't think it's correct. This value does not affect\n        // scoring or other behavior; it's just a note for the user's\n        // reference.\n        crossedOut: PropTypes.bool,\n\n        content: PropTypes.node,\n        rationale: PropTypes.node,\n        hasRationale: PropTypes.bool,\n        showRationale: PropTypes.bool,\n        showCorrectness: PropTypes.bool,\n        correct: PropTypes.bool,\n        originalIndex: PropTypes.number,\n        isNoneOfTheAbove: PropTypes.bool,\n    })\n);\n\nconst radioBorderColor = styleConstants.radioBorderColor;\n\nconst BaseRadio = createReactClass({\n    propTypes: {\n        apiOptions: PropTypes.shape({\n            readOnly: PropTypes.bool,\n            satStyling: PropTypes.bool,\n            isMobile: PropTypes.bool,\n            styling: PropTypes.shape({\n                radioStyleVersion: PropTypes.oneOf([\n                    \"intermediate\",\n                    \"final\",\n                ]),\n            }),\n        }),\n        choices: ChoicesType,\n        deselectEnabled: PropTypes.bool,\n        editMode: PropTypes.bool,\n        labelWrap: PropTypes.bool,\n        countChoices: PropTypes.bool,\n        numCorrect: PropTypes.number,\n        multipleSelect: PropTypes.bool,\n        reviewModeRubric: PropTypes.shape({\n            choices: ChoicesType,\n        }),\n\n        // A callback indicating that this choice has changed. Its argument is\n        // an object with two keys: `checked` and `crossedOut`. Each contains\n        // an array of boolean values, specifying the new checked and\n        // crossed-out value of each choice.\n        onChange: PropTypes.func,\n    },\n\n    statics: {\n        styles: StyleSheet.create({\n            instructions: {\n                display: \"block\",\n                color: styleConstants.gray17,\n                fontSize: 14,\n                lineHeight: 1.25,\n                fontStyle: \"normal\",\n                fontWeight: \"bold\",\n                marginBottom: 16,\n            },\n\n            instructionsMobile: {\n                fontSize: 18,\n                [mediaQueries.smOrSmaller]: {\n                    fontSize: 16,\n                },\n                // TODO(emily): We want this to match choice text, which turns\n                // to 20px at min-width 1200px, but this media query is\n                // min-width 1280px because our media queries don't exactly\n                // match pure. Make those match up.\n                [mediaQueries.xl]: {\n                    fontSize: 20,\n                },\n            },\n\n            radio: {\n                // Avoid centering\n                width: \"100%\",\n            },\n\n            responsiveRadioContainer: {\n                borderBottom: `1px solid ${radioBorderColor}`,\n                borderTop: `1px solid ${radioBorderColor}`,\n                width: \"auto\",\n                [mediaQueries.smOrSmaller]: {\n                    marginLeft: styleConstants.negativePhoneMargin,\n                    marginRight: styleConstants.negativePhoneMargin,\n                },\n            },\n\n            radioContainerFirstHighlighted: {\n                borderTop: `1px solid rgba(0, 0, 0, 0)`,\n            },\n\n            radioContainerLastHighlighted: {\n                borderBottom: `1px solid rgba(0, 0, 0, 0)`,\n            },\n\n            satRadio: {\n                background: \"none\",\n                marginLeft: 0,\n                userSelect: \"none\",\n            },\n\n            satRadioOption: {\n                margin: 0,\n                padding: 0,\n                borderBottom: `1px solid #ccc`,\n                \":first-child\": {\n                    borderTop: `1px solid #ccc`,\n                },\n            },\n\n            satRadioOptionCorrect: {\n                borderBottomColor: styleConstants.satCorrectBorderColor,\n                \":first-child\": {\n                    borderTopColor: styleConstants.satCorrectBorderColor,\n                },\n            },\n\n            satRadioOptionIncorrect: {\n                borderBottomColor: styleConstants.satIncorrectBorderColor,\n                \":first-child\": {\n                    borderTopColor: styleConstants.satIncorrectBorderColor,\n                },\n            },\n\n            satRadioOptionNextCorrect: {\n                borderBottomColor: styleConstants.satCorrectBorderColor,\n            },\n\n            satRadioOptionNextIncorrect: {\n                borderBottomColor: styleConstants.satIncorrectBorderColor,\n            },\n\n            satReviewRadioOption: {\n                pointerEvents: \"none\",\n            },\n\n            item: {\n                marginLeft: 20,\n            },\n\n            inlineItem: {\n                display: \"inline-block\",\n                paddingLeft: 20,\n                verticalAlign: \"middle\",\n                // See http://stackoverflow.com/q/8120466 for explanation of\n                // why vertical align property is needed\n            },\n\n            responsiveItem: {\n                marginLeft: 0,\n                padding: 0,\n\n                \":not(:last-child)\": {\n                    borderBottom: `1px solid ${radioBorderColor}`,\n                },\n            },\n\n            selectedItem: {\n                background: \"white\",\n            },\n\n            aboveBackdrop: {\n                position: \"relative\",\n                // HACK(emily): We want selected choices to show up above our\n                // exercise backdrop, but below the exercise footer and\n                // \"feedback popover\" that shows up. This z-index is carefully\n                // coordinated between here and webapp. :(\n                zIndex: 1062,\n            },\n\n            aboveBackdropMobile: {\n                boxShadow:\n                    \"0 0 4px 0 rgba(0, 0, 0, 0.2),\" +\n                    \"0 0 2px 0 rgba(0, 0, 0, 0.1)\",\n\n                \":not(:last-child)\": {\n                    borderBottom: `1px solid rgba(0, 0, 0, 0)`,\n                },\n            },\n\n            nextHighlighted: {\n                \":not(:last-child)\": {\n                    borderBottom: `1px solid rgba(0, 0, 0, 0)`,\n                },\n            },\n\n            responsiveContainer: {\n                overflow: \"auto\",\n                marginLeft: styleConstants.negativePhoneMargin,\n                marginRight: styleConstants.negativePhoneMargin,\n                paddingLeft: styleConstants.phoneMargin,\n                // paddingRight is handled by responsiveFieldset\n            },\n\n            responsiveFieldset: {\n                paddingRight: styleConstants.phoneMargin,\n            },\n        }),\n    },\n\n    getDefaultProps: function() {\n        return {\n            editMode: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            // TODO(mdr): This keeps the ID stable across re-renders on the\n            //     same machine, but, at time of writing, the server's state\n            //     isn't rehydrated to the client during SSR, so the server and\n            //     client will generate different IDs and cause a mismatch\n            //     during SSR :(\n            radioGroupName: _.uniqueId(\"perseus_radio_\"),\n        };\n    },\n\n    // When a particular choice's `onChange` handler is called, indicating a\n    // change in a single choice's values, we need to call our `onChange`\n    // handler in order to notify our parent. However, our API with our parent\n    // is that we always provide *all* values for *all* choices, even if just\n    // one choice's values changed. (This is because sometimes an interaction\n    // with one choice can affect many choices, like how checking a new answer\n    // will usually cause the old answer to become unchecked.)\n    //\n    // So, given the new values for a particular choice, compute the new values\n    // for all choices, and pass them to `this.props.onChange`.\n    //\n    // `newValues` is an object with two keys: `checked` and `crossedOut`. Each\n    // contains a boolean value specifying the new checked and crossed-out\n    // value of this choice.\n    updateChoice: function(choiceIndex, newValues) {\n        // Get the baseline `checked` values. If we're checking a new answer\n        // and multiple-select is not on, we should clear all choices to be\n        // unchecked. Otherwise, we should copy the old checked values.\n        let newCheckedList;\n        if (newValues.checked && !this.props.multipleSelect) {\n            newCheckedList = this.props.choices.map(_ => false);\n        } else {\n            newCheckedList = this.props.choices.map(c => c.checked);\n        }\n\n        // Get the baseline `crossedOut` values.\n        const newCrossedOutList = this.props.choices.map(c => c.crossedOut);\n\n        // Update this choice's `checked` and `crossedOut` values.\n        newCheckedList[choiceIndex] = newValues.checked;\n        newCrossedOutList[choiceIndex] = newValues.crossedOut;\n\n        this.props.onChange({\n            checked: newCheckedList,\n            crossedOut: newCrossedOutList,\n        });\n    },\n\n    focus: function(i) {\n        ReactDOM.findDOMNode(this.refs[\"radio\" + (i || 0)]).focus();\n        return true;\n    },\n\n    getInstructionsText: function() {\n        if (this.props.multipleSelect) {\n            if (this.props.countChoices) {\n                return i18n._(\"Choose %(numCorrect)s answers:\", {\n                    numCorrect: this.props.numCorrect,\n                });\n            } else {\n                return i18n._(\"Choose all answers that apply:\");\n            }\n        } else {\n            return i18n._(\"Choose 1 answer:\");\n        }\n    },\n\n    deselectEnabled: function() {\n        // We want to force enable deselect on mobile.\n        return this.props.apiOptions.isMobile || this.props.deselectEnabled;\n    },\n\n    render: function() {\n        const inputType = this.props.multipleSelect ? \"checkbox\" : \"radio\";\n        const rubric = this.props.reviewModeRubric;\n        const reviewMode = !!rubric;\n\n        const styles = BaseRadio.styles;\n        const sat = this.props.apiOptions.satStyling;\n\n        const isMobile = this.props.apiOptions.isMobile;\n\n        const choices = this.props.choices;\n        const firstChoiceHighlighted = choices[0].highlighted;\n        const lastChoiceHighlighted = choices[choices.length - 1].highlighted;\n\n        const className = classNames(\n            \"perseus-widget-radio\",\n            !this.props.editMode && \"perseus-rendered-radio\",\n            css(\n                styles.radio,\n                // SAT doesn't use the \"responsive styling\" as it conflicts\n                // with their custom theming.\n                !sat && styles.responsiveRadioContainer,\n                !sat &&\n                    firstChoiceHighlighted &&\n                    isMobile &&\n                    styles.radioContainerFirstHighlighted,\n                !sat &&\n                    lastChoiceHighlighted &&\n                    isMobile &&\n                    styles.radioContainerLastHighlighted,\n                sat && styles.satRadio\n            )\n        );\n\n        const instructionsClassName = classNames(\n            \"instructions\",\n            css(styles.instructions, isMobile && styles.instructionsMobile)\n        );\n        const instructions = this.getInstructionsText();\n        const shouldShowInstructions = !sat;\n\n        const responsiveClassName = css(styles.responsiveFieldset);\n        const fieldset = (\n            <fieldset\n                className={`perseus-widget-radio-fieldset ${responsiveClassName}`} // eslint-disable-line max-len\n            >\n                <legend className=\"perseus-sr-only\">\n                    {instructions}\n                </legend>\n                {shouldShowInstructions &&\n                    <div className={instructionsClassName}>\n                        {instructions}\n                    </div>}\n                <ul className={className}>\n                    {this.props.choices.map(function(choice, i) {\n                        let Element = Choice;\n                        const elementProps = {\n                            ref: `radio${i}`,\n                            apiOptions: this.props.apiOptions,\n                            checked: choice.checked,\n                            crossedOut: choice.crossedOut,\n                            reviewMode,\n                            correct: choice.correct,\n                            rationale: choice.rationale,\n                            content: choice.content,\n                            disabled:\n                                this.props.apiOptions.readOnly ||\n                                choice.disabled,\n                            editMode: this.props.editMode,\n                            groupName: this.state.radioGroupName,\n                            isLastChoice: i === this.props.choices.length - 1,\n                            showCorrectness:\n                                reviewMode || !!choice.showCorrectness,\n                            showRationale:\n                                choice.hasRationale &&\n                                (reviewMode || choice.showRationale),\n                            type: inputType,\n                            pos: i,\n                            deselectEnabled: this.deselectEnabled(),\n                            onChange: newValues => {\n                                this.updateChoice(i, newValues);\n                            },\n                        };\n\n                        if (choice.isNoneOfTheAbove) {\n                            Element = ChoiceNoneAbove;\n                            _.extend(elementProps, {\n                                showContent: choice.revealNoneOfTheAbove,\n                            });\n                        }\n\n                        const nextChoice = this.props.choices[i + 1];\n                        const nextChoiceHighlighted =\n                            !!nextChoice && nextChoice.highlighted;\n\n                        const aphroditeClassName = checked => {\n                            // Whether or not to show correctness borders\n                            // for this choice and the next choice.\n                            const satShowCorrectness =\n                                sat && reviewMode && checked;\n                            const satShowCorrectnessNext =\n                                sat &&\n                                reviewMode &&\n                                nextChoice &&\n                                nextChoice.checked;\n\n                            return css(\n                                sharedStyles.aboveScratchpad,\n                                styles.item,\n                                !sat && styles.responsiveItem,\n                                !sat && checked && styles.selectedItem,\n                                !sat &&\n                                    checked &&\n                                    choice.highlighted &&\n                                    styles.aboveBackdrop,\n                                !sat &&\n                                    checked &&\n                                    choice.highlighted &&\n                                    this.props.apiOptions.isMobile &&\n                                    styles.aboveBackdropMobile,\n                                !sat &&\n                                    nextChoiceHighlighted &&\n                                    this.props.apiOptions.isMobile &&\n                                    styles.nextHighlighted,\n                                sat && styles.satRadioOption,\n                                satShowCorrectness &&\n                                    !choice.correct &&\n                                    styles.satRadioOptionIncorrect,\n                                satShowCorrectness &&\n                                    choice.correct &&\n                                    styles.satRadioOptionCorrect,\n                                satShowCorrectnessNext &&\n                                    !nextChoice.correct &&\n                                    styles.satRadioOptionNextIncorrect,\n                                satShowCorrectnessNext &&\n                                    nextChoice.correct &&\n                                    styles.satRadioOptionNextCorrect,\n                                sat && rubric && styles.satReviewRadioOption\n                            );\n                        };\n\n                        // HACK(abdulrahman): Preloads the selection-state\n                        // css because of a bug that causes iOS to lag\n                        // when selecting the button for the first time.\n                        aphroditeClassName(true);\n\n                        const className = classNames(\n                            aphroditeClassName(choice.checked),\n                            // TODO(aria): Make test case for these API\n                            // classNames\n                            ApiClassNames.RADIO.OPTION,\n                            choice.checked && ApiClassNames.RADIO.SELECTED,\n                            reviewMode &&\n                                rubric.choices[i].correct &&\n                                ApiClassNames.CORRECT,\n                            reviewMode &&\n                                !rubric.choices[i].correct &&\n                                ApiClassNames.INCORRECT\n                        );\n\n                        // In edit mode, the Choice renders a Div in order to\n                        // allow for the contentEditable area to be selected\n                        // (label forces any clicks inside to select the input\n                        // element) We have to add some extra behavior to make\n                        // sure that we can still check the choice.\n                        let listElem = null;\n                        let clickHandler = null;\n                        if (this.props.editMode) {\n                            clickHandler = e => {\n                                // Traverse the parent nodes of the clicked\n                                // element.\n                                let elem = e.target;\n                                while (elem && elem !== listElem) {\n                                    // If the clicked element is inside of the\n                                    // radio icon, then we want to trigger the\n                                    // check by flipping the choice of the icon.\n                                    if (\n                                        elem.getAttribute(\"data-is-radio-icon\")\n                                    ) {\n                                        this.updateChoice(\n                                            i, {checked: !choice.checked});\n                                        return;\n                                    }\n                                    elem = elem.parentNode;\n                                }\n                            };\n                        }\n\n                        // TODO(mattdr): Index isn't a *good* choice of key\n                        // here; is there a better one? Can we use choice\n                        // content somehow? Would changing our choice of key\n                        // somehow break something happening inside a choice's\n                        // child Renderers, by changing when we mount/unmount?\n                        return (\n                            <li\n                                key={i}\n                                ref={e => listElem = e}\n                                className={className}\n                                onClick={clickHandler}\n                                onTouchStart={\n                                    !this.props.labelWrap\n                                        ? null\n                                        : captureScratchpadTouchStart\n                                }\n                            >\n                                <Element {...elementProps} />\n                            </li>\n                        );\n                    }, this)}\n                </ul>\n            </fieldset>\n        );\n\n        // Allow for horizontal scrolling if content is too wide, which may be\n        // an issue especially on phones.\n        // This is disabled in SAT, since it conflicts with their theming.\n        return (\n            <div className={css(!sat && styles.responsiveContainer)}>\n                {fieldset}\n            </div>\n        );\n    },\n});\n\n_module_.exports = BaseRadio;\nexport default _module_.exports;\n","import _componentsPropCheckBoxJsx from \"../../components/prop-check-box.jsx\";\nimport _componentsInlineIconJsx from \"../../components/inline-icon.jsx\";\nimport { iconPlus, iconTrash } from \"../../icon-paths.js\";\nimport _editorJsx from \"../../editor.jsx\";\nimport _mixinsChangeableJsx from \"../../mixins/changeable.jsx\";\nimport _baseRadioJsx from \"./base-radio.jsx\";\nimport _perseusApiJsx from \"../../perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, indent, no-undef, no-var, object-curly-spacing, react/forbid-prop-types, react/jsx-closing-bracket-location, react/jsx-indent-props, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar BaseRadio = _baseRadioJsx;\nvar Changeable = _mixinsChangeableJsx;\nvar Editor = _editorJsx;\nvar InlineIcon = _componentsInlineIconJsx;\nvar PropCheckBox = _componentsPropCheckBoxJsx;\n\nvar ChoiceEditor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n\n        choice: PropTypes.object,\n        showDelete: PropTypes.bool,\n        onClueChange: PropTypes.func,\n        onContentChange: PropTypes.func,\n        onDelete: PropTypes.func,\n    },\n\n    render: function() {\n        var checkedClass = this.props.choice.correct ? \"correct\" : \"incorrect\";\n        var placeholder = \"Type a choice here...\";\n\n        if (this.props.choice.isNoneOfTheAbove) {\n            placeholder = this.props.choice.correct\n                ? \"Type the answer to reveal to the user...\"\n                : \"None of the above\";\n        }\n\n        var editor = (\n            <Editor\n                ref={\"content-editor\"}\n                apiOptions={this.props.apiOptions}\n                content={this.props.choice.content || \"\"}\n                widgetEnabled={false}\n                placeholder={placeholder}\n                disabled={\n                    this.props.choice.isNoneOfTheAbove &&\n                    !this.props.choice.correct\n                }\n                onChange={this.props.onContentChange}\n            />\n        );\n\n        var clueEditor = (\n            <Editor\n                ref={\"clue-editor\"}\n                apiOptions={this.props.apiOptions}\n                content={this.props.choice.clue || \"\"}\n                widgetEnabled={false}\n                placeholder={i18n._(`Why is this choice ${checkedClass}?`)}\n                onChange={this.props.onClueChange}\n            />\n        );\n\n        var deleteLink = (\n            <a\n                className=\"simple-button orange delete-choice\"\n                href=\"#\"\n                onClick={this.props.onDelete}\n                title=\"Remove this choice\"\n            >\n                <InlineIcon {...iconTrash} />\n            </a>\n        );\n\n        return (\n            <div className=\"choice-clue-editors\">\n                <div className={`choice-editor ${checkedClass}`}>\n                    {editor}\n                </div>\n                <div className=\"clue-editor\">\n                    {clueEditor}\n                </div>\n                {this.props.showDelete && deleteLink}\n            </div>\n        );\n    },\n});\n\nvar RadioEditor = createReactClass({\n    propTypes: {\n        ...Changeable.propTypes,\n        apiOptions: ApiOptions.propTypes,\n        choices: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string,\n                clue: PropTypes.string,\n                correct: PropTypes.bool,\n            })\n        ),\n        displayCount: PropTypes.number,\n        randomize: PropTypes.bool,\n        hasNoneOfTheAbove: PropTypes.bool,\n        multipleSelect: PropTypes.bool,\n        countChoices: PropTypes.bool,\n\n        // TODO(kevinb): DEPRECATED: This is be used to force deselectEnabled\n        // behavior on mobile but not on desktop.  When enabled, the user can\n        // deselect a radio input by tapping on it again.\n        deselectEnabled: PropTypes.bool,\n\n        static: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            choices: [{}, {}],\n            displayCount: null,\n            randomize: false,\n            hasNoneOfTheAbove: false,\n            multipleSelect: false,\n            countChoices: false,\n            deselectEnabled: false,\n        };\n    },\n\n    render: function() {\n        var numCorrect = _.reduce(\n            this.props.choices,\n            function(memo, choice) {\n                return choice.correct ? memo + 1 : memo;\n            },\n            0\n        );\n        return (\n            <div>\n                <div className=\"perseus-widget-row\">\n                    <a\n                        href=\"https://docs.google.com/document/d/1frZf7yrWVWb1n4tVjqlzqVUiv1pn4cZXbxgP62-JDBY/edit#heading=h.8ng1isya19nu\"\n                        target=\"_blank\"\n                    >\n                        Multiple choice style guide\n                    </a>\n                    <br />\n                    <div className=\"perseus-widget-left-col\">\n                        <PropCheckBox\n                            label=\"Multiple selections\"\n                            labelAlignment=\"right\"\n                            multipleSelect={this.props.multipleSelect}\n                            onChange={this.onMultipleSelectChange}\n                        />\n                    </div>\n                    <div className=\"perseus-widget-right-col\">\n                        <PropCheckBox\n                            label=\"Randomize order\"\n                            labelAlignment=\"right\"\n                            randomize={this.props.randomize}\n                            onChange={this.props.onChange}\n                        />\n                    </div>\n                    {this.props.multipleSelect &&\n                        <div className=\"perseus-widget-left-col\">\n                            <PropCheckBox\n                                label=\"Specify number correct\"\n                                labelAlignment=\"right\"\n                                countChoices={this.props.countChoices}\n                                onChange={this.onCountChoicesChange}\n                            />\n                        </div>}\n                </div>\n\n                <BaseRadio\n                    ref=\"baseRadio\"\n                    multipleSelect={this.props.multipleSelect}\n                    countChoices={this.props.countChoices}\n                    numCorrect={numCorrect}\n                    editMode={true}\n                    labelWrap={false}\n                    apiOptions={this.props.apiOptions}\n                    choices={this.props.choices.map(function(choice, i) {\n                        return {\n                            content: (\n                                <ChoiceEditor\n                                    ref={`choice-editor${i}`}\n                                    apiOptions={this.props.apiOptions}\n                                    choice={choice}\n                                    onContentChange={newProps => {\n                                        if (\"content\" in newProps) {\n                                            this.onContentChange(\n                                                i,\n                                                newProps.content\n                                            );\n                                        }\n                                    }}\n                                    onClueChange={newProps => {\n                                        if (\"content\" in newProps) {\n                                            this.onClueChange(\n                                                i,\n                                                newProps.content\n                                            );\n                                        }\n                                    }}\n                                    onDelete={this.onDelete.bind(this, i)}\n                                    showDelete={this.props.choices.length >= 2}\n                                />\n                            ),\n                            isNoneOfTheAbove: choice.isNoneOfTheAbove,\n                            checked: choice.correct,\n                        };\n                    }, this)}\n                    onChange={this.onChange}\n                />\n\n                <div className=\"add-choice-container\">\n                    <a\n                        className=\"simple-button orange\"\n                        href=\"#\"\n                        onClick={this.addChoice.bind(this, false)}\n                    >\n                        <InlineIcon {...iconPlus} /> Add a choice{\" \"}\n                    </a>\n\n                    {!this.props.hasNoneOfTheAbove &&\n                        <a\n                            className=\"simple-button\"\n                            href=\"#\"\n                            onClick={this.addChoice.bind(this, true)}\n                        >\n                            <InlineIcon {...iconPlus} /> None of the above{\" \"}\n                        </a>}\n                </div>\n            </div>\n        );\n    },\n\n    change(...args) {\n        return Changeable.change.apply(this, args);\n    },\n\n    onMultipleSelectChange: function(allowMultiple) {\n        allowMultiple = allowMultiple.multipleSelect;\n\n        var numCorrect = _.reduce(\n            this.props.choices,\n            function(memo, choice) {\n                return choice.correct ? memo + 1 : memo;\n            },\n            0\n        );\n\n        if (!allowMultiple && numCorrect > 1) {\n            var choices = _.map(this.props.choices, function(choice) {\n                return _.defaults(\n                    {\n                        correct: false,\n                    },\n                    choice\n                );\n            });\n            this.props.onChange({\n                multipleSelect: allowMultiple,\n                choices: choices,\n            });\n        } else {\n            this.props.onChange({\n                multipleSelect: allowMultiple,\n            });\n        }\n    },\n\n    onCountChoicesChange: function(count) {\n        count = count.countChoices;\n        this.props.onChange({countChoices: count});\n    },\n\n    onChange: function(\n        {\n            checked\n        }\n    ) {\n        var choices = _.map(this.props.choices, (choice, i) => {\n            return _.extend({}, choice, {\n                correct: checked[i],\n                content:\n                    choice.isNoneOfTheAbove && !checked[i]\n                        ? \"\"\n                        : choice.content,\n            });\n        });\n\n        this.props.onChange({choices: choices});\n    },\n\n    onContentChange: function(choiceIndex, newContent) {\n        var choices = this.props.choices.slice();\n        choices[choiceIndex] = _.extend({}, choices[choiceIndex], {\n            content: newContent,\n        });\n        this.props.onChange({choices: choices});\n    },\n\n    onClueChange: function(choiceIndex, newClue) {\n        var choices = this.props.choices.slice();\n        choices[choiceIndex] = _.extend({}, choices[choiceIndex], {\n            clue: newClue,\n        });\n        if (newClue === \"\") {\n            delete choices[choiceIndex].clue;\n        }\n        this.props.onChange({choices: choices});\n    },\n\n    onDelete: function(choiceIndex, e) {\n        e.preventDefault();\n\n        var choices = this.props.choices.slice();\n        var deleted = choices[choiceIndex];\n\n        choices.splice(choiceIndex, 1);\n\n        this.props.onChange({\n            choices: choices,\n            hasNoneOfTheAbove:\n                this.props.hasNoneOfTheAbove && !deleted.isNoneOfTheAbove,\n        });\n    },\n\n    addChoice: function(noneOfTheAbove, e) {\n        e.preventDefault();\n\n        var choices = this.props.choices.slice();\n        var newChoice = {isNoneOfTheAbove: noneOfTheAbove};\n        var addIndex = choices.length - (this.props.hasNoneOfTheAbove ? 1 : 0);\n\n        choices.splice(addIndex, 0, newChoice);\n\n        this.props.onChange(\n            {\n                choices: choices,\n                hasNoneOfTheAbove:\n                    noneOfTheAbove || this.props.hasNoneOfTheAbove,\n            },\n            () => {\n                this.refs[`choice-editor${addIndex}`].refs[\n                    \"content-editor\"\n                ].focus();\n            }\n        );\n    },\n\n    setDisplayCount: function(num) {\n        this.props.onChange({displayCount: num});\n    },\n\n    focus: function() {\n        this.refs[\"choice-editor0\"].refs[\"content-editor\"].focus();\n        return true;\n    },\n\n    getSaveWarnings: function() {\n        if (!_.some(_.pluck(this.props.choices, \"correct\"))) {\n            return [\"No choice is marked as correct.\"];\n        }\n        return [];\n    },\n\n    serialize: function() {\n        return _.pick(\n            this.props,\n            \"choices\",\n            \"randomize\",\n            \"multipleSelect\",\n            \"countChoices\",\n            \"displayCount\",\n            \"hasNoneOfTheAbove\",\n            \"deselectEnabled\"\n        );\n    },\n});\n\n_module_.exports = RadioEditor;\nexport default _module_.exports;\n","import { linterContextProps, linterContextDefault } from \"../../gorgon/proptypes.js\";\nimport _baseRadioJsx from \"./base-radio.jsx\";\nimport _utilJs from \"../../util.js\";\nimport _passageRefJsx from \"../passage-ref.jsx\";\nimport _rendererJsx from \"../../renderer.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* global i18n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst Renderer = _rendererJsx;\nconst PassageRef = _passageRefJsx;\nconst Util = _utilJs;\n\nconst BaseRadio = _baseRadioJsx;\n\nconst Radio = createReactClass({\n    propTypes: {\n        apiOptions: BaseRadio.propTypes.apiOptions,\n        choices: PropTypes.arrayOf(\n            PropTypes.shape({\n                content: PropTypes.string.isRequired,\n                // Clues are called \"rationales\" in most other places but are\n                // left as \"clue\"s here to preserve legacy widget data.\n                clue: PropTypes.string,\n                correct: PropTypes.bool,\n                isNoneOfTheAbove: PropTypes.bool,\n                originalIndex: PropTypes.number.isRequired,\n            }).isRequired\n        ).isRequired,\n\n        deselectEnabled: PropTypes.bool,\n        displayCount: PropTypes.any,\n        findWidgets: PropTypes.func,\n        multipleSelect: PropTypes.bool,\n        countChoices: PropTypes.bool,\n        numCorrect: PropTypes.number,\n        onChange: PropTypes.func.isRequired,\n\n        questionCompleted: PropTypes.bool,\n        reviewModeRubric: BaseRadio.propTypes.reviewModeRubric,\n        trackInteraction: PropTypes.func.isRequired,\n        // values is the legacy choiceState data format\n        values: PropTypes.arrayOf(PropTypes.bool),\n        choiceStates: PropTypes.arrayOf(\n            PropTypes.shape({\n                // Indicates whether this choice is selected. (Inside\n                // BaseRadio, this is called `checked`.)\n                selected: PropTypes.bool,\n\n                // Indicates whether the user has \"crossed out\" this choice,\n                // meaning that they don't think it's correct. This value does\n                // not affect scoring or other behavior; it's just a note for\n                // the user's reference.\n                crossedOut: PropTypes.bool,\n\n                highlighted: PropTypes.bool,\n                rationaleShown: PropTypes.bool,\n                correctnessShown: PropTypes.bool,\n                readOnly: PropTypes.bool,\n            }).isRequired\n        ),\n        linterContext: linterContextProps,\n        static: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            choices: [{}],\n            displayCount: null,\n            multipleSelect: false,\n            countChoices: false,\n            deselectEnabled: false,\n            linterContext: linterContextDefault,\n        };\n    },\n\n    _renderRenderer: function(content) {\n        content = content || \"\";\n\n        let nextPassageRefId = 1;\n        const widgets = {};\n\n        const modContent = content.replace(\n            /\\{\\{passage-ref (\\d+) (\\d+)(?: \"([^\"]*)\")?\\}\\}/g,\n            (match, passageNum, refNum, summaryText) => {\n                const widgetId = \"passage-ref \" + nextPassageRefId;\n                nextPassageRefId++;\n\n                widgets[widgetId] = {\n                    type: \"passage-ref\",\n                    graded: false,\n                    options: {\n                        passageNumber: parseInt(passageNum),\n                        referenceNumber: parseInt(refNum),\n                        summaryText: summaryText,\n                    },\n                    version: PassageRef.version,\n                };\n\n                return \"[[\" + Util.snowman + \" \" + widgetId + \"]]\";\n            }\n        );\n\n        // alwaysUpdate={true} so that passage-refs findWidgets\n        // get called when the outer passage updates the renderer\n        // TODO(aria): This is really hacky\n        // We pass in a key here so that we avoid a semi-spurious\n        // react warning when the ChoiceNoneAbove renders a\n        // different renderer in the same place. Note this destroys\n        // state, but since all we're doing is outputting\n        // \"None of the above\", that is okay.\n        // TODO(mdr): Widgets inside this Renderer are not discoverable through\n        //     the parent Renderer's `findWidgets` function.\n        return (\n            <Renderer\n                key=\"choiceContentRenderer\"\n                content={modContent}\n                widgets={widgets}\n                findExternalWidgets={this.props.findWidgets}\n                alwaysUpdate={true}\n                linterContext={this.props.linterContext}\n            />\n        );\n    },\n\n    focus: function(i) {\n        return this.refs.baseRadio.focus(i);\n    },\n\n    // When `BaseRadio`'s `onChange` handler is called, indicating a change in\n    // our choices' state, we need to call our `onChange` handler in order to\n    // persist those changes in the item's Perseus state.\n    //\n    // So, given the new values for each choice, construct the new\n    // `choiceStates` objects, and pass them to `this.props.onChange`.\n    //\n    // `newValueLists` is an object with two keys: `checked` and `crossedOut`.\n    // Each contains an array of boolean values, specifying the new checked and\n    // crossed-out value of each choice.\n    //\n    // NOTE(mdr): This method expects to be auto-bound. If this component is\n    //     converted to an ES6 class, take care to auto-bind this method!\n    updateChoices: function(newValueLists) {\n        const {choiceStates, choices} = this.props;\n\n        // Construct the baseline `choiceStates` objects. If this is the user's\n        // first interaction with the widget, we'll need to initialize them to\n        // new objects with all fields set to the default values. Otherwise, we\n        // should clone the old `choiceStates` objects, in preparation to\n        // mutate them.\n        let newChoiceStates;\n        if (choiceStates) {\n            newChoiceStates = choiceStates.map(state => ({\n                ...state\n            }));\n        } else {\n            newChoiceStates = choices.map(() => ({\n                selected: false,\n                crossedOut: false,\n                highlighted: false,\n                rationaleShown: false,\n                correctnessShown: false,\n                readOnly: false\n            }));\n        }\n\n        // Mutate the new `choiceState` objects, according to the new `checked`\n        // and `crossedOut` values provided in `newValueLists`.\n        newChoiceStates.forEach((choiceState, i) => {\n            choiceState.selected = newValueLists.checked[i];\n            choiceState.crossedOut = newValueLists.crossedOut[i];\n        });\n\n        this.props.onChange({choiceStates: newChoiceStates});\n        this.props.trackInteraction();\n    },\n\n    getUserInput: function() {\n        // Return checked inputs in the form {choicesSelected: [bool]}. (Dear\n        // future timeline implementers: this used to be {value: i} before\n        // multiple select was added)\n        if (this.props.choiceStates) {\n            let noneOfTheAboveIndex = null;\n            let noneOfTheAboveSelected = false;\n\n            const choiceStates = this.props.choiceStates;\n            const choicesSelected = choiceStates.map(() => false);\n            const countChoices = this.props.countChoices;\n            const numCorrect = this.props.numCorrect;\n\n            for (let i = 0; i < choicesSelected.length; i++) {\n                const index = this.props.choices[i].originalIndex;\n                choicesSelected[index] = choiceStates[i].selected;\n\n                if (this.props.choices[i].isNoneOfTheAbove) {\n                    noneOfTheAboveIndex = index;\n\n                    if (choicesSelected[i]) {\n                        noneOfTheAboveSelected = true;\n                    }\n                }\n            }\n\n            return {\n                countChoices,\n                choicesSelected,\n                numCorrect,\n                noneOfTheAboveIndex,\n                noneOfTheAboveSelected,\n            };\n            // Support legacy choiceState implementation\n        } else if (this.props.values) {\n            let noneOfTheAboveIndex = null;\n            let noneOfTheAboveSelected = false;\n\n            const values = this.props.values.slice();\n            const countChoices = this.props.countChoices;\n            const numCorrect = this.props.numCorrect;\n\n            for (let i = 0; i < this.props.values.length; i++) {\n                const index = this.props.choices[i].originalIndex;\n                values[index] = this.props.values[i];\n\n                if (this.props.choices[i].isNoneOfTheAbove) {\n                    noneOfTheAboveIndex = index;\n                    if (values[i]) {\n                        noneOfTheAboveSelected = true;\n                    }\n                }\n            }\n            return {\n                choicesSelected: values,\n                noneOfTheAboveIndex,\n                noneOfTheAboveSelected,\n                countChoices,\n                numCorrect,\n            };\n        } else {\n            // Nothing checked\n            return {\n                choicesSelected: _.map(this.props.choices, () => false),\n            };\n        }\n    },\n\n    simpleValidate: function(rubric) {\n        return Radio.validate(this.getUserInput(), rubric);\n    },\n\n    enforceOrdering: function(choices) {\n        const content = _.pluck(choices, \"content\");\n        if (\n            _.isEqual(content, [i18n._(\"False\"), i18n._(\"True\")]) ||\n            _.isEqual(content, [i18n._(\"No\"), i18n._(\"Yes\")])\n        ) {\n            return [choices[1]].concat([choices[0]]);\n        }\n        return choices;\n    },\n\n    /**\n     * Turn on rationale display for the currently selected choices. Note that\n     * this leaves rationales on for choices that are already showing\n     * rationales.\n     */\n    showRationalesForCurrentlySelectedChoices(rubric) {\n        if (this.props.choiceStates) {\n            const score = this.simpleValidate(rubric);\n            const widgetCorrect =\n                score.type === \"points\" && score.total === score.earned;\n\n            const newStates = this.props.choiceStates.map(state => ({\n                ...state,\n                highlighted: state.selected,\n\n                // If the choice is selected, show the rationale now\n                rationaleShown:\n                    state.selected ||\n                    // If the choice already had a rationale, keep it shown\n                    state.rationaleShown ||\n                    // If the widget is correctly answered, show the rationale\n                    // for all the choices\n                    widgetCorrect,\n\n                // We use the same behavior for the readOnly flag as for\n                // rationaleShown, but we keep it separate in case other\n                // behaviors want to disable choices without showing rationales.\n                readOnly: state.selected || state.readOnly || widgetCorrect,\n\n                correctnessShown: state.selected || state.correctnessShown\n            }));\n\n            this.props.onChange(\n                {\n                    choiceStates: newStates,\n                },\n                null, // cb\n                true // silent\n            );\n        }\n    },\n\n    /**\n     * Deselects any currently-selected choices that are not correct choices.\n     */\n    deselectIncorrectSelectedChoices() {\n        if (this.props.choiceStates) {\n            const newStates = this.props.choiceStates.map((state, i) => ({\n                ...state,\n                selected: state.selected && !!this.props.choices[i].correct,\n                highlighted: false\n            }));\n\n            this.props.onChange(\n                {\n                    choiceStates: newStates,\n                },\n                null, // cb\n                false // silent\n            );\n        }\n    },\n\n    render: function() {\n        let choices = this.props.choices;\n        let choiceStates;\n        if (this.props.static) {\n            choiceStates = _.map(choices, val => ({\n                selected: val.correct,\n                crossedOut: val.crossedOut,\n                readOnly: true,\n                highlighted: false,\n                rationaleShown: true,\n                correctnessShown: true\n            }));\n        } else if (this.props.choiceStates) {\n            choiceStates = this.props.choiceStates;\n        } else if (this.props.values) {\n            // Support legacy choiceStates implementation\n            choiceStates = _.map(this.props.values, val => ({\n                selected: val,\n                crossedOut: false,\n                readOnly: false,\n                highlighted: false,\n                rationaleShown: false,\n                correctnessShown: false\n            }));\n        } else {\n            choiceStates = _.map(choices, () => ({\n                selected: false,\n                crossedOut: false,\n                readOnly: false,\n                highlighted: false,\n                rationaleShown: false,\n                correctnessShown: false\n            }));\n        }\n\n        choices = _.map(choices, (choice, i) => {\n            const content =\n                choice.isNoneOfTheAbove && !choice.content\n                    ? // we use i18n._ instead of $_ here because the content\n                      // sent to a renderer needs to be a string, not a react\n                      // node (/renderable/fragment).\n                      i18n._(\"None of the above\")\n                    : choice.content;\n\n            const {\n                selected,\n                crossedOut,\n                rationaleShown,\n                correctnessShown,\n                readOnly,\n                highlighted,\n            } = choiceStates[i];\n\n            const reviewChoice =\n                this.props.reviewModeRubric &&\n                this.props.reviewModeRubric.choices[i];\n\n            return {\n                content: this._renderRenderer(content),\n                checked: selected,\n                // Current versions of the radio widget always pass in the\n                // \"correct\" value through the choices. Old serialized state\n                // for radio widgets doesn't have this though, so we have to\n                // pull the correctness out of the review mode rubric. This\n                // only works because all of the places we use\n                // `restoreSerializedState()` also turn on reviewMode, but is\n                // fine for now.\n                // TODO(emily): Come up with a more comprehensive way to solve\n                // this sort of \"serialized state breaks when internal\n                // structure changes\" problem.\n                correct:\n                    typeof choice.correct === \"undefined\"\n                        ? !!reviewChoice && reviewChoice.correct\n                        : choice.correct,\n                disabled: readOnly,\n                hasRationale: !!choice.clue,\n                rationale: this._renderRenderer(choice.clue),\n                showRationale: rationaleShown,\n                showCorrectness: correctnessShown,\n                isNoneOfTheAbove: choice.isNoneOfTheAbove,\n                revealNoneOfTheAbove: this.props.questionCompleted && selected,\n                crossedOut,\n                highlighted,\n            };\n        });\n        choices = this.enforceOrdering(choices);\n\n        return (\n            <BaseRadio\n                ref=\"baseRadio\"\n                labelWrap={true}\n                multipleSelect={this.props.multipleSelect}\n                countChoices={this.props.countChoices}\n                numCorrect={this.props.numCorrect}\n                choices={choices}\n                onChange={this.updateChoices}\n                reviewModeRubric={this.props.reviewModeRubric}\n                deselectEnabled={this.props.deselectEnabled}\n                apiOptions={this.props.apiOptions}\n            />\n        );\n    },\n});\n\n_.extend(Radio, {\n    validate: function(state, rubric) {\n        const numSelected = _.reduce(\n            state.choicesSelected,\n            (sum, selected) => {\n                return sum + (selected ? 1 : 0);\n            },\n            0\n        );\n\n        if (numSelected === 0) {\n            return {\n                type: \"invalid\",\n                message: null,\n            };\n        } else if (state.countChoices && numSelected !== state.numCorrect) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\"Please choose the correct number of answers.\"),\n            };\n            // If NOTA and some other answer are checked, ...\n        } else if (state.noneOfTheAboveSelected && numSelected > 1) {\n            return {\n                type: \"invalid\",\n                message: i18n._(\n                    \"'None of the above' may not be selected \" +\n                        \"when other answers are selected.\"\n                ),\n            };\n        } else {\n            /* jshint -W018 */\n            const correct = _.all(state.choicesSelected, function(selected, i) {\n                let isCorrect;\n                if (state.noneOfTheAboveIndex === i) {\n                    isCorrect = _.all(rubric.choices, function(choice, j) {\n                        return i === j || !choice.correct;\n                    });\n                } else {\n                    isCorrect = !!rubric.choices[i].correct;\n                }\n                return isCorrect === selected;\n            });\n            /* jshint +W018 */\n\n            return {\n                type: \"points\",\n                earned: correct ? 1 : 0,\n                total: 1,\n                message: null,\n            };\n        }\n    },\n});\n\n_module_.exports = Radio;\nexport default _module_.exports;\n","import _radioWidgetJsx from \"./radio/widget.jsx\";\nimport _utilJs from \"../util.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, object-curly-spacing */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar _ = _underscore;\n\nvar shuffle = _utilJs.shuffle;\n\nvar Radio = _radioWidgetJsx;\n\nvar _choiceTransform = (editorProps, problemNum) => {\n    var _maybeRandomize = function(array) {\n        return editorProps.randomize ? shuffle(array, problemNum) : array;\n    };\n\n    var _addNoneOfAbove = function(choices) {\n        var noneOfTheAbove = null;\n\n        var newChoices = _.reject(choices, function(choice, index) {\n            if (choice.isNoneOfTheAbove) {\n                noneOfTheAbove = choice;\n                return true;\n            }\n        });\n\n        // Place the \"None of the above\" options last\n        if (noneOfTheAbove) {\n            newChoices.push(noneOfTheAbove);\n        }\n\n        return newChoices;\n    };\n\n    // Add meta-information to choices\n    var choices = editorProps.choices.slice();\n    choices = _.map(choices, (choice, i) => {\n        return _.extend(\n            {},\n            choice,\n            {\n                originalIndex: i,\n                correct: Boolean(choice.correct),\n            });\n    });\n\n    // Randomize and add 'None of the above'\n    return _addNoneOfAbove(_maybeRandomize(choices));\n};\n\nvar transform = (editorProps, problemNum) => {\n    const choices = _choiceTransform(editorProps, problemNum);\n\n    const numCorrect = _.reduce(\n        editorProps.choices,\n        function(memo, choice) {\n            return choice.correct ? memo + 1 : memo;\n        },\n        0\n    );\n\n    const {\n        hasNoneOfTheAbove,\n        multipleSelect,\n        countChoices,\n        correctAnswer,\n        deselectEnabled,\n    } = editorProps;\n\n    return {\n        numCorrect,\n        hasNoneOfTheAbove,\n        multipleSelect,\n        countChoices,\n        correctAnswer,\n        deselectEnabled,\n        choices,\n        selectedChoices: _.pluck(choices, \"correct\"),\n    };\n};\n\nvar propUpgrades = {\n    1: v0props => {\n        var choices;\n        var hasNoneOfTheAbove;\n\n        if (!v0props.noneOfTheAbove) {\n            choices = v0props.choices;\n            hasNoneOfTheAbove = false;\n        } else {\n            choices = _.clone(v0props.choices);\n            var noneOfTheAboveIndex = _.random(0, v0props.choices.length - 1);\n            var noneChoice = _.extend(\n                {},\n                v0props.choices[noneOfTheAboveIndex],\n                {\n                    isNoneOfTheAbove: true,\n                }\n            );\n            choices.splice(noneOfTheAboveIndex, 1);\n            choices.push(noneChoice);\n            hasNoneOfTheAbove = true;\n        }\n\n        return _.extend(_.omit(v0props, \"noneOfTheAbove\"), {\n            choices: choices,\n            hasNoneOfTheAbove: hasNoneOfTheAbove,\n        });\n    },\n};\n\n_module_.exports = {\n    name: \"radio\",\n    displayName: \"Multiple choice\",\n    accessible: true,\n    widget: Radio,\n    transform: transform,\n    staticTransform: transform,\n    version: {major: 1, minor: 0},\n    propUpgrades: propUpgrades,\n    isLintable: true,\n};\nexport default _module_.exports;\n","import _widgetsExpressionEditorJsx from \"./widgets/expression-editor.jsx\";\nimport _widgetsExpressionJsx from \"./widgets/expression.jsx\";\nimport _widgetsNumericInputEditorJsx from \"./widgets/numeric-input-editor.jsx\";\nimport _widgetsNumericInputJsx from \"./widgets/numeric-input.jsx\";\nimport _widgetsInputNumberEditorJsx from \"./widgets/input-number-editor.jsx\";\nimport _widgetsInputNumberJsx from \"./widgets/input-number.jsx\";\nimport _widgetsRadioEditorJsx from \"./widgets/radio/editor.jsx\";\nimport _widgetsRadioJsx from \"./widgets/radio.jsx\";\n\n// TODO(aria): env/build var\nconst __EDITOR__ = true;\n\n// As new widgets get added here, please also make sure they get added in\n// webapp perseus/traversal.py so they can be properly translated.\nexport default [\n  [_widgetsRadioJsx, __EDITOR__ && _widgetsRadioEditorJsx],\n  [_widgetsInputNumberJsx, __EDITOR__ && _widgetsInputNumberEditorJsx],\n  [_widgetsNumericInputJsx, __EDITOR__ && _widgetsNumericInputEditorJsx],\n  [_widgetsExpressionJsx, __EDITOR__ && _widgetsExpressionEditorJsx],\n];\n","import _extraWidgetsJs from \"./extra-widgets.js\";\nimport _basicWidgetsJs from \"./basic-widgets.js\";\n\nvar _module_ = {\n  exports: {}\n};\n\nvar exports = _module_.exports;\nconst basicWidgets = _basicWidgetsJs;\nconst extraWidgets = _extraWidgetsJs;\n\n_module_.exports = basicWidgets.concat(extraWidgets);\nexport default _module_.exports;\n","// TODO(aria): fix up code to not depend on these\nimport \"./perseus-globals\"; // side effects\n\n// Global css\nimport 'katex/dist/katex.css';\nimport './lib/mathquill/mathquill.css';\nimport \"./lib/khan-exercises.css\";\nimport \"./lib/perseus.css\";\n\nimport _multiItemsJs from \"./multi-items.js\";\nimport _rendererJsx from \"./renderer.jsx\";\nimport _hintsRendererJsx from \"./hints-renderer.jsx\";\nimport _serverItemRendererJsx from \"./server-item-renderer.jsx\";\nimport _itemRendererJsx from \"./item-renderer.jsx\";\nimport _questionRendererJsx from \"./question-renderer.jsx\";\nimport _articleRendererJsx from \"./article-renderer.jsx\";\nimport _initJs from \"./init.js\";\nimport initialWidgets from \"./all-widgets.js\";\nimport Widgets from \"./widgets.js\";\nimport _versionJson from \"./version.json\";\n\n/**\n * Main entry point\n */\nconst version = _versionJson;\n\n// TODO(aria): This registers all widgets for now, but we could go back to only\n// registering basic widgets\nWidgets.registerMany(initialWidgets);\n\nexport const apiVersion = version.apiVersion;\nexport const itemDataVersion = version.itemDataVersion;\nexport const init = _initJs;\nexport const ArticleRenderer = _articleRendererJsx;\nexport const QuestionRenderer = _questionRendererJsx;\nexport const ItemRenderer = _itemRendererJsx;\nexport const ServerItemRenderer = _serverItemRendererJsx;\nexport const HintsRenderer = _hintsRendererJsx;\nexport const Renderer = _rendererJsx;\nexport const MultiItems = _multiItemsJs;\n\nexport default {\n    apiVersion: version.apiVersion,\n    itemDataVersion: version.itemDataVersion,\n    init: _initJs,\n    ArticleRenderer: _articleRendererJsx,\n    QuestionRenderer: _questionRendererJsx,\n    ItemRenderer: _itemRendererJsx,\n    ServerItemRenderer: _serverItemRendererJsx,\n    HintsRenderer: _hintsRendererJsx,\n    Renderer: _rendererJsx,\n    MultiItems: _multiItemsJs,\n};\n","import _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\n\nconst UNCHANGED = \"unchanged\";\nconst CHANGED = \"changed\";\nconst ADDED = \"added\";\nconst REMOVED = \"removed\";\n\n// For values which do not have further values nested within them (strings,\n// numbers, and booleans)\nconst valueEntry = function(before, after, key) {\n    let status;\n    if (before === after) {\n        status = UNCHANGED;\n    } else if (before === undefined) {\n        status = ADDED;\n    } else if (after === undefined) {\n        status = REMOVED;\n    } else {\n        status = CHANGED;\n    }\n\n    return {\n        after: JSON.stringify(after),\n        before: JSON.stringify(before),\n        children: [],\n        key: key,\n        status: status,\n    };\n};\n\n// For values which require a more granular diff (objects and arrays)\nconst objectEntry = function(before, after, key) {\n    const beforeKeys = _.isObject(before) ? Object.keys(before) : [];\n    const afterKeys = _.isObject(after) ? Object.keys(after) : [];\n    const keys = _.union(beforeKeys, afterKeys);\n\n    const children = _.map(keys, function(key) {\n        return performDiff((before || {})[key], (after || {})[key], key);\n    });\n\n    let status;\n    if (before === undefined) {\n        status = ADDED;\n    } else if (after === undefined) {\n        status = REMOVED;\n    } else {\n        const changed = _.any(children, function(child) {\n            return child.status !== UNCHANGED;\n        });\n        status = changed ? CHANGED : UNCHANGED;\n    }\n\n    return {\n        after: \"\",\n        before: \"\",\n        children: children,\n        key: key,\n        status: status,\n    };\n};\n\nconst performDiff = function(before, after, /* optional */ key) {\n    if (typeof before === \"object\" || typeof after === \"object\") {\n        return objectEntry(before, after, key);\n    } else {\n        return valueEntry(before, after, key);\n    }\n};\n\n_module_.exports = performDiff;\nexport default _module_.exports;\n","import _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport _widgetDiffPerformerJsx from \"./widget-diff-performer.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst classNames = _classnames;\nconst React = _react;\nconst _ = _underscore;\n\nconst performDiff = _widgetDiffPerformerJsx;\nconst SvgImage = _componentsSvgImageJsx;\n\nconst indentationFromDepth = function(depth) {\n    return (depth - 1) * 20;\n};\n\nconst BEFORE = \"before\";\nconst AFTER = \"after\";\n\nconst UNCHANGED = \"unchanged\";\n\nconst DiffSide = createReactClass({\n    propTypes: {\n        className: PropTypes.string.isRequired,\n        depth: PropTypes.number.isRequired,\n        propKey: PropTypes.string.isRequired,\n        showKey: PropTypes.bool.isRequired,\n        side: PropTypes.oneOf([BEFORE, AFTER]).isRequired,\n        value: PropTypes.string,\n    },\n\n    render: function() {\n        const className = classNames(this.props.className, {\n            \"diff-row\": true,\n            before: this.props.side === BEFORE,\n            after: this.props.side === AFTER,\n        });\n        return <div className={className} >\n            <div style={{paddingLeft: indentationFromDepth(this.props.depth)}}>\n                {this.props.showKey && this.props.propKey + \": \"}\n                <span className={\"inner-value dark \" + this.props.className}>\n                    {this.props.value}\n                </span>\n            </div>\n        </div>;\n    },\n});\n\nconst CollapsedRow = createReactClass({\n    propTypes: {\n        depth: PropTypes.number,\n        onClick: PropTypes.func.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            depth: 0,\n        };\n    },\n\n    render: function() {\n        const self = this;\n        return (\n            <div onClick={self.props.onClick} style={{clear: \"both\"}}>\n                {_.map([BEFORE, AFTER], function(side) {\n                    return <div\n                        className={\"diff-row collapsed \" + side}\n                        key={side}\n                    >\n                        <div\n                            style={{paddingLeft:\n                                indentationFromDepth(self.props.depth),\n                            }}\n                        >\n                            <span> [ show unmodified ] </span>\n                        </div>\n                    </div>;\n                })}\n            </div>\n        );\n    },\n});\n\n// Component representing a single property that may be nested.\nconst DiffEntry = createReactClass({\n    propTypes: {\n        depth: PropTypes.number,\n        entry: PropTypes.shape({\n            after: PropTypes.string,\n            before: PropTypes.string,\n            children: PropTypes.array,\n            key: PropTypes.string,\n        }),\n        expanded: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            depth: 0,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            expanded: this.props.expanded,\n        };\n    },\n\n    expand: function() {\n        this.setState({expanded: true});\n    },\n\n    render: function() {\n        const entry = this.props.entry;\n        const propertyDeleted = entry.status === \"removed\";\n        const propertyAdded   = entry.status === \"added\";\n        const propertyChanged = entry.status === \"changed\";\n\n        const hasChildren = entry.children.length > 0;\n\n        const leftClass = classNames({\n            \"removed\": propertyDeleted || (propertyChanged && !hasChildren),\n            \"dark\": propertyDeleted,\n            \"blank-space\": propertyAdded,\n        });\n\n        const rightClass = classNames({\n            \"added\": propertyAdded || (propertyChanged && !hasChildren),\n            \"dark\": propertyAdded,\n            \"blank-space\": propertyDeleted,\n        });\n\n        let shownChildren;\n        if (this.state.expanded) {\n            shownChildren = entry.children;\n        } else {\n            shownChildren = _.select(entry.children, function(child) {\n                return child.status !== UNCHANGED;\n            });\n        }\n\n        let collapsed = shownChildren.length < entry.children.length;\n\n        // don't hide just one entry\n        if (entry.children.length === shownChildren.length + 1) {\n            shownChildren = entry.children;\n            collapsed = false;\n        }\n\n        const self = this;\n        return (\n            <div>\n                {entry.key && <div style={{clear: \"both\"}}>\n                <DiffSide\n                    side={BEFORE}\n                    className={leftClass}\n                    depth={this.props.depth}\n                    propKey={entry.key}\n                    showKey={!propertyAdded}\n                    value={entry.before}\n                />\n                <DiffSide\n                    side={AFTER}\n                    className={rightClass}\n                    depth={this.props.depth}\n                    propKey={entry.key}\n                    showKey={!propertyDeleted}\n                    value={entry.after}\n                />\n                </div>}\n                {_.map(shownChildren, function(child) {\n                    return <DiffEntry\n                        key={child.key}\n                        depth={self.props.depth + 1}\n                        entry={child}\n                        expanded={self.state.expanded}\n                    />;\n                })}\n                {collapsed &&\n                    <CollapsedRow\n                        depth={this.props.depth + 1}\n                        onClick={this.expand}\n                    />}\n            </div>\n        );\n    },\n});\n\n// For image widgets, show the actual image\nconst ImageWidgetDiff = createReactClass({\n    propTypes: {\n        after: PropTypes.shape({\n            options: PropTypes.object,\n        }).isRequired,\n        before: PropTypes.shape({\n            options: PropTypes.object,\n        }).isRequired,\n    },\n\n    render: function() {\n        const {before, after} = this.props;\n        const beforeSrc = (before.options && before.options.backgroundImage) ?\n            before.options.backgroundImage.url : \"\";\n        const afterSrc = (after.options && after.options.backgroundImage) ?\n            after.options.backgroundImage.url : \"\";\n        return <div>\n            <div className=\"diff-row before\">\n                {beforeSrc &&\n                <div\n                    className={classNames({\n                        \"image\": true,\n                        \"image-unchanged\": beforeSrc === afterSrc,\n                        \"image-removed\": beforeSrc !== afterSrc,\n                    })}\n                >\n                    <SvgImage src={beforeSrc} title={beforeSrc} />\n                </div>}\n            </div>\n            <div className=\"diff-row after\">\n                {afterSrc &&\n                <div\n                    className={classNames({\n                        \"image\": true,\n                        \"image-unchanged\": beforeSrc === afterSrc,\n                        \"image-added\": beforeSrc !== afterSrc,\n                    })}\n                >\n                    <SvgImage src={afterSrc} title={afterSrc} />\n                </div>}\n            </div>\n        </div>;\n    },\n});\n\nconst WidgetDiff = createReactClass({\n    propTypes: {\n        after: PropTypes.shape({\n            options: PropTypes.object,\n        }),\n        before: PropTypes.shape({\n            options: PropTypes.object,\n        }),\n        title: PropTypes.string.isRequired,\n        type: PropTypes.string,\n    },\n\n    getDefaultProps: function() {\n        return {\n            after: {},\n            before: {},\n            type: \"\",\n        };\n    },\n\n    render: function() {\n        const {after, before, title, type} = this.props;\n        const diff = performDiff(before, after);\n        return <div>\n            <div className=\"diff-header\">{title}</div>\n            <div className=\"diff-header\">{title}</div>\n            <div className=\"diff-body ui-helper-clearfix\">\n                {type === \"image\" &&\n                    <ImageWidgetDiff before={before} after={after} />}\n                <DiffEntry entry={diff} />\n            </div>\n        </div>;\n    },\n});\n\n_module_.exports = WidgetDiff;\nexport default _module_.exports;\n","/*\nSoftware License Agreement (BSD License)\n\nCopyright (c) 2009-2011, Kevin Decker <kpdecker@gmail.com>\n\nAll rights reserved.\n\nRedistribution and use of this software in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\n* Redistributions of source code must retain the above\n  copyright notice, this list of conditions and the\n  following disclaimer.\n\n* Redistributions in binary form must reproduce the above\n  copyright notice, this list of conditions and the\n  following disclaimer in the documentation and/or other\n  materials provided with the distribution.\n\n* Neither the name of Kevin Decker nor the names of its\n  contributors may be used to endorse or promote products\n  derived from this software without specific prior\n  written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\nIMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\nFITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\nCONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER\nIN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\nOF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n * Text diff implementation.\n *\n * This library supports the following APIS:\n * JsDiff.diffChars: Character by character diff\n * JsDiff.diffWords: Word (as defined by \\b regex) diff which ignores whitespace\n * JsDiff.diffLines: Line based diff\n *\n * JsDiff.diffCss: Diff targeted at CSS content\n *\n * These methods are based on the implementation proposed in\n * \"An O(ND) Difference Algorithm and its Variations\" (Myers, 1986).\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.4.6927\n */\nvar JsDiff = (function() {\n  /*jshint maxparams: 5*/\n  function clonePath(path) {\n    return { newPos: path.newPos, components: path.components.slice(0) };\n  }\n  function removeEmpty(array) {\n    var ret = [];\n    for (var i = 0; i < array.length; i++) {\n      if (array[i]) {\n        ret.push(array[i]);\n      }\n    }\n    return ret;\n  }\n  function escapeHTML(s) {\n    var n = s;\n    n = n.replace(/&/g, '&amp;');\n    n = n.replace(/</g, '&lt;');\n    n = n.replace(/>/g, '&gt;');\n    n = n.replace(/\"/g, '&quot;');\n\n    return n;\n  }\n\n  var Diff = function(ignoreWhitespace) {\n    this.ignoreWhitespace = ignoreWhitespace;\n  };\n  Diff.prototype = {\n      diff: function(oldString, newString) {\n        // Handle the identity case (this is due to unrolling editLength == 0\n        if (newString === oldString) {\n          return [{ value: newString }];\n        }\n        if (!newString) {\n          return [{ value: oldString, removed: true }];\n        }\n        if (!oldString) {\n          return [{ value: newString, added: true }];\n        }\n\n        newString = this.tokenize(newString);\n        oldString = this.tokenize(oldString);\n\n        var newLen = newString.length, oldLen = oldString.length;\n        var maxEditLength = newLen + oldLen;\n        var bestPath = [{ newPos: -1, components: [] }];\n\n        // Seed editLength = 0\n        var oldPos = this.extractCommon(bestPath[0], newString, oldString, 0);\n        if (bestPath[0].newPos+1 >= newLen && oldPos+1 >= oldLen) {\n          return bestPath[0].components;\n        }\n\n        for (var editLength = 1; editLength <= maxEditLength; editLength++) {\n          for (var diagonalPath = -1*editLength; diagonalPath <= editLength; diagonalPath+=2) {\n            var basePath;\n            var addPath = bestPath[diagonalPath-1],\n                removePath = bestPath[diagonalPath+1];\n            oldPos = (removePath ? removePath.newPos : 0) - diagonalPath;\n            if (addPath) {\n              // No one else is going to attempt to use this value, clear it\n              bestPath[diagonalPath-1] = undefined;\n            }\n\n            var canAdd = addPath && addPath.newPos+1 < newLen;\n            var canRemove = removePath && 0 <= oldPos && oldPos < oldLen;\n            if (!canAdd && !canRemove) {\n              bestPath[diagonalPath] = undefined;\n              continue;\n            }\n\n            // Select the diagonal that we want to branch from. We select the prior\n            // path whose position in the new string is the farthest from the origin\n            // and does not pass the bounds of the diff graph\n            if (!canAdd || (canRemove && addPath.newPos < removePath.newPos)) {\n              basePath = clonePath(removePath);\n              this.pushComponent(basePath.components, oldString[oldPos], undefined, true);\n            } else {\n              basePath = clonePath(addPath);\n              basePath.newPos++;\n              this.pushComponent(basePath.components, newString[basePath.newPos], true, undefined);\n            }\n\n            var oldPos = this.extractCommon(basePath, newString, oldString, diagonalPath);\n\n            if (basePath.newPos+1 >= newLen && oldPos+1 >= oldLen) {\n              return basePath.components;\n            } else {\n              bestPath[diagonalPath] = basePath;\n            }\n          }\n        }\n      },\n\n      pushComponent: function(components, value, added, removed) {\n        var last = components[components.length-1];\n        if (last && last.added === added && last.removed === removed) {\n          // We need to clone here as the component clone operation is just\n          // as shallow array clone\n          components[components.length-1] =\n            {value: this.join(last.value, value), added: added, removed: removed };\n        } else {\n          components.push({value: value, added: added, removed: removed });\n        }\n      },\n      extractCommon: function(basePath, newString, oldString, diagonalPath) {\n        var newLen = newString.length,\n            oldLen = oldString.length,\n            newPos = basePath.newPos,\n            oldPos = newPos - diagonalPath;\n        while (newPos+1 < newLen && oldPos+1 < oldLen && this.equals(newString[newPos+1], oldString[oldPos+1])) {\n          newPos++;\n          oldPos++;\n\n          this.pushComponent(basePath.components, newString[newPos], undefined, undefined);\n        }\n        basePath.newPos = newPos;\n        return oldPos;\n      },\n\n      equals: function(left, right) {\n        var reWhitespace = /\\S/;\n        if (this.ignoreWhitespace && !reWhitespace.test(left) && !reWhitespace.test(right)) {\n          return true;\n        } else {\n          return left === right;\n        }\n      },\n      join: function(left, right) {\n        return left + right;\n      },\n      tokenize: function(value) {\n        return value;\n      }\n  };\n\n  var CharDiff = new Diff();\n\n  var WordDiff = new Diff(true);\n  var WordWithSpaceDiff = new Diff();\n  WordDiff.tokenize = WordWithSpaceDiff.tokenize = function(value) {\n    return removeEmpty(value.split(/(\\s+|\\b)/));\n  };\n\n  var CssDiff = new Diff(true);\n  CssDiff.tokenize = function(value) {\n    return removeEmpty(value.split(/([{}:;,]|\\s+)/));\n  };\n\n  var LineDiff = new Diff();\n  LineDiff.tokenize = function(value) {\n    var retLines = [],\n        lines = value.split(/^/m);\n\n    for(var i = 0; i < lines.length; i++) {\n      var line = lines[i],\n          lastLine = lines[i - 1];\n\n      // Merge lines that may contain windows new lines\n      if (line == '\\n' && lastLine && lastLine[lastLine.length - 1] === '\\r') {\n        retLines[retLines.length - 1] += '\\n';\n      } else if (line) {\n        retLines.push(line);\n      }\n    }\n\n    return retLines;\n  };\n\n  return {\n    Diff: Diff,\n\n    diffChars: function(oldStr, newStr) { return CharDiff.diff(oldStr, newStr); },\n    diffWords: function(oldStr, newStr) { return WordDiff.diff(oldStr, newStr); },\n    diffWordsWithSpace: function(oldStr, newStr) { return WordWithSpaceDiff.diff(oldStr, newStr); },\n    diffLines: function(oldStr, newStr) { return LineDiff.diff(oldStr, newStr); },\n\n    diffCss: function(oldStr, newStr) { return CssDiff.diff(oldStr, newStr); },\n\n    createPatch: function(fileName, oldStr, newStr, oldHeader, newHeader) {\n      var ret = [];\n\n      ret.push('Index: ' + fileName);\n      ret.push('===================================================================');\n      ret.push('--- ' + fileName + (typeof oldHeader === 'undefined' ? '' : '\\t' + oldHeader));\n      ret.push('+++ ' + fileName + (typeof newHeader === 'undefined' ? '' : '\\t' + newHeader));\n\n      var diff = LineDiff.diff(oldStr, newStr);\n      if (!diff[diff.length-1].value) {\n        diff.pop();   // Remove trailing newline add\n      }\n      diff.push({value: '', lines: []});   // Append an empty value to make cleanup easier\n\n      function contextLines(lines) {\n        return lines.map(function(entry) { return ' ' + entry; });\n      }\n      function eofNL(curRange, i, current) {\n        var last = diff[diff.length-2],\n            isLast = i === diff.length-2,\n            isLastOfType = i === diff.length-3 && (current.added !== last.added || current.removed !== last.removed);\n\n        // Figure out if this is the last line for the given file and missing NL\n        if (!/\\n$/.test(current.value) && (isLast || isLastOfType)) {\n          curRange.push('\\\\ No newline at end of file');\n        }\n      }\n\n      var oldRangeStart = 0, newRangeStart = 0, curRange = [],\n          oldLine = 1, newLine = 1;\n      for (var i = 0; i < diff.length; i++) {\n        var current = diff[i],\n            lines = current.lines || current.value.replace(/\\n$/, '').split('\\n');\n        current.lines = lines;\n\n        if (current.added || current.removed) {\n          if (!oldRangeStart) {\n            var prev = diff[i-1];\n            oldRangeStart = oldLine;\n            newRangeStart = newLine;\n\n            if (prev) {\n              curRange = contextLines(prev.lines.slice(-4));\n              oldRangeStart -= curRange.length;\n              newRangeStart -= curRange.length;\n            }\n          }\n          curRange.push.apply(curRange, lines.map(function(entry) { return (current.added?'+':'-') + entry; }));\n          eofNL(curRange, i, current);\n\n          if (current.added) {\n            newLine += lines.length;\n          } else {\n            oldLine += lines.length;\n          }\n        } else {\n          if (oldRangeStart) {\n            // Close out any changes that have been output (or join overlapping)\n            if (lines.length <= 8 && i < diff.length-2) {\n              // Overlapping\n              curRange.push.apply(curRange, contextLines(lines));\n            } else {\n              // end the range and output\n              var contextSize = Math.min(lines.length, 4);\n              ret.push(\n                  '@@ -' + oldRangeStart + ',' + (oldLine-oldRangeStart+contextSize)\n                  + ' +' + newRangeStart + ',' + (newLine-newRangeStart+contextSize)\n                  + ' @@');\n              ret.push.apply(ret, curRange);\n              ret.push.apply(ret, contextLines(lines.slice(0, contextSize)));\n              if (lines.length <= 4) {\n                eofNL(ret, i, current);\n              }\n\n              oldRangeStart = 0;  newRangeStart = 0; curRange = [];\n            }\n          }\n          oldLine += lines.length;\n          newLine += lines.length;\n        }\n      }\n\n      return ret.join('\\n') + '\\n';\n    },\n\n    applyPatch: function(oldStr, uniDiff) {\n      var diffstr = uniDiff.split('\\n');\n      var diff = [];\n      var remEOFNL = false,\n          addEOFNL = false;\n\n      for (var i = (diffstr[0][0]==='I'?4:0); i < diffstr.length; i++) {\n        if(diffstr[i][0] === '@') {\n          var meh = diffstr[i].split(/@@ -(\\d+),(\\d+) \\+(\\d+),(\\d+) @@/);\n          diff.unshift({\n            start:meh[3],\n            oldlength:meh[2],\n            oldlines:[],\n            newlength:meh[4],\n            newlines:[]\n          });\n        } else if(diffstr[i][0] === '+') {\n          diff[0].newlines.push(diffstr[i].substr(1));\n        } else if(diffstr[i][0] === '-') {\n          diff[0].oldlines.push(diffstr[i].substr(1));\n        } else if(diffstr[i][0] === ' ') {\n          diff[0].newlines.push(diffstr[i].substr(1));\n          diff[0].oldlines.push(diffstr[i].substr(1));\n        } else if(diffstr[i][0] === '\\\\') {\n          if (diffstr[i-1][0] === '+') {\n            remEOFNL = true;\n          } else if(diffstr[i-1][0] === '-') {\n            addEOFNL = true;\n          }\n        }\n      }\n\n      var str = oldStr.split('\\n');\n      for (var i = diff.length - 1; i >= 0; i--) {\n        var d = diff[i];\n        for (var j = 0; j < d.oldlength; j++) {\n          if(str[d.start-1+j] !== d.oldlines[j]) {\n            return false;\n          }\n        }\n        Array.prototype.splice.apply(str,[d.start-1,+d.oldlength].concat(d.newlines));\n      }\n\n      if (remEOFNL) {\n        while (!str[str.length-1]) {\n          str.pop();\n        }\n      } else if (addEOFNL) {\n        str.push('');\n      }\n      return str.join('\\n');\n    },\n\n    convertChangesToXML: function(changes){\n      var ret = [];\n      for ( var i = 0; i < changes.length; i++) {\n        var change = changes[i];\n        if (change.added) {\n          ret.push('<ins>');\n        } else if (change.removed) {\n          ret.push('<del>');\n        }\n\n        ret.push(escapeHTML(change.value));\n\n        if (change.added) {\n          ret.push('</ins>');\n        } else if (change.removed) {\n          ret.push('</del>');\n        }\n      }\n      return ret.join('');\n    },\n\n    // See: http://code.google.com/p/google-diff-match-patch/wiki/API\n    convertChangesToDMP: function(changes){\n      var ret = [], change;\n      for ( var i = 0; i < changes.length; i++) {\n        change = changes[i];\n        ret.push([(change.added ? 1 : change.removed ? -1 : 0), change.value]);\n      }\n      return ret;\n    }\n  };\n})();\n\nexport default JsDiff;\n","import _underscore from \"underscore\";\nimport _libJsdiff from \"../lib/jsdiff\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst jsdiff = _libJsdiff;\nconst _ = _underscore;\n\nconst statusFor = function(chunk) {\n    if (chunk.added) {\n        return \"added\";\n    } else if (chunk.removed) {\n        return \"removed\";\n    } else {\n        return \"unchanged\";\n    }\n};\n\n// Turn a chunk (which contains an array of values and a status)\n// into an array of values, each with the same status\nconst splitUpChunk = chunk => _.map(chunk.value, value => {\n    return {\n        value: value,\n        status: statusFor(chunk),\n    };\n});\n\n// Apply `fn` to every element in `lst` and then concatenate all the results\n// http://clojuredocs.org/clojure_core/clojure.core/mapcat\nconst mapcat = function(lst, fn) {\n    return _.flatten(_.map(lst, fn), true /* only flatten one level */);\n};\n\n// > ArrayDiff.diff([1,2,3], [2,3,4]);\n// = [{ \"value\": [1],\n//      \"removed\": true },\n//    { \"value\": [2, 3] },\n//    { \"value\": [4],\n//      \"added\": true }]\nconst ArrayDiff = new jsdiff.Diff();\nArrayDiff.tokenize = array => _.map(array, elem => [elem]);\n// The default is `+` for string concatenation, which doesn't work for array\n// concatenation.\nArrayDiff.join = (a, b) => a.concat(b);\n// By default jsDiff uses ===\nArrayDiff.equals = _.isEqual;\n\n// Take the output of jsdiff's function (which concatenates adjacent entries)\n// and make it just one entry per chunk\n// > flattenChunks([{ \"value\": [1],\n//                    \"removed\": true },\n//                  { \"value\": [2, 3] },\n//                  { \"value\": [4],\n//                    \"added\": true }])\n// = [{ \"value\":1, \"status\":\"removed\"},\n//    { \"value\":2, \"status\":\"unchanged\"},\n//    { \"value\":3, \"status\":\"unchanged\"},\n//    { \"value\":4, \"status\":\"added\"}]\nconst flattenChunks = chunks => mapcat(chunks, splitUpChunk);\n\n// Take two arrays and create a diff for them. The result is two arrays of\n// objects, one for the things that should be included in a 'before', and one\n// for 'after'\nconst stringArrayDiff = function(a, b) {\n    const diffResult = ArrayDiff.diff(a, b);\n    const flattened = flattenChunks(diffResult);\n\n    return {\n        before: _.filter(flattened, entry => entry.status !== \"added\"),\n        after: _.filter(flattened, entry => entry.status !== \"removed\"),\n    };\n};\n\n_module_.exports = stringArrayDiff;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst _ = _underscore;\n\n// Split a word-wise diff generated by jsdiff into multiple lines, for the\n// purpose of breaking up the diffs into lines, so that modified lines can be\n// faintly highlighted\n\nconst splitDiff = function(diffEntries) {\n    const lines = [];\n    let currentLine = [];\n    _.each(diffEntries, entry => {\n        const values = entry.value.split(\"\\n\");\n        _.each(values, (value, i) => {\n            const isNewline = i > 0;\n            if (isNewline) {\n                lines.push(currentLine);\n                currentLine = [];\n            }\n            const newEntry = _.extend({}, entry, {value: value});\n            currentLine.push(newEntry);\n        });\n    });\n\n    if (currentLine.length) {\n        lines.push(currentLine);\n    }\n    return lines;\n};\n\n_module_.exports = splitDiff;\nexport default _module_.exports;\n","import _componentsSvgImageJsx from \"../components/svg-image.jsx\";\nimport _stringArrayDiffJsx from \"./string-array-diff.jsx\";\nimport _splitDiffJsx from \"./split-diff.jsx\";\nimport _libJsdiff from \"../lib/jsdiff\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\nimport _classnames from \"classnames\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst classNames = _classnames;\nconst React = _react;\nconst _ = _underscore;\n\nconst diff = _libJsdiff;\nconst splitDiff = _splitDiffJsx;\nconst stringArrayDiff = _stringArrayDiffJsx;\nconst SvgImage = _componentsSvgImageJsx;\n\n\nconst BEFORE = \"before\";\nconst AFTER = \"after\";\n\nconst IMAGE_REGEX = /http.*?\\.png|web\\+graphie[^)]*/g;\n\nconst imagesInString = function(str) {\n    return str.match(IMAGE_REGEX) || [];\n};\n\nconst classFor = function(entry, ifAdded, ifRemoved) {\n    if (entry.added) {\n        return ifAdded;\n    } else if (entry.removed) {\n        return ifRemoved;\n    } else {\n        return \"\";\n    }\n};\n\nconst ImageDiffSide = createReactClass({\n    propTypes: {\n        images: PropTypes.arrayOf(PropTypes.shape({})).isRequired,\n\n    },\n\n    render: function() {\n        return (\n            <div>\n\n\n                {_.map(this.props.images, (entry, index) => {\n                    const className = classNames({\n                        \"image\": true,\n                        \"image-unchanged\": entry.status === \"unchanged\",\n                        \"image-added\": entry.status === \"added\",\n                        \"image-removed\": entry.status === \"removed\",\n                    });\n                    return <div key={index} >\n                        <div className={className}>\n                            <SvgImage src={entry.value} title={entry.value} />\n                        </div>\n                    </div>;\n                })}\n            </div>\n        );\n    },\n});\n\nconst TextDiff = createReactClass({\n    propTypes: {\n        after: PropTypes.string,\n        before: PropTypes.string,\n        title: PropTypes.string.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            after: \"\",\n            before: \"\",\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            collapsed: this.props.before === this.props.after,\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState({\n            collapsed: nextProps.before === nextProps.after,\n        });\n    },\n\n    handleExpand: function() {\n        this.setState({collapsed: false});\n    },\n\n    render: function() {\n        const diffed = diff.diffWords(this.props.before, this.props.after);\n\n        const lines = splitDiff(diffed);\n\n        const beforeImages = imagesInString(this.props.before);\n        const afterImages = imagesInString(this.props.after);\n        const images = stringArrayDiff(beforeImages, afterImages);\n\n        const renderedLines = _.map(lines, line => {\n            const contents = {};\n\n            contents.before = _.map(line, function(entry, i) {\n                return <span\n                    key={i}\n                    className={classFor(entry, \"not-present\", \"removed dark\")}\n                >\n                    {entry.value}\n                </span>;\n            });\n\n            contents.after = _.map(line, function(entry, i) {\n                return <span\n                    key={i}\n                    className={classFor(entry, \"added dark\", \"not-present\")}\n                >\n                    {entry.value}\n                </span>;\n            });\n\n            return contents;\n        });\n\n        const className = classNames({\n            \"diff-row\": true,\n            \"collapsed\": this.state.collapsed,\n        });\n\n        return (\n            <div>\n                <div className=\"diff-header\">{this.props.title}</div>\n                <div className=\"diff-header\">{this.props.title}</div>\n                <div className=\"diff-body ui-helper-clearfix\">\n                    {_.map([BEFORE, AFTER], (side, index) => {\n                        return (\n                            <div className={\"diff-row \" + side} key={index}>\n                                {!this.state.collapsed &&\n                                    _.map(renderedLines, (line, lineNum) => {\n                                        const changed = line[side].length > 1;\n                                        const lineClass = classNames({\n                                            \"diff-line\": true,\n                                            \"added\": side === AFTER && changed,\n                                            \"removed\": side === BEFORE && changed,\n                                        });\n                                        return <div\n                                            className={lineClass}\n                                            key={lineNum}\n                                        >\n                                            {line[side]}\n                                        </div>;\n                                    })}\n                                 {!this.state.collapsed &&\n                                     <ImageDiffSide images={images[side]} />}\n                            </div>\n                        );\n                    })}\n                </div>\n                {_.map([BEFORE, AFTER], (side, index) => {\n                    return <div\n                        className={className + \" \" + side}\n                        key={index}\n                        onClick={this.handleExpand}\n                    >\n                        {this.state.collapsed &&\n                        <span>\n                            <span className=\"expand-button\" >\n                                {\" \"}[ show unmodified ]\n                            </span>\n                        </span>}\n                    </div>;\n                })}\n            </div>\n        );\n    },\n});\n\n_module_.exports = TextDiff;\nexport default _module_.exports;\n","import _widgetsJs from \"../widgets.js\";\nimport _widgetDiffJsx from \"./widget-diff.jsx\";\nimport _textDiffJsx from \"./text-diff.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A side by side diff view for Perseus renderers.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst TextDiff = _textDiffJsx;\nconst WidgetDiff = _widgetDiffJsx;\nconst Widgets = _widgetsJs;\n\nconst rendererProps = PropTypes.shape({\n    content: PropTypes.string,\n    images: PropTypes.object,\n    widgets: PropTypes.object,\n});\n\n// In diffs, only show the widgetInfo props that can change\nconst filterWidgetInfo = function(widgetInfo, showAlignmentOptions) {\n    const {alignment, graded, options, type} = widgetInfo || {};\n\n    const filteredWidgetInfo = {options};\n\n    // Show alignment options iff multiple valid ones exist for this widget\n    if (showAlignmentOptions &&\n            Widgets.getSupportedAlignments(type).length > 1) {\n        filteredWidgetInfo.alignment = alignment;\n    }\n\n    if (type === \"transformer\") {\n        filteredWidgetInfo.graded = graded;\n    }\n\n    if (Widgets.supportsStaticMode(type)) {\n        filteredWidgetInfo.static = widgetInfo.static || undefined;\n    }\n\n    return filteredWidgetInfo;\n};\n\n\nconst RendererDiff = createReactClass({\n    propTypes: {\n        // The \"after\" props of the renderer. Will be displayed on the right.\n        after: rendererProps,\n\n        // The \"before\" props of the renderer. Will be displayed on the left.\n        before: rendererProps,\n\n        // If true, show widget alignment options in the diff.\n        showAlignmentOptions: PropTypes.bool,\n\n        // If true, render a horizontal rule after this diff.\n        showSeparator: PropTypes.bool,\n\n        // The heading to render above the side by side diff.\n        // (In a code review tool this would be the filename.)\n        title: PropTypes.string.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            after: {\n                content: \"\",\n                images: {},\n                widgets: {},\n            },\n            before: {\n                content: \"\",\n                images: {},\n                widgets: {},\n            },\n            showAlignmentOptions: false,\n            showSeparator: false,\n        };\n    },\n\n    render: function() {\n        const {\n            after,\n            before,\n            showAlignmentOptions,\n            showSeparator,\n            title,\n        } = this.props;\n\n        let textDiff;\n        let widgetsDiff;\n\n        if (before.content || after.content) {\n            textDiff = <TextDiff\n                before={before.content}\n                after={after.content}\n                title={title}\n            />;\n        }\n\n        const beforeWidgets = Object.keys(before.widgets).filter(\n            widget => before.content.includes(widget));\n        const afterWidgets = Object.keys(after.widgets).filter(\n            widget => after.content.includes(widget));\n\n        if (beforeWidgets.length || afterWidgets.length) {\n            const widgets = _.union(beforeWidgets, afterWidgets);\n            widgetsDiff = widgets.map(widget => <WidgetDiff\n                before={filterWidgetInfo(\n                    before.widgets[widget], showAlignmentOptions)}\n                after={filterWidgetInfo(\n                    after.widgets[widget], showAlignmentOptions)}\n                title={widget}\n                type={(before.widgets[widget] || {}).type ||\n                      (after.widgets[widget] || {}).type}\n                key={widget}\n            />\n            );\n        }\n\n        return <div>\n            {textDiff}\n            {widgetsDiff}\n            {showSeparator && <div className=\"diff-separator\"/>}\n        </div>;\n    },\n});\n\n_module_.exports = RendererDiff;\nexport default _module_.exports;\n","import _rendererDiffJsx from \"./renderer-diff.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A side by side diff view for Perseus articles.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst RendererDiff = _rendererDiffJsx;\n\nconst rendererProps = PropTypes.shape({\n    content: PropTypes.string,\n    images: PropTypes.object,\n    widgets: PropTypes.object,\n});\n\n\nconst ArticleDiff = createReactClass({\n    propTypes: {\n        // TODO(alex): Check whether we still have any Perseus articles whose\n        // top-level json is an object, not an array. If not, simplify here.\n        after: PropTypes.oneOfType([\n            rendererProps,\n            PropTypes.arrayOf(rendererProps),\n        ]).isRequired,\n        before: PropTypes.oneOfType([\n            rendererProps,\n            PropTypes.arrayOf(rendererProps),\n        ]).isRequired,\n    },\n\n    getInitialState: function() {\n        return this._stateFromProps(this.props);\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        this.setState(this._stateFromProps(nextProps));\n    },\n\n    _stateFromProps: function(props) {\n        const {before, after} = props;\n        return {\n            before: Array.isArray(before) ? before : [before],\n            after: Array.isArray(after) ? after : [after],\n        };\n    },\n\n    render: function() {\n        const {before, after} = this.state;\n\n        const sectionCount = Math.max(before.length, after.length);\n\n        const sections = _.times(sectionCount, n => <RendererDiff\n            before={n < before.length ? before[n] : undefined}\n            after={n < after.length ? after[n] : undefined}\n            title={`Section ${n + 1}`}\n            showAlignmentOptions={true}\n            showSeparator={n < sectionCount - 1}\n            key={n}\n        />\n        );\n\n        return <div className=\"framework-perseus\">{sections}</div>;\n    },\n});\n\n_module_.exports = ArticleDiff;\nexport default _module_.exports;\n","import _diffsArticleDiffJsx from \"./diffs/article-diff.jsx\";\nimport { Component } from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst ArticleDiff = _diffsArticleDiffJsx;\n\nclass ArticleDiffDemo extends Component {\n    state = {swapped: false};\n\n    swap = () => this.setState({swapped: !this.state.swapped});\n\n    render() {\n        const {swapped} = this.state;\n        return (\n            <div>\n                <input type=\"button\" value=\"Swap it!\" onClick={this.swap} />\n                <div className=\"perseus-diff\">\n                    <ArticleDiff\n                        before={swapped ? after : before}\n                        after={swapped ? before : after}\n                    />\n                </div>\n            </div>\n        );\n    }\n}\n\n/* eslint-disable max-len */\nconst before = [\n    {\n        content:\n            \"**What kind of structure is highlighted in green in the diagram shown?**\\n \\n![](https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png)![](https://ka-perseus-graphie.s3.amazonaws.com/a10ab9f9b66982637bd1cf1e3cfe493562144e15.png)\\n\\nHow  many apples? [[ numeric-input 1]]\\n\\n[[ image 1]]\\n\\nWhat's the structure? [[ dropdown 1]]\",\n        images: {\n            \"https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png\": {\n                width: 250,\n                height: 150,\n            },\n            \"https://ka-perseus-graphie.s3.amazonaws.com/a10ab9f9b66982637bd1cf1e3cfe493562144e15.png\": {\n                width: 397,\n                height: 397,\n            },\n        },\n        widgets: {\n            \"numeric-input 1\": {\n                type: \"numeric-input\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    answers: [\n                        {\n                            value: 8,\n                            status: \"correct\",\n                            message: \"\",\n                            simplify: \"required\",\n                            answerForms: [\"integer\"],\n                            strict: true,\n                            maxError: 1,\n                        },\n                    ],\n                    size: \"normal\",\n                    coefficient: false,\n                    labelText: \"\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n            \"image 1\": {\n                type: \"image\",\n                alignment: \"float-right\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    title: \"\",\n                    range: [[0, 10], [0, 10]],\n                    box: [4288, 2848],\n                    backgroundImage: {\n                        url:\n                            \"https://ka-perseus-images.s3.amazonaws.com/f17ea8bfb4944b18ef2a3f61cc5a378a9d0b4900.jpg\",\n                        width: 4288,\n                        height: 2848,\n                    },\n                    labels: [],\n                    alt:\n                        \"Freshly baked chocolate chip cookies on a cooling rack. \",\n                    caption:\n                        \"*You might use stoichiometry skills to double a cookie recipe! Image credit: [Chocolate Chip Cookies](https://commons.wikimedia.org/wiki/File%3AChocolate_Chip_Cookies_-_kimberlykv.jpg) by Kimberley Vardeman on Wikimedia Commons, [CC-BY 2.0](https://creativecommons.org/licenses/by/2.0/deed.en)*\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n            \"dropdown 1\": {\n                type: \"dropdown\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    placeholder: \"\",\n                    choices: [\n                        {\n                            content: \"line segment\",\n                            correct: false,\n                        },\n                        {\n                            content: \"line\",\n                            correct: true,\n                        },\n                        {\n                            content: \"ray\",\n                            correct: false,\n                        },\n                    ],\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n        },\n    },\n];\n\nconst after = [\n    {\n        content:\n            \"**What kind of structure is highlighted in dashed green in the diagram shown?**\\n \\n![](https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png)\\n![](web+graphie://ka-perseus-graphie.s3.amazonaws.com/70b65362dbffa72a371b2829549015149caaba73)\\n\\nHow  many apples? [[ numeric-input 1]]\\n\\n[[ image 1]]\",\n        images: {\n            \"https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png\": {\n                width: 250,\n                height: 150,\n            },\n            \"web+graphie://ka-perseus-graphie.s3.amazonaws.com/70b65362dbffa72a371b2829549015149caaba73\": {\n                width: 300,\n                height: 300,\n            },\n        },\n        widgets: {\n            \"numeric-input 1\": {\n                type: \"numeric-input\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    answers: [\n                        {\n                            value: 8,\n                            status: \"correct\",\n                            message: \"\",\n                            simplify: \"required\",\n                            answerForms: [\"integer\"],\n                            strict: false,\n                            errorBounds: {\n                                minError: 0.1,\n                                maxError: 1,\n                            },\n                        },\n                    ],\n                    size: \"normal\",\n                    coefficient: false,\n                    labelText: \"\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n            \"image 1\": {\n                type: \"image\",\n                alignment: \"float-right\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    title: \"\",\n                    range: [[0, 10], [0, 10]],\n                    box: [4288, 2848],\n                    backgroundImage: {\n                        url:\n                            \"https://ka-perseus-images.s3.amazonaws.com/07d9e88e1dfccf69ec79f2eec619b886d81cd949.jpg\",\n                        width: 1536,\n                        height: 2048,\n                    },\n                    labels: [],\n                    alt: \"Strawberry ice cream in a cone. \",\n                    caption:\n                        \"*You might use stoichiometry skills to double an ice cream recipe! Image credit: [Ice Cream](https://commons.wikimedia.org/wiki/File%3ASoft_Ice_cream.jpg) by Kimberley Vardeman on Wikimedia Commons, [CC-BY 2.0](https://creativecommons.org/licenses/by/2.0/deed.en)*\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n        },\n    },\n    {\n        content: \"A second section\",\n        images: {},\n        widgets: {},\n    },\n];\n/* eslint-enable max-len */\n\n_module_.exports = ArticleDiffDemo;\nexport default _module_.exports;\n","import _widgetDiffJsx from \"./widget-diff.jsx\";\nimport _rendererDiffJsx from \"./renderer-diff.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A side by side diff view for Perseus exercise items.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst RendererDiff = _rendererDiffJsx;\nconst WidgetDiff = _widgetDiffJsx;\n\nconst itemProps = PropTypes.shape({\n    question: PropTypes.shape({}).isRequired,\n    answerArea: PropTypes.shape({}).isRequired,\n    hints: PropTypes.array.isRequired,\n});\n\n\nconst ItemDiff = createReactClass({\n    propTypes: {\n        after: itemProps.isRequired,\n        before: itemProps.isRequired,\n    },\n\n    render: function() {\n        const {before, after} = this.props;\n\n        const hintCount = Math.max(before.hints.length, after.hints.length);\n\n        const question = <RendererDiff\n            before={before.question}\n            after={after.question}\n            title=\"Question\"\n            showAlignmentOptions={false}\n            showSeparator={true}\n        />;\n\n        const extras = <WidgetDiff\n            before={before.answerArea}\n            after={after.answerArea}\n            title=\"Question extras\"\n        />;\n\n        const hints = _.times(hintCount, function(n) {\n            return <RendererDiff\n                before={n < before.hints.length ? before.hints[n] : undefined}\n                after={n < after.hints.length ? after.hints[n] : undefined}\n                title={`Hint ${n + 1}`}\n                showAlignmentOptions={false}\n                showSeparator={n < hintCount - 1}\n                key={n}\n            />;\n        });\n\n        return <div className=\"framework-perseus\">\n            {question}\n            {extras}\n            {hints && <div className=\"diff-separator\"/>}\n            {hints}\n        </div>;\n    },\n});\n\n_module_.exports = ItemDiff;\nexport default _module_.exports;\n","import _diffsItemDiffJsx from \"./diffs/item-diff.jsx\";\nimport { Component } from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst ItemDiff = _diffsItemDiffJsx;\n\nclass ItemDiffDemo extends Component {\n    state = {swapped: false};\n\n    swap = () => this.setState({swapped: !this.state.swapped});\n\n    render() {\n        const {swapped} = this.state;\n        return (\n            <div>\n                <input type=\"button\" value=\"Swap it!\" onClick={this.swap} />\n                <div className=\"perseus-diff\">\n                    <ItemDiff\n                        before={swapped ? after : before}\n                        after={swapped ? before : after}\n                    />\n                </div>\n            </div>\n        );\n    }\n}\n\n/* eslint-disable max-len */\nconst before = {\n    question: {\n        content:\n            \"**What kind of structure is highlighted in green in the diagram shown?**\\n \\n![](https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png)![](https://ka-perseus-graphie.s3.amazonaws.com/a10ab9f9b66982637bd1cf1e3cfe493562144e15.png)\\n\\nHow  many apples? [[ numeric-input 1]]\\nWhat's the structure? [[ dropdown 1]]\",\n        images: {\n            \"https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png\": {\n                width: 250,\n                height: 150,\n            },\n            \"https://ka-perseus-graphie.s3.amazonaws.com/a10ab9f9b66982637bd1cf1e3cfe493562144e15.png\": {\n                width: 397,\n                height: 397,\n            },\n        },\n        widgets: {\n            \"numeric-input 1\": {\n                type: \"numeric-input\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    answers: [\n                        {\n                            value: 8,\n                            status: \"correct\",\n                            message: \"\",\n                            simplify: \"required\",\n                            answerForms: [\"integer\"],\n                            strict: true,\n                            maxError: null,\n                        },\n                    ],\n                    size: \"normal\",\n                    coefficient: false,\n                    labelText: \"\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n            \"dropdown 1\": {\n                type: \"dropdown\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    placeholder: \"\",\n                    choices: [\n                        {\n                            content: \"line segment\",\n                            correct: false,\n                        },\n                        {\n                            content: \"line\",\n                            correct: true,\n                        },\n                        {\n                            content: \"ray\",\n                            correct: false,\n                        },\n                    ],\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n        },\n    },\n    answerArea: {\n        calculator: true,\n    },\n    hints: [\n        {\n            content:\n                \"The highlighted part of the diagram has no starting point and no ending point; it continues forever in both directions, like this: \\n\\n![](https://ka-perseus-graphie.s3.amazonaws.com/2b6f0a4700f9fd840e5049de8c1f88206134fde1.png)\",\n            widgets: {},\n        },\n        {\n            content:\n                \"A straight, one-dimensional structure continuing forever in both directions is called a *line*.\",\n            widgets: {},\n        },\n        {\n            content: \"The structure highlighted in green is a line.\",\n            widgets: {},\n        },\n    ],\n};\n\nconst after = {\n    question: {\n        content:\n            \"**What kind of structure is highlighted in dashed green in the diagram shown?**\\n \\n![](https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png)\\n![](web+graphie://ka-perseus-graphie.s3.amazonaws.com/70b65362dbffa72a371b2829549015149caaba73)\\n\\nHow  many apples? [[ numeric-input 1]]\\nWhat's the structure? [[ dropdown 1]]\",\n        images: {\n            \"https://ka-perseus-graphie.s3.amazonaws.com/07dace481175322baa244b35d112968977d19da3.png\": {\n                width: 250,\n                height: 150,\n            },\n            \"web+graphie://ka-perseus-graphie.s3.amazonaws.com/70b65362dbffa72a371b2829549015149caaba73\": {\n                width: 300,\n                height: 300,\n            },\n        },\n        widgets: {\n            \"numeric-input 1\": {\n                type: \"numeric-input\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    answers: [\n                        {\n                            value: 8,\n                            status: \"correct\",\n                            message: \"\",\n                            simplify: \"required\",\n                            answerForms: [\"integer\"],\n                            strict: false,\n                            maxError: null,\n                        },\n                    ],\n                    size: \"normal\",\n                    coefficient: false,\n                    labelText: \"\",\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n            \"dropdown 1\": {\n                type: \"dropdown\",\n                alignment: \"default\",\n                static: false,\n                graded: true,\n                options: {\n                    static: false,\n                    placeholder: \"\",\n                    choices: [\n                        {\n                            content: \"line segment\",\n                            correct: true,\n                        },\n                        {\n                            content: \"line\",\n                            correct: false,\n                        },\n                        {\n                            content: \"ray\",\n                            correct: false,\n                        },\n                    ],\n                },\n                version: {\n                    major: 0,\n                    minor: 0,\n                },\n            },\n        },\n    },\n    answerArea: {\n        calculator: false,\n    },\n    hints: [\n        {\n            content:\n                \"The highlighted part _of the diagram_ has *no* starting point and *no* ending point; it continues forever in both directions, like this: \\n\\n![](https://ka-perseus-graphie.s3.amazonaws.com/2b6f0a4700f9fd840e5049de8c1f88206134fde1.png)\",\n            widgets: {},\n        },\n        {\n            content:\n                \"A straight, one-dimensional structure continuing forever in both directions is called a *line*.\",\n            widgets: {},\n        },\n        {\n            content: \"The structure highlighted in green is a line.\",\n            widgets: {},\n        },\n    ],\n};\n/* eslint-enable max-len */\n\n_module_.exports = ItemDiffDemo;\nexport default _module_.exports;\n","import { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n  * Provides a simple styled button\n  *\n  */\n\nconst React = _react;\n\nconst SimpleButton = createReactClass({\n    propTypes: {\n        children: PropTypes.node,\n        color: PropTypes.oneOf([\"orange\", \"green\"]),\n        onClick: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            children: null,\n            color: \"green\",\n            onClick: () => {},\n        };\n    },\n\n    render: function() {\n        const {children, color, onClick, ...otherProps} = this.props;\n        return (\n            <div\n                className={css(styles.baseButton, styles[color])}\n                onClick={onClick}\n                {...otherProps}\n            >\n                {children}\n            </div>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    baseButton: {\n        top: \"0\",\n        fontSize: \"11px\",\n        padding: \"3px 10px\",\n        backgroundRepeat: \"repeat-x\",\n        borderColor: `\n            rgba(0, 0, 0, 0.1)\n            rgba(0, 0, 0, 0.1)\n            rgba(0, 0, 0, 0.25)\n        `,\n        color: \"#ffffff\",\n        borderRadius: \"3px\",\n        lineHeight: \"15px\",\n        cursor: \"pointer\",\n        transition: \"box-shadow ease-in-out 0.15s\",\n        appearance: \"none\",\n        textDecoration: \"none\",\n        textAlign: \"center\",\n        \":hover\": {\n            boxShadow: `0 1px 1px rgba(0, 0, 0, 0.35),\n                inset 0 0 50px 5px rgba(255, 255, 255, 0.2)`,\n        },\n    },\n    green: {\n        border: \"1px solid #7fab07\",\n        backgroundColor: \"#80ac07\",\n        backgroundImage: \"linear-gradient(to bottom, #8aba08, #719807)\",\n        \":hover\": {\n            borderBottomColor: \"#547105\",\n            backgroundColor: \"#719807\",\n        },\n    },\n    orange: {\n        border: \"1px solid #d45704\",\n        backgroundColor: \"#d55704\",\n        backgroundImage: \"linear-gradient(to bottom, #e35d04, #c04f03)\",\n        \":hover\": {\n            borderBottomColor: \"#983e03\",\n            bakgroundColor: \"#c04f03\",\n        },\n    },\n});\n\n_module_.exports = SimpleButton;\nexport default _module_.exports;\n","import _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/jsx-closing-bracket-location, react/prop-types, react/sort-comp, space-infix-ops */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nconst _ = _underscore;\n\nvar JsonEditor = createReactClass({\n    getInitialState: function() {\n        return {\n            currentValue: JSON.stringify(this.props.value, null, 4),\n            valid: true,\n        };\n    },\n\n    componentWillReceiveProps: function(nextProps) {\n        var shouldReplaceContent =\n            !this.state.valid ||\n            !_.isEqual(nextProps.value, JSON.parse(this.state.currentValue));\n\n        if (shouldReplaceContent) {\n            this.setState(this.getInitialState());\n        }\n    },\n\n    render: function() {\n        var classes =\n            \"perseus-json-editor \" + (this.state.valid ? \"valid\" : \"invalid\");\n\n        return (\n            <textarea\n                className={classes}\n                value={this.state.currentValue}\n                onChange={this.handleChange}\n                onKeyDown={this.handleKeyDown}\n                onBlur={this.handleBlur}\n            />\n        );\n    },\n\n    handleKeyDown: function(e) {\n        // This handler allows the tab character to be entered by pressing\n        // tab, instead of jumping to the next (non-existant) field\n        if (e.key === \"Tab\") {\n            var cursorPos = e.target.selectionStart;\n            var v = e.target.value;\n            var textBefore = v.substring(0, cursorPos);\n            var textAfter = v.substring(cursorPos, v.length);\n            e.target.value = textBefore + \"    \" + textAfter;\n            e.target.selectionStart = textBefore.length + 4;\n            e.target.selectionEnd = textBefore.length + 4;\n\n            e.preventDefault();\n            this.handleChange(e);\n        }\n    },\n\n    handleChange: function(e) {\n        var nextString = e.target.value;\n        try {\n            var json = JSON.parse(nextString);\n            // Some extra handling to allow copy-pasting from /api/vi\n            if (_.isString(json)) {\n                json = JSON.parse(json);\n            }\n            // This callback unfortunately causes multiple renders,\n            // but seems to be necessary to avoid componentWillReceiveProps\n            // being called before setState has gone through\n            this.setState(\n                {\n                    currentValue: nextString,\n                    valid: true,\n                },\n                function() {\n                    this.props.onChange(json);\n                }\n            );\n        } catch (ex) {\n            this.setState({\n                currentValue: nextString,\n                valid: false,\n            });\n        }\n    },\n\n    // You can type whatever you want as you're typing, but if it's not valid\n    // when you blur, it will revert to the last valid value.\n    handleBlur: function(e) {\n        var nextString = e.target.value;\n        try {\n            var json = JSON.parse(nextString);\n            // Some extra handling to allow copy-pasting from /api/vi\n            if (_.isString(json)) {\n                json = JSON.parse(json);\n            }\n            // This callback unfortunately causes multiple renders,\n            // but seems to be necessary to avoid componentWillReceiveProps\n            // being called before setState has gone through\n            this.setState(\n                {\n                    currentValue: JSON.stringify(json, null, 4),\n                    valid: true,\n                },\n                function() {\n                    this.props.onChange(json);\n                }\n            );\n        } catch (ex) {\n            this.setState({\n                currentValue: JSON.stringify(this.props.value, null, 4),\n                valid: true,\n            });\n        }\n    },\n});\n\n_module_.exports = JsonEditor;\nexport default _module_.exports;\n","import _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Displays the given content in an iframe, isolating it from the parent page\n *\n * To simulate the environment of content rendered by itself, content previews\n * are rendered inside iframes, where components such as the math keypad work\n * because the body of the document is not the body of the editor. To make this\n * work, this component renders an iframe and can communicate objects to it\n * through postMessage. The recipient then needs to listen for these messages\n * and pull out the appropriate object stored in the parent's iframeDataStore\n * to get the data to render. When the iframe is loaded, it's javascript calls\n * its requestIframeData function in the parent, which triggers the parent to\n * send the current data.\n */\n\nconst React = _react;\n\nlet nextIframeID = 0;\nconst requestIframeData = {};\nconst updateIframeHeight = {};\nwindow.iframeDataStore = {};\n\n// This is called once after Perseus is loaded and the iframe\n// is ready to render content, then twice a second afterwards\n// to capture the result of animations.\nwindow.addEventListener(\"message\", event => {\n    if (typeof event.data === \"string\") {\n        // In Perseus, we expect the callback to exist, as it is added by\n        // `IframeContentRenderer.componentDidMount()`. Unfortunately, this\n        // event listener also gets added in Manticore (since we include Perseus\n        // from there), and Crowdin fires its own \"message\" events. So we'll\n        // just have to ignore the event when we can't find the callback.\n        const callback = requestIframeData[event.data];\n        if (callback) {\n            callback();\n        }\n    } else if (event.data.id) {\n        if (event.data.height !== undefined) {\n            updateIframeHeight[event.data.id](event.data.height);\n        } else if (event.data.lintWarnings) {\n            // This is a lint report being sent back from the linter.\n            // TODO:\n            // We'll want to display the number of warnings in the HUD.\n            // But for now, we just log it to the console\n            // eslint-disable-next-line no-console\n            console.log(\"LINTER REPORT\", event.data.lintWarnings);\n        }\n    }\n});\n\nconst IframeContentRenderer = createReactClass({\n    propTypes: {\n        // The HTML content to render to the iframe\n        content: PropTypes.string.isRequired,\n\n        // The data-* suffix for passing information to the iframe's JS\n        datasetKey: PropTypes.any,\n\n        // The value of the data-* attribute\n        datasetValue: PropTypes.any,\n\n        // Whether to make the iframe's height match its content's height,\n        // used to prevent scrolling inside the iframe.\n        seamless: PropTypes.bool,\n    },\n\n    componentDidMount: function() {\n        this.iframeID = nextIframeID;\n        nextIframeID++;\n\n        this._prepareFrame();\n        requestIframeData[this.iframeID] = () => {\n            this.sendNewData(this._lastData);\n        };\n\n        updateIframeHeight[this.iframeID] = height => {\n            this._lastHeight = height;\n            if (this.isMounted() && this.props.seamless) {\n                this.refs.container.style.height = height + \"px\";\n            }\n        };\n    },\n\n    shouldComponentUpdate: function(nextProps) {\n        return (\n            nextProps.content !== this.props.content ||\n            nextProps.datasetValue !== this.props.datasetValue ||\n            nextProps.seamless !== this.props.seamless\n        );\n    },\n\n    componentDidUpdate: function(prevProps) {\n        if (!this.props.seamless) {\n            this.refs.container.style.height = \"100%\";\n        } else {\n            this.refs.container.style.height = this._lastHeight + \"px\";\n        }\n\n        if (\n            prevProps.content !== this.props.content ||\n            prevProps.datasetValue !== this.props.datasetValue\n        ) {\n            // Not just a change in seamless\n            this._prepareFrame();\n        }\n    },\n\n    componentWillUnmount: function() {\n        requestIframeData[this.iframeID] = null;\n        updateIframeHeight[this.iframeID] = null;\n    },\n\n    _prepareFrame: function() {\n        // Don't initialize the iframe until the page has loaded\n        if (this._frame) {\n            this.refs.container.removeChild(this._frame);\n        }\n\n        this._frame = document.createElement(\"iframe\");\n        this._frame.style.width = \"100%\";\n        this._frame.style.height = \"100%\";\n\n        if (this.props.datasetKey) {\n            // If the user has specified a data-* attribute to place on the\n            // iframe, we set it here. Right now, this is used to\n            // communicate if the iframe should be enabling touch emulation.\n            this._frame.dataset[\n                this.props.datasetKey\n            ] = this.props.datasetValue;\n        }\n        this._frame.dataset.id = this.iframeID;\n\n        if (this.props.seamless) {\n            // The seamless prop is the same as the \"nochrome\" prop that\n            // gets passed to DeviceFramer. If it is set, then we're going\n            // to be displaying editor previews and want to leave some room\n            // for lint indicators in the right margin. We use the dataset\n            // as above to pass this information on to the perseus-frame\n            // component inside the iframe\n            this._frame.dataset.lintGutter = true;\n        }\n\n        // To make sure the value of location.href inside the iframe is the\n        // same as the location of the parent, we wait for the iframe to\n        // load before writing contents. Without the wait, the location\n        // inside the iframe becomes \"about:blank\", which causes problems\n        // with loading $LAB.\n        this._frame.onload = () => {\n            this._frame.onload = null;\n\n            // To prevent an issue with the contents of the iframe not being\n            // loaded properly, where the javascript inside the iframe is\n            // not executed, we push the content window write to the end\n            // of the event queue.\n            setTimeout(() => {\n                this._frame.contentWindow.document.open();\n                this._frame.contentWindow.document.write(this.props.content);\n                this._frame.contentWindow.document.close();\n            });\n        };\n\n        this.refs.container.appendChild(this._frame);\n    },\n\n    sendNewData: function(data) {\n        if (this.isMounted() && data) {\n            this._lastData = data;\n\n            // We can't use JSON.stringify/parse for this because the apiOptions\n            // includes the functions GroupMetadataEditor, groupAnnotator,\n            // onFocusChange, and onInputError.\n            window.iframeDataStore[this.iframeID] = data;\n            this._frame.contentWindow.postMessage(this.iframeID, \"*\");\n        }\n    },\n\n    render: function() {\n        return <div ref=\"container\" style={{width: \"100%\", height: \"100%\"}} />;\n    },\n});\n\n_module_.exports = IframeContentRenderer;\nexport default _module_.exports;\n","export const devices = {\n    PHONE: \"phone\",\n    TABLET: \"tablet\",\n    DESKTOP: \"desktop\",\n};\n\n// How many pixels do we reserve on the right-hand side of a preview\n// for displaying lint indicators? This space needs to be reserved\n// in DeviceFramer, but it is actually allocated in PerseusFrame\nexport const lintGutterWidth = 36;\n\n// How wide a border does PerseusFrame draw? We need to allocate enough\n// space for it in DeviceFramer.\nexport const perseusFrameBorderWidth = 1;\n\nexport default {\n    devices: devices,\n    lintGutterWidth,\n    perseusFrameBorderWidth,\n};\n","import _constantsJs from \"./constants.js\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A component that displays its contents inside a device frame.\n */\n\nconst React = _react;\n\nconst constants = _constantsJs;\n\nconst SCREEN_SIZES = {\n    phone: {\n        width: 320,\n        height: 480,\n        framedWidth: 320,\n    },\n    tablet: {\n        width: 750,\n        height: 920,\n        framedWidth: 525,\n    },\n    desktop: {\n        width: 688,\n        height: 600,\n        framedWidth: 688,\n    },\n};\n\nconst DeviceFramer = createReactClass({\n    propTypes: {\n        children: PropTypes.element.isRequired,\n        deviceType: PropTypes.oneOf([\n            constants.devices.PHONE,\n            constants.devices.TABLET,\n            constants.devices.DESKTOP,\n        ]).isRequired,\n        // TODO(kevinb) rename to variableHeight\n        nochrome: PropTypes.bool,\n    },\n\n    render: function() {\n        const deviceType = this.props.deviceType;\n\n        if (this.props.nochrome) {\n            // Render content inside a variable height iframe.  Used on the\n            // \"edit\" table of the content editor. In this mode, PerseusFrame\n            // will draw the border and reserve space on the right for\n            // lint indicators.\n            return (\n                <div>\n                    <div\n                        key=\"screen\"\n                        style={{\n                            width:\n                                SCREEN_SIZES[deviceType].framedWidth +\n                                2 * constants.perseusFrameBorderWidth +\n                                constants.lintGutterWidth,\n                        }}\n                    >\n                        <div>\n                            {this.props.children}\n                        </div>\n                    </div>\n                </div>\n            );\n        } else {\n            const scale =\n                SCREEN_SIZES[deviceType].framedWidth /\n                SCREEN_SIZES[deviceType].width;\n\n            // In this mode we draw our own border and don't reserve\n            // space for a lint gutter.\n            const screenStyle = {\n                backgroundColor: \"white\",\n                color: \"black\",\n                textAlign: \"left\",\n                width: SCREEN_SIZES[deviceType].width,\n                height: SCREEN_SIZES[deviceType].height,\n                border: \"solid 1px #CCC\",\n                margin: 8,\n                zoom: scale,\n            };\n\n            return (\n                <div key=\"screen\" className=\"screen\" style={screenStyle}>\n                    {this.props.children}\n                </div>\n            );\n        }\n    },\n});\n\n_module_.exports = DeviceFramer;\nexport default _module_.exports;\n","import _iframeContentRendererJsx from \"./iframe-content-renderer.jsx\";\nimport _componentsInlineIconJsx from \"./components/inline-icon.jsx\";\nimport { iconCircleArrowDown, iconCircleArrowUp, iconPlus, iconTrash } from \"./icon-paths.js\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _componentsDeviceFramerJsx from \"./components/device-framer.jsx\";\nimport _componentsInfoTipJsx from \"./components/info-tip.jsx\";\nimport Editor from \"./editor.jsx\";\nimport Renderer from \"./renderer.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\n/* eslint-disable no-var, object-curly-spacing, react/jsx-closing-bracket-location, react/jsx-indent-props, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/* Collection of classes for rendering the hint editor area,\n * hint editor boxes, and hint previews\n */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar InfoTip = _componentsInfoTipJsx;\nvar DeviceFramer = _componentsDeviceFramerJsx;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst InlineIcon = _componentsInlineIconJsx;\nconst IframeContentRenderer = _iframeContentRendererJsx;\n\n/* Renders a hint editor box\n *\n * This includes:\n *  ~ A \"Hint\" title\n *  ~ the textarea for the hint\n *  ~ the \"remove this hint\" box\n *  ~ the move hint up/down arrows\n */\nexport const HintEditor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        className: PropTypes.string,\n        imageUploader: PropTypes.func,\n        showMoveButtons: PropTypes.bool,\n        showRemoveButton: PropTypes.bool,\n        showTitle: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            content: \"\",\n            replace: false,\n            showMoveButtons: true,\n            showTitle: true,\n            showRemoveButton: true,\n        };\n    },\n\n    handleChange: function(e) {\n        this.props.onChange({replace: e.target.checked});\n    },\n\n    render: function() {\n        return (\n            <div className={\"perseus-hint-editor \" + this.props.className}>\n                {this.props.showTitle && <div className=\"pod-title\">Hint</div>}\n                <Editor\n                    ref=\"editor\"\n                    apiOptions={this.props.apiOptions}\n                    widgets={this.props.widgets}\n                    content={this.props.content}\n                    images={this.props.images}\n                    replace={this.props.replace}\n                    placeholder=\"Type your hint here...\"\n                    imageUploader={this.props.imageUploader}\n                    onChange={this.props.onChange}\n                />\n                <div className=\"hint-controls-container clearfix\">\n                    {this.props.showMoveButtons &&\n                        <span className=\"reorder-hints\">\n                            <button\n                                type=\"button\"\n                                className={this.props.isLast ? \"hidden\" : \"\"}\n                                onClick={_.partial(this.props.onMove, 1)}\n                            >\n                                <InlineIcon {...iconCircleArrowDown} />\n                            </button>{\" \"}\n                            <button\n                                type=\"button\"\n                                className={this.props.isFirst ? \"hidden\" : \"\"}\n                                onClick={_.partial(this.props.onMove, -1)}\n                            >\n                                <InlineIcon {...iconCircleArrowUp} />\n                            </button>{\" \"}\n                            {this.props.isLast &&\n                                <InfoTip>\n                                    <p>\n                                        The last hint is automatically bolded.\n                                    </p>\n                                </InfoTip>}\n                        </span>}\n                    <input\n                        type=\"checkbox\"\n                        checked={this.props.replace}\n                        onChange={this.handleChange}\n                    />\n                    Replace previous hint\n                    {this.props.showRemoveButton &&\n                        <button\n                            type=\"button\"\n                            className=\"remove-hint simple-button orange\"\n                            onClick={this.props.onRemove}\n                        >\n                            <InlineIcon {...iconTrash} />\n                            Remove this hint{\" \"}\n                        </button>}\n                </div>\n            </div>\n        );\n    },\n\n    focus: function() {\n        this.refs.editor.focus();\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function(options) {\n        return this.refs.editor.serialize(options);\n    },\n});\n\n/* A single hint-row containing a hint editor and preview */\nexport const CombinedHintEditor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        deviceType: PropTypes.string.isRequired,\n        frameSource: PropTypes.string.isRequired,\n        imageUploader: PropTypes.func,\n        highlightLint: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            highlightLint: false,\n        };\n    },\n\n    updatePreview: function() {\n        // TODO(aria): decide what to do with this\n        //const shouldBold =\n        //    this.props.isLast && !/\\*\\*/.test(this.props.hint.content);\n        //this.refs.frame.sendNewData({\n        //    type: \"hint\",\n        //    data: {\n        //        hint: this.props.hint,\n        //        bold: shouldBold,\n        //        pos: this.props.pos,\n        //        apiOptions: this.props.apiOptions,\n        //        linterContext: {\n        //            contentType: \"hint\",\n        //            highlightLint: this.props.highlightLint,\n        //            paths: this.props.contentPaths,\n        //        },\n        //    },\n        //});\n    },\n\n    componentDidMount: function() {\n        this.updatePreview();\n    },\n\n    componentDidUpdate: function() {\n        this.updatePreview();\n    },\n\n    render: function() {\n        const isMobile =\n            this.props.deviceType === \"phone\" ||\n            this.props.deviceType === \"tablet\";\n        return (\n            <div\n                className={\n                    \"perseus-combined-hint-editor \" + \"perseus-editor-row\"\n                }\n            >\n                <div className=\"perseus-editor-left-cell\">\n                    <HintEditor\n                        ref=\"editor\"\n                        isFirst={this.props.isFirst}\n                        isLast={this.props.isLast}\n                        widgets={this.props.hint.widgets}\n                        content={this.props.hint.content}\n                        images={this.props.hint.images}\n                        replace={this.props.hint.replace}\n                        imageUploader={this.props.imageUploader}\n                        onChange={this.props.onChange}\n                        onRemove={this.props.onRemove}\n                        onMove={this.props.onMove}\n                        apiOptions={this.props.apiOptions}\n                    />\n                </div>\n                <div className=\"perseus-editor-right-cell\">\n                    <Renderer\n                        apiOptions={this.props.apiOptions}\n                        {...this.props.hint}\n                    />\n                    {/*<DeviceFramer\n                        deviceType={this.props.deviceType}\n                        nochrome={true}\n                    >\n                        <IframeContentRenderer\n                            ref=\"frame\"\n                            content={this.props.frameSource}\n                            datasetKey=\"mobile\"\n                            datasetValue={isMobile}\n                            seamless={true}\n                        />\n                    </DeviceFramer>*/}\n                </div>\n            </div>\n        );\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function(options) {\n        return this.refs.editor.serialize(options);\n    },\n\n    focus: function() {\n        this.refs.editor.focus();\n    },\n});\n\n/* The entire hints editing/preview area\n *\n * Includes:\n *  ~ All the hint edit boxes, move and remove buttons\n *  ~ All the hint previews\n *  ~ The \"add a hint\" button\n */\nvar CombinedHintsEditor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        deviceType: PropTypes.string.isRequired,\n        frameSource: PropTypes.string.isRequired,\n        imageUploader: PropTypes.func,\n        highlightLint: PropTypes.bool,\n    },\n\n    statics: {\n        HintEditor,\n    },\n\n    getDefaultProps: function() {\n        return {\n            onChange: () => {},\n            hints: [],\n            highlightLint: false,\n        };\n    },\n\n    render: function() {\n        var hints = this.props.hints;\n        var hintElems = _.map(\n            hints,\n            function(hint, i) {\n                return (\n                    <CombinedHintEditor\n                        ref={\"hintEditor\" + i}\n                        key={\"hintEditor\" + i}\n                        isFirst={i === 0}\n                        isLast={i + 1 === hints.length}\n                        hint={hint}\n                        pos={i}\n                        imageUploader={this.props.imageUploader}\n                        onChange={this.handleHintChange.bind(this, i)}\n                        onRemove={this.handleHintRemove.bind(this, i)}\n                        onMove={this.handleHintMove.bind(this, i)}\n                        deviceType={this.props.deviceType}\n                        apiOptions={this.props.apiOptions}\n                        frameSource={this.props.frameSource}\n                        highlightLint={this.props.highlightLint}\n                    />\n                );\n            },\n            this\n        );\n\n        /* eslint-disable max-len */\n        return (\n            <div className=\"perseus-hints-editor perseus-editor-table\">\n                {hintElems}\n                <div className=\"perseus-editor-row\">\n                    <div className=\"add-hint-container perseus-editor-left-cell\">\n                        <button\n                            type=\"button\"\n                            className=\"add-hint simple-button orange\"\n                            onClick={this.addHint}\n                        >\n                            <InlineIcon {...iconPlus} /> Add a hint\n                        </button>\n                    </div>\n                </div>\n            </div>\n        );\n        /* eslint-enable max-len */\n    },\n\n    handleHintChange: function(i, newProps, cb, silent) {\n        // TODO(joel) - lens\n        var hints = _.clone(this.props.hints);\n        hints[i] = _.extend(\n            {},\n            this.serializeHint(i, {keepDeletedWidgets: true}),\n            newProps\n        );\n\n        this.props.onChange({hints: hints}, cb, silent);\n    },\n\n    handleHintRemove: function(i) {\n        var hints = _.clone(this.props.hints);\n        hints.splice(i, 1);\n        this.props.onChange({hints: hints});\n    },\n\n    handleHintMove: function(i, dir) {\n        var hints = _.clone(this.props.hints);\n        var hint = hints.splice(i, 1)[0];\n        hints.splice(i + dir, 0, hint);\n        this.props.onChange({hints: hints}, () => {\n            this.refs[\"hintEditor\" + (i + dir)].focus();\n        });\n    },\n\n    addHint: function() {\n        var hints = _.clone(this.props.hints).concat([{content: \"\"}]);\n        this.props.onChange({hints: hints}, () => {\n            var i = hints.length - 1;\n            this.refs[\"hintEditor\" + i].focus();\n        });\n    },\n\n    getSaveWarnings: function() {\n        return _.chain(this.props.hints)\n            .map((hint, i) => {\n                return _.map(\n                    this.refs[\"hintEditor\" + i].getSaveWarnings(),\n                    issue => \"Hint \" + (i + 1) + \": \" + issue\n                );\n            })\n            .flatten(true)\n            .value();\n    },\n\n    serialize: function(options) {\n        return this.props.hints.map((hint, i) => {\n            return this.serializeHint(i, options);\n        });\n    },\n\n    serializeHint: function(index, options) {\n        return this.refs[\"hintEditor\" + index].serialize(options);\n    },\n});\n\nexport default  CombinedHintsEditor;\n","import { shapePropType } from \"./multi-items/prop-type-builders.js\";\nimport { buildEmptyItemTreeForShape, itemToTree } from \"./multi-items/items.js\";\nimport { MultiRenderer } from \"./multi-items.js\";\nimport _simpleButtonJsx from \"./simple-button.jsx\";\nimport _jsonEditorJsx from \"./json-editor.jsx\";\nimport _componentsInlineIconJsx from \"./components/inline-icon.jsx\";\nimport { iconChevronDown, iconTrash } from \"./icon-paths.js\";\nimport { HintEditor } from \"./hint-editor.jsx\";\nimport _editorJsx from \"./editor.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _hubbleIndexJs from \"./hubble/index.js\";\nimport _reactDom from \"react-dom\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\nconst ReactDOM = _reactDom;\nconst lens = _hubbleIndexJs;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Editor = _editorJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nconst JsonEditor = _jsonEditorJsx;\nconst SimpleButton = _simpleButtonJsx;\n\nconst EDITOR_MODES = [\"edit\", \"preview\", \"json\"];\n\n/**\n * Component that displays the mode dropdown.\n *\n * The mode dropdown is the selector at the top of the editor that lets you\n * switch between edit, preview, and dev-only JSON mode.\n */\nconst ModeDropdown = createReactClass({\n    propTypes: {\n        currentMode: PropTypes.oneOf(EDITOR_MODES),\n\n        // A function that takes in a string signifying the mode (ex: \"edit\")\n        onChange: PropTypes.func,\n    },\n\n    _handleSelectMode: function(event) {\n        if (this.props.onChange) {\n            this.props.onChange(event.target.value);\n        }\n    },\n\n    render: function() {\n        return (\n            <label>\n                Mode:{\" \"}\n                <select\n                    value={this.props.currentMode}\n                    onChange={this._handleSelectMode}\n                >\n                    <option value=\"edit\">Edit</option>\n                    <option value=\"preview\">Preview</option>\n                    <option value=\"json\">Dev-only JSON</option>\n                </select>\n            </label>\n        );\n    },\n});\n\n/**\n * Convert a camel-cased string to a human-formatted string.\n * \"superCoolThings\" -> \"super cool things\"\n */\nfunction camelCaseToHuman(str) {\n    // Decapitalize the capital letters, and add a space before each.\n    return str.replace(/[A-Z]/g, s => \" \" + s.toLowerCase());\n}\n\n/**\n * Capitalize the first letter of the given string.\n * \"super cool things\" -> \"Super cool things\"\n */\nfunction capitalize(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n\n/**\n * Convert the given pluralized word to a singularized word.\n * \"super cool things\" -> \"super cool thing\"\n */\nfunction pluralToSingular(str) {\n    if (str.charAt(str.length - 1) === \"s\") {\n        // Incredibly weak implementation :P\n        return str.slice(0, -1);\n    } else {\n        // Uh oh, dunno how to singularize anything but the simplest case!\n        // Let's just return the plural form, and hope the user forgives the\n        // grammatical inconsistency.\n        return str;\n    }\n}\n\n/**\n * When iterating through the editors, we don't keep track of the extra\n * `_multi` part at the beginning. This is a helper function which takes a path\n * and prepends that key.\n */\nfunction multiPath(path) {\n    return [\"_multi\", ...path];\n}\n\n// Return an h1 if depth=0, h2 if depth=1, etc.\nfunction Header(\n    {\n        depth,\n        ...props\n    }\n) {\n    const headerLevel = Math.min(depth, 5) + 1;\n    const HeaderTag = `h${headerLevel}`;\n    return <HeaderTag {...props} />;\n}\nHeader.propTypes = {\n    depth: PropTypes.number.isRequired,\n};\n\nconst nodePropTypes = {\n    shape: shapePropType,\n    data: PropTypes.any.isRequired,\n    path: PropTypes.arrayOf(\n        PropTypes.oneOfType([\n            PropTypes.string.isRequired,\n            PropTypes.number.isRequired,\n        ])\n    ).isRequired,\n    actions: PropTypes.shape({\n        addArrayElement: PropTypes.func.isRequired,\n        mergeValueAtPath: PropTypes.func.isRequired,\n        setValueAtPath: PropTypes.func.isRequired,\n        moveArrayElementDown: PropTypes.func.isRequired,\n        moveArrayElementUp: PropTypes.func.isRequired,\n        removeArrayElement: PropTypes.func.isRequired,\n    }).isRequired,\n    apiOptions: PropTypes.any.isRequired, // TODO(mdr): real proptype?\n\n    // For the left-hand column, we use edit mode and leave renderers empty.\n    // For the right-hand column, we use preview mode and provide renderers\n    // via a MultiRenderer.\n    renderers: PropTypes.any,\n};\n\n/**\n * Render a node in the editor tree, given the shape of the target\n * node, the data stored in the target node, the path to the target\n * node, and any UI controls that affect how this node relates to its\n * parent (e.g. remove from parent array).\n *\n * This returns a container element with a pretty title and additional\n * UI controls for this node. Its contents are produced by\n * `NodeContent`. The two functions are mutually recursive.\n *\n * Leaf nodes, like items and hints, render an editor pod around their\n * content. Container nodes, like arrays and objects, render a header above\n * their content.\n */\nconst NodeContainer = props => {\n    const {\n        shape,\n        data,\n        path,\n        actions,\n        name: givenName,\n        controls,\n        ...otherProps\n    } = props;\n\n    const name = givenName || camelCaseToHuman(path[path.length - 1] || \"\");\n\n    let Container;\n    if (shape.type === \"array\") {\n        Container = ArrayContainer;\n    } else if (shape.type === \"object\") {\n        Container = ObjectContainer;\n    } else {\n        Container = LeafContainer;\n    }\n\n    return (\n        <Container\n            key={path.join(\".\")}\n            name={name}\n            controls={controls}\n            path={path}\n            shape={shape}\n            actions={actions}\n        >\n            <NodeContent\n                {...otherProps}\n                shape={shape}\n                data={data}\n                path={path}\n                actions={actions}\n            />\n        </Container>\n    );\n};\nNodeContainer.propTypes = {\n    ...nodePropTypes,\n    controls: PropTypes.arrayOf(PropTypes.node),\n};\n\nconst LeafContainer = (\n    {\n        name,\n        controls,\n        children,\n        path,\n        shape\n    }\n) => {\n    const hasPreviewHeading = shape.type === \"content\" || shape.type === \"hint\";\n    const previewHeading = hasPreviewHeading &&\n        <div className={css(styles.containerHeader)}>\n            <Header\n                depth={path.length}\n                className={css(styles.containerTitle)}\n            >\n                {capitalize(name)}\n            </Header>\n        </div>;\n    return (\n        <div className={css(styles.container)}>\n            <span\n                className={css(styles.row, styles.rowHeading)}\n            >\n                <div className={css(styles.columnLeft)}>\n                    <div className={\"pod-title \" + css(styles.containerHeader)}>\n                        <div className={css(styles.containerTitle)}>\n                            {capitalize(name)}\n                        </div>\n                        {controls}\n                    </div>\n                </div>\n                <div className={css(styles.columnRight)}>\n                    {previewHeading}\n                </div>\n            </span>\n            {children}\n        </div>\n    );\n};\nLeafContainer.propTypes = {\n    name: PropTypes.string,\n    controls: PropTypes.node,\n    children: PropTypes.node,\n    path: PropTypes.arrayOf(PropTypes.any).isRequired,\n    shape: shapePropType,\n};\n\nconst ArrayContainer = props => {\n    const {name, controls, children, path, shape, actions} = props;\n    return (\n        <div className={css(styles.container)}>\n            {controls &&\n                <div\n                    className={css(\n                        styles.columnLeft,\n                        styles.containerHeader,\n                    )}\n                >\n                    {controls}\n                </div>}\n            <div>\n                {children}\n            </div>\n            <div className={css(styles.columnLeft)}>\n                <a\n                    href=\"javascript:void 0\"\n                    onClick={() => actions.addArrayElement(path, shape.elementShape)}\n                >\n                    Add a {pluralToSingular(name)}\n                </a>\n            </div>\n        </div>\n    );\n};\nArrayContainer.propTypes = {\n    name: PropTypes.string,\n    controls: PropTypes.node,\n    children: PropTypes.node,\n    path: PropTypes.arrayOf(PropTypes.any).isRequired,\n    shape: shapePropType,\n    actions: PropTypes.shape({\n        addArrayElement: PropTypes.func.isRequired,\n    }).isRequired,\n};\n\nconst ObjectContainer = (\n    {\n        name,\n        controls,\n        children,\n        path\n    }\n) => {\n    const headingEditor = <div\n        className={css(\n            styles.containerHeader,\n        )}\n    >\n        <Header\n            depth={path.length}\n            className={css(styles.containerTitle)}\n        >\n            {capitalize(name)}\n        </Header>\n        {controls}\n    </div>;\n    const headingPreview = (name || controls) && (\n        <div\n            className={css(\n                styles.containerHeader,\n                styles.previewCollectionHeader\n            )}\n        >\n            <Header\n                depth={path.length}\n                className={css(styles.containerTitle)}\n            >\n                {capitalize(name)}\n            </Header>\n        </div>\n    );\n    const hasBothHeadings = headingEditor && headingPreview;\n    return (\n        <div className={css(styles.container)}>\n            {hasBothHeadings && <span className={css(styles.row)}>\n                <div className={css(styles.columnLeft)}>\n                    {headingEditor}\n                </div>\n                <div className={css(styles.columnRight)}>\n                    {headingPreview}\n                </div>\n            </span>}\n            <div className={css(path.length > 0 && styles.contentIndent)}>\n                {children}\n            </div>\n        </div>\n    );\n};\nObjectContainer.propTypes = {\n    name: PropTypes.string,\n    controls: PropTypes.node,\n    children: PropTypes.node,\n    path: PropTypes.arrayOf(PropTypes.any).isRequired,\n};\n\n/**\n * Render the content of node in the editor tree, given the shape of\n * the target node, the data stored in the target node, and the path to\n * the target node.\n *\n * If the target node is a leaf, this returns an editor. Otherwise, it\n * iterates over the child nodes, and outputs `NodeContainer` for\n * each of them. The two functions are mutually recursive.\n */\nconst NodeContent = props => {\n    const {shape} = props;\n\n    if (shape.type === \"content\") {\n        return <ItemNodeContent {...props} />;\n    } else if (shape.type === \"hint\") {\n        return <HintNodeContent {...props} />;\n    } else if (shape.type === \"tags\") {\n        return <TagsNodeContent {...props} />;\n    } else if (shape.type === \"array\") {\n        return <ArrayNodeContent {...props} />;\n    } else if (shape.type === \"object\") {\n        return <ObjectNodeContent {...props} />;\n    }\n};\nNodeContent.propTypes = nodePropTypes;\n\n/**\n * HOC that adds a \"sticky\" prop to the wrapped component that is true\n * when the rendered component is taller than the window. Since sticky content\n * can be somewhat distracting, we'd like to avoid it when not useful. This\n * HOC is useful for only making content sticky when useful.\n *\n * It does so by polling the height and comparing it to the window height.\n */\nfunction withStickiness(Component) {\n    return class StickyComponent extends React.Component {\n        state = {\n            sticky: false,\n        };\n\n        componentDidMount() {\n            this.stickynessTimer = setInterval(this.updateStickiness, 1000);\n            this.updateStickiness();\n        }\n\n        componentWillUnmount() {\n            clearInterval(this.stickynessTimer);\n        }\n\n        updateStickiness = () => {\n            const domNode = ReactDOM.findDOMNode(this);\n            const height = domNode.offsetHeight;\n            const windowHeight = window.innerHeight;\n            const sticky = height > windowHeight;\n            if (sticky !== this.state.sticky) {\n                this.setState({\n                    sticky,\n                });\n            }\n        }\n\n        render() {\n            return <Component\n                sticky={this.state.sticky}\n                {...this.props}\n            />;\n        }\n    };\n}\n\nfunction getChromeVersion() {\n    const raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./);\n    return raw ? parseInt(raw[2], 10) : null;\n}\n\n/**\n * HOC that makes a textareas in sticky components temporarily fixed when\n * editing in Blink browsers.\n *\n * This workaround is necessary because Chrome incorrectly calculates how to\n * scroll \"position: sticky\" containers to ensure the textarea's cursor is\n * visible in by calculating offsets as if they were \"position: relative\".\n *\n * This will be resolved once Chrome 62 is released.\n *   https://bugs.chromium.org/p/chromium/issues/detail?id=702936\n *\n * TODO(joshuan): Remove this after December 2017.\n */\nfunction withChromeHack(Component) {\n    return class ChromeHack extends React.Component {\n        _detached = false;\n        _reattachTimer = null;\n\n        render() {\n            const chromeVersion = getChromeVersion();\n            const requiresHack = chromeVersion && chromeVersion < 62;\n            const isSticky = this.props.sticky;\n\n            if (!requiresHack || !isSticky) {\n                return <Component {...this.props} />;\n            }\n\n            // We indiscriminately make all textareas fixed whenever anything\n            // changes.\n            const actions = {...this.props.actions};\n            actions.mergeValueAtPath = (...args) => {\n                this.props.actions.mergeValueAtPath(...args);\n                this.detach();\n            };\n\n            return <Component\n                {...this.props}\n                actions={actions}\n            />;\n        }\n\n        getTextAreas = () => {\n            return ReactDOM.findDOMNode(this).querySelectorAll(\"textarea\");\n        }\n\n        /**\n         * Removes all textareas from the container\n         */\n        detach = () => {\n            this.getTextAreas().forEach(textarea => {\n                if (textarea !== document.activeElement) {\n                    return;\n                }\n                if (!this._detached) {\n                    const r = textarea.getBoundingClientRect();\n                    const style = textarea.style;\n                    style.setProperty(\"position\", \"fixed\", \"important\");\n                    style.setProperty(\"top\", `${r.y}px`, \"important\");\n                    style.setProperty(\"left\", `${r.x}px`, \"important\");\n                    style.setProperty(\"width\", `${r.width}px`, \"important\");\n                    style.setProperty(\"height\", `${r.height}px`, \"important\");\n                    style.setProperty(\"z-index\", \"1\", \"important\");\n                    style.setProperty(\"height\", `${r.height}px`, \"important\");\n\n                    if (this._reattachTimer) {\n                        clearTimeout(this._reattachTimer);\n                    }\n                }\n            });\n            this._detached = true;\n            this._reattachTimer = setTimeout(this.reattach, 1000);\n        };\n        reattach = () => {\n            this.getTextAreas().forEach(textarea => {\n                const style = textarea.style;\n\n                style.removeProperty(\"position\");\n                style.removeProperty(\"top\");\n                style.removeProperty(\"left\");\n                style.removeProperty(\"width\");\n                style.removeProperty(\"z-index\");\n                style.removeProperty(\"height\");\n            });\n            this._detached = false;\n        }\n    };\n}\n\nconst ItemNodeContent = withStickiness(withChromeHack(props => {\n    const {data, path, actions, apiOptions, renderers, sticky} = props;\n\n    const preview = (\n        <div className=\"framework-perseus\">\n            {lens(renderers).get(path)}\n        </div>\n    );\n\n    return (\n        <span>\n            <div className={css(styles.row)}>\n                <div className={css(styles.columnLeft)}>\n                    <div className={css(sticky && styles.sticky)}>\n                        <Editor\n                            {...data}\n                            onChange={newVal => actions.mergeValueAtPath(\n                                path, newVal)}\n                            apiOptions={apiOptions}\n                        />\n                    </div>\n                </div>\n                <div className={css(styles.columnRight)}>\n                    <div className={css(sticky && styles.sticky)}>\n                        {preview}\n                    </div>\n                </div>\n            </div>\n        </span>\n    );\n}));\nItemNodeContent.propTypes = nodePropTypes;\n\nconst HintNodeContent = withStickiness(withChromeHack(props => {\n    const {data, path, actions, apiOptions, renderers, sticky} = props;\n\n    const preview = (\n        <div className=\"framework-perseus\">\n            {lens(renderers).get(path)}\n        </div>\n    );\n\n    return (\n        <div className={css(styles.row)}>\n            <div className={css(styles.columnLeft)}>\n                <div className={css(sticky && styles.sticky)}>\n                    <HintEditor\n                        {...data}\n                        className={css(styles.hintEditor)}\n                        onChange={newVal => actions.mergeValueAtPath(\n                            path, newVal)}\n                        apiOptions={apiOptions}\n                        showTitle={false}\n                        showRemoveButton={false}\n                        showMoveButtons={false}\n                    />\n                </div>\n            </div>\n            <div className={css(styles.columnRight)}>\n                <div className={css(sticky && styles.sticky)}>\n                    {preview}\n                </div>\n            </div>\n        </div>\n    );\n}));\nHintNodeContent.propTypes = nodePropTypes;\n\nconst TagsNodeContent = props => {\n    const {data, path, actions, apiOptions} = props;\n    const {GroupMetadataEditor} = apiOptions;\n\n    return (\n        <div className={css(styles.columnLeft)}>\n            <div className={css(styles.tagsEditor)}>\n                <GroupMetadataEditor\n                    value={data}\n                    onChange={newVal => actions.setValueAtPath(\n                        path, newVal)}\n                    showTitle={false}\n                />\n            </div>\n        </div>\n    );\n};\nTagsNodeContent.propTypes = nodePropTypes;\n\nconst ArrayNodeContent = props => {\n    const {shape, data, path, actions, ...otherProps} = props;\n\n    const collectionName = camelCaseToHuman(path[path.length - 1]);\n    const elementName = pluralToSingular(collectionName);\n\n    const elementType = shape.elementShape.type;\n    const elementIsLeaf = elementType === \"content\" || elementType === \"hint\";\n\n    const children = data.map((subdata, i) => {\n        const subpath = path.concat(i);\n        const controls = [\n            i > 0 &&\n                    <div\n                        key=\"moveArrayElementUp\"\n                        className={css(styles.control)}\n                    >\n                        <SimpleButton\n                            color=\"orange\"\n                            title=\"Move up\"\n                            onClick={() => actions.moveArrayElementUp(subpath)}\n                        >\n                            <div className={css(styles.verticalFlip)}>\n                                <InlineIcon {...iconChevronDown} />\n                            </div>\n                        </SimpleButton>\n                    </div>,\n            i < data.length - 1 &&\n                    <div\n                        key=\"moveArrayElementDown\"\n                        className={css(styles.control)}\n                    >\n                        <SimpleButton\n                            color=\"orange\"\n                            title=\"Move down\"\n                            onClick={() => actions.moveArrayElementDown(subpath)}\n                        >\n                            <InlineIcon {...iconChevronDown} />\n                        </SimpleButton>\n                    </div>,\n            <div\n                key=\"removeArrayElement\"\n                className={css(styles.control)}\n            >\n                <SimpleButton\n                    color=\"orange\"\n                    title=\"Delete\"\n                    onClick={() => actions.removeArrayElement(subpath)}\n                >\n                    <InlineIcon {...iconTrash} />\n                </SimpleButton>\n            </div>,\n        ];\n        return (\n            <div\n                key={i}\n                className={css(\n                    styles.arrayElement,\n                    !elementIsLeaf && styles.arrayElementAndNotLeaf\n                )}\n            >\n                <NodeContainer\n                    {...otherProps}\n                    key={i}\n                    shape={shape.elementShape}\n                    data={subdata}\n                    path={subpath}\n                    actions={actions}\n                    name={`${elementName} ${i + 1}`}\n                    controls={controls}\n                />\n            </div>\n        );\n    });\n\n    return (\n        <div>\n            {children}\n        </div>\n    );\n};\nArrayNodeContent.propTypes = nodePropTypes;\n\nconst ObjectNodeContent = props => {\n    const {shape, data, path, ...otherProps} = props;\n\n    // Object iteration order should automatically match the order in which the\n    // keys were defined in the object literal. So, whatever order semantically\n    // made sense to the shape's author is the order in which we'll iterate :)\n    const children = Object.keys(shape.shape).map(subkey => <div key={subkey} className={css(styles.objectElement)}>\n        <NodeContainer\n            {...otherProps}\n            shape={shape.shape[subkey]}\n            data={data[subkey]}\n            path={path.concat(subkey)}\n        />\n    </div>\n    );\n\n    return (\n        <div>\n            {children}\n        </div>\n    );\n};\nObjectNodeContent.propTypes = nodePropTypes;\n\nconst MultiRendererEditor = createReactClass({\n    propTypes: {\n        Layout: PropTypes.func,\n        // TODO(emily): use ApiOptions.propTypes\n        apiOptions: PropTypes.any.isRequired,\n\n        item: PropTypes.any.isRequired,\n        editorMode: PropTypes.oneOf(EDITOR_MODES).isRequired,\n\n        onChange: PropTypes.func.isRequired,\n    },\n\n    _renderLayout() {\n        const {Layout, apiOptions, item} = this.props;\n\n        return (\n            <Layout\n                ref={e => this.layout = e}\n                item={item}\n                apiOptions={apiOptions}\n            />\n        );\n    },\n\n    _renderJson() {\n        return (\n            <div>\n                <ModeDropdown\n                    currentMode={this.props.editorMode}\n                    onChange={editorMode => this.props.onChange({editorMode})}\n                />\n                <JsonEditor\n                    multiLine\n                    value={this.props.item}\n                    onChange={item => this.props.onChange({item})}\n                />\n            </div>\n        );\n    },\n\n    _renderPreview() {\n        return (\n            <div>\n                <ModeDropdown\n                    currentMode={this.props.editorMode}\n                    onChange={editorMode => this.props.onChange({editorMode})}\n                />\n                {this._renderLayout()}\n            </div>\n        );\n    },\n\n    mergeValueAtPath(path, newValue) {\n        this.props.onChange({\n            item: lens(this.props.item)\n                .merge(multiPath(path), newValue)\n                .freeze(),\n        });\n    },\n\n    setValueAtPath(path, newValue) {\n        this.props.onChange({\n            item: lens(this.props.item).set(multiPath(path), newValue).freeze(),\n        });\n    },\n\n    addArrayElement(path, shape) {\n        const currentLength = lens(this.props.item).get(multiPath(path)).length;\n        const newElementPath = path.concat(currentLength);\n        const newValue = buildEmptyItemTreeForShape(shape);\n        this.props.onChange({\n            item: lens(this.props.item)\n                .set(multiPath(newElementPath), newValue)\n                .freeze(),\n        });\n    },\n\n    removeArrayElement(path) {\n        this.props.onChange({\n            item: lens(this.props.item).del(multiPath(path)).freeze(),\n        });\n    },\n\n    moveArrayElementDown(path) {\n        // Moving an element down can also be expressed as swapping it with the\n        // following element.\n        const index = path[path.length - 1];\n        const nextElementIndex = index + 1;\n        const nextElementPath = path.slice(0, -1).concat(nextElementIndex);\n\n        const element = lens(this.props.item).get(multiPath(path));\n        const nextElement = lens(this.props.item).get(\n            multiPath(nextElementPath)\n        );\n\n        this.props.onChange({\n            item: lens(this.props.item)\n                .set(multiPath(path), nextElement)\n                .set(multiPath(nextElementPath), element)\n                .freeze(),\n        });\n    },\n\n    moveArrayElementUp(path) {\n        // Moving an element up can also be expressed as moving the previous\n        // element down.\n        const index = path[path.length - 1];\n        const previousElementPath = path.slice(0, -1).concat(index - 1);\n        this.moveArrayElementDown(previousElementPath);\n    },\n\n    _renderEdit() {\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n        };\n\n        const item = this.props.item;\n        const itemShape = this.props.Layout.shape;\n\n        return (\n            <div className=\"perseus-multirenderer-editor\">\n                <ModeDropdown\n                    currentMode={this.props.editorMode}\n                    onChange={editorMode => this.props.onChange({editorMode})}\n                />\n\n                <MultiRenderer\n                    item={item}\n                    shape={itemShape}\n                    apiOptions={apiOptions}\n                >\n                    {(\n                        {\n                            renderers\n                        }\n                    ) => <NodeContainer\n                        mode=\"edit\"\n                        shape={itemShape}\n                        data={itemToTree(item)}\n                        path={[]}\n                        actions={this}\n                        apiOptions={apiOptions}\n                        renderers={renderers}\n                    />}\n                </MultiRenderer>\n            </div>\n        );\n    },\n\n    score() {\n        if (this.layout) {\n            return this.layout.score();\n        }\n    },\n\n    getSerializedState() {\n        if (this.layout) {\n            return this.layout.getSerializedState();\n        }\n    },\n\n    restoreSerializedState(state) {\n        if (this.layout) {\n            this.layout.restoreSerializedState(state);\n        }\n    },\n\n    _renderContent() {\n        switch (this.props.editorMode) {\n            case \"json\":\n                return this._renderJson();\n            case \"preview\":\n                return this._renderPreview();\n            case \"edit\":\n                return this._renderEdit();\n            default:\n                return (\n                    <ModeDropdown\n                        currentMode={this.props.editorMode}\n                        onChange={editorMode => this.props.onChange({\n                            editorMode,\n                        })}\n                    />\n                );\n        }\n    },\n\n    render() {\n        return (\n            <div id=\"perseus\">\n                {this._renderContent()}\n            </div>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    editor: {\n        width: \"100%\",\n    },\n\n    treePreview: {\n        position: \"relative\",\n    },\n\n    verticalFlip: {\n        transform: \"scaleY(-1)\",\n    },\n\n    control: {\n        marginLeft: 12,\n    },\n\n    containerHeader: {\n        alignItems: \"flex-end\",\n        display: \"flex\",\n        flexDirection: \"row\",\n    },\n\n    previewCollectionHeader: {\n        marginBottom: 16,\n    },\n\n    containerTitle: {\n        flexGrow: 1,\n        margin: 0,\n    },\n\n    contentIndent: {\n        marginLeft: 8,\n    },\n\n    hintEditor: {\n        paddingBottom: 0,\n    },\n\n    arrayElement: {\n        marginBottom: 16,\n    },\n\n    // Leaf nodes are already wrapped in cute little pods, so they don't need\n    // this extra border between array elements.\n    arrayElementAndNotLeaf: {\n        borderBottom: \"1px solid #ccc\",\n        \":first-child\": {\n            borderTop: \"1px solid #ccc\",\n            paddingTop: 16,\n        },\n    },\n\n    objectElement: {\n        marginBottom: 16,\n    },\n\n    tagsEditor: {\n        border: \"1px solid #ddd\",\n        padding: \"5px 10px\",\n    },\n\n    /**\n     * A row contains a fixed width editor and a preview that expands as\n     * needed.\n     */\n    row: {\n        display: \"flex\",\n        position: \"relative\",\n    },\n\n    /**\n     * The editor.\n     */\n    columnLeft: {\n        width: 360,\n        marginRight: 30,\n        // so that the `position: absolute` of line markers are positioned\n        // relative to this.\n        position: \"relative\",\n    },\n\n    /**\n     * The preview.\n     */\n    columnRight: {\n        flex: 1,\n        marginLeft: 30,\n        position: \"relative\",\n    },\n\n    /**\n     * Sticks to just under the heading.\n     */\n    sticky: {\n        position: \"sticky\",\n        top: 33,  // height of the cute pod for the editor\n    },\n\n    /**\n     * Used for sticky headings.\n     */\n    rowHeading: {\n        position: \"sticky\",\n        backgroundColor: \"white\",\n        width: \"100%\",\n        // TODO(joshuan): Make this less arbitrary. It should be higher than\n        // perseus content.\n        zIndex: 101,\n        top: -1,\n    },\n});\n\n_module_.exports = MultiRendererEditor;\nexport default _module_.exports;\n","import { buildEmptyItemForShape, MultiRenderer, shapes } from \"./multi-items.js\";\nimport _utilJs from \"./util.js\";\nimport _multirendererEditorJsx from \"./multirenderer-editor.jsx\";\nimport _react from \"react\";\nimport { StyleSheet, css } from \"aphrodite\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\n\nconst MultiRendererEditor = _multirendererEditorJsx;\nconst Util = _utilJs;\n\nconst DemoLayout = createReactClass({\n    propTypes: {\n        item: PropTypes.any.isRequired,\n    },\n\n    statics: {\n        shape: shapes.shape({\n            sharedContext: shapes.content,\n            questions: shapes.arrayOf(\n                shapes.shape({\n                    tags: shapes.tags,\n                    question: shapes.content,\n                })\n            ),\n            hints: shapes.hints,\n        }),\n    },\n\n    getInitialState() {\n        return {numHints: 0};\n    },\n\n    score() {\n        return this.multirenderer.score();\n    },\n\n    getSerializedState() {\n        return this.multirenderer.getSerializedState();\n    },\n\n    restoreSerializedState(state) {\n        this.multirenderer.restoreSerializedState(state);\n    },\n\n    addHint() {\n        this.setState((\n            {\n                numHints\n            }\n        ) => ({\n            numHints: numHints + 1\n        }));\n    },\n\n    clearHints() {\n        this.setState({numHints: 0});\n    },\n\n    render() {\n        return (\n            <MultiRenderer\n                ref={e => this.multirenderer = e}\n                item={this.props.item}\n                shape={DemoLayout.shape}\n            >\n                {(\n                    {\n                        renderers\n                    }\n                ) => <div>\n                    <div className={css(demoStyles.left)}>\n                        {renderers.sharedContext}\n                    </div>\n                    <div className={css(demoStyles.right)}>\n                        <h2>Questions</h2>\n                        <ul>\n                            {renderers.questions.map((r, i) => <li key={i}>\n                                {r.question}\n                            </li>\n                            )}\n                        </ul>\n                        {renderers.hints.length > 0 &&\n                            <div>\n                                <h2>Hints</h2>\n                                {renderers.hints.firstN(\n                                    this.state.numHints\n                                )}\n                                {this.state.numHints <\n                                    renderers.hints.length &&\n                                    <div>\n                                        <button onClick={this.addHint}>\n                                            Get a hint\n                                        </button>\n                                    </div>}\n                                {this.state.numHints > 0 &&\n                                    <div>\n                                        <button onClick={this.clearHints}>\n                                            Clear hints\n                                        </button>\n                                    </div>}\n                            </div>}\n                    </div>\n                </div>}\n            </MultiRenderer>\n        );\n    },\n});\n\nconst demoStyles = StyleSheet.create({\n    left: {\n        float: \"left\",\n    },\n\n    right: {\n        float: \"right\",\n    },\n});\n\nconst MultiRendererDemo = createReactClass({\n    propTypes: {\n        item: PropTypes.any.isRequired,\n    },\n\n    getDefaultProps() {\n        return {\n            item: buildEmptyItemForShape(DemoLayout.shape),\n        };\n    },\n\n    getInitialState() {\n        return {\n            item: this.props.item,\n            editorMode: \"edit\",\n        };\n    },\n\n    getEditorProps() {\n        return {\n            Layout: DemoLayout,\n            apiOptions: {\n                onFocusChange: function(newPath, oldPath) {\n                    console.log(\"onFocusChange\", newPath, oldPath);\n                },\n                trackInteraction: function(trackData) {\n                    console.log(\"Interaction with\", trackData.type, trackData);\n                },\n            },\n\n            item: this.state.item,\n            editorMode: this.state.editorMode,\n        };\n    },\n\n    handleChange(newState) {\n        this.setState(newState);\n    },\n\n    _getContentHash: function() {\n        return Util.strongEncodeURIComponent(\n            // TODO(emily): this.editor.serialize()\n            JSON.stringify(this.state.item)\n        );\n    },\n\n    handlePermalink(e) {\n        window.location.hash = `content=${this._getContentHash()}`;\n        e.preventDefault();\n    },\n\n    handleScore() {\n        console.log(this.editor.score());\n    },\n\n    handleSerializeState() {\n        this._state = this.editor.getSerializedState();\n    },\n\n    handleRestoreState() {\n        this.editor.restoreSerializedState(this._state);\n    },\n\n    render() {\n        const previewVisible =\n            this.state.editorMode === \"edit\" ||\n            this.state.editorMode === \"preview\";\n\n        return (\n            <div>\n                <div id=\"extras\">\n                    <button onClick={this.handlePermalink}>\n                        Permalink\n                    </button>{\" \"}\n                    <button\n                        onClick={this.handleScore}\n                        disabled={!previewVisible}\n                    >\n                        Score\n                    </button>{\" \"}\n                    <button\n                        onClick={this.handleSerializeState}\n                        disabled={!previewVisible}\n                    >\n                        Store state\n                    </button>{\" \"}\n                    <button\n                        onClick={this.handleRestoreState}\n                        disabled={!previewVisible}\n                    >\n                        Restore state\n                    </button>\n                </div>\n                <div className=\"framework-perseus\">\n                    <MultiRendererEditor\n                        {...this.getEditorProps()}\n                        onChange={this.handleChange}\n                        ref={e => this.editor = e}\n                    />\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = MultiRendererDemo;\nexport default _module_.exports;\n","import * as constants from \"../styles/constants.js\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst React = _react;\n\nconst HUD = createReactClass({\n    propTypes: {\n        message: PropTypes.string.isRequired,\n        enabled: PropTypes.bool.isRequired,\n        onClick: PropTypes.func.isRequired,\n    },\n\n    // Displays a stylized open eye: lint warnings are visible\n    renderVisibleIcon: function() {\n        return (\n            <svg\n                width=\"24\"\n                height=\"24\"\n                viewBox=\"0 0 24 24\"\n                className={css(styles.icon)}\n            >\n                <defs>\n                    <path\n                        id=\"a\"\n                        d={\n                            \"M7.401 10.035c-1.424.748-2.599 1.905-3.544 \" +\n                            \"3.48a1 1 0 0 1-1.714-1.03C4.325 8.849 7.652 7 \" +\n                            \"12 7c4.348 0 7.675 1.848 9.857 5.486a1 1 0 0 \" +\n                            \"1-1.714 1.028c-.945-1.574-2.12-2.73-3.544-\" +\n                            \"3.48a5 5 0 1 1-9.198 0zM12 15a3 3 0 1 0 0-6 3 3 \" +\n                            \"0 0 0 0 6z\"\n                        }\n                    />\n                </defs>\n                <g fill=\"none\" fillRule=\"evenodd\">\n                    <path fill=\"none\" d=\"M0 0h24v24H0z\" />\n                    <mask id=\"b\" fill=\"#fff\">\n                        <use href=\"#a\" />\n                    </mask>\n                    <use fill=\"#fff\" fillRule=\"nonzero\" href=\"#a\" />\n                    <g fill=\"#fff\" mask=\"url(#b)\">\n                        <path d=\"M0 0h24v24H0z\" />\n                    </g>\n                </g>\n            </svg>\n        );\n    },\n\n    // Displays a stylized eye with a line through it: I don't want to see lint\n    renderHiddenIcon: function() {\n        return (\n            <svg\n                width=\"24\"\n                height=\"24\"\n                viewBox=\"0 0 24 24\"\n                className={css(styles.icon)}\n            >\n                <defs>\n                    <path\n                        id=\"a\"\n                        d={\n                            \"M8.794 7.38C9.791 7.127 10.86 7 12 7c4.348 0 \" +\n                                \"7.675 1.848 9.857 5.486a1 1 0 0 1-1.714 \" +\n                                \"1.028c-.945-1.574-2.12-2.73-3.544-3.48.258.\" +\n                                \"604.401 1.268.401 1.966 0 1.02-.305 \" +\n                                \"1.967-.828 2.757l2.535 2.536a1 1 0 0 \" +\n                                \"1-1.414 1.414l-12-12a1 1 0 0 1 \" +\n                                \"1.414-1.414L8.794 7.38zm5.914 5.913a3 3 0 0 \" +\n                                \"0-4.001-4.001l4 4.001zM6.072 8.486l2.976 \" +\n                                \"2.976a3 3 0 0 0 3.49 3.49l1.579 1.58A5 5 0 \" +\n                                \"0 1 7.4 10.035c-1.424.747-2.599 1.904-3.544 \" +\n                                \"3.478a1 1 0 0 1-1.714-1.028c1.049-1.75 \" +\n                                \"2.363-3.085 3.929-4z\"\n                        }\n                    />\n                </defs>\n                <g fill=\"none\" fillRule=\"evenodd\">\n                    <path fill=\"none\" d=\"M0 0h24v24H0z\" />\n                    <mask id=\"b\" fill=\"#fff\">\n                        <use href=\"#a\" />\n                    </mask>\n                    <use fill=\"#fff\" fillRule=\"nonzero\" href=\"#a\" />\n                    <g fill=\"#fff\" mask=\"url(#b)\">\n                        <path d=\"M0 0h24v24H0z\" />\n                    </g>\n                </g>\n            </svg>\n        );\n    },\n\n    render: function() {\n        let state;\n        let icon;\n        if (this.props.enabled) {\n            state = styles.enabled;\n            icon = this.renderVisibleIcon();\n        } else {\n            state = styles.disabled;\n            icon = this.renderHiddenIcon();\n        }\n\n        return (\n            <button\n                className={css(styles.hud, state)}\n                onClick={e => {\n                    this.props.onClick();\n                }}\n            >\n                {icon}\n                {this.props.message}\n            </button>\n        );\n    },\n});\n\nconst styles = StyleSheet.create({\n    hud: {\n        position: \"fixed\",\n        right: 20,\n        bottom: 20,\n        boxSizing: \"border-box\",\n        height: 36,\n        padding: \"9px 16px\",\n        borderRadius: 18,\n        fontFamily: constants.boldFontFamily,\n        fontSize: \"15px\",\n        lineHeight: \"18px\",\n        color: constants.white,\n        userSelect: \"none\",\n        borderWidth: 0, // <button> gives us a border by default\n    },\n\n    icon: {\n        width: 24,\n        height: 24,\n        marginRight: 8,\n        marginTop: -3,\n        verticalAlign: \"middle\",\n    },\n\n    enabled: {\n        backgroundColor: constants.warningColor,\n        \":hover\": {\n            backgroundColor: constants.warningColorHover,\n        },\n        \":active\": {\n            backgroundColor: constants.warningColorActive,\n        },\n    },\n\n    disabled: {\n        backgroundColor: constants.gray76,\n        \":hover\": {\n            backgroundColor: \"#a1a5a9\", // in between those two grays\n        },\n        \":active\": {\n            backgroundColor: constants.gray68,\n        },\n    },\n});\n\n_module_.exports = HUD;\nexport default _module_.exports;\n","import _componentsHudJsx from \"./components/hud.jsx\";\nimport _iframeContentRendererJsx from \"./iframe-content-renderer.jsx\";\nimport _componentsDeviceFramerJsx from \"./components/device-framer.jsx\";\nimport _jsonEditorJsx from \"./json-editor.jsx\";\nimport _componentsInlineIconJsx from \"./components/inline-icon.jsx\";\nimport { iconCircleArrowDown, iconCircleArrowUp, iconPlus, iconTrash } from \"./icon-paths.js\";\nimport _editorJsx from \"./editor.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * An article editor. Articles are long-form pieces of content, composed of\n * multiple (Renderer) sections concatenated together.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ApiOptions = _perseusApiJsx.Options;\nconst Editor = _editorJsx;\nconst InlineIcon = _componentsInlineIconJsx;\nconst JsonEditor = _jsonEditorJsx;\nconst DeviceFramer = _componentsDeviceFramerJsx;\nconst IframeContentRenderer = _iframeContentRendererJsx;\nconst HUD = _componentsHudJsx;\n\nconst rendererProps = PropTypes.shape({\n    content: PropTypes.string,\n    widgets: PropTypes.object,\n    images: PropTypes.object,\n});\n\nconst SectionControlButton = createReactClass({\n    propTypes: {\n        icon: PropTypes.shape(InlineIcon.propTypes).isRequired,\n        onClick: PropTypes.func.isRequired,\n        title: PropTypes.string.isRequired,\n    },\n    render: function() {\n        const {icon, onClick, title} = this.props;\n        return (\n            <a\n                href=\"#\"\n                className={\n                    \"section-control-button \" +\n                    \"simple-button \" +\n                    \"simple-button--small \" +\n                    \"orange\"\n                }\n                onClick={e => {\n                    e.preventDefault();\n                    onClick();\n                }}\n                title={title}\n            >\n                <InlineIcon {...icon} />\n            </a>\n        );\n    },\n});\n\nconst ArticleEditor = createReactClass({\n    propTypes: {\n        apiOptions: PropTypes.shape({}),\n        contentPaths: PropTypes.arrayOf(PropTypes.string),\n        frameSource: PropTypes.string.isRequired,\n        imageUploader: PropTypes.func,\n        json: PropTypes.oneOfType([\n            rendererProps,\n            PropTypes.arrayOf(rendererProps),\n        ]),\n        mode: PropTypes.oneOf([\"diff\", \"edit\", \"json\", \"preview\"]),\n        onChange: PropTypes.func.isRequired,\n        screen: PropTypes.oneOf([\"phone\", \"tablet\", \"desktop\"]),\n        sectionImageUploadGenerator: PropTypes.func,\n        useNewStyles: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            contentPaths: [],\n            json: [{}],\n            mode: \"edit\",\n            screen: \"desktop\",\n            sectionImageUploadGenerator: () => <span />,\n            useNewStyles: false,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            highlightLint: true,\n        };\n    },\n\n    componentDidMount: function() {\n        this._updatePreviewFrames();\n    },\n\n    componentDidUpdate: function() {\n        this._updatePreviewFrames();\n    },\n\n    _updatePreviewFrames: function() {\n        if (this.props.mode === \"preview\") {\n            this.refs[\"frame-all\"].sendNewData({\n                type: \"article-all\",\n                data: this._sections().map((section, i) => {\n                    return this._apiOptionsForSection(section, i);\n                }),\n            });\n        } else if (this.props.mode === \"edit\") {\n            this._sections().forEach((section, i) => {\n                this.refs[\"frame-\" + i].sendNewData({\n                    type: \"article\",\n                    data: this._apiOptionsForSection(section, i),\n                });\n            });\n        }\n    },\n\n    _apiOptionsForSection: function(section, sectionIndex) {\n        const editor = this.refs[`editor${sectionIndex}`];\n        return {\n            apiOptions: {\n                ...ApiOptions.defaults,\n                ...this.props.apiOptions,\n\n                // Alignment options are always available in article\n                // editors\n                showAlignmentOptions: true,\n                isArticle: true,\n            },\n            json: section,\n            useNewStyles: this.props.useNewStyles,\n            linterContext: {\n                contentType: \"article\",\n                highlightLint: this.state.highlightLint,\n                paths: this.props.contentPaths,\n            },\n            legacyPerseusLint: editor ? editor.getSaveWarnings() : [],\n        };\n    },\n\n    _sections: function() {\n        return _.isArray(this.props.json) ? this.props.json : [this.props.json];\n    },\n\n    _renderEditor: function() {\n        const {imageUploader, sectionImageUploadGenerator} = this.props;\n\n        const apiOptions = {\n            ...ApiOptions.defaults,\n            ...this.props.apiOptions,\n\n            // Alignment options are always available in article editors\n            showAlignmentOptions: true,\n            isArticle: true,\n        };\n\n        const sections = this._sections();\n\n        /* eslint-disable max-len */\n        return (\n            <div className=\"perseus-editor-table\">\n                {sections.map((section, i) => {\n                    return [\n                        <div className=\"perseus-editor-row\">\n                            <div className=\"perseus-editor-left-cell\">\n                                <div className=\"pod-title\">\n                                    Section {i + 1}\n                                    <div\n                                        style={{\n                                            display: \"inline-block\",\n                                            float: \"right\",\n                                        }}\n                                    >\n                                        {sectionImageUploadGenerator(i)}\n                                        <SectionControlButton\n                                            icon={iconPlus}\n                                            onClick={() => {\n                                                this._handleAddSectionAfter(i);\n                                            }}\n                                            title={\n                                                \"Add a new section after this one\"\n                                            }\n                                        />\n                                        {i + 1 < sections.length &&\n                                            <SectionControlButton\n                                                icon={iconCircleArrowDown}\n                                                onClick={() => {\n                                                    this._handleMoveSectionLater(\n                                                        i\n                                                    );\n                                                }}\n                                                title=\"Move this section down\"\n                                            />}\n                                        {i > 0 &&\n                                            <SectionControlButton\n                                                icon={iconCircleArrowUp}\n                                                onClick={() => {\n                                                    this._handleMoveSectionEarlier(\n                                                        i\n                                                    );\n                                                }}\n                                                title=\"Move this section up\"\n                                            />}\n                                        <SectionControlButton\n                                            icon={iconTrash}\n                                            onClick={() => {\n                                                const msg =\n                                                    \"Are you sure you \" +\n                                                    \"want to delete section \" +\n                                                    (i + 1) +\n                                                    \"?\";\n                                                /* eslint-disable no-alert */\n                                                if (confirm(msg)) {\n                                                    this._handleRemoveSection(\n                                                        i\n                                                    );\n                                                }\n                                                /* eslint-enable no-alert */\n                                            }}\n                                            title=\"Delete this section\"\n                                        />\n                                    </div>\n                                </div>\n                                <Editor\n                                    {...section}\n                                    apiOptions={apiOptions}\n                                    imageUploader={imageUploader}\n                                    onChange={_.partial(\n                                        this._handleEditorChange,\n                                        i\n                                    )}\n                                    placeholder=\"Type your section text here...\"\n                                    ref={\"editor\" + i}\n                                />\n                            </div>\n\n                            <div className={\"editor-preview\"}>\n                                {this._renderIframePreview(i, true)}\n                            </div>\n                        </div>,\n                    ];\n                })}\n                {this._renderAddSection()}\n                {this._renderLinterHUD()}\n            </div>\n        );\n        /* eslint-enable max-len */\n    },\n\n    _renderAddSection: function() {\n        return (\n            <div className=\"perseus-editor-row\">\n                <div className=\"perseus-editor-left-cell\">\n                    <a\n                        href=\"#\"\n                        className=\"simple-button orange\"\n                        onClick={() => {\n                            this._handleAddSectionAfter(\n                                this._sections().length - 1\n                            );\n                        }}\n                    >\n                        <InlineIcon {...iconPlus} /> Add a section\n                    </a>\n                </div>\n            </div>\n        );\n    },\n\n    _renderLinterHUD: function() {\n        return (\n            <HUD\n                message=\"Style warnings\"\n                enabled={this.state.highlightLint}\n                onClick={() => {\n                    this.setState({\n                        highlightLint: !this.state.highlightLint,\n                    });\n                }}\n            />\n        );\n    },\n\n    _renderIframePreview: function(i, nochrome) {\n        const isMobile =\n            this.props.screen === \"phone\" || this.props.screen === \"tablet\";\n\n        return (\n            <DeviceFramer deviceType={this.props.screen} nochrome={nochrome}>\n                <IframeContentRenderer\n                    ref={\"frame-\" + i}\n                    key={this.props.screen}\n                    content={this.props.frameSource}\n                    datasetKey=\"mobile\"\n                    datasetValue={isMobile}\n                    seamless={nochrome}\n                />\n            </DeviceFramer>\n        );\n    },\n\n    _renderPreviewMode: function() {\n        return (\n            <div className=\"standalone-preview\">\n                {this._renderIframePreview(\"all\", false)}\n            </div>\n        );\n    },\n\n    _handleJsonChange: function(newJson) {\n        this.props.onChange({json: newJson});\n    },\n\n    _handleEditorChange: function(i, newProps) {\n        const sections = _.clone(this._sections());\n        sections[i] = _.extend({}, sections[i], newProps);\n        this.props.onChange({json: sections});\n    },\n\n    _handleMoveSectionEarlier: function(i) {\n        if (i === 0) {\n            return;\n        }\n        const sections = _.clone(this._sections());\n        const section = sections[i];\n        sections.splice(i, 1);\n        sections.splice(i - 1, 0, section);\n        this.props.onChange({\n            json: sections,\n        });\n    },\n\n    _handleMoveSectionLater: function(i) {\n        const sections = _.clone(this._sections());\n        if (i + 1 === sections.length) {\n            return;\n        }\n        const section = sections[i];\n        sections.splice(i, 1);\n        sections.splice(i + 1, 0, section);\n        this.props.onChange({\n            json: sections,\n        });\n    },\n\n    _handleAddSectionAfter: function(i) {\n        // We do a full serialization here because we\n        // might be copying widgets:\n        const sections = _.clone(this.serialize());\n        // Here we do magic to allow you to copy-paste\n        // things from the previous section into the new\n        // section while preserving widgets.\n        // To enable this, we preserve the widgets\n        // object for the new section, but wipe out\n        // the content.\n        const newSection =\n            i >= 0\n                ? {\n                    widgets: sections[i].widgets,\n                }\n                : {};\n        sections.splice(i + 1, 0, newSection);\n        this.props.onChange({\n            json: sections,\n        });\n    },\n\n    _handleRemoveSection: function(i) {\n        const sections = _.clone(this._sections());\n        sections.splice(i, 1);\n        this.props.onChange({\n            json: sections,\n        });\n    },\n\n    serialize: function() {\n        if (this.props.mode === \"edit\") {\n            return this._sections().map((section, i) => {\n                return this.refs[\"editor\" + i].serialize();\n            });\n        } else if (\n            this.props.mode === \"preview\" ||\n            this.props.mode === \"json\"\n        ) {\n            return this.props.json;\n        } else {\n            throw new Error(\n                \"Could not serialize; mode \" + this.props.mode + \" not found\"\n            );\n        }\n    },\n\n    /**\n     * Returns an array, with one element be section.\n     * Each element is an array of lint warnings present in that section.\n     *\n     * This function can currently only be called in edit mode.\n     */\n    getSaveWarnings: function() {\n        if (this.props.mode !== \"edit\") {\n            // TODO(joshuan): We should be able to get save warnings in\n            // preview mode.\n            throw new Error(\"Cannot only get save warnings in edit mode.\");\n        }\n\n        return this._sections().map((section, i) => {\n            return this.refs[\"editor\" + i].getSaveWarnings();\n        });\n    },\n\n    render: function() {\n        return (\n            <div className=\"framework-perseus perseus-article-editor\">\n                {this.props.mode === \"edit\" && this._renderEditor()}\n\n                {this.props.mode === \"preview\" && this._renderPreviewMode()}\n\n                {this.props.mode === \"json\" &&\n                    <div className=\"json-editor\">\n                        <div className=\"json-editor-warning\">\n                            <span>\n                                Warning: Editing in this mode can lead to broken\n                                articles!\n                            </span>\n                        </div>\n                        <JsonEditor\n                            multiLine={true}\n                            onChange={this._handleJsonChange}\n                            value={this.props.json}\n                        />\n                    </div>}\n            </div>\n        );\n    },\n});\n\n_module_.exports = ArticleEditor;\nexport default _module_.exports;\n","import _articleEditorJsx from \"./article-editor.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n\n/**\n * Renders an ArticleEditor as a non-controlled component.\n *\n * Normally the parent of ArticleEditor must pass it an onChange callback and\n * then respond to any changes by modifying the ArticleEditor props to reflect\n * those changes. With StatefulArticleEditor changes are stored in state so you\n * can query them with serialize.\n */\n\nconst React = _react;\nconst _ = _underscore;\n\nconst ArticleEditor = _articleEditorJsx;\n\nconst StatefulArticleEditor = createReactClass({\n    getInitialState: function() {\n        return Object.assign({}, this.props, {\n            mode: \"edit\",\n            onChange: this.handleChange,\n            ref: \"editor\",\n            screen: \"phone\",\n        });\n    },\n\n    // getInitialState isn't called if the react component is re-rendered\n    // in-place on the dom, in which case this is called instead, so we\n    // need to update the state here.\n    // (This component is currently re-rendered by the \"Add image\" button.)\n    componentWillReceiveProps: function(nextProps) {\n        // be careful not to overwrite our onChange and ref\n        this.setState(_.omit(nextProps, \"onChange\", \"ref\"));\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function() {\n        return this.refs.editor.serialize();\n    },\n\n    handleChange: function(newState, cb) {\n        if (this.isMounted()) {\n            this.setState(newState, cb);\n        }\n    },\n\n    scorePreview: function() {\n        return this.refs.editor.scorePreview();\n    },\n\n    render: function() {\n        const {mode, screen} = this.state;\n        return (\n            <div>\n                <div style={styles.controlBar}>\n                    <span style={styles.controls}>\n                        Mode:{\" \"}\n                        <span\n                            onClick={() => this.setState({mode: \"edit\"})}\n                            style={\n                                mode === \"edit\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            EDIT\n                        </span>\n                        {\" | \"}\n                        <span\n                            onClick={() => this.setState({mode: \"preview\"})}\n                            style={\n                                mode === \"preview\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            PREVIEW\n                        </span>\n                        {\" | \"}\n                        <span\n                            onClick={() => this.setState({mode: \"json\"})}\n                            style={\n                                mode === \"json\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            JSON\n                        </span>\n                    </span>\n                    <span style={styles.controls}>\n                        Screen:{\" \"}\n                        <span\n                            onClick={() => this.setState({screen: \"phone\"})}\n                            style={\n                                screen === \"phone\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            PHONE\n                        </span>\n                        {\" | \"}\n                        <span\n                            onClick={() => this.setState({screen: \"tablet\"})}\n                            style={\n                                screen === \"tablet\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            TABLET\n                        </span>\n                        {\" | \"}\n                        <span\n                            onClick={() => this.setState({screen: \"desktop\"})}\n                            style={\n                                screen === \"desktop\"\n                                    ? styles.controlSelected\n                                    : styles.control\n                            }\n                        >\n                            DESKTOP\n                        </span>\n                    </span>\n                </div>\n                <div style={styles.editor}>\n                    <ArticleEditor {...this.state} />\n                </div>\n            </div>\n        );\n    },\n});\n\nconst styles = {\n    controlBar: {\n        marginBottom: 25,\n        marginTop: 5,\n    },\n    controls: {\n        marginRight: 10,\n    },\n    controlSelected: {\n        cursor: \"default\",\n        fontWeight: 700,\n    },\n    control: {\n        cursor: \"pointer\",\n    },\n    editor: {\n        marginTop: -20,\n    },\n};\n\n_module_.exports = StatefulArticleEditor;\nexport default _module_.exports;\n","import _utilJs from \"./util.js\";\nimport _statefulArticleEditorJsx from \"./stateful-article-editor.jsx\";\nimport _articleEditorJsx from \"./article-editor.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Demonstrates the rendered result of a Perseus article\n */\n\nconst React = _react;\nconst ArticleEditor = _articleEditorJsx;\nconst StatefulArticleEditor = _statefulArticleEditorJsx;\nconst Util = _utilJs;\n\nconst defaultArticle = [\n    {\n        content: \"\",\n        images: {},\n        widgets: {},\n    },\n];\n\nconst ArticleDemo = createReactClass({\n    propTypes: {\n        content: PropTypes.any.isRequired,\n    },\n\n    getDefaultProps() {\n        return {\n            content: defaultArticle,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            isMobile: navigator.userAgent.indexOf(\"Mobile\") !== -1,\n        };\n    },\n\n    componentDidMount: function() {\n        window.addEventListener(\"resize\", this._handleResize);\n    },\n\n    componentWillUnmount: function() {\n        window.removeEventListener(\"resize\", this._handleResize);\n    },\n\n    serialize: function() {\n        console.log(JSON.stringify(this.refs.editor.serialize(), null, 4)); // eslint-disable-line no-console\n    },\n\n    scorePreview: function() {\n        console.log(this.refs.editor.scorePreview()); // eslint-disable-line no-console\n    },\n\n    _getContentHash: function() {\n        return Util.strongEncodeURIComponent(\n            JSON.stringify(this.refs.editor.serialize())\n        );\n    },\n\n    permalink: function(e) {\n        window.location.hash = `content=${this._getContentHash()}`;\n        e.preventDefault();\n    },\n\n    _handleResize() {\n        const isMobile = navigator.userAgent.indexOf(\"Mobile\") !== -1;\n        if (this.state.isMobile !== isMobile) {\n            this.setState({isMobile});\n        }\n    },\n\n    getEditorProps() {\n        const {isMobile} = this.state;\n\n        return {\n            json: this.props.content,\n            imageUploader: function(image, callback) {\n                setTimeout(callback, 1000, \"http://fake.image.url\");\n            },\n            apiOptions: {\n                customKeypad: isMobile,\n                onFocusChange: function(newPath, oldPath) {\n                    console.log(\"onFocusChange\", newPath, oldPath); // eslint-disable-line no-console\n                },\n                trackInteraction: function(trackData) {\n                    console.log( // eslint-disable-line no-console\n                        \"Interaction with\",\n                        trackData.type,\n                        trackData\n                    );\n                },\n                isMobile,\n            },\n\n            useNewStyles: true,\n            componentClass: ArticleEditor,\n\n            /* eslint-disable max-len */\n            frameSource: `<!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset=\"utf-8\">\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0\">\n\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/local-only/khan-site.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/local-only/khan-exercise.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/katex/katex.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/font-awesome.min.css\">\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/mathquill/mathquill.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/perseus-admin-package/devices.min.css\" />\n\n                    <link rel=\"stylesheet/less\" type=\"text/css\" href=\"stylesheets/exercise-content-package/perseus.less\" />\n                    <link rel=\"stylesheet/less\" type=\"text/css\" href=\"stylesheets/perseus-admin-package/editor.less\" />\n                    <style>\n                        body {\n                            min-width: 0 !important;\n                            /* overrides body { min-width: 1000px; } in khan-site.css */\n                        }\n                    </style>\n\n                    <script>less = {env: 'development', logLevel: 1};</script>\n                    <script src=\"lib/less.js\"></script>\n                </head>\n                <body>\n                    <div id=\"content-container\">\n                    </div>\n                    <script src=\"lib/babel-polyfills.min.js\"></script>\n                    <script src=\"lib/jquery.js\"></script>\n                    <script src=\"lib/underscore.js\"></script>\n                    <script src=\"lib/react-with-addons.js\"></script>\n                    <script src=\"lib/mathjax/2.1/MathJax.js?config=KAthJax-730d56e87e9c926b91584f6030314815&amp;delayStartupUntil=configured\"></script>\n                    <script src=\"lib/katex/katex.js\"></script>\n                    <script src=\"lib/mathquill/mathquill-basic.js\"></script>\n                    <script src=\"lib/kas.js\"></script>\n                    <script src=\"lib/i18n.js\"></script>\n                    <script src=\"lib/jquery.qtip.js\"></script>\n                    <script src=\"build/frame-perseus.js\"></script>\n                </body>\n            </html>`,\n            /* eslint-enable max-len */\n        };\n    },\n\n    render: function() {\n        return (\n            <div id=\"perseus-index\">\n                <div id=\"extras\">\n                    <button onClick={this.serialize}>serialize</button>{\" \"}\n                    <button onClick={this.scorePreview}>score</button>{\" \"}\n                    <button onClick={this.permalink}>permalink</button>{\" \"}\n                </div>\n                <div style={{margin: 20}}>\n                    <StatefulArticleEditor\n                        ref=\"editor\"\n                        {...this.getEditorProps()}\n                    />\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = ArticleDemo;\nexport default _module_.exports;\n","import _simpleButtonJsx from \"./simple-button.jsx\";\nimport _itemRendererJsx from \"./item-renderer.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _reactDom from \"react-dom\";\nimport { StyleSheet, css } from \"aphrodite\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n  * Demonstrates the rendered result of a Perseus question\n  *\n  * This mounts the ItemRenderer and adds functionality to\n  * show hints and mark answers\n  */\n\nconst React = _react;\nconst ReactDOM = _reactDom;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst ItemRenderer = _itemRendererJsx;\nconst SimpleButton = _simpleButtonJsx;\n\nconst defaultQuestion = {\n    question: {\n        content: \"\",\n        images: {},\n        widgets: {},\n    },\n    answerArea: {\n        calculator: false,\n    },\n    itemDataVersion: {\n        major: 0,\n        minor: 1,\n    },\n    hints: [],\n};\n\nconst RendererDemo = createReactClass({\n    propTypes: {\n        problemNum: PropTypes.number,\n        question: PropTypes.any.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            question: defaultQuestion,\n            problemNum: 1,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            // Matches ItemRenderer.showInput\n            answer: {empty: true, correct: null},\n            scratchpadEnabled: true,\n            isMobile: navigator.userAgent.indexOf(\"Mobile\") !== -1,\n        };\n    },\n\n    componentDidMount: function() {\n        ReactDOM.findDOMNode(this.refs.itemRenderer).focus();\n\n        window.addEventListener(\"resize\", this._handleResize);\n    },\n\n    componentWillUnmount: function() {\n        window.removeEventListener(\"resize\", this._handleResize);\n    },\n\n    onScore: function() {\n        console.log(this.refs.itemRenderer.scoreInput()); // eslint-disable-line no-console\n    },\n\n    checkAnswer: function() {\n        this.refs.itemRenderer.showRationalesForCurrentlySelectedChoices();\n        this.setState(\n            {\n                answer: this.refs.itemRenderer.scoreInput(),\n            },\n            () => {\n                this.refs.itemRenderer.deselectIncorrectSelectedChoices();\n            }\n        );\n    },\n\n    takeHint: function() {\n        this.refs.itemRenderer.showHint();\n    },\n\n    _handleResize() {\n        const isMobile = navigator.userAgent.indexOf(\"Mobile\") !== -1;\n        if (this.state.isMobile !== isMobile) {\n            this.setState({isMobile});\n        }\n    },\n\n    render: function() {\n        const {isMobile} = this.state;\n\n        const apiOptions = {\n            getAnotherHint: () => {\n                this.refs.itemRenderer.showHint();\n            },\n            isMobile,\n            customKeypad: isMobile,\n            setDrawingAreaAvailable: enabled => {\n                this.setState({\n                    scratchpadEnabled: enabled,\n                });\n            },\n            styling: {\n                radioStyleVersion: \"final\",\n            },\n        };\n\n        const answer = this.state.answer;\n\n        const rendererComponent = (\n            <ItemRenderer\n                item={this.props.question}\n                ref=\"itemRenderer\"\n                problemNum={this.props.problemNum}\n                initialHintsVisible={0}\n                apiOptions={apiOptions}\n                reviewMode={answer.correct}\n            />\n        );\n\n        const showSmiley = !answer.empty && answer.correct;\n        const answerButton = (\n            <div>\n                <SimpleButton\n                    color={answer.empty || answer.correct ? \"green\" : \"orange\"}\n                    onClick={this.checkAnswer}\n                >\n                    {answer.empty\n                        ? \"Check Answer\"\n                        : answer.correct ? \"Correct!\" : \"Incorrect, try again.\"}\n                </SimpleButton>\n                <img\n                    className={css(\n                        styles.smiley,\n                        !showSmiley && styles.hideSmiley\n                    )}\n                    src=\"/images/face-smiley.png\"\n                />\n            </div>\n        );\n\n        const scratchpadEnabled = this.state.scratchpadEnabled;\n\n        if (isMobile) {\n            const className = \"framework-perseus \" + ApiClassNames.MOBILE;\n            return (\n                <div className={className}>\n                    <div className={css(styles.problemAndAnswer)}>\n                        {rendererComponent}\n                        <div id=\"problem-area\">\n                            <div id=\"workarea\" style={{marginLeft: 0}} />\n                            <div id=\"hintsarea\" />\n                        </div>\n                    </div>\n                </div>\n            );\n        } else {\n            return (\n                <div className=\"renderer-demo framework-perseus\">\n                    <div className={css(styles.problemAndAnswer)}>\n                        <div id=\"problem-area\">\n                            <div id=\"workarea\" />\n                            <div id=\"hintsarea\" />\n                        </div>\n                        <div className={css(styles.answerAreaWrap)}>\n                            <div id=\"answer-area\">\n                                <div className={css(styles.infoBox)}>\n                                    <div id=\"solutionarea\" />\n                                    <div className={css(styles.answerButtons)}>\n                                        {answerButton}\n                                    </div>\n                                </div>\n                                <div className={css(styles.infoBox)}>\n                                    <SimpleButton\n                                        color={\"orange\"}\n                                        onClick={this.takeHint}\n                                    >\n                                        Hint\n                                    </SimpleButton>\n                                </div>\n                            </div>\n                        </div>\n                        <div style={{clear: \"both\"}} />\n                    </div>\n                    <div className=\"extras\" style={{margin: 20}}>\n                        <button onClick={this.onScore}>Score</button>\n                        <span style={{marginLeft: 15}}>\n                            Scratchpad\n                            {scratchpadEnabled ? \"\" : \"not \"}\n                            available\n                        </span>\n                    </div>\n                    {rendererComponent}\n                </div>\n            );\n        }\n    },\n});\n\nconst styles = StyleSheet.create({\n    problemAndAnswer: {\n        minHeight: 180,\n        position: \"relative\",\n    },\n    smiley: {\n        width: 28,\n        position: \"absolute\",\n        top: 7,\n        left: 5,\n        cursor: \"pointer\",\n    },\n    hideSmiley: {\n        display: \"none\",\n    },\n    answerAreaWrap: {\n        margin: \"0px -8px 0 0\",\n        position: \"absolute\",\n        bottom: 0,\n        right: 0,\n        width: 80,\n        zIndex: 10000,\n    },\n    answerButtons: {\n        margin: \"0 -10px\",\n        padding: \"10px 10px 0\",\n        position: \"relative\",\n    },\n    infoBox: {\n        background: \"#eee\",\n        border: \"1px solid #aaa\",\n        color: \"#333\",\n        marginBottom: 10,\n        padding: 10,\n        position: \"relative\",\n        zIndex: 10,\n        boxShadow: \"0 1px 2px #ccc\",\n        overflow: \"visible\",\n        \":before\": {\n            content: '\" \"',\n            borderRight: \"8px solid transparent\",\n            borderBottom: \"8px solid #cccccc\",\n            height: 16,\n            position: \"absolute\",\n            right: -1,\n            top: -24,\n        },\n    },\n});\n\n_module_.exports = RendererDemo;\nexport default _module_.exports;\n","import _widgetsJs from \"./widgets.js\";\nimport _interactive2Objective_Js from \"./interactive2/objective_.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\n/**\n * Traverses a {content, widgets, images} renderer props object,\n * such as `itemData.question`\n *\n * This traversal is deep and handles some widget prop upgrades\n * (TODO(aria): Handle minor prop upgrades :) )\n *\n * This is the right way to traverse itemData.\n *\n * NOTE: We should not expose this on the perseus API yet. Instead,\n * build the traversal method you want inside perseus, and use this\n * from that. We might eventually expose this, but I'd like to be\n * more confident in the interface provided first.\n */\n\nvar _ = _underscore;\n// TODO(aria): Pull this out of interactive2 / replace with new _.mapObject\nvar objective_ = _interactive2Objective_Js;\n\nvar Widgets = _widgetsJs;\n\nvar noop = function() {};\n\nvar deepCallbackFor = function(contentCallback, widgetCallback, optionsCallback) {\n    var deepCallback = function(widgetInfo, widgetId) {\n        // This doesn't modify the widget info if the widget info\n        // is at a later version than is supported, which is important\n        // for our latestVersion test below.\n        var upgradedWidgetInfo = Widgets.upgradeWidgetInfoToLatestVersion(\n            widgetInfo\n        );\n        var latestVersion = Widgets.getVersion(upgradedWidgetInfo.type);\n\n        // Only traverse our children if we can understand this version\n        // of the widget props.\n        // TODO(aria): This will break if the traversal code assumes that\n        // any props that usually get defaulted in are present. That is,\n        // it can fail on minor version upgrades.\n        // For this reason, and because the upgrade code doesn't handle\n        // minor versions correctly (it doesn't report anything useful\n        // about what minor version a widget is actually at, since it\n        // doesn't have meaning in the context of upgrades), we\n        // just check the major version here.\n        // TODO(aria): This is seriously quirky and would be unpleasant\n        // to think about while writing traverseChildWidgets code. Please\n        // make all of this a little tighter.\n        // I think once we use react class defaultProps instead of relying\n        // on getDefaultProps, this will become easier.\n        var newWidgetInfo;\n        if (\n            latestVersion &&\n            upgradedWidgetInfo.version.major === latestVersion.major\n        ) {\n            newWidgetInfo = Widgets.traverseChildWidgets(\n                upgradedWidgetInfo,\n                rendererOptions => {\n                    return traverseRenderer(\n                        rendererOptions,\n                        contentCallback,\n                        // so that we traverse grandchildren, too:\n                        deepCallback,\n                        optionsCallback\n                    );\n                }\n            );\n        } else {\n            newWidgetInfo = upgradedWidgetInfo;\n        }\n\n        var userWidgetInfo = widgetCallback(newWidgetInfo, widgetId);\n        if (userWidgetInfo !== undefined) {\n            return userWidgetInfo;\n        } else {\n            return newWidgetInfo;\n        }\n    };\n    return deepCallback;\n};\n\nvar traverseRenderer = function(rendererOptions, contentCallback, deepWidgetCallback, optionsCallback) {\n    var newContent = rendererOptions.content;\n    if (rendererOptions.content != null) {\n        var modifiedContent = contentCallback(rendererOptions.content);\n        if (modifiedContent !== undefined) {\n            newContent = modifiedContent;\n        }\n    }\n\n    var newWidgets = objective_.mapObject(\n        rendererOptions.widgets || {},\n        function(widgetInfo, widgetId) {\n            // Widgets without info or a type are empty widgets, and\n            // should always be renderable. It's also annoying to write\n            // checks for this everywhere, so we just filter them out once and\n            // for all!\n            if (widgetInfo == null || widgetInfo.type == null) {\n                return widgetInfo;\n            }\n            return deepWidgetCallback(widgetInfo, widgetId);\n        }\n    );\n\n    var newOptions = _.extend({}, rendererOptions, {\n        content: newContent,\n        widgets: newWidgets,\n    });\n    var userOptions = optionsCallback(newOptions);\n    if (userOptions !== undefined) {\n        return userOptions;\n    } else {\n        return newOptions;\n    }\n};\n\nvar traverseRendererDeep = function(rendererOptions, contentCallback, widgetCallback, optionsCallback) {\n    contentCallback = contentCallback || noop;\n    widgetCallback = widgetCallback || noop;\n    optionsCallback = optionsCallback || noop;\n\n    return traverseRenderer(\n        rendererOptions,\n        contentCallback,\n        deepCallbackFor(contentCallback, widgetCallback, optionsCallback),\n        optionsCallback\n    );\n};\n\n_module_.exports = {\n    traverseRendererDeep: traverseRendererDeep,\n};\nexport default _module_.exports;\n","import _widgetsJs from \"./widgets.js\";\nimport _traversalJsx from \"./traversal.jsx\";\nimport { findContentNodesInItem, inferItemShape } from \"./multi-items.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Calculates whether a perseus item is renderable by a specific\n * perseus-item-data version.\n *\n * This is done inside of the perseus repo so that it can traverse\n * widget-specific data that might need to do a sub-traversal.\n * This supports widgets that contain renderers, such as the\n * group or sequence widgets.\n */\n\nconst _ = _underscore;\n\nconst Traversal = _traversalJsx;\nconst Widgets = _widgetsJs;\n\nconst isUpgradedWidgetInfoRenderableBy = function(widgetInfo, widgetRendererVersion) {\n    if (widgetRendererVersion == null) {\n        // If the widget does not exist in this version, this will\n        // be null, and that version of perseus cannot render the\n        // widget (it doesn't even know the widget exists!)\n        return false;\n    }\n\n    const widgetVersion = widgetInfo.version || {major: 0, minor: 0};\n    if (widgetRendererVersion.major > widgetVersion.major) {\n        return true;\n    } else if (widgetRendererVersion.major < widgetVersion.major) {\n        return false;\n    } else {\n        // If the major versions are the same, the minor version acts\n        // like a tie-breaker.\n        // For example, input-number 3.2 can render an input-number\n        // 2.4, 3.0, or 3.2, but not an input number 3.3 or 4.0.\n        return widgetRendererVersion.minor >= widgetVersion.minor;\n    }\n};\n\nconst isRawWidgetInfoRenderableBy = function(widgetInfo, rendererContentVersion) {\n    // Empty/non-existant widgets are always safe to render\n    if (widgetInfo == null || widgetInfo.type == null) {\n        return true;\n    }\n\n    // NOTE: This doesn't modify the widget info if the widget info\n    // is at a later version than is supported.\n    const upgradedWidgetInfo = Widgets.upgradeWidgetInfoToLatestVersion(\n        widgetInfo\n    );\n    return isUpgradedWidgetInfoRenderableBy(\n        upgradedWidgetInfo,\n        rendererContentVersion[upgradedWidgetInfo.type]\n    );\n};\n\nconst isRendererContentRenderableBy = function(rendererOptions, rendererContentVersion) {\n    let isRenderable = true;\n    Traversal.traverseRendererDeep(rendererOptions, null, function(widgetInfo) {\n        isRenderable =\n            isRenderable &&\n            isRawWidgetInfoRenderableBy(widgetInfo, rendererContentVersion);\n    });\n    return isRenderable;\n};\n\nconst isItemRenderableBy = function(itemData, rendererContentVersion) {\n    if (itemData == null || rendererContentVersion == null) {\n        throw new Error(\"missing parameter to Perseus.isRenderable.item\");\n    }\n    if (itemData._multi) {\n        const shape = inferItemShape(itemData);\n\n        let isRenderable = true;\n        findContentNodesInItem(itemData, shape, node => {\n            const nodeIsRenderable = isRendererContentRenderableBy(\n                node,\n                rendererContentVersion\n            );\n            if (!nodeIsRenderable) {\n                isRenderable = false;\n            }\n        });\n        return isRenderable;\n    } else {\n        return isRendererContentRenderableBy(\n            itemData.question,\n            rendererContentVersion\n        );\n    }\n};\n\n_module_.exports = {\n    isItemRenderableByVersion: isItemRenderableBy,\n};\nexport default _module_.exports;\n","import _inlineIconJsx from \"./inline-icon.jsx\";\nimport { iconDesktop, iconMobilePhone, iconTablet } from \"../icon-paths.js\";\nimport { devices } from \"./constants.js\";\nimport _reactComponentsButtonGroupJsx from \"react-components/button-group.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * A component that displays controls for choosing a viewport size.\n * Renders three buttons: \"Phone\", \"Tablet\", and \"Desktop\".\n */\n\nconst React = _react;\n\nconst ButtonGroup = _reactComponentsButtonGroupJsx;\n\nconst InlineIcon = _inlineIconJsx;\n\nconst ViewportResizer = createReactClass({\n    propTypes: {\n        // The current device type that is selected.\n        deviceType: PropTypes.string.isRequired,\n        // A callback that is passed (width, height) as the dimensions of the\n        // viewport to resize to.\n        onViewportSizeChanged: PropTypes.func.isRequired,\n    },\n\n    handleChange: function(value) {\n        this.props.onViewportSizeChanged(value);\n    },\n\n    render: function() {\n        const phoneButtonContents = (\n            <span>\n                <InlineIcon {...iconMobilePhone} /> Phone\n            </span>\n        );\n        const tabletButtonContents = (\n            <span>\n                <InlineIcon {...iconTablet} /> Tablet\n            </span>\n        );\n        const desktopButtonContents = (\n            <span>\n                <InlineIcon {...iconDesktop} /> Desktop\n            </span>\n        );\n\n        // TODO(david): Allow input of custom viewport sizes.\n        return (\n            <span className=\"viewport-resizer\">\n                Viewport:{\" \"}\n                <ButtonGroup\n                    value={this.props.deviceType}\n                    allowEmpty={false}\n                    buttons={[\n                        {value: devices.PHONE, content: phoneButtonContents},\n                        {value: devices.TABLET, content: tabletButtonContents},\n                        {\n                            value: devices.DESKTOP,\n                            content: desktopButtonContents,\n                        },\n                    ]}\n                    onChange={this.handleChange}\n                />\n            </span>\n        );\n    },\n});\n\n_module_.exports = ViewportResizer;\nexport default _module_.exports;\n","import _componentsInfoTipJsx from \"./components/info-tip.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\n\nvar InfoTip = _componentsInfoTipJsx;\n\nvar ItemExtrasEditor = createReactClass({\n    propTypes: {\n        calculator: PropTypes.bool,\n        chi2Table: PropTypes.bool,\n        onChange: PropTypes.func.isRequired,\n        periodicTable: PropTypes.bool,\n        tTable: PropTypes.bool,\n        zTable: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            calculator: false,\n            chi2Table: false,\n            periodicTable: false,\n            tTable: false,\n            zTable: false,\n        };\n    },\n\n    serialize: function() {\n        return {\n            calculator: this.props.calculator,\n            chi2Table: this.props.chi2Table,\n            periodicTable: this.props.periodicTable,\n            tTable: this.props.tTable,\n            zTable: this.props.zTable,\n        };\n    },\n\n    render: function() {\n        return (\n            <div className=\"perseus-answer-editor\">\n                <div className=\"perseus-answer-options\">\n                    <div>\n                        <label>\n                            Show calculator:{\" \"}\n                            <input\n                                type=\"checkbox\"\n                                checked={this.props.calculator}\n                                onChange={e => {\n                                    this.props.onChange({\n                                        calculator: e.target.checked,\n                                    });\n                                }}\n                            />\n                        </label>\n                        <InfoTip>\n                            Use the calculator when completing difficult\n                            calculations is NOT the intent of the question.\n                            DONT use the calculator when testing the students\n                            ability to complete different types of computations.\n                        </InfoTip>\n                    </div>\n\n                    <div>\n                        <label>\n                            Show periodic table:{\" \"}\n                            <input\n                                type=\"checkbox\"\n                                checked={this.props.periodicTable}\n                                onChange={e => {\n                                    this.props.onChange({\n                                        periodicTable: e.target.checked,\n                                    });\n                                }}\n                            />\n                        </label>\n                        <InfoTip>\n                            This provides the student with the ability to view a\n                            periodic table of the elements, e.g., for answering\n                            chemistry questions.\n                        </InfoTip>\n                    </div>\n\n                    <div>\n                        <label>\n                            Show z table (statistics):{\" \"}\n                            <input\n                                type=\"checkbox\"\n                                checked={this.props.zTable}\n                                onChange={e => {\n                                    this.props.onChange({\n                                        zTable: e.target.checked,\n                                    });\n                                }}\n                            />\n                        </label>\n                        <InfoTip>\n                            This provides the student with the ability to view a\n                            table of critical values for the z distribution,\n                            e.g. for answering statistics questions.\n                        </InfoTip>\n                    </div>\n\n                    <div>\n                        <label>\n                            Show t table (statistics):{\" \"}\n                            <input\n                                type=\"checkbox\"\n                                checked={this.props.tTable}\n                                onChange={e => {\n                                    this.props.onChange({\n                                        tTable: e.target.checked,\n                                    });\n                                }}\n                            />\n                        </label>\n                        <InfoTip>\n                            This provides the student with the ability to view a\n                            table of critical values for the Student's t\n                            distribution, e.g. for answering statistics\n                            questions.\n                        </InfoTip>\n                    </div>\n\n                    <div>\n                        <label>\n                            Show chi-squared table (statistics):{\" \"}\n                            <input\n                                type=\"checkbox\"\n                                checked={this.props.chi2Table}\n                                onChange={e => {\n                                    this.props.onChange({\n                                        chi2Table: e.target.checked,\n                                    });\n                                }}\n                            />\n                        </label>\n                        <InfoTip>\n                            This provides the student with the ability to view a\n                            table of critical values for the chi-squared\n                            distribution, e.g. for answering statistics\n                            questions.\n                        </InfoTip>\n                    </div>\n                </div>\n            </div>\n        );\n    },\n});\n\n_module_.exports = ItemExtrasEditor;\nexport default _module_.exports;\n","import \"./lib/perseus-admin.css\";\nimport _iframeContentRendererJsx from \"./iframe-content-renderer.jsx\";\nimport _versionJson from \"./version.json\";\nimport _componentsDeviceFramerJsx from \"./components/device-framer.jsx\";\nimport _itemExtrasEditorJsx from \"./item-extras-editor.jsx\";\nimport Editor from \"./editor.jsx\";\nimport Renderer from \"./renderer.jsx\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, object-curly-spacing, react/prop-types, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar ApiOptions = _perseusApiJsx.Options;\nvar ItemExtrasEditor = _itemExtrasEditorJsx;\nvar DeviceFramer = _componentsDeviceFramerJsx;\nvar ITEM_DATA_VERSION = _versionJson.itemDataVersion;\nconst IframeContentRenderer = _iframeContentRendererJsx;\n\nvar ItemEditor = createReactClass({\n    propTypes: {\n        apiOptions: ApiOptions.propTypes,\n        deviceType: PropTypes.string,\n        frameSource: PropTypes.string.isRequired,\n        gradeMessage: PropTypes.string,\n        imageUploader: PropTypes.func,\n        wasAnswered: PropTypes.bool,\n    },\n\n    getDefaultProps: function() {\n        return {\n            onChange: () => {},\n            question: {},\n            answerArea: {},\n        };\n    },\n\n    // Notify the parent that the question or answer area has been updated.\n    updateProps: function(newProps, cb, silent) {\n        var props = _.pick(this.props, \"question\", \"answerArea\");\n\n      this.props.onChange(Object.assign({}, props, newProps), cb, silent);\n    },\n\n    render: function() {\n        const isMobile =\n            this.props.deviceType === \"phone\" ||\n            this.props.deviceType === \"tablet\";\n        return (\n            <div className=\"perseus-editor-table\">\n                <div className=\"perseus-editor-row perseus-question-container\">\n                    <div className=\"perseus-editor-left-cell\">\n                        <div className=\"pod-title\">Question</div>\n                        <Editor\n                            ref=\"questionEditor\"\n                            placeholder=\"Type your question here...\"\n                            className=\"perseus-question-editor\"\n                            imageUploader={this.props.imageUploader}\n                            onChange={this.handleEditorChange}\n                            apiOptions={this.props.apiOptions}\n                            showWordCount={true}\n                            {...this.props.question}\n                        />\n                    </div>\n\n                    <div className=\"perseus-editor-right-cell\">\n                        <div id=\"problemarea\">\n                            <Renderer\n                                ref=\"questionRenderer\"\n                                apiOptions={this.props.apiOptions}\n                                {...this.props.question}\n                            />\n                            {/*<DeviceFramer\n                                deviceType={this.props.deviceType}\n                                nochrome={true}\n                            >\n                                <IframeContentRenderer\n                                    ref=\"frame\"\n                                    key={this.props.deviceType}\n                                    content={this.props.frameSource}\n                                    datasetKey=\"mobile\"\n                                    datasetValue={isMobile}\n                                    seamless={true}\n                                />\n                            </DeviceFramer>*/}\n                            <div\n                                id=\"hintsarea\"\n                                className=\"hintsarea\"\n                                style={{display: \"none\"}}\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"perseus-editor-row perseus-answer-container\">\n                    <div className=\"perseus-editor-left-cell\">\n                        <div className=\"pod-title\">Question extras</div>\n                        <ItemExtrasEditor\n                            ref=\"itemExtrasEditor\"\n                            onChange={this.handleItemExtrasChange}\n                            {...this.props.answerArea}\n                        />\n                    </div>\n\n                    <div className=\"perseus-editor-right-cell\">\n                        <div id=\"answer_area\" />\n                    </div>\n                </div>\n            </div>\n        );\n    },\n\n    triggerPreviewUpdate: function(newData) {\n      // TODO(aria): remove this?\n      //this.refs.frame.sendNewData(newData);\n    },\n\n    handleEditorChange: function(newProps, cb, silent) {\n        var question = _.extend({}, this.props.question, newProps);\n        this.updateProps({question}, cb, silent);\n    },\n\n    handleItemExtrasChange: function(newProps, cb, silent) {\n        var answerArea = _.extend({}, this.props.answerArea, newProps);\n        this.updateProps({answerArea}, cb, silent);\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.questionEditor.getSaveWarnings();\n    },\n\n    serialize: function(options) {\n        return {\n            question: this.refs.questionEditor.serialize(options),\n            answerArea: this.refs.itemExtrasEditor.serialize(options),\n            itemDataVersion: ITEM_DATA_VERSION,\n        };\n    },\n\n    focus: function() {\n        this.questionEditor.focus();\n    },\n});\n\n_module_.exports = ItemEditor;\nexport default _module_.exports;\n","import _traversalJsx from \"../traversal.jsx\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar _ = _underscore;\n\nvar Traversal = _traversalJsx;\n\nvar findPassageRefR = new RegExp(\n    // [[ passage-ref 1]]\n    // capture 1: widget markdown\n    // capture 2: widgetId\n    \"(\\\\[\\\\[\\u2603 (passage-ref [0-9]+)\\\\]\\\\])\" +\n        // spaces between the ref and the summary\n        \"\\\\s\" +\n        // opening paren + quote\n        '\\\\([\"\\u201C]' +\n        // summary of passage reference text\n        // capture 3: summaryText\n        \"([\\\\s\\\\S]*)\" +\n        // closing quote + paren\n        '[\"\\u201D]\\\\)',\n    \"g\"\n);\n\nvar fixWholeOptions = options => {\n    // This parsing is technically illegal and should be done via\n    // PerseusMarkdown, but because of the snowperson it's safe\n    // in practice.\n    // We should probably just get rid of this code once all the\n    // passage-refs have been converted.\n\n    var newWidgets = _.clone(options.widgets || {});\n    var newContent = (options.content || \"\")\n        .replace(\n            findPassageRefR,\n            (passageRefText, widgetMarkdown, widgetId, summaryText) => {\n                newWidgets[widgetId] = _.extend({}, newWidgets[widgetId], {\n                    options: _.extend({}, newWidgets[widgetId].options, {\n                        summaryText: summaryText,\n                    }),\n                });\n\n                return widgetMarkdown;\n            }\n        );\n\n    return _.extend({}, options, {\n        content: newContent,\n        widgets: newWidgets,\n    });\n};\n\nvar findRadioRefsR = new RegExp(\n    // passage-ref notation\n    \"\\\\{\\\\{(passage-ref \\\\d+ \\\\d+)}}\" +\n        // a space\n        \"\\\\s+\" +\n        // (\"\n        '\\\\([\"\\\\u201C]' +\n        // <capture the content>\n        '([^\"]*)' +\n        // \")\n        '[\"\\\\u201D]\\\\)',\n    // find all passage-refs\n    \"g\"\n);\nvar replaceRadioRefs = (fullText, reference, summaryText) => {\n    if (/\\n\\n/.test(summaryText)) {\n        return fullText;\n    }\n    return \"{{\" + reference + ' \"' + summaryText + '\"}}';\n};\n\nvar fixRadioWidget = widgetInfo => {\n    if (\n        widgetInfo.type !== \"radio\" ||\n        !widgetInfo.options ||\n        !widgetInfo.options.choices\n    ) {\n        return widgetInfo;\n    }\n\n    var newChoices = _.map(widgetInfo.options.choices, choice => {\n        if (!choice.content) {\n            return choice;\n        }\n\n        var newChoice = choice.content.replace(\n            findRadioRefsR,\n            replaceRadioRefs\n        );\n        return _.extend({}, choice, {\n            content: newChoice,\n        });\n    });\n\n    return _.extend({}, widgetInfo, {\n        options: _.extend({}, widgetInfo.options, {\n            choices: newChoices,\n        }),\n    });\n};\n\nvar fixRendererPassageRefs = options => {\n    return Traversal.traverseRendererDeep(\n        options,\n        null,\n        fixRadioWidget,\n        fixWholeOptions\n    );\n};\n\nvar FixPassageRefs = itemData => {\n    if (itemData._multi) {\n        // We're in a multi-item. Don't do anything, just return the original\n        // item data.\n        return itemData;\n    }\n\n    var newQuestion = fixRendererPassageRefs(itemData.question);\n    var newHints = _.map(itemData.hints, hint => fixRendererPassageRefs(hint));\n    return _.extend({}, itemData, {\n        question: newQuestion,\n        hints: newHints,\n    });\n};\n\n_module_.exports = FixPassageRefs;\nexport default _module_.exports;\n","import _componentsHudJsx from \"./components/hud.jsx\";\nimport _componentsViewportResizerJsx from \"./components/viewport-resizer.jsx\";\nimport _jsonEditorJsx from \"./json-editor.jsx\";\nimport _itemEditorJsx from \"./item-editor.jsx\";\nimport _utilFixPassageRefsJsx from \"./util/fix-passage-refs.jsx\";\nimport _hintEditorJsx from \"./hint-editor.jsx\";\nimport _mixinsApiOptionsPropsJs from \"./mixins/api-options-props.js\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable no-var, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nconst ApiClassNames = _perseusApiJsx.ClassNames;\nconst ApiOptionsProps = _mixinsApiOptionsPropsJs;\nvar CombinedHintsEditor = _hintEditorJsx;\nvar FixPassageRefs = _utilFixPassageRefsJsx;\nvar ItemEditor = _itemEditorJsx;\nvar JsonEditor = _jsonEditorJsx;\nvar ViewportResizer = _componentsViewportResizerJsx;\nconst HUD = _componentsHudJsx;\n\nvar EditorPage = createReactClass({\n    propTypes: {\n        ...ApiOptionsProps.propTypes,\n\n        answerArea: PropTypes.any, // related to the question\n\n        developerMode: PropTypes.bool,\n\n        // Source HTML for the iframe to render\n        frameSource: PropTypes.string.isRequired,\n\n        hints: PropTypes.any, // related to the question\n\n        // A function which takes a file object (guaranteed to be an image) and\n        // a callback, then calls the callback with the url where the image\n        // will be hosted. Image drag and drop is disabled when imageUploader\n        // is null.\n        imageUploader: PropTypes.func,\n\n        // Part of the question\n        itemDataVersion: PropTypes.shape({\n            major: PropTypes.number,\n            minor: PropTypes.number,\n        }),\n\n        // Whether the question is displaying as JSON or if it is\n        // showing the editor itself with the rendering\n        jsonMode: PropTypes.bool,\n\n        // A function which is called with the new JSON blob of content\n        onChange: PropTypes.func,\n\n        onPreviewDeviceChange: PropTypes.func,\n        previewDevice: PropTypes.string,\n\n        // Initial value of the question being edited\n        question: PropTypes.any,\n    },\n\n    getDefaultProps: function() {\n        return {\n            developerMode: false,\n            jsonMode: false,\n            onChange: () => {},\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            json: _.pick(\n                this.props,\n                \"question\",\n                \"answerArea\",\n                \"hints\",\n                \"itemDataVersion\"\n            ),\n            gradeMessage: \"\",\n            wasAnswered: false,\n            highlightLint: true,\n        };\n    },\n\n    handleCheckAnswer: function() {\n        var result = this.scorePreview();\n        this.setState({\n            gradeMessage: result.message,\n            wasAnswered: result.correct,\n        });\n    },\n\n    toggleJsonMode: function() {\n        this.setState(\n            {\n                json: this.serialize({keepDeletedWidgets: true}),\n            },\n            function() {\n                this.props.onChange({\n                    jsonMode: !this.props.jsonMode,\n                });\n            }\n        );\n    },\n\n    componentDidMount: function() {\n        this.rendererMountNode = document.createElement(\"div\");\n        this.updateRenderer();\n    },\n\n    componentDidUpdate: function() {\n        this.updateRenderer();\n    },\n\n    updateRenderer: function() {\n        // Some widgets (namely the image widget) like to call onChange before\n        // anything has actually been mounted, which causes problems here. We\n        // just ensure don't update until we've mounted\n        const hasEditor = !this.props.developerMode || !this.props.jsonMode;\n        if (!this.isMounted() || !hasEditor) {\n            return;\n        }\n\n        const touch =\n            this.props.previewDevice === \"phone\" ||\n            this.props.previewDevice === \"tablet\";\n        const deviceBasedApiOptions = Object.assign(this.getApiOptions(), {\n            customKeypad: touch,\n            isMobile: touch,\n        });\n\n        this.refs.itemEditor.triggerPreviewUpdate({\n            type: \"question\",\n            data: Object.assign({\n                item: this.serialize(),\n                apiOptions: deviceBasedApiOptions,\n                initialHintsVisible: 0,\n                device: this.props.previewDevice,\n                linterContext: {\n                    contentType: \"exercise\",\n                    highlightLint: this.state.highlightLint,\n                    paths: this.props.contentPaths,\n                },\n                reviewMode: true,\n                legacyPerseusLint: this.refs.itemEditor.getSaveWarnings(),\n            },\n                _.pick(this.props,\n                    \"workAreaSelector\",\n                    \"solutionAreaSelector\",\n                    \"hintsAreaSelector\",\n                    \"problemNum\"\n                )\n            ),\n        });\n    },\n\n    getApiOptions() {\n        return ApiOptionsProps.getApiOptions.call(this);\n    },\n\n    handleChange: function(toChange, cb, silent) {\n        var newProps = _.pick(this.props, \"question\", \"hints\", \"answerArea\");\n        _.extend(newProps, toChange);\n        this.props.onChange(newProps, cb, silent);\n    },\n\n    changeJSON: function(newJson) {\n        this.setState({\n            json: newJson,\n        });\n        this.props.onChange(newJson);\n    },\n\n    _fixPassageRefs: function() {\n        var itemData = this.serialize();\n        var newItemData = FixPassageRefs(itemData);\n        this.setState({\n            json: newItemData,\n        });\n        this.props.onChange(newItemData);\n    },\n\n    scorePreview: function() {\n        if (this.renderer) {\n            return this.renderer.scoreInput();\n        } else {\n            return null;\n        }\n    },\n\n    render: function() {\n        let className = \"framework-perseus\";\n\n        const touch =\n            this.props.previewDevice === \"phone\" ||\n            this.props.previewDevice === \"tablet\";\n        const deviceBasedApiOptions = Object.assign(this.getApiOptions(), {\n            customKeypad: touch,\n            isMobile: touch,\n        });\n\n        if (deviceBasedApiOptions.isMobile) {\n            className += \" \" + ApiClassNames.MOBILE;\n        }\n\n        return (\n            <div id=\"perseus\" className={className}>\n                <div style={{marginBottom: 10}}>\n                    {this.props.developerMode &&\n                        <span>\n                            <label>\n                                {\" \"}Developer JSON Mode:{\" \"}\n                                <input\n                                    type=\"checkbox\"\n                                    checked={this.props.jsonMode}\n                                    onChange={this.toggleJsonMode}\n                                />\n                            </label>{\" \"}\n                            <button\n                                type=\"button\"\n                                onClick={this._fixPassageRefs}\n                            >\n                                Fix passage-refs\n                            </button>{\" \"}\n                        </span>}\n\n                    {!this.props.jsonMode &&\n                        <ViewportResizer\n                            deviceType={this.props.previewDevice}\n                            onViewportSizeChanged={\n                                this.props.onPreviewDeviceChange\n                            }\n                        />}\n\n                    {!this.props.jsonMode &&\n                        <HUD\n                            message=\"Style warnings\"\n                            enabled={this.state.highlightLint}\n                            onClick={() => {\n                                this.setState({\n                                    highlightLint: !this.state.highlightLint,\n                                });\n                            }}\n                        />}\n                </div>\n\n                {this.props.developerMode &&\n                    this.props.jsonMode &&\n                    <div>\n                        <JsonEditor\n                            multiLine={true}\n                            value={this.state.json}\n                            onChange={this.changeJSON}\n                        />\n                    </div>}\n\n                {(!this.props.developerMode || !this.props.jsonMode) &&\n                    <ItemEditor\n                        ref=\"itemEditor\"\n                        rendererOnly={this.props.jsonMode}\n                        question={this.props.question}\n                        answerArea={this.props.answerArea}\n                        imageUploader={this.props.imageUploader}\n                        onChange={this.handleChange}\n                        wasAnswered={this.state.wasAnswered}\n                        gradeMessage={this.state.gradeMessage}\n                        onCheckAnswer={this.handleCheckAnswer}\n                        deviceType={this.props.previewDevice}\n                        apiOptions={deviceBasedApiOptions}\n                        frameSource={this.props.frameSource}\n                    />}\n\n                {(!this.props.developerMode || !this.props.jsonMode) &&\n                    <CombinedHintsEditor\n                        ref=\"hintsEditor\"\n                        hints={this.props.hints}\n                        imageUploader={this.props.imageUploader}\n                        onChange={this.handleChange}\n                        deviceType={this.props.previewDevice}\n                        apiOptions={deviceBasedApiOptions}\n                        frameSource={this.props.frameSource}\n                        highlightLint={this.state.highlightLint}\n                    />}\n            </div>\n        );\n    },\n\n    getSaveWarnings: function() {\n        var issues1 = this.refs.itemEditor.getSaveWarnings();\n        var issues2 = this.refs.hintsEditor.getSaveWarnings();\n        return issues1.concat(issues2);\n    },\n\n    serialize: function(options) {\n        if (this.props.jsonMode) {\n            return this.state.json;\n        } else {\n            return _.extend(this.refs.itemEditor.serialize(options), {\n                hints: this.refs.hintsEditor.serialize(options),\n            });\n        }\n    },\n});\n\n_module_.exports = EditorPage;\nexport default _module_.exports;\n","import _editorPageJsx from \"./editor-page.jsx\";\nimport _underscore from \"underscore\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/* eslint-disable comma-dangle, no-var, react/sort-comp */\n/* TODO(csilvers): fix these lint errors (http://eslint.org/docs/rules): */\n/* To fix, remove an entry above, run ka-lint, and fix errors. */\n\nvar React = _react;\nvar _ = _underscore;\n\nvar EditorPage = _editorPageJsx;\n\n/* Renders an EditorPage (or an ArticleEditor) as a non-controlled component.\n *\n * Normally the parent of EditorPage must pass it an onChange callback and then\n * respond to any changes by modifying the EditorPage props to reflect those\n * changes. With StatefulEditorPage changes are stored in state so you can\n * query them with serialize.\n */\nvar StatefulEditorPage = createReactClass({\n    propTypes: {\n        componentClass: PropTypes.func,\n    },\n\n    getDefaultProps: function() {\n        return {\n            componentClass: EditorPage,\n        };\n    },\n\n    render: function() {\n        return <this.props.componentClass {...this.state} />;\n    },\n\n    getInitialState: function() {\n        return _.extend({}, _.omit(this.props, \"componentClass\"), {\n            onChange: this.handleChange,\n            ref: \"editor\",\n        });\n    },\n\n    // getInitialState isn't called if the react component is re-rendered\n    // in-place on the dom, in which case this is called instead, so we\n    // need to update the state here.\n    // (This component is currently re-rendered by the \"Add image\" button.)\n    componentWillReceiveProps: function(nextProps) {\n        this.setState(\n            _.pick(nextProps,\n                \"apiOptions\",\n                \"imageUploader\",\n                \"developerMode\",\n                \"problemNum\",\n                \"previewDevice\",\n                \"frameSource\"\n            )\n        );\n    },\n\n    getSaveWarnings: function() {\n        return this.refs.editor.getSaveWarnings();\n    },\n\n    serialize: function() {\n        return this.refs.editor.serialize();\n    },\n\n    handleChange: function(newState, cb) {\n        if (this.isMounted()) {\n            this.setState(newState, cb);\n        }\n    },\n\n    scorePreview: function() {\n        return this.refs.editor.scorePreview();\n    },\n});\n\n_module_.exports = StatefulEditorPage;\nexport default _module_.exports;\n","import _renderabilityJsx from \"./renderability.jsx\";\nimport _utilJs from \"./util.js\";\nimport _editorPageJsx from \"./editor-page.jsx\";\nimport _statefulEditorPageJsx from \"./stateful-editor-page.jsx\";\nimport _react from \"react\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n  * Demonstrates the main Perseus editor\n  *\n  * This is ran by demo-perseus.js and handles adding debugger\n  * buttons and their event listeners above a StatefulEditorPage\n  */\n\nconst React = _react;\nconst StatefulEditorPage = _statefulEditorPageJsx;\nconst EditorPage = _editorPageJsx;\nconst Util = _utilJs;\nconst Renderability = _renderabilityJsx;\n\nconst defaultQuestion = {\n    question: {\n        content: \"\",\n        images: {},\n        widgets: {},\n    },\n    answerArea: {\n        calculator: false,\n    },\n    itemDataVersion: {\n        major: 0,\n        minor: 1,\n    },\n    hints: [],\n};\n\nconst EditorDemo = createReactClass({\n    propTypes: {\n        problemNum: PropTypes.number,\n        question: PropTypes.any.isRequired,\n    },\n\n    getDefaultProps: function() {\n        return {\n            question: defaultQuestion,\n            problemNum: 1,\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            deviceType: \"desktop\",\n            scratchpadEnabled: true,\n        };\n    },\n\n    componentDidMount: function() {\n        // Hacks to make debugging nicer\n        window.editorPage = this.refs.editor.refs.editor;\n        window.itemRenderer = window.editorPage.renderer;\n    },\n\n    serialize: function() {\n        console.log(JSON.stringify(this.refs.editor.serialize(), null, 4)); // eslint-disable-line no-console\n    },\n\n    scorePreview: function() {\n        console.log(this.refs.editor.scorePreview()); // eslint-disable-line no-console\n    },\n\n    _getContentHash: function() {\n        return Util.strongEncodeURIComponent(\n            JSON.stringify(this.refs.editor.serialize())\n        );\n    },\n\n    permalink: function(e) {\n        window.location.hash = `content=${this._getContentHash()}`;\n        e.preventDefault();\n    },\n\n    viewRendered: function(e) {\n        const link = document.createElement(\"a\");\n        link.href =\n            window.location.pathname +\n            `?renderer#content=${this._getContentHash()}`;\n        link.target = \"_blank\";\n        link.click();\n        e.preventDefault();\n    },\n\n    inputVersion: function(e) {\n        e.preventDefault();\n        // print whether or not this item consists only of\n        // input-numbers and numeric-inputs.\n        // just for versioning testing\n        console.log( // eslint-disable-line no-console\n            Renderability.isItemRenderableByVersion(\n                this.refs.editor.serialize(),\n                {\n                    \"::renderer::\": {major: 100, minor: 0},\n                    group: {major: 100, minor: 0},\n                    sequence: {major: 100, minor: 0},\n                    \"input-number\": {major: 100, minor: 0},\n                    \"numeric-input\": {major: 100, minor: 0},\n                }\n            )\n        );\n    },\n\n    saveWarnings: function(e) {\n        e.preventDefault();\n        console.log(this.refs.editor.getSaveWarnings()); // eslint-disable-line no-console\n    },\n\n    getEditorProps() {\n        const {deviceType} = this.state;\n        const isMobile = deviceType === \"phone\" || deviceType === \"tablet\";\n\n        return {\n            ...this.props.question,\n            problemNum: this.props.problemNum,\n            developerMode: true,\n            imageUploader: function(image, callback) {\n                setTimeout(\n                    callback,\n                    1000,\n                    \"https://cdn.kastatic.org/images/khan-logo-vertical-transparent.png\"\n                ); // eslint-disable-line max-len\n            },\n            apiOptions: {\n                onFocusChange: function(newPath, oldPath) {\n                    console.log(\"onFocusChange\", newPath, oldPath); // eslint-disable-line no-console\n                },\n                customKeypad: isMobile,\n                isMobile,\n                setDrawingAreaAvailable: enabled => {\n                    this.setState({\n                        scratchpadEnabled: enabled,\n                    });\n                },\n            },\n            componentClass: EditorPage,\n            onPreviewDeviceChange: deviceType => {\n                this.setState({deviceType});\n            },\n            previewDevice: deviceType,\n            /* eslint-disable max-len */\n            frameSource: `<!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset=\"utf-8\">\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0\">\n\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/local-only/khan-site.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/local-only/khan-exercise.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/katex/katex.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/font-awesome.min.css\">\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/mathquill/mathquill.css\" />\n                    <link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/perseus-admin-package/devices.min.css\" />\n\n                    <link rel=\"stylesheet/less\" type=\"text/css\" href=\"stylesheets/exercise-content-package/perseus.less\" />\n                    <link rel=\"stylesheet/less\" type=\"text/css\" href=\"stylesheets/perseus-admin-package/editor.less\" />\n                    <style>\n                        body {\n                            min-width: 0 !important;\n                            /* overrides body { min-width: 1000px; } in khan-site.css */\n\n                            overflow: hidden;\n                        }\n                    </style>\n\n                    <script>less = {env: 'development', logLevel: 1};</script>\n                    <script src=\"lib/less.js\"></script>\n                </head>\n                <body>\n                    <div id=\"content-container\">\n                    </div>\n                    <script src=\"lib/babel-polyfills.min.js\"></script>\n                    <script src=\"lib/jquery.js\"></script>\n                    <script src=\"lib/underscore.js\"></script>\n                    <script src=\"lib/react-with-addons.js\"></script>\n                    <script src=\"lib/mathjax/2.1/MathJax.js?config=KAthJax-730d56e87e9c926b91584f6030314815&amp;delayStartupUntil=configured\"></script>\n                    <script src=\"lib/katex/katex.js\"></script>\n                    <script src=\"lib/mathquill/mathquill-basic.js\"></script>\n                    <script src=\"lib/kas.js\"></script>\n                    <script src=\"lib/i18n.js\"></script>\n                    <script src=\"lib/jquery.qtip.js\"></script>\n                    <script src=\"build/frame-perseus.js\"></script>\n                </body>\n            </html>`,\n            /* eslint-enable max-len */\n        };\n    },\n\n    render: function() {\n        const editorProps = this.getEditorProps();\n\n        return (\n            <div id=\"perseus-index\">\n                <div className=\"extras\">\n                    <button onClick={this.serialize}>serialize</button>{\" \"}\n                    <button onClick={this.scorePreview}>score</button>{\" \"}\n                    <button onClick={this.permalink}>permalink</button>{\" \"}\n                    <button onClick={this.viewRendered}>\n                        view rendered\n                    </button>{\" \"}\n                    <button onClick={this.inputVersion}>\n                        contains only inputs?\n                    </button>{\" \"}\n                    <button onClick={this.saveWarnings}>\n                        save warnings\n                    </button>{\" \"}\n                    <span>Seed:{this.props.problemNum} </span>{\" \"}\n                    <span>\n                        Scratchpad:{this.state.scratchpadEnabled\n                            ? \"enabled\"\n                            : \"disabled\"}\n                    </span>\n                </div>\n                <StatefulEditorPage\n                    key={this.props.question}\n                    ref=\"editor\"\n                    {...editorProps}\n                />\n            </div>\n        );\n    },\n});\n\n_module_.exports = EditorDemo;\nexport default _module_.exports;\n","import _perseusMarkdownJsx from \"./perseus-markdown.jsx\";\nimport _traversalJsx from \"./traversal.jsx\";\nimport { findContentNodesInItem, findHintNodesInItem, inferItemShape } from \"./multi-items.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Functions for extracting data from items for use in i18n.\n */\nconst _ = _underscore;\n\nconst traversal = _traversalJsx;\nconst PerseusMarkdown = _perseusMarkdownJsx;\n\n// Takes a renderer content and parses the markdown for images\nfunction findImagesInContent(content, images) {\n    const parsed = PerseusMarkdown.parse(content);\n\n    PerseusMarkdown.traverseContent(parsed, function(node) {\n        if (node.type === \"image\") {\n            images.push(node.target);\n        }\n    });\n}\n\n// Background images in some widgets are annoying to deal with because\n// sometimes the objects aren't full when there isn't an image. So, we do some\n// extra checking to make sure we don't cause an error or push an empty image.\nfunction handleBackgroundImage(graph, images) {\n    if (graph && graph.backgroundImage && graph.backgroundImage.url) {\n        images.push(graph.backgroundImage.url);\n    }\n}\n\n// The callback called for each widget. We check each of the areas of each\n// widget where they contain a renderer for images by calling\n// findImagesInContent. We don't have to recurse through child widgets, because\n// traverseRendererDeep does that for us.\nfunction widgetCallback(widgetInfo, images) {\n    if (!widgetInfo.options) {\n        return;\n    }\n\n    // TODO(emily/aria): Move this into the widget files, so we don't have the\n    // logic out here.\n    if (widgetInfo.type === \"categorizer\") {\n        _.each(widgetInfo.options.items, function(item) {\n            findImagesInContent(item, images);\n        });\n        _.each(widgetInfo.options.categories, function(category) {\n            findImagesInContent(category, images);\n        });\n    } else if (widgetInfo.type === \"image\") {\n        findImagesInContent(widgetInfo.options.title, images);\n        findImagesInContent(widgetInfo.options.caption, images);\n    } else if (widgetInfo.type === \"matcher\") {\n        _.each(widgetInfo.options.left, function(option) {\n            findImagesInContent(option, images);\n        });\n        _.each(widgetInfo.options.right, function(option) {\n            findImagesInContent(option, images);\n        });\n        _.each(widgetInfo.options.labels, function(label) {\n            findImagesInContent(label, images);\n        });\n    } else if (widgetInfo.type === \"matrix\") {\n        findImagesInContent(widgetInfo.options.prefix, images);\n        findImagesInContent(widgetInfo.options.suffix, images);\n    } else if (widgetInfo.type === \"orderer\") {\n        _.each(widgetInfo.options.options, function(option) {\n            findImagesInContent(option.content, images);\n        });\n    } else if (widgetInfo.type === \"passage\") {\n        findImagesInContent(widgetInfo.options.passageTitle, images);\n    } else if (widgetInfo.type === \"radio\") {\n        _.each(widgetInfo.options.choices, function(choice) {\n            findImagesInContent(choice.content, images);\n        });\n    } else if (widgetInfo.type === \"sorter\") {\n        _.each(widgetInfo.options.correct, function(option) {\n            findImagesInContent(option, images);\n        });\n    } else if (widgetInfo.type === \"table\") {\n        _.each(widgetInfo.options.headers, function(header) {\n            findImagesInContent(header, images);\n        });\n    }\n\n    if (widgetInfo.type === \"grapher\") {\n        handleBackgroundImage(widgetInfo.options.graph, images);\n    } else if (widgetInfo.type === \"image\") {\n        handleBackgroundImage(widgetInfo.options, images);\n    } else if (widgetInfo.type === \"interactive-graph\") {\n        handleBackgroundImage(widgetInfo.options, images);\n    } else if (widgetInfo.type === \"measurer\" && widgetInfo.options.image) {\n        images.push(widgetInfo.options.image.url);\n    } else if (widgetInfo.type === \"plotter\") {\n        images.push(widgetInfo.options.picUrl);\n    } else if (widgetInfo.type === \"transformer\") {\n        handleBackgroundImage(widgetInfo.options.graph, images);\n    }\n}\n\nfunction findImagesInRenderers(renderers) {\n    const images = [];\n\n    _.each(renderers, renderer => {\n        traversal.traverseRendererDeep(\n            renderer,\n            content => {\n                findImagesInContent(content, images);\n            },\n            widget => widgetCallback(widget, images)\n        );\n    });\n\n    return images;\n}\n\n// Calls findImagesInContent on all of the different content areas for\n// assessment items\nfunction findImagesInItemData(itemData) {\n    let renderers = [];\n    if (itemData._multi) {\n        const shape = inferItemShape(itemData);\n        findContentNodesInItem(itemData, shape, node => renderers.push(node));\n        findHintNodesInItem(itemData, shape, node => renderers.push(node));\n    } else {\n        renderers = [itemData.question, ...itemData.hints];\n    }\n    return findImagesInRenderers(renderers);\n}\n\n// Calls findImagesInContent on all of the different content areas for\n// articles\nfunction findImagesInArticles(perseusContent) {\n    return findImagesInRenderers(perseusContent);\n}\n\n_module_.exports = {\n    findImagesInArticles: findImagesInArticles,\n    findImagesInItemData: findImagesInItemData,\n};\nexport default _module_.exports;\n","import _widgetsJs from \"./widgets.js\";\nimport _traversalJsx from \"./traversal.jsx\";\nimport { findContentNodesInItem, inferItemShape } from \"./multi-items.js\";\nimport _underscore from \"underscore\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Identifies whether or not a given perseus item requires the use of a mouse\n * or screen, based on the widgets it contains.\n */\n\nconst _ = _underscore;\n\nconst Traversal = _traversalJsx;\nconst Widgets = _widgetsJs;\n\n// Iterate over a single Perseus renderer, mutating `widgets` by appending\n// violating widget types discovered in this item.\nfunction traverseRenderer(itemData, widgets) {\n    Traversal.traverseRendererDeep(itemData, null, function(info) {\n        if (info.type && !Widgets.isAccessible(info)) {\n            widgets.push(info.type);\n        }\n    });\n}\n\n_module_.exports = {\n    // Returns a list of widgets that cause a given perseus item to require\n    // the use of a screen or mouse.\n    //\n    // For now we'll just check the `accessible` field on each of the widgets\n    // in the item data, but in the future we may specify accessibility on\n    // each widget with higher granularity.\n    violatingWidgets: function(itemData) {\n        // TODO(jordan): Hints as well\n        const widgets = [];\n\n        if (itemData._multi) {\n            const shape = inferItemShape(itemData);\n            findContentNodesInItem(itemData, shape, content => traverseRenderer(content, widgets)\n            );\n        } else {\n            traverseRenderer(itemData.question, widgets);\n        }\n\n        // Uniquify the list of widgets (by type)\n        return _.uniq(widgets);\n    },\n};\nexport default _module_.exports;\n","import _versionJson from \"./version.json\";\nimport _widgetsJs from \"./widgets.js\";\nimport _allWidgetsJs from \"./all-widgets.js\";\n\nvar _module_ = {\n  exports: {}\n};\n\nvar exports = _module_.exports;\nconst allWidgets = _allWidgetsJs;\nconst Widgets = _widgetsJs;\nconst Version = _versionJson;\n\nWidgets.registerMany(allWidgets);\n\nconst ItemVersion = Widgets.getVersionVector();\nItemVersion[\"::renderer::\"] = Version.itemDataVersion;\n\n_module_.exports = ItemVersion;\nexport default _module_.exports;\n","import _jiptHackJsx from \"./jipt-hack.jsx\";\nimport _gorgonGorgonJs from \"./gorgon/gorgon.js\";\nimport _multirendererEditorJsx from \"./multirenderer-editor.jsx\";\nimport _iframeContentRendererJsx from \"./iframe-content-renderer.jsx\";\nimport _editorPageJsx from \"./editor-page.jsx\";\nimport _editorJsx from \"./editor.jsx\";\nimport _articleEditorJsx from \"./article-editor.jsx\";\nimport _i18nJsx from \"./i18n.jsx\";\nimport _a11yJs from \"./a11y.js\";\nimport _renderabilityJsx from \"./renderability.jsx\";\nimport _componentsDeviceFramerJsx from \"./components/device-framer.jsx\";\nimport _componentsViewportResizerJsx from \"./components/viewport-resizer.jsx\";\nimport _utilJs from \"./util.js\";\nimport _perseusApiJsx from \"./perseus-api.jsx\";\nimport _statefulEditorPageJsx from \"./stateful-editor-page.jsx\";\nimport _statefulArticleEditorJsx from \"./stateful-article-editor.jsx\";\nimport _diffsArticleDiffJsx from \"./diffs/article-diff.jsx\";\nimport _diffsItemDiffJsx from \"./diffs/item-diff.jsx\";\nimport _itemVersion from \"./item-version\";\nimport _perseusJs from \"./perseus.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\nconst Perseus = _perseusJs;\n\n_module_.exports = {\n    itemVersion: _itemVersion,\n    ItemDiff: _diffsItemDiffJsx,\n    ArticleDiff: _diffsArticleDiffJsx,\n    StatefulArticleEditor: _statefulArticleEditorJsx,\n    StatefulEditorPage: _statefulEditorPageJsx,\n    ClassNames: _perseusApiJsx.ClassNames,\n    Util: _utilJs,\n    ViewportResizer: _componentsViewportResizerJsx,\n    DeviceFramer: _componentsDeviceFramerJsx,\n    renderability: _renderabilityJsx,\n    accessibility: _a11yJs,\n    i18n: _i18nJsx,\n    ArticleEditor: _articleEditorJsx,\n    Editor: _editorJsx,\n    EditorPage: _editorPageJsx,\n    IframeContentRenderer: _iframeContentRendererJsx,\n    MultiRendererEditor: _multirendererEditorJsx,\n    Gorgon: _gorgonGorgonJs,\n    JiptHack: _jiptHackJsx,\n    ...Perseus,\n};\nexport default _module_.exports;\n","var _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Sets up the basic environment for running Perseus in.\n */\n\nwindow.icu = {\n    getDecimalFormatSymbols: function() {\n        return {\n            decimal_separator: \".\",\n            grouping_separator: \",\",\n            minus: \"-\",\n        };\n    },\n};\n\nwindow.KhanUtil = {\n    debugLog: function() {},\n    localeToFixed: function(num, precision) {\n        return num.toFixed(precision);\n    },\n};\n\nwindow.Exercises = {\n    localMode: true,\n\n    useKatex: true,\n    khanExercisesUrlBase: \"../\",\n\n    getCurrentFramework: function() {\n        return \"khan-exercises\";\n    },\n    PerseusBridge: {\n        cleanupProblem: function() {\n            return false;\n        },\n    },\n};\nexport default _module_.exports;\n","import ReactDOM from 'react-dom';\nimport * as Perseus from './perseus';\nimport Util from './util';\nimport _articleDiffDemoJsx from \"./article-diff-demo.jsx\";\nimport _itemDiffDemoJsx from \"./item-diff-demo.jsx\";\nimport _multirendererDemoJsx from \"./multirenderer-demo.jsx\";\nimport _articleDemoJsx from \"./article-demo.jsx\";\nimport _rendererDemoJsx from \"./renderer-demo.jsx\";\nimport _editorDemoJsx from \"./editor-demo.jsx\";\nimport _editorPerseusJs from \"./editor-perseus.js\";\nimport _perseusEnvJs from \"./perseus-env.js\";\n\nvar _module_ = {\n    exports: {}\n};\n\nvar exports = _module_.exports;\n/**\n * Loads the Perseus demo pages\n *\n * This file initializes the Khan globals and mounts Demo pages\n * to demonstrate and develop the Perseus application\n */\n\n_perseusEnvJs;\n\nwindow.Khan = {\n    Util: KhanUtil,\n    error: function() {},\n    query: {debug: \"\"},\n    imageBase: \"/images/\",\n};\n\nconst EditorDemo = _editorDemoJsx;\nconst RendererDemo = _rendererDemoJsx;\nconst ArticleDemo = _articleDemoJsx;\nconst MultirendererDemo = _multirendererDemoJsx;\nconst ItemDiffDemo = _itemDiffDemoJsx;\nconst ArticleDiffDemo = _articleDiffDemoJsx;\n\nconst query = Util.parseQueryString(window.location.hash.substring(1));\nconst question = query.content && JSON.parse(query.content);\nconst problemNum = Math.floor(Math.random() * 100);\n\n// React router v20XX\nconst path = window.location.search.substring(1);\nconst routes = {\n    // The value is spread across a React.createElement call\n    renderer: [RendererDemo, {question, problemNum}],\n    article: [ArticleDemo, {content: question}],\n    multirenderer: [MultirendererDemo, {item: question}],\n    \"item-diff\": [ItemDiffDemo, {}],\n    \"article-diff\": [ArticleDiffDemo, {}],\n    \"\": [EditorDemo, {question, problemNum}],\n};\n\nPerseus.init({skipMathJax: true, loadExtraWidgets: true})\n    .then(function() {\n        ReactDOM.render(\n            React.createElement(...(routes[path] || routes[\"\"])),\n            document.getElementById(\"root\")\n        );\n    })\n    .then(\n        function() {},\n        function(err) {\n            console.error(err); // @Nolint\n        }\n    );\nexport default _module_.exports;\n"],"sourceRoot":""}